{"version":3,"file":"webmolkit.js","mappings":"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A,0SACA,uSACA,GACA,uDACA,oSACA,4PACA,0aACA,0GACA,0DACA,0yBACA,2DACA,wdACA,waACA,wHACA,yCACA,8BACA,idACA,qCACA,6NACA,qFACA,0QACA,gZACA,wCACA,6KACA,qGACA,8BACA,uJACA,8FACA,sOACA,sHACA,+LACA,gVACA,+fACA,2RACA,sHACA,+HACA,8IACA,yTACA,mJACA,mTACA,iIACA,2jBACA,gGACA,yGACA,wHACA,6HACA,8FACA,uGACA,qHACA,0HACA,2SACA,sSACA,mYACA,6YACA,2ZACA,skBACA,gaACA,gHACA,6hBACA,+RACA,ySACA,uTACA,4TACA,6GACA,qRACA,sdACA,qdACA,8dACA,4eACA,wpBACA,ifACA,8oBACA,mtBACA,odACA,iUACA,0UACA,wVACA,6VACA,0DACA,mEACA,iFACA,sFACA,+cACA,sYACA,qRACA,8RACA,4SACA,udACA,iTACA,sFACA,6YACA,wMACA,iNACA,+NACA,oOACA,8GACA,2SACA,kEACA,uCACA,gGACA,8HACA,8BACA,wGACA,uGACA,sGACA,2YACA,4GACA,kWACA,yHACA,0FACA,yaACA,4CACA,iEACA,oEACA,qEACA,mEACA,mYACA,kEACA,iFACA,uDACA,4FACA,uEACA,0FACA,uWACA,qDACA,uRACA,yFACA,sDACA,wEACA,ydACA,wGACA,8RACA,8TACA,0HACA,gIACA,0TACA,ohBACA,gNACA,kEACA,uSACA,sRACA,meACA,0EACA,mXACA,+eACA,iYACA,4KACA,gcACA,8BACA,oLACA,8DACA,kKACA,iEACA,okBACA,wPACA,kDACA,6RACA,uWACA,wQACA,kDACA,yMACA,2UACA,+FACA,uRACA,+gBACA,sFACA,kQACA,6RACA,6OACA,mjBACA,6cACA,iEACA,2EACA,4FACA,iCACA,0CACA,8BACA,0EACA,8hBACA,iRACA,qcACA,gIACA,6FACA,6FAEM,KAAAC,UACP,CACC,GAAI,CAAC,IAAI,IAAI,IAAI,KAAM,CAAC,IAAI,IAAI,IAAI,IAAI,KAAM,CAAC,IA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,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACjJ,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACjJ,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACjJ,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACjJ,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACjJ,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACjJ,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACjJ,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACjJ,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,I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","sources":["webpack://WebMolKit/webpack/bootstrap","webpack://WebMolKit/webpack/runtime/define property getters","webpack://WebMolKit/webpack/runtime/hasOwnProperty shorthand","webpack://WebMolKit/webpack/runtime/make namespace object","webpack://WebMolKit/./src/util/Vec.ts","webpack://WebMolKit/./src/util/Matrix.ts","webpack://WebMolKit/./src/util/Triangulation2D.ts","webpack://WebMolKit/./src/util/Geom.ts","webpack://WebMolKit/./src/util/XML.ts","webpack://WebMolKit/./src/util/dom.ts","webpack://WebMolKit/./src/util/util.ts","webpack://WebMolKit/./src/data/Chemistry.ts","webpack://WebMolKit/./src/data/Graph.ts","webpack://WebMolKit/./src/calc/ResonanceRemover.ts","webpack://WebMolKit/./src/data/BondArtifact.ts","webpack://WebMolKit/./src/data/PolymerBlock.ts","webpack://WebMolKit/./src/data/SketchUtil.ts","webpack://WebMolKit/./src/data/ForeignMolecule.ts","webpack://WebMolKit/./src/data/QueryUtil.ts","webpack://WebMolKit/./src/data/MolUtil.ts","webpack://WebMolKit/./src/data/CoordUtil.ts","webpack://WebMolKit/./src/data/StereoGroup.ts","webpack://WebMolKit/./src/data/MDLReader.ts","webpack://WebMolKit/./src/data/MDLWriter.ts","webpack://WebMolKit/./src/data/MoleculeStream.ts","webpack://WebMolKit/./src/data/Molecule.ts","webpack://WebMolKit/./src/data/DataSheet.ts","webpack://WebMolKit/./src/aspect/Aspect.ts","webpack://WebMolKit/./src/aspect/AspectList.ts","webpack://WebMolKit/./src/aspect/AssayProvenance.ts","webpack://WebMolKit/./src/aspect/BayesianSource.ts","webpack://WebMolKit/./src/aspect/BayesianPrediction.ts","webpack://WebMolKit/./src/aspect/MeasurementData.ts","webpack://WebMolKit/./src/aspect/BinaryData.ts","webpack://WebMolKit/./src/data/ExperimentMeta.ts","webpack://WebMolKit/./src/data/QuantityCalc.ts","webpack://WebMolKit/./src/gfx/Rendering.ts","webpack://WebMolKit/./src/gfx/ArrangeMolecule.ts","webpack://WebMolKit/./src/gfx/ArrangeExperiment.ts","webpack://WebMolKit/./src/gfx/MetaVector.ts","webpack://WebMolKit/./src/aspect/Experiment.ts","webpack://WebMolKit/./src/aspect/Mixture.ts","webpack://WebMolKit/./src/data/DotPath.ts","webpack://WebMolKit/./src/util/FitRotatedEllipse.ts","webpack://WebMolKit/./src/gfx/FontData.ts","webpack://WebMolKit/./src/gfx/ArrangeMeasurement.ts","webpack://WebMolKit/./src/gfx/DrawMolecule.ts","webpack://WebMolKit/./src/gfx/DrawExperiment.ts","webpack://WebMolKit/./src/aspect/SARTable.ts","webpack://WebMolKit/./src/data/Stereochemistry.ts","webpack://WebMolKit/./src/data/MetaMolecule.ts","webpack://WebMolKit/./src/calc/CircularFingerprints.ts","webpack://WebMolKit/./src/calc/BayesianModel.ts","webpack://WebMolKit/./src/calc/BuildSMILES.ts","webpack://WebMolKit/./src/util/Theme.ts","webpack://WebMolKit/./src/data/DataSheetStream.ts","webpack://WebMolKit/./src/data/AbbrevContainer.ts","webpack://WebMolKit/./src/data/FormatList.ts","webpack://WebMolKit/./src/data/OntologyTree.ts","webpack://WebMolKit/./src/ui/Tooltip.ts","webpack://WebMolKit/./src/dialog/Dialog.ts","webpack://WebMolKit/./src/ui/Widget.ts","webpack://WebMolKit/./src/ui/ButtonView.ts","webpack://WebMolKit/./src/sketcher/MoleculeActivity.ts","webpack://WebMolKit/./src/ui/ButtonBank.ts","webpack://WebMolKit/./src/sketcher/MetalLigate.ts","webpack://WebMolKit/./src/sketcher/TemplateFusion.ts","webpack://WebMolKit/./src/sketcher/CommandBank.ts","webpack://WebMolKit/./src/sketcher/ContextSketch.ts","webpack://WebMolKit/./src/sketcher/DrawCanvas.ts","webpack://WebMolKit/./src/sketcher/GeomWidget.ts","webpack://WebMolKit/./src/ui/ClipboardProxy.ts","webpack://WebMolKit/./src/ui/OptionList.ts","webpack://WebMolKit/./src/ui/TabBar.ts","webpack://WebMolKit/./src/sketcher/ExtraFieldsWidget.ts","webpack://WebMolKit/./src/sketcher/PeriodicTableWidget.ts","webpack://WebMolKit/./src/sketcher/QueryFieldsWidget.ts","webpack://WebMolKit/./src/sketcher/EditAtom.ts","webpack://WebMolKit/./src/sketcher/EditBond.ts","webpack://WebMolKit/./src/sketcher/EditPolymer.ts","webpack://WebMolKit/./src/sketcher/ToolBank.ts","webpack://WebMolKit/./src/sketcher/TemplateBank.ts","webpack://WebMolKit/./src/ui/EmbedReaction.ts","webpack://WebMolKit/./src/sketcher/Sketcher.ts","webpack://WebMolKit/./src/dialog/EditCompound.ts","webpack://WebMolKit/./src/gfx/AxisLabeller.ts","webpack://WebMolKit/./src/ui/EmbedChemistry.ts","webpack://WebMolKit/./src/ui/EmbedCollection.ts","webpack://WebMolKit/./src/ui/EmbedMolecule.ts","webpack://WebMolKit/./src/ui/Popup.ts","webpack://WebMolKit/./src/ui/MenuProxy.ts","webpack://WebMolKit/./src/util/Random.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/*\n    WebMolKit\n\n    (c) 2010-2017 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\n/* eslint-disable comma-spacing */\n\n/*\n\tFunctions that operate on arrays, for performing routine tasks.\n*/\n\nexport class Vec\n{\n\tpublic static isBlank(arr:any[]):boolean {return arr == null || arr.length == 0;}\n\tpublic static notBlank(arr:any[]):boolean {return arr != null && arr.length > 0;}\n\tpublic static safeArray<T>(arr:T[]):T[] {return arr == null ? [] : arr;}\n\tpublic static len(arr:any[]):number {return arr == null ? 0 : arr.length;} // (can't use \"length\" because it's reserved)\n\tpublic static arrayLength(arr:any[]):number {return arr == null ? 0 : arr.length;} // (unwieldy)\n\n\tpublic static anyTrue(arr:boolean[]):boolean\n\t{\n\t\tif (arr == null) return false;\n\t\tfor (let v of arr) if (v) return true;\n\t\treturn false;\n\t}\n\tpublic static allTrue(arr:boolean[]):boolean\n\t{\n\t\tif (arr == null) return true;\n\t\tfor (let v of arr) if (!v) return false;\n\t\treturn true;\n\t}\n\n\tpublic static anyFalse(arr:boolean[]):boolean\n\t{\n\t\tif (arr == null) return false;\n\t\tfor (let v of arr) if (!v) return true;\n\t\treturn false;\n\t}\n\tpublic static allFalse(arr:boolean[]):boolean\n\t{\n\t\tif (arr == null) return true;\n\t\tfor (let v of arr) if (v) return false;\n\t\treturn true;\n\t}\n\n\t// lambda versions of array scanning\n\tpublic static iterAnyTrue<T>(arr:T[], callback:(value:T) => boolean)\n\t{\n\t\tfor (let v of arr) if (callback(v)) return true;\n\t\treturn false;\n\t}\n\tpublic static iterAllTrue<T>(arr:T[], callback:(value:T) => boolean)\n\t{\n\t\tfor (let v of arr) if (!callback(v)) return false;\n\t\treturn true;\n\t}\n\tpublic static iterAnyFalse<T>(arr:T[], callback:(value:T) => boolean)\n\t{\n\t\tfor (let v of arr) if (!callback(v)) return true;\n\t\treturn false;\n\t}\n\tpublic static iterAllFalse<T>(arr:T[], callback:(value:T) => boolean)\n\t{\n\t\tfor (let v of arr) if (callback(v)) return false;\n\t\treturn true;\n\t}\n\n\t// convenience index swapping\n\tpublic static swap(arr:any[], idx1:number, idx2:number):void\n\t{\n\t\tlet v = arr[idx1];\n\t\tarr[idx1] = arr[idx2];\n\t\tarr[idx2] = v;\n\t}\n\n\t// make a shallow copy of the array, or turn it into a blank array if null\n\tpublic static duplicate<T>(arr:T[]):T[]\n\t{\n\t\treturn arr == null ? [] : arr.slice(0);\n\t}\n\n\t// null-tolerant array concatenation; always returns an array, always at least a shallow copy\n\tpublic static append<T>(arr:T[], item:T):T[]\n\t{\n\t\tif (arr == null || arr.length == 0) return [item];\n\t\tarr = arr.slice(0);\n\t\tarr.push(item);\n\t\treturn arr;\n\t}\n\tpublic static prepend<T>(arr:T[], item:T):T[]\n\t{\n\t\tif (arr == null || arr.length == 0) return [item];\n\t\tarr = arr.slice(0);\n\t\tarr.unshift(item);\n\t\treturn arr;\n\t}\n\tpublic static concat<T>(arr1:T[], arr2:T[]):T[]\n\t{\n\t\tif (arr1 == null && arr2 == null) return [];\n\t\tif (arr1 == null) return arr2.slice(0);\n\t\tif (arr2 == null) return arr1.slice(0);\n\t\treturn arr1.concat(arr2);\n\t}\n\n\t// array removal, with shallow-copy duplication\n\tpublic static remove<T>(arr:T[], idx:number):T[]\n\t{\n\t\tarr = arr.slice(0);\n\t\tarr.splice(idx, 1);\n\t\treturn arr;\n\t}\n\n\t// squishes a 2D array down to a single consecutive flattened vector\n\tpublic static flatten<T>(mtx:T[][]):T[]\n\t{\n\t\tlet ret:T[] = [];\n\t\tfor (let vec of mtx) ret.push(...vec);\n\t\treturn ret;\n\t}\n\n\t// assuming the input is matrix-like, swaps the first two axes, i.e. {m,n} => {n,m}\n\tpublic static transpose<T>(mtx:T[][]):T[][]\n\t{\n\t\tlet sz1 = mtx.length, sz2 = mtx[0].length;\n\t\tlet ret:T[][] = Vec.anyArray(null, sz2);\n\t\tfor (let j = 0; j < sz2; j++)\n\t\t{\n\t\t\tret[j] = Vec.anyArray(null, sz1);\n\t\t\tfor (let i = 0; i < sz1; i++) ret[j][i] = mtx[i][j];\n\t\t}\n\t\treturn ret;\n\t}\n\n\t// null-tolerant comparison\n\tpublic static equals(arr1:any[], arr2:any[]):boolean\n\t{\n\t\tif (arr1 == null && arr2 == null) return true;\n\t\tif (arr1 == null || arr2 == null) return false;\n\t\tif (arr1.length != arr2.length) return false;\n\t\tfor (let n = 0; n < arr1.length; n++) if (arr1[n] != arr2[n]) return false;\n\t\treturn true;\n\t}\n\tpublic static equivalent(arr1:any[], arr2:any[]):boolean\n\t{\n\t\tconst len1 = arr1 == null ? 0 : arr1.length, len2 = arr2 == null ? 0 : arr2.length;\n\t\tif (len1 != len2) return false;\n\t\tfor (let n = 0; n < len1; n++) if (arr1[n] != arr2[n]) return false;\n\t\treturn true;\n\t}\n\n\t// comparison that can be used for sorting; -1 if arr1<arr2, +1 if arr1>arr2, 0 if equal\n\tpublic static compareTo<T>(arr1:T[], arr2:T[]):number\n\t{\n\t\tconst sz = Math.max(arr1.length, arr2.length);\n\t\tfor (let n = 0; n < sz; n++)\n\t\t{\n\t\t\tif (arr1[n] < arr2[n]) return -1;\n\t\t\tif (arr1[n] > arr2[n]) return 1;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tpublic static booleanArray(val:boolean, sz:number):boolean[]\n\t{\n\t\tlet arr:boolean[] = new Array(sz);\n\t\tarr.fill(val);\n\t\treturn arr;\n\t}\n\tpublic static numberArray(val:number, sz:number):number[]\n\t{\n\t\tlet arr:number[] = new Array(sz);\n\t\tarr.fill(val);\n\t\treturn arr;\n\t}\n\tpublic static stringArray(val:string, sz:number):string[]\n\t{\n\t\tlet arr:string[] = new Array(sz);\n\t\tarr.fill(val);\n\t\treturn arr;\n\t}\n\tpublic static anyArray(val:any, sz:number):any[]\n\t{\n\t\tlet arr:any[] = new Array(sz);\n\t\tarr.fill(val);\n\t\treturn arr;\n\t}\n\tpublic static genericArray<T>(val:T, sz:number):T[]\n\t{\n\t\tlet arr:T[] = new Array(sz);\n\t\tarr.fill(val);\n\t\treturn arr;\n\t}\n\n\t// returns an array of blank arrays\n\tpublic static genericBlankArrays<T>(sz:number):T[][]\n\t{\n\t\tlet arr:T[][] = new Array(sz);\n\t\tfor (let n = 0; n < sz; n++) arr[n] = [];\n\t\treturn arr;\n\t}\n\n\t// creates an array of given size, using a lambda\n\tpublic static funcArray<T>(sz:number, func:(idx?:number) => T):T[]\n\t{\n\t\tlet arr:T[] = new Array(sz);\n\t\tfor (let n = 0; n < sz; n++) arr[n] = func(n);\n\t\treturn arr;\n\t}\n\n\tpublic static first<T>(arr:T[]) {return arr == null || arr.length == 0 ? null : arr[0];}\n\tpublic static last<T>(arr:T[]) {return arr == null || arr.length == 0 ? null : arr[arr.length - 1];}\n\n\tpublic static min(arr:number[]):number\n\t{\n\t\tif (arr == null || arr.length == 0) return Number.MAX_VALUE;\n\t\tlet v = arr[0];\n\t\tfor (let n = 1; n < arr.length; n++) v = Math.min(v, arr[n]);\n\t\treturn v;\n\t}\n\tpublic static max(arr:number[]):number\n\t{\n\t\tif (arr == null || arr.length == 0) return Number.MIN_VALUE;\n\t\tlet v = arr[0];\n\t\tfor (let n = 1; n < arr.length; n++) v = Math.max(v, arr[n]);\n\t\treturn v;\n\t}\n\tpublic static idxMin(arr:number[]):number\n\t{\n\t\tif (arr == null || arr.length == 0) return -1;\n\t\tlet idx = 0;\n\t\tfor (let n = 1; n < arr.length; n++) if (arr[n] < arr[idx]) idx = n;\n\t\treturn idx;\n\t}\n\tpublic static idxMax(arr:number[]):number\n\t{\n\t\tif (arr == null || arr.length == 0) return -1;\n\t\tlet idx = 0;\n\t\tfor (let n = 1; n < arr.length; n++) if (arr[n] > arr[idx]) idx = n;\n\t\treturn idx;\n\t}\n\n\tpublic static range(arr:number[]):number\n\t{\n\t\tif (arr == null || arr.length == 0) return 0;\n\t\tlet lo = arr[0], hi = arr[0];\n\t\tfor (let n = 1; n < arr.length; n++)\n\t\t{\n\t\t\tif (arr[n] < lo) lo = arr[n];\n\t\t\tif (arr[n] > hi) hi = arr[n];\n\t\t}\n\t\treturn hi - lo;\n\t}\n\n\tpublic static reverse<T>(arr:T[]):T[]\n\t{\n\t\tlet ret:T[] = [];\n\t\tfor (let n = arr.length - 1; n >= 0; n--) ret.push(arr[n]);\n\t\treturn ret;\n\t}\n\n\tpublic static identity0(sz:number):number[]\n\t{\n\t\tlet ret:number[] = new Array(sz);\n\t\tfor (let n = 0; n < sz; n++) ret[n] = n;\n\t\treturn ret;\n\t}\n\n\tpublic static identity1(sz:number):number[]\n\t{\n\t\tlet ret:number[] = new Array(sz);\n\t\tfor (let n = 0; n < sz; n++) ret[n] = n + 1;\n\t\treturn ret;\n\t}\n\n\tpublic static identityN(start:number, sz:number):number[]\n\t{\n\t\tlet ret:number[] = new Array(sz);\n\t\tfor (let n = 0; n < sz; n++) ret[n] = n + start;\n\t\treturn ret;\n\t}\n\n\tpublic static notMask(mask:boolean[]):boolean[]\n\t{\n\t\tlet ret:boolean[] = new Array(mask.length);\n\t\tfor (let n = mask.length - 1; n >= 0; n--) ret[n] = !mask[n];\n\t\treturn ret;\n\t}\n\n\tpublic static idxGet<T>(arr:T[], idx:number[]):T[]\n\t{\n\t\tlet ret:T[] = [];\n\t\tfor (let n = 0; n < idx.length; n++) ret.push(arr[idx[n]]);\n\t\treturn ret;\n\t}\n\n\tpublic static maskCount(mask:boolean[]):number\n\t{\n\t\tif (!mask) return 0;\n\t\tlet c = 0;\n\t\tfor (let n = mask.length - 1; n >= 0; n--) if (mask[n]) c++;\n\t\treturn c;\n\t}\n\n\t// converts the mask into indices (0-based)\n\tpublic static maskIdx(mask:boolean[]):number[]\n\t{\n\t\tlet idx:number[] = [];\n\t\tfor (let n = 0; n < mask.length; n++) if (mask[n]) idx.push(n);\n\t\treturn idx;\n\t}\n\n\t// converts the index into a mask (0-based index)\n\tpublic static idxMask(idx:number[], sz:number):boolean[]\n\t{\n\t\tlet mask = Vec.booleanArray(false, sz);\n\t\tfor (let n of idx) mask[n] = true;\n\t\treturn mask;\n\t}\n\n\t// converts a mask into an index map: if mask[n] is true, then idx[n] is a 0-based index into an equivalent array composed only\n\t// of entries for which mask is true; for the rest, the value is -1\n\tpublic static maskMap(mask:boolean[]):number[]\n\t{\n\t\tlet ret:number[] = [];\n\t\tfor (let n = 0, pos = 0; n < mask.length; n++) ret.push(mask[n] ? pos++ : -1);\n\t\treturn ret;\n\t}\n\n\t// returns members of an array for which the value of mask is true\n\tpublic static maskGet<T>(arr:T[], mask:boolean[]):T[]\n\t{\n\t\tlet ret:T[] = [];\n\t\tfor (let n = 0, p = 0; n < arr.length; n++) if (mask[n]) ret.push(arr[n]);\n\t\treturn ret;\n\t}\n\n\t// return a mask of elements which are equal on both sides (with unit extension on the right)\n\tpublic static maskEqual(arr1:any[], val:any):boolean[]\n\t{\n\t\tlet ret:boolean[] = [];\n\t\tif (val.constructor === Array)\n\t\t{\n\t\t\tlet arr2 = val as number[];\n\t\t\tfor (let n = 0; n < arr1.length; n++) ret.push(arr1[n] == arr2[n]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (let n = 0; n < arr1.length; n++) ret.push(arr1[n] == val);\n\t\t}\n\t\treturn ret;\n\t}\n\n\tpublic static sum(arr:number[]):number\n\t{\n\t\tif (arr == null || arr.length == 0) return 0;\n\t\tlet t = arr[0];\n\t\tfor (let n = 1; n < arr.length; n++) t += arr[n];\n\t\treturn t;\n\t}\n\n\tpublic static add(arr1:number[], val:number | number[]):number[]\n\t{\n\t\tlet ret:any[] = [];\n\t\tif (val.constructor === Array)\n\t\t{\n\t\t\tlet arr2 = val as number[];\n\t\t\tfor (let n = 0; n < arr1.length; n++) ret.push(arr1[n] + arr2[n]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (let n = 0; n < arr1.length; n++) ret.push(arr1[n] + (val as number));\n\t\t}\n\t\treturn ret;\n\t}\n\n\tpublic static sub(arr1:number[], val:number | number[]):number[]\n\t{\n\t\tlet ret:any[] = [];\n\t\tif (val.constructor === Array)\n\t\t{\n\t\t\tlet arr2 = val as number[];\n\t\t\tfor (let n = 0; n < arr1.length; n++) ret.push(arr1[n] - arr2[n]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (let n = 0; n < arr1.length; n++) ret.push(arr1[n] - (val as number));\n\t\t}\n\t\treturn ret;\n\t}\n\n\tpublic static mul(arr1:number[], val:number | number[]):number[]\n\t{\n\t\tlet ret:any[] = [];\n\t\tif (val.constructor === Array)\n\t\t{\n\t\t\tlet arr2 = val as number[];\n\t\t\tfor (let n = 0; n < arr1.length; n++) ret.push(arr1[n] * arr2[n]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (let n = 0; n < arr1.length; n++) ret.push(arr1[n] * (val as number));\n\t\t}\n\t\treturn ret;\n\t}\n\n\tpublic static neg(arr:number[]):number[]\n\t{\n\t\tlet ret = arr.slice(0);\n\t\tfor (let n = ret.length - 1; n >= 0; n--) ret[n] *= -1;\n\t\treturn ret;\n\t}\n\n\t// bulk direct operations\n\tpublic static setTo(arr:any[], val:any):void {for (let n = arr == null ? -1 : arr.length - 1; n >= 0; n--) arr[n] = val;}\n\tpublic static addTo(arr:number[], val:number):void {for (let n = arr == null ? -1 : arr.length - 1; n >= 0; n--) arr[n] += val;}\n\tpublic static mulBy(arr:number[], val:number):void {for (let n = arr == null ? -1 : arr.length - 1; n >= 0; n--) arr[n] *= val;}\n\n\tpublic static addToArray(arr:number[], val:number[]):void {for (let n = arr == null ? -1 : arr.length - 1; n >= 0; n--) arr[n] += val[n];}\n\tpublic static subFromArray(arr:number[], val:number[]):void {for (let n = arr == null ? -1 : arr.length - 1; n >= 0; n--) arr[n] -= val[n];}\n\tpublic static mulByArray(arr:number[], val:number[]):void {for (let n = arr == null ? -1 : arr.length - 1; n >= 0; n--) arr[n] *= val[n];}\n\tpublic static divByArray(arr:number[], val:number[]):void {for (let n = arr == null ? -1 : arr.length - 1; n >= 0; n--) arr[n] /= val[n];}\n\n\tpublic static idxSort(arr:any[]):number[]\n\t{\n\t\tlet idx:number[] = new Array(arr.length);\n\t\tfor (let n = 0; n < arr.length; n++) idx[n] = n;\n\t\tidx.sort((a:number, b:number):number => arr[a] < arr[b] ? -1 : arr[a] > arr[b] ? 1 : 0);\n\t\treturn idx;\n\t}\n\n\t// for some reason the default sorter has a dubious habit of doing a string comparison; this function is numeric\n\tpublic static sort(arr:number[]):void\n\t{\n\t\tarr.sort((v1:number, v2:number):number => v1 - v2);\n\t}\n\tpublic static sorted(arr:number[]):number[]\n\t{\n\t\tarr = arr.slice(0);\n\t\tthis.sort(arr);\n\t\treturn arr;\n\t}\n\n\t// returns only the unique entries, sorted\n\tpublic static sortedUnique<T>(arr:T[]):T[]\n\t{\n\t\tif (arr == null || arr.length == 0) return [];\n\t\tlet unique = Vec.uniqueUnstable(arr);\n\t\tif (typeof arr[0] == 'number') this.sort((unique as any) as number[]); else unique.sort();\n\t\treturn unique;\n\t}\n\n\t// uniqueness, in its various permutations\n\tpublic static uniqueUnstable<T>(arr:T[]):T[]\n\t{\n\t\treturn Array.from(new Set(arr)); // order is basically random\n\t}\n\tpublic static uniqueStable<T>(arr:T[]):T[]\n\t{\n\t\tlet set = new Set<T>(arr), ret:T[] = [];\n\t\tfor (let v of arr) if (set.has(v)) {ret.push(v); set.delete(v);}\n\t\treturn ret; // original order is preserved, with non-first entries removed*/\n\t}\n\tpublic static maskUnique(arr:any[]):boolean[]\n\t{\n\t\tlet set = new Set<any>(arr), ret = this.booleanArray(false, arr.length);\n\t\tfor (let n = 0; n < arr.length; n++) if (set.has(arr[n])) {ret[n] = true; set.delete(arr[n]);}\n\t\treturn ret;\n\t}\n\tpublic static idxUnique(arr:any[]):number[]\n\t{\n\t\tlet set = new Set<any>(arr), ret:number[] = [];\n\t\tfor (let n = 0; n < arr.length; n++) if (set.has(arr[n])) {ret.push(n); set.delete(arr[n]);}\n\t\treturn ret; // index of first occurence in original array\n\t}\n\n\t// for a given array, ensures that certain value are not present, and will eliminate them when discovered; original order preserved;\n\t// null-tolerant, and may return the original array if unchanged\n\t// note: O(N^2); may improve this at a later date\n\tpublic static exclude<T>(arr:T[], excl:T[]):T[]\n\t{\n\t\tconst sz = Vec.len(arr);\n\t\tif (sz == 0) return [];\n\t\tlet mask:boolean[] = new Array(sz);\n\t\tlet count = 0;\n\t\tfor (let n = 0; n < arr.length; n++)\n\t\t{\n\t\t\tmask[n] = excl.indexOf(arr[n]) < 0;\n\t\t\tif (mask[n]) count++;\n\t\t}\n\t\tif (count == sz) return arr;\n\t\treturn Vec.maskGet(arr, mask);\n\t}\n}\n\n/*\n\tPermutation functions, operating explicitly on arrays of consecutive integers.\n*/\n\nexport class Permutation\n{\n\t// for a set of indices that are assumed to be unique and in the range {0 .. N-1}, returns their parity, i.e.\n\t// the number of swaps used to permute it from the identity; if the list is sorted, the result is 0\n\t// NOTE: parityPerms(..) returns the total number of swaps, whereas parityIdentity(..) returns either 0 or 1\n\tpublic static parityPerms(idx:number[]):number\n\t{\n\t\tlet v = Vec.booleanArray(false, idx.length);\n\t\tlet p = 0;\n\t\tfor (let i = idx.length - 1; i >= 0; i--)\n\t\t{\n\t\t\tif (v[i]) p++;\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet j = i;\n\t\t\t\tdo\n\t\t\t\t{\n\t\t\t\t\tj = idx[j];\n\t\t\t\t\tv[j] = true;\n\t\t\t\t}\n\t\t\t\twhile (j != i);\n\t\t\t}\n\t\t}\n\t\treturn p;\n\t}\n\tpublic static parityIdentity(idx:number[]):number\n\t{\n\t\treturn this.parityPerms(idx) & 1;\n\t}\n\n\t// parity methods that operate on arbitrary integers; returns 0 for an even number of swaps, 1 for odd\n\t// NOTE: this is rather inefficient for non-tiny arrays; could at least code up some more special cases\n\tpublic static parityOrder(src:number[]):number\n\t{\n\t\tif (src.length <= 1) return 0;\n\t\telse if (src.length == 2) return src[0] < src[1] ? 0 : 1;\n\t\telse if (src.length == 3)\n\t\t{\n\t\t\tlet p = 1;\n\t\t\tif (src[0] < src[1]) p++;\n\t\t\tif (src[0] < src[2]) p++;\n\t\t\tif (src[1] < src[2]) p++;\n\t\t\treturn p & 1;\n\t\t}\n\t\telse if (src.length == 4)\n\t\t{\n\t\t\tlet p = 0;\n\t\t\tif (src[0] < src[1]) p++;\n\t\t\tif (src[0] < src[2]) p++;\n\t\t\tif (src[0] < src[3]) p++;\n\t\t\tif (src[1] < src[2]) p++;\n\t\t\tif (src[1] < src[3]) p++;\n\t\t\tif (src[2] < src[3]) p++;\n\t\t\treturn p & 1;\n\t\t}\n\n\t\tlet idx:number[] = [], sorted = src.slice(0);\n\t\tsorted.sort();\n\t\tfor (let n = 0; n < src.length; n++) idx.push(sorted.indexOf(src[n]));\n\t\treturn this.parityIdentity(idx);\n\t}\n\n\t/*\n\t\tSmall permutations: up to a certain size, it makes sense to just hardcode them.\n\n\t\tNote that in each case, the identity permutation is guaranteed to be first. The remaining permutations\n\t\tare not guaranteed to be in any particular order.\n\t*/\n\n\tprivate static PERM1 = [[0]];\n\tprivate static PERM2 = [[0, 1], [1, 0]];\n\tprivate static PERM3 = [[0, 1, 2], [0, 2, 1], [1, 0, 2], [1, 2, 0], [2, 0, 1], [2, 1, 0]];\n\tprivate static PERM4 =\n\t[\n\t\t[0,1,2,3], [0,1,3,2], [0,2,1,3], [0,2,3,1], [0,3,1,2], [0,3,2,1],\n\t\t[1,0,2,3], [1,0,3,2], [1,2,0,3], [1,2,3,0], [1,3,0,2], [1,3,2,0],\n\t\t[2,0,1,3], [2,0,3,1], [2,1,0,3], [2,1,3,0], [2,3,0,1], [2,3,1,0],\n\t\t[3,0,1,2], [3,0,2,1], [3,1,0,2], [3,1,2,0], [3,2,0,1], [3,2,1,0]\n\t];\n\n\tpublic static SMALL_PERMS = 4;\n\n\tpublic static smallPermutation(sz:number):number[][]\n\t{\n\t\tif (sz == 1) return this.PERM1;\n\t\telse if (sz == 2) return this.PERM2;\n\t\telse if (sz == 3) return this.PERM3;\n\t\telse if (sz == 4) return this.PERM4;\n\t\telse return null;\n\t}\n\n\t// cache: intermediate permutation sizes are cached; note that anything significantly big really should not be used\n\tprivate static MAX_CACHE = 8;\n\tprivate static PERM_CACHE:number[][][] = [];\n\n\t// returns all of the permutations up to a certain size; note that this is slow and scales exponentially: use sparingly\n\tpublic static allPermutations(sz:number):number[][]\n\t{\n\t\tif (sz <= this.SMALL_PERMS) return this.smallPermutation(sz);\n\t\twhile (this.PERM_CACHE.length < this.MAX_CACHE - this.SMALL_PERMS) this.PERM_CACHE.push(null);\n\t\tif (sz < this.MAX_CACHE && this.PERM_CACHE[sz - this.SMALL_PERMS] != null) return this.PERM_CACHE[sz - this.SMALL_PERMS];\n\n\t\tlet nperms = 1;\n\t\tfor (let n = 2; n <= sz; n++) nperms *= n;\n\t\tlet perms:number[][] = [];\n\n\t\t// NOTE: for sure not the fastest way to do it, but it gets the job done; the total number of iterations is actually\n\t\t// exponential, rather than factorial\n\n\t\tlet idx = Vec.identity0(sz);\n\t\tperms.push(idx.slice(0));\n\t\tlet mask = Vec.booleanArray(false, sz);\n\n\t\tfor (let n = 1; n < nperms; n++)\n\t\t{\n\t\t\tnonunique: while (idx[0] < sz)\n\t\t\t{\n\t\t\t\t// increment the \"digits\"\n\t\t\t\tidx[sz - 1]++;\n\t\t\t\tfor (let i = sz - 1; i > 0; i --)\n\t\t\t\t{\n\t\t\t\t\tif (idx[i] < sz) break;\n\t\t\t\t\tidx[i] = 0;\n\t\t\t\t\tidx[i - 1]++;\n\t\t\t\t}\n\n\t\t\t\t// skip the loop if digits have any degeneracy\n\t\t\t\tVec.setTo(mask, false);\n\t\t\t\tfor (let i of idx)\n\t\t\t\t{\n\t\t\t\t\tif (mask[i]) continue nonunique;\n\t\t\t\t\tmask[i] = true;\n\t\t\t\t}\n\n\t\t\t\t// this is a new unique combo, so poke it in\n\t\t\t\tperms[n] = idx.slice(0);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (sz < this.MAX_CACHE) this.PERM_CACHE[sz - this.SMALL_PERMS] = perms;\n\t\treturn perms;\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2020 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Vec} from './Vec';\n\n/*\n\tUseful matrix functionality.\n*/\n\nexport class Matrix\n{\n\tpublic A:number[][];\n\n\t// create a blank matrix with given dimensions; m = height, n = width\n\tconstructor(public m:number, public n:number, s:number = 0)\n\t{\n\t\tif (m == 0) return;\n\t\tthis.A = new Array(m);\n\t\tfor (let i = 0; i < m; i++) this.A[i] = Vec.numberArray(s, n);\n\t}\n\n\tpublic static fromArray(A:number[][]):Matrix\n\t{\n\t\tlet mtx = new Matrix(0, 0);\n\t\tmtx.A = A;\n\t\tmtx.m = A.length;\n\t\tmtx.n = A[0].length;\n\t\treturn mtx;\n\t}\n\n\tpublic clone():Matrix\n\t{\n\t\tconst {A, m, n} = this;\n\t\tlet mtx = new Matrix(m, n);\n\t\tfor (let i = 0; i < m; i++) for (let j = 0; j < n; j++) mtx.A[i][j] = A[i][j];\n\t\treturn mtx;\n\t}\n\n\tpublic get numRows():number {return this.m;}\n\tpublic get numCols():number {return this.n;}\n\tpublic get(i:number, j:number):number {return this.A[i][j];}\n\tpublic set(i:number, j:number, v:number):void {this.A[i][j] = v;}\n\n\tpublic transpose():Matrix\n\t{\n\t\tconst {A, m, n} = this;\n\t\tlet X = new Matrix(n, m);\n\t\tconst C = X.A;\n\t\tfor (let i = 0; i < m; i++) for (let j = 0; j < n; j++) C[j][i] = A[i][j];\n\t\treturn X;\n\t}\n\n\tpublic norm1():number\n\t{\n\t\tconst {A, m, n} = this;\n\t\tlet f = 0;\n\t\tfor (let j = 0; j < n; j++)\n\t\t{\n\t\t\tlet s = 0;\n\t\t\tfor (let i = 0; i < m; i++) s += Math.abs(A[i][j]);\n\t\t\tf = Math.max(f, s);\n\t\t}\n\t\treturn f;\n\t}\n\n/*\n\tpublic double norm2()\n\t{\n\t\treturn (new SingularValueDecomposition(this).norm2());\n\t}\n*/\n\n\tpublic normInf():number\n\t{\n\t\tconst {A, m, n} = this;\n\t\tlet f = 0;\n\t\tfor (let i = 0; i < m; i++)\n\t\t{\n\t\t\tlet s = 0;\n\t\t\tfor (let j = 0; j < n; j++) s += Math.abs(A[i][j]);\n\t\t\tf = Math.max(f, s);\n\t\t}\n\t\treturn f;\n\t}\n\n/*\n\tpublic double normF()\n\t{\n\t\tdouble f = 0;\n\t\tfor (let i = 0; i < m; i++)\n\t\t{\n\t\t\tfor (let j = 0; j < n; j++)\n\t\t\t{\n\t\t\t\tf = Maths.hypot(f, A[i][j]);\n\t\t\t}\n\t\t}\n\t\treturn f;\n\t}\n*/\n\n\tpublic uminus():Matrix\n\t{\n\t\tconst {A, m, n} = this;\n\t\tlet X = new Matrix(m, n), C = X.A;\n\t\tfor (let i = 0; i < m; i++) for (let j = 0; j < n; j++) C[i][j] = -A[i][j];\n\t\treturn X;\n\t}\n\n\tpublic plus(B:Matrix):Matrix\n\t{\n\t\tconst {A, m, n} = this;\n\t\tlet X = new Matrix(m, n), C = X.A;\n\t\tfor (let i = 0; i < m; i++) for (let j = 0; j < n; j++) C[i][j] = A[i][j] + B.A[i][j];\n\t\treturn X;\n\t}\n\n\tpublic plusEquals(B:Matrix):Matrix\n\t{\n\t\tconst {A, m, n} = this;\n\t\tfor (let i = 0; i < m; i++) for (let j = 0; j < n; j++) A[i][j] = A[i][j] + B.A[i][j];\n\t\treturn this;\n\t}\n\n\tpublic minus(B:Matrix):Matrix\n\t{\n\t\tconst {A, m, n} = this;\n\t\tlet X = new Matrix(m, n), C = A;\n\t\tfor (let i = 0; i < m; i++) for (let j = 0; j < n; j++) C[i][j] = A[i][j] - B.A[i][j];\n\t\treturn X;\n\t}\n\n\tpublic minusEquals(B:Matrix):Matrix\n\t{\n\t\tconst {A, m, n} = this;\n\t\tfor (let i = 0; i < m; i++) for (let j = 0; j < n; j++) A[i][j] = A[i][j] - B.A[i][j];\n\t\treturn this;\n\t}\n\n\tpublic arrayTimes(B:Matrix):Matrix\n\t{\n\t\tconst {A, m, n} = this;\n\t\tlet X = new Matrix(m, n), C = X.A;\n\t\tfor (let i = 0; i < m; i++) for (let j = 0; j < n; j++) C[i][j] = A[i][j] * B.A[i][j];\n\t\treturn X;\n\t}\n\n\tpublic arrayTimesEquals(B:Matrix):Matrix\n\t{\n\t\tconst {A, m, n} = this;\n\t\tfor (let i = 0; i < m; i++) for (let j = 0; j < n; j++) A[i][j] = A[i][j] * B.A[i][j];\n\t\treturn this;\n\t}\n\n\tpublic arrayRightDivide(B:Matrix):Matrix\n\t{\n\t\tconst {A, m, n} = this;\n\t\tlet X = new Matrix(m, n), C = X.A;\n\t\tfor (let i = 0; i < m; i++) for (let j = 0; j < n; j++) C[i][j] = A[i][j] / B.A[i][j];\n\t\treturn X;\n\t}\n\n\tpublic arrayRightDivideEquals(B:Matrix):Matrix\n\t{\n\t\tconst {A, m, n} = this;\n\t\tfor (let i = 0; i < m; i++) for (let j = 0; j < n; j++) A[i][j] = A[i][j] / B.A[i][j];\n\t\treturn this;\n\t}\n\n\tpublic arrayLeftDivide(B:Matrix):Matrix\n\t{\n\t\tconst {A, m, n} = this;\n\t\tlet X = new Matrix(m, n), C = X.A;\n\t\tfor (let i = 0; i < m; i++) for (let j = 0; j < n; j++) C[i][j] = B.A[i][j] / A[i][j];\n\t\treturn X;\n\t}\n\n\tpublic arrayLeftDivideEquals(B:Matrix):Matrix\n\t{\n\t\tconst {A, m, n} = this;\n\t\tfor (let i = 0; i < m; i++) for (let j = 0; j < n; j++) A[i][j] = B.A[i][j] / A[i][j];\n\t\treturn this;\n\t}\n\n\tpublic scalarTimes(s:number):Matrix\n\t{\n\t\tconst {A, m, n} = this;\n\t\tlet X = new Matrix(m, n), C = X.A;\n\t\tfor (let i = 0; i < m; i++) for (let j = 0; j < n; j++) C[i][j] = s * A[i][j];\n\t\treturn X;\n\t}\n\n\tpublic scalarTimesEquals(s:number):Matrix\n\t{\n\t\tconst {A, m, n} = this;\n\t\tfor (let i = 0; i < m; i++) for (let j = 0; j < n; j++) A[i][j] = s * A[i][j];\n\t\treturn this;\n\t}\n\n\tpublic times(B:Matrix):Matrix\n\t{\n\t\tconst {A, m, n} = this;\n\t\tlet X = new Matrix(m, B.n);\n\t\tlet C = X.A, Bcolj:number[] = new Array(n);\n\t\tfor (let j = 0; j < B.n; j++)\n\t\t{\n\t\t\tfor (let k = 0; k < n; k++) Bcolj[k] = B.A[k][j];\n\t\t\tfor (let i = 0; i < m; i++)\n\t\t\t{\n\t\t\t\tlet Arowi = A[i];\n\t\t\t\tlet s = 0;\n\t\t\t\tfor (let k = 0; k < n; k++) s += Arowi[k] * Bcolj[k];\n\t\t\t\tC[i][j] = s;\n\t\t\t}\n\t\t}\n\t\treturn X;\n\t}\n\n\t/*public LUDecomposition lu()\n\t{\n\t\treturn new LUDecomposition(this);\n\t}\n\n\tpublic QRDecomposition qr()\n\t{\n\t\treturn new QRDecomposition(this);\n\t}\n\n\tpublic CholeskyDecomposition chol()\n\t{\n\t\treturn new CholeskyDecomposition(this);\n\t}\n\n\tpublic SingularValueDecomposition svd()\n\t{\n\t\treturn new SingularValueDecomposition(this);\n\t}\n\n\tpublic EigenvalueDecomposition eig()\n\t{\n\t\treturn new EigenvalueDecomposition(this);\n\t}\n\n\tpublic Matrix solve(Matrix B)\n\t{\n\t\treturn (m == n ? (new LUDecomposition(this)).solve(B) : (new QRDecomposition(this)).solve(B));\n\t}\n\n\tpublic Matrix solveTranspose(Matrix B)\n\t{\n\t\treturn transpose().solve(B.transpose());\n\t}\n\n\tpublic Matrix inverse()\n\t{\n\t\treturn solve(identity(m, m));\n\t}\n\n\tpublic double det()\n\t{\n\t\treturn new LUDecomposition(this).det();\n\t}*/\n\n\tpublic rank():number\n\t{\n\t\treturn new SingularValueDecomposition(this).rank();\n\t}\n\n\tpublic cond():number\n\t{\n\t\treturn new SingularValueDecomposition(this).cond();\n\t}\n\n\tpublic trace():number\n\t{\n\t\tconst {A, m, n} = this;\n\t\tlet t = 0;\n\t\tfor (let i = 0; i < Math.min(m, n); i++)\n\t\t{\n\t\t\tt += A[i][i];\n\t\t}\n\t\treturn t;\n\t}\n\n\tpublic static identity(m:number, n:number):Matrix\n\t{\n\t\tlet mtx = new Matrix(m, n);\n\t\tlet A = mtx.A;\n\t\tfor (let i = 0; i < m; i++) for (let j = 0; j < n; j++) A[i][j] = (i == j ? 1.0 : 0.0);\n\t\treturn mtx;\n\t}\n\n\tpublic toString():string\n\t{\n\t\tlet lines:string[] = ['['];\n\t\tfor (let row of this.A) lines.push(JSON.stringify(row));\n\t\tlines.push(']');\n\t\treturn lines.join('\\n');\n\t}\n}\n\nexport class SingularValueDecomposition\n{\n\tprivate U:number[][];\n\tprivate V:number[][];\n\tprivate s:number[];\n\tprivate m:number;\n\tprivate n:number;\n\n\tconstructor(mtx:Matrix)\n\t{\n\t\tlet A = mtx.A;\n\t\tlet m = this.m = mtx.m;\n\t\tlet n = this.n = mtx.n;\n\n\t\tlet nu = Math.min(m, n);\n\t\tlet s = this.s = new Array(Math.min(m + 1, n));\n\t\tlet U = this.U = new Array(m);\n\t\tlet V = this.V = new Array(n);\n\t\tfor (let i = 0; i < m; i++) U[i] = Vec.numberArray(0, nu);\n\t\tfor (let j = 0; j < n; j++) V[j] = Vec.numberArray(0, n);\n\t\tlet e:number[] = new Array(n);\n\t\tlet work:number[] = new Array(m);\n\t\tlet wantu = true, wantv = true;\n\n\t\tlet nct = Math.min(m - 1, n);\n\t\tlet nrt = Math.max(0, Math.min(n - 2, m));\n\t\tfor (let k = 0; k < Math.max(nct, nrt); k++)\n\t\t{\n\t\t\tif (k < nct)\n\t\t\t{\n\t\t\t\ts[k] = 0;\n\t\t\t\tfor (let i = k; i < m; i++) s[k] = SingularValueDecomposition.hypot(s[k], A[i][k]);\n\t\t\t\tif (s[k] != 0.0)\n\t\t\t\t{\n\t\t\t\t\tif (A[k][k] < 0.0) s[k] = -s[k];\n\t\t\t\t\tfor (let i = k; i < m; i++) A[i][k] /= s[k];\n\t\t\t\t\tA[k][k] += 1.0;\n\t\t\t\t}\n\t\t\t\ts[k] = -s[k];\n\t\t\t}\n\t\t\tfor (let j = k + 1; j < n; j++)\n\t\t\t{\n\t\t\t\tif ((k < nct) && (s[k] != 0.0))\n\t\t\t\t{\n\t\t\t\t\tlet t = 0;\n\t\t\t\t\tfor (let i = k; i < m; i++) t += A[i][k] * A[i][j];\n\t\t\t\t\tt = -t / A[k][k];\n\t\t\t\t\tfor (let i = k; i < m; i++) A[i][j] += t * A[i][k];\n\t\t\t\t}\n\t\t\t\te[j] = A[k][j];\n\t\t\t}\n\t\t\tif (wantu && (k < nct))\n\t\t\t{\n\t\t\t\tfor (let i = k; i < m; i++) U[i][k] = A[i][k];\n\t\t\t}\n\t\t\tif (k < nrt)\n\t\t\t{\n\t\t\t\te[k] = 0;\n\t\t\t\tfor (let i = k + 1; i < n; i++) e[k] = SingularValueDecomposition.hypot(e[k], e[i]);\n\t\t\t\tif (e[k] != 0.0)\n\t\t\t\t{\n\t\t\t\t\tif (e[k + 1] < 0.0) e[k] = -e[k];\n\t\t\t\t\tfor (let i = k + 1; i < n; i++) e[i] /= e[k];\n\t\t\t\t\te[k + 1] += 1.0;\n\t\t\t\t}\n\t\t\t\te[k] = -e[k];\n\t\t\t\tif ((k + 1 < m) && (e[k] != 0.0))\n\t\t\t\t{\n\t\t\t\t\tfor (let i = k + 1; i < m; i++) work[i] = 0.0;\n\t\t\t\t\tfor (let j = k + 1; j < n; j++) for (let i = k + 1; i < m; i++) work[i] += e[j] * A[i][j];\n\t\t\t\t\tfor (let j = k + 1; j < n; j++)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet t = -e[j] / e[k + 1];\n\t\t\t\t\t\tfor (let i = k + 1; i < m; i++) A[i][j] += t * work[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (wantv)\n\t\t\t\t{\n\t\t\t\t\tfor (let i = k + 1; i < n; i++) V[i][k] = e[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet p = Math.min(n, m + 1);\n\t\tif (nct < n) s[nct] = A[nct][nct];\n\t\tif (m < p) s[p - 1] = 0.0;\n\t\tif (nrt + 1 < p) e[nrt] = A[nrt][p - 1];\n\t\te[p - 1] = 0.0;\n\n\t\tif (wantu)\n\t\t{\n\t\t\tfor (let j = nct; j < nu; j++)\n\t\t\t{\n\t\t\t\tfor (let i = 0; i < m; i++) U[i][j] = 0.0;\n\t\t\t\tU[j][j] = 1.0;\n\t\t\t}\n\t\t\tfor (let k = nct - 1; k >= 0; k--)\n\t\t\t{\n\t\t\t\tif (s[k] != 0.0)\n\t\t\t\t{\n\t\t\t\t\tfor (let j = k + 1; j < nu; j++)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet t = 0;\n\t\t\t\t\t\tfor (let i = k; i < m; i++) t += U[i][k] * U[i][j];\n\t\t\t\t\t\tt = -t / U[k][k];\n\t\t\t\t\t\tfor (let i = k; i < m; i++) U[i][j] += t * U[i][k];\n\t\t\t\t\t}\n\t\t\t\t\tfor (let i = k; i < m; i++) U[i][k] = -U[i][k];\n\t\t\t\t\tU[k][k] = 1.0 + U[k][k];\n\t\t\t\t\tfor (let i = 0; i < k - 1; i++) U[i][k] = 0.0;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tfor (let i = 0; i < m; i++) U[i][k] = 0.0;\n\t\t\t\t\tU[k][k] = 1.0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (wantv)\n\t\t{\n\t\t\tfor (let k = n - 1; k >= 0; k--)\n\t\t\t{\n\t\t\t\tif ((k < nrt) && (e[k] != 0.0))\n\t\t\t\t{\n\t\t\t\t\tfor (let j = k + 1; j < nu; j++)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet t = 0;\n\t\t\t\t\t\tfor (let i = k + 1; i < n; i++) t += V[i][k] * V[i][j];\n\t\t\t\t\t\tt = -t / V[k + 1][k];\n\t\t\t\t\t\tfor (let i = k + 1; i < n; i++) V[i][j] += t * V[i][k];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (let i = 0; i < n; i++) V[i][k] = 0.0;\n\t\t\t\tV[k][k] = 1.0;\n\t\t\t}\n\t\t}\n\n\t\tlet pp = p - 1;\n\t\tlet iter = 0;\n\t\tlet eps = Math.pow(2.0, -52.0);\n\t\tlet tiny = Math.pow(2.0, -966.0);\n\t\twhile (p > 0)\n\t\t{\n\t\t\tlet k:number, kase:number;\n\t\t\tfor (k = p - 2; k >= -1; k--)\n\t\t\t{\n\t\t\t\tif (k == -1) break;\n\t\t\t\tif (Math.abs(e[k]) <= tiny + eps * (Math.abs(s[k]) + Math.abs(s[k + 1])))\n\t\t\t\t{\n\t\t\t\t\te[k] = 0.0;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (k == p - 2)\n\t\t\t{\n\t\t\t\tkase = 4;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet ks:number;\n\t\t\t\tfor (ks = p - 1; ks >= k; ks--)\n\t\t\t\t{\n\t\t\t\t\tif (ks == k) break;\n\t\t\t\t\tlet t = (ks != p ? Math.abs(e[ks]) : 0.) + (ks != k + 1 ? Math.abs(e[ks - 1]) : 0.);\n\t\t\t\t\tif (Math.abs(s[ks]) <= tiny + eps * t)\n\t\t\t\t\t{\n\t\t\t\t\t\ts[ks] = 0.0;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (ks == k) kase = 3;\n\t\t\t\telse if (ks == p - 1) kase = 1;\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tkase = 2;\n\t\t\t\t\tk = ks;\n\t\t\t\t}\n\t\t\t}\n\t\t\tk++;\n\n\t\t\tif (kase == 1)\n\t\t\t{\n\t\t\t\tlet f = e[p - 2];\n\t\t\t\te[p - 2] = 0.0;\n\t\t\t\tfor (let j = p - 2; j >= k; j--)\n\t\t\t\t{\n\t\t\t\t\tlet t = SingularValueDecomposition.hypot(s[j], f);\n\t\t\t\t\tlet cs = s[j] / t;\n\t\t\t\t\tlet sn = f / t;\n\t\t\t\t\ts[j] = t;\n\t\t\t\t\tif (j != k)\n\t\t\t\t\t{\n\t\t\t\t\t\tf = -sn * e[j - 1];\n\t\t\t\t\t\te[j - 1] = cs * e[j - 1];\n\t\t\t\t\t}\n\t\t\t\t\tif (wantv)\n\t\t\t\t\t{\n\t\t\t\t\t\tfor (let i = 0; i < n; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tt = cs * V[i][j] + sn * V[i][p - 1];\n\t\t\t\t\t\t\tV[i][p - 1] = -sn * V[i][j] + cs * V[i][p - 1];\n\t\t\t\t\t\t\tV[i][j] = t;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (kase == 2)\n\t\t\t{\n\t\t\t\tlet f = e[k - 1];\n\t\t\t\te[k - 1] = 0.0;\n\t\t\t\tfor (let j = k; j < p; j++)\n\t\t\t\t{\n\t\t\t\t\tlet t = SingularValueDecomposition.hypot(s[j], f);\n\t\t\t\t\tlet cs = s[j] / t;\n\t\t\t\t\tlet sn = f / t;\n\t\t\t\t\ts[j] = t;\n\t\t\t\t\tf = -sn * e[j];\n\t\t\t\t\te[j] = cs * e[j];\n\t\t\t\t\tif (wantu)\n\t\t\t\t\t{\n\t\t\t\t\t\tfor (let i = 0; i < m; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tt = cs * U[i][j] + sn * U[i][k - 1];\n\t\t\t\t\t\t\tU[i][k - 1] = -sn * U[i][j] + cs * U[i][k - 1];\n\t\t\t\t\t\t\tU[i][j] = t;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (kase == 3)\n\t\t\t{\n\t\t\t\tlet scale = Math.max(Math.max(Math.max(Math.max(Math.abs(s[p - 1]), Math.abs(s[p - 2])), Math.abs(e[p - 2])), Math.abs(s[k])), Math.abs(e[k]));\n\t\t\t\tlet sp = s[p - 1] / scale;\n\t\t\t\tlet spm1 = s[p - 2] / scale;\n\t\t\t\tlet epm1 = e[p - 2] / scale;\n\t\t\t\tlet sk = s[k] / scale;\n\t\t\t\tlet ek = e[k] / scale;\n\t\t\t\tlet b = ((spm1 + sp) * (spm1 - sp) + epm1 * epm1) / 2.0;\n\t\t\t\tlet c = (sp * epm1) * (sp * epm1);\n\t\t\t\tlet shift = 0.0;\n\t\t\t\tif ((b != 0.0) || (c != 0.0))\n\t\t\t\t{\n\t\t\t\t\tshift = Math.sqrt(b * b + c);\n\t\t\t\t\tif (b < 0.0) shift = -shift;\n\t\t\t\t\tshift = c / (b + shift);\n\t\t\t\t}\n\t\t\t\tlet f = (sk + sp) * (sk - sp) + shift;\n\t\t\t\tlet g = sk * ek;\n\n\t\t\t\tfor (let j = k; j < p - 1; j++)\n\t\t\t\t{\n\t\t\t\t\tlet t = SingularValueDecomposition.hypot(f, g);\n\t\t\t\t\tlet cs = f / t;\n\t\t\t\t\tlet sn = g / t;\n\t\t\t\t\tif (j != k) e[j - 1] = t;\n\t\t\t\t\tf = cs * s[j] + sn * e[j];\n\t\t\t\t\te[j] = cs * e[j] - sn * s[j];\n\t\t\t\t\tg = sn * s[j + 1];\n\t\t\t\t\ts[j + 1] = cs * s[j + 1];\n\t\t\t\t\tif (wantv)\n\t\t\t\t\t{\n\t\t\t\t\t\tfor (let i = 0; i < n; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tt = cs * V[i][j] + sn * V[i][j + 1];\n\t\t\t\t\t\t\tV[i][j + 1] = -sn * V[i][j] + cs * V[i][j + 1];\n\t\t\t\t\t\t\tV[i][j] = t;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tt = SingularValueDecomposition.hypot(f, g);\n\t\t\t\t\tcs = f / t;\n\t\t\t\t\tsn = g / t;\n\t\t\t\t\ts[j] = t;\n\t\t\t\t\tf = cs * e[j] + sn * s[j + 1];\n\t\t\t\t\ts[j + 1] = -sn * e[j] + cs * s[j + 1];\n\t\t\t\t\tg = sn * e[j + 1];\n\t\t\t\t\te[j + 1] = cs * e[j + 1];\n\t\t\t\t\tif (wantu && (j < m - 1))\n\t\t\t\t\t{\n\t\t\t\t\t\tfor (let i = 0; i < m; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tt = cs * U[i][j] + sn * U[i][j + 1];\n\t\t\t\t\t\t\tU[i][j + 1] = -sn * U[i][j] + cs * U[i][j + 1];\n\t\t\t\t\t\t\tU[i][j] = t;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\te[p - 2] = f;\n\t\t\t\titer = iter + 1;\n\t\t\t}\n\t\t\telse if (kase == 4)\n\t\t\t{\n\t\t\t\tif (s[k] <= 0.0)\n\t\t\t\t{\n\t\t\t\t\ts[k] = (s[k] < 0.0 ? -s[k] : 0.0);\n\t\t\t\t\tif (wantv)\n\t\t\t\t\t{\n\t\t\t\t\t\tfor (let i = 0; i <= pp; i++) V[i][k] = -V[i][k];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\twhile (k < pp)\n\t\t\t\t{\n\t\t\t\t\tif (s[k] >= s[k + 1]) break;\n\t\t\t\t\tlet t = s[k];\n\t\t\t\t\ts[k] = s[k + 1];\n\t\t\t\t\ts[k + 1] = t;\n\t\t\t\t\tif (wantv && (k < n - 1))\n\t\t\t\t\t{\n\t\t\t\t\t\tfor (let i = 0; i < n; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tt = V[i][k + 1];\n\t\t\t\t\t\t\tV[i][k + 1] = V[i][k];\n\t\t\t\t\t\t\tV[i][k] = t;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (wantu && (k < m - 1))\n\t\t\t\t\t{\n\t\t\t\t\t\tfor (let i = 0; i < m; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tt = U[i][k + 1];\n\t\t\t\t\t\t\tU[i][k + 1] = U[i][k];\n\t\t\t\t\t\t\tU[i][k] = t;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tk++;\n\t\t\t\t}\n\t\t\t\titer = 0;\n\t\t\t\tp--;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic getU():Matrix\n\t{\n\t\treturn Matrix.fromArray(this.U);\n\t}\n\tpublic getV():Matrix\n\t{\n\t\treturn Matrix.fromArray(this.V);\n\t}\n\tpublic getSingularValues():number[]\n\t{\n\t\treturn this.s;\n\t}\n\n\tpublic getS():Matrix\n\t{\n\t\tconst {n} = this;\n\t\tlet X = new Matrix(n, n, 0);\n\t\tlet S = X.A;\n\t\tfor (let i = 0; i < n; i++) S[i][i] = this.s[i];\n\t\treturn X;\n\t}\n\n\tpublic norm2():number\n\t{\n\t\treturn this.s[0];\n\t}\n\n\tpublic cond():number\n\t{\n\t\tconst {m, n, s} = this;\n\t\treturn s[0] / s[Math.min(m, n) - 1];\n\t}\n\n\tpublic rank():number\n\t{\n\t\tconst {m, n, s} = this;\n\t\tlet eps = Math.pow(2.0, -52.0);\n\t\tlet tol = Math.max(m, n) * s[0] * eps;\n\t\tlet r = 0;\n\t\tfor (let i = 0; i < s.length; i++) if (s[i] > tol) r++;\n\t\treturn r;\n\t}\n\n\tpublic static hypot(a:number, b:number):number\n\t{\n\t\tlet r;\n\t\tif (Math.abs(a) > Math.abs(b))\n\t\t{\n\t\t\tr = b / a;\n\t\t\tr = Math.abs(a) * Math.sqrt(1 + r * r);\n\t\t}\n\t\telse if (b != 0)\n\t\t{\n\t\t\tr = a / b;\n\t\t\tr = Math.abs(b) * Math.sqrt(1 + r * r);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tr = 0.0;\n\t\t}\n\t\treturn r;\n\t}\n}\n\n","/*\n\tWebMolKit\n\n\t(c) 2010-2019 Molecular Materials Informatics, Inc.\n\n\tAll rights reserved\n\n\thttp://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {norm2_xy, norm_xy, sqr} from './util';\nimport {Vec} from './Vec';\n\n/*\n\tDelaunay triangulator: takes a jumble of 2D points and converts them into a collection of triangles. This initially generates a collection of\n\ttriangles that adds up to the convex hull, but it is fairly straightforward to delete triangles in order to get to some kind of concave subset\n\tbased on a given threshold. From there, tracing the outline is routine.\n\n\tOriginal algorithm adapted from JavaScript implementation of \"Delaunator\" (https://github.com/mapbox/delaunator), which bears the following license:\n\n\t\tISC License\n\n\t\tCopyright (c) 2017, Mapbox\n\n\t\tPermission to use, copy, modify, and/or distribute this software for any purpose\n\t\twith or without fee is hereby granted, provided that the above copyright notice\n\t\tand this permission notice appear in all copies.\n\n\t\tTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\n\t\tREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND\n\t\tFITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\n\t\tINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS\n\t\tOF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER\n\t\tTORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF\n\t\tTHIS SOFTWARE.\n*/\n\nconst EPSILON = Math.pow(2, -52);\n\nexport class Triangulation2D\n{\n\tpublic sz:number;\n\tpublic numTriangles = 0;\n\tpublic triangles:number[];\n\tpublic halfedges:number[];\n\n\tprivate edgeStack = Vec.numberArray(0, 512);\n\tprivate hashSize:number;\n\tprivate hullPrev:number[];\n\tprivate hullNext:number[];\n\tprivate hullTri:number[];\n\tprivate hullHash:number[];\n\tprivate ids:number[];\n\tprivate dists:number[];\n\tprivate centreX:number;\n\tprivate centreY:number;\n\tprivate hullStart:number;\n\tprivate hull:number[] = null;\n\n\t// ------------ public methods ------------\n\n\t// starts up with an empty container\n\tconstructor(public px:number[], public py:number[])\n\t{\n\t\tthis.px = px;\n\t\tthis.py = py;\n\n\t\t// arrays that will store the triangulation graph\n\t\tthis.sz = px.length;\n\t\tlet maxTriangles = Math.max(2 * this.sz - 5, 0);\n\t\tthis.triangles = new Array(maxTriangles * 3);\n\t\tthis.halfedges = new Array(maxTriangles * 3);\n\n\t\t// temporary arrays for tracking the edges of the advancing convex hull\n\t\tthis.hashSize = Math.ceil(Math.sqrt(this.sz));\n\t\tthis.hullPrev = new Array(this.sz);\n\t\tthis.hullNext = new Array(this.sz);\n\t\tthis.hullTri = new Array(this.sz);\n\t\tthis.hullHash = Vec.numberArray(-1, this.hashSize);\n\n\t\t// temporary arrays for sorting points\n\t\tthis.ids = new Array(this.sz);\n\t\tthis.dists = new Array(this.sz);\n\n\t\tthis.update();\n\t}\n\n\t// iteratively goes through triangles and removes outer edges that are longer than the given threshold, which is a way of making it concave\n\tpublic trimConcave(threshold:number):number[]\n\t{\n\t\tconst threshSq = sqr(threshold);\n\n\t\tconst {sz, px, py} = this;\n\t\tlet tri = this.triangles.slice(0);\n\t\t\n\t\t// setup an edgelist, which we need for rapid tabulation\n\t\tlet edge:number[] = [];\n\t\tfor (let n = 0, i = 0; i < tri.length; n++, i += 3)\n\t\t{\n\t\t\tedge.push(sz * Math.min(tri[i + 0], tri[i + 1]) + Math.max(tri[i + 0], tri[i + 1]));\n\t\t\tedge.push(sz * Math.min(tri[i + 0], tri[i + 2]) + Math.max(tri[i + 0], tri[i + 2]));\n\t\t\tedge.push(sz * Math.min(tri[i + 1], tri[i + 2]) + Math.max(tri[i + 1], tri[i + 2]));\n\t\t}\n\t\tlet uniqueEdges = Vec.uniqueUnstable(edge);\n\t\tfor (let n = 0; n < edge.length; n++) edge[n] = uniqueEdges.indexOf(edge[n]);\n\t\t\n\t\tlet edgeCount:number[] = new Array(edge.length);\n\n\t\twhile (true)\n\t\t{\n\t\t\tconst ntri = tri.length / 3;\n\n\t\t\t// count the # of instances per edge\n\t\t\tedgeCount.fill(0);\n\t\t\tfor (let n = 0, i = 0; n < ntri; n++, i += 3)\n\t\t\t{\n\t\t\t\tedgeCount[edge[i + 0]]++;\n\t\t\t\tedgeCount[edge[i + 1]]++;\n\t\t\t\tedgeCount[edge[i + 2]]++;\n\t\t\t}\n\n\t\t\t// any triangle that has one long unique (outer) edge gets the chop\n\t\t\tlet mask = Vec.booleanArray(true, ntri);\n\t\t\tfor (let n = 0, i = 0; n < ntri; n++, i += 3)\n\t\t\t{\n\t\t\t\tconst c1 = edgeCount[edge[i + 0]];\n\t\t\t\tconst c2 = edgeCount[edge[i + 1]];\n\t\t\t\tconst c3 = edgeCount[edge[i + 2]];\n\t\t\t\tconst i1 = tri[i], i2 = tri[i + 1], i3 = tri[i + 2];\n\n\t\t\t\tif (c1 == 1 && c2 != 1 && c3 != 1) mask[n] = norm2_xy(px[i1] - px[i2], py[i1] - py[i2]) < threshSq;\n\t\t\t\telse if (c1 != 1 && c2 == 1 && c3 != 1) mask[n] = norm2_xy(px[i1] - px[i3], py[i1] - py[i3]) < threshSq;\n\t\t\t\telse if (c1 != 1 && c2 != 1 && c3 == 1) mask[n] = norm2_xy(px[i2] - px[i3], py[i2] - py[i3]) < threshSq;\n\t\t\t}\n\n\t\t\tif (Vec.allTrue(mask)) break;\n\n\t\t\t// create a smaller version\n\t\t\tlet repTri:number[] = new Array(Vec.maskCount(mask) * 3);\n\t\t\tlet repEdge:number[] = new Array(Vec.maskCount(mask) * 3);\n\t\t\tfor (let n = 0, i = 0, j = 0, k = 0; n < ntri; n++, i += 3) if (mask[n])\n\t\t\t{\n\t\t\t\trepTri[j++] = tri[i];\n\t\t\t\trepTri[j++] = tri[i + 1];\n\t\t\t\trepTri[j++] = tri[i + 2];\n\t\t\t\trepEdge[k++] = edge[i];\n\t\t\t\trepEdge[k++] = edge[i + 1];\n\t\t\t\trepEdge[k++] = edge[i + 2];\n\t\t\t}\n\t\t\ttri = repTri;\n\t\t\tedge = repEdge;\n\t\t}\n\n\t\treturn tri;\n\t}\n\n\t// finds the set of points that traces the outline; the triangles can either be the original set (convex) or the trimmed set (concave)\n\tpublic traceOutline(tri:number[]):number[]\n\t{\n\t\tconst npt = tri.length, ntri = npt / 3;\n\t\tconst {sz, px, py} = this;\n\n\t\tlet edgeCount = new Map<number, number>();\n\n\t\t// count the # of instances per edge\n\t\tfor (let n = 0, i = 0; n < ntri; n++, i += 3)\n\t\t{\n\t\t\tconst e1 = sz * Math.min(tri[i + 0], tri[i + 1]) + Math.max(tri[i + 0], tri[i + 1]);\n\t\t\tconst e2 = sz * Math.min(tri[i + 0], tri[i + 2]) + Math.max(tri[i + 0], tri[i + 2]);\n\t\t\tconst e3 = sz * Math.min(tri[i + 1], tri[i + 2]) + Math.max(tri[i + 1], tri[i + 2]);\n\t\t\tedgeCount.set(e1, (edgeCount.get(e1) || 0) + 1);\n\t\t\tedgeCount.set(e2, (edgeCount.get(e2) || 0) + 1);\n\t\t\tedgeCount.set(e3, (edgeCount.get(e3) || 0) + 1);\n\t\t}\n\n\t\t// collect the unique (outer) edges\n\t\tlet edgePairs:number[] = [];\n\t\tfor (let entry of edgeCount.entries()) if (entry[1] == 1)\n\t\t{\n\t\t\tconst e = entry[0];\n\t\t\tconst i1 = Math.floor(e / sz), i2 = e % sz;\n\t\t\tedgePairs.push(i1);\n\t\t\tedgePairs.push(i2);\n\t\t}\n\n\t\t// list the constituent indices, and make a divalent graph\n\t\tconst idx = Vec.uniqueUnstable(edgePairs);\n\t\tconst isz = idx.length;\n\t\tconst idxMap = new Map<number, number>();\n\t\tfor (let n = 0; n < isz; n++) idxMap.set(idx[n], n);\n\t\tlet g1 = Vec.numberArray(-1, isz), g2 = Vec.numberArray(-1, isz);\n\t\tfor (let n = 0; n < edgePairs.length; n += 2)\n\t\t{\n\t\t\t//int i1 = Arrays.binarySearch(idx, edges.get(n)), i2 = Arrays.binarySearch(idx, edges.get(n + 1));\n\t\t\tconst i1 = idxMap.get(edgePairs[n]), i2 = idxMap.get(edgePairs[n + 1]);\n\t\t\tif (g1[i1] < 0) g1[i1] = i2; else g2[i1] = i2;\n\t\t\tif (g1[i2] < 0) g1[i2] = i1; else g2[i2] = i1;\n\t\t}\n\n\t\t// pick a starting point and walk around the divalent graph\n\t\tlet mask = Vec.booleanArray(false, isz);\n\t\tlet sequence = new Array(isz);\n\t\tsequence[0] = 0;\n\t\tmask[0] = true;\n\t\tfor (let n = 1; n < isz; n++)\n\t\t{\n\t\t\tconst i = sequence[n - 1];\n\t\t\tif (!mask[g1[i]]) sequence[n] = g1[i]; else sequence[n] = g2[i];\n\t\t\tmask[sequence[n]] = true;\n\t\t}\n\t\treturn Vec.idxGet(idx, sequence);\n\t}\n\n\t// ------------ private methods ------------\n\n\tprivate update():void\n\t{\n\t\tconst sz = this.sz;\n\t\tlet {px, py, ids, dists, triangles, halfedges} = this;\n\n\t\tconst minX = Vec.min(px), minY = Vec.min(py);\n\t\tconst maxX = Vec.max(px), maxY = Vec.max(py);\n\t\tfor (let n = 0; n < sz; n++) ids[n] = n;\n\n\t\tthis.centreX = 0.5 * (minX + maxX);\n\t\tthis.centreY = 0.5 * (minY + maxY);\n\t\tlet i0 = 0, i1 = 0, i2 = 0;\n\n\t\t// pick a seed point close to the center\n\t\tlet minDist = Number.POSITIVE_INFINITY;\n\t\tfor (let n = 0; n < sz; n++)\n\t\t{\n\t\t\tconst d = norm_xy(this.centreX - px[n], this.centreY - py[n]);\n\t\t\tif (d < minDist)\n\t\t\t{\n\t\t\t\ti0 = n;\n\t\t\t\tminDist = d;\n\t\t\t}\n\t\t}\n\t\tconst i0x = px[i0], i0y = py[i0];\n\n\t\tminDist = Number.POSITIVE_INFINITY;\n\n\t\t// find the point closest to the seed\n\t\tfor (let n = 0; n < sz; n++)\n\t\t{\n\t\t\tif (n == i0) continue;\n\t\t\tconst d = norm_xy(i0x - px[n], i0y - py[n]);\n\t\t\tif (d < minDist && d > 0)\n\t\t\t{\n\t\t\t\ti1 = n;\n\t\t\t\tminDist = d;\n\t\t\t}\n\t\t}\n\t\tlet i1x = px[i1], i1y = py[i1];\n\n\t\t// find the third point which forms the smallest circumcircle with the first two\n\t\tlet minRadius = Number.POSITIVE_INFINITY;\n\t\tfor (let n = 0; n < sz; n++)\n\t\t{\n\t\t\tif (n == i0 || n == i1) continue;\n\t\t\tlet r = this.circumRadius(i0x, i0y, i1x, i1y, px[n], py[n]);\n\t\t\tif (r < minRadius)\n\t\t\t{\n\t\t\t\ti2 = n;\n\t\t\t\tminRadius = r;\n\t\t\t}\n\t\t}\n\t\tlet i2x = px[i2], i2y = py[i2];\n\n\t\tif (!Number.isFinite(minRadius))\n\t\t{\n\t\t\t// order co-linear points by dx (or dy if all x are identical) and return the list as a hull\n\t\t\tfor (let n = 0; n < sz; n++)\n\t\t\t{\n\t\t\t\tdists[n] = px[n] - px[0];\n\t\t\t\tif (dists[n] == 0) dists[n] = py[n] - py[0];\n\t\t\t}\n\t\t\tthis.quicksort(0, sz - 1);\n\t\t\tlet hull = new Array(sz);\n\t\t\tlet j = 0;\n\t\t\tlet d0 = Number.NEGATIVE_INFINITY;\n\t\t\tfor (let n = 0; n < sz; n++)\n\t\t\t{\n\t\t\t\tlet id = ids[n];\n\t\t\t\tif (dists[id] > d0)\n\t\t\t\t{\n\t\t\t\t\thull[j++] = id;\n\t\t\t\t\td0 = dists[id];\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.hull = hull.slice(0, j);\n\t\t\ttriangles = [];\n\t\t\thalfedges = [];\n\t\t\treturn;\n\t\t}\n\n\t\t// swap the order of the seed points for counter-clockwise orientation\n\t\tif (this.orient(i0x, i0y, i1x, i1y, i2x, i2y))\n\t\t{\n\t\t\tlet i = i1;\n\t\t\tlet x = i1x, y = i1y;\n\t\t\ti1 = i2;\n\t\t\ti1x = i2x;\n\t\t\ti1y = i2y;\n\t\t\ti2 = i;\n\t\t\ti2x = x;\n\t\t\ti2y = y;\n\t\t}\n\n\t\tthis.pickCircumCentre(i0x, i0y, i1x, i1y, i2x, i2y);\n\n\t\tfor (let n = 0; n < sz; n++) dists[n] = norm_xy(px[n] - this.centreX, py[n] - this.centreY);\n\n\t\t// sort the points by distance from the seed triangle circumcenter\n\t\tthis.quicksort(0, sz - 1);\n\n\t\t// set up the seed triangle as the starting hull\n\t\tthis.hullStart = i0;\n\t\tlet hullSize = 3;\n\n\t\tconst {hullNext, hullPrev, hullTri, hullHash, hashSize} = this;\n\n\t\thullNext[i0] = hullPrev[i2] = i1;\n\t\thullNext[i1] = hullPrev[i0] = i2;\n\t\thullNext[i2] = hullPrev[i1] = i0;\n\n\t\thullTri[i0] = 0;\n\t\thullTri[i1] = 1;\n\t\thullTri[i2] = 2;\n\n\t\thullHash.fill(-1);\n\t\thullHash[this.hashKey(i0x, i0y)] = i0;\n\t\thullHash[this.hashKey(i1x, i1y)] = i1;\n\t\thullHash[this.hashKey(i2x, i2y)] = i2;\n\n\t\tthis.numTriangles = 0;\n\t\tthis.addTriangle(i0, i1, i2, -1, -1, -1);\n\n\t\tlet xp = 0, yp = 0;\n\t\tfor (let k = 0; k < ids.length; k++)\n\t\t{\n\t\t\tlet i = ids[k];\n\t\t\tlet x = px[i], y = py[i];\n\n\t\t\t// skip near-duplicate points\n\t\t\tif (k > 0 && Math.abs(x - xp) <= EPSILON && Math.abs(y - yp) <= EPSILON) continue;\n\t\t\txp = x;\n\t\t\typ = y;\n\n\t\t\t// skip seed triangle points\n\t\t\tif (i == i0 || i == i1 || i == i2) continue;\n\n\t\t\t// find a visible edge on the convex hull using edge hash\n\t\t\tlet start = 0;\n\t\t\tfor (let j = 0, key = this.hashKey(x, y); j < hashSize; j++)\n\t\t\t{\n\t\t\t\tstart = hullHash[(key + j) % hashSize];\n\t\t\t\tif (start >= 0 && start != hullNext[start]) break;\n\t\t\t}\n\n\t\t\tstart = hullPrev[start];\n\t\t\tlet e = start, q = hullNext[e];\n\t\t\twhile (!this.orient(x, y, px[e], py[e], px[q], py[q]))\n\t\t\t{\n\t\t\t\te = q;\n\t\t\t\tif (e == start)\n\t\t\t\t{\n\t\t\t\t\te = -1;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tq = hullNext[e];\n\t\t\t}\n\t\t\tif (e < 0) continue; // likely a near-duplicate point; skip it\n\n\t\t\t// add the first triangle from the point\n\t\t\tlet t = this.addTriangle(e, i, hullNext[e], -1, -1, hullTri[e]);\n\n\t\t\t// recursively flip triangles from the point until they satisfy the Delaunay condition\n\t\t\thullTri[i] = this.legalise(t + 2);\n\t\t\thullTri[e] = t; // keep track of boundary triangles on the hull\n\t\t\thullSize++;\n\n\t\t\t// walk forward through the hull, adding more triangles and flipping recursively\n\t\t\tlet n = hullNext[e];\n\t\t\tq = hullNext[n];\n\t\t\twhile (this.orient(x, y, px[n], py[n], px[q], py[q]))\n\t\t\t{\n\t\t\t\tt = this.addTriangle(n, i, q, hullTri[i], -1, hullTri[n]);\n\t\t\t\thullTri[i] = this.legalise(t + 2);\n\t\t\t\thullNext[n] = n; // mark as removed\n\t\t\t\thullSize--;\n\t\t\t\tn = q;\n\t\t\t\tq = hullNext[n];\n\t\t\t}\n\n\t\t\t// walk backward from the other side, adding more triangles and flipping\n\t\t\tif (e == start)\n\t\t\t{\n\t\t\t\tq = hullPrev[e];\n\t\t\t\twhile (this.orient(x, y, px[q], py[q], px[e], py[e]))\n\t\t\t\t{\n\t\t\t\t\tt = this.addTriangle(q, i, e, -1, hullTri[e], hullTri[q]);\n\t\t\t\t\tthis.legalise(t + 2);\n\t\t\t\t\thullTri[q] = t;\n\t\t\t\t\thullNext[e] = e; // mark as removed\n\t\t\t\t\thullSize--;\n\t\t\t\t\te = q;\n\t\t\t\t\tq = hullPrev[e];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// update the hull indices\n\t\t\tthis.hullStart = hullPrev[i] = e;\n\t\t\thullNext[e] = hullPrev[n] = i;\n\t\t\thullNext[i] = n;\n\n\t\t\t// save the two new edges in the hash table\n\t\t\thullHash[this.hashKey(x, y)] = i;\n\t\t\thullHash[this.hashKey(px[e], py[e])] = e;\n\t\t}\n\n\t\tthis.hull = new Array(hullSize);\n\t\tfor (let n = 0, e = this.hullStart; n < hullSize; n++)\n\t\t{\n\t\t\tthis.hull[n] = e;\n\t\t\te = hullNext[e];\n\t\t}\n\n\t\t// trim typed triangle mesh arrays\n\t\tthis.triangles = triangles.slice(0, this.numTriangles);\n\t\tthis.halfedges = halfedges.slice(0, this.numTriangles);\n\t}\n\n\tprivate hashKey(x:number, y:number):number\n\t{\n\t\treturn Math.floor(this.pseudoAngle(x - this.centreX, y - this.centreY) * this.hashSize) % this.hashSize;\n\t}\n\n\tprivate legalise(a:number):number\n\t{\n\t\tlet i = 0;\n\t\tlet ar = 0;\n\n\t\t// recursion eliminated with a fixed-size stack\n\t\twhile (true)\n\t\t{\n\t\t\tlet b = this.halfedges[a];\n\n\t\t\t/* if the pair of triangles doesn't satisfy the Delaunay condition\n\t\t\t * (p1 is inside the circumcircle of [p0, pl, pr]), flip them,\n\t\t\t * then do the same check/flip recursively for the new pair of triangles\n\t\t\t *\n\t\t\t *           pl                    pl\n\t\t\t *          /||\\                  /  \\\n\t\t\t *       al/ || \\bl            al/    \\a\n\t\t\t *        /  ||  \\              /      \\\n\t\t\t *       /  a||b  \\    flip    /___ar___\\\n\t\t\t *     p0\\   ||   /p1   =>   p0\\---bl---/p1\n\t\t\t *        \\  ||  /              \\      /\n\t\t\t *       ar\\ || /br             b\\    /br\n\t\t\t *          \\||/                  \\  /\n\t\t\t *           pr                    pr\n\t\t\t */\n\t\t\tlet a0 = a - a % 3;\n\t\t\tar = a0 + (a + 2) % 3;\n\n\t\t\tif (b < 0) // convex hull edge\n\t\t\t{\n\t\t\t\tif (i == 0) break;\n\t\t\t\ta = this.edgeStack[--i];\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst b0 = b - b % 3;\n\t\t\tconst al = a0 + (a + 1) % 3;\n\t\t\tconst bl = b0 + (b + 2) % 3;\n\n\t\t\tconst {px, py, triangles, halfedges} = this;\n\t\t\tconst p0 = triangles[ar];\n\t\t\tconst pr = triangles[a];\n\t\t\tconst pl = triangles[al];\n\t\t\tconst p1 = triangles[bl];\n\n\t\t\tlet illegal = this.inCircle(px[p0], py[p0], px[pr], py[pr], px[pl], py[pl], px[p1], py[p1]);\n\n\t\t\tif (illegal)\n\t\t\t{\n\t\t\t\tthis.triangles[a] = p1;\n\t\t\t\tthis.triangles[b] = p0;\n\n\t\t\t\tconst hbl = halfedges[bl];\n\n\t\t\t\t// edge swapped on the other side of the hull (rare); fix the halfedge reference\n\t\t\t\tif (hbl < 0)\n\t\t\t\t{\n\t\t\t\t\tlet e = this.hullStart;\n\t\t\t\t\tdo\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.hullTri[e] == bl)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.hullTri[e] = a;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\te = this.hullPrev[e];\n\t\t\t\t\t}\n\t\t\t\t\twhile (e != this.hullStart);\n\t\t\t\t}\n\t\t\t\tthis.link(a, hbl);\n\t\t\t\tthis.link(b, halfedges[ar]);\n\t\t\t\tthis.link(ar, bl);\n\n\t\t\t\tconst br = b0 + (b + 1) % 3;\n\n\t\t\t\t// don't worry about hitting the cap: it can only happen on extremely degenerate input\n\t\t\t\tif (i < this.edgeStack.length) this.edgeStack[i++] = br;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (i == 0) break;\n\t\t\t\ta = this.edgeStack[--i];\n\t\t\t}\n\t\t}\n\n\t\treturn ar;\n\t}\n\n\tprivate link(a:number, b:number):void\n\t{\n\t\tthis.halfedges[a] = b;\n\t\tif (b >= 0) this.halfedges[b] = a;\n\t}\n\n\t // add a new triangle given vertex indices and adjacent half-edge ids\n\tprivate addTriangle(i0:number, i1:number, i2:number, a:number, b:number, c:number):number\n\t{\n\t\tconst t = this.numTriangles;\n\t\tthis.triangles[t] = i0;\n\t\tthis.triangles[t + 1] = i1;\n\t\tthis.triangles[t + 2] = i2;\n\t\tthis.link(t, a);\n\t\tthis.link(t + 1, b);\n\t\tthis.link(t + 2, c);\n\t\tthis.numTriangles += 3;\n\t\treturn t;\n\t}\n\n\t// monotonically increases with real angle, but doesn't need expensive trigonometry\n\tprivate pseudoAngle(dx:number, dy:number):number\n\t{\n\t\tconst p = dx / (Math.abs(dx) + Math.abs(dy));\n\t\treturn (dy > 0 ? 3 - p : 1 + p) / 4; // [0..1]\n\t}\n\n\t// return 2d orientation sign if we're confident in it through J. Shewchuk's error bound check\n\tprivate orientIfSure(px:number, py:number, rx:number, ry:number, qx:number, qy:number):number\n\t{\n\t\tconst l = (ry - py) * (qx - px);\n\t\tconst r = (rx - px) * (qy - py);\n\t\treturn Math.abs(l - r) >= 3.3306690738754716e-16 * Math.abs(l + r) ? l - r : 0;\n\t}\n\n\t// a more robust orientation test that's stable in a given triangle (to fix robustness issues)\n\tprivate orient(rx:number, ry:number, qx:number, qy:number, px:number, py:number):boolean\n\t{\n\t\tlet o = this.orientIfSure(px, py, rx, ry, qx, qy);\n\t\tif (o != 0) return o < 0;\n\t\to = this.orientIfSure(rx, ry, qx, qy, px, py);\n\t\tif (o != 0) return o < 0;\n\t\to = this.orientIfSure(qx, qy, px, py, rx, ry);\n\t\treturn o < 0;\n\t}\n\n\tprivate inCircle(ax:number, ay:number, bx:number, by:number, cx:number, cy:number, px:number, py:number):boolean\n\t{\n\t\tconst dx = ax - px;\n\t\tconst dy = ay - py;\n\t\tconst ex = bx - px;\n\t\tconst ey = by - py;\n\t\tconst fx = cx - px;\n\t\tconst fy = cy - py;\n\n\t\tconst ap = dx * dx + dy * dy;\n\t\tconst bp = ex * ex + ey * ey;\n\t\tconst cp = fx * fx + fy * fy;\n\n\t\treturn dx * (ey * cp - bp * fy) -\n\t\t\t   dy * (ex * cp - bp * fx) +\n\t\t\t   ap * (ex * fy - ey * fx) < 0;\n\t}\n\n\tprivate circumRadius(ax:number, ay:number, bx:number, by:number, cx:number, cy:number):number\n\t{\n\t\tconst dx = bx - ax;\n\t\tconst dy = by - ay;\n\t\tconst ex = cx - ax;\n\t\tconst ey = cy - ay;\n\n\t\tconst bl = dx * dx + dy * dy;\n\t\tconst cl = ex * ex + ey * ey;\n\t\tconst d = 0.5 / (dx * ey - dy * ex);\n\n\t\tconst x = (ey * bl - dy * cl) * d;\n\t\tconst y = (dx * cl - ex * bl) * d;\n\n\t\treturn x * x + y * y;\n\t}\n\n\tprivate pickCircumCentre(ax:number, ay:number, bx:number, by:number, cx:number, cy:number):void\n\t{\n\t\tconst dx = bx - ax;\n\t\tconst dy = by - ay;\n\t\tconst ex = cx - ax;\n\t\tconst ey = cy - ay;\n\n\t\tconst bl = dx * dx + dy * dy;\n\t\tconst cl = ex * ex + ey * ey;\n\t\tconst d = 0.5 / (dx * ey - dy * ex);\n\n\t\tthis.centreX = ax + (ey * bl - dy * cl) * d;\n\t\tthis.centreY = ay + (dx * cl - ex * bl) * d;\n\t}\n\n\tprivate quicksort(left:number, right:number):void\n\t{\n\t\tconst {ids, dists} = this;\n\t\tif (right - left <= 20)\n\t\t{\n\t\t\tfor (let i = left + 1; i <= right; i++)\n\t\t\t{\n\t\t\t\tconst temp = ids[i];\n\t\t\t\tconst tempDist = dists[temp];\n\t\t\t\tlet j = i - 1;\n\t\t\t\twhile (j >= left && dists[ids[j]] > tempDist) ids[j + 1] = ids[j--];\n\t\t\t\tids[j + 1] = temp;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet median = (left + right) >> 1;\n\t\t\tlet i = left + 1;\n\t\t\tlet j = right;\n\t\t\tVec.swap(ids, median, i);\n\t\t\tif (dists[ids[left]] > dists[ids[right]]) Vec.swap(ids, left, right);\n\t\t\tif (dists[ids[i]] > dists[ids[right]]) Vec.swap(ids, i, right);\n\t\t\tif (dists[ids[left]] > dists[ids[i]]) Vec.swap(ids, left, i);\n\n\t\t\tlet temp = ids[i];\n\t\t\tconst tempDist = dists[temp];\n\t\t\twhile (true)\n\t\t\t{\n\t\t\t\tdo i++; while (dists[ids[i]] < tempDist);\n\t\t\t\tdo j--; while (dists[ids[j]] > tempDist);\n\t\t\t\tif (j < i) break;\n\t\t\t\tVec.swap(ids, i, j);\n\t\t\t}\n\t\t\tids[left + 1] = ids[j];\n\t\t\tids[j] = temp;\n\n\t\t\tif (right - i + 1 >= j - left)\n\t\t\t{\n\t\t\t\tthis.quicksort(i, right);\n\t\t\t\tthis.quicksort(left, j - 1);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.quicksort(left, j - 1);\n\t\t\t\tthis.quicksort(i, right);\n\t\t\t}\n\t\t}\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Matrix, SingularValueDecomposition} from './Matrix';\nimport {Triangulation2D} from './Triangulation2D';\nimport {angleDiff, angleDiffPos, angleNorm, maxArray, minArray, norm2_xy, norm_xy, realEqual, sqr, TWOPI} from './util';\nimport {Vec} from './Vec';\n\n/*\n\tGeometry utilities, which are typically graphics related.\n*/\n\nexport interface Spline\n{\n\tpx:number[];\n\tpy:number[];\n\tctrl:boolean[];\n}\n\nexport class GeomUtil\n{\n\t// static: returns true if the point (x,y) is inside the given polygon (px,py)\n\tpublic static pointInPolygon(x:number, y:number, px:number[], py:number[]):boolean\n\t{\n\t\tif (x < minArray(px) || x > maxArray(px) || y < minArray(py) || y > maxArray(py)) return false;\n\t\tlet sz = px.length;\n\t\tfor (let n = 0; n < sz; n++) if (px[n] == x && py[n] == y) return true; // point is on a vertex\n\n\t\tlet phase = false;\n\n\t\tfor (let n = 0; n < sz; n++)\n\t\t{\n\t\t\tlet x1 = px[n], y1 = py[n], x2 = px[n + 1 < sz ? n + 1 : 0], y2 = py[n + 1 < sz ? n + 1 : 0];\n\t\t\tif (y > Math.min(y1, y2) && y <= Math.max(y1, y2) && x <= Math.max(x1, x2) && y1 != y2)\n\t\t\t{\n\t\t\t\tlet intr = (y - y1) * (x2 - x1) / (y2 - y1) + x1;\n\t\t\t\tif (x1 == x2 || x <= intr) phase = !phase;\n\t\t\t}\n\t\t}\n\n\t\treturn phase;\n\t}\n\n\t// returns true if the lines L1-->L2 and L3-->L4 are parallel or anti-parallel, i.e. they can never intersect; note that\n\t// this still returns true if the lines are actually on top of each other; note that this is for lines, not line segments\n\tpublic static areLinesParallel(x1:number, y1:number, x2:number, y2:number, x3:number, y3:number, x4:number, y4:number):boolean\n\t{\n\t\tlet dxa = x2 - x1, dya = y2 - y1, dxb = x4 - x3, dyb = y4 - y3;\n\t\tlet xmajorA = Math.abs(dxa) > Math.abs(dya), xmajorB = Math.abs(dxb) > Math.abs(dyb);\n\t\tif (xmajorA != xmajorB) return false;\n\t\tconst EPS = 1E-6;\n\t\tif (xmajorA)\n\t\t\treturn Math.abs(dya / dxa - dyb / dxb) < EPS;\n\t\telse\n\t\t\treturn Math.abs(dxa / dya - dxb / dyb) < EPS;\n\t}\n\n\t// for the lines L1-->L2 and L3-->L4, calculate and return the intersection; note that this for lines, not line segments;\n\t// the return value is an array of {x,y}; note that the answer will be garbage if the lines are parallel\n\tpublic static lineIntersect(x1:number, y1:number, x2:number, y2:number, x3:number, y3:number, x4:number, y4:number):number[]\n\t{\n\t\tlet u = ((x4 - x3) * (y1 - y3) - (y4 - y3) * (x1 - x3)) / ((y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1));\n\t\treturn [x1 + u * (x2 - x1), y1 + u * (y2 - y1)];\n\t}\n\n\t// returns true if the point is on the line segment, within numerical precision\n\tpublic static isPointOnLineSeg(px:number, py:number, x1:number, y1:number, x2:number, y2:number):boolean\n\t{\n\t\tif (px < Math.min(x1, x2) || px > Math.max(x1, x2) || py < Math.min(y1, y2) || py > Math.max(y1, y2)) return false;\n\t\tif ((px == x1 && py == y1) || (px == x2 && py == y2)) return true;\n\t\tlet dx = x2 - x1, dy = y2 - y1;\n\t\tif (Math.abs(dx) > Math.abs(dy)) return realEqual(py, (dy / dx) * (px - x1) + y1);\n\t\telse return realEqual(px, (dx / dy) * (py - y1) + x1);\n\t}\n\n\t// returns the distance from the point to the closest location on the indicated line\n\tpublic static pointLineDistance(px:number, py:number, x1:number, y1:number, x2:number, y2:number):number\n\t{\n\t\tlet dx = x2 - x1, dy = y2 - y1;\n\t\treturn Math.abs(dy * px - dx * py + x2 * y1 - y2 * x1) / norm_xy(dx, dy);\n\t}\n\n\t// returns the shortest distance from the point to the line segment\n\tpublic static pointLineSegDistance(px:number, py:number, x1:number, y1:number, x2:number, y2:number):number\n\t{\n\t\tlet dx = x2 - x1, dy = y2 - y1;\n\t\tlet t = ((px - x1) * dx + (py - y1) * dy) / norm2_xy(dx, dy); // t=position along the line to which the point is orthogonal\n\t\tt = Math.max(0, Math.min(1, t));\n\t\tlet tx = x1 + t * dx, ty = y1 + t * dy;\n\t\treturn norm_xy(px - tx, py - ty);\n\t}\n\n\t// tests the two line segments L1-->L2 and L3-->L4 for intersection, and returns true if they do\n\t// !! methinks this is almost correct, but there might be a boundary flaw\n\tpublic static doLineSegsIntersect(x1:number, y1:number, x2:number, y2:number, x3:number, y3:number, x4:number, y4:number):boolean\n\t{\n\t\tif (Math.max(x1, x2) < Math.min(x3, x4) || Math.max(y1, y2) < Math.min(y3, y4)) return false;\n\t\tif (Math.min(x1, x2) > Math.max(x3, x4) || Math.min(y1, y2) > Math.max(y3, y4)) return false;\n\t\tif ((x1 == x3 && y1 == y3) || (x1 == x4 && y1 == y4) || (x2 == x3 && y2 == y3) || (x2 == x4 && y2 == y4)) return true;\n\t\tif ((x1 == x2 || x3 == x4) && (x1 == x3 || x1 == x4 || x2 == x3 || x2 == x4)) return true;\n\t\tif ((y1 == y2 || y3 == y4) && (y1 == y3 || y1 == y4 || y2 == y3 || y2 == y4)) return true;\n\n\t\tlet x4_x3 = x4 - x3, y4_y3 = y4 - y3, x2_x1 = x2 - x1, y2_y1 = y2 - y1, x1_x3 = x1 - x3, y1_y3 = y1 - y3;\n\n\t\tlet nx = x4_x3 * y1_y3 - y4_y3 * x1_x3;\n\t\tlet ny = x2_x1 * y1_y3 - y2_y1 * x1_x3;\n\t\tlet dn = y4_y3 * x2_x1 - x4_x3 * y2_y1;\n\n\t\tif (dn == 0) return false;\n\t\tif (dn < 0)\n\t\t{\n\t\t\tdn = -dn;\n\t\t\tnx = -nx;\n\t\t\tny = -ny;\n\t\t}\n\t\treturn nx >= 0 && nx <= dn && ny >= 0 && ny <= dn;\n\t}\n\n\t// true if the two rectangles share any intersection\n\tpublic static rectsIntersect(x1:number, y1:number, w1:number, h1:number, x2:number, y2:number, w2:number, h2:number):boolean\n\t{\n\t\tif (x1 <= x2 && x1 + w1 >= x2 + w2 && y1 <= y2 && y1 + h1 >= y2 + h2) return true;\n\t\tif (x2 <= x1 && x2 + w2 >= x1 + w1 && y2 <= y1 && y2 + h2 >= y1 + h1) return true;\n\t\tif (x1 + w1 < x2 || x2 + w2 < x1 || y1 + h1 < y2 || y2 + h2 < y1) return false;\n\t\treturn true;\n\t}\n\n\t// for an array of angles (in radians), sorts them in order; then, rotates the array around as many times as is necessary\n\t// so that the difference between the first & last angles is >= than the difference between the first & second\n\tpublic static sortAngles(theta:number[]):number[]\n\t{\n\t\tif (theta == null || theta.length < 2) return theta;\n\t\ttheta = theta.slice(0);\n\t\tfor (let n = 0; n < theta.length; n++) theta[n] = angleNorm(theta[n]);\n\n\t\tif (theta.length == 2)\n\t\t{\n\t\t\tif (angleDiffPos(theta[1], theta[0]) > Math.PI) return [theta[1], theta[0]];\n\t\t\treturn theta;\n\t\t}\n\n\t\tVec.sort(theta);\n\t\twhile (true)\n\t\t{\n\t\t\tlet a = theta[theta.length - 1], b = theta[0], c = theta[1];\n\t\t\tif (angleDiff(b, a) <= angleDiff(c, b)) break;\n\t\t\tfor (let n = theta.length - 1; n > 0; n--) theta[n] = theta[n - 1];\n\t\t\ttheta[0] = a;\n\t\t}\n\t\treturn theta;\n\t}\n\n\t// sorts angles as above, except returns indices rather than values\n\tpublic static idxSortAngles(theta:number[]):number[]\n\t{\n\t\tconst sz = Vec.len(theta);\n\t\tif (theta == null || sz < 2) return Vec.identity0(sz);\n\n\t\tif (sz == 2)\n\t\t{\n\t\t\tif (angleDiffPos(theta[1], theta[0]) > Math.PI) return [1, 0]; else return [0, 1];\n\t\t}\n\n\t\ttheta = Vec.duplicate(theta);\n\t\tfor (let n = 0; n < sz; n++) theta[n] = angleNorm(theta[n]);\n\t\tlet idx = Vec.idxSort(theta);\n\n\t\twhile (true)\n\t\t{\n\t\t\tlet a = theta[idx[sz - 1]], b = theta[idx[0]], c = theta[idx[1]];\n\t\t\tif (angleDiff(b, a) <= angleDiff(c, b)) break;\n\t\t\tlet last = idx.pop();\n\t\t\tidx.unshift(last);\n\t\t}\n\t\treturn idx;\n\t}\n\n\t// calculates a list of unique angles (based on the threshold parameter, in radians), and returns it; the returned list of\n\t// angles will be sorted in order, as described by sortAngles(..); note that there is no fancy clustering, so a sequence of\n\t// angles which are a bit below the threshold is not guaranteed to be stable; there is also a boundary case which bumps the\n\t// sort rotation status slightly out of whack\n\tpublic static uniqueAngles(theta:number[], threshold:number):number[]\n\t{\n\t\tlet ang = GeomUtil.sortAngles(theta), ret:number[] = [];\n\t\tret.push(ang[0]);\n\t\tfor (let n = 1; n < ang.length; n++)\n\t\t{\n\t\t\tif (Math.abs(angleDiff(ang[n], ang[n - 1])) > threshold) ret.push(ang[n]);\n\t\t}\n\t\treturn ret;\n\t}\n\n\t// returns the angle maximally equidistant from Th1 and Th2\n\tpublic static thetaObtuse(th1:number, th2:number):number\n\t{\n\t\tlet dth = th2 - th1;\n\t\twhile (dth < -Math.PI) dth += 2 * Math.PI;\n\t\twhile (dth > Math.PI) dth -= 2 * Math.PI;\n\t\treturn dth > 0 ? th1 - 0.5 * (2 * Math.PI - dth) : th1 + 0.5 * (2 * Math.PI + dth);\n\t}\n\n\t// for a group of angles, returns a single dominant angle that represents the \"average\" of all of them; this takes into account boundary\n\t// issues for multiple cases, e.g. +/- 180; note that the array may be modified\n\tpublic static emergentAngle(theta:number[]):number\n\t{\n\t\tlet len = theta.length;\n\t\tif (len == 1) return theta[0];\n\t\tif (len == 2) return 0.5 * (theta[0] + theta[1]);\n\n\t\tVec.sort(theta);\n\n\t\tlet bottom = 0;\n\t\tlet behind = angleDiffPos(theta[0], theta[len - 1]);\n\t\tfor (let n = 1; n < len; n++)\n\t\t{\n\t\t\tlet delta = angleDiffPos(theta[n], theta[n - 1]);\n\t\t\tif (delta > behind)\n\t\t\t{\n\t\t\t\tbottom = n;\n\t\t\t\tbehind = delta;\n\t\t\t}\n\t\t}\n\n\t\tlet sum = 0;\n\t\tfor (let n = 0; n < len; n++)\n\t\t{\n\t\t\tlet delta = theta[n] - theta[bottom];\n\t\t\tif (delta < 0) delta += TWOPI;\n\t\t\tsum += delta;\n\t\t}\n\n\t\treturn sum / len + theta[bottom];\n\t}\n\n\t// core 3D vector calculations; observe that even though the parameters are vectors, these functions do assume that they are of size 3\n\n\tpublic static dotProduct(v1:number[], v2:number[]):number\n\t{\n\t\treturn v1[0] * v2[0] + v1[1] * v2[1] + v1[2] * v2[2];\n\t}\n\n\tpublic static crossProduct(v1:number[], v2:number[]):number[]\n\t{\n\t\tconst x = v1[1] * v2[2] - v1[2] * v2[1];\n\t\tconst y = v1[2] * v2[0] - v1[0] * v2[2];\n\t\tconst z = v1[0] * v2[1] - v1[1] * v2[0];\n\t\treturn [x, y, z];\n\t}\n\n\t// generate 2D affine transforms\n\tpublic static affineTranslate(dx:number, dy:number):number[][]\n\t{\n\t\treturn [[1, 0, dx], [0, 1, dy], [0, 0, 1]];\n\t}\n\tpublic static affineMirror(xaxis:boolean, yaxis:boolean):number[][]\n\t{\n\t\treturn [[xaxis ? -1 : 1, 0, 0], [0, yaxis ? -1 : 1, 0], [0, 0, 1]];\n\t}\n\tpublic static affineScale(sx:number, sy:number):number[][]\n\t{\n\t\treturn [[sx, 0, 0], [0, sy, 0], [0, 0, 1]];\n\t}\n\tpublic static affineRotate(theta:number):number[][]\n\t{\n\t\tlet cos = Math.cos(theta), sin = Math.sin(theta);\n\t\treturn [[cos, -sin, 0], [sin, cos, 0], [0, 0, 1]];\n\t}\n\n\t// compose two affine transforms and returns a new one that is equivalent to doing both of them in order (A then B)\n\tpublic static affineCompose(A:number[][], B:number[][]):number[][]\n\t{\n\t\tlet tfm = [[0, 0, 0], [0, 0, 0], [0, 0, 0]];\n\t\tlet Acol = [0, 0, 0];\n\t\tfor (let j = 0; j < 3; j++)\n\t\t{\n\t\t\tfor (let k = 0; k < 3; k++) Acol[k] = A[k][j];\n\t\t\tfor (let i = 0; i < 3; i++)\n\t\t\t{\n\t\t\t\tlet Brow = B[i];\n\t\t\t\tlet s = 0;\n\t\t\t\tfor (let k = 0; k < 3; k++) s += Acol[k] * Brow[k];\n\t\t\t\ttfm[i][j] = s;\n\t\t\t}\n\t\t}\n\t\treturn tfm;\n\t}\n\n\t// applies a 3x3 affine transform to two coordinates; returns [x,y] position\n\tpublic static applyAffine(x:number, y:number, tfm:number[][]):[number, number]\n\t{\n\t\treturn [x * tfm[0][0] + y * tfm[0][1] + tfm[0][2], x * tfm[1][0] + y * tfm[1][1] + tfm[1][2]];\n\t}\n\n\t// applies the affine transform to a vector, modifying the parameter array\n\tpublic static applyAffineArray(x:number[], y:number[], tfm:number[][]):void\n\t{\n\t\tfor (let n = 0; n < x.length; n++) [x[n], y[n]] = this.applyAffine(x[n], y[n], tfm);\n\t}\n\n\t// returns true if the 2D affine transform contains a mirror reflection\n\tpublic static isAffineMirror(tfm:number[][]):boolean\n\t{\n\t\tlet a = tfm[0][0], b = tfm[0][1], c = tfm[0][2];\n\t\tlet d = tfm[1][0], e = tfm[1][1], f = tfm[1][2];\n\t\tlet g = tfm[2][0], h = tfm[2][1], i = tfm[2][2];\n\t\treturn a * e * i + b * f * g + c * d * h - c * e * g - b * d * i - a * f * h < 0;\n\t}\n\n\tpublic static magnitude2(v:number[]):number\n\t{\n\t\treturn v[0] * v[0] + v[1] * v[1] + v[2] * v[2];\n\t}\n\n\tpublic static magnitude(v:number[]):number\n\t{\n\t\treturn Math.sqrt(v[0] * v[0] + v[1] * v[1] + v[2] * v[2]);\n\t}\n\n\tpublic static dist2(v1:number[], v2:number[]):number\n\t{\n\t\tlet dx = v1[0] - v2[0], dy = v1[1] - v2[1], dz = v1[2] - v2[2];\n\t\treturn dx * dx + dy * dy + dz * dz;\n\t}\n\n\tpublic static dist(v1:number[], v2:number[]):number\n\t{\n\t\tlet dx = v1[0] - v2[0], dy = v1[1] - v2[1], dz = v1[2] - v2[2];\n\t\treturn Math.sqrt(dx * dx + dy * dy + dz * dz);\n\t}\n\n\tpublic static normalise(v:number[]):void\n\t{\n\t\tconst dsq = v[0] * v[0] + v[1] * v[1] + v[2] * v[2];\n\t\tif (dsq == 0) return;\n\t\tconst inv = 1.0 / Math.sqrt(dsq);\n\t\tv[0] *= inv;\n\t\tv[1] *= inv;\n\t\tv[2] *= inv;\n\t}\n\n\tpublic static normalised(v:number[]):number[]\n\t{\n\t\tlet ret = v.slice(0);\n\t\tthis.normalise(ret);\n\t\treturn ret;\n\t}\n\n\t// returns the unsigned angle between two vectors\n\tpublic static acuteAngle(v1:number[], v2:number[]):number\n\t{\n\t\tlet mag1 = this.magnitude(v1), mag2 = this.magnitude(v2);\n\t\tif (mag1 == 0 || mag2 == 0) return 0;\n\t\tlet dot = this.dotProduct(v1, v2);\n\t\tlet cosTheta = dot / (mag1 * mag2);\n\t\tcosTheta = Math.max(-1, Math.min(1, cosTheta)); // numeric error can bump it slightly out of -1 .. +1\n\t\treturn Math.acos(cosTheta);\n\t}\n\n\t// given a circle (at origin) of a given radius, and two points at the perimeter, calculates two control points that can be used to draw a\n\t// bezier spline of the curved part of the arc; the given points are presumed to be in angular order; if the angle is more than 180 degrees\n\t// this won't work (i.e. the caller must split into more than one curve)\n\tpublic static arcControlPoints(rad:number, x1:number, y1:number, x2:number, y2:number):[number, number, number, number]\n\t{\n\t\tlet t1x = -y1, t1y = x1;\n\t\tlet t2x = y2, t2y = -x2;\n\t\tlet dx = 0.5 * (x1 + x2);\n\t\tlet dy = 0.5 * (y1 + y2);\n\t\tlet tx = 3 / 8 * (t1x + t2x);\n\t\tlet ty = 3 / 8 * (t1y + t2y);\n\t\tlet a = tx * tx + ty * ty;\n\t\tlet b = dx * tx + dy * ty;\n\t\tlet c = dx * dx + dy * dy - rad * rad;\n\t\tlet D = b * b - a * c;\n\t\tlet k = (Math.sqrt(D) - b) / a;\n\n\t\treturn [x1 + k * t1x, y1 + k * t1y, x2 + k * t2x, y2 + k * t2y];\n\t}\n\n\t// creates a bezier-type curve that renders a whole ellipse; the parameters (w,h) are the dimensions of the ellipse, where w is parallel to theta and\n\t// h is perpendicular to it (i.e. if theta is 0, it's an ordinary ellipse that is aligned with the axes); the result is imprecise: it emits a series of\n\t// points corresponding to angular increments and throws in some quadratic smoothing - it should be visually indistinguishable from the real thing\n\tpublic static createBezierEllipse(cx:number, cy:number, rw:number, rh:number, theta:number):Spline\n\t{\n\t\t/*\n\t\t\tFrom https://math.stackexchange.com/questions/2645689/what-is-the-parametric-equation-of-a-rotated-ellipse-given-the-angle-of-rotatio\n\t\t\tx(α)=Rx.cos(α).cos(θ) − Ry.sin(α).sin(θ) + Cx\n\t\t\ty(α)=Rx.cos(α).sin(θ) + Ry.sin(α).cos(θ) + Cy\n\t\t*/\n\n\t\tlet nseg = 24, npt = 2 * nseg + 1;\n\t\tlet cosTheta = Math.cos(theta), sinTheta = Math.sin(theta);\n\t\tlet incrAlpha = TWOPI / nseg;\n\n\t\tlet px:number[] = new Array(npt), py:number[] = new Array(npt);\n\t\tfor (let n = 0; n < nseg; n++)\n\t\t{\n\t\t\tlet alpha = n * incrAlpha;\n\t\t\tlet cosAlpha = Math.cos(alpha), sinAlpha = Math.sin(alpha);\n\n\t\t\tpx[n * 2] = rw * cosAlpha * cosTheta - rh * sinAlpha * sinTheta + cx;\n\t\t\tpy[n * 2] = rw * cosAlpha * sinTheta + rh * sinAlpha * cosTheta + cy;\n\t\t}\n\n\t\tpx[npt - 1] = px[0];\n\t\tpy[npt - 1] = py[0];\n\n\t\tlet smooth = 0.3;\n\t\tfor (let n = 0; n < nseg; n++)\n\t\t{\n\t\t\tlet n1 = (n - 1 + nseg) % nseg;\n\t\t\tlet n2 = n;\n\t\t\tlet n3 = (n + 1) % nseg;\n\t\t\tlet n4 = (n + 2) % nseg;\n\t\t\tlet x1 = px[n1 * 2], x2 = px[n2 * 2], x3 = px[n3 * 2], x4 = px[n4 * 2];\n\t\t\tlet y1 = py[n1 * 2], y2 = py[n2 * 2], y3 = py[n3 * 2], y4 = py[n4 * 2];\n\t\t\tpx[n * 2 + 1] = 0.5 * (x2 + x3 + smooth * (x2 - x1 + x3 - x4));\n\t\t\tpy[n * 2 + 1] = 0.5 * (y2 + y3 + smooth * (y2 - y1 + y3 - y4));\n\t\t}\n\n\t\tlet ctrl:boolean[] = new Array(npt);\n\t\tfor (let n = 0; n < npt; n++) ctrl[n] = (n & 1) == 1;\n\n\t\treturn {px, py, ctrl};\n\t}\n\n\t// for a set of points that are presumed to be normalised about the origin, determines the radius of the closest approach\n\tpublic static fitCircle(x:number[], y:number[]):number\n\t{\n\t\tlet dsq = Number.POSITIVE_INFINITY;\n\t\tfor (let n = 0; n < x.length; n++) dsq = Math.min(dsq, norm2_xy(x[n], y[n]));\n\t\treturn Math.sqrt(dsq);\n\t}\n\n\t// for a set of points that are presumed to be normalised about the origin, comes up with an ellipse [w,h] that is optimised to be as large as possible\n\t// without expanding beyond any of the closing points; note that the solution is an approximation, but it is at least one that can be carried out in a\n\t// small number of iterations\n\t// NOTE: the min/max X/Y parameters are treated as blockers for the axes; this is because the algorithm uses intersection of ellipse-with-points to determine\n\t// boundaries, which unfortunately means that sometimes the ellipse can do on a runaway distortion by going *through* one of the axes; these parameters will\n\t// prevent this, but they must be precalculated; ideally the algorithm would calculate an \"internal convex hull\" to derive these points automatically\n\tpublic static fitEllipse(px:number[], py:number[], minX:number, minY:number, maxX:number, maxY:number):number[]\n\t{\n\t\t// start with a circle-of-fit, which is the worst case scenario\n\t\tlet bestW = 0.5 * this.fitCircle(px, py), bestH = bestW, bestScore = bestW * bestH;\n\n\t\tlet x = Vec.concat(px, [minX, maxX, 0, 0]);\n\t\tlet y = Vec.concat(py, [0, 0, minY, maxY]);\n\t\tconst sz = x.length;\n\n\t\tlet shrinkToFit = (whs:number[]):void =>\n\t\t{\n\t\t\tlet dmin = Number.POSITIVE_INFINITY;\n\t\t\tlet invW2 = 1.0 / (whs[0] * whs[0]), invH2 = 1.0 / (whs[1] * whs[1]);\n\t\t\tfor (let n = 0; n < sz; n++) dmin = Math.min(dmin, Math.sqrt(x[n] * x[n] * invW2 + y[n] * y[n] * invH2));\n\t\t\tif (dmin < 1)\n\t\t\t{\n\t\t\t\twhs[0] *= dmin;\n\t\t\t\twhs[1] *= dmin;\n\t\t\t}\n\t\t\twhs[2] = whs[0] * whs[1];\n\t\t};\n\n\t\t// keep trying to expand on one axis/shrink on both, until subsequent efforts are futile\n\t\tlet mul = 1;\n\t\tlet whsX = [0, 0, 0], whsY = [0, 0, 0];\n\t\twhile (mul > 0.001)\n\t\t{\n\t\t\twhsX[0] = bestW * (1 + mul);\n\t\t\twhsX[1] = bestH;\n\t\t\tshrinkToFit(whsX);\n\n\t\t\twhsY[0] = bestW;\n\t\t\twhsY[1] = bestH * (1 + mul);\n\t\t\tshrinkToFit(whsY);\n\n\t\t\tlet anything = false;\n\t\t\tif (whsX[2] > bestScore) {bestW = whsX[0]; bestH = whsX[1]; bestScore = whsX[2]; anything = true;}\n\t\t\tif (whsY[2] > bestScore) {bestW = whsY[0]; bestH = whsY[1]; bestScore = whsY[2]; anything = true;}\n\t\t\tif (!anything) mul *= 0.6;\n\t\t}\n\n\t\treturn [bestW, bestH];\n\t}\n\n\t// given two collections of 2D points (A and B), returns the rotate+transform matrix that best maps A onto B\n\tpublic static superimpose(ax:number[], ay:number[], bx:number[], by:number[]):number[][]\n\t{\n\t\t// special deal for size 1: just a translation; the caller must find some other way to discover the preferred rotation\n\t\tlet sz = ax.length;\n\t\tif (sz == 1)\n\t\t{\n\t\t\tlet dx = bx[0] - ax[0], dy = by[0] - ay[0];\n\t\t\treturn [[1, 0, dx], [0, 1, dy], [0, 0, 1]];\n\t\t}\n\n\t\t// special deal for size 2: rotation matrix can be derived from a single angle, rather than doing an optimisation\n\t\tif (sz == 2)\n\t\t{\n\t\t\tlet thetaA = Math.atan2(ay[1] - ay[0], ax[1] - ax[0]), thetaB = Math.atan2(by[1] - by[0], bx[1] - bx[0]);\n\t\t\tlet delta = angleDiff(thetaB, thetaA), cos = Math.cos(delta), sin = Math.sin(delta);\n\t\t\tlet rot00 = cos, rot01 = -sin;\n\t\t\tlet rot10 = sin, rot11 = cos;\n\n\t\t\tlet acx = 0.5 * (ax[0] + ax[1]), acy = 0.5 * (ay[0] + ay[1]);\n\t\t\tlet bcx = 0.5 * (bx[0] + bx[1]), bcy = 0.5 * (by[0] + by[1]);\n\t\t\tlet rax = rot00 * acx + rot01 * acy;\n\t\t\tlet ray = rot10 * acx + rot11 * acy;\n\n\t\t\treturn [[rot00, rot01, bcx - rax], [rot10, rot11, bcy - ray], [0, 0, 1]];\n\t\t}\n\n\t\t// proceed with a relatively heavy-handed eigenvalue optimisation\n\t\t// adapted from: https://github.com/oleg-alexandrov/projects/blob/master/eigen/Kabsch.cpp\n\n\t\tlet invsz = 1.0 / sz;\n\t\tlet acx = Vec.sum(ax) * invsz, acy = Vec.sum(ay) * invsz;\n\t\tlet bcx = Vec.sum(bx) * invsz, bcy = Vec.sum(by) * invsz;\n\n\t\tlet mtxA = new Matrix(3, sz), mtxB = new Matrix(3, sz);\n\t\tfor (let n = 0; n < sz; n++)\n\t\t{\n\t\t\tmtxA.set(0, n, ax[n] - acx);\n\t\t\tmtxA.set(1, n, ay[n] - acy);\n\t\t\tmtxA.set(2, n, 0);\n\t\t\tmtxB.set(0, n, bx[n] - bcx);\n\t\t\tmtxB.set(1, n, by[n] - bcy);\n\t\t\tmtxB.set(2, n, 0);\n\t\t}\n\n\t\tlet cov = mtxA.times(mtxB.transpose());\n\t\tlet svd = new SingularValueDecomposition(cov);\n\n\t\t/* ... this doesn't seem to be necessary for 2D\n\t\tdouble d = svd.getV().times(svd.getU().transpose()).det();\n\t\tif (d > 0) d = 1; else d = -1;\n\t\tlet ident = Matrix.identity(3, 3);\n\t\tident.set(2, 2, d); // NOTE: not sure if this is necessary for 2D\n\t\tlet rotate = (svd.getV().times(ident)).times(svd.getU().transpose());*/\n\n\t\tlet rotate = svd.getV().times(svd.getU().transpose());\n\n\t\tlet rot00 = rotate.get(0, 0), rot01 = rotate.get(0, 1);\n\t\tlet rot10 = rotate.get(1, 0), rot11 = rotate.get(1, 1);\n\t\tlet rax = rot00 * acx + rot01 * acy;\n\t\tlet ray = rot10 * acx + rot11 * acy;\n\n\t\t// return the subset of the matrix that performs the 2D rotation & translation\n\t\treturn [[rot00, rot01, bcx - rax], [rot10, rot11, bcy - ray], [0, 0, 1]];\n\t}\n\n\t// takes a set of points and calculates the convex hull, in the form of an enclosing polygon\n\tpublic static convexHull(x:number[], y:number[], flatness:number):[number[], number[]]\n\t{\n\t\tlet algo = new QuickHull(x, y, sqr(flatness * 0.1));\n\t\treturn [algo.hullX, algo.hullY];\n\t}\n\n\t// takes a set of points and calculates the outline, in the form of an enclosing polygon, using the \"rolling ball\" algorithm\n\tpublic static outlinePolygon(x:number[], y:number[], diameter:number):[number[], number[]]\n\t{\n\t\t/* ... rolling ball algorithm isn't that great; the Delaunay-based method is much better\n\t\tlet algo = new RollingBall(x, y, diameter);\n\t\treturn algo.sequenceXY();*/\n\t\tlet del = new Triangulation2D(x, y);\n\t\tlet concave = del.trimConcave(diameter);\n\t\tlet idx = del.traceOutline(concave);\n\t\treturn [Vec.idxGet(x, idx), Vec.idxGet(y, idx)];\n\t}\n}\n\n// implementation of the \"Quick Hull\" algorithm which calculates the convex hull that surrounds a cluster of points\nexport class QuickHull\n{\n\tprivate hsz = 0;\n\n\t// read these out for the answer\n\tpublic hullX:number[] = [];\n\tpublic hullY:number[] = [];\n\n\tconstructor(private x:number[], private y:number[], private threshSq:number)\n\t{\n\t\tconst sz = x.length;\n\n\t\tlet l = 0, r = 0;\n\t\tfor (let n = 0; n < sz; n++)\n\t\t{\n\t\t\tif (x[r] > x[n] || (x[r] == x[n] && y[r] > y[n])) r = n;\n\t\t\tif (x[l] < x[n] || (x[l] == x[n] && y[l] < y[n])) l = n;\n\t\t}\n\n\t\tlet al1:number[] = [], al2:number[] = [];\n\t\tfor (let n = 0; n < sz; n++)\n\t\t{\n\t\t\tif (n != l && n != r)\n\t\t\t{\n\t\t\t\tif (this.right(r, l, n) > 0) al1.push(n);\n\t\t\t\telse al2.push(n);\n\t\t\t}\n\t\t}\n\n\t\t// recursively build part 1\n\t\tthis.hullX.push(x[r]);\n\t\tthis.hullY.push(y[r]);\n\t\tthis.quickHull(r, l, al1);\n\n\t\t// recursively build part 2\n\t\tthis.hullX.push(x[l]);\n\t\tthis.hullY.push(y[l]);\n\t\tthis.quickHull(l, r, al2);\n\n\t\t// build a polygon\n\t\tfor (let n = 0; n < this.hullX.length - 1;)\n\t\t{\n\t\t\tif (norm2_xy(this.hullX[n] - this.hullY[n + 1], this.hullY[n] - this.hullY[n + 1]) < threshSq)\n\t\t\t{\n\t\t\t\tthis.hullX.splice(n + 1, 1);\n\t\t\t\tthis.hullY.splice(n + 1, 1);\n\t\t\t}\n\t\t\telse n++;\n\t\t}\n\t}\n\n\t// processes a segment, in a given direction\n\tprivate quickHull(a:number, b:number, al:number[]):void\n\t{\n\t\tif (al.length == 0) return;\n\n\t\tlet c = this.furthestPoint(a, b, al);\n\t\tlet al1:number[] = [], al2:number[] = [];\n\t\tfor (let n = 0; n < al.length; n++)\n\t\t{\n\t\t\tlet p = al[n];\n\t\t\tif (p == a || p == b) continue;\n\t\t\tif (this.right(a, c, p) > 0) al1.push(p);\n\t\t\telse if (this.right(c, b, p) > 0) al2.push(p);\n\t\t}\n\n\t\tthis.quickHull(a, c, al1);\n\n\t\tthis.hullX.push(this.x[c]);\n\t\tthis.hullY.push(this.y[c]);\n\n\t\tthis.quickHull(c, b, al2);\n\t}\n\n\t// returns >0 if p is to the right of a-b, or <0 if to the left\n\tprivate right(a:number, b:number, p:number):number\n\t{\n\t\tconst x = this.x, y = this.y;\n\t\treturn (x[a] - x[b]) * (y[p] - y[b]) - (x[p] - x[b]) * (y[a] - y[b]);\n\t}\n\n\t// square distance point p to line a-b\n\tprivate distance(a:number, b:number, p:number):number\n\t{\n\t\tconst x = this.x, y = this.y;\n\t\tlet u = ((x[p] - x[a]) * (x[b] - x[a]) + (y[p] - y[a]) * (y[b] - y[a])) / ((x[b] - x[a]) * (x[b] - x[a]) + (y[b] - y[a]) * (y[b] - y[a]));\n\t\tlet ux = x[a] + u * (x[b] - x[a]);\n\t\tlet uy = y[a] + u * (y[b] - y[a]);\n\t\treturn ((ux - x[p]) * (ux - x[p]) + (uy - y[p]) * (uy - y[p]));\n\t}\n\n\t// finds the furthest-away point from within the sub-list\n\tprivate furthestPoint(a:number, b:number, al:number[]):number\n\t{\n\t\tlet maxDist = -1;\n\t\tlet maxPos = -1;\n\t\tfor (let n = 0; n < al.length; n++)\n\t\t{\n\t\t\tlet p = al[n];\n\t\t\tif (p == a || p == b) continue;\n\t\t\tlet dist = this.distance(a, b, p);\n\t\t\tif (dist > maxDist)\n\t\t\t{\n\t\t\t\tmaxDist = dist;\n\t\t\t\tmaxPos = p;\n\t\t\t}\n\t\t}\n\t\treturn maxPos;\n\t}\n}\n\n// implementation of the \"Rolling Ball\" algorithm which traces the outline of a group of points using a granularity threshold (the \"ball diameter\"); note that the points must\n// be dense enough so that the \"ball\" can be rolled around the outside without \"falling in\", in which case the result will be null\nexport class RollingBall\n{\n\tpublic sequence:number[] = []; // the indices tracing the outline; set to null if it failed\n\n\tconstructor(public x:number[], public y:number[], diameter:number)\n\t{\n\t\tconst sz = x.length;\n\t\tconst threshSq = diameter * diameter;\n\n\t\tlet first = Vec.idxMax(x), latest = first;\n\t\tlet direction = 0.0; // radians (pointing to the right)\n\t\tlet visited = Vec.booleanArray(false, sz);\n\t\tthis.sequence.push(first);\n\n\t\tlet roll = ():number =>\n\t\t{\n\t\t\tlet bestIdx = -1;\n\t\t\tlet bestDelta = 0, bestTheta = 0;\n\t\t\tfor (let n = 0; n < sz; n++) if (n != latest && !visited[n])\n\t\t\t{\n\t\t\t\tlet dx = x[n] - x[latest], dy = y[n] - y[latest];\n\t\t\t\tlet dsq = norm2_xy(dx, dy);\n\t\t\t\tif (dsq == 0 || dsq > threshSq) continue;\n\t\t\t\tlet theta = Math.atan2(dy, dx), delta = angleDiffPos(theta, direction);\n\t\t\t\tif (bestIdx < 0 || delta < bestDelta)\n\t\t\t\t{\n\t\t\t\t\tbestIdx = n;\n\t\t\t\t\tbestDelta = delta;\n\t\t\t\t\tbestTheta = theta;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (bestIdx < 0) return -1;\n\n\t\t\tdirection = angleNorm(bestTheta - 0.5 * Math.PI);\n\t\t\tvisited[bestIdx] = true;\n\t\t\treturn bestIdx;\n\t\t};\n\n\t\twhile (true)\n\t\t{\n\t\t\tlet next = roll();\n\t\t\tif (next < 0) {this.sequence = null; return;} // failure\n\t\t\tif (next == first) break;\n\t\t\tthis.sequence.push(next);\n\t\t\tlatest = next;\n\t\t}\n\t}\n\n\t// formulate the results in terms of coordinates, as an alternative to just looking at the sequence indices\n\tpublic sequencePos():Pos[]\n\t{\n\t\tif (!this.sequence) return null;\n\t\tlet posList:Pos[] = [];\n\t\tfor (let n of this.sequence) posList.push(new Pos(this.x[n], this.y[n]));\n\t\treturn posList;\n\t}\n\tpublic sequenceXY():[number[], number[]]\n\t{\n\t\tif (!this.sequence) return [null, null];\n\t\tlet px:number[] = [], py:number[] = [];\n\t\tfor (let n of this.sequence) {px.push(this.x[n]); py.push(this.y[n]);}\n\t\treturn [px, py];\n\t}\n}\n\n/*\n\tPos, Size, Box, Oval, Line: convenient trivial classes which save repetition\n*/\n\nexport class Pos\n{\n\tpublic x:number;\n\tpublic y:number;\n\n\tpublic static zero():Pos {return new Pos();}\n\tpublic static fromArray(src:number[]):Pos {return new Pos(src[0], src[1]);}\n\tconstructor(x?:number, y?:number)\n\t{\n\t\tthis.x = x == null ? 0 : x;\n\t\tthis.y = y == null ? 0 : y;\n\t}\n\n\tpublic clone():Pos {return new Pos(this.x, this.y);}\n\tpublic equals(other:Pos):boolean {return this.x == other.x && this.y == other.y;}\n\n\tpublic scaleBy(mag:number):void\n\t{\n\t\tif (mag == 1) return;\n\t\tthis.x *= mag;\n\t\tthis.y *= mag;\n\t}\n\tpublic offsetBy(dx:number, dy:number):void\n\t{\n\t\tthis.x += dx;\n\t\tthis.y += dy;\n\t}\n\n\tpublic withScaleBy(mag:number):Pos\n\t{\n\t\treturn new Pos(this.x * mag, this.y * mag);\n\t}\n\tpublic withOffsetBy(dx:number, dy:number):Pos\n\t{\n\t\treturn new Pos(this.x + dx, this.y + dy);\n\t}\n\n\tpublic toString():string {return '[' + this.x + ',' + this.y + ']';}\n}\n\nexport class Size\n{\n\tpublic w:number;\n\tpublic h:number;\n\n\tpublic static zero():Size {return new Size();}\n\tpublic static fromArray(src:number[]):Size {return new Size(src[0], src[1]);}\n\tconstructor(w?:number, h?:number)\n\t{\n\t\tthis.w = w == null ? 0 : w;\n\t\tthis.h = h == null ? 0 : h;\n\t}\n\n\tpublic clone():Size {return new Size(this.w, this.h);}\n\tpublic equals(other:Size):boolean {return this.w == other.w && this.h == other.h;}\n\n\tpublic isZero():boolean {return this.w == 0 && this.h == 0;}\n\n\tpublic scaleBy(mag:number):void\n\t{\n\t\tif (mag == 1) return;\n\t\tthis.w *= mag;\n\t\tthis.h *= mag;\n\t}\n\tpublic fitInto(maxW:number, maxH:number):void\n\t{\n\t\tlet scale = 1;\n\t\tif (this.w > maxW) scale = maxW / this.w;\n\t\tif (this.h > maxH) scale = Math.min(scale, maxH / this.h);\n\t\tif (scale < 1) this.scaleBy(scale);\n\t}\n\n\tpublic withScaleBy(mag:number):Size\n\t{\n\t\treturn new Size(this.w * mag, this.h * mag);\n\t}\n\n\tpublic toString():string {return '[' + this.w + ',' + this.h + ']';}\n}\n\nexport class Box\n{\n\tpublic x:number;\n\tpublic y:number;\n\tpublic w:number;\n\tpublic h:number;\n\n\tpublic static zero():Box {return new Box();}\n\tpublic static fromBounds(x1:number, y1:number, x2:number, y2:number) {return new Box(x1, y1, x2 - x1, y2 - y1);}\n\tpublic static fromSize(sz:Size):Box {return new Box(0, 0, sz.w, sz.h);}\n\tpublic static fromOval(oval:Oval):Box {return new Box(oval.cx - oval.rw, oval.cy - oval.rh, 2 * oval.rw, 2 * oval.rh);}\n\tpublic static fromArray(src:number[]):Box {return new Box(src[0], src[1], src[2], src[3]);}\n\tconstructor(x?:number, y?:number, w?:number, h?:number)\n\t{\n\t\tthis.x = x == null ? 0 : x;\n\t\tthis.y = y == null ? 0 : y;\n\t\tthis.w = w == null ? 0 : w;\n\t\tthis.h = h == null ? 0 : h;\n\t}\n\n\tpublic clone():Box {return new Box(this.x, this.y, this.w, this.h);}\n\tpublic equals(other:Box):boolean {return this.x == other.x && this.y == other.y && this.w == other.w && this.h == other.h;}\n\n\tpublic getPos():Pos {return new Pos(this.x, this.y);}\n\tpublic setPos(pos:Pos):void\n\t{\n\t\tthis.x = pos.x;\n\t\tthis.y = pos.y;\n\t}\n\tpublic getSize():Size {return new Size(this.w, this.h);}\n\tpublic setSize(sz:Size):void\n\t{\n\t\tthis.w = sz.w;\n\t\tthis.h = sz.h;\n\t}\n\n\tpublic minX():number {return this.x;}\n\tpublic minY():number {return this.y;}\n\tpublic midX():number {return this.x + 0.5 * this.w;}\n\tpublic midY():number {return this.y + 0.5 * this.h;}\n\tpublic maxX():number {return this.x + this.w;}\n\tpublic maxY():number {return this.y + this.h;}\n\tpublic area():number {return this.w * this.h;}\n\n\tpublic scaleBy(mag:number):void\n\t{\n\t\tif (mag == 1) return;\n\t\tthis.x *= mag;\n\t\tthis.y *= mag;\n\t\tthis.w *= mag;\n\t\tthis.h *= mag;\n\t}\n\tpublic offsetBy(dx:number, dy:number):void\n\t{\n\t\tthis.x += dx;\n\t\tthis.y += dy;\n\t}\n\tpublic grow(bx:number, by:number):void\n\t{\n\t\tthis.x -= bx;\n\t\tthis.y -= by;\n\t\tthis.w += 2 * bx;\n\t\tthis.h += 2 * by;\n\t}\n\n\tpublic withScaleBy(mag:number):Box\n\t{\n\t\treturn new Box(this.x * mag, this.y * mag, this.w * mag, this.h * mag);\n\t}\n\tpublic withOffsetBy(dx:number, dy:number):Box\n\t{\n\t\treturn new Box(this.x + dx, this.y + dy, this.w, this.h);\n\t}\n\tpublic withGrow(bx:number, by:number):Box\n\t{\n\t\treturn new Box(this.x - bx, this.y - by, this.w + 2 * bx, this.h + 2 * by);\n\t}\n\n\tpublic intersects(other:Box):boolean\n\t{\n\t\treturn GeomUtil.rectsIntersect(this.x, this.y, this.w, this.h, other.x, other.y, other.w, other.h);\n\t}\n\n\t// returns the actual intersection box; note that if they don't intersect at all, things get weird\n\tpublic intersection(other:Box):Box\n\t{\n\t\tlet x1 = this.x, x2 = x1 + this.w, y1 = this.y, y2 = y1 + this.h;\n\t\tlet x3 = other.x, x4 = x3 + other.w, y3 = other.y, y4 = y3 + other.h;\n\t\tlet x5 = Math.max(x1, x3), y5 = Math.max(y1, y3), x6 = Math.min(x2, x4), y6 = Math.min(y2, y4);\n\t\treturn new Box(x5, y5, x6 - x5, y6 - y5);\n\t}\n\n\tpublic contains(x:number, y:number):boolean\n\t{\n\t\treturn x >= this.x && x < this.x + this.w && y >= this.y && y < this.y + this.h;\n\t}\n\n\tpublic union(other:Box):Box\n\t{\n\t\tlet x1 = Math.min(this.x, other.x), x2 = Math.max(this.x + this.w, other.x + other.w);\n\t\tlet y1 = Math.min(this.y, other.y), y2 = Math.max(this.y + this.h, other.y + other.h);\n\t\treturn new Box(x1, y1, x2 - x1, y2 - y1);\n\t}\n\n\tpublic isZero():boolean {return this.w == 0 && this.h == 0;} // deprecated\n\tpublic isEmpty():boolean {return this.w == 0 && this.h == 0;}\n\tpublic notEmpty():boolean {return this.w > 0 || this.h > 0;}\n\n\tpublic toString():string {return '[' + this.x + ',' + this.y + ';' + this.w + ',' + this.h + ']';}\n}\n\nexport class Oval\n{\n\tpublic cx:number;\n\tpublic cy:number;\n\tpublic rw:number;\n\tpublic rh:number;\n\n\tpublic static zero():Oval {return new Oval();}\n\tpublic static fromBox(box:Box):Oval {return new Oval(box.x + 0.5 * box.w, box.y + 0.5 * box.h, 0.5 * box.w, 0.5 * box.h);}\n\tpublic static fromArray(src:number[]):Oval {return new Oval(src[0], src[1], src[2], src[3]);}\n\tconstructor(cx?:number, cy?:number, rw?:number, rh?:number)\n\t{\n\t\tthis.cx = cx == null ? 0 : cx;\n\t\tthis.cy = cy == null ? 0 : cy;\n\t\tthis.rw = rw == null ? 0 : rw;\n\t\tthis.rh = rh == null ? 0 : rh;\n\t}\n\n\tpublic clone():Oval {return new Oval(this.cx, this.cy, this.rw, this.rh);}\n\n\tpublic setCentre(pos:Pos):void\n\t{\n\t\tthis.cx = pos.x;\n\t\tthis.cy = pos.y;\n\t}\n\tpublic setRadius(sz:Size):void\n\t{\n\t\tthis.rw = sz.w;\n\t\tthis.rh = sz.h;\n\t}\n\n\tpublic minX():number {return this.cx - this.rw;}\n\tpublic minY():number {return this.cy - this.rh;}\n\tpublic maxX():number {return this.cx + this.rw;}\n\tpublic maxY():number {return this.cy + this.rh;}\n\n\tpublic scaleBy(mag:number):void\n\t{\n\t\tif (mag == 1) return;\n\t\tthis.cx *= mag;\n\t\tthis.cy *= mag;\n\t\tthis.rw *= mag;\n\t\tthis.rh *= mag;\n\t}\n\tpublic offsetBy(dx:number, dy:number):void\n\t{\n\t\tthis.cx += dx;\n\t\tthis.cy += dy;\n\t}\n\n\tpublic withScaleBy(mag:number):Oval\n\t{\n\t\treturn new Oval(this.cx * mag, this.cy * mag, this.rw * mag, this.rh * mag);\n\t}\n\tpublic withOffsetBy(dx:number, dy:number):Oval\n\t{\n\t\treturn new Oval(this.cx + dx, this.cy + dy, this.rw, this.rh);\n\t}\n\n\tpublic contains(x:number, y:number):boolean\n\t{\n\t\tlet dx = x - this.cx, dy = y - this.cy;\n\t\tlet a = dx / this.rw, b = dy / this.rh;\n\t\treturn a * a + b * b <= 1;\n\t}\n\n\tpublic toString():string {return '[' + this.cx + ',' + this.cy + ';' + this.rw + ',' + this.rh + ']';}\n}\n\nexport class Line\n{\n\tpublic x1:number;\n\tpublic y1:number;\n\tpublic x2:number;\n\tpublic y2:number;\n\n\tpublic static zero():Line {return new Line();}\n\tpublic static fromPos(pos1:Pos, pos2:Pos):Line {return new Line(pos1.x, pos1.y, pos2.x, pos2.y);}\n\tconstructor(x1?:number, y1?:number, x2?:number, y2?:number)\n\t{\n\t\tthis.x1 = x1 == null ? 0 : x1;\n\t\tthis.y1 = y1 == null ? 0 : y1;\n\t\tthis.x2 = x2 == null ? 0 : x2;\n\t\tthis.y2 = y2 == null ? 0 : y2;\n\t}\n\n\tpublic clone():Line {return new Line(this.x1, this.y1, this.x2, this.y2);}\n\n\tpublic setPos1(pos:Pos):void\n\t{\n\t\tthis.x1 = pos.x;\n\t\tthis.y1 = pos.y;\n\t}\n\tpublic setPos2(pos:Pos):void\n\t{\n\t\tthis.x2 = pos.x;\n\t\tthis.y2 = pos.y;\n\t}\n\n\tpublic minX():number {return Math.min(this.x1, this.x2);}\n\tpublic minY():number {return Math.min(this.y1, this.y2);}\n\tpublic maxX():number {return Math.max(this.x1, this.x2);}\n\tpublic maxY():number {return Math.max(this.y1, this.y2);}\n\n\tpublic scaleBy(mag:number):void\n\t{\n\t\tif (mag == 1) return;\n\t\tthis.x1 *= mag;\n\t\tthis.y1 *= mag;\n\t\tthis.x2 *= mag;\n\t\tthis.y2 *= mag;\n\t}\n\tpublic offsetBy(dx:number, dy:number):void\n\t{\n\t\tthis.x1 += dx;\n\t\tthis.y1 += dy;\n\t\tthis.x2 += dx;\n\t\tthis.y2 += dy;\n\t}\n\n\tpublic toString():string {return '[' + this.x1 + ',' + this.y1 + ';' + this.x2 + ',' + this.y2 + ']';}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2017 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\n/*\n\tUtilities to supplement the rather rudimentary DOM.\n*/\n\n// these are defined locally, in case DOM has to be used as a plugin (in NodeJS mode)\n\nconst ELEMENT_NODE = 1;\nconst ATTRIBUTE_NODE = 2;\nconst TEXT_NODE = 3;\nconst CDATA_SECTION_NODE = 4;\nconst ENTITY_REFERENCE_NODE = 5;\nconst ENTITY_NODE = 6;\nconst PROCESSING_INSTRUCTION_NODE = 7;\nconst COMMENT_NODE = 8;\nconst DOCUMENT_NODE = 9;\nconst DOCUMENT_TYPE_NODE = 10;\nconst DOCUMENT_FRAGMENT_NODE = 11;\nconst NOTATION_NODE = 12;\n\nexport class XML\n{\n\t// these need to be defined when running under a raw NodeJS or worker thread environment, which has the XML parsing functionality stripped out of\n\t// the API; not necessary when running in regular web browser mode or Electron main task\n\tpublic static customParser:any = null;\n\tpublic static customSerial:any = null;\n\n\t// DOM <--> String\n\tpublic static parseXML(strXML:string):Document\n\t{\n\t\tlet xmlDoc:Document;\n\t\tif (this.customParser)\n\t\t\txmlDoc = new this.customParser().parseFromString(strXML, 'application/xml');\n\t\telse\n\t\t\txmlDoc = new DOMParser().parseFromString(strXML, 'application/xml');\n\t\tif (xmlDoc == null) return null;\n\t\treturn xmlDoc;\n\t}\n\tpublic static toString(doc:Document):string\n\t{\n\t\tif (this.customSerial)\n\t\t\treturn new this.customSerial().serializeToString(doc.documentElement);\n\t\telse\n\t\t\treturn new XMLSerializer().serializeToString(doc.documentElement);\n\t}\n\tpublic static toPrettyString(doc:Document):string\n\t{\n\t\tlet xslt =\n\t\t[\n\t\t\t'<xsl:stylesheet xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\">',\n\t\t\t'  <xsl:strip-space elements=\"*\"/>',\n\t\t\t'  <xsl:template match=\"para[content-style][not(text())]\">',\n\t\t\t'    <xsl:value-of select=\"normalize-space(.)\"/>',\n\t\t\t'  </xsl:template>',\n\t\t\t'  <xsl:template match=\"node()|@*\">',\n\t\t\t'    <xsl:copy><xsl:apply-templates select=\"node()|@*\"/></xsl:copy>',\n\t\t\t'  </xsl:template>',\n\t\t\t'  <xsl:output indent=\"yes\"/>',\n\t\t\t'</xsl:stylesheet>',\n\t\t].join('\\n');\n\t\tlet xsltDoc = this.parseXML(xslt);\n\t\tlet xsltProc = new XSLTProcessor();\n\t\txsltProc.importStylesheet(xsltDoc);\n\t\tlet resultDoc = xsltProc.transformToDocument(doc);\n\t\treturn new XMLSerializer().serializeToString(resultDoc);\n\t}\n\n\t// composes all of the text nodes and returns them\n\tpublic static nodeText(el:Node):string\n\t{\n\t\tlet text = '';\n\t\tfor (let child of Array.from(el.childNodes))\n\t\t{\n\t\t\tif (child.nodeType == TEXT_NODE || child.nodeType == CDATA_SECTION_NODE) text += child.nodeValue;\n\t\t}\n\t\treturn text;\n\t}\n\n\t// convenient method for finding a child element and returning its text content; note that if the parent is null or the child cannot be found,\n\t// returns null, but if the child exists and has no text, returns a blank string\n\tpublic static childText(parent:Element, tagName:string):string\n\t{\n\t\tif (parent == null) return null;\n\t\tlet el = this.findElement(parent, tagName);\n\t\tif (el == null) return null;\n\t\treturn this.nodeText(el);\n\t}\n\n\t// creates and appends an element\n\tpublic static appendElement(parent:Node, name:string):Element\n\t{\n\t\tlet el = parent.ownerDocument.createElement(name);\n\t\tparent.appendChild(el);\n\t\treturn el;\n\t}\n\n\t// creates and appends an element and makes sure that it occurs immediately after the 'presib' node\n\tpublic static appendElementAfter(presib:Node, name:string):Element\n\t{\n\t\tlet el = presib.ownerDocument.createElement(name);\n\t\tlet postsib = presib.nextSibling;\n\t\tif (postsib == null)\n\t\t\tpresib.parentNode.appendChild(el);\n\t\telse\n\t\t\tpresib.parentNode.insertBefore(el, postsib);\n\t\treturn el;\n\t}\n\n\t// creates and appends text, maybe in a CDATA section\n\t//public static appendText(Node parent, String text):void {appendText(parent, text, false);}\n\tpublic static appendText(parent:Node, text:string, isCDATA:boolean = false):void\n\t{\n\t\tif (text == null || text.length == 0) return;\n\t\tif (!isCDATA)\n\t\t\tparent.appendChild(parent.ownerDocument.createTextNode(text));\n\t\telse\n\t\t\tparent.appendChild(parent.ownerDocument.createCDATASection(text));\n\t}\n\n\t// appends an XML entity (e.g. \"&nbsp;\")\n\t/*public static appendEntity(parent:Node, entity:string):void\n\t{\n\t\tif (entity.startsWith('&')) entity = entity.substring(1);\n\t\tif (entity.endsWith(';')) entity = entity.substring(0, entity.length - 1);\n\t\tparent.appendChild(parent.ownerDocument.createEntityReference(entity));\n\t}*/\n\n\t// creates an element child with a particular name and populates it with text\n\tpublic static createTextChild(parent:Node, name:string, text:string, isCDATA:boolean = false):void\n\t{\n\t\tlet el = parent.ownerDocument.createElement(name) as Element;\n\t\tparent.appendChild(el);\n\t\tif (!isCDATA) el.textContent = text; else el.appendChild(parent.ownerDocument.createCDATASection(text));\n\t}\n\n\t// defines the current notes contents as being only the provided text\n\tpublic static setText(parent:Node, text:string, isCDATA:boolean = false):void\n\t{\n\t\twhile (parent.firstChild != null) parent.removeChild(parent.firstChild);\n\t\tthis.appendText(parent, text, isCDATA);\n\t}\n\n\t// returns the first element with the given tag name, or null if none\n\tpublic static findElement(parent:Element, tagName:string):Element\n\t{\n\t\tif (parent == null) return null;\n\t\tlet node = parent.firstChild;\n\t\twhile (node != null)\n\t\t{\n\t\t\tif (node.nodeType == ELEMENT_NODE && node.nodeName == tagName) return node as Element;\n\t\t\tnode = node.nextSibling as any;\n\t\t}\n\t\treturn null;\n\t}\n\n\t// find child elements with the given tag name, or an empty array if invalid\n\tpublic static findChildElements(parent:Element, tagName:string):Element[]\n\t{\n\t\tif (parent == null) return [];\n\t\tlet list:Element[] = [];\n\t\tlet node = parent.firstChild;\n\t\twhile (node != null)\n\t\t{\n\t\t\tif (node.nodeType == ELEMENT_NODE && node.nodeName === tagName) list.push(node as Element);\n\t\t\tnode = node.nextSibling as any;\n\t\t}\n\t\treturn list;\n\t}\n\n\t// returns a list of all child elements, or an empty array if none\n\tpublic static childElements(parent:Element):Element[]\n\t{\n\t\tif (parent == null) return [];\n\t\tlet list:Element[] = [];\n\t\tlet node = parent.firstChild;\n\t\twhile (node != null)\n\t\t{\n\t\t\tif (node.nodeType == ELEMENT_NODE) list.push(node as Element);\n\t\t\tnode = node.nextSibling as any;\n\t\t}\n\t\treturn list;\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2021 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Box, Pos, Size} from './Geom';\nimport {XML} from './XML';\n\n/*\n\tDOM: lightweight domain object wrapper that's intended to provide a subset of the functionality of JQuery. Most\n\tof what it does is for convenience rather than the historical need to workaround compatibility issues.\n*/\n\n// generic creator: converts a compatible object into a DOM\nexport function dom(obj:Element | DOM | string):DOM\n{\n\tif (typeof obj == 'string') return DOM.parse(obj);\n\tif (obj instanceof DOM) return obj;\n\treturn new DOM(obj);\n}\n\n// a more permissive version of the above, which also looks for JQuery inputs, for compatibility purposes; type checking is\n// limited, so buyer-beware\nexport function domLegacy(obj:any):DOM\n{\n\tif (obj == null) return null;\n\tif (obj.jquery) return dom(obj[0]);\n\treturn dom(obj);\n}\n\nexport type CSSDictionary = Record<string, string | number | boolean> |\n{\n\t'display': 'none' | 'block' | 'inline-block' | 'flex' | 'inline-flex' | 'grid' | 'inline-grid';\n};\n\nexport class DOM\n{\n\tconstructor(public el:Element)\n\t{\n\t}\n\n\tpublic get elHTML():HTMLElement {return this.el as HTMLElement;}\n\tpublic get elInput():HTMLInputElement {return this.el as HTMLInputElement;}\n\tpublic get elCanvas():HTMLCanvasElement {return this.el as HTMLCanvasElement;}\n\n\tpublic static parse(xhtml:string):DOM\n\t{\n\t\tlet xml = XML.parseXML(xhtml);\n\t\tif (xml == null) throw 'Invalid XHTML string: ' + xhtml;\n\t\tlet html = xml.documentElement.outerHTML;\n\n\t\tlet template = document.createElement('template');\n\t\ttemplate.innerHTML = html;\n\t\treturn new DOM(template.content.firstChild as Element);\n\t}\n\n\t// ------------ discovery ------------\n\n\t// finds just one qualifying element based on the selector string; returns null if nothing\n\tpublic static find(selector:string):DOM\n\t{\n\t\tlet el = document.querySelector(selector);\n\t\treturn el ? new DOM(el) : null;\n\t}\n\n\t// finds all instances matching the selector string, or empty array if nothing\n\tpublic static findAll(selector:string):DOM[]\n\t{\n\t\tlet nodeList = document.querySelectorAll(selector);\n\t\tlet domList:DOM[] = [];\n\t\tfor (let n = 0; n < nodeList.length; n++) domList.push(new DOM(nodeList.item(n)));\n\t\treturn domList;\n\t}\n\n\t// returns object for parent, or null if this is the root\n\tpublic parent():DOM\n\t{\n\t\tlet parent = this.el.parentElement;\n\t\treturn parent ? new DOM(parent) : null;\n\t}\n\n\t// returns the first object in the parent's ancestry that matches the selector\n\tpublic ancestor(selector:string):DOM\n\t{\n\t\tlet el = this.el.closest(selector);\n\t\treturn el ? new DOM(el) : null;\n\t}\n\n\t// return all the node's element children\n\tpublic children(tag?:string):DOM[]\n\t{\n\t\tlet domList:DOM[] = [];\n\t\tfor (let child = this.el.firstElementChild; child; child = child.nextElementSibling)\n\t\t{\n\t\t\tif (tag && child.tagName.toLocaleLowerCase() != tag.toLocaleLowerCase()) continue;\n\t\t\tdomList.push(new DOM(child));\n\t\t}\n\t\treturn domList;\n\t}\n\n\t// finds just one qualifying in the child herarchy based on the selector string; returns null if nothing\n\tpublic find(selector:string):DOM\n\t{\n\t\tlet el = this.el.querySelector(selector);\n\t\treturn el ? new DOM(el) : null;\n\t}\n\n\t// finds all instances matching the selector string in the child hierarchy, or empty array if nothing\n\tpublic findAll(selector:string):DOM[]\n\t{\n\t\tlet nodeList = this.el.querySelectorAll(selector);\n\t\tlet domList:DOM[] = [];\n\t\tfor (let n = 0; n < nodeList.length; n++) domList.push(new DOM(nodeList.item(n)));\n\t\treturn domList;\n\t}\n\n\t// returns true if this element still exists in the overall HTML DOM, i.e. hasn't been removed and left dangling\n\tpublic exists():boolean\n\t{\n\t\treturn document.documentElement.contains(this.el);\n\t}\n\n\t// returns true if the element is currently being shown onscreen\n\tpublic isVisible():boolean\n\t{\n\t\treturn this.elHTML.offsetWidth > 0 || this.elHTML.offsetHeight > 0 || this.elHTML.getClientRects().length > 0;\n\t}\n\n\t// ------------ hierarchy ------------\n\n\t// append the given node to this one's child list\n\tpublic append(child:DOM):void\n\t{\n\t\tthis.el.append(child.el);\n\t}\n\n\t// append this element to the given parent, and then return itself (for convenient chaining)\n\tpublic appendTo(parent:DOM | Element):DOM\n\t{\n\t\tif (parent instanceof DOM)\n\t\t\t(parent as DOM).el.append(this.el);\n\t\telse\n\t\t\t(parent as Element).appendChild(this.el);\n\t\treturn this;\n\t}\n\n\t// insert the given node at the beginning of this one's child list\n\tpublic prepend(child:DOM):void\n\t{\n\t\tthis.el.prepend(child.el);\n\t}\n\n\t// prepend this element to the given parent, and then return itself (for convenient chaining)\n\tpublic prependTo(parent:DOM | Element):DOM\n\t{\n\t\tif (parent instanceof DOM)\n\t\t\t(parent as DOM).el.prepend(this.el);\n\t\telse\n\t\t\t(parent as Element).append(this.el);\n\t\treturn this;\n\t}\n\n\t// inserts this object right before the reference DOM, in the reference DOM's parent list\n\tpublic insertBefore(ref:DOM):DOM\n\t{\n\t\tref.el.parentElement.insertBefore(this.el, ref.el);\n\t\treturn this;\n\t}\n\n\t// inserts this object right after the reference DOM, in the reference DOM's parent list\n\tpublic insertAfter(ref:DOM):DOM\n\t{\n\t\tlet before = ref.el.nextElementSibling;\n\t\tif (before)\n\t\t\tref.el.parentElement.insertBefore(this.el, before);\n\t\telse\n\t\t\tref.el.parentElement.append(this.el);\n\t\treturn this;\n\t}\n\n\t// take this node out of the DOM\n\tpublic remove():void\n\t{\n\t\tthis.el.remove();\n\t}\n\n\t// ------------ properties ------------\n\n\tpublic empty():void\n\t{\n\t\tthis.el.innerHTML = '';\n\t}\n\n\t// getting & setting HTML content\n\tpublic getHTML():string\n\t{\n\t\treturn this.el.innerHTML;\n\t}\n\tpublic setHTML(html:string):void\n\t{\n\t\tthis.el.innerHTML = html;\n\t}\n\tpublic appendHTML(xhtml:string):void\n\t{\n\t\tlet xml = XML.parseXML('<z>' + xhtml + '</z>');\n\t\tif (xml == null) throw 'Invalid XHTML string: ' + xhtml;\n\t\tlet html = xml.documentElement.innerHTML;\n\t\tthis.el.insertAdjacentHTML('beforeend', html);\n\t}\n\n\t// getting & setting unmarkedup text\n\tpublic getText():string\n\t{\n\t\treturn this.el.textContent;\n\t}\n\tpublic setText(text:string):void\n\t{\n\t\tthis.el.textContent = text;\n\t}\n\tpublic appendText(text:string):void\n\t{\n\t\t//this.el.innerHTML += escapeHTML(text);\n\t\tlet content = document.createTextNode(text);\n\t\tthis.el.appendChild(content);\n\t}\n\n\t// getting & setting values of interactive widgets, like <input>\n\tpublic getValue():string\n\t{\n\t\treturn (this.el as HTMLInputElement).value;\n\t}\n\tpublic setValue(str:string):void\n\t{\n\t\t(this.el as HTMLInputElement).value = str || '';\n\t}\n\n\t// getting & setting CSS values\n\tpublic getCSS(key:string):string\n\t{\n\t\treturn this.elHTML.style.getPropertyValue(key);\n\t}\n\tpublic setCSS(key:string, value:string | number):void\n\t{\n\t\tthis.elHTML.style.setProperty(key, value?.toString());\n\t}\n\tpublic css(dict:CSSDictionary):DOM\n\t{\n\t\tfor (let key in dict) this.setCSS(key, (dict as Record<string, any>)[key].toString());\n\t\treturn this;\n\t}\n\n\t// getting & setting attributes\n\tpublic getAttr(key:string):string\n\t{\n\t\tif (!this.el.hasAttribute(key)) return null;\n\t\treturn this.el.getAttribute(key);\n\t}\n\tpublic setAttr(key:string, value:string):void\n\t{\n\t\tthis.el.setAttribute(key, value);\n\t}\n\tpublic attr(dict:Record<string, string | number | boolean>):DOM\n\t{\n\t\tfor (let key in dict) this.setAttr(key, dict[key].toString());\n\t\treturn this;\n\t}\n\n\t// getting & setting CSS classes\n\tpublic addClass(clsnames:string):void\n\t{\n\t\tfor (let cls of clsnames.split(' ')) if (cls) this.elHTML.classList.add(cls);\n\t}\n\tpublic removeClass(clsnames:string):void\n\t{\n\t\tfor (let cls of clsnames.split(' ')) if (cls) this.elHTML.classList.remove(cls);\n\t}\n\tpublic hasClass(clsname:string):boolean\n\t{\n\t\treturn this.elHTML.classList.contains(clsname);\n\t}\n\tpublic setClass(clsname:string, flag:boolean):void\n\t{\n\t\tif (flag) this.addClass(clsname); else this.removeClass(clsname);\n\t}\n\tpublic class(clsname:string):DOM\n\t{\n\t\tthis.addClass(clsname);\n\t\treturn this;\n\t}\n\tpublic toggleClass(dict:Record<string, boolean>):void\n\t{\n\t\tfor (let key in dict)\n\t\t{\n\t\t\tif (dict[key]) this.elHTML.classList.add(key); else this.elHTML.classList.remove(key);\n\t\t}\n\t}\n\n\t// position & size\n\tpublic width():number\n\t{\n\t\treturn this.elHTML.offsetWidth;\n\t}\n\tpublic height():number\n\t{\n\t\treturn this.elHTML.offsetHeight;\n\t}\n\tpublic offset():Pos\n\t{\n\t\tlet rect = this.el.getBoundingClientRect();\n\t\tlet win = this.el.ownerDocument.defaultView;\n\t\treturn new Pos(rect.left + win.pageXOffset, rect.top + win.pageYOffset);\n\t}\n\tpublic size():Size\n\t{\n\t\treturn new Size(this.width(), this.height());\n\t}\n\tpublic area():Box\n\t{\n\t\tlet pos = this.offset();\n\t\treturn new Box(pos.x, pos.y, this.width(), this.height());\n\t}\n\n\t// shorthand for defining the precise rectangle in pixels\n\tpublic setBoundaryPixels(x:number, y:number, w:number, h:number):void\n\t{\n\t\tthis.css({'left': `${x}px`, 'top': `${y}px`, 'width': `${w}px`, 'height': `${h}px`});\n\t}\n\n\t// similar convenience for size in hard pixels\n\tpublic setSizePixels(w:number, h:number):void\n\t{\n\t\tthis.css({'width': `${w}px`, 'height': `${h}px`});\n\t}\n\n\t// focus: testing and taking focus; note that focus grabbing often works better with a short delay, hence the convenient option\n\tpublic hasFocus():boolean\n\t{\n\t\treturn this.el === document.activeElement;\n\t}\n\tpublic grabFocus(delay = false):void\n\t{\n\t\tif (delay)\n\t\t\tsetTimeout(() => this.grabFocus(), 10);\n\t\telse\n\t\t\tthis.elHTML.focus();\n\t}\n\n\t// ------------ events ------------\n\n\tpublic removeEvent(id:string, callback:any):void\n\t{\n\t\tthis.el.removeEventListener(id, callback);\n\t}\n\tpublic onKeyDown(callback:(event?:KeyboardEvent) => boolean | void):void\n\t{\n\t\tthis.el.addEventListener('keydown', callback);\n\t}\n\tpublic onKeyUp(callback:(event?:KeyboardEvent) => boolean | void):void\n\t{\n\t\tthis.el.addEventListener('keyup', callback);\n\t}\n\tpublic onKeyPress(callback:(event?:KeyboardEvent) => boolean | void):void\n\t{\n\t\tthis.el.addEventListener('keypress', callback);\n\t}\n\tpublic onScroll(callback:(event?:Event) => boolean | void):void\n\t{\n\t\tthis.el.addEventListener('scroll', callback);\n\t}\n\tpublic onWheel(callback:(event?:WheelEvent) => boolean | void):void\n\t{\n\t\tthis.el.addEventListener('wheel', callback);\n\t}\n\tpublic onClick(callback:(event?:MouseEvent) => boolean | void):void\n\t{\n\t\tthis.el.addEventListener('click', callback);\n\t}\n\tpublic onContextMenu(callback:(event?:MouseEvent) => boolean | void):void\n\t{\n\t\tthis.el.addEventListener('contextmenu', callback);\n\t}\n\tpublic onDblClick(callback:(event?:MouseEvent) => boolean | void):void\n\t{\n\t\tthis.el.addEventListener('dblclick', callback);\n\t}\n\tpublic onMouseDown(callback:(event?:MouseEvent) => boolean | void):void\n\t{\n\t\tthis.el.addEventListener('mousedown', callback);\n\t}\n\tpublic onMouseUp(callback:(event?:MouseEvent) => boolean | void):void\n\t{\n\t\tthis.el.addEventListener('mouseup', callback);\n\t}\n\tpublic onMouseEnter(callback:(event?:MouseEvent) => boolean | void):void\n\t{\n\t\tthis.el.addEventListener('mouseenter', callback);\n\t}\n\tpublic onMouseLeave(callback:(event?:MouseEvent) => boolean | void):void\n\t{\n\t\tthis.el.addEventListener('mouseleave', callback);\n\t}\n\tpublic onMouseMove(callback:(event?:MouseEvent) => boolean | void):void\n\t{\n\t\tthis.el.addEventListener('mousemove', callback);\n\t}\n\tpublic onMouseOver(callback:(event?:MouseEvent) => boolean | void):void\n\t{\n\t\tthis.el.addEventListener('mouseover', callback);\n\t}\n\tpublic onChange(callback:(event?:MouseEvent) => boolean | void):void\n\t{\n\t\tthis.el.addEventListener('change', callback);\n\t}\n\tpublic onInput(callback:(event?:MouseEvent) => boolean | void):void\n\t{\n\t\tthis.el.addEventListener('input', callback);\n\t}\n\tpublic onTouchStart(callback:(event?:TouchEvent) => boolean | void):void\n\t{\n\t\tthis.el.addEventListener('touchstart', callback);\n\t}\n\tpublic onTouchMove(callback:(event?:TouchEvent) => boolean | void):void\n\t{\n\t\tthis.el.addEventListener('touchmove', callback);\n\t}\n\tpublic onTouchCancel(callback:(event?:TouchEvent) => boolean | void):void\n\t{\n\t\tthis.el.addEventListener('touchcancel', callback);\n\t}\n\tpublic onTouchEnd(callback:(event?:TouchEvent) => boolean | void):void\n\t{\n\t\tthis.el.addEventListener('touchend', callback);\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2020 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {DOM, dom, domLegacy} from './dom';\nimport {Size} from './Geom';\nimport {Vec} from './Vec';\n\n/*\n\tGeneral purpose functions. Note that these are not in the WebMolKit namespace.\n*/\n\n//export declare var $:JQueryStatic;\n\n// string-to-number: control the behaviour when invalid\nexport function safeInt(str:string, def:number = 0):number\n{\n\tif (str == null || str.length == 0) return def;\n\tlet val = str.startsWith('0x') ? parseInt(str.substring(2), 16) :\n\t\t\tstr.startsWith('#') ? parseInt(str.substring(1), 16) : parseInt(str);\n\treturn isNaN(val) ? def : val;\n}\nexport function safeFloat(str:string, def:number = 0):number\n{\n\tif (str == null || str.length == 0) return def;\n\tlet val = parseFloat(str);\n\treturn isNaN(val) ? def : val;\n}\n\n// creates a new element, with a specific parent (raw or jQuery); returns the child node - the raw DOM element, not the\n// jQuery wrapper\nexport function newElement(parent:any, tag:string, attr?:Record<string, any>):Element\n{\n\t/*let el = $(`<${tag}>`);\n\tif (attr) el.attr(attr);\n\t$(parent).append(el);\n\treturn el[0];*/\n\n\tlet domNew = dom(`<${tag}/>`);\n\tif (attr) domNew.attr(attr);\n\tdomLegacy(parent).append(domNew);\n\treturn domNew.el;\n}\n\n// appends child text to the node\nexport function addText(parent:any, text:string)\n{\n\tlet el = dom(parent).el;\n\tel.appendChild(document.createTextNode(text));\n}\n\n// convenience function for adding the plural modifier, i.e. \"1 thing\" vs \"N things\"\nexport function plural(count:number):string\n{\n\treturn count == 1 ? '' : 's';\n}\n\n// turns a number into a floating point representation with a maximum number of significant figures\nexport function formatDouble(value:number, sigfig:number):string\n{\n\tif (value == null) return '';\n\tlet str = value.toPrecision(sigfig);\n\tif (str.indexOf('.') > 0)\n\t{\n\t\twhile (str.endsWith('0')) str = str.substring(0, str.length - 1);\n\t\tif (str.endsWith('.')) str = str.substring(0, str.length - 1);\n\t}\n\treturn str;\n}\n\n// turns an HTML-style colour (#RRGGBB) into its numeric equivalent (0xRRGGBB), or null if invalid\nexport function htmlToRGB(col:string):number\n{\n\tif (col == null || col.charAt(0) != '#' || col.length != 7) return null;\n\treturn parseInt(col.substring(1), 16);\n}\n\n// converts an integer colour (0xTTRRGGBB) to the HTML style; transparency info is stripped out\nexport function colourCode(col:number):string\n{\n\tlet hex = (col & 0xFFFFFF).toString(16);\n\twhile (hex.length < 6) hex = '0' + hex;\n\treturn '#' + hex;\n}\n// returns the alpha value for a colour, assuming that it is an integer of the 0xTTRRGGBB format\nexport function colourAlpha(col:number):number\n{\n\tlet transp = (col >>> 24) & 0xFF;\n\treturn transp == 0 ? 1 : transp == 0xFF ? 0 : 1 - (transp * (1.0 / 255));\n}\n// turns a TRGB integer into the style used by the canvas node\nconst ONE_OVER_255 = 1.0 / 255;\nexport function colourCanvas(col:number):string\n{\n\t// simple cases first\n\tif (col == 0xFFFFFF) return 'white';\n\tif (col == 0x000000) return 'black';\n\tif (col == -1) return null; //return 'rgba(0,0,0,0)';\n\tif (col >= 0 && col <= 0xFFFFFF) return colourCode(col);\n\n\t// if there's transparency, use the long-winded syntax\n\tconst t = ((col >> 24) & 0xFF) * ONE_OVER_255;\n\tconst r = ((col >> 16) & 0xFF);// * ONE_OVER_255;\n\tconst g = ((col >> 8) & 0xFF);// * ONE_OVER_255;\n\tconst b = (col & 0xFF);// * ONE_OVER_255;\n\treturn 'rgba(' + r + ',' + g + ',' + b + ',' + (1 - t) + ')';\n}\n\n// RGB manipulation: very convenient functions for \"smearing\" between fractional values\nexport function blendRGB(fract:number, rgb1:number, rgb2:number, rgb3?:number):number\n{\n\tfract = Math.max(0, Math.min(1, fract));\n\n\tlet r1 = ((rgb1 >> 16) & 0xFF) * ONE_OVER_255, g1 = ((rgb1 >> 8) & 0xFF) * ONE_OVER_255, b1 = (rgb1 & 0xFF) * ONE_OVER_255;\n\tlet r2 = ((rgb2 >> 16) & 0xFF) * ONE_OVER_255, g2 = ((rgb2 >> 8) & 0xFF) * ONE_OVER_255, b2 = (rgb2 & 0xFF) * ONE_OVER_255;\n\tlet R:number, G:number, B:number;\n\n\tif (rgb3 == null)\n\t{\n\t\tlet f1 = 1 - fract, f2 = fract;\n\t\tR = Math.round(0xFF * (f1 * r1 + f2 * r2));\n\t\tG = Math.round(0xFF * (f1 * g1 + f2 * g2));\n\t\tB = Math.round(0xFF * (f1 * b1 + f2 * b2));\n\t}\n\telse\n\t{\n\t\tlet r3 = ((rgb3 >> 16) & 0xFF) * ONE_OVER_255, g3 = ((rgb3 >> 8) & 0xFF) * ONE_OVER_255, b3 = (rgb3 & 0xFF) * ONE_OVER_255;\n\n\t\tif (fract < 0.5)\n\t\t{\n\t\t\tlet f2 = fract * 2, f1 = 1 - f2;\n\t\t\tR = Math.round(0xFF * (f1 * r1 + f2 * r2));\n\t\t\tG = Math.round(0xFF * (f1 * g1 + f2 * g2));\n\t\t\tB = Math.round(0xFF * (f1 * b1 + f2 * b2));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet f2 = (fract - 0.5) * 2, f1 = 1 - f2;\n\t\t\tR = Math.round(0xFF * (f1 * r2 + f2 * r3));\n\t\t\tG = Math.round(0xFF * (f1 * g2 + f2 * g3));\n\t\t\tB = Math.round(0xFF * (f1 * b2 + f2 * b3));\n\t\t}\n\t}\n\n\treturn (R << 16) | (G << 8) | B;\n}\n\n// formats date nicely, as dd-mon-yyyy\nexport function formatDate(date:Date):string\n{\n\tconst MONTHS = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n\tlet day = date.getDate(), mon = date.getMonth(), year = date.getFullYear();\n\treturn day + '-' + MONTHS[mon] + '-' + year;\n}\n\n// goes through all text-node children and splices them together\nexport function nodeText(node:Node):string\n{\n\tlet ret = '';\n\tif (!node) return '';\n\tnode = node.firstChild;\n\twhile (node)\n\t{\n\t\tif (node.nodeType == 3 || node.nodeType == 4) ret += node.nodeValue;\n\t\tnode = node.nextSibling;\n\t}\n\treturn ret;\n}\n\n// convenience functions to abstract the unreasonably longwinded closures function\nexport function isDef(v:any):boolean\n{\n\treturn !(v === null || typeof v === 'undefined');\n}\nexport function notDef(v:any):boolean\n{\n\treturn v === null || typeof v === 'undefined';\n}\n\n// given a particular event, picks out the (x,y) coordinates, and offsets them until they are in the space of the given\n// node container, which must be a parent\nexport function eventCoords(event:MouseEvent | Touch, container:any):number[]\n{\n\tlet pos = domLegacy(container).offset();\n\tlet relX = event.pageX - pos.x;\n\tlet relY = event.pageY - pos.y;\n\treturn [relX, relY];\n}\n\n// sets an object's position by pixel: convenience function otherwise rather ugly code; assumes that the positioning style already configured as needed\nexport function setBoundaryPixels(dom:DOM, x:number, y:number, w:number, h:number):void\n{\n\tdom.css({'left': x + 'px', 'top': y + 'px', 'width': w + 'px', 'height': h + 'px'});\n}\n\n// return the object's screen position as [x, y, w, h]\nexport function getBoundaryPixelsDOM(dom:DOM):[number, number, number, number]\n{\n\tlet offset = dom.offset();\n\treturn [offset.x, offset.y, dom.width(), dom.height()];\n}\n\n// return the object's position and size relative to its parent\nexport function getOffsetPixelsDOM(dom:DOM):[number, number, number, number]\n{\n\treturn [dom.elHTML.offsetLeft, dom.elHTML.offsetTop, dom.elHTML.offsetWidth, dom.elHTML.offsetHeight];\n}\n\n// geometry functions\nexport function norm_xy(dx:number, dy:number):number\n{\n\t//return Math.sqrt(dx * dx + dy * dy);\n\treturn Math.hypot(dx, dy);\n}\nexport function norm_xyz(dx:number, dy:number, dz:number):number\n{\n\t//return Math.sqrt(dx * dx + dy * dy + dz * dz);\n\treturn Math.hypot(dx, dy, dz);\n}\nexport function norm2_xy(dx:number, dy:number):number\n{\n\treturn dx * dx + dy * dy;\n}\nexport function norm2_xyz(dx:number, dy:number, dz:number):number\n{\n\treturn dx * dx + dy * dy + dz * dz;\n}\n\n// converts a floating point number fo -1,0,1 depending on sign or lack thereof\nexport function signum(v:number):number\n{\n\treturn v < 0 ? -1 : v > 0 ? 1 : 0;\n}\n\n// miscellaneous math\nexport function sqr(v:number):number\n{\n\treturn v * v;\n}\nexport function invZ(v:number):number {return v == 0 ? 0 : 1.0 / v;}\n\n// returns true if the numbers are effectively equal, assuming float/double precision\nexport function fltEqual(v1:number, v2:number) {return v1 == v2 || Math.abs(v1 - v2) <= 1E-7 * Math.max(v1, v2);}\nexport function realEqual(v1:number, v2:number) {return v1 == v2 || Math.abs(v1 - v2) <= 1E-14 * Math.max(v1, v2);}\n\n// returns a random integer between 0 and size-1\nexport function randomInt(size:number):number\n{\n\tif (size <= 1) return 0;\n\treturn Math.floor(Math.random() * size);\n}\n\n// angle helpers\nexport const TWOPI = 2 * Math.PI;\nexport const INV_TWOPI = 1.0 / TWOPI;\nexport const DEGRAD = Math.PI / 180;\nexport const RADDEG = 180 / Math.PI;\n\n// normalised angle, guaranteed to be -PI <= th < PI\nexport function angleNorm(th:number):number\n{\n\tif (th == -Math.PI) return Math.PI;\n\tif (th < -Math.PI) {let mod = Math.ceil((-th - Math.PI) * INV_TWOPI); return th + mod * TWOPI;}\n\tif (th > Math.PI) {let mod = Math.ceil((th - Math.PI) * INV_TWOPI); return th - mod * TWOPI;}\n\treturn th;\n}\n\n// angular difference, guaranteed to be normalised (-PI <= th < PI); think of it as {th1 - th2}\nexport function angleDiff(th1:number, th2:number):number\n{\n\tlet theta = angleNorm(th1) - angleNorm(th2);\n\treturn theta - (theta > Math.PI ? TWOPI : 0) + (theta <= -Math.PI ? TWOPI : 0);\n}\n\n// angular difference, which is normalised from 0 <= th < 2 * PI\nexport function angleDiffPos(th1:number, th2:number):number\n{\n\tlet theta = angleNorm(th1) - angleNorm(th2);\n\treturn theta + (theta < 0 ? TWOPI : 0);\n}\n\n// for an array of angles (in radians), sorts them in order; then, rotates the array around as many times as is necessary\n// so that the difference between the first & last angles is >= than the difference between the first & second\nexport function sortAngles(theta:number[]):number[]\n{\n\tif (theta == null || theta.length < 2) return theta;\n\ttheta = theta.slice(0);\n\tfor (let n = 0; n < theta.length; n++) theta[n] = angleNorm(theta[n]);\n\tVec.sort(theta);\n\twhile (true)\n\t{\n\t\tlet a = theta[theta.length - 1], b = theta[0], c = theta[1];\n\t\tif (angleDiff(b, a) <= angleDiff(c, b)) break;\n\t\tfor (let n = theta.length - 1; n > 0; n--) theta[n] = theta[n - 1];\n\t\ttheta[0] = a;\n\t}\n\treturn theta;\n}\n\n// calculates a list of unique angles (based on the threshold parameter, in radians), and returns it; the returned list of\n// angles will be sorted in order, as described by sortAngles(..); note that there is no fancy clustering, so a sequence of\n// angles which are a bit below the threshold is not guaranteed to be stable; there is also a boundary case which bumps the\n// sort rotation status slightly out of whack\nexport function uniqueAngles(theta:number[], threshold:number):number[]\n{\n\ttheta = sortAngles(theta);\n\tfor (let n = 1; n < theta.length; n++)\n\t{\n\t\tif (Math.abs(angleDiff(theta[n], theta[n - 1])) <= threshold) {theta.splice(n, 1); n--;}\n\t}\n\treturn theta;\n}\n\n// array bounds\nexport function minArray(a:number[]):number\n{\n\tif (a == null || a.length == 0) return 0;\n\tlet v = a[0];\n\tfor (let n = 1; n < a.length; n++) v = Math.min(v, a[n]);\n\treturn v;\n}\nexport function maxArray(a:number[]):number\n{\n\tif (a == null || a.length == 0) return 0;\n\tlet v = a[0];\n\tfor (let n = 1; n < a.length; n++) v = Math.max(v, a[n]);\n\treturn v;\n}\n\n// convenience function: finds a child node by name\nexport function findNode(parent:Node, name:string):Element\n{\n\tif (parent == null) return null;\n\tlet node = parent.firstChild;\n\twhile (node)\n\t{\n\t\tif (/*node.nodeType == Node.ELEMENT_NODE &&*/ node.nodeName == name) return node as Element;\n\t\tnode = node.nextSibling as any;\n\t}\n\treturn null;\n}\n\n// as above, but returns a list; may be empty\nexport function findNodes(parent:Node, name:string):Element[]\n{\n\tif (parent == null) return null;\n\tlet node = parent.firstChild;\n\tlet list:Element[] = [];\n\twhile (node)\n\t{\n\t\tif (/*node.nodeType == Node.ELEMENT_NODE &&*/ node.nodeName == name) list.push(node as Element);\n\t\tnode = node.nextSibling as any;\n\t}\n\treturn list;\n}\n\n// creates a rounded rectangle path using splines\nexport function pathRoundedRect(x1:number, y1:number, x2:number, y2:number, rad:number):Path2D\n{\n\tlet path = new Path2D();\n\tpath.moveTo(x2 - rad, y1);\n\tpath.quadraticCurveTo(x2, y1, x2, y1 + rad);\n\tpath.lineTo(x2, y2 - rad);\n\tpath.quadraticCurveTo(x2, y2, x2 - rad, y2);\n\tpath.lineTo(x1 + rad, y2);\n\tpath.quadraticCurveTo(x1, y2, x1, y2 - rad);\n\tpath.lineTo(x1, y1 + rad);\n\tpath.quadraticCurveTo(x1, y1, x1 + rad, y1);\n\tpath.closePath();\n\treturn path;\n}\n\n// returns a rounded rect definition w. control points\nexport function coordsRoundedRect(x1:number, y1:number, x2:number, y2:number, rad:number):[number[], number[], boolean[]]\n{\n\tlet px = [x2 - rad, x2, x2, x2, x2, x2 - rad, x1 + rad, x1, x1, x1, x1, x1 + rad];\n\tlet py = [y1, y1, y1 + rad, y2 - rad, y2, y2, y2, y2, y2 - rad, y1 + rad, y1, y1];\n\tlet ctrl = [false, true, false, false, true, false, false, true, false, false, true, false];\n\treturn [px, py, ctrl];\n}\n\n// convenience functions\nexport function drawLine(ctx:CanvasRenderingContext2D, x1:number, y1:number, x2:number, y2:number)\n{\n\tctx.beginPath();\n\tctx.moveTo(x1, y1);\n\tctx.lineTo(x2, y2);\n\tctx.stroke();\n}\n\n// for HTML canvas, approximates the conversion of height to ascent ratio (i.e. pass in ascent * ASCENT_FUDGE to the font height)\nexport const ASCENT_FUDGE = 1.4;\nexport function fontSansSerif(ascent:number) {return `${ascent * ASCENT_FUDGE}px sans-serif`;}\n\n// returns the density of pixels, i.e. 1 for a regular screen, 2 for retina, etc.\nexport function pixelDensity():number\n{\n\tif ('devicePixelRatio' in window && window.devicePixelRatio > 1) return window.devicePixelRatio;\n\treturn 1;\n}\n\n// performs a shallow copy of the object: the top level guarantees new objects, while anything below that may contain\n// duplicate references with potential mutability issues\nexport function clone<T>(data:T):T\n{\n\tif (data == null) return null;\n\tif (Array.isArray(data)) return (data as any).slice(0) as T;\n\tif (typeof data != 'object') return data;\n\tlet result:any = {};\n\tfor (let key in data) result[key] = data[key];\n\treturn result as T;\n}\n\n// performs a deep clone of any kind of object: goes as deep as it has to to make sure everything is immutable; the parameter\n// should not contain functions or host objects\nexport function deepClone<T>(data:T):T\n{\n\tif (data == null) return null;\n\tif (typeof data == 'function') return null;\n\tif (typeof data != 'object') return data;\n\n\tlet result:any = Array.isArray(data) ? [] : {};\n\tfor (let key in data)\n\t{\n\t\tlet val = data[key];\n\t\tresult[key] = typeof val === 'object' ? deepClone(val) : val;\n\t}\n\treturn result as T;\n}\n\n// HTML-to-escape; gets most of the basics\nexport function escapeHTML(text:string):string\n{\n\tif (!text) return '';\n\tconst map:Record<string, string> = {'&': '&amp;', '<': '&lt;', '>': '&gt;', '\"': '&quot;', \"'\": '&#039;'};\n\treturn text.replace(/[&<>\"']/g, (m) => map[m]);\n}\n\n// convenience: make sure a string isn't null\nexport function orBlank(str:string):string {return str == null ? '' : str;}\n\n// abstracts values into an array; this will be obsolete once Object.values() makes it into the typescript mappings\nexport function dictValues<T>(dict:{[id:string] : T}):T[]\n{\n\tlet list:T[] = [];\n\tfor (let key in dict) list.push(dict[key]);\n\treturn list;\n}\n\n// iterate over two arrays at the same time\nexport function zip<U, V>(u:U[], v:V[]):[U, V][]\n{\n\treturn u.map((a, i) => [a, v[i]]);\n}\n\n// converts a string (which is stored by JavaScript as UCS2) to UTF8, where each character is guaranteed to be 1 byte\nexport function toUTF8(str:string):string\n{\n\tlet data:string[] = [], stripe = '';\n\tconst sz = str.length;\n\tfor (let n = 0; n < sz; n++)\n\t{\n\t\tlet charcode = str.charCodeAt(n);\n\t\tif (charcode < 0x80) stripe += str.charAt(n);\n\t\telse if (charcode < 0x800)\n\t\t{\n\t\t\tstripe += String.fromCharCode(0xc0 | (charcode >> 6));\n\t\t\tstripe += String.fromCharCode(0x80 | (charcode & 0x3F));\n\t\t}\n\t\telse if (charcode < 0xd800 || charcode >= 0xe000)\n\t\t{\n\t\t\tstripe += String.fromCharCode(0xe0 | (charcode >> 12));\n\t\t\tstripe += String.fromCharCode(0x80 | ((charcode >> 6) & 0x3F));\n\t\t\tstripe += String.fromCharCode(0x80 | (charcode & 0x3F));\n\t\t}\n\t\telse // surrogate pair\n\t\t{\n\t\t\tn++;\n\t\t\tcharcode = 0x10000 + (((charcode & 0x3FF) << 10) | (str.charCodeAt(n) & 0x3FF));\n\t\t\tstripe += String.fromCharCode(0xf0 | (charcode >> 18));\n\t\t\tstripe += String.fromCharCode(0x80 | ((charcode >> 12) & 0x3F));\n\t\t\tstripe += String.fromCharCode(0x80 | ((charcode >> 6) & 0x3F));\n\t\t\tstripe += String.fromCharCode(0x80 | (charcode & 0x3F));\n\t\t}\n\t\tif (stripe.length > 100)\n\t\t{\n\t\t\tdata.push(stripe);\n\t\t\tstripe = '';\n\t\t}\n\t}\n\tdata.push(stripe);\n\treturn data.join('');\n}\n\n// converts a UTF8 string to a regular JavaScript string (which is UCS2-encoded)\nexport function fromUTF8(str:string):string\n{\n\tlet data:string[] = [], stripe = '';\n\tconst sz = str.length;\n\tfor (let n = 0; n < sz; n++)\n\t{\n\t\tlet value = str.charCodeAt(n);\n\t\tif (value < 0x80) stripe += str.charAt(n);\n\t\telse if (value > 0xBF && value < 0xE0)\n\t\t{\n\t\t\tstripe += String.fromCharCode((value & 0x1F) << 6 | str.charCodeAt(n + 1) & 0x3F);\n\t\t\tn++;\n\t\t}\n\t\telse if (value > 0xDF && value < 0xF0)\n\t\t{\n\t\t\tstr += String.fromCharCode((value & 0x0F) << 12 | (str.charCodeAt(n + 1) & 0x3F) << 6 | str.charCodeAt(n + 2) & 0x3F);\n\t\t\tn += 2;\n\t\t}\n\t\telse // surrogate pair\n\t\t{\n\t\t\tlet charCode = ((value & 0x07) << 18 | (str.charCodeAt(n + 1) & 0x3F) << 12 | (str.charCodeAt(n + 2) & 0x3F) << 6 | str.charCodeAt(n + 3) & 0x3F) - 0x010000;\n\t\t\tstripe += String.fromCharCode(charCode >> 10 | 0xD800, charCode & 0x03FF | 0xDC00);\n\t\t\tn += 3;\n\t\t}\n\t\tif (stripe.length > 100)\n\t\t{\n\t\t\tdata.push(stripe);\n\t\t\tstripe = '';\n\t\t}\n\t}\n\tdata.push(stripe);\n\treturn data.join('');\n}\n\n// returns a pretty-printed JSON representation with tabs and aligned braces (Allman/ANSI-style) rather than the kack-braced default\nexport function jsonPrettyPrint(json:any):string\n{\n\tlet lines = JSON.stringify(json, null, 1).split(/\\n/);\n\tfor (let n = 0; n < lines.length; n++)\n\t{\n\t\tlines[n] = lines[n].trim();\n\t\tif (lines[n].length > 1 && (lines[n].endsWith('{') || lines[n].endsWith('[')))\n\t\t{\n\t\t\tlet ch = lines[n].charAt(lines[n].length - 1);\n\t\t\tlines[n] = lines[n].substring(0, lines[n].length - 1);\n\t\t\tlines.splice(n + 1, 0, ch);\n\t\t\tn--;\n\t\t}\n\t}\n\tlet indent = 0;\n\tfor (let n = 0; n < lines.length; n++)\n\t{\n\t\tlet orig = lines[n];\n\t\tif (orig == ']' || orig == '}' || orig == '],' || orig == '},') indent--;\n\t\tlines[n] = '\\t'.repeat(indent) + orig;\n\t\tif (orig == '[' || orig == '{') indent++;\n\t}\n\treturn lines.join('\\n');\n}\n\n// special keycodes, which correspond to KeyboardEvent.key: for the most part anything that is written on the keyboard as a single character can\n// be used literally (e.g. things like 1 , < [ {); these named constants are not all self-explanatory\nexport const enum KeyCode\n{\n\tBackspace = 'Backspace',\n\tTab = 'Tab',\n\tEnter = 'Enter',\n\tEscape = 'Escape',\n\tSpace = ' ',\n\tPageUp = 'PageUp',\n\tPageDown = 'PageDown',\n\tEnd = 'End',\n\tHome = 'Home',\n\tLeft = 'ArrowLeft',\n\tRight = 'ArrowRight',\n\tUp = 'ArrowUp',\n\tDown = 'ArrowDown',\n\tDelete = 'Delete',\n\tInsert = 'Insert',\n}\n\n// fetches the contents of a file, referenced via URL, and presumed to be text formatted; conveniently wrapped in an async promise; note that a failure\n// of any kind returns null\nexport async function readTextURL(url:string | URL):Promise<string>\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tlet request = new XMLHttpRequest();\n\t\trequest.open('GET', url.toString(), true);\n\t\trequest.responseType = 'text';\n\t\trequest.onload = () => resolve(request.response.toString());\n\t\trequest.onerror = () => /*reject('Failed to request URL: ' + url)*/ resolve(null);\n\t\trequest.send();\n\t});\n}\n\n// calls a service with the POST method, sending a JSON object, and expects a JSON object in return; will throw an exception on failure\nexport async function postJSONURL(url:string | URL, params:Record<string, any>):Promise<Record<string, any>>\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tlet request = new XMLHttpRequest();\n\t\trequest.open('POST', url.toString(), true);\n\t\trequest.responseType = 'text';\n\t\trequest.onload = () =>\n\t\t{\n\t\t\tlet txt = request.response.toString();\n\t\t\ttry {resolve(JSON.parse(txt));}\n\t\t\tcatch (ex)\n\t\t\t{\n\t\t\t\tlet snippet = txt.substring(0, Math.min(200, txt.length)) + (txt.length > 200 ? '...etc...' : '');\n\t\t\t\treject('JSON parsing error on result:' + ex + ' for text: ' + snippet);\n\t\t\t}\n\t\t};\n\t\trequest.onerror = () => reject('Failed to request URL: ' + url);\n\t\trequest.send(JSON.stringify(params));\n\t});\n}\n\n// convenience function that yields the execution state, providing the DOM with a chance to update the screen; this is\n// not necessarily sufficient to provide a responsive UI for grinding calculation, but it can at least be useful to\n// refresh status\nexport async function yieldDOM():Promise<void>\n{\n\treturn new Promise<void>((resolve) => setTimeout(() => resolve()));\n}\n\n// pauses for some number of seconds, within an async block\nexport async function pause(seconds:number):Promise<void>\n{\n\treturn new Promise<void>((resolve) => setTimeout(() => resolve(), seconds * 1000));\n}\n\n// practical workaround for figuring out how much space the scrollers will used when realised; on Mac-like or mobile platforms this will generally be zero,\n// whereas for Windows/Linux-like platforms it's usually around 20 pixels or so; it will finagle the DOM invisibly the first time it is called\nlet staticScrollerSize:Size = null;\nexport function empiricalScrollerSize():Size\n{\n\tif (staticScrollerSize) return staticScrollerSize;\n\n\tlet outer = dom('<div/>').css({'visibility': 'hidden', 'width': '100px', 'height': '100px', 'overflow': 'scroll'}).appendTo(dom(document.body));\n\tlet inner = dom('<div/>').css({'width': '100%', 'height': '100%'}).appendTo(outer);\n\tstaticScrollerSize = new Size(100 - inner.elHTML.offsetWidth, 100 - inner.elHTML.offsetHeight);\n\touter.remove();\n\treturn staticScrollerSize;\n}\n\n// returns # of permutations between the two strings, where 0 means that the two strings are identical; strings are case sensitive;\n// performance isn't linear, so be careful with rate limiting steps\nexport function stringSimilarityPermutations(str1:string, str2:string):number\n{\n\tif (!str1 || !str2) return 0;\n\tconst ch1 = Array.from(str1), len1 = ch1.length;\n\tconst ch2 = Array.from(str2), len2 = ch2.length;\n\n\tlet levenshteinDistance = (sz1:number, sz2:number):number =>\n\t{\n\t\tlet dist:number[][] = [];\n\t\tfor (let i = 0; i <= sz1; i++)\n\t\t{\n\t\t\tdist.push(Vec.numberArray(0, sz2 + 1));\n\t\t\tdist[i][0] = i;\n\t\t}\n\t\tfor (let j = 1; j <= sz2; j++) dist[0][j] = j;\n\n\t\tfor (let j = 1; j <= sz2; j++) for (let i = 1; i <= sz1; i++)\n\t\t{\n\t\t\tlet cost = ch1[i - 1] == ch2[j - 1] ? 0 : 1;\n\t\t\tdist[i][j] = Math.min(Math.min(dist[i - 1][j] + 1, dist[i][j - 1] + 1), dist[i - 1][j - 1] + cost);\n\t\t}\n\t\treturn dist[sz1][sz2];\n\t};\n\n\tlet cost = ch1[len1 - 1] == ch2[len2 - 1] ? 0 : 1;\n\tlet lev1 = levenshteinDistance(len1 - 1, len2) + 1;\n\tlet lev2 = levenshteinDistance(len1, len2 - 1) + 1;\n\tlet lev3 = levenshteinDistance(len1 - 1, len2 - 1) + cost;\n\treturn Math.min(Math.min(lev1, lev2), lev3);\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\n/* eslint-disable comma-spacing, no-multi-spaces */\n/* eslint-disable @typescript-eslint/naming-convention */\n\nexport class Chemistry\n{\n\t// NOTE: the value of ELEMENTS.length is the number of elements supported by MMTk; all atom number indices should be between\n\t// 1 and this range, or 0 to represent an entity which is not a single specific element\n\n\tpublic static ELEMENTS =\n\t[\n\t\tnull,\n\t\t'H',                                                                                 'He',\n\t\t'Li','Be',                                                  'B', 'C', 'N', 'O', 'F', 'Ne',\n\t\t'Na','Mg',                                                  'Al','Si','P', 'S', 'Cl','Ar',\n\t\t'K', 'Ca','Sc','Ti','V' ,'Cr','Mn','Fe','Co','Ni','Cu','Zn','Ga','Ge','As','Se','Br','Kr',\n\t\t'Rb','Sr','Y', 'Zr','Nb','Mo','Tc','Ru','Rh','Pd','Ag','Cd','In','Sn','Sb','Te','I', 'Xe',\n\t\t'Cs','Ba',\n\t\t\t\t'La','Ce','Pr','Nd','Pm','Sm','Eu','Gd','Tb','Dy','Ho','Er','Tm','Yb',\n\t\t\t\t\t 'Lu','Hf','Ta','W', 'Re','Os','Ir','Pt','Au','Hg','Tl','Pb','Bi','Po','At','Rn',\n\t\t'Fr','Ra',\n\t\t\t\t'Ac','Th','Pa','U', 'Np','Pu','Am','Cm','Bk','Cf','Es','Fm','Md','No',\n\t\t\t\t\t 'Lr','Rf','Db','Sg','Bh','Hs','Mt','Ds','Rg','Cn'\n\t];\n\n\t// which group of the periodic table each element belongs to, where the lanthanoids & actanoids are group III\n\tpublic static ELEMENT_GROUPS =\n\t[\n\t\t0,\n\t\t1,                                        18,\n\t\t1,2,                       13,14,15,16,17,18,\n\t\t1,2,                       13,14,15,16,17,18,\n\t\t1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,\n\t\t1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,\n\t\t1,2,\n\t\t\t\t\t\t3,3,3,3,3,3,3,3,3,3,3,3,3,3,\n\t\t\t3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,\n\t\t1,2,\n\t\t\t\t\t\t3,3,3,3,3,3,3,3,3,3,3,3,3,3,\n\t\t\t3,4,5,6,7,8,9,10,11,12\n\t];\n\n\t// which row of the periodic table each element belongs to, where lanthanoids & actanoids take their parent row\n\tpublic static ELEMENT_ROWS =\n\t[\n\t\t0,\n\t\t1,                                1,\n\t\t2,2,                    2,2,2,2,2,2,\n\t\t3,3,                    3,3,3,3,3,3,\n\t\t4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,\n\t\t5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,\n\t\t6,6,\n\t\t\t\t\t\t6,6,6,6,6,6,6,6,6,6,6,6,6,6,\n\t\t\t6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,\n\t\t7,7,\n\t\t\t\t\t\t7,7,7,7,7,7,7,7,7,7,7,7,7,7,\n\t\t\t7,7,7,7,7,7,7,7,7,7\n\t];\n\n\t// which block of the periodic table each element belongs to, where 1=s-block, 2=p-block, 3=d-block, 4=f-block\n\tpublic static ELEMENT_BLOCKS =\n\t[\n\t\t0,\n\t\t1,                                2,\n\t\t1,1,                    2,2,2,2,2,2,\n\t\t1,1,                    2,2,2,2,2,2,\n\t\t1,1,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,\n\t\t1,1,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,\n\t\t1,1,\n\t\t\t\t\t\t4,4,4,4,4,4,4,4,4,4,4,4,4,4,\n\t\t\t3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,\n\t\t1,1,\n\t\t\t\t\t\t4,4,4,4,4,4,4,4,4,4,4,4,4,4,\n\t\t\t3,3,3,3,3,3,3,3,3,3\n\t];\n\n\t// the number of 'valence' electrons possessed by an individual uncharged atom\n\tpublic static ELEMENT_VALENCE =\n\t[\n\t\t0,\n\t\t1,                                   2,\n\t\t1,2,                       3,4,5,6,7,8,\n\t\t1,2,                       3,4,5,6,7,8,\n\t\t1,2,3,4,5,6,7,8,9,10,11,12,3,4,5,6,7,8,\n\t\t1,2,3,4,5,6,7,8,9,10,11,12,3,4,5,6,7,8,\n\t\t1,2,\n\t\t\t\t\t\t4,4,4,4,4,4,4,4,4,4,4,4,4,4,\n\t\t\t3,4,5,6,7,8,9,10,11,12,3,4,5,6,7,8,\n\t\t1,1,\n\t\t\t\t\t\t4,4,4,4,4,4,4,4,4,4,4,4,4,4,\n\t\t\t3,4,5,6,7,8,9,10,11,12\n\t];\n\n\t// the number of valence electrons typically involved in bonding, i.e. ELEMENT_VALENCE minus\n\t// the electrons dedicated to lone pairs; the concept is only really valid for main blocks\n\tpublic static ELEMENT_BONDING =\n\t[\n\t\t0,\n\t\t1,                                   0,\n\t\t1,2,                       3,4,3,2,1,0,\n\t\t1,2,                       3,4,3,2,1,0,\n\t\t1,2,3,4,5,6,7,8,9,10,11,12,3,4,3,2,1,0,\n\t\t1,2,3,4,5,6,7,8,9,10,11,12,3,4,3,2,1,0,\n\t\t1,2,\n\t\t\t\t\t\t4,4,4,4,4,4,4,4,4,4,4,4,4,4,\n\t\t\t3,4,5,6,7,8,9,10,11,12,3,4,3,2,1,0,\n\t\t1,1,\n\t\t\t\t\t\t4,4,4,4,4,4,4,4,4,4,4,4,4,4,\n\t\t\t3,4,5,6,7,8,9,10,11,12\n\t];\n\n\t// the total number of 'valence' electrons required to make up a full 'valence shell'\n\tpublic static ELEMENT_SHELL =\n\t[\n\t\t0,\n\t\t2,                                          2,\n\t\t8,8,                              8,8,8,8,8,8,\n\t\t8,8,                              8,8,8,8,8,8,\n\t\t8,8,18,18,18,18,18,18,18,18,18,18,8,8,8,8,8,8,\n\t\t8,8,18,18,18,18,18,18,18,18,18,18,8,8,8,8,8,8,\n\t\t8,8,\n\t\t\t\t\t\t18,18,18,18,18,18,18,18,18,18,18,18,18,18,\n\t\t\t18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,\n\t\t8,8,\n\t\t\t\t\t\t18,18,18,18,18,18,18,18,18,18,18,18,18,18,\n\t\t\t18,18,18,18,18,18,18,18,18,18\n\t];\n\n\tpublic static NATURAL_ATOMIC_WEIGHTS =\n\t[\n\t\t0,1.00794,4.002602,6.941,9.012182,10.811,12.0107,14.0067,15.9994,18.9984032,20.1797,\n\t\t22.989770,24.3050,26.981538,28.0855,30.973761,32.065,35.453,39.948,39.0983,40.078,\n\t\t44.955910,47.867,50.9415,51.9961,54.938049,55.845,58.933200,58.6934,63.546,65.409,\n\t\t69.723,72.64,74.92160,78.96,79.904,83.798,85.4678,87.62,88.90585,91.224,92.90638,\n\t\t95.94,98,101.07,102.90550,106.42,107.8682,112.411,114.818,118.710,121.760,127.60,\n\t\t126.90447,131.293,132.90545,137.327,138.9055,140.116,140.90765,144.24,145,150.36,\n\t\t151.964,157.25,158.92534,162.500,164.93032,167.259,168.93421,173.04,174.967,178.49,\n\t\t180.9479,183.84,186.207,190.23,192.217,195.078,196.96655,200.59,204.3833,207.2,208.98038,\n\t\t209,210,222,223,226,227,230.0331266,231.03588,233.039628,237,244,243,247,247,251,252,257,\n\t\t258,259,262,261,262,266,264,277,268,271,272,285\n\t];\n\n\t// readable constants for elements\n\tpublic static ELEMENT_H = 1;\n\tpublic static ELEMENT_He = 2;\n\tpublic static ELEMENT_Li = 3;\n\tpublic static ELEMENT_Be = 4;\n\tpublic static ELEMENT_B = 5;\n\tpublic static ELEMENT_C = 6;\n\tpublic static ELEMENT_N = 7;\n\tpublic static ELEMENT_O = 8;\n\tpublic static ELEMENT_F = 9;\n\tpublic static ELEMENT_Ne = 10;\n\tpublic static ELEMENT_Na = 11;\n\tpublic static ELEMENT_Mg = 12;\n\tpublic static ELEMENT_Al = 13;\n\tpublic static ELEMENT_Si = 14;\n\tpublic static ELEMENT_P = 15;\n\tpublic static ELEMENT_S = 16;\n\tpublic static ELEMENT_Cl = 17;\n\tpublic static ELEMENT_Ar = 18;\n\tpublic static ELEMENT_K = 19;\n\tpublic static ELEMENT_Ca = 20;\n\tpublic static ELEMENT_Sc = 21;\n\tpublic static ELEMENT_Ti = 22;\n\tpublic static ELEMENT_V = 23;\n\tpublic static ELEMENT_Cr = 24;\n\tpublic static ELEMENT_Mn = 25;\n\tpublic static ELEMENT_Fe = 26;\n\tpublic static ELEMENT_Co = 27;\n\tpublic static ELEMENT_Ni = 28;\n\tpublic static ELEMENT_Cu = 29;\n\tpublic static ELEMENT_Zn = 30;\n\tpublic static ELEMENT_Ga = 31;\n\tpublic static ELEMENT_Ge = 32;\n\tpublic static ELEMENT_As = 33;\n\tpublic static ELEMENT_Se = 34;\n\tpublic static ELEMENT_Br = 35;\n\tpublic static ELEMENT_Kr = 36;\n\tpublic static ELEMENT_Rb = 37;\n\tpublic static ELEMENT_Sr = 38;\n\tpublic static ELEMENT_Y = 39;\n\tpublic static ELEMENT_Zr = 40;\n\tpublic static ELEMENT_Nb = 41;\n\tpublic static ELEMENT_Mo = 42;\n\tpublic static ELEMENT_Tc = 43;\n\tpublic static ELEMENT_Ru = 44;\n\tpublic static ELEMENT_Rh = 45;\n\tpublic static ELEMENT_Pd = 46;\n\tpublic static ELEMENT_Ag = 47;\n\tpublic static ELEMENT_Cd = 48;\n\tpublic static ELEMENT_In = 49;\n\tpublic static ELEMENT_Sn = 50;\n\tpublic static ELEMENT_Sb = 51;\n\tpublic static ELEMENT_Te = 52;\n\tpublic static ELEMENT_I = 53;\n\tpublic static ELEMENT_Xe = 54;\n\tpublic static ELEMENT_Cs = 55;\n\tpublic static ELEMENT_Ba = 56;\n\tpublic static ELEMENT_La = 57;\n\tpublic static ELEMENT_Ce = 58;\n\tpublic static ELEMENT_Pr = 59;\n\tpublic static ELEMENT_Nd = 60;\n\tpublic static ELEMENT_Pm = 61;\n\tpublic static ELEMENT_Sm = 62;\n\tpublic static ELEMENT_Eu = 63;\n\tpublic static ELEMENT_Gd = 64;\n\tpublic static ELEMENT_Tb = 65;\n\tpublic static ELEMENT_Dy = 66;\n\tpublic static ELEMENT_Ho = 67;\n\tpublic static ELEMENT_Er = 68;\n\tpublic static ELEMENT_Tm = 69;\n\tpublic static ELEMENT_Yb = 70;\n\tpublic static ELEMENT_Lu = 71;\n\tpublic static ELEMENT_Hf = 72;\n\tpublic static ELEMENT_Ta = 73;\n\tpublic static ELEMENT_W = 74;\n\tpublic static ELEMENT_Re = 75;\n\tpublic static ELEMENT_Os = 76;\n\tpublic static ELEMENT_Ir = 77;\n\tpublic static ELEMENT_Pt = 78;\n\tpublic static ELEMENT_Au = 79;\n\tpublic static ELEMENT_Hg = 80;\n\tpublic static ELEMENT_Tl = 81;\n\tpublic static ELEMENT_Pb = 82;\n\tpublic static ELEMENT_Bi = 83;\n\tpublic static ELEMENT_Po = 84;\n\tpublic static ELEMENT_At = 85;\n\tpublic static ELEMENT_Rn = 86;\n\tpublic static ELEMENT_Fr = 87;\n\tpublic static ELEMENT_Ra = 88;\n\tpublic static ELEMENT_Ac = 89;\n\tpublic static ELEMENT_Th = 90;\n\tpublic static ELEMENT_Pa = 91;\n\tpublic static ELEMENT_U = 92;\n\tpublic static ELEMENT_Np = 93;\n\tpublic static ELEMENT_Pu = 94;\n\tpublic static ELEMENT_Am = 95;\n\tpublic static ELEMENT_Cm = 96;\n\tpublic static ELEMENT_Bk = 97;\n\tpublic static ELEMENT_Cf = 98;\n\tpublic static ELEMENT_Es = 99;\n\tpublic static ELEMENT_Fm = 100;\n\tpublic static ELEMENT_Md = 101;\n\tpublic static ELEMENT_No = 102;\n\tpublic static ELEMENT_Lr = 103;\n\tpublic static ELEMENT_Rf = 104;\n\tpublic static ELEMENT_Db = 105;\n\tpublic static ELEMENT_Sg = 106;\n\tpublic static ELEMENT_Bh = 107;\n\tpublic static ELEMENT_Hs = 108;\n\tpublic static ELEMENT_Mt = 109;\n\tpublic static ELEMENT_Ds = 110;\n\tpublic static ELEMENT_Rg = 111;\n\tpublic static ELEMENT_Cn = 112;\n}\n\n","/*\n\tWebMolKit\n\n\t(c) 2010-2018 Molecular Materials Informatics, Inc.\n\n\tAll rights reserved\n\n\thttp://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Vec} from '../util/Vec';\nimport {Molecule} from './Molecule';\n\n/*\n\tRepresentation of a unidirectional graph which has simple node labels, and no edge labels. Connections are stored in neighbour\n\tlist form. Construction of the graph is faster if the number of nodes are known ahead of time. Cloning a graph instance, or\n\tbuilding it from some other graph datastructure, has minimal overhead.\n\n\tNote that all indices are 0-based.\n\n\tPractical note: the Molecule class has much analogous functionality. The Graph class is intended to be a cleaner and more\n\tlightweight implementation of algorithms which are not necessarily related to a molecular datastructure.\n\tThe Molecule class has a lot of features such as caching calculated values, which is very useful for general purpose work;\n\tthe algorithms in the Graph class have more intuitive and predictable performance characteristics, and do not have shortcuts\n\tsuch as caching.\n*/\n\nexport class Graph\n{\n\tprivate nbrs:number[][] = []; // neighbour-list, one per node\n\tprivate indices:number[] = null; // optional integer value for each node\n\tprivate labels:string[] = null; // optional string value for each node\n\tprivate props:any[] = null; // optional object for each node; is always a shallow copy\n\n\t// ----------------- public methods -----------------\n\n\tconstructor(sz?:number, edge1?:number[], edge2?:number[])\n\t{\n\t\tif (sz != null) for (let n = 0; n < sz; n++) this.nbrs.push([]);\n\t\tif (edge1 != null && edge2 != null)\n\t\t{\n\t\t\tfor (let n = 0; n < edge1.length; n++)\n\t\t\t{\n\t\t\t\tthis.nbrs[edge1[n]].push(edge2[n]);\n\t\t\t\tthis.nbrs[edge2[n]].push(edge1[n]);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic clone():Graph\n\t{\n\t\tlet g = new Graph();\n\t\tfor (let nbr of this.nbrs) g.nbrs.push(nbr.slice(0));\n\t\tg.indices = this.indices == null ? null : this.indices.slice(0);\n\t\tg.labels = this.labels == null ? null : this.labels.slice(0);\n\t\tg.props = this.props == null ? null : this.props.slice(0);\n\t\treturn g;\n\t}\n\n\t// builds a graph with the same shape as the given molecule\n\tpublic static fromMolecule(mol:Molecule):Graph\n\t{\n\t\tlet g = new Graph();\n\t\tg.indices = [];\n\t\tfor (let n = 0; n < mol.numAtoms; n++)\n\t\t{\n\t\t\tg.nbrs.push([]);\n\t\t\tg.indices.push(n + 1);\n\t\t}\n\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t{\n\t\t\tlet bfr = mol.bondFrom(n) - 1, bto = mol.bondTo(n) - 1;\n\t\t\tg.nbrs[bfr].push(bto);\n\t\t\tg.nbrs[bto].push(bfr);\n\t\t}\n\t\treturn g;\n\t}\n\n\t// when a neighbour list is already available, construction is essentially immediate; note that the neighbour list is not cloned at all,\n\t// and it may be corrupted if graph modification methods are called\n\tpublic static fromNeighbours(nbrs:number[][]):Graph\n\t{\n\t\tlet g = new Graph();\n\t\tg.nbrs = nbrs;\n\t\treturn g;\n\t}\n\n\tpublic toString():string\n\t{\n\t\tlet buff = '#nodes=' + this.nbrs.length;\n\t\tfor (let n = 0; n < this.nbrs.length; n++)\n\t\t{\n\t\t\tbuff += ' ' + n + ':{' + this.nbrs[n] + '}';\n\t\t\tif (n < Vec.len(this.indices)) buff += '[i=' + this.indices[n] + ']';\n\t\t\tif (n < Vec.len(this.labels)) buff += '[l=' + this.labels[n] + ']';\n\t\t}\n\t\treturn buff;\n\t}\n\n\tpublic get numNodes():number {return this.nbrs.length;}\n\tpublic numEdges(node:number):number {return this.nbrs[node].length;}\n\tpublic getEdge(node:number, edge:number):number {return this.nbrs[node][edge];}\n\tpublic getEdges(node:number):number[] {return this.nbrs[node];}\n\n\tpublic getIndex(node:number):number {return this.indices == null ? 0 : this.indices[node];}\n\tpublic setIndex(node:number, idx:number):void\n\t{\n\t\tif (this.indices == null) this.indices = Vec.numberArray(0, this.nbrs.length);\n\t\tthis.indices[node] = idx;\n\t}\n\n\tpublic getLabel(node:number):string {return this.labels == null ? null : this.labels[node];}\n\tpublic setLabel(node:number, lbl:string):void\n\t{\n\t\tif (this.labels == null) this.labels = Vec.stringArray('', this.nbrs.length);\n\t\tthis.labels[node] = lbl;\n\t}\n\n\tpublic getProperty(node:number):any {return this.props == null ? null : this.props[node];}\n\tpublic setProperty(node:number, prp:any):void\n\t{\n\t\tif (this.props == null) this.props = new Array(this.nbrs.length);\n\t\tthis.props[node] = prp;\n\t}\n\n\tpublic addNode():number\n\t{\n\t\tthis.nbrs.push([]);\n\t\tif (this.indices != null) this.indices.push(0);\n\t\tif (this.labels != null) this.labels.push('');\n\t\tif (this.props != null) this.props.push(null);\n\t\treturn this.nbrs.length - 1;\n\t}\n\n\tpublic hasEdge(node1:number, node2:number):boolean\n\t{\n\t\tif (this.nbrs[node1].length <= this.nbrs[node2].length)\n\t\t\treturn this.nbrs[node1].indexOf(node2) >= 0;\n\t\telse\n\t\t\treturn this.nbrs[node2].indexOf(node1) >= 0;\n\t}\n\n\tpublic addEdge(node1:number, node2:number):void\n\t{\n\t\tthis.nbrs[node1].push(node2);\n\t\tthis.nbrs[node2].push(node1);\n\t}\n\n\tpublic removeEdge(node1:number, node2:number):void\n\t{\n\t\tlet i1 = this.nbrs[node1].indexOf(node2), i2 = this.nbrs[node2].indexOf(node1);\n\t\tif (i1 >= 0) this.nbrs[node1].splice(i1, 1);\n\t\tif (i2 >= 0) this.nbrs[node2].splice(i2, 1);\n\t}\n\n\tpublic isolateNode(node:number):void\n\t{\n\t\tfor (let o of this.nbrs[node])\n\t\t{\n\t\t\tlet i = this.nbrs[o].indexOf(node);\n\t\t\tif (i >= 0) this.nbrs[o].splice(i, 1);\n\t\t}\n\t\tthis.nbrs[node] = [];\n\t}\n\n\t// keep/remove: modify graph in place by taking out some nodes\n\tpublic keepNodesMask(mask:boolean[]):void\n\t{\n\t\tconst oldsz = this.nbrs.length, newsz = Vec.maskCount(mask);\n\t\tif (newsz == oldsz) return;\n\t\tif (newsz == 0)\n\t\t{\n\t\t\tthis.nbrs = [];\n\t\t\tthis.indices = null;\n\t\t\tthis.labels = null;\n\t\t\tthis.props = null;\n\t\t\treturn;\n\t\t}\n\n\t\tlet newmap = Vec.maskMap(mask);\n\t\tlet newnbrs:number[][] = [];\n\t\tfor (let n = 0; n < newsz; n++) newnbrs.push([]);\n\t\tfor (let n = 0, pos = 0; n < oldsz; n++) if (mask[n])\n\t\t{\n\t\t\tfor (let i of this.nbrs[n]) if (mask[i]) newnbrs[pos].push(newmap[i]);\n\t\t\tpos++;\n\t\t}\n\t\tthis.nbrs = newnbrs;\n\n\t\tif (this.indices != null) this.indices = Vec.maskGet(this.indices, mask);\n\t\tif (this.labels != null) this.labels = Vec.maskGet(this.labels, mask);\n\t\tif (this.props != null) this.props = Vec.maskGet(this.props, mask);\n\t}\n\tpublic keepNodesIndex(idx:number[]) {this.keepNodesMask(Vec.idxMask(idx, this.numNodes));}\n\tpublic removeNodesMask(mask:boolean[]) {this.keepNodesMask(Vec.notMask(mask));}\n\tpublic removeNodesIndex(idx:number[]) {this.removeNodesMask(Vec.idxMask(idx, this.numNodes));}\n\n\t// subgraph: creates a new graph, typically smaller; note that the index version honours the new atom order\n\tpublic subgraphIndex(idx:number[]):Graph\n\t{\n\t\tconst nsz = idx.length;\n\t\tlet g = new Graph(nsz);\n\t\tif (this.indices != null || this.labels != null || this.props != null) for (let n = 0; n < nsz; n++)\n\t\t{\n\t\t\tif (this.indices != null) g.setIndex(n, this.indices[idx[n]]);\n\t\t\tif (this.labels != null) g.setLabel(n, this.labels[idx[n]]);\n\t\t\tif (this.props != null) g.setProperty(n, this.props[idx[n]]);\n\t\t}\n\t\tfor (let i = 0; i < nsz; i++)\n\t\t{\n\t\t\tfor (let n of this.nbrs[idx[i]])\n\t\t\t{\n\t\t\t\tlet j = idx.indexOf(n);\n\t\t\t\tif (j > i) g.addEdge(i, j);\n\t\t\t}\n\t\t}\n\t\treturn g;\n\t}\n\tpublic subgraphMask(mask:boolean[]):Graph\n\t{\n\t\tlet g = this.clone();\n\t\tg.keepNodesMask(mask);\n\t\treturn g;\n\t}\n\n\t// returns a list of connected component indices, one per node; the numbering system is based on node ordering\n\tpublic calculateComponents():number[]\n\t{\n\t\tconst sz = this.nbrs.length;\n\t\tif (sz == 0) return [];\n\n\t\tlet cc = Vec.numberArray(0, sz);\n\t\tcc[0] = 1;\n\t\tlet first = 1, high = 1;\n\t\twhile (true)\n\t\t{\n\t\t\twhile (first < sz && cc[first] > 0) {first++;}\n\t\t\tif (first >= sz) break;\n\n\t\t\tlet anything = false;\n\t\t\tfor (let i = first; i < sz; i++) if (cc[i] == 0)\n\t\t\t{\n\t\t\t\tfor (let j = 0; j < this.nbrs[i].length; j++)\n\t\t\t\t{\n\t\t\t\t\tif (cc[this.nbrs[i][j]] != 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tcc[i] = cc[this.nbrs[i][j]];\n\t\t\t\t\t\tanything = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!anything) cc[first] = ++high;\n\t\t}\n\n\t\treturn cc;\n\t}\n\n\t// returns an array of one group for each connected component\n\tpublic calculateComponentGroups():number[][]\n\t{\n\t\tif (this.nbrs.length == 0) return [];\n\t\tlet cc = this.calculateComponents();\n\t\tlet sz = Vec.max(cc);\n\n\t\tlet grp:number[][] = [];\n\t\tfor (let n = 0; n < sz; n++) grp.push([]);\n\t\tfor (let n = 0; n < cc.length; n++) grp[cc[n] - 1].push(n);\n\t\treturn grp;\n\t}\n\n\t// determine an array which has ring block IDs (0=no ring, >0=block index); also returns the count, i.e. number of ring blocks\n\tpublic calculateRingBlocks():[number[], number] // (rblk[], count)\n\t{\n\t\tlet sz = this.numNodes, nbrs = this.nbrs;\n\t\tif (sz == 0) return [[], 0];\n\n\t\tlet rblk:number[] = new Array(this.numNodes);\n\n\t\tlet visited = Vec.booleanArray(false, sz);\n\t\tVec.setTo(rblk, 0);\n\t\tlet path:number[] = new Array(sz + 1);\n\t\tlet plen = 0, numVisited = 0;\n\n\t\twhile (true)\n\t\t{\n\t\t\tlet last:number, current:number;\n\n\t\t\tif (plen == 0)\n\t\t\t{\n\t\t\t\tlast = -1;\n\t\t\t\tfor (current = 0; visited[current]; current++) {}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlast = path[plen - 1];\n\t\t\t\tcurrent = -1;\n\t\t\t\tfor (let n = 0; n < nbrs[last].length; n++) if (!visited[nbrs[last][n]]) {current = nbrs[last][n]; break;}\n\t\t\t}\n\n\t\t\tif (current >= 0 && plen >= 2) // path is at least 2 items long, so look for any not-previous visited neighbours\n\t\t\t{\n\t\t\t\tlet back = path[plen - 1];\n\t\t\t\tfor (let n = 0; n < nbrs[current].length; n++)\n\t\t\t\t{\n\t\t\t\t\tlet join = nbrs[current][n];\n\t\t\t\t\tif (join != back && visited[join])\n\t\t\t\t\t{\n\t\t\t\t\t\tpath[plen] = current;\n\t\t\t\t\t\tfor (let i = plen; i == plen || path[i + 1] != join; i--)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet id = rblk[path[i]];\n\t\t\t\t\t\t\tif (id == 0) rblk[path[i]] = last;\n\t\t\t\t\t\t\telse if (id != last)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfor (let j = 0; j < sz; j++) if (rblk[j] == id) rblk[j] = last;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (current >= 0) // can mark the new one as visited\n\t\t\t{\n\t\t\t\tvisited[current] = true;\n\t\t\t\tpath[plen++] = current;\n\t\t\t\tnumVisited++;\n\t\t\t}\n\t\t\telse // otherwise, found nothing and must rewind the path\n\t\t\t{\n\t\t\t\tplen--;\n\t\t\t}\n\n\t\t\tif (numVisited == sz) break;\n\t\t}\n\n\t\t// the ring ID's are not necessarily consecutive, so reassign them to 0=none, 1..NBlocks\n\t\tlet nextID = 0;\n\t\tfor (let i = 0; i < sz; i++) if (rblk[i] > 0)\n\t\t{\n\t\t\tnextID--;\n\t\t\tfor (let j = sz - 1; j >= i; j--) if (rblk[j] == rblk[i]) rblk[j] = nextID;\n\t\t}\n\t\tfor (let i = 0; i < sz; i++) rblk[i] = -rblk[i];\n\n\t\treturn [rblk, -nextID];\n\t}\n\n\t// calculate ring blocks and return an array of indices, one for each\n\tpublic calculateRingBlockGroups():number[][]\n\t{\n\t\tlet [rblk, sz] = this.calculateRingBlocks();\n\t\tif (sz == 0) return [];\n\n\t\tlet cap = Vec.numberArray(0, sz);\n\t\tfor (let n = 0; n < rblk.length; n++) if (rblk[n] > 0) cap[rblk[n] - 1]++;\n\n\t\tlet grp:number[][] = new Array(sz);\n\t\tfor (let n = 0; n < sz; n++)\n\t\t{\n\t\t\tgrp[n] = new Array(cap[n]);\n\t\t\tcap[n] = 0;\n\t\t}\n\t\tfor (let n = 0; n < rblk.length; n++)\n\t\t{\n\t\t\tlet i = rblk[n] - 1;\n\t\t\tif (i < 0) continue;\n\t\t\tgrp[i][cap[i]++] = n;\n\t\t}\n\t\treturn grp;\n\t}\n\n\t// returns a list of rings with just the given size; the enumeration is exhaustive, so this is only appropriate for small rings; any ring that can be composed from\n\t// smaller rings is excluded from the list\n\tpublic findRingsOfSize(size:number):number[][]\n\t{\n\t\tlet [rblk, num] = this.calculateRingBlocks();\n\t\tif (num == 0) return [];\n\n\t\tlet rings:number[][] = [];\n\t\tlet mask:boolean[] = new Array(this.numNodes);\n\n\t\tfor (let r = 1; r <= num; r++)\n\t\t{\n\t\t\tfor (let n = 0; n < this.numNodes; n++) mask[n] = rblk[n] == r;\n\t\t\tlet newRings = this.findRingsOfSizeMask(size, mask);\n\t\t\tfor (let n = 0; n < newRings.length; n++) rings.push(newRings[n]);\n\t\t}\n\t\treturn rings;\n\t}\n\n\tpublic findRingsOfSizeMask(size:number, mask:boolean[]):number[][]\n\t{\n\t\tlet rings:number[][] = [];\n\n\t\tfor (let n = 0; n < this.numNodes; n++) if (mask[n])\n\t\t{\n\t\t\tlet path:number[] = new Array(size);\n\t\t\tpath[0] = n;\n\t\t\tthis.recursiveRingFind(path, 1, size, mask, rings);\n\t\t}\n\n\t\treturn rings;\n\t}\n\n\t// returns breadth-first-search order\n\tpublic calculateBFS(idx:number):number[]\n\t{\n\t\tlet ret = Vec.numberArray(-1, this.numNodes);\n\t\tret[idx] = 0;\n\n\t\tlet curnum = 0, lsz = 1, watermark = 0;\n\t\tlet list = Vec.numberArray(0, this.numNodes);\n\t\tlist[0] = idx;\n\n\t\twhile (true)\n\t\t{\n\t\t\tlet newsz = lsz;\n\t\t\tfor (let n = watermark; n < lsz; n++)\n\t\t\t{\n\t\t\t\tfor (let i = 0; i < this.nbrs[list[n]].length; i++)\n\t\t\t\t{\n\t\t\t\t\tlet j = this.nbrs[list[n]][i];\n\t\t\t\t\tif (ret[j] < 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tret[j] = curnum + 1;\n\t\t\t\t\t\tlist[newsz++] = j;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (newsz == lsz) break;\n\t\t\twatermark = lsz;\n\t\t\tlsz = newsz;\n\t\t\tcurnum++;\n\t\t}\n\t\treturn ret;\n\t}\n\n\tpublic calculateGravity():number[]\n\t{\n\t\tconst sz = this.numNodes;\n\t\tconst {nbrs} = this;\n\t\tlet wght = Vec.numberArray(1, sz), wmod = Vec.numberArray(0, sz);\n\t\tfor (let n = 0; n < sz; n++)\n\t\t{\n\t\t\tVec.setTo(wmod, wght);\n\t\t\tfor (let i = 0; i < sz; i++) for (let j = nbrs[i].length - 1; j >= 0; j--) wmod[i] += wght[nbrs[i][j]];\n\t\t\tVec.setTo(wght, wmod);\n\t\t}\n\t\treturn wght;\n\t}\n\n\t// ----------------- private methods -----------------\n\n\t// ring hunter: recursive step; finds, compares and collects\n\tprivate recursiveRingFind(path:number[], psize:number, capacity:number, mask:boolean[], rings:number[][]):void\n\t{\n\t\t// not enough atoms yet, so look for new possibilities\n\t\tif (psize < capacity)\n\t\t{\n\t\t\tlet last = path[psize - 1];\n\t\t\tfor (let n = 0; n < this.nbrs[last].length; n++)\n\t\t\t{\n\t\t\t\tlet adj = this.nbrs[last][n];\n\t\t\t\tif (!mask[adj]) continue;\n\t\t\t\tlet fnd = false;\n\t\t\t\tfor (let i = 0; i < psize; i++) if (path[i] == adj)\n\t\t\t\t{\n\t\t\t\t\tfnd = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (!fnd)\n\t\t\t\t{\n\t\t\t\t\tlet newPath = Vec.duplicate(path);\n\t\t\t\t\tnewPath[psize] = adj;\n\t\t\t\t\tthis.recursiveRingFind(newPath, psize + 1, capacity, mask, rings);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t// path is full, so make sure it eats its tail\n\t\tlet last = path[psize - 1];\n\t\tlet fnd = false;\n\t\tfor (let n = 0; n < this.nbrs[last].length; n++) if (this.nbrs[last][n] == path[0]) {fnd = true; break;}\n\t\tif (!fnd) return;\n\n\t\t// make sure every element in the path has exactly 2 neighbours within the path; otherwise it is spanning a bridge, which\n\t\t// is an undesirable ring definition\n\t\tfor (let n = 0; n < path.length; n++)\n\t\t{\n\t\t\tlet count = 0, p = path[n];\n\t\t\tfor (let i = 0; i < this.nbrs[p].length; i++) if (path.indexOf(this.nbrs[p][i]) >= 0) count++;\n\t\t\tif (count != 2) return; // invalid\n\t\t}\n\n\t\t// reorder the array then look for duplicates\n\t\tlet first = 0;\n\t\tfor (let n = 1; n < psize; n++) if (path[n] < path[first]) first = n;\n\t\tlet fm = (first - 1 + psize) % psize, fp = (first + 1) % psize;\n\t\tlet flip = path[fm] < path[fp];\n\t\tif (first != 0 || flip)\n\t\t{\n\t\t\tlet newPath:number[] = new Array(psize);\n\t\t\tfor (let n = 0; n < psize; n++) newPath[n] = path[(first + (flip ? psize - n : n)) % psize];\n\t\t\tpath = newPath;\n\t\t}\n\n\t\tfor (let n = 0; n < rings.length; n++)\n\t\t{\n\t\t\tlet look = rings[n];\n\t\t\tlet same = true;\n\t\t\tfor (let i = 0; i < psize; i++) if (look[i] != path[i])\n\t\t\t{\n\t\t\t\tsame = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (same) return;\n\t\t}\n\n\t\trings.push(path);\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2021 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Chemistry} from '../data/Chemistry';\nimport {Graph} from '../data/Graph';\nimport {Molecule} from '../data/Molecule';\nimport {Vec} from '../util/Vec';\n\n/*\n\tResonance bond removal: certain algorithms/file formats store alternating single/double bonds in resonance\n\tform, most commonly the bonds of aromatic rings. The native molecule format does not support resonance style\n\tbonds, so these must be localised (\"Kekule form\"). This algorithm can be used to post-process a molecule,\n\twith the help of a support array that indicates the bonds which were described as resonance (order=1.5).\n\n\tThe algorithm corrects for some SMILES-esque weirdness, e.g. \"aromatic\" rings with outgoing carbonyls, and\n\talso artifacts like hydrogen-specification used explicitly to correct for heteroatoms in not-really-aromatics.\n\n\tNOTE: the algorithm will probably barf on some boundary cases, e.g. fullerenes; the max iteration limit is\n\tthe primary method of protection against this.\n*/\n\nexport class ResonanceRemover\n{\n\tpublic maxIter = 1000;\n\tpublic bondOrders:number[] = []; // this is the deliverable output\n\tpublic tolerant = false; // if set to true, will fail silently\n\n\t// ------------------ public methods --------------------\n\n\t// setup: mol & resBonds have to be defined, but atomHyd can be null\n\tconstructor(private mol:Molecule, private resBonds:boolean[], private atomHyd:number[] = [])\n\t{\n\t\tthis.mol = mol;\n\t\tthis.resBonds = resBonds;\n\t\tthis.atomHyd = atomHyd;\n\n\t\tfor (let n = 1; n <= mol.numBonds; n++) this.bondOrders.push(mol.bondOrder(n));\n\t}\n\n\t// runs the algorithm, and updates the replacement bond orders; critical failures throws a GraphFaultException, and\n\t// this includes running over max # of iterations as well as invalid/unsolvable resonance regions, so it should always\n\t// be explicitly checked by the caller\n\tpublic perform():void\n\t{\n\t\tconst {mol} = this;\n\n\t\tif (this.atomHyd == null)\n\t\t{\n\t\t\tthis.atomHyd = [];\n\t\t\tfor (let n = 1; n <= mol.numAtoms; n++) this.atomHyd.push(mol.atomHExplicit(n));\n\t\t}\n\n\t\tthis.correctInputMask();\n\n\t\tlet g = new Graph(mol.numAtoms);\n\t\tfor (let n = 1; n <= mol.numBonds; n++) if (this.resBonds[n - 1]) g.addEdge(mol.bondFrom(n) - 1, mol.bondTo(n) - 1);\n\t\tlet cc = g.calculateComponentGroups();\n\n\t\tfor (let n = 0; n < cc.length; n++) if (cc[n].length >= 2) this.processComponent(cc[n]);\n\t}\n\n\t// ------------------ private methods --------------------\n\n\t// sometimes the incoming mask can include things like aromatic rings with emerging =O and valence-saturated heteroatoms\n\t// (you know who you are, SMILES): remove these from consideration\n\tprivate correctInputMask():void\n\t{\n\t\tconst {mol, atomHyd} = this;\n\t\tconst na = mol.numAtoms, nb = mol.numBonds;\n\t\tlet exclude = Vec.booleanArray(false, na);\n\t\tfor (let n = 1; n <= na; n++)\n\t\t{\n\t\t\tlet atno = mol.atomicNumber(n);\n\t\t\tlet val = atno == Chemistry.ELEMENT_C ? 4 :\n\t\t\t\tatno == Chemistry.ELEMENT_N || atno == Chemistry.ELEMENT_P || atno == Chemistry.ELEMENT_B ? 3 :\n\t\t\t\tatno == Chemistry.ELEMENT_O || atno == Chemistry.ELEMENT_S ? 2 : -1;\n\t\t\tif (val < 0) {exclude[n - 1] = true; continue;}\n\n\t\t\tval += mol.atomCharge(n);\n\t\t\tif (atomHyd[n - 1] > 0) val -= atomHyd[n - 1];\n\t\t\tif (mol.atomAdjCount(n) >= val) exclude[n - 1] = true;\n\t\t}\n\t\tfor (let n = 1; n <= nb; n++) if (!this.resBonds[n - 1] && mol.bondOrder(n) != 1)\n\t\t{\n\t\t\texclude[mol.bondFrom(n) - 1] = true;\n\t\t\texclude[mol.bondTo(n) - 1] = true;\n\t\t}\n\n\t\tthis.resBonds = this.resBonds.slice(0);\n\t\tfor (let n = 0; n < nb; n++) if (this.resBonds[n] && (exclude[mol.bondFrom(n + 1) - 1] || exclude[mol.bondTo(n + 1) - 1]))\n\t\t{\n\t\t\tthis.bondOrders[n] = 1;\n\t\t\tthis.resBonds[n] = false;\n\t\t}\n\t}\n\n\t// handle a subset; nodes are 0-based; returns true if any bonds were assigned\n\tprivate processComponent(nodes:number[]):void\n\t{\n\t\tconst {mol, resBonds, bondOrders, atomHyd} = this;\n\n\t\tlet sz = nodes.length;\n\t\tif (sz == 2)\n\t\t{\n\t\t\tlet b = mol.findBond(nodes[0] + 1, nodes[1] + 1);\n\t\t\tbondOrders[b - 1] = 2;\n\t\t\treturn;\n\t\t}\n\n\t\t// optional hydrogens: in cases where H-counts were not provided, need to consider divalent nitrogens as valid for either X2NH of X=N-X\n\t\tlet optionalH = Vec.booleanArray(false, sz);\n\t\tfor (let n = 0; n < sz; n++)\n\t\t{\n\t\t\tlet i = nodes[n], a = i + 1;\n\t\t\toptionalH[n] = atomHyd[i] == Molecule.HEXPLICIT_UNKNOWN && mol.atomElement(a) == 'N' && mol.atomAdjCount(a) - mol.atomCharge(a) <= 2;\n\t\t}\n\n\t\t// prepare graph metrics to assist the search\n\t\tlet g = new Graph(sz);\n\t\tlet gravity = g.calculateGravity();\n\t\tlet mask = Vec.idxMask(nodes, mol.numAtoms);\n\t\tlet bsz = 0;\n\t\tfor (let n = 1; n <= mol.numBonds; n++) if (resBonds[n - 1] && mask[mol.bondFrom(n) - 1] && mask[mol.bondTo(n) - 1]) bsz++;\n\t\tlet bfr = Vec.numberArray(0, bsz), bto = Vec.numberArray(0, bsz), bgrav = Vec.numberArray(0, bsz), bidx = Vec.numberArray(0, bsz);\n\t\tbsz = 0;\n\t\tfor (let n = 1; n <= mol.numBonds; n++) if (resBonds[n - 1] && mask[mol.bondFrom(n) - 1] && mask[mol.bondTo(n) - 1])\n\t\t{\n\t\t\tlet f = nodes.indexOf(mol.bondFrom(n) - 1), t = nodes.indexOf(mol.bondTo(n) - 1);\n\t\t\tbfr[bsz] = f;\n\t\t\tbto[bsz] = t;\n\t\t\tbgrav[bsz] = gravity[f] + gravity[t];\n\t\t\tbidx[bsz] = n;\n\t\t\tg.addEdge(f, t);\n\t\t\tbsz++;\n\t\t}\n\n\t\t// select the first bond\n\t\tlet seq = Vec.numberArray(0, bsz);\n\t\tseq[0] = Vec.idxMax(bgrav);\n\t\tlet visited = Vec.booleanArray(false, bsz);\n\t\tvisited[seq[0]] = true;\n\t\tfor (let i = 1; i < bsz; i++)\n\t\t{\n\t\t\tlet b = -1;\n\t\t\tfor (let j = i - 1; j >= 0; j--)\n\t\t\t{\n\t\t\t\tfor (let n = 0; n < bsz; n++)\n\t\t\t\t{\n\t\t\t\t\tif (!visited[n]) if (bfr[n] == bfr[seq[j]] || bfr[n] == bto[seq[j]] || bto[n] == bfr[seq[j]] || bto[n] == bto[seq[j]])\n\t\t\t\t\t{\n\t\t\t\t\t\tif (b < 0 || bgrav[n] > bgrav[b]) b = n;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (b >= 0) break;\n\t\t\t}\n\t\t\tif (b < 0) throw 'Graph walk failed';\n\n\t\t\tseq[i] = b;\n\t\t\tvisited[b] = true;\n\t\t}\n\n\t\t// grow path candidates until something works\n\t\tlet paths:boolean[][] = [];\n\t\tpaths.push([true]);\n\t\tpaths.push([false]);\n\t\tlet result:boolean[] = null;\n\t\tlet resultCount = 0;\n\t\tlet definiteMatch = Math.ceil(0.5 * bsz); // once # double bonds >= ceil(#bonds/2), definitely locked on\n\n\t\tlet iter = 0;\n\t\twhile (paths.length > 0)\n\t\t{\n\t\t\tlet p = paths[0];\n\t\t\tlet p1 = Vec.append(p, false), p2 = Vec.append(p, true);\n\t\t\tif (!this.validPath(p1, seq, bfr, bto, g, optionalH)) p1 = null;\n\t\t\tif (!this.validPath(p2, seq, bfr, bto, g, optionalH)) p2 = null;\n\n\t\t\tif (Vec.len(p1) == bsz)\n\t\t\t{\n\t\t\t\tlet c = Vec.maskCount(p1);\n\t\t\t\tif (c > resultCount)\n\t\t\t\t{\n\t\t\t\t\tresult = p1;\n\t\t\t\t\tresultCount = c;\n\t\t\t\t}\n\t\t\t\tp1 = null;\n\t\t\t}\n\t\t\tif (Vec.len(p2) == bsz)\n\t\t\t{\n\t\t\t\tlet c = Vec.maskCount(p2);\n\t\t\t\tif (c > resultCount)\n\t\t\t\t{\n\t\t\t\t\tresult = p2;\n\t\t\t\t\tresultCount = c;\n\t\t\t\t}\n\t\t\t\tp2 = null;\n\t\t\t}\n\t\t\tif (resultCount >= definiteMatch) break;\n\n\t\t\tif (p1 == null && p2 == null) paths.shift();\n\t\t\telse if (p1 != null && p2 != null)\n\t\t\t{\n\t\t\t\t// the {..,true} one goes in first\n\t\t\t\tpaths[0] = p1;\n\t\t\t\tpaths.splice(1, 0, p2);\n\t\t\t}\n\t\t\telse if (p1 != null) paths[0] = p1;\n\t\t\telse /* p2!=null */paths[0] = p2;\n\n\t\t\titer++;\n\t\t\tif (iter > this.maxIter)\n\t\t\t{\n\t\t\t\tif (result != null) break; // run with it\n\t\t\t\tif (this.tolerant) return;\n\t\t\t\tthrow 'Resonance localisation exceeded maximum iteration count';\n\t\t\t}\n\t\t}\n\n\t\tif (result == null)\n\t\t{\n\t\t\tif (this.tolerant) return;\n\t\t\tthrow 'Unable to find a solution to the resonance block.';\n\t\t}\n\t\tfor (let n = 0; n < bsz; n++) bondOrders[bidx[seq[n]] - 1] = result[n] ? 2 : 1;\n\t}\n\n\t// for a path sequence (usually incomplete), determine whether it has any chance of success\n\tprivate validPath(path:boolean[], seq:number[], bfr:number[], bto:number[], g:Graph, optionalH:boolean[]):boolean\n\t{\n\t\tlet sz = g.numNodes;\n\t\tlet count1 = Vec.numberArray(0, sz), count2 = Vec.numberArray(0, sz);\n\t\tfor (let n = 0; n < path.length; n++)\n\t\t{\n\t\t\tlet a1 = bfr[seq[n]], a2 = bto[seq[n]];\n\t\t\tif (path[n])\n\t\t\t{\n\t\t\t\tcount2[a1]++;\n\t\t\t\tcount2[a2]++;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcount1[a1]++;\n\t\t\t\tcount1[a2]++;\n\t\t\t}\n\t\t}\n\t\tfor (let n = 0; n < sz; n++)\n\t\t{\n\t\t\tif (count2[n] > 1) return false; // can't have 2 double bonds on the same atom: fail\n\t\t\tif (!optionalH[n] && g.numEdges(n) > 1 && count1[n] == g.numEdges(n)) return false; // no double bonds & no room for one: fail\n\t\t}\n\t\treturn true;\n\t}\n}\n\n","/*\n\tWebMolKit\n\n\t(c) 2010-2018 Molecular Materials Informatics, Inc.\n\n\tAll rights reserved\n\n\thttp://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {safeInt} from '../util/util';\nimport {Vec} from '../util/Vec';\nimport {Graph} from './Graph';\nimport {Molecule} from './Molecule';\n\n/*\n\tBond artifacts: looks for metadata instructions that indicate that certain core bond types should be drawn in some way other than\n\tthe minimalistic bond primitives that are available in the core datastructure.\n\n\tTypes:\n\t\tResPath: a linear resonance pathway, where the bond order and total charge are depicted as a continuous average\n\t\tResRing: a ring pathway, where the bond order and total charge are circularly delocalised\n\t\tArene: an atom having a bond that protrudes into the centre of a group of resonance-delocalised atoms (usually a ring)\n\n\tThe atom orderings are guaranteed to be in a sensible order, i.e. path/ring traversal.\n*/\n\nexport const BONDARTIFACT_EXTRA_RESPATH = 'xRESPATH:';\nexport const BONDARTIFACT_EXTRA_RESRING = 'xRESRING:';\nexport const BONDARTIFACT_EXTRA_ARENE = 'xARENE:';\n\nexport interface BondArtifactResPath\n{\n\tatoms:number[]; // line of resonance-style bonding\n}\nexport interface BondArtifactResRing\n{\n\tatoms:number[]; // single ring of resonating bonds (ring can be any size)\n}\nexport interface BondArtifactArene\n{\n\tcentre:number; // atom to which the arene is bonded\n\tatoms:number[]; // ring (or partial ring) that is side-bonded\n}\n\nexport class BondArtifact\n{\n\tprivate resPaths = new Map<number, BondArtifactResPath>();\n\tprivate resRings = new Map<number, BondArtifactResRing>();\n\tprivate arenes = new Map<number, BondArtifactArene>();\n\n\t// ------------ public methods ------------\n\n\tconstructor(public mol:Molecule)\n\t{\n\t\t// pull out the raw content from the molecule's extra fields\n\t\tfor (let n = 1; n <= this.mol.numAtoms; n++)\n\t\t{\n\t\t\tfor (let str of this.mol.atomExtra(n))\n\t\t\t{\n\t\t\t\tif (str.startsWith(BONDARTIFACT_EXTRA_RESPATH)) this.appendResPath(n, str.substring(BONDARTIFACT_EXTRA_RESPATH.length).split(':'));\n\t\t\t\telse if (str.startsWith(BONDARTIFACT_EXTRA_RESRING)) this.appendResRing(n, str.substring(BONDARTIFACT_EXTRA_RESRING.length).split(':'));\n\t\t\t\telse if (str.startsWith(BONDARTIFACT_EXTRA_ARENE)) this.appendArene(n, str.substring(BONDARTIFACT_EXTRA_ARENE.length).split(':'));\n\t\t\t}\n\t\t}\n\n\t\t// clean each one up, or remove if invalid\n\t\tfor (let [blk, res] of this.resPaths.entries())\n\t\t{\n\t\t\tres.atoms = this.pack(res.atoms);\n\t\t\tif (!this.pathify(res.atoms, false)) this.resPaths.delete(blk);\n\t\t}\n\t\tfor (let [blk, res] of this.resRings.entries())\n\t\t{\n\t\t\tres.atoms = this.pack(res.atoms);\n\t\t\tif (!this.pathify(res.atoms, true)) this.resRings.delete(blk);\n\t\t}\n\t\tfor (let [blk, res] of this.arenes.entries())\n\t\t{\n\t\t\tres.atoms = this.pack(res.atoms);\n\t\t\tif (res.atoms.length > 1) res.centre = res.atoms.shift();\n\t\t\tif (!this.pathify(res.atoms, false)) this.arenes.delete(blk);\n\t\t}\n\t}\n\n\t// access to resulting content\n\tpublic getPathBlocks():number[] {return Array.from(this.resPaths.keys());}\n\tpublic getRingBlocks():number[] {return Array.from(this.resRings.keys());}\n\tpublic getAreneBlocks():number[] {return Array.from(this.arenes.keys());}\n\tpublic getResPaths():BondArtifactResPath[]\n\t{\n\t\t//return Array.from(this.resPaths.values());\n\t\tlet list:BondArtifactResPath[] = [];\n\t\tfor (let key of Vec.sorted(Array.from(this.resPaths.keys()))) list.push(this.resPaths.get(key));\n\t\treturn list;\n\t}\n\tpublic getResRings():BondArtifactResRing[]\n\t{\n\t\t//return Array.from(this.resRings.values());\n\t\tlet list:BondArtifactResRing[] = [];\n\t\tfor (let key of Vec.sorted(Array.from(this.resRings.keys()))) list.push(this.resRings.get(key));\n\t\treturn list;\n\t}\n\tpublic getArenes():BondArtifactArene[]\n\t{\n\t\t//return Array.from(this.arenes.values());\n\t\tlet list:BondArtifactArene[] = [];\n\t\tfor (let key of Vec.sorted(Array.from(this.arenes.keys()))) list.push(this.arenes.get(key));\n\t\treturn list;\n\t}\n\n\t// replaces all artifact signifiers with those from the current list of content\n\tpublic rewriteMolecule():void\n\t{\n\t\tconst mol = this.mol;\n\n\t\t// delete everything\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t{\n\t\t\tlet extra = mol.atomExtra(n), modified = false;\n\t\t\tfor (let i = extra.length - 1; i >= 0; i--)\n\t\t\t{\n\t\t\t\tif (extra[i].startsWith(BONDARTIFACT_EXTRA_RESPATH) || extra[i].startsWith(BONDARTIFACT_EXTRA_RESRING) || extra[i].startsWith(BONDARTIFACT_EXTRA_ARENE))\n\t\t\t\t{\n\t\t\t\t\textra.splice(i);\n\t\t\t\t\tmodified = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (modified) mol.setAtomExtra(n, extra);\n\t\t}\n\n\t\t// write back our datastructures\n\t\tfor (let [blk, path] of this.resPaths.entries())\n\t\t{\n\t\t\tfor (let n = 0; n < path.atoms.length; n++)\n\t\t\t{\n\t\t\t\tlet extra = mol.atomExtra(path.atoms[n]);\n\t\t\t\textra.push(BONDARTIFACT_EXTRA_RESPATH + blk + ':' + (n + 1));\n\t\t\t\tmol.setAtomExtra(path.atoms[n], extra);\n\t\t\t}\n\t\t}\n\t\tfor (let [blk, ring] of this.resRings.entries())\n\t\t{\n\t\t\tfor (let n = 0; n < ring.atoms.length; n++)\n\t\t\t{\n\t\t\t\tlet extra = mol.atomExtra(ring.atoms[n]);\n\t\t\t\textra.push(BONDARTIFACT_EXTRA_RESRING + blk + ':' + (n + 1));\n\t\t\t\tmol.setAtomExtra(ring.atoms[n], extra);\n\t\t\t}\n\t\t}\n\t\tfor (let [blk, arene] of this.arenes.entries())\n\t\t{\n\t\t\tfor (let n = -1; n < arene.atoms.length; n++)\n\t\t\t{\n\t\t\t\tlet atom = n < 0 ? arene.centre : arene.atoms[n];\n\t\t\t\tlet extra = mol.atomExtra(atom);\n\t\t\t\textra.push(BONDARTIFACT_EXTRA_ARENE + blk + ':' + (n + 2));\n\t\t\t\tmol.setAtomExtra(atom, extra);\n\t\t\t}\n\t\t}\n\t}\n\n\t// given the numbering system used by artifacts in another object, make sure that the current ones are renumbered so that they don't clash\n\tpublic harmoniseNumbering(other:BondArtifact):void\n\t{\n\t\tlet blocks = other.getPathBlocks();\n\t\tlet stashPaths = this.getResPaths();\n\t\tthis.resPaths.clear();\n\t\tfor (let path of stashPaths)\n\t\t{\n\t\t\tlet blk = this.nextIdentifier(blocks);\n\t\t\tthis.resPaths.set(blk, path);\n\t\t\tblocks.push(blk);\n\t\t}\n\n\t\tblocks = other.getRingBlocks();\n\t\tlet stashRings = this.getResRings();\n\t\tthis.resRings.clear();\n\t\tfor (let ring of stashRings)\n\t\t{\n\t\t\tlet blk = this.nextIdentifier(blocks);\n\t\t\tthis.resRings.set(blk, ring);\n\t\t\tblocks.push(blk);\n\t\t}\n\n\t\tblocks = other.getAreneBlocks();\n\t\tlet stashArenes = this.getArenes();\n\t\tthis.arenes.clear();\n\t\tfor (let arene of stashArenes)\n\t\t{\n\t\t\tlet blk = this.nextIdentifier(blocks);\n\t\t\tthis.arenes.set(blk, arene);\n\t\t\tblocks.push(blk);\n\t\t}\n\t}\n\n\t// creates a new path using the given atoms, or returns false if invalid\n\tpublic createPath(atoms:number[]):boolean\n\t{\n\t\tif (this.alreadyExists(atoms)) return false;\n\t\tlet path = this.atomsAsPath(atoms);\n\t\tif (path)\n\t\t{\n\t\t\tlet id = this.nextIdentifier(Array.from(this.resPaths.keys()));\n\t\t\tthis.resPaths.set(id, path);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t// creates a new ring using the given atoms, or returns false if invalid\n\tpublic createRing(atoms:number[]):boolean\n\t{\n\t\tif (this.alreadyExists(atoms)) return false;\n\t\tlet ring = this.atomsAsRing(atoms);\n\t\tif (ring)\n\t\t{\n\t\t\tlet id = this.nextIdentifier(Array.from(this.resRings.keys()));\n\t\t\tthis.resRings.set(id, ring);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t// creates a new arene using the given atoms, or returns false if invalid\n\tpublic createArene(atoms:number[]):boolean\n\t{\n\t\tif (this.alreadyExists(atoms)) return false;\n\t\tlet arene = this.atomsAsArene(atoms);\n\t\tif (arene)\n\t\t{\n\t\t\tlet id = this.nextIdentifier(Array.from(this.arenes.keys()));\n\t\t\tthis.arenes.set(id, arene);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t// removes one artifact as affected by the given atoms (selected by best overlap), or returns false if nothing removed\n\tpublic removeArtifact(atoms:number[]):boolean\n\t{\n\t\tlet type = 0, pick = 0, overlap = 0;\n\t\tfor (let [blk, path] of this.resPaths.entries())\n\t\t{\n\t\t\tlet count = 0;\n\t\t\tfor (let a of path.atoms) if (atoms.indexOf(a) >= 0) count++;\n\t\t\tif (count > overlap) {type = 1; pick = blk; overlap = count;}\n\t\t}\n\t\tfor (let [blk, ring] of this.resRings.entries())\n\t\t{\n\t\t\tlet count = 0;\n\t\t\tfor (let a of ring.atoms) if (atoms.indexOf(a) >= 0) count++;\n\t\t\tif (count > overlap) {type = 2; pick = blk; overlap = count;}\n\t\t}\n\t\tfor (let [blk, arene] of this.arenes.entries())\n\t\t{\n\t\t\tlet count = atoms.indexOf(arene.centre) >= 0 ? 1 : 0;\n\t\t\tfor (let a of arene.atoms) if (atoms.indexOf(a) >= 0) count++;\n\t\t\tif (count > overlap) {type = 3; pick = blk; overlap = count;}\n\t\t}\n\n\t\tif (type == 0) return false;\n\t\telse if (type == 1) this.resPaths.delete(pick);\n\t\telse if (type == 2) this.resRings.delete(pick);\n\t\telse if (type == 3) this.arenes.delete(pick);\n\t\treturn true;\n\t}\n\n\t// quickly strip out all bond artifacts\n\tpublic static removeAll(mol:Molecule):void\n\t{\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t{\n\t\t\tlet extra = mol.atomExtra(n);\n\t\t\tlet modified = false;\n\t\t\tfor (let i = extra.length - 1; i >= 0; i--)\n\t\t\t{\n\t\t\t\tif (!extra[i].startsWith(BONDARTIFACT_EXTRA_RESPATH) && !extra[i].startsWith(BONDARTIFACT_EXTRA_RESRING) &&\n\t\t\t\t\t!extra[i].startsWith(BONDARTIFACT_EXTRA_ARENE)) continue;\n\t\t\t\textra = Vec.remove(extra, i);\n\t\t\t\tmodified = true;\n\t\t\t}\n\t\t\tif (modified) mol.setAtomExtra(n, extra);\n\t\t}\n\t}\n\n\t// ------------ private methods ------------\n\n\t// handle a single atom being concatenated onto a putative instance\n\tprivate appendResPath(atom:number, bits:string[]):void\n\t{\n\t\tlet blk = safeInt(bits[0], 0);\n\t\tif (blk <= 0) return;\n\n\t\tlet res = this.resPaths.get(blk);\n\t\tif (res == null) this.resPaths.set(blk, res = {atoms: Vec.numberArray(0, this.mol.numAtoms)});\n\n\t\tlet idx = bits.length >= 2 ? safeInt(bits[1], 0) : 0;\n\t\tif (res.atoms.indexOf(atom) >= 0) return;\n\t\tif (idx >= 1 && idx <= this.mol.numAtoms) res.atoms[idx - 1] = atom; else res.atoms.push(atom);\n\t}\n\tprivate appendResRing(atom:number, bits:string[]):void\n\t{\n\t\tlet blk = safeInt(bits[0], 0);\n\t\tif (blk <= 0) return;\n\n\t\tlet res = this.resRings.get(blk);\n\t\tif (res == null) this.resRings.set(blk, res = {atoms: Vec.numberArray(0, this.mol.numAtoms)});\n\n\t\tlet idx = bits.length >= 2 ? safeInt(bits[1], 0) : 0;\n\t\tif (res.atoms.indexOf(atom) >= 0) return;\n\t\tif (idx >= 1 && idx <= this.mol.numAtoms) res.atoms[idx - 1] = atom; else res.atoms.push(atom);\n\t}\n\tprivate appendArene(atom:number, bits:string[]):void\n\t{\n\t\tlet blk = safeInt(bits[0], 0);\n\t\tif (blk <= 0) return;\n\n\t\tlet res = this.arenes.get(blk);\n\t\tif (res == null) this.arenes.set(blk, res = {centre: 0, atoms: Vec.numberArray(0, this.mol.numAtoms)});\n\n\t\tlet idx = bits.length >= 2 ? safeInt(bits[1], 0) : 0;\n\t\tif (res.atoms.indexOf(atom) >= 0) return;\n\t\tif (idx >= 1 && idx <= this.mol.numAtoms) res.atoms[idx - 1] = atom; else res.atoms.push(atom);\n\t}\n\n\t// condense an array by removing zero's\n\tprivate pack(arr:number[]):number[]\n\t{\n\t\tlet ret:number[] = [];\n\t\tfor (let v of arr) if (v != 0) ret.push(v);\n\t\treturn ret;\n\t}\n\n\t// takes an array of atom indices and makes sure it's a path of some sort; this may involve reordering the atoms; it must be possible to start at\n\t// some atom and walk along the path; the first atom has the lowest adjacency; the given order of the atoms will inform tiebreakers; if the method\n\t// returns true, then the atoms may be have been reordered\n\tprivate pathify(atoms:number[], requireRing:boolean):boolean\n\t{\n\t\tlet sz = atoms.length;\n\t\tif (sz < 2) return false;\n\n\t\tlet g = Graph.fromMolecule(this.mol);\n\t\tfor (let n = 0; n < this.mol.numAtoms; n++) g.setIndex(n, n + 1);\n\t\tg = g.subgraphIndex(Vec.add(atoms, -1));\n\t\tlet pos = 0;\n\t\tfor (let n = 1; n < sz; n++) if (g.numEdges(n) < g.numEdges(pos)) pos = n;\n\n\t\tVec.setTo(atoms, -1); // filling this with subgraph indices\n\t\tfor (let n = 0; n < sz; n++)\n\t\t{\n\t\t\tatoms[n] = pos;\n\t\t\tif (n == sz - 1)\n\t\t\t{\n\t\t\t\tif (requireRing) if (g.getEdges(pos).indexOf(atoms[0]) < 0) return false; // must be joined\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet next = sz;\n\t\t\t\tfor (let i of g.getEdges(pos)) if (atoms.indexOf(i) < 0 && i < next) next = i;\n\t\t\t\tif (next == sz) return false; // bad\n\t\t\t\tpos = next;\n\t\t\t}\n\t\t}\n\n\t\tfor (let n = 0; n < sz; n++) atoms[n] = g.getIndex(atoms[n]);\n\t\treturn true;\n\t}\n\n\t// check to see if a set of atoms exists already as an artifact\n\tprivate alreadyExists(atoms:number[]):boolean\n\t{\n\t\tatoms = Vec.sorted(atoms);\n\t\tfor (let path of this.resPaths.values())\n\t\t{\n\t\t\tif (Vec.equals(atoms, Vec.sorted(path.atoms))) return true;\n\t\t}\n\t\tfor (let ring of this.resRings.values())\n\t\t{\n\t\t\tif (Vec.equals(atoms, Vec.sorted(ring.atoms))) return true;\n\t\t}\n\t\tfor (let arene of this.arenes.values())\n\t\t{\n\t\t\tlet areneAtoms = Vec.append(arene.atoms, arene.centre);\n\t\t\tif (Vec.equals(atoms, Vec.sorted(areneAtoms))) return true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t// make a list of atoms (arbitrary order) into an artifact of the given type\n\tprivate atomsAsPath(atoms:number[]):BondArtifactResPath\n\t{\n\t\tif (atoms.length < 2) return null;\n\t\tlet path:BondArtifactResPath = {atoms: atoms};\n\t\tif (!this.pathify(path.atoms, false)) return null;\n\t\treturn path;\n\t}\n\tprivate atomsAsRing(atoms:number[]):BondArtifactResRing\n\t{\n\t\tif (atoms.length < 3) return null;\n\t\tlet ring:BondArtifactResRing = {atoms: atoms};\n\t\tif (!this.pathify(ring.atoms, true)) return null;\n\t\treturn ring;\n\t}\n\tprivate atomsAsArene(atoms:number[]):BondArtifactArene\n\t{\n\t\tconst sz = atoms.length;\n\t\tif (sz < 3) return null;\n\n\t\tlet g = Graph.fromMolecule(this.mol).subgraphIndex(Vec.add(atoms, -1));\n\t\tlet best = 0;\n\t\tif (sz == 3)\n\t\t{\n\t\t\t// if just 3 atoms, it must be a ring, and we pick the one with the lowest bond order sum\n\t\t\tlet bsum = [0, 0, 0];\n\t\t\tfor (let n = 0; n < sz; n++)\n\t\t\t{\n\t\t\t\tif (g.numEdges(n) != 2) return null;\n\t\t\t\tfor (let e of g.getEdges(n)) bsum[n] += this.mol.bondOrder(this.mol.findBond(atoms[n], atoms[e]));\n\t\t\t\tbest = Vec.idxMin(bsum);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// the \"centre\" (aka metal) is the one with the highest adjacency within the subgraph\n\t\t\tfor (let n = 1; n < sz; n++) if (g.numEdges(n) > g.numEdges(best)) best = n;\n\t\t}\n\n\t\tlet arene:BondArtifactArene = {centre: atoms[best], atoms: Vec.remove(atoms, best)};\n\t\tif (!this.pathify(arene.atoms, false)) return null;\n\t\treturn arene;\n\t}\n\n\t// using a disposable array, finds the next suitable identifier given that some number may already been taken\n\tprivate nextIdentifier(inkeys:number[]):number\n\t{\n\t\tif (inkeys.length == 0) return 1;\n\t\tlet keys = Vec.sorted(inkeys);\n\t\tfor (let n = 0; n < keys.length - 1; n++) if (keys[n + 1] != keys[n] + 1) return keys[n] + 1;\n\t\treturn keys[keys.length - 1] + 1;\n\t}\n}\n\n","/*\n\tWebMolKit\n\n\t(c) 2010-2020 Molecular Materials Informatics, Inc.\n\n\tAll rights reserved\n\n\thttp://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Vec} from '../util/Vec';\nimport {Molecule} from './Molecule';\n\n/*\n\tPolymer blocks: handles metadata instructions that mark up sections of the molecule as being blocks that are assembled in a\n\trepeating pattern to build macromolecules.\n\n\tThe information contained in is relatively simplistic and abstract: properties such as complex repeating sequences, splicing of\n\tcross linkers, molecular weight distribution etc. need to be encoded external to the molecule, but they can reference the encoded\n\tblocks.\n\n\tEach block consists of 1-or-more atoms. The information is repeated identically for each atom, which makes the encoding largely\n\tinvariant to atom deletion by code that does not respect the extensions. Some initial post-correction may also be able to fix\n\tmodifications such as atom insertion, or to delete invalid block IDs.\n\n\tBlock IDs are stable, i.e. deleting block N does not cause block N+1 to be renumbered. New blocks pick the next available ID, or\n\tan available empty slot.\n\n\tProperties:\n\t\tid (starts at 1)\n\t\t#connecting bonds (mainly used as a checksum)\n\t\tflags: head-to-tail, head-to-head, random\n\t\tbond connectivity groups: useful sometimes when more than 2 bonds out of the block: can define how they get reconnected as bulk units\n*/\n\nexport const POLYMERBLOCK_EXTRA_POLYMER = 'xPOLYMER:';\nexport const POLYMERBLOCK_SPECIAL_UNCAPPED = '*'; // atom name for \"something goes here\"\n\nexport enum PolymerBlockConnectivity\n{\n\tHeadToTail = 'ht', // the most orderly linear arrangement\n\tHeadToHead = 'hh', // alternating linear arrangement\n\tRandom = 'rnd', // explicitly random\n}\n\nexport class PolymerBlockUnit\n{\n\tpublic connect:PolymerBlockConnectivity = null; // null if not applicable\n\tpublic bondConn:number[] = null; // interbond connection groups; pairwise ordering: [b1a, b1b, b2a, b2b, ...]\n\tpublic atomName = new Map<number, number[]>(); // for atoms: list of name codes that an atom belongs to, if any; applies only to atoms on the boundary\n\tpublic bondIncl = new Map<number, number[]>(); // for bonds: list of name codes that the outgoing bond may be connected to (none = no restriction)\n\tpublic bondExcl = new Map<number, number[]>(); // for bonds: list of name codes that the outgoing bond may not be connected to (redundant when there are include atoms)\n\n\tconstructor(public atoms:number[]) {}\n\tpublic clone():PolymerBlockUnit\n\t{\n\t\tlet dup = new PolymerBlockUnit(this.atoms.slice(0));\n\t\tdup.connect = this.connect;\n\t\tif (this.bondConn) dup.bondConn = this.bondConn.slice(0);\n\t\tfor (let [k, v] of this.atomName.entries()) dup.atomName.set(k, v.slice(0));\n\t\tfor (let [k, v] of this.bondIncl.entries()) dup.bondIncl.set(k, v.slice(0));\n\t\tfor (let [k, v] of this.bondExcl.entries()) dup.bondExcl.set(k, v.slice(0));\n\t\treturn dup;\n\t}\n}\n\nexport class PolymerBlock\n{\n\tprivate units = new Map<number, PolymerBlockUnit>();\n\n\t// ------------ public methods ------------\n\n\tconstructor(public mol:Molecule)\n\t{\n\t\t// pull out the raw content from the molecule's extra fields\n\t\tlet blockAtoms = new Map<number, number[]>();\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t{\n\t\t\tlet extra = mol.atomExtra(n);\n\t\t\tfor (let str of extra) if (str.startsWith(POLYMERBLOCK_EXTRA_POLYMER))\n\t\t\t{\n\t\t\t\tlet bits = str.substring(POLYMERBLOCK_EXTRA_POLYMER.length).split(':');\n\t\t\t\tlet id = parseInt(bits[0]);\n\t\t\t\tif (id > 0)\n\t\t\t\t{\n\t\t\t\t\tlet atoms = blockAtoms.get(id);\n\t\t\t\t\tif (atoms) atoms.push(n); else atoms = [n];\n\t\t\t\t\tblockAtoms.set(id, atoms);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (let key of Vec.sorted(Array.from(blockAtoms.keys()))) this.appendBlock(key, blockAtoms.get(key));\n\t}\n\n\t// access to resulting content\n\tpublic getIDList():number[] {return Vec.sorted(Array.from(this.units.keys()));}\n\tpublic getUnit(id:number):PolymerBlockUnit {return this.units.get(id);}\n\tpublic getUnits():PolymerBlockUnit[] {return Array.from(this.units.values());}\n\n\t// replaces all artifact signifiers with those from the current list of content\n\tpublic rewriteMolecule():void\n\t{\n\t\tthis.purgeExtraFields();\n\t\tfor (let key of Vec.sorted(Array.from(this.units.keys()))) this.writeUnit(key, this.units.get(key));\n\t}\n\n\t// given the numbering system used by artifacts in another object, make sure that the current ones are renumbered so that they don't clash\n\tpublic harmoniseNumbering(other:PolymerBlock):void\n\t{\n\t\tlet allKeys = other.getIDList();\n\t\tfor (let key of this.getIDList()) if (allKeys.includes(key))\n\t\t{\n\t\t\tlet unit = this.units.get(key);\n\t\t\tthis.units.delete(key);\n\t\t\tkey = this.nextIdentifier(allKeys);\n\t\t\tthis.units.set(key, unit);\n\t\t\tallKeys.push(key);\n\t\t}\n\t}\n\n\t// removes one artifact as affected by the given atoms (selected by best overlap), or returns false if nothing removed\n\tpublic removeUnit(id:number):void\n\t{\n\t\tlet unit = this.units.get(id);\n\t\tif (unit == null) return;\n\t\tthis.units.delete(id);\n\t\tlet pfx = POLYMERBLOCK_EXTRA_POLYMER + id + ':';\n\t\tfor (let a of unit.atoms)\n\t\t{\n\t\t\tlet extra = this.mol.atomExtra(a);\n\t\t\tfor (let i = extra.length - 1; i >= 0; i--) if (extra[i].startsWith(pfx)) extra = Vec.remove(extra, i);\n\t\t\tthis.mol.setAtomExtra(a, extra);\n\t\t}\n\t\tfor (let b = 1; b <= this.mol.numBonds; b++)\n\t\t{\n\t\t\tlet extra = this.mol.bondExtra(b);\n\t\t\tif (Vec.isBlank(extra)) continue;\n\t\t\tfor (let i = extra.length - 1; i >= 0; i--) if (extra[i].startsWith(pfx)) extra = Vec.remove(extra, i);\n\t\t\tthis.mol.setBondExtra(b, extra);\n\t\t}\n\t}\n\n\t// quickly strip out all bond artifacts\n\tpublic removeAll():void\n\t{\n\t\tthis.units.clear();\n\t\tthis.purgeExtraFields();\n\t}\n\n\t// creates the block, writes content into the molecule, and returns the ID\n\tpublic createUnit(unit:PolymerBlockUnit):number\n\t{\n\t\tlet id = this.nextIdentifier();\n\t\tthis.units.set(id, unit.clone());\n\t\tthis.writeUnit(id, unit);\n\t\treturn id;\n\t}\n\n\tpublic static hasPolymerExtensions(mol:Molecule):boolean\n\t{\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t{\n\t\t\tlet extra = mol.atomExtra(n);\n\t\t\tif (extra != null) for (let str of extra) if (str.startsWith(POLYMERBLOCK_EXTRA_POLYMER)) return true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t// for a given atom, return all of the polymer designations, or null if none\n\tpublic static getPolymerExtensions(mol:Molecule, atom:number):string[]\n\t{\n\t\tlet extra = mol.atomExtra(atom), polext:string[] = null;\n\t\tif (extra == null) return null;\n\t\tfor (let str of extra) if (str.startsWith(POLYMERBLOCK_EXTRA_POLYMER)) polext = Vec.append(polext, str);\n\t\treturn polext;\n\t}\n\n\t// remove all polymer extensions from a given atom\n\tpublic static removePolymerExtensions(mol:Molecule, atom:number):void\n\t{\n\t\tlet extra = mol.atomExtra(atom);\n\t\tif (extra == null) return;\n\t\tlet modified = false;\n\t\tfor (let i = extra.length - 1; i >= 0; i--) if (extra[i].startsWith(POLYMERBLOCK_EXTRA_POLYMER))\n\t\t{\n\t\t\textra = Vec.remove(extra, i);\n\t\t\tmodified = true;\n\t\t}\n\t\tif (modified) mol.setAtomExtra(atom, extra);\n\t}\n\n\t// ------------ private methods ------------\n\n\t// given an ID and some atoms that correspond to it, see if it checks out: and if so, add it to the processed list\n\tprivate appendBlock(id:number, atoms:number[]):void\n\t{\n\t\tconst {mol} = this;\n\n\t\tlet nattach = 0;\n\t\tlet unit = new PolymerBlockUnit(atoms);\n\n\t\t// process the first atom in the list, and extract its properties that apply to the whole block (assuming degeneracy)\n\t\t// look for atom-encoded properties; note that tags (like connectivity) are degenerate, and are assumed to be the same for all atoms\n\t\tfor (let atom of atoms) for (let extra of mol.atomExtra(atom)) if (extra.startsWith(POLYMERBLOCK_EXTRA_POLYMER))\n\t\t{\n\t\t\tlet bits = extra.substring(POLYMERBLOCK_EXTRA_POLYMER.length).split(':');\n\t\t\tif (bits.length < 2 || parseInt(bits[0]) != id) continue;\n\t\t\tnattach = parseInt(bits[1]);\n\t\t\tfor (let n = 2; n < bits.length; n++)\n\t\t\t{\n\t\t\t\tif (bits[n] == PolymerBlockConnectivity.HeadToTail) unit.connect = PolymerBlockConnectivity.HeadToTail;\n\t\t\t\telse if (bits[n] == PolymerBlockConnectivity.HeadToHead) unit.connect = PolymerBlockConnectivity.HeadToHead;\n\t\t\t\telse if (bits[n] == PolymerBlockConnectivity.Random) unit.connect = PolymerBlockConnectivity.Random;\n\t\t\t\telse if (bits[n].startsWith('n'))\n\t\t\t\t{\n\t\t\t\t\tlet hasOuter = false;\n\t\t\t\t\tfor (let adj of mol.atomAdjList(atom)) if (!atoms.includes(adj)) {hasOuter = true; break;}\n\n\t\t\t\t\tif (hasOuter)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet subBits = bits[n].substring(1).split(',');\n\t\t\t\t\t\tunit.atomName.set(atom, subBits.map((str) => parseInt(str)));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// sanity check: make sure attachment count matches # bonds crossing the block\n\t\tif (nattach < 0) return;\n\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t{\n\t\t\tlet in1 = atoms.indexOf(mol.bondFrom(n)) >= 0, in2 = atoms.indexOf(mol.bondTo(n)) >= 0;\n\t\t\tif ((in1 && !in2) || (!in1 && in2)) nattach--;\n\t\t}\n\t\tif (nattach != 0) return;\n\n\t\t// pull out labelled bonds (if any) to derive the reconnection order\n\t\tlet bonds:number[] = null, order:number[] = null;\n\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t{\n\t\t\tfor (let extra of mol.bondExtra(n)) if (extra.startsWith(POLYMERBLOCK_EXTRA_POLYMER))\n\t\t\t{\n\t\t\t\tlet bits = extra.substring(POLYMERBLOCK_EXTRA_POLYMER.length).split(':');\n\t\t\t\tif (bits.length < 2 || parseInt(bits[0]) != id) continue;\n\t\t\t\tfor (let i = 1; i < bits.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (bits[i].startsWith('i'))\n\t\t\t\t\t{\n\t\t\t\t\t\tlet subBits = bits[i].substring(1).split(',');\n\t\t\t\t\t\tunit.bondIncl.set(n, subBits.map((str) => parseInt(str)));\n\t\t\t\t\t}\n\t\t\t\t\telse if (bits[i].startsWith('e'))\n\t\t\t\t\t{\n\t\t\t\t\t\tlet subBits = bits[i].substring(1).split(',');\n\t\t\t\t\t\tunit.bondExcl.set(n, subBits.map((str) => parseInt(str)));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tlet o = parseInt(bits[i]);\n\t\t\t\t\t\tif (o > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbonds = Vec.append(bonds, n);\n\t\t\t\t\t\t\torder = Vec.append(order, o);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (bonds != null)\n\t\t{\n\t\t\tif (bonds.length % 2 == 1) return; // has to be an even number\n\t\t\tunit.bondConn = Vec.idxGet(bonds, Vec.idxSort(order));\n\t\t}\n\n\t\tthis.units.set(id, unit);\n\t}\n\n\tprivate formatBlockAtom(id:number, unit:PolymerBlockUnit, atom:number):string\n\t{\n\t\tlet nbonds = 0;\n\t\tfor (let n = 1; n <= this.mol.numBonds; n++)\n\t\t{\n\t\t\tlet in1 = unit.atoms.indexOf(this.mol.bondFrom(n)) >= 0, in2 = unit.atoms.indexOf(this.mol.bondTo(n)) >= 0;\n\t\t\tif ((in1 && !in2) || (!in1 && in2)) nbonds++;\n\t\t}\n\n\t\tlet str = POLYMERBLOCK_EXTRA_POLYMER + id + ':' + nbonds;\n\t\tif (unit.connect != null) str += ':' + unit.connect;\n\n\t\tlet names = unit.atomName.get(atom);\n\t\tif (Vec.notBlank(names)) str += ':n' + names.join(',');\n\n\t\treturn str;\n\t}\n\n\tprivate formatBlockBond(id:number, unit:PolymerBlockUnit, bond:number):string\n\t{\n\t\tlet in1 = unit.atoms.includes(this.mol.bondFrom(bond)), in2 = unit.atoms.includes(this.mol.bondTo(bond));\n\t\tlet isBoundary = (in1 && !in2) || (in2 && !in1);\n\t\tif (!isBoundary) return null;\n\n\t\tlet idxConn = unit.bondConn ? unit.bondConn.indexOf(bond) : -1;\n\t\tlet incl = unit.bondIncl.get(bond), excl = unit.bondExcl.get(bond);\n\t\tif (idxConn < 0 && Vec.isBlank(incl) && Vec.isBlank(excl)) return null;\n\n\t\tlet str = POLYMERBLOCK_EXTRA_POLYMER + id;\n\t\tif (idxConn >= 0) str += ':' + (idxConn + 1);\n\t\tif (Vec.notBlank(incl)) str += ':i' + incl.join(',');\n\t\tif (Vec.notBlank(excl)) str += ':e' + excl.join(',');\n\t\treturn str;\n\t}\n\n\tprivate purgeExtraFields():void\n\t{\n\t\tfor (let n = 1; n <= this.mol.numAtoms; n++)\n\t\t{\n\t\t\tlet extra = this.mol.atomExtra(n);\n\t\t\tlet modified = false;\n\t\t\tfor (let i = extra.length - 1; i >= 0; i--) if (extra[i].startsWith(POLYMERBLOCK_EXTRA_POLYMER))\n\t\t\t{\n\t\t\t\textra = Vec.remove(extra, i);\n\t\t\t\tmodified = true;\n\t\t\t}\n\t\t\tif (modified) this.mol.setAtomExtra(n, extra);\n\t\t}\n\t\tfor (let n = 1; n <= this.mol.numBonds; n++)\n\t\t{\n\t\t\tlet extra = this.mol.bondExtra(n);\n\t\t\tlet modified = false;\n\t\t\tfor (let i = extra.length - 1; i >= 0; i--) if (extra[i].startsWith(POLYMERBLOCK_EXTRA_POLYMER))\n\t\t\t{\n\t\t\t\textra = Vec.remove(extra, i);\n\t\t\t\tmodified = true;\n\t\t\t}\n\t\t\tif (modified) this.mol.setBondExtra(n, extra);\n\t\t}\n\t}\n\n\tprivate writeUnit(id:number, unit:PolymerBlockUnit):void\n\t{\n\t\tconst {mol} = this;\n\t\tfor (let a of unit.atoms)\n\t\t{\n\t\t\tlet codeAtom = this.formatBlockAtom(id, unit, a);\n\t\t\tmol.setAtomExtra(a, Vec.append(mol.atomExtra(a), codeAtom));\n\t\t}\n\t\tfor (let b = 1; b <= mol.numBonds; b++)\n\t\t{\n\t\t\tlet codeBond = this.formatBlockBond(id, unit, b);\n\t\t\tif (codeBond) mol.setBondExtra(b, Vec.append(mol.bondExtra(b), codeBond));\n\t\t}\n\t}\n\n\t// using a disposable array, finds the next suitable identifier given that some number may already been taken\n\tprivate nextIdentifier(keys?:number[]):number\n\t{\n\t\tif (!keys) keys = this.getIDList();\n\t\tif (keys.length == 0) return 1;\n\t\tfor (let n = 0; n < keys.length - 1; n++) if (keys[n + 1] != keys[n] + 1) return keys[n] + 1;\n\t\treturn keys[keys.length - 1] + 1;\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {GeomUtil} from '../util/Geom';\nimport {angleDiff, angleDiffPos, angleNorm, DEGRAD, norm2_xy, norm_xy, sortAngles, sqr, TWOPI} from '../util/util';\nimport {Vec} from '../util/Vec';\nimport {Chemistry} from './Chemistry';\nimport {CoordUtil} from './CoordUtil';\nimport {Molecule} from './Molecule';\nimport {MolUtil} from './MolUtil';\n\n/*\n\tSketchUtil: static methods for calculating properties of molecules, typically of the geometric variety.\n*/\n\nexport interface GuidelineSprout\n{\n\tatom:number; // source atom (0 if free-drawing)\n\torders:number[]; // applicable bond orders\n\tx:number[]; // destination in molecular coordinates\n\ty:number[]; // \"\n\tsourceX?:number; // source position in screen coordinates\n\tsourceY?:number; // \"\n\tdestX?:number[]; // destination positions in screen coordinates\n\tdestY?:number[];\n}\n\nexport enum Geometry\n{\n\tLinear = 0,\n\tBent,\n\tTrigonal,\n\tTetra1,\n\tTetra2,\n\tSqPlan,\n\tBasePyram,\n\tTrigBip,\n\tOcta1,\n\tOcta2\n}\n\nexport class SketchUtil\n{\n\tpublic static GEOM_ANGLES =\n\t[ // (these match the Geometry* constants)\n\t\t[0, 180 * DEGRAD],\n\t\t[0, 120 * DEGRAD],\n\t\t[0, 120 * DEGRAD, 240 * DEGRAD],\n\t\t[0, 90 * DEGRAD, 150 * DEGRAD, 240 * DEGRAD],\n\t\t[0, 120 * DEGRAD, 180 * DEGRAD, 240 * DEGRAD],\n\t\t[0, 90 * DEGRAD, 180 * DEGRAD, 270 * DEGRAD],\n\t\t[0, 90 * DEGRAD, 150 * DEGRAD, 210 * DEGRAD, 270 * DEGRAD],\n\t\t[0, 60 * DEGRAD, 90 * DEGRAD, 180 * DEGRAD, 210 * DEGRAD],\n\t\t[0, 60 * DEGRAD, 120 * DEGRAD, 180 * DEGRAD, 240 * DEGRAD, 300 * DEGRAD],\n\t\t[0, 45 * DEGRAD, 90 * DEGRAD, 180 * DEGRAD, 225 * DEGRAD, 270 * DEGRAD]\n\t];\n\n\t// adds a new atom to the molecule, and returns its index; the new atom is placed in a reasonable position\n\tpublic static placeNewAtom(mol:Molecule, el:string):number\n\t{\n\t\tlet box = mol.boundary();\n\t\tlet x = box.maxX() + Molecule.IDEALBOND, y = box.maxY();\n\t\t// MAYBE: see if the highest-indexed atom is a loner, and maybe line the new one up with it?\n\t\treturn mol.addAtom(el, x, y);\n\t}\n\n\t// finds a nice place to put the new fragment which does not overlap existing content, then appends the atoms & bonds to\n\t// the mol parameter\n\tpublic static placeNewFragment(mol:Molecule, frag:Molecule):void\n\t{\n\t\tif (frag.numAtoms == 0) return;\n\n\t\tlet dirX = [1, 0, -1, 1, -1, 1, 0, -1], dirY = [1, 1, 1, 0, 0, -1, -1, -1];\n\t\tlet dx = Vec.numberArray(0, 8), dy = Vec.numberArray(0, 8), score = Vec.numberArray(0, 8);\n\t\tlet mbox = mol.boundary(), fbox = frag.boundary();\n\n\t\tfor (let n = 0; n < 8; n++)\n\t\t{\n\t\t\tlet vx = dirX[n], vy = dirY[n];\n\n\t\t\tif (n == 0 || n == 3 || n == 5) dx[n] = mbox.minX() - fbox.maxX();\n\t\t\telse if (n == 2 || n == 4 || n == 7) dx[n] = mbox.maxX() - fbox.minX();\n\t\t\telse dx[n] = 0.5 * (mbox.minX() + mbox.maxX() - fbox.minX() - fbox.maxX());\n\n\t\t\tif (n == 5 || n == 6 || n == 7) dy[n] = mbox.minY() - fbox.maxY();\n\t\t\telse if (n == 0 || n == 1 || n == 2) dy[n] = mbox.maxY() - fbox.minY();\n\t\t\telse dy[n] = 0.5 * (mbox.minY() + mbox.maxY() - fbox.minY() - fbox.maxY());\n\n\t\t\tdx[n] -= vx;\n\t\t\tdy[n] -= vy;\n\t\t\tscore[n] = SketchUtil.fragPosScore(mol, frag, dx[n], dy[n]);\n\n\t\t\tvx *= 0.25;\n\t\t\tvy *= 0.25;\n\t\t\tfor (let iter = 100; iter > 0; iter--)\n\t\t\t{\n\t\t\t\tlet iscore = SketchUtil.fragPosScore(mol, frag, dx[n] + vx, dy[n] + vy);\n\t\t\t\tif (iscore <= score[n]) break;\n\t\t\t\tscore[n] = iscore;\n\t\t\t\tdx[n] += vx;\n\t\t\t\tdy[n] += vy;\n\t\t\t}\n\t\t\tfor (let iter = 100; iter > 0; iter--) for (let d = 0; d < 8; d++)\n\t\t\t{\n\t\t\t\tvx = dirX[d] * 0.1;\n\t\t\t\tvy = dirY[d] * 0.1;\n\t\t\t\tlet iscore = SketchUtil.fragPosScore(mol, frag, dx[n] + vx, dy[n] + vy);\n\t\t\t\tif (iscore <= score[n]) break;\n\t\t\t\tscore[n] = iscore;\n\t\t\t\tdx[n] += vx;\n\t\t\t\tdy[n] += vy;\n\t\t\t}\n\t\t}\n\n\t\tlet best = 0;\n\t\tfor (let n = 1; n < 8; n++) if (score[n] > score[best]) best = n;\n\n\t\tfrag = frag.clone();\n\t\tfor (let n = 1; n <= frag.numAtoms; n++) frag.setAtomPos(n, frag.atomX(n) + dx[best], frag.atomY(n) + dy[best]);\n\n\t\tmol.append(frag);\n\t}\n\n\t// scoring function for above: more congested is better, but any two atoms < 1A = zero; post-biased to favour square\n\t// aspect ratio\n\tprivate static fragPosScore(mol:Molecule, frag:Molecule, dx:number, dy:number):number\n\t{\n\t\tlet score = 0;\n\t\tfor (let i = 1; i <= mol.numAtoms; i++) for (let j = 1; j <= frag.numAtoms; j++)\n\t\t{\n\t\t\tlet ox = frag.atomX(j) + dx - mol.atomX(i), oy = frag.atomY(j) + dy - mol.atomY(i);\n\t\t\tlet dist2 = ox * ox + oy * oy;\n\t\t\tif (dist2 < 1) return 0;\n\t\t\tscore += 1 / dist2;\n\t\t}\n\n\t\tlet mbox = mol.boundary(), fbox = frag.boundary();\n\t\tlet minX = Math.min(fbox.minX() + dx, mbox.minX()), maxX = Math.max(fbox.maxX() + dx, mbox.maxX());\n\t\tlet minY = Math.min(fbox.minY() + dy, mbox.minY()), maxY = Math.max(fbox.maxY() + dy, mbox.maxY());\n\n\t\tlet rangeX = Math.max(1, maxX - minX), rangeY = Math.max(1, maxY - minY);\n\t\tlet ratio = Math.max(rangeX / rangeY, rangeY / rangeX);\n\t\treturn score / ratio;\n\t}\n\n\t// reduces the number of atoms until there are none that are really close together\n\tpublic static mergeOverlappingAtoms(mol:Molecule):number[]\n\t{\n\t\treturn SketchUtil.mergeFragmentsDiv(mol, 0);\n\t}\n\n\t// for a molecule which has been put together from two fragments, looks for atoms which overlap; the molecule is divided up\n\t// into {1 .. div} and {div+1 .. #atoms}, and which are matched against each other; whenever two atoms are found to overlap,\n\t// they are merged together; non-carbon atoms are more likely to be retained\n\t// the return value is a re-mapping index, i.e. ret[old_atom_number-1]=new_atom_number; whenever two atoms are merged, they both\n\t// end up with the same new-atom-number.\n\t// NOTE: special case where div==0, which makes all atoms fair game, i.e. there is no partition\n\tpublic static mergeFragmentsDiv(mol:Molecule, div:number):number[]\n\t{\n\t\tconst na = mol.numAtoms;\n\t\tlet omask = CoordUtil.overlappingAtomMask(mol);\n\n\t\tlet chopmask = Vec.booleanArray(false, na);\n\t\tlet mx = MolUtil.arrayAtomX(mol), my = MolUtil.arrayAtomY(mol);\n\n\t\tlet remap:number[] = [];\n\t\tfor (let n = 0; n < na; n++) remap.push(n + 1);\n\n\t\tlet div1 = div, div2 = div + 1;\n\t\tif (div == 0) div1 = na;\n\n\t\t// any atoms which overlap each other in space are made into the same\n\t\tfor (let i = 1; i <= div1; i++) if (omask[i - 1] && !chopmask[i - 1])\n\t\t{\n\t\t\tif (div == 0) div2 = i + 1;\n\n\t\t\tfor (let j = div2; j <= na; j++) if (omask[j - 1] && !chopmask[j - 1])\n\t\t\t{\n\t\t\t\tif (norm2_xy(mx[i - 1] - mx[j - 1], my[i - 1] - my[j - 1]) > CoordUtil.OVERLAP_THRESHOLD_SQ) continue;\n\t\t\t\tlet oldN = j, newN = i; // remove the later one, by default\n\n\t\t\t\t// want to keep the more exotic of the two\n\t\t\t\tlet exotic = [0, 0];\n\t\t\t\tfor (let k = 0; k < 2; k++)\n\t\t\t\t{\n\t\t\t\t\tlet a = k == 0 ? i : j;\n\t\t\t\t\texotic[k] = (mol.atomElement(a) == 'C' ? 0 : 1)\n\t\t\t\t\t\t\t+ (mol.atomElement(a) == 'X' ? -100 : 0)\n\t\t\t\t\t\t\t+ (mol.atomCharge(a) != 0 ? 1 : 0)\n\t\t\t\t\t\t\t+ (mol.atomUnpaired(a) != 0 ? 1 : 0)\n\t\t\t\t\t\t\t+ (mol.atomIsotope(a) != Molecule.ISOTOPE_NATURAL ? 1 : 0)\n\t\t\t\t\t\t\t+ (mol.atomHExplicit(a) != Molecule.HEXPLICIT_UNKNOWN ? 1 : 0)\n\t\t\t\t\t\t\t+ (MolUtil.hasAbbrev(mol, a) ? 1000 : 0);\n\t\t\t\t}\n\n\t\t\t\tif (exotic[1] > exotic[0]) {oldN = i; newN = j;}\n\n\t\t\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t\t\t{\n\t\t\t\t\tif (mol.bondFrom(n) == oldN) mol.setBondFrom(n, newN);\n\t\t\t\t\tif (mol.bondTo(n) == oldN) mol.setBondTo(n, newN);\n\t\t\t\t}\n\t\t\t\tchopmask[oldN - 1] = true;\n\t\t\t\tremap[oldN - 1] = newN;\n\t\t\t}\n\t\t}\n\n\t\t// do the actual surgery\n\t\tfor (let n = na; n >= 1; n--) if (chopmask[n - 1])\n\t\t{\n\t\t\tif (n <= div) div--;\n\t\t\tmol.deleteAtomAndBonds(n);\n\t\t\tfor (let i = 0; i < na; i++) if (remap[i] > n) remap[i]--;\n\t\t}\n\t\tfor (let n = mol.numAtoms; n > div; n--) if (mol.atomElement(n) == 'X')\n\t\t{\n\t\t\tmol.deleteAtomAndBonds(n);\n\t\t\tfor (let i = 0; i < na; i++) if (remap[i] > n) remap[i]--;\n\t\t}\n\n\t\tMolUtil.removeDuplicateBonds(mol);\n\n\t\treturn remap;\n\t}\n\n\t// another variation on the merge theme: the atoms indicated by 'mask' are fair-game for joining to the atoms in the rest\n\t// of the molecule\n\tpublic static mergeFragmentsMask(mol:Molecule, mask:boolean[]):void\n\t{\n\t\tlet chopmask = Vec.booleanArray(false, mol.numAtoms);\n\t\tlet na = mol.numAtoms;\n\t\tlet mx = MolUtil.arrayAtomX(mol), my = MolUtil.arrayAtomY(mol);\n\n\t\tfor (let i = 1; i <= na; i++) if (mask[i - 1]) for (let j = 1; j <= na; j++)\n\t\t\tif (!mask[j - 1] && !chopmask[j - 1]) if (norm2_xy(mx[i - 1] - mx[j - 1], my[i - 1] - my[j - 1]) < CoordUtil.OVERLAP_THRESHOLD_SQ)\n\t\t{\n\t\t\tlet oldN = j, newN = i; // remove the later one, by default\n\t\t\tif (mol.atomElement(i) == 'C' && mol.atomElement(j) != 'C' && mol.atomElement(j) != 'X') [oldN, newN] = [i, j];\n\t\t\t\n\t\t\tif (mol.atomHExplicit(newN) == Molecule.HEXPLICIT_UNKNOWN) mol.setAtomHExplicit(newN, mol.atomHExplicit(oldN));\n\t\t\tmol.setAtomUnpaired(newN, mol.atomUnpaired(newN) + mol.atomUnpaired(oldN));\n\t\t\tmol.setAtomCharge(newN, mol.atomCharge(newN) + mol.atomCharge(oldN));\n\t\t\tmol.setAtomExtra(newN, Vec.concat(mol.atomExtra(oldN), mol.atomExtra(newN)));\n\n\t\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t\t{\n\t\t\t\tif (mol.bondFrom(n) == oldN) mol.setBondFrom(n, newN);\n\t\t\t\tif (mol.bondTo(n) == oldN) mol.setBondTo(n, newN);\n\t\t\t}\n\n\t\t\tchopmask[oldN - 1] = true;\n\t\t}\n\t\tfor (let n = chopmask.length; n >= 1; n--) if (chopmask[n - 1]) mol.deleteAtomAndBonds(n);\n\t\tMolUtil.removeDuplicateBonds(mol);\n\t}\n\n\t// returns whether or not there is any way in which the given values of theta can match the indicated geometry\n\tpublic static matchAngleGeometry(geom:number, theta:number[]):boolean\n\t{\n\t\tif (theta.length <= 1) return true; // always possible\n\n\t\tlet match = SketchUtil.GEOM_ANGLES[geom], mtheta = Vec.numberArray(0, theta.length);\n\t\tlet hit = Vec.booleanArray(false, match.length);\n\t\tfor (let n = 0; n < theta.length; n++) for (let s = 1; s >= -1; s -= 2)\n\t\t{\n\t\t\tfor (let i = 0; i < theta.length; i++) mtheta[i] = (theta[i] - theta[0]) * s;\n\t\t\tVec.setTo(hit, false);\n\t\t\tlet gotall = true;\n\t\t\tfor (let i = 0; i < mtheta.length; i++)\n\t\t\t{\n\t\t\t\tlet got = false;\n\t\t\t\tfor (let j = 0; j < match.length; j++) if (!hit[j] && Math.abs(angleDiff(mtheta[i], match[j])) < 3 * DEGRAD)\n\t\t\t\t{\n\t\t\t\t\thit[j] = true;\n\t\t\t\t\tgot = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (!got) {gotall = false; break;}\n\t\t\t}\n\t\t\tif (gotall) return true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t// for a particular atom, figures out the outgoing angles that are most likely to be good for placing a new atom+bond; these\n\t// are found by postulating where a single bond might be drawn based on common geometries for the hybridisation, and using\n\t// simple geometric median-cut angles; the results are not ordered with any kind of preference\n\tpublic static primeDirections(mol:Molecule, atom:number):number[]\n\t{\n\t\tlet angles = SketchUtil.calculateNewBondAngles(mol, atom, 1);\n\t\tlet exits = SketchUtil.exitVectors(mol, atom);\n\t\treturn GeomUtil.uniqueAngles(angles.concat(exits), 2 * DEGRAD);\n\t}\n\n\t// for a given atom, calculates a set of angles that protude outward based on positions between existing bond angles; this\n\t// is primarily used for proposing new bond positions when the hybridisation does not match one of the common sketch geometries\n\tpublic static exitVectors(mol:Molecule, atom:number):number[]\n\t{\n\t\tlet adj = mol.atomAdjList(atom), sz = adj.length;\n\n\t\t// if it's a singleton, return 4 points of the compass\n\t\tif (sz == 0) return [0, 90 * DEGRAD, 180 * DEGRAD, -90 * DEGRAD];\n\n\t\t// if it's terminal, offer nothing\n\t\tif (sz == 1) return [];\n\n\t\t// there is enough content, so build the angles\n\t\tlet ret:number[] = [];\n\t\tlet ang = GeomUtil.sortAngles(CoordUtil.atomBondAngles(mol, atom, adj));\n\t\tfor (let n = 0; n < sz; n++)\n\t\t{\n\t\t\tlet nn = n < sz - 1 ? n + 1 : 0;\n\t\t\tret.push(angleNorm(ang[n] + 0.5 * angleDiffPos(ang[nn], ang[n])));\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\t// for a given atom, considers adding a new bond/atom of the specified bond order, and returns a list of angles\n\t// that are appropriate given the atom's hybridisation and current geometry; if the current geometry does not match\n\t// any of the common sketch patterns, an empty list will be returned\n\t// (note: recommend using exitVectors(..) if this method returns nothing)\n\tpublic static calculateNewBondAngles(mol:Molecule, atom:number, order:number):number[]\n\t{\n\t\tlet adj = mol.atomAdjList(atom);\n\t\tconst sz = adj.length;\n\n\t\t// terminal atoms\n\t\tif (sz == 0)\n\t\t{\n\t\t\tlet atno = mol.atomicNumber(atom), atblk = Chemistry.ELEMENT_BLOCKS[atno];\n\t\t\tif (atblk <= 2)\n\t\t\t\treturn [0, 90 * DEGRAD, 180 * DEGRAD, -90 * DEGRAD];\n\t\t\telse\n\t\t\t\treturn [90 * DEGRAD, -90 * DEGRAD, 30 * DEGRAD, 150 * DEGRAD, 210 * DEGRAD, -30 * DEGRAD, 180 * DEGRAD, 0 * DEGRAD];\n\t\t}\n\n\t\t// obtain the \"guessed\" geometry options based on hybridisation, and try to map each of them onto the current\n\t\t// geometry; if any of them works, that becomes the answer\n\t\tlet geom = SketchUtil.guessAtomGeometry(mol, atom, order);\n\t\tlet ang = CoordUtil.atomBondAngles(mol, atom, adj);\n\t\tfor (let n = 0; n < geom.length; n++)\n\t\t{\n\t\t\tlet ret = SketchUtil.mapAngleSubstituent(geom[n], ang);\n\t\t\tif (ret != null) return ret;\n\t\t}\n\n\t\t// none of them match, get an empty list back\n\t\treturn [];\n\t}\n\n\t// considers the hybridisation state of the atom, and the order of a new bond that is about to be added, and returns\n\t// a list of common geometry codes that apply to the situation; returns 0-size if none are appropriate\n\tpublic static guessAtomGeometry(mol:Molecule, atom:number, order:number):number[]\n\t{\n\t\tlet adj = mol.atomAdjList(atom);\n\t\tlet sz = adj.length, atno = mol.atomicNumber(atom);\n\t\tlet atblk = Chemistry.ELEMENT_BLOCKS[atno], elrow = Chemistry.ELEMENT_ROWS[atno];\n\t\tlet el = mol.atomElement(atom);\n\n\t\t// sort the neighbours by priority\n\t\tlet adjBO:number[] = [], adjAN:number[] = [], pri:number[] = [];\n\t\tlet allSingle = true;\n\t\tfor (let n = 0; n < sz; n++)\n\t\t{\n\t\t\tadjBO.push(mol.bondOrder(mol.findBond(atom, adj[n])));\n\t\t\tadjAN.push(mol.atomicNumber(adj[n]));\n\t\t\tpri.push(adjBO[n] * 200 + adjAN[n]);\n\t\t\tif (adjBO[n] != 1) allSingle = true;\n\t\t}\n\t\tfor (let p = 0; p < sz - 1;)\n\t\t{\n\t\t\tif (pri[p] > pri[p + 1])\n\t\t\t{\n\t\t\t\tVec.swap(adj, p, p + 1);\n\t\t\t\tVec.swap(adjBO, p, p + 1);\n\t\t\t\tVec.swap(adjAN, p, p + 1);\n\t\t\t\tVec.swap(pri, p, p + 1);\n\t\t\t\tif (p > 0) p--;\n\t\t\t}\n\t\t\telse p++;\n\t\t}\n\t\tlet ang = CoordUtil.atomBondAngles(mol, atom, adj);\n\n\t\t// if atom is terminal...\n\t\tif (sz == 1)\n\t\t{\n\t\t\tif (el == 'C' || el == 'N')\n\t\t\t{\n\t\t\t\t// allene-like\n\t\t\t\tif (adjBO[0] == 2 && order == 2) return [Geometry.Linear];\n\n\t\t\t\t// alkyne-like\n\t\t\t\tif ((adjBO[0] == 3 && order == 1) || (adjBO[0] == 1 && order == 3)) return [Geometry.Linear];\n\t\t\t}\n\n\t\t\t// octahedral option for d-blocks\n\t\t\tif (atblk > 2) return [Geometry.Octa1, Geometry.Octa2];\n\n\t\t\t// row 2 organics: trigonal only\n\t\t\tif (order != 0 && (el == 'C' || el == 'N' || el == 'O')) return [Geometry.Trigonal];\n\n\t\t\t// otherwise, linear and trigonal are the best options to run with\n\t\t\treturn [Geometry.Trigonal, Geometry.Linear];\n\t\t}\n\n\t\t// atom is linear: orthogonal angles are implied\n\t\tif (sz == 2 && Math.abs(angleDiff(ang[0], ang[1])) >= 175 * DEGRAD)\n\t\t{\n\t\t\tif (atblk <= 2)\n\t\t\t\treturn [Geometry.SqPlan];\n\t\t\telse\n\t\t\t\treturn [Geometry.Octa1, Geometry.Octa2];\n\t\t}\n\n\t\t// done with special cases: include all geometries sensible for the topology\n\t\tlet geom:number[] = [];\n\t\tif (atblk == 0) geom = [Geometry.Trigonal, Geometry.SqPlan];\n\t\telse if (atblk == 1) geom = [Geometry.Trigonal, Geometry.SqPlan, Geometry.Octa1, Geometry.Octa2];\n\t\telse if (atblk == 2)\n\t\t{\n\t\t\tgeom.push(Geometry.Trigonal);\n\t\t\tif (el == 'C' && allSingle)\n\t\t\t{\n\t\t\t\tgeom.push(Geometry.Tetra1);\n\t\t\t\tgeom.push(Geometry.Tetra2);\n\t\t\t\tgeom.push(Geometry.SqPlan);\n\t\t\t}\n\t\t\telse if (el == 'C' && !allSingle)\n\t\t\t{\n\t\t\t\t// nop\n\t\t\t}\n\t\t\telse if (elrow <= 3)\n\t\t\t{\n\t\t\t\tgeom.push(Geometry.Tetra1);\n\t\t\t\tgeom.push(Geometry.Tetra2);\n\t\t\t\tgeom.push(Geometry.SqPlan);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tgeom.push(Geometry.Tetra1);\n\t\t\t\tgeom.push(Geometry.Tetra2);\n\t\t\t\tgeom.push(Geometry.SqPlan);\n\t\t\t\tgeom.push(Geometry.Octa1);\n\t\t\t\tgeom.push(Geometry.Octa2);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tgeom.push(Geometry.Octa1);\n\t\t\tgeom.push(Geometry.Octa2);\n\t\t}\n\n\t\t// remove the ones that don't fit\n\t\tfor (let n = geom.length - 1; n >= 0; n--)\n\t\t{\n\t\t\tif (!SketchUtil.matchAngleGeometry(geom[n], ang)) geom.splice(n, 1);\n\t\t}\n\n\t\treturn geom;\n\t}\n\n\t// for a given geometry code, looks for ways to map the current set of angles onto the predefined set; when a lock is\n\t// found, the unoccupied positions are summarised and returned; if there is no way to perform the map, null is returned\n\tpublic static mapAngleSubstituent(geom:number, ang:number[]):number[]\n\t{\n\t\tlet gtheta = SketchUtil.GEOM_ANGLES[geom];\n\t\tconst asz = ang.length, gsz = gtheta.length;\n\n\t\t// if there are no vacancies, stop now\n\t\tif (asz >= gsz) return null;\n\n\t\t// if the atom is isolated, no need to rotate or lock anything\n\t\tif (asz == 0) return gtheta.slice(0);\n\n\t\t// collect all the angles implied by the geometry, in all its degeneracy\n\t\tlet vac:number[] = [];\n\t\tfor (let n = 0; n < asz; n++) for (let k = 0; k < gsz; k++) for (let s = 1; s >= -1; s -= 2)\n\t\t{\n\t\t\tlet gang:number[] = [];\n\t\t\tfor (let i = 0; i < gsz; i++) gang.push(angleNorm(ang[n] + s * (gtheta[i] - gtheta[k])));\n\t\t\tlet mask = Vec.booleanArray(false, gsz);\n\t\t\tlet mcount = 0;\n\t\t\tfor (let i = 0; i < gsz; i++) if (!mask[i]) for (let j = 0; j < asz; j++)\n\t\t\t\tif (Math.abs(angleDiff(gang[i], ang[j])) < 3 * DEGRAD)\n\t\t\t{\n\t\t\t\tmask[i] = true;\n\t\t\t\tmcount++;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (mcount != asz) continue;\n\t\t\tfor (let i = 0; i < gsz; i++) if (!mask[i]) vac.push(gang[i]);\n\t\t}\n\t\tif (vac.length == 0) return null;\n\n\t\t// sort and remove degenerates\n\t\tvac = GeomUtil.sortAngles(vac);\n\t\tfor (let n = 0; n < vac.length - 1; n++)\n\t\t{\n\t\t\tlet th1 = vac[n], th2 = vac[n + 1], dth = angleDiff(th2, th1);\n\t\t\tif (Math.abs(dth) < 5 * DEGRAD)\n\t\t\t{\n\t\t\t\tvac[n] = th1 + 0.5 * dth;\n\t\t\t\tvac.splice(n + 1, 1);\n\t\t\t\tn--;\n\t\t\t}\n\t\t}\n\n\t\treturn vac;\n\t}\n\n\t// for a given molecule, ensures that a specific atom fits a given geometry template; if so, returns null; if not, looks for\n\t// a way to fit the bonds into the geometry template with minimum perturbation, and applies the result by rotating the\n\t// bonds as necessary; bonds that occur in rings constrain the options significantly\n\tpublic static refitAtomGeometry(mol:Molecule, atom:number, geom:number):Molecule\n\t{\n\t\tlet gtheta = SketchUtil.GEOM_ANGLES[geom];\n\t\tlet gsz = gtheta.length;\n\n\t\tlet adj = mol.atomAdjList(atom);\n\t\tlet asz = adj.length;\n\n\t\t// must be nore than one atom, and cannot exceed the geometry extent\n\t\tif (asz <= 1 || asz > gsz) return null;\n\n\t\tlet ang = CoordUtil.atomBondAngles(mol, atom, adj);\n\t\tlet inRing = Vec.booleanArray(false, asz);\n\t\tlet allInRing = true;\n\t\tfor (let n = 0; n < asz; n++)\n\t\t{\n\t\t\tinRing[n] = mol.bondInRing(mol.findBond(atom, adj[n]));\n\t\t\tif (!inRing[n]) allInRing = false;\n\t\t}\n\t\tif (allInRing) return null; // can't work with this\n\n\t\t// start looking for the best set-of-angles for the new geometry\n\t\tlet bestAng:number[] = null;\n\t\tlet bestScore = 0;\n\t\tlet ww = MolUtil.calculateWalkWeight(mol, atom);\n\n\t\tfor (let i = 0; i < gsz; i++) for (let j = 0; j < asz; j++) for (let s = 1; s >= -1; s -= 2)\n\t\t{\n\t\t\tlet newAng = Vec.numberArray(0, asz);\n\t\t\tlet mask = Vec.booleanArray(false, gsz);\n\n\t\t\tfor (let n1 = 0; n1 < asz; n1++)\n\t\t\t{\n\t\t\t\tlet best = -1;\n\t\t\t\tlet bdiff = 0;\n\t\t\t\tfor (let n2 = 0; n2 < gsz; n2++) if (!mask[n2])\n\t\t\t\t{\n\t\t\t\t\tlet th = angleNorm(gtheta[n2] * s - gtheta[i] + ang[j]);\n\t\t\t\t\tlet diff = Math.abs(angleDiff(th, ang[n1]));\n\t\t\t\t\tif (best < 0 || diff < bdiff)\n\t\t\t\t\t{\n\t\t\t\t\t\tbest = n2;\n\t\t\t\t\t\tbdiff = diff;\n\t\t\t\t\t\tnewAng[n1] = th;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tmask[best] = true;\n\t\t\t}\n\n\t\t\tlet ringClash = false;\n\t\t\tfor (let n = 0; n < asz; n++) if (inRing[n] && Math.abs(angleDiff(newAng[n], ang[n])) > 2 * DEGRAD)\n\t\t\t{\n\t\t\t\tringClash = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (ringClash) continue;\n\n\t\t\tlet score = 0;\n\t\t\tfor (let n = 0; n < asz; n++) score += ww[adj[n] - 1] * Math.abs(angleDiff(newAng[n], ang[n]));\n\t\t\tif (bestAng == null || score < bestScore)\n\t\t\t{\n\t\t\t\tbestAng = newAng;\n\t\t\t\tbestScore = score;\n\t\t\t}\n\t\t}\n\n\t\tif (bestAng == null) return null;\n\n\t\t// if the best one is basically what we already have, then fail\n\t\tlet same = true;\n\t\tfor (let n = 0; n < asz; n++) if (Math.abs(angleDiff(bestAng[n], ang[n])) > 2 * DEGRAD) {same = false; break;}\n\t\tif (same) return null;\n\n\t\t// apply the changes\n\t\tmol = mol.clone();\n\t\tfor (let n = 0; n < asz; n++) if (!inRing[n]) CoordUtil.rotateBond(mol, atom, adj[n], bestAng[n] - ang[n]);\n\t\treturn mol;\n\t}\n\n\t// for a given source atom, and one-or-more adjacent atoms, and a list of possible geometries, propose\n\t// a molecule in which one of the adjacent atoms has been rotated around to lock into the next geometry-valid\n\t// position; return value of null means that no new options were discovered\n\t// note: it is assumed that the adjacent atoms are terminal\n\tpublic static switchAtomGeometry(mol:Molecule, src:number, dst:number[], geoms:number[]):Molecule\n\t{\n\t\tlet bestAtom = 0;\n\t\tlet bestAng = 0, bestX = 0, bestY = 0;\n\t\tlet adj = mol.atomAdjList(src);\n\t\tlet ang = CoordUtil.atomBondAngles(mol, src, adj), theta = Vec.numberArray(0, ang.length - 1);\n\t\tlet cx = mol.atomX(src), cy = mol.atomY(src);\n\n\t\tfor (let i = 0; i < dst.length; i++)\n\t\t{\n\t\t\tlet a = adj.indexOf(dst[i]);\n\t\t\tlet curth = ang[a];\n\t\t\tfor (let n = 0, p = 0; n < adj.length; n++) if (n != a) theta[p++] = ang[n];\n\t\t\tlet r = norm_xy(mol.atomX(dst[i]) - cx, mol.atomY(dst[i]) - cy);\n\n\t\t\tfor (let j = 0; j < geoms.length; j++)\n\t\t\t{\n\t\t\t\tif (adj.length >= SketchUtil.GEOM_ANGLES[geoms[j]].length) continue;\n\n\t\t\t\tlet newAng = SketchUtil.mapAngleSubstituent(geoms[j], theta);\n\t\t\t\tif (newAng != null) for (let n = 0; n < newAng.length; n++)\n\t\t\t\t{\n\t\t\t\t\tlet dth = angleDiff(newAng[n], curth);\n\t\t\t\t\tif (Math.abs(dth) < 3 * DEGRAD) continue;\n\t\t\t\t\tif (dth < 0) dth += TWOPI;\n\n\t\t\t\t\tif (bestAtom == 0 || dth < bestAng - 2 * DEGRAD || (dth < bestAng + 2 * DEGRAD && dst[i] < bestAtom))\n\t\t\t\t\t{\n\t\t\t\t\t\tlet x = cx + r * Math.cos(newAng[n]);\n\t\t\t\t\t\tlet y = cy + r * Math.sin(newAng[n]);\n\t\t\t\t\t\tif (CoordUtil.atomAtPoint(mol, x, y) != 0) continue;\n\n\t\t\t\t\t\tbestAtom = dst[i];\n\t\t\t\t\t\tbestAng = dth;\n\t\t\t\t\t\tbestX = x;\n\t\t\t\t\t\tbestY = y;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// note: this means only the first geometry is used; seems to work best this way\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (bestAtom == 0) return null;\n\n\t\t// apply the changes\n\t\tmol = mol.clone();\n\t\tmol.setAtomPos(bestAtom, bestX, bestY);\n\t\treturn mol;\n\t}\n\n\t// for a list of atoms, consider all pairwise combinations for potentially connecting up; the basic idea is that atoms which are not\n\t// bonded, but are very near the ideal bond distance, always get connected; if there are none of these, it picks the two atoms which\n\t// are closest together; the return value if an array of pairs, i.e. {from1,to1,from2,to2,...}\n\t// NOTE: it will not add bonds between any two atoms which are in the same ring block; this makes it too easy to accidently create\n\t// systems which are too interconnected\n\tpublic static pickAtomsToConnect(mol:Molecule, aidx:number[]):number[]\n\t{\n\t\tif (aidx.length < 2) return null;\n\t\tif (aidx.length == 2)\n\t\t{\n\t\t\tif (mol.findBond(aidx[0], aidx[1]) > 0) return null;\n\t\t\treturn aidx;\n\t\t}\n\n\t\t// multiple atoms, so pass down the list looking for inspiration\n\t\tconst AUTO_DSQ = sqr(Molecule.IDEALBOND + 0.1);\n\t\tlet bestDSQ = Number.MAX_VALUE;\n\t\tlet bestA1 = 0, bestA2 = 0;\n\n\t\tlet conn:number[] = [];\n\n\t\tfor (let i = 0; i < aidx.length - 1; i++) for (let j = i + 1; j < aidx.length; j++)\n\t\t{\n\t\t\tif (mol.findBond(aidx[i], aidx[j]) > 0) continue;\n\t\t\tlet dsq = norm2_xy(mol.atomX(aidx[i]) - mol.atomX(aidx[j]), mol.atomY(aidx[i]) - mol.atomY(aidx[j]));\n\t\t\tif (dsq < AUTO_DSQ) {conn.push(aidx[i]); conn.push(aidx[j]);}\n\t\t\telse if (dsq < bestDSQ) {bestDSQ = dsq; bestA1 = aidx[i]; bestA2 = aidx[j];}\n\t\t}\n\t\tif (conn.length == 0 && bestA1 != 0) {conn.push(bestA1); conn.push(bestA2);}\n\n\t\treturn conn.length == 0 ? null : conn;\n\t}\n\n\t// for a given atom and a list of directions in which a new atom+bond might be created, return which is preferable\n\tpublic static pickNewAtomDirection(mol:Molecule, atom:number, theta:number[]):number\n\t{\n\t\tif (theta.length == 1) return theta[0];\n\n\t\tlet bestTheta = theta[0], bestScore = Number.MAX_VALUE;\n\t\tfor (let n = 0; n < theta.length; n++)\n\t\t{\n\t\t\tlet px = mol.atomX(atom) + Molecule.IDEALBOND * Math.cos(theta[n]);\n\t\t\tlet py = mol.atomY(atom) + Molecule.IDEALBOND * Math.sin(theta[n]);\n\n\t\t\tlet score = CoordUtil.congestionPoint(mol, px, py);\n\t\t\tif (score > bestScore) continue;\n\t\t\tif (CoordUtil.overlapsAtom(mol, px, py, 0.2)) score += 1E5;\n\t\t\tif (score < bestScore) {bestTheta = theta[n]; bestScore = score;}\n\t\t}\n\t\treturn bestTheta;\n\t}\n\n\t// for atoms qualifying with the given mask, any group of more than one atom that overlap, merges them together\n\tpublic static joinOverlappingAtoms(mol:Molecule, mask:boolean[]):Molecule\n\t{\n\t\tmol = mol.clone();\n\t\tmask = mask.slice(0);\n\n\t\tconst na = mol.numAtoms;\n\t\tlet mx = MolUtil.arrayAtomX(mol), my = MolUtil.arrayAtomY(mol);\n\n\t\tlet groups:number[][] = [];\n\t\tlet groupX:number[] = [], groupY:number[] = [];\n\n\t\t// find all the groups\n\t\tfor (let i = 0; i < na - 1; i++) if (mask[i])\n\t\t{\n\t\t\tlet g:number[] = [i + 1];\n\t\t\tlet x = mx[i], y = my[i];\n\t\t\tfor (let j = i + 1; j < na; j++) if (mask[j])\n\t\t\t{\n\t\t\t\tif (norm2_xy(mx[j] - mx[i], my[j] - my[i]) > CoordUtil.OVERLAP_THRESHOLD_SQ) continue;\n\t\t\t\tg.push(j + 1);\n\t\t\t\tx += mx[j];\n\t\t\t\ty += my[j];\n\n\t\t\t\t// repurpose all bonds from j -> i\n\t\t\t\tlet adjb = mol.atomAdjBonds(j + 1);\n\t\t\t\tfor (let n = 0; n < adjb.length; n++)\n\t\t\t\t{\n\t\t\t\t\tif (mol.bondFrom(adjb[n]) == j + 1) mol.setBondFrom(adjb[n], i + 1);\n\t\t\t\t\telse if (mol.bondTo(adjb[n]) == j + 1) mol.setBondTo(adjb[n], i + 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (g.length == 1) continue;\n\n\t\t\tgroups.push(g);\n\t\t\tgroupX.push(x / g.length);\n\t\t\tgroupY.push(y / g.length);\n\t\t}\n\n\t\tif (groups.length == 0) return null;\n\n\t\t// now perform the surgery\n\t\tlet keepmask = Vec.booleanArray(true, na);\n\t\tfor (let n = 0; n < groups.length; n++)\n\t\t{\n\t\t\tlet g = groups[n];\n\t\t\tmol.setAtomPos(g[0], groupX[n], groupY[n]);\n\t\t\tfor (let i = 1; i < g.length; i++) keepmask[g[i] - 1] = false;\n\t\t}\n\t\tmol = MolUtil.subgraphMask(mol, keepmask);\n\t\tMolUtil.removeDuplicateBonds(mol);\n\t\treturn mol;\n\t}\n\n\t// for the group of atoms defined by the mask, moves them all out to the far edge, as defined by dx/dy (should be 0/1/-1);\n\t// returns null if the operation is invalid for any reason, e.g. the atoms are already along the specified edge\n\tpublic static moveToEdge(mol:Molecule, mask:boolean[], dx:number, dy:number):Molecule\n\t{\n\t\tlet gotS = false, gotN = false;\n\t\tlet sx1 = 0, sy1 = 0, sx2 = 0, sy2 = 0;\n\t\tlet nx1 = 0, ny1 = 0, nx2 = 0, ny2 = 0;\n\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t{\n\t\t\tlet x = mol.atomX(n), y = mol.atomY(n);\n\t\t\tif (mask[n - 1])\n\t\t\t{\n\t\t\t\tif (!gotS || x < sx1) sx1 = x;\n\t\t\t\tif (!gotS || y < sy1) sy1 = y;\n\t\t\t\tif (!gotS || x > sx2) sx2 = x;\n\t\t\t\tif (!gotS || y > sy2) sy2 = y;\n\t\t\t\tgotS = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (!gotN || x < nx1) nx1 = x;\n\t\t\t\tif (!gotN || y < ny1) ny1 = y;\n\t\t\t\tif (!gotN || x > nx2) nx2 = x;\n\t\t\t\tif (!gotN || y > ny2) ny2 = y;\n\t\t\t\tgotN = true;\n\t\t\t}\n\t\t}\n\n\t\t// check to see if it's already at the farthest extent\n\t\tconst SEPARATE = 1.0, SEPTEST = 0.9;\n\t\tif ((dx < 0 && dy == 0 && sx2 <= nx1 - SEPTEST) ||\n\t\t\t(dx > 0 && dy == 0 && sx1 >= nx2 + SEPTEST) ||\n\t\t\t(dx == 0 && dy < 0 && sy2 <= ny1 - SEPTEST) ||\n\t\t\t(dx == 0 && dy > 0 && sy1 >= ny2 + SEPTEST))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\t// apply the move\n\t\tmol = mol.clone();\n\t\tlet ox = 0, oy = 0;\n\t\tif (dx < 0) ox = nx1 - sx2 - SEPARATE;\n\t\tif (dx > 0) ox = nx2 - sx1 + SEPARATE;\n\t\tif (dy < 0) oy = ny1 - sy2 - SEPARATE;\n\t\tif (dy > 0) oy = ny2 - sy1 + SEPARATE;\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (mask[n - 1]) mol.setAtomPos(n, mol.atomX(n) + ox, mol.atomY(n) + oy);\n\n\t\treturn mol;\n\t}\n\n\t// adds some number of additional hydrogen atoms to a parent atom, and selects reasonable position coordinates for them\n\tpublic static placeAdditionalHydrogens(mol:Molecule, atom:number, numH:number):void\n\t{\n\t\tlet base = mol.numAtoms;\n\t\tconst x0 = mol.atomX(atom), y0 = mol.atomY(atom);\n\n\t\tlet adj = mol.atomAdjList(atom);\n\n\t\t// special deal: adding 2 hydrogens to a divalent atom in bent form\n\t\tif (adj.length == 2 && numH == 2)\n\t\t{\n\t\t\tconst th1 = Math.atan2(mol.atomY(adj[0]) - y0, mol.atomX(adj[0]) - x0);\n\t\t\tconst th2 = Math.atan2(mol.atomY(adj[1]) - y0, mol.atomX(adj[1]) - x0);\n\t\t\tif (Math.abs(angleDiff(th1, th2)) < 170 * DEGRAD)\n\t\t\t{\n\t\t\t\t//float theta=GeomUtil.emergentAngle(new float[]{th1,th2})+Util.PI_F;\n\t\t\t\tlet theta = 0.5 * (th1 + th2) + Math.PI;\n\t\t\t\tlet th3 = theta - 30 * DEGRAD, th4 = theta + 30 * DEGRAD;\n\t\t\t\tmol.addAtom('H', x0 + Molecule.IDEALBOND * Math.cos(th3), y0 + Molecule.IDEALBOND * Math.sin(th3));\n\t\t\t\tmol.addAtom('H', x0 + Molecule.IDEALBOND * Math.cos(th4), y0 + Molecule.IDEALBOND * Math.sin(th4));\n\t\t\t\tmol.addBond(atom, base + 1, 1);\n\t\t\t\tmol.addBond(atom, base + 2, 1);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// special deal: adding 3 hydrogens to a terminal atom\n\t\tif (adj.length == 1 && numH == 3)\n\t\t{\n\t\t\tlet th1 = Math.atan2(mol.atomY(adj[0]) - y0, mol.atomX(adj[0]) - x0);\n\t\t\tlet th2 = th1 + 90 * DEGRAD, th3 = th1 + 180 * DEGRAD, th4 = th1 + 270 * DEGRAD;\n\t\t\tmol.addAtom('H', x0 + Molecule.IDEALBOND * Math.cos(th2), y0 + Molecule.IDEALBOND * Math.sin(th2));\n\t\t\tmol.addAtom('H', x0 + Molecule.IDEALBOND * Math.cos(th3), y0 + Molecule.IDEALBOND * Math.sin(th3));\n\t\t\tmol.addAtom('H', x0 + Molecule.IDEALBOND * Math.cos(th4), y0 + Molecule.IDEALBOND * Math.sin(th4));\n\t\t\tmol.addBond(atom, base + 1, 1);\n\t\t\tmol.addBond(atom, base + 2, 1);\n\t\t\tmol.addBond(atom, base + 3, 1);\n\t\t\treturn;\n\t\t}\n\n\t\t// otherwise: add one, then recurse\n\t\tlet theta = SketchUtil.pickNewAtomDirection(mol, atom, SketchUtil.primeDirections(mol, atom));\n\t\tmol.addAtom('H', x0 + Molecule.IDEALBOND * Math.cos(theta), y0 + Molecule.IDEALBOND * Math.sin(theta));\n\t\tmol.addBond(atom, base + 1, 1);\n\t\tif (numH > 1) SketchUtil.placeAdditionalHydrogens(mol, atom, numH - 1);\n\t}\n\n\t// returns a list of outgoing angles; unlike primeDirections, which tries to narrow the list as much as possible, this function\n\t// tries to be generous and include anything remotely plausible: the intent is for helping out an interactive session where a precise\n\t// pointing device is available\n\tpublic static allViableDirections(mol:Molecule, atom:number, order:number):number[]\n\t{\n\t\tif (mol.atomAdjCount(atom) == 0)\n\t\t{\n\t\t\tlet angles:number[] = [];\n\t\t\tfor (let n = 0; n < 12; n++) angles.push(30 * DEGRAD);\n\t\t\treturn angles;\n\t\t}\n\n\t\t// all that applies\n\t\tlet adj = mol.atomAdjList(atom);\n\t\tlet angles = SketchUtil.exitVectors(mol, atom);\n\n\t\tlet geom = SketchUtil.guessAtomGeometry(mol, atom, order);\n\t\tif (adj.length == 1 && geom.indexOf(Geometry.Linear) < 0) geom.push(Geometry.Linear);\n\t\tlet bndang = CoordUtil.atomBondAngles(mol, atom, adj);\n\t\tfor (let g of geom)\n\t\t{\n\t\t\tlet map = SketchUtil.mapAngleSubstituent(g, bndang);\n\t\t\tif (map != null) for (let th of map) angles.push(th);\n\t\t}\n\n\t\treturn GeomUtil.uniqueAngles(angles, 2 * DEGRAD);\n\t}\n\n\t// simple new rings grafted onto existing components, or not\n\tpublic static proposeNewRing(mol:Molecule, rsz:number, x:number, y:number, dx:number, dy:number, snap:boolean):[number[], number[]]\n\t{\n\t\tlet theta = dy == 0 && dx == 0 ? 0.5 * Math.PI : Math.atan2(dy, dx);\n\t\tif (snap)\n\t\t{\n\t\t\tconst chunk = 30 * DEGRAD;\n\t\t\ttheta = Math.round(theta / chunk) * chunk;\n\t\t}\n\t\treturn SketchUtil.positionSimpleRing(mol, rsz, x, y, theta);\n\t}\n\tpublic static proposeAtomRing(mol:Molecule, rsz:number, atom:number, dx:number, dy:number):[number[], number[]]\n\t{\n\t\t/*\n\t\tvar thsnap:number[] = SketchUtil.allViableDirections(mol, atom, 1);\n\t\tif (mol.atomAdjCount(atom) == 1)\n\t\t{\n\t\t\tlet nbr = mol.atomAdjList(atom)[0];\n\t\t\tlet theta = Math.atan2(mol.atomY(nbr) - mol.atomY(atom), mol.atomX(nbr) - mol.atomX(atom));\n\t\t\tthsnap.push(theta);\n\t\t\tthsnap = uniqueAngles(thsnap, 2.0 * DEGRAD);\n\t\t}\n\t\t// (tempting to have it snap to sidebonds, but the correct way to do that is to drag from the bond rather than the atom)\n\t\t*/\n\n\t\tlet thsnap:number[] = [];\n\t\tlet cx = mol.atomX(atom), cy = mol.atomY(atom);\n\t\tif (mol.atomAdjCount(atom) == 0)\n\t\t{\n\t\t\tfor (let n = 0; n < 12; n++) thsnap.push(TWOPI * n / 12);\n\t\t}\n\t\telse if (mol.atomAdjCount(atom) == 1)\n\t\t{\n\t\t\tlet nbr = mol.atomAdjList(atom)[0];\n\t\t\tthsnap.push(angleNorm(Math.atan2(mol.atomY(nbr) - cy, mol.atomX(nbr) - cx) + Math.PI));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet angs:number[] = [];\n\t\t\tfor (let nbr of mol.atomAdjList(atom)) angs.push(Math.atan2(mol.atomY(nbr) - cy, mol.atomX(nbr) - cx));\n\t\t\tangs = sortAngles(angs);\n\t\t\tfor (let n = 0; n < angs.length; n++)\n\t\t\t{\n\t\t\t\tlet th1 = angs[n], th2 = angs[n < angs.length - 1 ? n + 1 : 0];\n\t\t\t\tthsnap.push(th1 + 0.5 * angleDiffPos(th2, th1));\n\t\t\t}\n\t\t}\n\n\t\tlet theta = Math.atan2(dy, dx);\n\t\tlet bestTheta = 0, bestDelta = Number.MAX_VALUE;\n\t\tfor (let th of thsnap)\n\t\t{\n\t\t\tlet delta = Math.abs(angleDiff(th, theta));\n\t\t\tif (delta < bestDelta) {bestTheta = th; bestDelta = delta;}\n\t\t}\n\n\t\treturn SketchUtil.positionSimpleRing(mol, rsz, mol.atomX(atom), mol.atomY(atom), bestTheta);\n\t}\n\tpublic static proposeBondRing(mol:Molecule, rsz:number, bond:number, dx:number, dy:number):[number[], number[]]\n\t{\n\t\tlet bfr = mol.bondFrom(bond), bto = mol.bondTo(bond);\n\t\tlet bx = mol.atomX(bto) - mol.atomX(bfr), by = mol.atomY(bto) - mol.atomY(bfr);\n\t\tlet sign = dx * by - dy * bx;\n\n\t\tlet delta = sign > 0 ? -90 * DEGRAD : 90 * DEGRAD;\n\t\tlet theta = Math.atan2(by, bx) + delta;\n\n\t\tlet dth = TWOPI / rsz;\n\t\tlet rad = Molecule.IDEALBOND / (2.0 * Math.sin(0.5 * dth)), brad = rad * Math.cos(0.5 * dth);\n\t\tlet cx = 0.5 * (mol.atomX(bfr) + mol.atomX(bto)) + brad * Math.cos(theta);\n\t\tlet cy = 0.5 * (mol.atomY(bfr) + mol.atomY(bto)) + brad * Math.sin(theta);\n\n\t\tlet rx:number[] = [], ry:number[] = [];\n\t\tfor (let n = 0; n < rsz; n++)\n\t\t{\n\t\t\tlet th = theta - Math.PI + (n - 0.5) * dth;\n\t\t\trx.push(cx + Math.cos(th) * rad);\n\t\t\try.push(cy + Math.sin(th) * rad);\n\t\t}\n\n\t\tlet [i1, i2] = sign < 0 ? [bfr, bto] : [bto, bfr];\n\t\trx[0] = mol.atomX(i1);\n\t\try[0] = mol.atomY(i1);\n\t\trx[1] = mol.atomX(i2);\n\t\try[1] = mol.atomY(i2);\n\n\t\treturn [rx, ry];\n\t}\n\n\t// simple ring attachments, to an atom/bond/point, with a guide vector to collapse the options for direction; returns arrays for X and Y\n\t// points for the ring that ought to be created from these parameters; note\n\tpublic static positionSimpleRing(mol:Molecule, rsz:number, x:number, y:number, theta:number):[number[], number[]]\n\t{\n\t\tlet dth = TWOPI / rsz;\n\t\tlet rad = Molecule.IDEALBOND / (2 * Math.sin(0.5 * dth));\n\t\tlet cx = x + rad * Math.cos(theta), cy = y + rad * Math.sin(theta);\n\n\t\tlet rx:number[] = [], ry:number[] = [];\n\t\tfor (let n = 0; n < rsz; n++)\n\t\t{\n\t\t\tlet th = theta - Math.PI + n * dth;\n\t\t\trx.push(cx + Math.cos(th) * rad);\n\t\t\try.push(cy + Math.sin(th) * rad);\n\t\t}\n\n\t\treturn [rx, ry];\n\t}\n\n\t// determines a list of \"sprouts\" for a given atom, namely exterior guides that are suitable for skething new bonds to\n\tpublic static guidelineSprouts(mol:Molecule, atom:number):GuidelineSprout[]\n\t{\n\t\tlet sprouts:GuidelineSprout[] = [];\n\n\t\t// do calculations for orders 1..3, and merge any that are duplicates (1 & 2 are typically the same, while 3 is frequently different)\n\t\tlet angs:number[][] = [], ords:number[][] = [];\n\t\tfor (let n = 0; n < 3; n++)\n\t\t{\n\t\t\tangs.push(SketchUtil.allViableDirections(mol, atom, n + 1));\n\t\t\tords.push([n + 1]);\n\t\t\tfor (let i = 0; i < n; i++) if (angs[i] != null && Vec.equals(angs[n], angs[i]))\n\t\t\t{\n\t\t\t\tangs[n] = null;\n\t\t\t\tords[i].push(n + 1);\n\t\t\t}\n\t\t}\n\n\t\t// add sprouts, using Cartesian coordinates\n\t\tconst cx = mol.atomX(atom), cy = mol.atomY(atom);\n\t\tfor (let n = 0; n < 3; n++) if (angs[n] != null)\n\t\t{\n\t\t\tlet sprout:GuidelineSprout =\n\t\t\t{\n\t\t\t\tatom: atom,\n\t\t\t\torders: ords[n],\n\t\t\t\tx: [],\n\t\t\t\ty: [],\n\t\t\t};\n\t\t\tfor (let i = 0; i < angs[n].length; i++)\n\t\t\t{\n\t\t\t\tsprout.x[i] = cx + Math.cos(angs[n][i]) * Molecule.IDEALBOND;\n\t\t\t\tsprout.y[i] = cy + Math.sin(angs[n][i]) * Molecule.IDEALBOND;\n\t\t\t}\n\t\t\tsprouts.push(sprout);\n\t\t}\n\t\treturn sprouts;\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2019 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Vec} from '../util/Vec';\nimport {Molecule} from './Molecule';\n\n/*\n\tHandles some of the custom extensions that are brought in for molecules when imported from other\n\tsources, such as MDL Molfiles, which support a number of features that are not part of the core\n\trepresentation of a molecule.\n\n\tThese additional properties are included in the transient extension collection for atoms and\n\tbonds, i.e. they get cleared out as soon as the structure is modified in any way, because their\n\teffects are not localised to a single atom/bond.\n\n\tA molecule that contains foreign annotations is expected to either import them to a more well\n\tspecified definition, or to have a brief lifetime and only need to survive a round trip, rather than\n\tbeing used or modified.\n*/\n\nexport enum ForeignMoleculeTransient\n{\n\t// generic flags for remarking that an atom/bond is aromatic; commonly used by SMILES, for MDL Molfile queries (and illegal structures)\n\t// and a number of other formats which use this concept\n\tAtomAromatic = 'yAROMATIC',\n\tBondAromatic = 'yAROMATIC',\n\n\t// specialisations of zero-order bonds: the MDL world supports \"dative\" and \"hydrogen\" which are both 0-order but have particular meaning\n\tBondZeroDative = 'yZERO_DATIVE',\n\tBondZeroHydrogen = 'yZERO_HYDROGEN',\n\n\t// the atom-centred chirality settings, used explicitly by MDL Molfiles to denote chirality, or mixtures\n\tAtomChiralMDLOdd = 'yCHIRAL_MDL_ODD',\n\tAtomChiralMDLEven= 'yCHIRAL_MDL_EVEN',\n\tAtomChiralMDLRacemic = 'yCHIRAL_MDL_RACEMIC',\n\n\t// annotations that carry over from supplementary MDL parsing\n\tAtomExplicitValence = 'yMDL_EXPLICIT_VALENCE',\n\tAtomSgroupMultiAttach = 'yMDL_SGROUP_MULTIATTACH',\n\tAtomSgroupMultiRepeat = 'yMDL_SGROUP_MULTIREPEAT',\n\tAtomSgroupData = 'yMDL_SGROUP_DATA',\n\n\t// references to SCSR templates\n\tAtomSCSRClass = 'yMDL_SCSR_CLASS',\n\tAtomSCSRSeqID = 'yMDL_SCSR_SEQID',\n\tAtomSCSRAttchOrd = 'yMDL_SCSR_ATTCHORD',\n}\n\nexport interface ForeignMoleculeSgroupMultiAttach\n{\n\tname:string;\n\tatoms:number[];\n\tkeyval:Record<string, string>;\n}\n\nexport interface ForeignMoleculeSgroupMultiRepeat\n{\n\tmult:number;\n\tunit:number;\n\tatoms:number[];\n}\n\nexport interface ForeignMoleculeSgroupData\n{\n\tname:string;\n\tvalue:string;\n\tunit:string;\n\tquery:string;\n\tatoms:number[];\n}\n\nexport interface ForeignMoleculeTemplateDefn\n{\n\tname:string;\n\tnatReplace:string;\n\tmol:Molecule;\n}\n\nexport class ForeignMolecule\n{\n\t// ----------------- public methods -----------------\n\n\t// returns a mask for any atoms that have been explicitly marked as aromatic; note that this does not look at the\n\t// marking of aromatic bonds, which is separate\n\tpublic static noteAromaticAtoms(mol:Molecule):boolean[]\n\t{\n\t\tconst sz = mol.numAtoms;\n\t\tlet mask = Vec.booleanArray(false, sz);\n\t\tfor (let n = 1; n <= sz; n++) mask[n - 1] = mol.atomTransient(n).indexOf(ForeignMoleculeTransient.AtomAromatic) >= 0;\n\t\treturn mask;\n\t}\n\n\t// returns a mask for any bonds that have been explicitly marked as aromatic\n\tpublic static noteAromaticBonds(mol:Molecule):boolean[]\n\t{\n\t\tconst sz = mol.numBonds;\n\t\tlet mask = Vec.booleanArray(false, sz);\n\t\tfor (let n = 1; n <= sz; n++) mask[n - 1] = mol.bondTransient(n).indexOf(ForeignMoleculeTransient.BondAromatic) >= 0;\n\t\treturn mask;\n\t}\n\n\t// returns a mask for zero-order bonds that are marked as dative/hydrogen respectively\n\tpublic static noteZeroDativeBonds(mol:Molecule):boolean[]\n\t{\n\t\tconst sz = mol.numBonds;\n\t\tlet mask = Vec.booleanArray(false, sz);\n\t\tfor (let n = 1; n <= sz; n++) mask[n - 1] = mol.bondTransient(n).includes(ForeignMoleculeTransient.BondZeroDative);\n\t\treturn mask;\n\t}\n\tpublic static noteZeroHydrogenBonds(mol:Molecule):boolean[]\n\t{\n\t\tconst sz = mol.numBonds;\n\t\tlet mask = Vec.booleanArray(false, sz);\n\t\tfor (let n = 1; n <= sz; n++) mask[n - 1] = mol.bondTransient(n).includes(ForeignMoleculeTransient.BondZeroHydrogen);\n\t\treturn mask;\n\t}\n\n\t// TODO: convert MDL chirality to/from rubric\n\n\t// explicit valence: 0=no information; -1=zero; >0=explicit\n\tpublic static markExplicitValence(mol:Molecule, atom:number, valence:number):void\n\t{\n\t\tlet trans = mol.atomTransient(atom).filter((tr) => !tr.startsWith(ForeignMoleculeTransient.AtomExplicitValence + ':'));\n\t\ttrans.push(`${ForeignMoleculeTransient.AtomExplicitValence}:${valence}`);\n\t\tmol.setAtomTransient(atom, trans);\n\t}\n\tpublic static noteExplicitValence(mol:Molecule, atom:number):number\n\t{\n\t\tlet trans = mol.atomTransient(atom);\n\t\tfor (let tr of trans) if (tr.startsWith(ForeignMoleculeTransient.AtomExplicitValence + ':')) return parseInt(tr.substring(ForeignMoleculeTransient.AtomExplicitValence.length + 1));\n\t\treturn null;\n\t}\n\n\t// S-groups with either no attachments or multiple attachments; only single-attachment S-groups are handled naturally\n\tpublic static markSgroupMultiAttach(mol:Molecule, name:string, atoms:number[], keyval:Record<string, string> = {}):void\n\t{\n\t\tlet idxHigh = 0;\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) for (let tag of mol.atomTransient(n)) if (tag.startsWith(ForeignMoleculeTransient.AtomSgroupMultiAttach + ':'))\n\t\t{\n\t\t\tlet payload = tag.substring(ForeignMoleculeTransient.AtomSgroupMultiAttach.length + 1);\n\t\t\tlet comma = payload.indexOf(',');\n\t\t\tlet bits = payload.split(',');\n\t\t\tlet idx = parseInt(bits[0]);\n\t\t\tif (!(idx > 0)) continue;\n\t\t\tidxHigh = Math.max(idxHigh, idx);\n\t\t}\n\n\t\tlet tag = `${ForeignMoleculeTransient.AtomSgroupMultiAttach}:${idxHigh + 1},${name}`;\n\t\tfor (let [key, val] of Object.entries(keyval)) tag += ',' + key + '=' + val;\n\t\tfor (let a of atoms) mol.setAtomTransient(a, Vec.append(mol.atomTransient(a), tag));\n\t}\n\tpublic static hasAnySgroupMultiAttach(mol:Molecule):boolean\n\t{\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t\tif (mol.atomTransient(n).some((tag) => tag.startsWith(ForeignMoleculeTransient.AtomSgroupMultiAttach + ':'))) return true;\n\t\treturn false;\n\t}\n\tpublic static noteAllSgroupMultiAttach(mol:Molecule):ForeignMoleculeSgroupMultiAttach[]\n\t{\n\t\tlet map:Record<number, ForeignMoleculeSgroupMultiAttach> = {};\n\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) for (let tag of mol.atomTransient(n)) if (tag.startsWith(ForeignMoleculeTransient.AtomSgroupMultiAttach + ':'))\n\t\t{\n\t\t\tlet payload = tag.substring(ForeignMoleculeTransient.AtomSgroupMultiAttach.length + 1);\n\t\t\tlet bits = payload.split(',');\n\t\t\tif (bits.length < 2) continue;\n\t\t\tlet idx = parseInt(bits[0]), name = bits[1];\n\t\t\tif (!(idx > 0) || !name) continue;\n\n\t\t\tlet keyval:Record<string, string> = {};\n\t\t\tfor (let i = 2; i < bits.length; i++)\n\t\t\t{\n\t\t\t\tlet eq = bits[i].indexOf('=');\n\t\t\t\tif (eq < 0) continue;\n\t\t\t\tkeyval[bits[i].substring(0, eq)] = bits[i].substring(eq + 1);\n\t\t\t}\n\n\t\t\tlet sgm = map[idx];\n\t\t\tif (sgm) sgm.atoms.push(n); else map[idx] = {name, atoms: [n], keyval};\n\t\t}\n\n\t\treturn Object.values(map);\n\t}\n\n\t// S-groups that mark repeating units, where the \"parent\" set is rendered with a bracket+suffix \"[]n\"; the molecule is fully expanded out, so that the\n\t// graph connectivity is that of the real molecule, with the non-parent atoms being hidden & finagled for rendering purposes\n\tpublic static markSgroupMultiRepeat(mol:Molecule, mult:number, atoms:number[]):void\n\t{\n\t\tlet idxHigh = 0;\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) for (let tag of mol.atomTransient(n)) if (tag.startsWith(ForeignMoleculeTransient.AtomSgroupMultiRepeat + ':'))\n\t\t{\n\t\t\tlet payload = tag.substring(ForeignMoleculeTransient.AtomSgroupMultiRepeat.length + 1);\n\t\t\tlet comma = payload.indexOf(',');\n\t\t\tif (comma <= 0) continue;\n\t\t\tlet idx = parseInt(payload.substring(0, comma));\n\t\t\tif (idx <= 0) continue;\n\t\t\tidxHigh = Math.max(idxHigh, idx);\n\t\t}\n\n\t\tlet unit = atoms.length / mult;\n\t\tlet tag = `${ForeignMoleculeTransient.AtomSgroupMultiRepeat}:${idxHigh + 1},${mult},${unit},`;\n\t\tfor (let n = 0; n < atoms.length; n++) mol.setAtomTransient(atoms[n], Vec.append(mol.atomTransient(atoms[n]), tag + (n + 1)));\n\t}\n\tpublic static hasAnySgroupMultiRepeat(mol:Molecule):boolean\n\t{\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t\tif (mol.atomTransient(n).some((tag) => tag.startsWith(ForeignMoleculeTransient.AtomSgroupMultiRepeat + ':'))) return true;\n\t\treturn false;\n\t}\n\tpublic static noteAllSgroupMultiRepeat(mol:Molecule):ForeignMoleculeSgroupMultiRepeat[]\n\t{\n\t\tlet map:Record<number, ForeignMoleculeSgroupMultiRepeat> = {};\n\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) for (let tag of mol.atomTransient(n)) if (tag.startsWith(ForeignMoleculeTransient.AtomSgroupMultiRepeat + ':'))\n\t\t{\n\t\t\tlet payload = tag.substring(ForeignMoleculeTransient.AtomSgroupMultiRepeat.length + 1);\n\t\t\tlet bits = payload.split(',');\n\t\t\tif (bits.length < 4) continue;\n\t\t\tlet idx = parseInt(bits[0]), mult = parseInt(bits[1]), unit = parseInt(bits[2]), pos = parseInt(bits[3]);\n\t\t\tif (!(idx > 0) || mult < 2 || unit < 1 || pos < 1 || pos > mult * unit) continue;\n\n\t\t\tlet mr = map[idx];\n\t\t\tif (mr == null) map[idx] = mr = {mult, unit, atoms: Vec.numberArray(0, mult * unit)};\n\t\t\telse if (mr.mult != mult || mr.unit != unit) continue;\n\n\t\t\tmr.atoms[pos - 1] = n;\n\t\t}\n\n\t\treturn Object.values(map);\n\t}\n\n\t// data S-groups can attach arbitrary data concepts to a group of atoms\n\tpublic static markSgroupData(mol:Molecule, name:string, value:string, unit:string, query:string, atoms:number[]):void\n\t{\n\t\tlet idxHigh = 0;\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) for (let tag of mol.atomTransient(n)) if (tag.startsWith(ForeignMoleculeTransient.AtomSgroupData + ':'))\n\t\t{\n\t\t\tlet payload = tag.substring(ForeignMoleculeTransient.AtomSgroupData.length + 1);\n\t\t\tlet comma = payload.indexOf(',');\n\t\t\tif (comma <= 0) continue;\n\t\t\tlet idx = parseInt(payload.substring(0, comma));\n\t\t\tif (idx <= 0) continue;\n\t\t\tidxHigh = Math.max(idxHigh, idx);\n\t\t}\n\n\t\tlet bits = [(idxHigh + 1).toString(), name, value, unit, query];\n\t\tfor (let n = 1; n < bits.length; n++) bits[n] = (bits[n] ?? '').replace(/\\,/g, '@@');\n\t\tlet tag = ForeignMoleculeTransient.AtomSgroupData + ':' + bits.join(',');\n\t\tfor (let n = 0; n < atoms.length; n++) mol.setAtomTransient(atoms[n], Vec.append(mol.atomTransient(atoms[n]), tag));\n\t}\n\tpublic static hasAnySgroupData(mol:Molecule):boolean\n\t{\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t\tif (mol.atomTransient(n).some((tag) => tag.startsWith(ForeignMoleculeTransient.AtomSgroupData + ':'))) return true;\n\t\treturn false;\n\t}\n\tpublic static noteAllSgroupData(mol:Molecule):ForeignMoleculeSgroupData[]\n\t{\n\t\tlet map:Record<number, ForeignMoleculeSgroupData> = {};\n\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) for (let tag of mol.atomTransient(n)) if (tag.startsWith(ForeignMoleculeTransient.AtomSgroupData + ':'))\n\t\t{\n\t\t\tlet payload = tag.substring(ForeignMoleculeTransient.AtomSgroupData.length + 1);\n\t\t\tlet bits = payload.split(',');\n\t\t\tif (bits.length < 5) continue;\n\t\t\tlet idx = parseInt(bits[0]);\n\t\t\tfor (let i = 1; i < 5; i++) bits[i] = bits[i].replace(/\\@\\@/g, ',');\n\t\t\tif (!(idx > 0)) continue;\n\n\t\t\tlet sd = map[idx];\n\t\t\tif (sd)\n\t\t\t\tsd.atoms.push(n);\n\t\t\telse\n\t\t\t\tmap[idx] = {name: bits[1], value: bits[2], unit: bits[3], query: bits[4], atoms: [n]};\n\t\t}\n\n\t\treturn Object.values(map);\n\t}\n\n\t// ----------------- private methods -----------------\n\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2022 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Vec} from '../util/Vec';\nimport {Molecule} from './Molecule';\nimport {MolUtil} from './MolUtil';\n\n/*\n\tUtilities for getting & setting query features, for atoms and bonds. These are all stored within the reserved \"q\"\n\textension prefix.\n*/\n\nexport enum QueryTypeAtom\n{\n\tCharges = 'qC:',\t\t// allowed charges\n\tAromatic = 'qA:',\t\t// yes/no; must/not have an aromatic bond\n\tUnsaturated = 'qU:',\t// qU: yes/no; must/must not have a multiple bond (2 or higher)\n\tElements = 'qE:',\t\t// allowed elements (in addition to atom's label, if not '*')\n\tElementsNot = 'qE!',\t// disallowed elements (only relevant if label is '*')\n\tRingSizes = 'qR:',\t\t// list of small ring sizes that the atom must participate in\n\tRingSizesNot = 'qR!',\t// list of small ring sizes that the atom must not participate in\n\tRingBlock = 'qB:',\t\t// yes/no; whether the atom must be in a ring block\n\tNumRings = 'qN:',\t\t// list of allowed numbers of small rings (3..7) the atom may occur in\n\tRingBonds = 'qG:',\t\t// qG: list of allowed # of bonds that are in a ring\n\tAdjacency = 'qJ:',\t\t// list of allowed adjacency counts\n\tBondSums = 'qO:',\t\t// list of allowed sums of adjacent bond orders\n\tValences = 'qV:',\t\t// list of allowed valences (sum:BO - chg + unp + hyd)\n\tHydrogens = 'qH:',\t\t// list of allowed hydrogen counts (virtual and actual)\n\tIsotopes = 'qI:',\t\t// list of allowed isotopes\n\tSubFrags = 'qX:',\t\t// list of allowed sub-fragments (inline encoding, like abbreviations)\n\tSubFragsNot = 'qX!',\t// list of disallowed sub-fragments\n}\n\nexport enum QueryTypeBond\n{\n\tRingSizes = 'qR:',\t\t// list of small ring sizes that the bond must participate in\n\tRingSizesNot = 'qR!',\t// list of small ring sizes that the bond must not participate in\n\tRingBlock = 'qB:',\t\t// yes/no; whether the atom must be in a ring block\n\tNumRings = 'qN:',\t\t// list of allowed numbers of small rings (3..7) the bond may occur in\n\tOrders = 'qO:',\t\t\t// list of allowed bond orders; allowed: (0,1,2,3,4,-1) (-1==aromatic)\n}\n\nexport class QueryUtil\n{\n\t// ------------------ public methods --------------------\n\n\t// determine whether there's any kind of query info associated with the atom or bond\n\tpublic static hasAnyQueryAtom(mol:Molecule, atom:number):boolean\n\t{\n\t\tlet extra = mol.atomExtra(atom);\n\t\tfor (let n = extra.length - 1; n >= 0; n--) if (extra[n].startsWith('q')) return true;\n\t\treturn false;\n\t}\n\tpublic static hasAnyQueryBond(mol:Molecule, bond:number):boolean\n\t{\n\t\tlet extra = mol.bondExtra(bond);\n\t\tfor (let n = extra.length - 1; n >= 0; n--) if (extra[n].startsWith('q')) return true;\n\t\treturn false;\n\t}\n\n\t// return whether a specific kind of query is present\n\tpublic static hasQueryAtom(mol:Molecule, atom:number, type:QueryTypeAtom):boolean\n\t{\n\t\tlet extra = mol.atomExtra(atom);\n\t\tfor (let n = extra.length - 1; n >= 0; n--) if (extra[n].startsWith(type)) return true;\n\t\treturn false;\n\t}\n\n\tpublic static hasQueryBond(mol:Molecule, bond:number, type:QueryTypeBond):boolean\n\t{\n\t\tlet extra = mol.bondExtra(bond);\n\t\tfor (let n = extra.length - 1; n >= 0; n--) if (extra[n].startsWith(type)) return true;\n\t\treturn false;\n\t}\n\n\t// removes any instances of a specific kind of query\n\tpublic static deleteQueryAtom(mol:Molecule, atom:number, type:QueryTypeAtom):void\n\t{\n\t\tlet extra = mol.atomExtra(atom);\n\t\tlet modified = false;\n\t\tfor (let n = extra.length - 1; n >= 0; n--) if (extra[n].startsWith(type))\n\t\t{\n\t\t\textra.splice(n, 1);\n\t\t\tmodified = true;\n\t\t}\n\t\tif (modified) mol.setAtomExtra(atom, extra);\n\t}\n\tpublic static deleteQueryBond(mol:Molecule, bond:number, type:QueryTypeBond):void\n\t{\n\t\tlet extra = mol.bondExtra(bond);\n\t\tlet modified = false;\n\t\tfor (let n = extra.length - 1; n >= 0; n--) if (extra[n].startsWith(type))\n\t\t{\n\t\t\textra.splice(n, 1);\n\t\t\tmodified = true;\n\t\t}\n\t\tif (modified) mol.setBondExtra(bond, extra);\n\t}\n\n\t// remove all query features from atom/bond\n\tpublic static deleteQueryAtomAll(mol:Molecule, atom:number)\n\t{\n\t\tmol.setAtomExtra(atom, mol.atomExtra(atom).filter((xtra) => !xtra.startsWith('q')));\n\t}\n\tpublic static deleteQueryBondAll(mol:Molecule, bond:number)\n\t{\n\t\tmol.setBondExtra(bond, mol.bondExtra(bond).filter((xtra) => !xtra.startsWith('q')));\n\t}\n\n\t// fetch the payload content for a particular type, or null if not found\n\tpublic static queryAtomString(mol:Molecule, atom:number, type:QueryTypeAtom):string\n\t{\n\t\tlet extra = mol.atomExtra(atom);\n\t\tfor (let n = extra.length - 1; n >= 0; n--) if (extra[n].startsWith(type)) return extra[n].substring(type.length);\n\t\treturn null;\n\t}\n\tpublic static queryAtomStringList(mol:Molecule, atom:number, type:QueryTypeAtom):string[]\n\t{\n\t\tlet extra = mol.atomExtra(atom), list = null;\n\t\tif (extra != null) for (let str of extra) if (str.startsWith(type)) list = Vec.append(list, str.substring(type.length));\n\t\treturn list;\n\t}\n\tpublic static queryBondString(mol:Molecule, bond:number, type:QueryTypeBond):string\n\t{\n\t\tlet extra = mol.bondExtra(bond);\n\t\tfor (let n = extra.length - 1; n >= 0; n--) if (extra[n].startsWith(type)) return extra[n].substring(type.length);\n\t\treturn null;\n\t}\n\n\t// set the query payload for a particular type; null or empty string will cause it to be deleted instead\n\tpublic static setQueryAtom(mol:Molecule, atom:number, type:QueryTypeAtom, str:string):void\n\t{\n\t\tif (!str)\n\t\t{\n\t\t\tthis.deleteQueryAtom(mol, atom, type);\n\t\t\treturn;\n\t\t}\n\t\tlet value = type + str;\n\t\tlet extra = mol.atomExtra(atom);\n\t\tfor (let n = extra.length - 1; n >= 0; n--)\n\t\t{\n\t\t\tif (extra[n].startsWith(type))\n\t\t\t{\n\t\t\t\tif (value != null)\n\t\t\t\t{\n\t\t\t\t\textra[n] = value;\n\t\t\t\t\tvalue = null;\n\t\t\t\t}\n\t\t\t\telse extra.splice(n, 1);\n\t\t\t}\n\t\t}\n\t\tif (value != null) extra.push(value);\n\t\tmol.setAtomExtra(atom, extra);\n\t}\n\tpublic static setQueryAtomList(mol:Molecule, atom:number, type:QueryTypeAtom, list:string[]):void\n\t{\n\t\tif (Vec.isBlank(list))\n\t\t{\n\t\t\tthis.deleteQueryAtom(mol, atom, type);\n\t\t\treturn;\n\t\t}\n\t\tlet extra = mol.atomExtra(atom);\n\t\tfor (let n = extra.length - 1; n >= 0; n--) if (extra[n].startsWith(type)) extra.splice(n, 1);\n\t\tfor (let str of list) extra.push(type + str);\n\t\tmol.setAtomExtra(atom, extra);\n\t}\n\tpublic static setQueryBond(mol:Molecule, bond:number, type:QueryTypeBond, str:string):void\n\t{\n\t\tif (!str)\n\t\t{\n\t\t\tthis.deleteQueryBond(mol, bond, type);\n\t\t\treturn;\n\t\t}\n\t\tlet value = type + str;\n\t\tlet extra = mol.bondExtra(bond);\n\t\tfor (let n = extra.length - 1; n >= 0; n--)\n\t\t{\n\t\t\tif (extra[n].startsWith(type))\n\t\t\t{\n\t\t\t\tif (value != null)\n\t\t\t\t{\n\t\t\t\t\textra[n] = value;\n\t\t\t\t\tvalue = null;\n\t\t\t\t}\n\t\t\t\telse extra.splice(n, 1);\n\t\t\t}\n\t\t}\n\t\tif (value != null) extra.push(value);\n\t\tmol.setBondExtra(bond, extra);\n\t}\n\n\t// fetching of specific query types from atoms, parsed out into the right datastructure\n\tpublic static queryAtomCharges(mol:Molecule, atom:number):number[]\n\t\t{return this.parseIntegers(this.queryAtomString(mol, atom, QueryTypeAtom.Charges));}\n\tpublic static queryAtomAromatic(mol:Molecule, atom:number):boolean\n\t\t{return this.parseBoolean(this.queryAtomString(mol, atom, QueryTypeAtom.Aromatic));}\n\tpublic static queryAtomUnsaturated(mol:Molecule, atom:number):boolean\n\t\t{return this.parseBoolean(this.queryAtomString(mol, atom, QueryTypeAtom.Unsaturated));}\n\tpublic static queryAtomElements(mol:Molecule, atom:number):string[]\n\t\t{return this.parseStrings(this.queryAtomString(mol, atom, QueryTypeAtom.Elements));}\n\tpublic static queryAtomElementsNot(mol:Molecule, atom:number):string[]\n\t\t{return this.parseStrings(this.queryAtomString(mol, atom, QueryTypeAtom.ElementsNot));}\n\tpublic static queryAtomRingSizes(mol:Molecule, atom:number):number[]\n\t\t{return this.parseIntegers(this.queryAtomString(mol, atom, QueryTypeAtom.RingSizes));}\n\tpublic static queryAtomRingSizesNot(mol:Molecule, atom:number):number[]\n\t\t{return this.parseIntegers(this.queryAtomString(mol, atom, QueryTypeAtom.RingSizesNot));}\n\tpublic static queryAtomRingBlock(mol:Molecule, atom:number):boolean\n\t\t{return this.parseBoolean(this.queryAtomString(mol, atom, QueryTypeAtom.RingBlock));}\n\tpublic static queryAtomNumRings(mol:Molecule, atom:number):number[]\n\t\t{return this.parseIntegers(this.queryAtomString(mol, atom, QueryTypeAtom.NumRings));}\n\tpublic static queryAtomRingBonds(mol:Molecule, atom:number):number[]\n\t\t{return this.parseIntegers(this.queryAtomString(mol, atom, QueryTypeAtom.RingBonds));}\n\tpublic static queryAtomAdjacency(mol:Molecule, atom:number):number[]\n\t\t{return this.parseIntegers(this.queryAtomString(mol, atom, QueryTypeAtom.Adjacency));}\n\tpublic static queryAtomBondSums(mol:Molecule, atom:number):number[]\n\t\t{return this.parseIntegers(this.queryAtomString(mol, atom, QueryTypeAtom.BondSums));}\n\tpublic static queryAtomValences(mol:Molecule, atom:number):number[]\n\t\t{return this.parseIntegers(this.queryAtomString(mol, atom, QueryTypeAtom.Valences));}\n\tpublic static queryAtomHydrogens(mol:Molecule, atom:number):number[]\n\t\t{return this.parseIntegers(this.queryAtomString(mol, atom, QueryTypeAtom.Hydrogens));}\n\tpublic static queryAtomIsotope(mol:Molecule, atom:number):number[]\n\t\t{return this.parseIntegers(this.queryAtomString(mol, atom, QueryTypeAtom.Isotopes));}\n\tpublic static queryAtomSubFrags(mol:Molecule, atom:number):Molecule[]\n\t\t{return this.parseMolecules(this.queryAtomStringList(mol, atom, QueryTypeAtom.SubFrags));}\n\tpublic static queryAtomSubFragsNot(mol:Molecule, atom:number):Molecule[]\n\t\t{return this.parseMolecules(this.queryAtomStringList(mol, atom, QueryTypeAtom.SubFragsNot));}\n\n\t// fetching of specific query types from bonds, parsed out into the right datastructure\n\tpublic static queryBondRingSizes(mol:Molecule, bond:number):number[]\n\t\t{return this.parseIntegers(this.queryBondString(mol, bond, QueryTypeBond.RingSizes));}\n\tpublic static queryBondRingSizesNot(mol:Molecule, bond:number):number[]\n\t\t{return this.parseIntegers(this.queryBondString(mol, bond, QueryTypeBond.RingSizesNot));}\n\tpublic static queryBondRingBlock(mol:Molecule, bond:number):boolean\n\t\t{return this.parseBoolean(this.queryBondString(mol, bond, QueryTypeBond.RingBlock));}\n\tpublic static queryBondNumRings(mol:Molecule, bond:number):number[]\n\t\t{return this.parseIntegers(this.queryBondString(mol, bond, QueryTypeBond.NumRings));}\n\tpublic static queryBondOrders(mol:Molecule, bond:number):number[]\n\t\t{return this.parseIntegers(this.queryBondString(mol, bond, QueryTypeBond.Orders));}\n\n\t// setting of specific query types for atoms\n\tpublic static setQueryAtomCharges(mol:Molecule, atom:number, value:number[]):void\n\t\t{this.setQueryAtom(mol, atom, QueryTypeAtom.Charges, this.formatIntegers(value));}\n\tpublic static setQueryAtomAromatic(mol:Molecule, atom:number, value:boolean):void\n\t\t{this.setQueryAtom(mol, atom, QueryTypeAtom.Aromatic, this.formatBoolean(value));}\n\tpublic static setQueryAtomUnsaturated(mol:Molecule, atom:number, value:boolean):void\n\t\t{this.setQueryAtom(mol, atom, QueryTypeAtom.Unsaturated, this.formatBoolean(value));}\n\tpublic static setQueryAtomElements(mol:Molecule, atom:number, value:string[]):void\n\t\t{this.setQueryAtom(mol, atom, QueryTypeAtom.Elements, this.formatStrings(value));}\n\tpublic static setQueryAtomElementsNot(mol:Molecule, atom:number, value:string[]):void\n\t\t{this.setQueryAtom(mol, atom, QueryTypeAtom.ElementsNot, this.formatStrings(value));}\n\tpublic static setQueryAtomRingSizes(mol:Molecule, atom:number, value:number[]):void\n\t\t{this.setQueryAtom(mol, atom, QueryTypeAtom.RingSizes, this.formatIntegers(value));}\n\tpublic static setQueryAtomRingSizesNot(mol:Molecule, atom:number, value:number[]):void\n\t\t{this.setQueryAtom(mol, atom, QueryTypeAtom.RingSizesNot, this.formatIntegers(value));}\n\tpublic static setQueryAtomRingBlock(mol:Molecule, atom:number, value:boolean):void\n\t\t{this.setQueryAtom(mol, atom, QueryTypeAtom.RingBlock, this.formatBoolean(value));}\n\tpublic static setQueryAtomNumRings(mol:Molecule, atom:number, value:number[]):void\n\t\t{this.setQueryAtom(mol, atom, QueryTypeAtom.NumRings, this.formatIntegers(value));}\n\tpublic static setQueryAtomRingBonds(mol:Molecule, atom:number, value:number[]):void\n\t\t{this.setQueryAtom(mol, atom, QueryTypeAtom.RingBonds, this.formatIntegers(value));}\n\tpublic static setQueryAtomAdjacency(mol:Molecule, atom:number, value:number[]):void\n\t\t{this.setQueryAtom(mol, atom, QueryTypeAtom.Adjacency, this.formatIntegers(value));}\n\tpublic static setQueryAtomBondSums(mol:Molecule, atom:number, value:number[]):void\n\t\t{this.setQueryAtom(mol, atom, QueryTypeAtom.BondSums, this.formatIntegers(value));}\n\tpublic static setQueryAtomValences(mol:Molecule, atom:number, value:number[]):void\n\t\t{this.setQueryAtom(mol, atom, QueryTypeAtom.Valences, this.formatIntegers(value));}\n\tpublic static setQueryAtomHydrogens(mol:Molecule, atom:number, value:number[]):void\n\t\t{this.setQueryAtom(mol, atom, QueryTypeAtom.Hydrogens, this.formatIntegers(value));}\n\tpublic static setQueryAtomIsotope(mol:Molecule, atom:number, value:number[]):void\n\t\t{this.setQueryAtom(mol, atom, QueryTypeAtom.Isotopes, this.formatIntegers(value));}\n\tpublic static setQueryAtomSubFrags(mol:Molecule, atom:number, value:Molecule[]):void\n\t\t{this.setQueryAtomList(mol, atom, QueryTypeAtom.SubFrags, this.formatMolecules(value));}\n\tpublic static setQueryAtomSubFragsNot(mol:Molecule, atom:number, value:Molecule[]):void\n\t\t{this.setQueryAtomList(mol, atom, QueryTypeAtom.SubFragsNot, this.formatMolecules(value));}\n\n\t// setting of specific query types for bonds\n\tpublic static setQueryBondRingSizes(mol:Molecule, bond:number, value:number[]):void\n\t\t{this.setQueryBond(mol, bond, QueryTypeBond.RingSizes, this.formatIntegers(value));}\n\tpublic static setQueryBondRingSizesNot(mol:Molecule, bond:number, value:number[]):void\n\t\t{this.setQueryBond(mol, bond, QueryTypeBond.RingSizesNot, this.formatIntegers(value));}\n\tpublic static setQueryBondRingBlock(mol:Molecule, bond:number, value:boolean):void\n\t\t{this.setQueryBond(mol, bond, QueryTypeBond.RingBlock, this.formatBoolean(value));}\n\tpublic static setQueryBondNumRings(mol:Molecule, bond:number, value:number[]):void\n\t\t{this.setQueryBond(mol, bond, QueryTypeBond.NumRings, this.formatIntegers(value));}\n\tpublic static setQueryBondOrders(mol:Molecule, bond:number, value:number[]):void\n\t\t{this.setQueryBond(mol, bond, QueryTypeBond.Orders, this.formatIntegers(value));}\n\n\t// ------------------ private methods --------------------\n\n\t// conversion of molecule-encoded strings into appropriate datatypes\n\tprivate static parseIntegers(str:string):number[]\n\t{\n\t\tif (!str) return null;\n\t\tlet strlist = str.split(',');\n\t\tlet intlist:number[] = new Array(strlist.length);\n\t\tfor (let n = 0; n < strlist.length; n++) intlist[n] = parseInt(strlist[n]);\n\t\treturn intlist;\n\t}\n\tprivate static parseStrings(str:string):string[]\n\t{\n\t\tif (!str) return null;\n\t\treturn str.split(',');\n\t}\n\tprivate static parseBoolean(str:string):boolean\n\t{\n\t\treturn !str ? null : str == 'yes';\n\t}\n\tpublic static parseMolecules(list:string[]):Molecule[]\n\t{\n\t\tif (!list) return null;\n\t\tlet mols:Molecule[] = [];\n\t\tfor (let molstr of list)\n\t\t{\n\t\t\tlet mol = Molecule.fromString(molstr);\n\t\t\tif (MolUtil.notBlank(mol)) mols.push(mol);\n\t\t}\n\t\treturn mols;\n\t}\n\n\t// conversion of appropriate datatypes into molecule-encoded strings\n\tprivate static formatIntegers(list:number[]):string\n\t{\n\t\tif (Vec.isBlank(list)) return null;\n\t\tlet str = '';\n\t\tfor (let n = 0; n < list.length; n++)\n\t\t{\n\t\t\tif (n > 0) str += ',';\n\t\t\tstr += list[n];\n\t\t}\n\t\treturn str;\n\t}\n\tprivate static formatStrings(list:string[]):string\n\t{\n\t\tif (Vec.isBlank(list)) return null;\n\t\tlet str = '';\n\t\tfor (let n = 0; n < list.length; n++)\n\t\t{\n\t\t\tif (n > 0) str += ',';\n\t\t\tstr += list[n];\n\t\t}\n\t\treturn str;\n\t}\n\tprivate static formatBoolean(value:boolean):string\n\t{\n\t\treturn value ? 'yes' : 'no';\n\t}\n\tprivate static formatMolecules(mols:Molecule[]):string[]\n\t{\n\t\tif (Vec.isBlank(mols)) return null;\n\t\tlet list:string[] = [];\n\t\tfor (let mol of mols) if (MolUtil.notBlank(mol)) list.push(mol.toString());\n\t\treturn list;\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Vec} from '../util/Vec';\nimport {Chemistry} from './Chemistry';\nimport {CoordUtil} from './CoordUtil';\nimport {Graph} from './Graph';\nimport {Molecule} from './Molecule';\nimport {PolymerBlock} from './PolymerBlock';\nimport {SketchUtil} from './SketchUtil';\n\n/*\n\tMolUtil: static methods for calculating molecule properties.\n*/\n\nexport class MolUtil\n{\n\tpublic static isBlank(mol:Molecule):boolean\n\t{\n\t\t//return mol == null || mol.numAtoms == 0;\n\t\tif (mol == null) return true;\n\t\treturn mol.numAtoms == 0;\n\t}\n\tpublic static notBlank(mol:Molecule):boolean\n\t{\n\t\t//return mol != null || mol.numAtoms > 0;\n\t\tif (mol == null) return false;\n\t\treturn mol.numAtoms > 0;\n\t}\n\n\t// substitutes an empty molecule for null\n\tpublic static orBlank(mol:Molecule):Molecule {return mol == null ? new Molecule() : mol;}\n\n\t// conventions for special-atoms\n\tpublic static TEMPLATE_ATTACHMENT = 'X'; // use the label 'X' to denote attachments when defining templates\n\tpublic static ABBREV_ATTACHMENT = '*'; // within abbreviations, use '*' to denote the placeholder superimposition\n\n\t// returns true if there are any abbreviations\n\tpublic static hasAnyAbbrev(mol:Molecule):boolean\n\t{\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (MolUtil.hasAbbrev(mol, n)) return true;\n\t\treturn false;\n\t}\n\n\t// returns true if the atom index is an inline abbreviation\n\tpublic static hasAbbrev(mol:Molecule, atom:number):boolean\n\t{\n\t\tlet extra = mol.atomExtra(atom);\n\t\tfor (let n = 0; n < (extra == null ? 0 : extra.length); n++) if (extra[n].startsWith('a')) return true;\n\t\treturn false;\n\t}\n\n\t// if the molecule has a template abbreviation encoded at the given atom, it will be parsed into a fragment instance and\n\t// returned; for the embedded fragment, atom#1 is considered to be the site of attachment\n\tpublic static getAbbrev(mol:Molecule, atom:number):Molecule\n\t{\n\t\tlet extra = mol.atomExtra(atom);\n\t\tfor (let n = 0; n < (extra != null ? extra.length : 0); n++) if (extra[n].startsWith('a'))\n\t\t{\n\t\t\treturn Molecule.fromString(extra[n].substring(1));\n\t\t}\n\t\treturn null;\n\t}\n\n\t// sets the abbreviation-template for the given atom number, eliminating any existing template at that point\n\tpublic static setAbbrev(mol:Molecule, atom:number, frag:Molecule):void\n\t{\n\t\tlet attidx = 0;\n\t\tfor (let n = 1; n <= frag.numAtoms; n++) if (frag.atomElement(n) == MolUtil.ABBREV_ATTACHMENT)\n\t\t{\n\t\t\t//if (attidx > 0) throw 'Multiple attachment points indicated: invalid.';\n\t\t\tattidx = n;\n\t\t\tbreak;\n\t\t}\n\t\tif (attidx == 0) throw 'No attachment points indicated.';\n\t\tif (attidx >= 2)\n\t\t{\n\t\t\tfrag = frag.clone();\n\t\t\tfrag.swapAtoms(attidx, 1);\n\t\t}\n\n\t\tlet adj = mol.atomAdjList(atom);\n\t\tif (adj.length > 1) throw 'Setting abbreviation for non-terminal atom.';\n\t\tif (frag.atomAdjCount(1) == 1 && mol.atomAdjCount(atom) > 0)\n\t\t{\n\t\t\tlet b1 = mol.findBond(atom, mol.atomAdjList(atom)[0]);\n\t\t\tlet b2 = frag.findBond(1, frag.atomAdjList(1)[0]);\n\t\t\tmol.setBondOrder(b1, frag.bondOrder(b2));\n\t\t}\n\n\t\t// finally we're allowed to set it\n\t\tlet extra = mol.atomExtra(atom);\n\t\tlet idx = -1;\n\t\tfor (let n = 0; n < (extra != null ? extra.length : 0); n++) if (extra[n].startsWith('a')) {idx = n; break;}\n\t\tif (idx < 0) idx = extra.push(null) - 1;\n\n\t\textra[idx] = 'a' + frag.toString();\n\n\t\tmol.setAtomExtra(atom, extra);\n\t}\n\n\t// any invalid abbreviations will be cleared out\n\tpublic static validateAbbrevs(mol:Molecule):void\n\t{\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (MolUtil.hasAbbrev(mol, n))\n\t\t{\n\t\t\tif (mol.atomAdjCount(n) > 1) MolUtil.clearAbbrev(mol, n);\n\t\t\tif (mol.atomCharge(n) != 0) mol.setAtomCharge(n, 0);\n\t\t\tif (mol.atomUnpaired(n) != 0) mol.setAtomUnpaired(n, 0);\n\t\t\tif (mol.atomIsotope(n) != 0) mol.setAtomIsotope(n, Molecule.ISOTOPE_NATURAL);\n\t\t\tif (mol.atomHExplicit(n) != Molecule.HEXPLICIT_UNKNOWN) mol.setAtomHExplicit(n, Molecule.HEXPLICIT_UNKNOWN);\n\t\t}\n\t}\n\n\t// converts a partitioned molecule into a molecule with a subsumed abbreviation; srcmask defines all the atoms which are NOT part\n\t// of the abbreviation; the resulting molecule will contain all of these, plus a new one that has been created to hold the\n\t// abbreviation; the molecule  must be partitioned so that there is exactly 1 source atom attached to all of the abbreviations\n\t// NOTE: returns null if the template creation is invalid\n\tpublic static convertToAbbrev(mol:Molecule, srcmask:boolean[], abbrevName:string):Molecule\n\t{\n\t\tlet molidx = this.convertToAbbrevIndex(mol, srcmask, abbrevName);\n\t\treturn molidx ? molidx[0] : null;\n\t}\n\tpublic static convertToAbbrevIndex(mol:Molecule, srcmask:boolean[], abbrevName:string):[Molecule, number]\n\t{\n\t\tlet junction = 0;\n\t\tlet polymerExtra:string[] = null; // just in case the abbreviation has polymer information\n\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t{\n\t\t\tlet b1 = mol.bondFrom(n), b2 = mol.bondTo(n), atom = 0;\n\t\t\tif (srcmask[b1 - 1] && !srcmask[b2 - 1])\n\t\t\t{\n\t\t\t\tatom = b1;\n\t\t\t\tpolymerExtra = PolymerBlock.getPolymerExtensions(mol, b2);\n\t\t\t}\n\t\t\telse if (!srcmask[b1 - 1] && srcmask[b2 - 1])\n\t\t\t{\n\t\t\t\tatom = b2;\n\t\t\t\tpolymerExtra = PolymerBlock.getPolymerExtensions(mol, b1);\n\t\t\t}\n\n\t\t\tif (atom == 0) continue;\n\n\t\t\tif (junction > 0 && atom != junction) return [null, null];\n\t\t\tjunction = atom;\n\t\t}\n\t\tif (junction == 0) return [null, null];\n\n\t\t// refine the partition based on the junction, and derive reference indices\n\t\tlet na = mol.numAtoms, molidx = 0, fragidx = 0;\n\t\tlet maskmol = Vec.booleanArray(false, na), maskfrag = Vec.booleanArray(false, na);\n\t\tfor (let n = 0; n < na; n++)\n\t\t{\n\t\t\tmaskmol[n] = srcmask[n];\n\t\t\tmaskfrag[n] = !srcmask[n] || n + 1 == junction;\n\t\t\tif (maskmol[n] && n + 1 <= junction) molidx++;\n\t\t\tif (maskfrag[n] && n + 1 <= junction) fragidx++;\n\t\t}\n\n\t\t// sometimes stereo info is preserved\n\t\tlet bondType = Molecule.BONDTYPE_NORMAL, nadj = 0;\n\t\tfor (let a of mol.atomAdjList(junction)) if (!srcmask[a - 1])\n\t\t{\n\t\t\tif (nadj != 0) {bondType = Molecule.BONDTYPE_NORMAL; break;}\n\t\t\tlet b = mol.findBond(junction, a);\n\t\t\tif (mol.bondFrom(b) == junction) bondType = mol.bondType(b);\n\t\t\tnadj++;\n\t\t}\n\n\t\t// create and analyse the fragment\n\t\tlet frag = MolUtil.subgraphMask(mol, maskfrag);\n\t\tfrag.setAtomElement(fragidx, MolUtil.ABBREV_ATTACHMENT);\n\t\tfrag.setAtomCharge(fragidx, 0);\n\t\tfrag.setAtomUnpaired(fragidx, 0);\n\t\tfrag.setAtomHExplicit(fragidx, Molecule.HEXPLICIT_UNKNOWN);\n\t\tfor (let n = 1; n <= frag.numAtoms; n++) frag.setAtomMapNum(n, 0);\n\t\tfrag.setAtomExtra(fragidx, []);\n\t\tfrag.setAtomTransient(fragidx, []);\n\t\tlet adj = frag.atomAdjList(fragidx);\n\t\tlet x = 0, y = 0, inv = 1.0 / adj.length;\n\t\tlet bondOrder = 1;\n\t\tfor (let n = 0; n < adj.length; n++)\n\t\t{\n\t\t\tx += frag.atomX(adj[n]);\n\t\t\ty += frag.atomY(adj[n]);\n\t\t\tlet b = frag.findBond(fragidx, adj[n]);\n\t\t\tif (n == 0) bondOrder = frag.bondOrder(b);\n\t\t\telse if (bondOrder != frag.bondOrder(b)) bondOrder = 1;\n\t\t}\n\t\tx *= inv; y *= inv;\n\t\tif (fragidx > 1) frag.swapAtoms(fragidx, 1);\n\n\t\t// create the excised molecule, and add in the fragment\n\t\tlet newmol = MolUtil.subgraphMask(mol, maskmol);\n\t\tlet\tnewatom = newmol.addAtom(abbrevName, x, y);\n\t\tnewmol.addBond(molidx, newatom, bondOrder, bondType);\n\t\tMolUtil.setAbbrev(newmol, newatom, frag);\n\t\tif (polymerExtra != null) newmol.setAtomExtra(newatom, Vec.concat(newmol.atomExtra(newatom), polymerExtra));\n\n\t\treturn [newmol, newatom];\n\t}\n\n\t// hunts through any abbreviations, and expands them out to form actual atoms; the resulting representation is fair game for things\n\t// like MF/MW calculations, or any other pure-atom property calculation; if alignCoords is true, it will line up the positions of\n\t// the new atoms; if false, the algorithm will burn up less cycles; note that abbreviations-within-abbreviations are handled by\n\t// repeated iteration until there are none left\n\tpublic static expandAbbrevs(mol:Molecule, alignCoords:boolean):void\n\t{\n\t\twhile (true)\n\t\t{\n\t\t\tlet anything = false;\n\t\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (MolUtil.hasAbbrev(mol, n))\n\t\t\t{\n\t\t\t\tif (MolUtil.expandOneAbbrev(mol, n, alignCoords)) anything = true;\n\t\t\t\tn--;\n\t\t\t}\n\t\t\tif (!anything) break;\n\t\t}\n\t}\n\n\t// very common convenience function: if has abbreviations, clone and expand; otherwise return self\n\tpublic static expandedAbbrevs(mol:Molecule):Molecule\n\t{\n\t\tif (!this.hasAnyAbbrev(mol)) return mol;\n\t\tmol = mol.clone();\n\t\tthis.expandAbbrevs(mol, true);\n\t\treturn mol;\n\t}\n\n\t// expands the abbreviation for a single atom; the atom itself is deleted, and the expanded content is added to the end of the molecule; if for some\n\t// reason the abbreviation is invalid, will clear the abbreviation instead\n\t// return value: if something happened, mask of true = part of the expansion (including the new placeholder atom); if nothing happened, returns null\n\tpublic static expandOneAbbrev(mol:Molecule, atom:number, alignCoords:boolean):boolean[]\n\t{\n\t\tlet frag = MolUtil.getAbbrev(mol, atom);\n\t\tif (frag == null) return null;\n\t\tif (mol.atomAdjCount(atom) != 1 || frag.numAtoms == 0)\n\t\t{\n\t\t\tMolUtil.clearAbbrev(mol, atom);\n\t\t\treturn null;\n\t\t}\n\n\t\tlet m = mol.atomMapNum(atom);\n\t\tfor (let n = 1; n <= frag.numAtoms; n++) frag.setAtomMapNum(n, 0);\n\t\tif (m > 0) for (let n of frag.atomAdjList(1)) frag.setAtomMapNum(n, m);\n\n\t\treturn MolUtil.expandOneAbbrevFrag(mol, atom, frag, alignCoords);\n\t}\n\tpublic static expandOneAbbrevFrag(mol:Molecule, atom:number, frag:Molecule, alignCoords:boolean):boolean[]\n\t{\n\t\tlet polymerExtra = PolymerBlock.getPolymerExtensions(mol, atom);\n\n\t\tlet nbr = mol.atomAdjCount(atom) == 1 ? mol.atomAdjList(atom)[0] : 0;\n\t\tlet connBond = mol.findBond(atom, nbr), connType = Molecule.BONDTYPE_NORMAL;\n\t\tif (connBond > 0)\n\t\t{\n\t\t\tconnType = mol.bondType(connBond);\n\t\t\tif (mol.bondFrom(connBond) != nbr && (connType == Molecule.BONDTYPE_INCLINED || connType == Molecule.BONDTYPE_DECLINED)) connType = Molecule.BONDTYPE_NORMAL;\n\t\t}\n\n\t\tif (alignCoords)\n\t\t{\n\t\t\tlet vx1 = mol.atomX(atom) - mol.atomX(nbr), vy1 = mol.atomY(atom) - mol.atomY(nbr);\n\t\t\tlet adj = frag.atomAdjList(1);\n\t\t\tlet vx2 = 0, vy2 = 0, inv = 1.0 / adj.length;\n\t\t\tfor (let n = 0; n < adj.length; n++)\n\t\t\t{\n\t\t\t\tvx2 += frag.atomX(adj[n]) - frag.atomX(1);\n\t\t\t\tvy2 += frag.atomY(adj[n]) - frag.atomY(1);\n\t\t\t}\n\t\t\tvx2 *= inv;\n\t\t\tvy2 *= inv;\n\t\t\tlet th1 = Math.atan2(vy1, vx1), th2 = Math.atan2(vy2, vx2);\n\t\t\tCoordUtil.rotateMolecule(frag, th1 - th2);\n\t\t\tCoordUtil.translateMolecule(frag, mol.atomX(nbr) - frag.atomX(1), mol.atomY(nbr) - frag.atomY(1));\n\t\t}\n\n\t\tif (polymerExtra != null)\n\t\t{\n\t\t\tfor (let n = 1; n <= frag.numAtoms; n++)\n\t\t\t{\n\t\t\t\tlet extra = frag.atomExtra(n);\n\t\t\t\tfor (let i = extra.length - 1; i >= 0; i--) if (polymerExtra.indexOf(extra[i]) >= 0) extra.splice(i, 1);\n\t\t\t\tfrag.setAtomExtra(n, Vec.concat(extra, polymerExtra));\n\t\t\t}\n\t\t}\n\n\t\tlet join = mol.numAtoms + 1;\n\t\tmol.append(frag);\n\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t{\n\t\t\tif (mol.bondFrom(n) == join)\n\t\t\t{\n\t\t\t\tmol.setBondFrom(n, nbr);\n\t\t\t\tmol.setBondType(n, connType);\n\t\t\t}\n\t\t\telse if (mol.bondTo(n) == join)\n\t\t\t{\n\t\t\t\tmol.setBondFromTo(n, nbr, mol.bondFrom(n));\n\t\t\t\tmol.setBondType(n, connType);\n\t\t\t}\n\t\t}\n\n\t\tlet mask = Vec.booleanArray(false, mol.numAtoms);\n\t\tfor (let n = mask.length - frag.numAtoms; n < mask.length; n++) mask[n] = true;\n\t\tmol.deleteAtomAndBonds(join);\n\t\tmol.deleteAtomAndBonds(atom);\n\t\tmask.splice(join - 1, 1);\n\t\tmask.splice(atom - 1, 1);\n\t\treturn mask;\n\t}\n\n\t// removes the abbreviation from a molecule, if there is one; also, the element symbol will be set to \"C\" when there is\n\t// any clearing to be done\n\tpublic static clearAbbrev(mol:Molecule, atom:number):void\n\t{\n\t\tlet extra = mol.atomExtra(atom);\n\t\tfor (let n = 0; n < (extra != null ? extra.length : 0); n++) if (extra[n].startsWith('a'))\n\t\t{\n\t\t\textra.splice(n, 1);\n\t\t\tmol.setAtomExtra(atom, extra);\n\t\t\tmol.setAtomElement(atom, 'C');\n\t\t\treturn;\n\t\t}\n\t}\n\n\t// equivalent to the Molecule method of same name, except trashes the abbreviation of the \"element\" symbol has changed\n\tpublic static setAtomElement(mol:Molecule, atom:number, el:string):void\n\t{\n\t\tif (mol.atomElement(atom) == el) return;\n\t\tthis.clearAbbrev(mol, atom);\n\t\tmol.setAtomElement(atom, el);\n\t}\n\n\t// equivalent to the Molecule method of same name, except that if either of the atoms are about to exceed divalence, its\n\t// abbreviation gets zapped; also, if the bond was already there, zaps the old one\n\tpublic static addBond(mol:Molecule, bfr:number, bto:number, order:number, type?:number):number\n\t{\n\t\tif (type == null) type = Molecule.BONDTYPE_NORMAL;\n\t\tif (mol.atomAdjCount(bfr) >= 1) this.clearAbbrev(mol, bfr);\n\t\tif (mol.atomAdjCount(bto) >= 1) this.clearAbbrev(mol, bto);\n\t\tlet b = mol.findBond(bfr, bto);\n\t\tif (b > 0) mol.deleteBond(b);\n\t\treturn mol.addBond(bfr, bto, order, type);\n\t}\n\n\t// returns a molecule which is smaller than the current one, according to the mask (which must be of size #atoms); boundary cases\n\t// are a null molecule or cloned copy\n\tpublic static subgraphMask(mol:Molecule, mask:boolean[]):Molecule\n\t{\n\t\tlet invidx:number[] = [];\n\t\tlet sum = 0;\n\t\tfor (let n = 0; n < mol.numAtoms; n++)\n\t\t{\n\t\t\tif (mask[n]) invidx.push(++sum); else invidx.push(0);\n\t\t}\n\t\tif (sum == 0) return new Molecule();\n\t\tif (sum == mol.numAtoms) return mol.clone();\n\n\t\tlet frag = new Molecule();\n\t\tfrag.keepTransient = true;\n\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (mask[n - 1])\n\t\t{\n\t\t\tlet num = frag.addAtom(mol.atomElement(n), mol.atomX(n), mol.atomY(n), mol.atomCharge(n), mol.atomUnpaired(n));\n\t\t\tfrag.setAtomIsotope(num, mol.atomIsotope(n));\n\t\t\tfrag.setAtomHExplicit(num, mol.atomHExplicit(n));\n\t\t\tfrag.setAtomMapNum(num, mol.atomMapNum(n));\n\t\t\tfrag.setAtomExtra(num, mol.atomExtra(n));\n\t\t\tfrag.setAtomTransient(num, mol.atomTransient(n));\n\t\t}\n\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t{\n\t\t\tlet bfr = invidx[mol.bondFrom(n) - 1], bto = invidx[mol.bondTo(n) - 1];\n\t\t\tif (bfr > 0 && bto > 0)\n\t\t\t{\n\t\t\t\tlet num = frag.addBond(bfr, bto, mol.bondOrder(n), mol.bondType(n));\n\t\t\t\tfrag.setBondExtra(num, mol.bondExtra(n));\n\t\t\t\tfrag.setBondTransient(num, mol.bondTransient(n));\n\t\t\t}\n\t\t}\n\n\t\tfrag.keepTransient = mol.keepTransient;\n\t\treturn frag;\n\t}\n\n\t// given a list of indices, constructs a new molecule which has the atoms in that order; the construction of idx[n] is such\n\t// that the new atom at position {n+1} will be the atom previously located at idx[n]; for example, a molecule containing the\n\t// atoms [C,O,N,H], reordered by indices of [3,2,4,1], will produce a new molecule with atoms [N,O,H,C]; the bonds will also\n\t// be correctly remapped; idx.length must be equal to or less than the number of atoms; each index must be unique and\n\t// in the range {1..#atoms}, otherwise the result is undefined\n\tpublic static subgraphIndex(mol:Molecule, idx:number[]):Molecule\n\t{\n\t\tlet invidx = Vec.numberArray(0, mol.numAtoms);\n\t\tfor (let n = 0; n < invidx.length; n++) invidx[n] = 0;\n\t\tfor (let n = 0; n < idx.length; n++) invidx[idx[n] - 1] = n + 1;\n\n\t\tlet frag = new Molecule();\n\t\tfrag.keepTransient = true;\n\n\t\tfor (let n = 0; n < idx.length; n++)\n\t\t{\n\t\t\tlet num = frag.addAtom(mol.atomElement(idx[n]), mol.atomX(idx[n]), mol.atomY(idx[n]), mol.atomCharge(idx[n]), mol.atomUnpaired(idx[n]));\n\t\t\tfrag.setAtomIsotope(num, mol.atomIsotope(idx[n]));\n\t\t\tfrag.setAtomHExplicit(num, mol.atomHExplicit(idx[n]));\n\t\t\tfrag.setAtomMapNum(num, mol.atomMapNum(idx[n]));\n\t\t\tfrag.setAtomExtra(num, mol.atomExtra(idx[n]));\n\t\t\tfrag.setAtomTransient(num, mol.atomTransient(idx[n]));\n\t\t}\n\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t{\n\t\t\tlet bfr = invidx[mol.bondFrom(n) - 1], bto = invidx[mol.bondTo(n) - 1];\n\t\t\tif (bfr > 0 && bto > 0)\n\t\t\t{\n\t\t\t\tlet num = frag.addBond(bfr, bto, mol.bondOrder(n), mol.bondType(n));\n\t\t\t\tfrag.setBondExtra(num, mol.bondExtra(n));\n\t\t\t\tfrag.setBondTransient(num, mol.bondTransient(n));\n\t\t\t}\n\t\t}\n\n\t\tfrag.keepTransient = mol.keepTransient;\n\t\treturn frag;\n\t}\n\n\t// a specialised version of mask subgraph: any atoms which are not in the mask, but are bonded to atoms which are in the\n\t// mask, are converted to the element \"X\" and included in the result; this makes them potentially more useful as template fragments\n\tpublic static subgraphWithAttachments(mol:Molecule, mask:boolean[]):Molecule\n\t{\n\t\tlet xmask = mask.slice(0);\n\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t{\n\t\t\tlet bfr = mol.bondFrom(n) - 1, bto = mol.bondTo(n) - 1;\n\t\t\tif (mask[bfr] && !mask[bto]) xmask[bto] = true;\n\t\t\telse if (mask[bto] && !mask[bfr]) xmask[bfr] = true;\n\t\t}\n\t\tlet xmol = mol.clone();\n\t\tfor (let n = 1; n <= xmol.numAtoms; n++) if (xmask[n - 1] && !mask[n - 1])\n\t\t{\n\t\t\txmol.setAtomElement(n, 'X');\n\t\t\txmol.setAtomCharge(n, 0);\n\t\t\txmol.setAtomUnpaired(n, 0);\n\t\t\txmol.setAtomHExplicit(n, Molecule.HEXPLICIT_UNKNOWN);\n\t\t\txmol.setAtomExtra(n, []);\n\t\t}\n\t\treturn MolUtil.subgraphMask(xmol, xmask);\n\t}\n\n\t// appends the fragment to the molecule, and makes a token effort to arrange the atom positions so they are along the X-axis\n\tpublic static append(mol:Molecule, frag:Molecule):void\n\t{\n\t\tlet boxm = mol.boundary(), boxf = frag.boundary();\n\t\tlet dx = boxm.maxX() + Molecule.IDEALBOND - boxf.minX();\n\t\tlet dy = 0.5 * (boxm.minY() + boxm.maxY() - boxf.minY() - boxf.maxY());\n\t\tlet top = mol.numAtoms;\n\t\tmol.append(frag);\n\t\tfor (let n = top + 1; n <= mol.numAtoms; n++) mol.setAtomPos(n, mol.atomX(n) + dx, mol.atomY(n) + dy);\n\t}\n\n\t/*\n\t// works similarly to reorderAtoms(..) above, except operates on the order of the bond list; the atoms are unaffected\n\tpublic Molecule reorderedBonds(Molecule mol, int[] idx)\n\t{\n\t\tMolecule newmol = new Molecule();\n\t\tfor (int n = 1; n <= mol.numAtoms; n++)\n\t\t{\n\t\t\tint num = newmol.addAtom(mol.atomElement(n), mol.atomX(n), mol.atomY(n), mol.atomCharge(n), mol.atomUnpaired(n));\n\t\t\tnewmol.setAtomHExplicit(num, mol.atomHExplicit(n));\n\t\t\tnewmol.setAtomMapNum(num, mol.atomMapNum(n));\n\t\t\tnewmol.setAtomExtra(num, mol.atomExtra(n));\n\t\t}\n\t\tfor (int n = 0; n < idx.length; n++)\n\t\t{\n\t\t\tint num = newmol.addBond(mol.bondFrom(idx[n]), mol.bondTo(idx[n]), mol.bondOrder(idx[n]), mol.bondType(idx[n]));\n\t\t\tnewmol.setBondExtra(num, mol.bondExtra(idx[n]));\n\t\t}\n\n\t\treturn newmol;\n\t}*/\n\n\t// returns a new molecule which has the indicated atom indices removed; note that the index list does not need to be ordered, and\n\t// duplicates are OK\n\tpublic static deleteAtoms(mol:Molecule, idx:number[]):Molecule\n\t{\n\t\tlet mask = Vec.booleanArray(true, mol.numAtoms);\n\t\tfor (let n = 0; n < idx.length; n++) mask[idx[n] - 1] = false;\n\t\treturn MolUtil.subgraphMask(mol, mask);\n\t}\n\n\t// produces a list of connected components for the molecule; the immediate size of the return value is the number of components;\n\t// each of the sub arrays is a list of indices for that component; the return value has 1-based indices\n\tpublic static componentList(mol:Molecule):number[][]\n\t{\n\t\tlet sz = mol.numAtoms;\n\t\tif (sz == 0) return null;\n\t\tlet g = Graph.fromMolecule(mol);\n\n\t\tlet groups = g.calculateComponentGroups();\n\t\tfor (let grp of groups) Vec.addTo(grp, 1); // 1-based rather than zero\n\t\treturn groups;\n\t}\n\n\t// obtain groups of atom indices, each of which represents a \"side\" of atoms which are hanging \"off\" a central atom; if the central\n\t// atom has N neighbors and is not in a ring, then there will be N groups of atoms returned; if the atom is part of a ring block,\n\t// then the number of sides will be less than the number of neighbours; the returned arrays are 1-based\n\tpublic static getAtomSides(mol:Molecule, atom:number):number[][]\n\t{\n\t\tlet g = Graph.fromMolecule(mol);\n\t\tlet cc = g.calculateComponents();\n\t\tlet mask:boolean[] = [];\n\t\tfor (let n = 0; n < cc.length; n++) mask.push(cc[n] == cc[atom - 1]);\n\t\tmask[atom - 1] = false;\n\n\t\tlet oldmap = Vec.maskIdx(mask);\n\t\tg.keepNodesMask(mask);\n\t\tcc = g.calculateComponents();\n\t\tlet ccmax = Vec.max(cc);\n\n\t\tlet grps:number[][] = [];\n\t\tfor (let n = 0; n < ccmax; n++) grps.push([atom]);\n\t\tfor (let n = 0; n < cc.length; n++) grps[cc[n] - 1].push(oldmap[n] + 1);\n\n\t\treturn grps;\n\t}\n\n\t// returns the groups of atoms which are on the \"bond from\" and \"bond to\" sides of the indicated bond, if bond is not a ring:\n\t//   A   B\n\t//    \\_/\t\t\t2 groups returned: (A,A) and (B,B)\n\t//    / \\\t\t\tthe number of groups returned is guaranteed to be 0, 1 or 2\n\t//   A   B\n\t// if the bond is in a ring, then the groups are composed by disconnecting the bond and returning each remaining component, chopped\n\t// up according to ring block membership\n\tpublic static getBondSides(mol:Molecule, bond:number):number[][]\n\t{\n\t\tlet bf = mol.bondFrom(bond), bt = mol.bondTo(bond);\n\t\tlet inRing = mol.bondInRing(bond); // !! mol.atomRingBlock(bf)>0 && mol.atomRingBlock(bf)==mol.atomRingBlock(bt);\n\n\t\tlet g = Graph.fromMolecule(mol);\n\t\tlet cc = g.calculateComponents();\n\t\tlet mask:boolean[] = [];\n\t\tfor (let n = 0; n < cc.length; n++) mask.push(cc[n] == cc[bf - 1]);\n\t\tif (!inRing) g.removeEdge(bf - 1, bt - 1);\n\t\telse {mask[bf - 1] = false; mask[bt - 1] = false;}\n\n\t\tlet oldmap = Vec.maskIdx(mask);\n\t\tg.keepNodesMask(mask);\n\t\tcc = g.calculateComponents();\n\t\tlet ccmax = Vec.max(cc);\n\n\t\tlet grps:number[][] = [];\n\t\tfor (let n = 0; n < ccmax; n++)\n\t\t{\n\t\t\tgrps[n] = [];\n\t\t\tif (inRing) {grps[n].push(bf); grps[n].push(bt);}\n\t\t}\n\t\tfor (let n = 0; n < cc.length; n++) grps[cc[n] - 1].push(oldmap[n] + 1);\n\n\t\treturn grps;\n\t}\n\n\t// returning flat arrays of atom properties: doing this before a geometry operation can boost performance considerably\n\tpublic static arrayAtomX(mol:Molecule):number[]\n\t{\n\t\tlet x = Vec.numberArray(0, mol.numAtoms);\n\t\tfor (let n = x.length - 1; n >= 0; n--) x[n] = mol.atomX(n + 1);\n\t\treturn x;\n\t}\n\tpublic static arrayAtomY(mol:Molecule):number[]\n\t{\n\t\tlet y = Vec.numberArray(0, mol.numAtoms);\n\t\tfor (let n = y.length - 1; n >= 0; n--) y[n] = mol.atomY(n + 1);\n\t\treturn y;\n\t}\n\tpublic static arrayAtomMapNum(mol:Molecule):number[]\n\t{\n\t\tlet mapnum = Vec.numberArray(0, mol.numAtoms);\n\t\tfor (let n = mapnum.length - 1; n >= 0; n--) mapnum[n] = mol.atomMapNum(n + 1);\n\t\treturn mapnum;\n\t}\n\n\t// calculates the molecular formula\n\tpublic static molecularFormula(mol:Molecule, punctuation?:boolean | string[]):string\n\t{\n\t\tlet puncEnter = '', puncExit = '', puncEnterSuper = '', puncExitSuper = '';\n\t\tif (punctuation == true) [puncEnter, puncExit] = ['{', '}', '{^', '}'];\n\t\telse if (punctuation instanceof Array)\n\t\t{\n\t\t\tpuncEnter = punctuation[0];\n\t\t\tpuncExit = punctuation[1];\n\t\t\tpuncEnterSuper = punctuation[2];\n\t\t\tpuncExitSuper = punctuation[3];\n\t\t}\n\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (MolUtil.hasAbbrev(mol, n))\n\t\t{\n\t\t\tmol = mol.clone();\n\t\t\tMolUtil.expandAbbrevs(mol, false);\n\t\t\tbreak;\n\t\t}\n\n\t\tlet countC = 0, countH = 0;\n\t\tlet elements = Vec.stringArray('', mol.numAtoms);\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t{\n\t\t\tcountH += mol.atomHydrogens(n);\n\t\t\tlet el = mol.atomElement(n);\n\n\t\t\t// this is hacky, but at least isotopes are separated out; they should ideally be sorted just after their non-isotopes, in\n\t\t\t// numerical order\n\t\t\tif (mol.atomIsotope(n) != Molecule.ISOTOPE_NATURAL) el = puncEnterSuper + mol.atomIsotope(n) + puncExitSuper + el;\n\n\t\t\tif (el == 'C') countC++;\n\t\t\telse if (el == 'H') countH++;\n\t\t\telse elements[n - 1] = el;\n\t\t}\n\n\t\telements.sort();\n\n\t\tlet formula = '';\n\n\t\tif (countC > 0) formula += 'C';\n\t\tif (countC > 1)\n\t\t{\n\t\t\tif (punctuation) formula += puncEnter;\n\t\t\tformula += countC;\n\t\t\tif (punctuation) formula += puncExit;\n\t\t}\n\t\tif (countH > 0) formula += 'H';\n\t\tif (countH > 1)\n\t\t{\n\t\t\tif (punctuation) formula += puncEnter;\n\t\t\tformula += countH;\n\t\t\tif (punctuation) formula += puncExit;\n\t\t}\n\t\tfor (let n = 0; n < elements.length; n++) if (elements[n].length > 0)\n\t\t{\n\t\t\tlet count = 1;\n\t\t\tfor (; n + 1 < elements.length && elements[n] == elements[n + 1]; n++) count++;\n\t\t\tformula += elements[n];\n\t\t\tif (count > 1)\n\t\t\t{\n\t\t\t\tif (punctuation) formula += puncEnter;\n\t\t\t\tformula += count;\n\t\t\t\tif (punctuation) formula += puncExit;\n\t\t\t}\n\t\t}\n\n\t\treturn formula.toString();\n\t}\n\n\t// calculates the molecular weight, using natural abundance as the default, or specific isotope otherwise\n\tpublic static molecularWeight(mol:Molecule):number\n\t{\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (MolUtil.hasAbbrev(mol, n))\n\t\t{\n\t\t\tmol = mol.clone();\n\t\t\tMolUtil.expandAbbrevs(mol, false);\n\t\t\tbreak;\n\t\t}\n\n\t\tlet mw = 0;\n\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t{\n\t\t\tmw += mol.atomHydrogens(n) * Chemistry.NATURAL_ATOMIC_WEIGHTS[1];\n\n\t\t\tlet iso = mol.atomIsotope(n);\n\t\t\tif (iso != Molecule.ISOTOPE_NATURAL) {mw += iso; continue;}\n\n\t\t\tlet an = Molecule.elementAtomicNumber(mol.atomElement(n));\n\t\t\tif (an > 0 && an < Chemistry.NATURAL_ATOMIC_WEIGHTS.length) mw += Chemistry.NATURAL_ATOMIC_WEIGHTS[an];\n\t\t}\n\n\t\treturn mw;\n\t}\n\n\t// looks for all cases where a bond {a1,a2} has duplicate(s), either of the {a1,a2} or {a2,a1} flavours; when this happens,\n\t// the duplicates are removed; if one of the bond violates maximum Lewis octet rule for (C/N/O), it gets zapped;\n\t// otherwise, keeps the bond with the highest order (second priority); or the most exotic type (third priority); or\n\t// failing that, first in first served\n\tpublic static removeDuplicateBonds(mol:Molecule):void\n\t{\n\t\tlet bpri:number[] = [];\n\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t{\n\t\t\tlet p = Math.min(mol.bondFrom(n), mol.bondTo(n)) * mol.numAtoms + Math.max(mol.bondFrom(n), mol.bondTo(n));\n\t\t\tbpri.push(p);\n\t\t}\n\t\tlet bidx = Vec.idxSort(bpri);\n\n\t\tlet keepmask = Vec.booleanArray(false, bidx.length);\n\t\tlet p = 0;\n\t\twhile (p < bidx.length)\n\t\t{\n\t\t\tlet sz = 1;\n\t\t\twhile (p + sz < bidx.length && bpri[bidx[p]] == bpri[bidx[p + sz]]) sz++;\n\n\t\t\tlet best = p;\n\t\t\tfor (let n = p + 1; n < p + sz; n++) // (does nothing if not degenerate)\n\t\t\t{\n\t\t\t\tlet b1 = bidx[best] + 1, b2 = bidx[n] + 1;\n\n\t\t\t\t// see if just one of the bonds assures Lewis violation on C/N/O\n\t\t\t\tlet a1 = mol.bondFrom(b1), a2 = mol.bondTo(b1);\n\t\t\t\tlet el1 = mol.atomElement(a1), el2 = mol.atomElement(a2);\n\t\t\t\tlet limit1 = 0, limit2 = 0;\n\t\t\t\tif (el1 == 'C' || el1 == 'N') limit1 = 4;\n\t\t\t\telse if (el1 == 'O') limit1 = 3;\n\t\t\t\tif (el2 == 'C' || el2 == 'N') limit2 = 4;\n\t\t\t\telse if (el2 == 'O') limit2 = 3;\n\n\t\t\t\tif (limit1 > 0 || limit2 > 0)\n\t\t\t\t{\n\t\t\t\t\tlet boB1A1 = 0, boB1A2 = 0, boB2A1 = 0, boB2A2 = 0;\n\t\t\t\t\tfor (let i = 1; i <= mol.numBonds; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (i != b2 && (mol.bondFrom(i) == a1 || mol.bondTo(i) == a1)) boB1A1 += mol.bondOrder(i);\n\t\t\t\t\t\tif (i != b2 && (mol.bondFrom(i) == a2 || mol.bondTo(i) == a2)) boB1A2 += mol.bondOrder(i);\n\t\t\t\t\t\tif (i != b1 && (mol.bondFrom(i) == a1 || mol.bondTo(i) == a1)) boB2A1 += mol.bondOrder(i);\n\t\t\t\t\t\tif (i != b1 && (mol.bondFrom(i) == a2 || mol.bondTo(i) == a2)) boB2A2 += mol.bondOrder(i);\n\t\t\t\t\t}\n\t\t\t\t\tlet bad1 = 0, bad2 = 0;\n\t\t\t\t\tif (limit1 > 0 && boB1A1 > limit1) bad1++;\n\t\t\t\t\tif (limit2 > 0 && boB1A2 > limit2) bad1++;\n\t\t\t\t\tif (limit1 > 0 && boB2A1 > limit1) bad2++;\n\t\t\t\t\tif (limit2 > 0 && boB2A2 > limit2) bad2++;\n\n\t\t\t\t\tif (bad1 < bad2) continue; // stick with current best\n\t\t\t\t\tif (bad1 > bad2) {best = n; continue;} // switch to new best\n\t\t\t\t}\n\n\t\t\t\t// otherwise pick the most interesting\n\t\t\t\tlet exotic1 = 2 * mol.bondOrder(b1), exotic2 = 2 * mol.bondOrder(b2);\n\t\t\t\texotic1 += (exotic1 == 0 ? 4 : 0) + (mol.bondType(b1) != Molecule.BONDTYPE_NORMAL ? 1 : 0);\n\t\t\t\texotic2 += (exotic2 == 0 ? 4 : 0) + (mol.bondType(b2) != Molecule.BONDTYPE_NORMAL ? 1 : 0);\n\n\t\t\t\tif (exotic2 > exotic1) best = n;\n\t\t\t}\n\t\t\tkeepmask[bidx[best]] = true;\n\n\t\t\tp += sz;\n\t\t}\n\t\tfor (let n = mol.numBonds; n >= 1; n--)\n\t\t\tif (!keepmask[n - 1] || mol.bondFrom(n) == mol.bondTo(n)) mol.deleteBond(n);\n\t}\n\n\t// calculates a weight for each atom relative to a starting atom, N; this is useful when deciding which atoms to move around,\n\t// i.e. those with higher weight should probably stay where they are; the algorithm is Morgan-like, in that atom values are\n\t// sequentially added to their neighbours, with the exception of atom N, which is a separating point\n\tpublic static calculateWalkWeight(mol:Molecule, atom:number):number[]\n\t{\n\t\tlet ccsz = 0, cc = Graph.fromMolecule(mol).calculateComponents();\n\t\tfor (let n = 0; n < cc.length; n++) if (cc[n] == cc[atom - 1]) ccsz++;\n\n\t\tlet w = Vec.numberArray(1, mol.numAtoms), wn = Vec.numberArray(0, mol.numAtoms);\n\t\tw[atom - 1] = 0;\n\t\tfor (; ccsz > 0; ccsz--)\n\t\t{\n\t\t\tfor (let n = 0; n < mol.numAtoms; n++) wn[n] = w[n];\n\t\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t\t{\n\t\t\t\tlet a1 = mol.bondFrom(n) - 1, a2 = mol.bondTo(n) - 1;\n\t\t\t\tw[a1] += wn[a2] * 0.1;\n\t\t\t\tw[a2] += wn[a1] * 0.1;\n\t\t\t}\n\t\t\tw[atom - 1] = 0;\n\t\t}\n\t\treturn w;\n\t}\n\n/*\n\t// returns the electron count of an atom: this is the sum of natural electron count, neighbouring bonds,\n\t// explicit hydrogens, unpaired electrons and -charge; hydrogens inferred by the valence are included\n\t// only if the countImplicit parameter is true;\n\t// the return value can be used to calculate the number of remaining slots for adding new substituents\n\tpublic static int atomElectronCount(Molecule mol, int N, boolean countImplicit)\n\t{\n\t\tint atno = mol.atomicNumber(N), blk = Chemistry.ELEMENT_BLOCKS[atno], grp = Chemistry.ELEMENT_GROUPS[atno];\n\t\tint val = blk == 0 ? 0 : blk == 1 ? grp : blk == 2 ? grp - 10 : grp;\n\t\tif (countImplicit) val += mol.atomHydrogens(N);\n\t\telse if (mol.atomHExplicit(N) != Molecule.HEXPLICIT_UNKNOWN) val += mol.atomHExplicit(N);\n\t\tval += mol.atomUnpaired(N) - mol.atomCharge(N);\n\t\tint[] adjb = mol.atomAdjBonds(N);\n\t\tfor (int n = 0; n < adjb.length; n++) val += mol.bondOrder(adjb[n]);\n\t\treturn val;\n\t}\n\n\t// for a given atomic number, returns the valence limit, considering S/P/D electrons, i.e. cuts out\n\t// at 18 electrons, even for f-block metals\n\tpublic static int atomMaxValenceSPD(int atno)\n\t{\n\t\tint blk = Chemistry.ELEMENT_BLOCKS[atno];\n\t\t//                             ?, s, p,  d, f\n\t\tfinal int[] BLKVAL = new int[]{2, 2, 8, 18, 18};\n\t\treturn BLKVAL[blk];\n\t}\n\n\t// if the molecule has any bonds that are not of order 1, 2 or 3 then a new molecule will be constructed\n\t// which has only these bond types; if no interesting bonds, returns null; a returned molecule is\n\t// more suitable to writing to a format such as MDL MOL; zero bonds are typically converted into\n\t// double bonds or charge-separated single bonds\n\tpublic static Molecule reduceBondTypes(Molecule mol)\n\t{\n\t\tfinal int nb = mol.numBonds;\n\t\tboolean any = false;\n\t\tfor (int n = 1; n <= nb; n++) if (mol.bondOrder(n) < 1 || mol.bondOrder(n) > 3) {any = true; break;}\n\t\tif (!any) return null;\n\n\t\tmol = mol.clone();\n\n\t\tfor (int n = 1; n <= nb; n++)\n\t\t{\n\t\t\tint bo = mol.bondOrder(n);\n\t\t\tif (bo == 0)\n\t\t\t{\n\t\t\t\tint bfr = mol.bondFrom(n), bto = mol.bondTo(n);\n\n\t\t\t\t// non-elements do not get to charge separate\n\t\t\t\tint atno1 = mol.atomicNumber(bfr), atno2 = mol.atomicNumber(bto);\n\t\t\t\tif (atno1 == 0 || atno2 == 0)\n\t\t\t\t{\n\t\t\t\t\tmol.setBondOrder(n, 1);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tint val1 = atomElectronCount(mol, bfr, true), val2 = atomElectronCount(mol, bto, true);\n\t\t\t\tint max1 = atomMaxValenceSPD(atno1), max2 = atomMaxValenceSPD(atno2);\n\t\t\t\tboolean spc1 = val1 <= max1 - 2, spc2 = val2 <= max2 - 2;\n\t\t\t\tif (spc1 && spc2)\n\t\t\t\t{\n\t\t\t\t\t// sufficient valence exists, so call it a double bond\n\t\t\t\t\tmol.setBondOrder(n, 2);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// charge separate, as long as the atom receiving the negative charge has room for it\n\t\t\t\tif (spc1)\n\t\t\t\t{\n\t\t\t\t\tmol.setAtomCharge(bfr, mol.atomCharge(bfr) - 1);\n\t\t\t\t\tmol.setAtomCharge(bto, mol.atomCharge(bto) + 1);\n\t\t\t\t}\n\t\t\t\tif (spc2)\n\t\t\t\t{\n\t\t\t\t\tmol.setAtomCharge(bfr, mol.atomCharge(bfr) + 1);\n\t\t\t\t\tmol.setAtomCharge(bto, mol.atomCharge(bto) - 1);\n\t\t\t\t}\n\n\t\t\t\tmol.setBondOrder(n, 1);\n\t\t\t}\n\t\t\telse if (bo > 3) mol.setBondOrder(n, 3);\n\t\t\telse mol.setBondOrder(n, 1);\n\t\t}\n\n\t\treturn mol;\n\t}*/\n\n\t// return the total number of attached hydrogens: implicit/explicit + any actual atoms connected to it\n\tpublic static totalHydrogens(mol:Molecule, atom:number):number\n\t{\n\t\tlet hc = mol.atomHydrogens(atom);\n\t\tlet adj = mol.atomAdjList(atom);\n\t\tfor (let n = 0; n < adj.length; n++) if (mol.atomElement(adj[n]) == 'H') hc++;\n\t\treturn hc;\n\t}\n\n\t// operates on the provided molecule, by removing any \"boring\" hydrogen atoms; boring is defined as:\n\t//\t\t- bonded to an atom that auto-calculates hydrogens and is set to do so\n\t//\t\t- one single non-stereo bond to a non-hydrogen atom\n\t//      - no charge or unpaired electrons or isotope information\n\t//\t\t- no extension fields\n\t// the adjacent heavy atom has its explicit hydrogen count incremented, unless it is set to auto _and_ after removing\n\t// the hydrogen atom, the calculated value is 1\n\t// note: the 'force' parameter can be used to make it just chop everything\n\tpublic static stripHydrogens(mol:Molecule, force:boolean = false):void\n\t{\n\t\tfor (let n = mol.numAtoms; n >= 1; n--)\n\t\t\tif ((force && mol.atomElement(n) == 'H') || this.boringHydrogen(mol, n)) mol.deleteAtomAndBonds(n);\n\t}\n\n\t// returns true if a given atom is a hydrogen atom with nothing unusual going on, i.e. fair game for deletion\n\tpublic static boringHydrogen(mol:Molecule, atom:number):boolean\n\t{\n\t\tif (mol.atomElement(atom) != 'H') return false;\n\n\t\tif (mol.atomCharge(atom) != 0 || mol.atomUnpaired(atom) != 0) return false;\n\t\tif (mol.atomIsotope(atom) != Molecule.ISOTOPE_NATURAL) return false;\n\t\tif (Vec.notBlank(mol.atomExtra(atom)) || Vec.notBlank(mol.atomTransient(atom))) return false;\n\t\tif (mol.atomAdjCount(atom) != 1) return false;\n\n\t\tlet other = mol.atomAdjList(atom)[0];\n\t\tif (mol.atomElement(other) == 'H') return false;\n\t\tlet bond = mol.atomAdjBonds(atom)[0];\n\t\tif (mol.bondOrder(bond) != 1 || mol.bondType(bond) != Molecule.BONDTYPE_NORMAL) return false;\n\t\tif (mol.atomHExplicit(other) != Molecule.HEXPLICIT_UNKNOWN) return false;\n\t\tif (Molecule.HYVALENCE_EL.indexOf(mol.atomElement(other)) < 0) return false;\n\n\t\treturn true;\n\t}\n\n\t// looks through each atom's hydrogen count, and converts the number into actual hydrogen atoms, which are added\n\t// to the end of the atom list in the order encountered; returns the number of new atoms appended\n\t//\n\t// if the 'position' parameter is false, then hydrogens are simply added at their parents position (computationally\n\t// cheap); if true, a reasonable sketch layout method is used\n\tpublic static createHydrogens(mol:Molecule, position?:boolean):number\n\t{\n\t\tif (position == null) position = false;\n\n\t\tlet na = mol.numAtoms;\n\t\tfor (let n = 1; n <= na; n++)\n\t\t{\n\t\t\tlet hc = mol.atomHydrogens(n);\n\t\t\tif (hc == 0) continue;\n\t\t\tif (mol.atomHExplicit(n) != Molecule.HEXPLICIT_UNKNOWN) mol.setAtomHExplicit(n, 0);\n\n\t\t\tif (!position)\n\t\t\t{\n\t\t\t\tfor (; hc > 0; hc--)\n\t\t\t\t{\n\t\t\t\t\tlet a = mol.addAtom('H', mol.atomX(n), mol.atomY(n));\n\t\t\t\t\tmol.addBond(n, a, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse SketchUtil.placeAdditionalHydrogens(mol, n, hc);\n\t\t}\n\t\treturn mol.numAtoms - na;\n\t}\n\n\t// returns atom position as a 3D vector\n\tpublic static atomVec3(mol:Molecule, atom:number):number[]\n\t{\n\t\tif (mol.is3D())\n\t\t\treturn [mol.atomX(atom), mol.atomY(atom), mol.atomZ(atom)];\n\t\telse\n\t\t\treturn [mol.atomX(atom), mol.atomY(atom), 0];\n\t}\n\n\t// works out the oxidation state of a given atom; if it's a common main group with an ordinary valence, returns null to denote\n\t// that it's not worth mentioning; oxidation state is subject/has a grey area, e.g. double bonds from metals to most atoms are\n\t// counted as zero, but not for electronegative chalcogens\n\tpublic static atomOxidationState(mol:Molecule, atom:number):number\n\t{\n\t\tif (mol.atomAdjCount(atom) == 0) return null; // just not interesting if it's isolated\n\t\tif (this.hasAbbrev(mol, atom)) return null;\n\n\t\tlet atno = mol.atomicNumber(atom);\n\t\tif (atno == 0) return null;\n\t\tlet nonMetal = atno == Chemistry.ELEMENT_H || Chemistry.ELEMENT_BLOCKS[atno] == 2;\n\t\tlet oxstate = mol.atomHydrogens(atom) + (nonMetal ? -mol.atomCharge(atom) : mol.atomCharge(atom));\n\t\tfor (let b of mol.atomAdjBonds(atom))\n\t\t{\n\t\t\tlet bo = mol.bondOrder(b), other = mol.bondOther(b, atom);\n\t\t\tlet chalco = ['O', 'S', 'Se', 'Te'].includes(mol.atomElement(other));\n\t\t\tif (nonMetal || chalco) oxstate += bo; else oxstate += bo % 2;\n\t\t}\n\n\t\tif (atno == Chemistry.ELEMENT_H && oxstate == 1) return null;\n\t\tif (atno == Chemistry.ELEMENT_B && oxstate == 3) return null;\n\t\tif (atno == Chemistry.ELEMENT_C && oxstate == 4) return null;\n\t\tif (atno == Chemistry.ELEMENT_N && oxstate == 3) return null;\n\t\tif (atno == Chemistry.ELEMENT_O && oxstate == 2) return null;\n\t\tif (atno == Chemistry.ELEMENT_S && (oxstate == 2 || oxstate == 4 || oxstate == 6)) return null;\n\t\tif (atno == Chemistry.ELEMENT_P && (oxstate == 3 || oxstate == 5)) return null;\n\t\tif ((atno == Chemistry.ELEMENT_F || atno == Chemistry.ELEMENT_Cl ||\n\t\t\tatno == Chemistry.ELEMENT_Br || atno == Chemistry.ELEMENT_I) && oxstate == 1) return null;\n\n\t\treturn oxstate;\n\t}\n\tpublic static oxidationStateText(oxstate:number):string\n\t{\n\t\tif (oxstate == 0) return '0';\n\t\tlet str = oxstate < 0 ? '-' : '';\n\t\tlet absox = Math.abs(oxstate);\n\t\tif (absox == 1) str += 'I';\n\t\telse if (absox == 2) str += 'II';\n\t\telse if (absox == 3) str += 'III';\n\t\telse if (absox == 4) str += 'IV';\n\t\telse if (absox == 5) str += 'V';\n\t\telse if (absox == 6) str += 'VI';\n\t\telse if (absox == 7) str += 'VII';\n\t\telse if (absox == 8) str += 'VIII';\n\t\telse if (absox == 9) str += 'IX';\n\t\telse if (absox == 10) str += 'X';\n\t\telse if (absox == 11) str += 'XI';\n\t\telse if (absox == 12) str += 'XII';\n\t\telse str = (oxstate > 0 ? '+' : '') + oxstate;\n\t\treturn str;\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {angleDiff, angleNorm, DEGRAD, norm2_xy, TWOPI} from '../util/util';\nimport {Vec} from '../util/Vec';\nimport {Graph} from './Graph';\nimport {Molecule} from './Molecule';\nimport {MolUtil} from './MolUtil';\n\n/*\n\tLow level utility functions for the manipulation of molecular coordinates. These functions are fairly\n\tutilitarian, and don't have a lot of chemical logic encoded within them.\n\n\tDistinguished from SketchUtil in that these methods do not make chemistry-based \"value judgments\", they just\n\tstick to the numbers and do what they're told.\n*/\n\nexport class CoordUtil\n{\n\tpublic static OVERLAP_THRESHOLD = 0.2;// atoms closer than this are \"overlapping\" (i.e. this is bad)\n\tpublic static OVERLAP_THRESHOLD_SQ = CoordUtil.OVERLAP_THRESHOLD * CoordUtil.OVERLAP_THRESHOLD;\n\n\t// goes hunting for an atom close to the specified position; returns 0 if none\n\tpublic static atomAtPoint(mol:Molecule, x:number, y:number, tolerance?:number):number\n\t{\n\t\tif (tolerance == null) tolerance = CoordUtil.OVERLAP_THRESHOLD;\n\t\tconst tolsq = tolerance * tolerance;\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (norm2_xy(mol.atomX(n) - x, mol.atomY(n) - y) < tolsq) return n;\n\t\treturn 0;\n\t}\n\n\t// returns true of the two molecules are \"the same sketch\"; this means that for every atom in mol1, there is an atom in\n\t// mol2 at the same absolute (x,y) coordinate, with the exact same properties, and an equivalent bonding scheme; so basically\n\t// the atom and bond ordering can be different, but not much else\n\n\tprivate static DEFAULT_EQUIV_TOLERANCE = 0.2;\n\n\tpublic static sketchEquivalent(mol1:Molecule, mol2:Molecule, tolerance?:number):boolean\n\t{\n\t\tif (tolerance == null) tolerance = CoordUtil.DEFAULT_EQUIV_TOLERANCE;\n\n\t\tconst na = mol1.numAtoms, nb = mol1.numBonds;\n\t\tif (na != mol2.numAtoms || nb != mol2.numBonds) return false;\n\n\t\tconst tolsq = tolerance * tolerance;\n\n\t\t// an early-out scheme: if the min/max positions are different, we can bug out straight away; doesn't help when they've been\n\t\t// modified in the middle of the drawing, but it's a big gain\n\t\tlet box1 = mol1.boundary(), box2 = mol2.boundary();\n\t\tif (Math.abs(box1.minX() - box2.minX()) > tolerance) return false;\n\t\tif (Math.abs(box1.minY() - box2.minY()) > tolerance) return false;\n\t\tif (Math.abs(box1.maxX() - box2.maxX()) > tolerance) return false;\n\t\tif (Math.abs(box1.maxY() - box2.maxY()) > tolerance) return false;\n\n\t\tlet mx1 = MolUtil.arrayAtomX(mol1), my1 = MolUtil.arrayAtomY(mol1);\n\t\tlet mx2 = MolUtil.arrayAtomX(mol2), my2 = MolUtil.arrayAtomY(mol2);\n\n\t\t// find an atom mapping scheme based on proximity; any mapping failure results in early termination\n\t\t// NOTE: this is O(N^2); could be linearised by sorting by major/minor axis\n\t\tlet map = Vec.numberArray(0, na);\n\t\tlet mask = Vec.booleanArray(false, na);\n\n\t\tfor (let i = 0; i < na; i++)\n\t\t{\n\t\t\t// find the closest matching atom; start with a special trick: frequently the corresponding atom is at exactly the\n\t\t\t// same index (because of the types of operations which precede this method call); if it is real close, then just go with it\n\t\t\tlet j = -1;\n\t\t\tif (norm2_xy(mx1[i] - mx2[i], my1[i] - my2[i]) < tolsq) j = i;\n\n\t\t\t// if that didn't work, then scan through the unmatched possibilities\n\t\t\tif (j < 0)\n\t\t\t{\n\t\t\t\tlet bestdsq = Number.MAX_VALUE;\n\t\t\t\tfor (let n = 0; n < na; n++) if (!mask[n])\n\t\t\t\t{\n\t\t\t\t\tlet dsq = norm2_xy(mx1[i] - mx2[n], my1[i] - my2[n]);\n\t\t\t\t\tif (dsq < bestdsq) {bestdsq = dsq; j = n;}\n\t\t\t\t}\n\t\t\t\tif (j < 0 || bestdsq > tolsq) return false;\n\t\t\t}\n\n\t\t\tmap[i] = j + 1;\n\t\t\tmask[j] = true;\n\n\t\t\t// while we're here, make sure the atoms have the same properties\n\t\t\tif (mol1.atomElement(i + 1) != mol2.atomElement(j + 1)) return false;\n\t\t\tif (mol1.atomCharge(i + 1) != mol2.atomCharge(j + 1)) return false;\n\t\t\tif (mol1.atomUnpaired(i + 1) != mol2.atomUnpaired(j + 1)) return false;\n\t\t\tif (mol1.atomHExplicit(i + 1) != mol2.atomHExplicit(j + 1) &&\n\t\t\t\tmol1.atomHExplicit(i + 1) != Molecule.HEXPLICIT_UNKNOWN &&\n\t\t\t\tmol2.atomHExplicit(j + 1) != Molecule.HEXPLICIT_UNKNOWN) return false;\n\t\t}\n\n\t\t// now that we have the mapping, make sure the bonds are also equivalent\n\t\t// NOTE: this is O(N), because Molecule.findBond(..) is O(1)\n\t\tfor (let i = 1; i <= nb; i++)\n\t\t{\n\t\t\tlet i1 = mol1.bondFrom(i), i2 = mol1.bondTo(i), j1 = map[i1 - 1], j2 = map[i2 - 1];\n\t\t\tlet j = mol2.findBond(j1, j2);\n\n\t\t\tif (j == 0) return false;\n\n\t\t\tif (mol1.bondOrder(i) != mol2.bondOrder(j) || mol1.bondType(i) != mol2.bondType(j)) return false;\n\n\t\t\tif (mol2.bondFrom(j) == j1 && mol2.bondTo(j) == j2) {} // same\n\t\t\telse if (mol2.bondType(j) != Molecule.BONDTYPE_INCLINED &&\n\t\t\t\t\tmol2.bondType(j) != Molecule.BONDTYPE_DECLINED &&\n\t\t\t\t\tmol2.bondFrom(j) == j2 && mol2.bondTo(j) == j1) {} // reversed is OK\n\t\t\telse return false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t// similar to sketchEquivalent(..) above, except this version will translate the coordinates so that they overlay on top of\n\t// each other\n\t// NOTE: the overlay method is trivial; if the coordinates are collectively different enough to blow the tolerance unless\n\t// the overlay is jiggled around a bit, this method can return a false negative\n\tpublic static sketchMappable(mol1:Molecule, mol2:Molecule, tolerance?:number):boolean\n\t{\n\t\tif (tolerance == null) tolerance = CoordUtil.DEFAULT_EQUIV_TOLERANCE;\n\n\t\tlet box1 = mol1.boundary(), box2 = mol2.boundary();\n\t\tlet dx = box1.minX() - box2.minX(), dy = box1.minY() - box2.minY();\n\t\tif (Math.abs(dx) > tolerance * 0.1 || Math.abs(dy) > tolerance * 0.1)\n\t\t{\n\t\t\tmol2 = mol2.clone();\n\t\t\tfor (let n = 1; n <= mol2.numAtoms; n++) mol2.setAtomPos(n, mol2.atomX(n) + dx, mol2.atomY(n) + dy);\n\t\t}\n\n\t\treturn CoordUtil.sketchEquivalent(mol1, mol2, tolerance);\n\t}\n\n\t// returns a list of the angles of the bonds emanating from the given atom; the order of the angles returned is guaranteed to\n\t// correspond to the order found in mol.atomAdjList(N)\n\tpublic static atomBondAngles(mol:Molecule, atom:number, adj?:number[]):number[]\n\t{\n\t\tif (adj == null) adj = mol.atomAdjList(atom);\n\t\tlet bndang:number[] = [];\n\t\tlet cx = mol.atomX(atom), cy = mol.atomY(atom);\n\t\tfor (let a of adj) bndang.push(Math.atan2(mol.atomY(a) - cy, mol.atomX(a) - cx));\n\t\treturn bndang;\n\t}\n\n\t// returns true if the indicated position happens to be on top of an atom, within the given radial tolerance\n\tpublic static overlapsAtom(mol:Molecule, x:number, y:number, tol:number):boolean\n\t{\n\t\tconst tolsq = tol * tol;\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (norm2_xy(mol.atomX(n) - x, mol.atomY(n) - y) < tolsq) return true;\n\t\treturn false;\n\t}\n\n\t// returns a list of all the atoms which are considered to be \"overlapping\"; because this is O(N^2) and typically called during\n\t// screen updates, it is somewhat optimised\n\tpublic static overlappingAtomMask(mol:Molecule, thresh?:number):boolean[]\n\t{\n\t\tif (thresh == null) thresh = CoordUtil.OVERLAP_THRESHOLD;\n\n\t\tconst sz = mol.numAtoms;\n\t\tlet box = mol.boundary();\n\t\tlet p1:number[], p2:number[];\n\t\tif (box.w > box.h)\n\t\t{\n\t\t\tp1 = MolUtil.arrayAtomX(mol);\n\t\t\tp2 = MolUtil.arrayAtomY(mol);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tp1 = MolUtil.arrayAtomY(mol);\n\t\t\tp2 = MolUtil.arrayAtomX(mol);\n\t\t}\n\n\t\tlet omask = Vec.booleanArray(false, sz);\n\t\tlet idx = Vec.idxSort(p1);\n\t\tconst threshSQ = thresh * thresh;\n\t\tfor (let i = 1; i < sz - 1; i++)\n\t\t{\n\t\t\tfor (let j = i - 1; j >= 0; j--)\n\t\t\t{\n\t\t\t\tlet d1 = p1[idx[i]] - p1[idx[j]];\n\t\t\t\tif (d1 > thresh) break;\n\t\t\t\tif (norm2_xy(d1, p2[idx[i]] - p2[idx[j]]) < threshSQ) {omask[idx[i]] = true; omask[idx[j]] = true;}\n\t\t\t}\n\t\t\tfor (let j = i + 1; j < sz; j++)\n\t\t\t{\n\t\t\t\tlet d1 = p1[idx[j]] - p1[idx[i]];\n\t\t\t\tif (d1 > thresh) break;\n\t\t\t\tif (norm2_xy(d1, p2[idx[j]] - p2[idx[i]]) < threshSQ) {omask[idx[i]] = true; omask[idx[j]] = true;}\n\t\t\t}\n\t\t}\n\n\t\treturn omask;\n\t}\n\tpublic static overlappingAtomList(mol:Molecule, thresh?:number):number[]\n\t{\n\t\tif (thresh == null) thresh = CoordUtil.OVERLAP_THRESHOLD;\n\t\treturn Vec.add(Vec.maskIdx(CoordUtil.overlappingAtomMask(mol, thresh)), 1);\n\t}\n\n\t// for the given position, returns a measure of how congested it is, based on the sum of the reciprocal square of distances\n\t// to each of the atoms; the 'approach' parameter is the minimum distance, so 1/approach is hence the maximum score;\n\t// higher values mean more congested; approach should always be >0; lower numbers mean less congested\n\tpublic static congestionPoint(mol:Molecule, x:number, y:number, approach?:number):number\n\t{\n\t\tif (approach == null) approach = 1E-5;\n\t\tlet score = 0;\n\t\tlet na = mol.numAtoms;\n\t\tfor (let n = 1; n <= na; n++)\n\t\t\tscore += 1.0 / (approach + norm2_xy(mol.atomX(n) - x, mol.atomY(n) - y));\n\t\treturn score;\n\t}\n\n\t// returns congestion calculated for the whole molecule (or rather, sum(i,j) where i<j); 'approach' works like above;\n\t// higher values mean more congested\n\tpublic static congestionMolecule(mol:Molecule, approach?:number):number\n\t{\n\t\tif (approach == null) approach = 1E-5;\n\t\tlet score = 0;\n\t\tconst na = mol.numAtoms;\n\t\tlet mx = MolUtil.arrayAtomX(mol), my = MolUtil.arrayAtomY(mol);\n\t\tfor (let i = 0; i < na - 1; i++) for (let j = i + 1; j < na; j++)\n\t\t\tscore += 1.0 / (approach + norm2_xy(mx[i] - mx[j], my[i] - my[j]));\n\t\treturn score;\n\t}\n\n\t// translates all atoms in the molecule by the indicated amount\n\tpublic static translateMolecule(mol:Molecule, ox:number, oy:number):void\n\t{\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) mol.setAtomPos(n, mol.atomX(n) + ox, mol.atomY(n) + oy);\n\t}\n\n\t// rotates the molecule about geographic centre\n\tpublic static rotateMolecule(mol:Molecule, theta:number, cx?:number, cy?:number):void\n\t{\n\t\tif (cx == null || cy == null)\n\t\t{\n\t\t\tlet box = mol.boundary();\n\t\t\tcx = box.midX();\n\t\t\tcy = box.midY();\n\t\t}\n\n\t\tlet cosTheta = Math.cos(theta), sinTheta = Math.sin(theta);\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t{\n\t\t\tlet x = mol.atomX(n) - cx, y = mol.atomY(n) - cy;\n\t\t\tmol.setAtomPos(n, cx + x * cosTheta - y * sinTheta, cy + x * sinTheta + y * cosTheta);\n\t\t}\n\t}\n\n\t// with atom C as the central point, rotates the substituent\n\tpublic static rotateBond(mol:Molecule, centre:number, atom:number, theta:number):void\n\t{\n\t\ttheta = angleNorm(theta);\n\t\tif (Math.abs(theta) < 0.1 * DEGRAD) return;\n\n\t\tlet g = Graph.fromMolecule(mol);\n\t\tg.isolateNode(centre - 1);\n\t\tlet cc = g.calculateComponents();\n\n\t\tlet cx = mol.atomX(centre), cy = mol.atomY(centre);\n\t\tlet cosTheta = Math.cos(theta), sinTheta = Math.sin(theta);\n\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (cc[n - 1] == cc[atom - 1])\n\t\t{\n\t\t\tlet x = mol.atomX(n) - cx, y = mol.atomY(n) - cy;\n\t\t\tmol.setAtomPos(n, cx + x * cosTheta - y * sinTheta, cy + x * sinTheta + y * cosTheta);\n\t\t}\n\t}\n\n\t// rotates only the atoms specified by the mask, by theta about the central point (cx,cy)\n\tpublic static rotateAtoms(mol:Molecule, mask:boolean[], cx:number, cy:number, theta:number):void\n\t{\n\t\tlet cosTheta = Math.cos(theta), sinTheta = Math.sin(theta);\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (mask[n - 1])\n\t\t{\n\t\t\tlet x = mol.atomX(n) - cx, y = mol.atomY(n) - cy;\n\t\t\tmol.setAtomPos(n, cx + x * cosTheta - y * sinTheta, cy + x * sinTheta + y * cosTheta);\n\t\t}\n\t}\n\n\t// considers the adjacency list for an atom, and returns a form of the list in a sequence suitable for representing interior\n\t// angles; null means no angles; for those with two neighbours, returns them ordered such that ang(1)..ang(2) is the\n\t// interior angle; if 3 or more neighbours, orders them so that ang(N)..ang(N+1) has no other angles _between_ them\n\tpublic static angleNeighbours(mol:Molecule, atom:number):number[]\n\t{\n\t\tlet adj = mol.atomAdjList(atom);\n\t\tif (adj.length <= 1) return null;\n\t\tlet th:number[] = [];\n\t\tfor (let n = 0; n < adj.length; n++) th.push(Math.atan2(mol.atomY(adj[n]) - mol.atomY(atom), mol.atomX(adj[n]) - mol.atomX(atom)));\n\n\t\tif (adj.length == 2)\n\t\t{\n\t\t\tif (angleDiff(th[1], th[0]) > 0) return adj;\n\t\t\treturn [adj[1], adj[0]];\n\t\t}\n\n\t\tlet idx = Vec.idxSort(th);\n\t\treturn Vec.idxGet(adj, idx);\n\t}\n\n\t// assimilates two atoms together; the \"old\" atom has its bonds reassigned to the \"new\" atom, then gets deleted\n\tpublic static mergeAtoms(mol:Molecule, oldN:number, newN:number):void\n\t{\n\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t{\n\t\t\tif (mol.bondFrom(n) == oldN) mol.setBondFrom(n, newN);\n\t\t\tif (mol.bondTo(n) == oldN) mol.setBondTo(n, newN);\n\t\t}\n\t\tmol.deleteAtomAndBonds(oldN);\n\t}\n\n\t// runs through the molecule to see if the median bond distance is reasonably close to the ideal bond length, and if so, leaves\n\t// it alone; if not, everything gets rescaled; this is particularly useful when importing, because not all formats use quasi-\n\t// realistic Angstrom-like units\n\tpublic static normaliseBondDistances(mol:Molecule):void\n\t{\n\t\tconst nb = mol.numBonds;\n\t\tif (nb == 0) return;\n\n\t\tlet dsq:number[] = [];\n\t\tfor (let n = 1; n <= nb; n++)\n\t\t{\n\t\t\tlet bfr = mol.bondFrom(n), bto = mol.bondTo(n);\n\t\t\tdsq.push(norm2_xy(mol.atomX(bto) - mol.atomX(bfr), mol.atomY(bto) - mol.atomY(bfr)));\n\t\t}\n\t\tVec.sort(dsq);\n\t\tlet median = (nb & 1) == 1 ? Math.sqrt(dsq[nb >> 1]) : 0.5 * (Math.sqrt(dsq[nb >> 1]) + Math.sqrt(dsq[(nb >> 1) - 1]));\n\t\tif (median < 0.1 || (median > Molecule.IDEALBOND * 0.9 && median < Molecule.IDEALBOND * 1.1)) return;\n\n\t\tlet box = mol.boundary();\n\t\tlet cx = box.midX(), cy = box.midY();\n\t\tlet scale = Molecule.IDEALBOND / median;\n\t\tfor (let n = mol.numAtoms; n >= 1; n--)\n\t\t{\n\t\t\tlet x = (mol.atomX(n) - cx) * scale + cx;\n\t\t\tlet y = (mol.atomY(n) - cy) * scale + cy;\n\t\t\tmol.setAtomPos(n, x, y);\n\t\t}\n\t}\n\n\t// recalibrates the molecule so that the coordinates are somewhere near the origin\n\tpublic static centreMolecule(mol:Molecule):void\n\t{\n\t\tif (MolUtil.isBlank(mol)) return;\n\t\t\n\t\tlet x = MolUtil.arrayAtomX(mol), y = MolUtil.arrayAtomY(mol);\n\t\tlet sz = x.length;\n\t\tlet invsz = 1.0 / sz;\n\t\tlet meanX = Vec.sum(x) * invsz, meanY = Vec.sum(y) * invsz;\n\t\tlet closest = Number.POSITIVE_INFINITY;\n\t\tlet deltaX = 0, deltaY = 0;\n\t\tfor (let n = 0; n < sz; n++)\n\t\t{\n\t\t\tlet dsq = norm2_xy(x[n] - meanX, y[n] - meanY);\n\t\t\tif (dsq < closest)\n\t\t\t{\n\t\t\t\tdeltaX = -x[n];\n\t\t\t\tdeltaY = -y[n];\n\t\t\t\tclosest = dsq;\n\t\t\t}\n\t\t}\n\t\tfor (let n = 0; n < sz; n++) mol.setAtomPos(n + 1, x[n] + deltaX, y[n] + deltaY);\n\t}\n\n\t// returns an inverted version of the molecule, by switching one axis (X); if there are any inclined/declined bonds, they are\n\t// also inverted\n\tpublic static mirrorImage(mol:Molecule):Molecule\n\t{\n\t\tmol = mol.clone();\n\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) mol.setAtomX(n, -mol.atomX(n));\n\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t{\n\t\t\tif (mol.bondType(n) == Molecule.BONDTYPE_DECLINED) mol.setBondType(n, Molecule.BONDTYPE_INCLINED);\n\t\t\telse if (mol.bondType(n) == Molecule.BONDTYPE_INCLINED) mol.setBondType(n, Molecule.BONDTYPE_DECLINED);\n\t\t}\n\n\t\treturn mol;\n\t}\n\n\t// given two molecules (mol1,mol2), and a mapping between them, performs a specialised superimposition: the first\n\t// index:index mapping is the translation reference point, so mol2 is moved; then a rotation/flip operation is determined,\n\t// based on the directional orientation of the remaining mapping substituents; if the molecule is flipped, the wedge bonds\n\t// will all be inverted\n\t// NOTE: the mol2 parameter is modified, and contains the results of the operation\n\tpublic static alignOrientFlip(mol1:Molecule, idx1:number[], mol2:Molecule, idx2:number[]):void\n\t{\n\t\tif (idx1.length < 2 || idx1.length != idx2.length) throw 'Invalid mapping indices.';\n\n\t\tlet x0 = mol1.atomX(idx1[0]), y0 = mol1.atomY(idx1[0]);\n\n\t\tCoordUtil.translateMolecule(mol2, x0 - mol2.atomX(idx2[0]), y0 - mol2.atomY(idx2[0]));\n\t\tconst sz = idx1.length - 1;\n\n\t\tlet th1:number[] = [], th2:number[] = [];\n\t\tlet deltaA = 0, deltaB = 0;\n\t\tfor (let n = 0; n < sz; n++)\n\t\t{\n\t\t\tth1.push(Math.atan2(mol1.atomY(idx1[n + 1]) - y0, mol1.atomX(idx1[n + 1]) - x0));\n\t\t\tth2.push(Math.atan2(mol2.atomY(idx2[n + 1]) - y0, mol2.atomX(idx2[n + 1]) - x0));\n\t\t\tlet dthA = angleDiff(th1[n], th2[n]), dthB = angleDiff(th1[n], -th2[n]);\n\n\t\t\t// correction to avoid cancellation, e.g. (180-180) === (180+180)\n\t\t\tif (dthA < -175 * DEGRAD && deltaA > 0) dthA += TWOPI;\n\t\t\telse if (dthA > 175 * DEGRAD && deltaA < 0) dthA -= TWOPI;\n\t\t\tif (dthB < -175 * DEGRAD && deltaB > 0) dthB += TWOPI;\n\t\t\telse if (dthB > 175 * DEGRAD && deltaB < 0) dthB -= TWOPI;\n\n\t\t\tdeltaA += dthA;\n\t\t\tdeltaB += dthB;\n\t\t}\n\t\tif (sz > 1) {let inv = 1.0 / sz; deltaA *= inv; deltaB *= inv;}\n\t\tlet scoreA = 0, scoreB = 0;\n\t\tfor (let n = 0; n < sz; n++)\n\t\t{\n\t\t\tscoreA += Math.abs(angleDiff(th1[n], th2[n] + deltaA));\n\t\t\tscoreB += Math.abs(angleDiff(th1[n], -th2[n] + deltaB));\n\t\t}\n\t\tif (scoreB < scoreA)\n\t\t{\n\t\t\tfor (let n = 1; n <= mol2.numAtoms; n++) mol2.setAtomY(n, 2 * y0 - mol2.atomY(n));\n\t\t\tfor (let n = 1; n <= mol2.numBonds; n++)\n\t\t\t{\n\t\t\t\tif (mol2.bondType(n) == Molecule.BONDTYPE_DECLINED) mol2.setBondType(n, Molecule.BONDTYPE_INCLINED);\n\t\t\t\telse if (mol2.bondType(n) == Molecule.BONDTYPE_INCLINED) mol2.setBondType(n, Molecule.BONDTYPE_DECLINED);\n\t\t\t}\n\t\t\tCoordUtil.rotateMolecule(mol2, x0, y0, deltaB);\n\t\t}\n\t\telse CoordUtil.rotateMolecule(mol2, x0, y0, deltaA);\n\t}\n\n\t// returns true if the atom has two neighbours at almost 180 degree separation, such that it is a bit on the unusual side, and\n\t// should have its carbon atoms drawn explicitly\n\tpublic static atomIsWeirdLinear(mol:Molecule, idx:number):boolean\n\t{\n\t\tlet bonds = mol.atomAdjBonds(idx);\n\t\tif (bonds.length != 2) return false;\n\t\tfor (let n = 0; n < bonds.length; n++) if (mol.bondOrder(bonds[n]) == 3) return false; // triple bonds don't trigger this\n\n\t\tlet adj = mol.atomAdjList(idx);\n\t\tlet th1 = Math.atan2(mol.atomY(adj[0]) - mol.atomY(idx), mol.atomX(adj[0]) - mol.atomX(idx));\n\t\tlet th2 = Math.atan2(mol.atomY(adj[1]) - mol.atomY(idx), mol.atomX(adj[1]) - mol.atomX(idx));\n\t\treturn Math.abs(angleDiff(th1, th2)) >= 175 * DEGRAD;\n\t}\n}\n\n","/*\n\tWebMolKit\n\n\t(c) 2010-2022 Molecular Materials Informatics, Inc.\n\n\tAll rights reserved\n\n\thttp://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Vec} from '../util/Vec';\nimport {Molecule} from './Molecule';\n\n/*\n\tEncodes some number of stereochemistry groups into the molecule.\n\n\tTypes:\n\t\tRacemic (\"AND\"): for chiral centres in the group, the configuration indicated by the wedges is present _and_ its\n\t\t\t\t\t\t inverted racemic opposite is inverted as well (e.g. [R,R,S] & [S,S,R], but not any of the other\n\t\t\t\t\t\t six combinations)\n\t\tRelative (\"OR\"): for chiral centres in the group, there is just one configuration present, and it is either the\n\t\t\t\t\t\t configuration indicated _or_ its inversion (e.g. just one of [R,R,S] or [S,S,R])\n\n\tAny tools that ignore this stereo group metadata will just see that there's a particular configuration indicated and\n\tinterpret that as what it is.\n*/\n\nexport const STEREOGROUP_EXTRA_RACEMIC = 'xCHIRAC:'; // racemic (often rendered as \"and\")\nexport const STEREOGROUP_EXTRA_RELATIVE = 'xCHIREL:'; // relative (often rendered as \"or\")\n\nexport class StereoGroup\n{\n\tprivate chiRac = new Map<number, number[]>();\n\tprivate chiRel = new Map<number, number[]>();\n\n\t// ------------ public methods ------------\n\n\t// useful pre-check to see if a molecule has any stereogroup metadata\n\tpublic static hasStereoGroups(mol:Molecule):boolean\n\t{\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t{\n\t\t\tlet extra = mol.atomExtra(n);\n\t\t\tif (extra != null) for (let str of extra) if (str.startsWith(STEREOGROUP_EXTRA_RACEMIC) || str.startsWith(STEREOGROUP_EXTRA_RELATIVE)) return true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic constructor(private mol:Molecule)\n\t{\n\t\tthis.mol = mol;\n\n\t\t// pull out the raw content from the molecule's extra fields\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t{\n\t\t\tlet extra = mol.atomExtra(n);\n\t\t\tif (extra != null) for (let str of extra)\n\t\t\t{\n\t\t\t\tif (str.startsWith(STEREOGROUP_EXTRA_RACEMIC))\n\t\t\t\t{\n\t\t\t\t\tlet grp = parseInt(str.substring(STEREOGROUP_EXTRA_RACEMIC.length));\n\t\t\t\t\tif (grp > 0) this.chiRac.set(grp, Vec.append(this.chiRac.get(grp), n));\n\t\t\t\t}\n\t\t\t\telse if (str.startsWith(STEREOGROUP_EXTRA_RELATIVE))\n\t\t\t\t{\n\t\t\t\t\tlet grp = parseInt(str.substring(STEREOGROUP_EXTRA_RELATIVE.length));\n\t\t\t\t\tif (grp > 0) this.chiRel.set(grp, Vec.append(this.chiRel.get(grp), n));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// clean each one up, or remove if invalid\n\t\tfor (let [grp, atoms] of this.chiRac.entries())\n\t\t{\n\t\t\tfor (let n = atoms.length - 1; n >= 0; n--) if (!this.atomHasWedge(atoms[n])) atoms.splice(n, 1);\n\t\t\tif (atoms.length > 0) this.chiRac.set(grp, atoms); else this.chiRac.delete(grp);\n\t\t}\n\t\tfor (let [grp, atoms] of this.chiRel.entries())\n\t\t{\n\t\t\tfor (let n = atoms.length - 1; n >= 0; n--) if (!this.atomHasWedge(atoms[n])) atoms.splice(n, 1);\n\t\t\tif (atoms.length > 0) this.chiRel.set(grp, atoms); else this.chiRel.delete(grp);\n\t\t}\n\t}\n\n\t// access to resulting content\n\tpublic getRacemicGroups():number[] {return Array.from(this.chiRac.keys());}\n\tpublic getRelativeGroups():number[] {return Array.from(this.chiRel.keys());}\n\tpublic getRacemicAtoms():number[][] {return Array.from(this.chiRac.values());}\n\tpublic getRelativeAtoms():number[][] {return Array.from(this.chiRel.values());}\n\tpublic getRacemicGroupAtoms(grp:number):number[] {return this.chiRac.get(grp);}\n\tpublic getRelativeGroupAtoms(grp:number):number[] {return this.chiRel.get(grp);}\n\n\t// replaces all artifact signifiers with those from the current list of content\n\tpublic rewriteMolecule():void\n\t{\n\t\t// delete everything\n\t\tfor (let n = 1; n <= this.mol.numAtoms; n++)\n\t\t{\n\t\t\tlet extra = this.mol.atomExtra(n);\n\t\t\tlet modified = false;\n\t\t\tfor (let i = extra.length - 1; i >= 0; i--)\n\t\t\t{\n\t\t\t\tif (extra[i].startsWith(STEREOGROUP_EXTRA_RACEMIC) || extra[i].startsWith(STEREOGROUP_EXTRA_RELATIVE))\n\t\t\t\t{\n\t\t\t\t\textra.splice(i, 1);\n\t\t\t\t\tmodified = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (modified) this.mol.setAtomExtra(n, extra);\n\t\t}\n\n\t\t// write back our datastructures\n\t\tfor (let [grp, atoms] of this.chiRac.entries())\n\t\t{\n\t\t\tfor (let a of atoms) this.mol.setAtomExtra(a, [...this.mol.atomExtra(a), STEREOGROUP_EXTRA_RACEMIC + grp]);\n\t\t}\n\t\tfor (let [grp, atoms] of this.chiRel.entries())\n\t\t{\n\t\t\tfor (let a of atoms) this.mol.setAtomExtra(a, [...this.mol.atomExtra(a), STEREOGROUP_EXTRA_RELATIVE + grp]);\n\t\t}\n\t}\n\n\t// given the numbering system used by artifacts in another object, make sure that the current ones are renumbered so that they don't clash\n\tpublic harmoniseNumbering(other:StereoGroup):void\n\t{\n\t\tlet groups = other.getRacemicGroups();\n\t\tlet stash = this.getRacemicAtoms();\n\t\tthis.chiRac.clear();\n\t\tfor (let atoms of stash)\n\t\t{\n\t\t\tlet grp = this.nextIdentifier(groups);\n\t\t\tthis.chiRac.set(grp, atoms);\n\t\t\tgroups.push(grp);\n\t\t}\n\n\t\tgroups = other.getRelativeGroups();\n\t\tstash = this.getRelativeAtoms();\n\t\tthis.chiRel.clear();\n\t\tfor (let atoms of stash)\n\t\t{\n\t\t\tlet grp = this.nextIdentifier(groups);\n\t\t\tthis.chiRel.set(grp, atoms);\n\t\t\tgroups.push(grp);\n\t\t}\n\t}\n\n\t// creates a racemic group, returns the new identifier\n\tpublic createRacemic(atoms:number[]):number\n\t{\n\t\tlet grp = this.nextIdentifier(this.getRacemicGroups());\n\t\tthis.chiRac.set(grp, atoms);\n\t\treturn grp;\n\t}\n\n\t// creates a relative group, returns the new identifier\n\tpublic createRelative(atoms:number[]):number\n\t{\n\t\tlet grp = this.nextIdentifier(this.getRelativeGroups());\n\t\tthis.chiRel.set(grp, atoms);\n\t\treturn grp;\n\t}\n\n\tpublic removeRacemic(grp:number):void\n\t{\n\t\tthis.chiRac.delete(grp);\n\t}\n\tpublic removeRelative(grp:number):void\n\t{\n\t\tthis.chiRel.delete(grp);\n\t}\n\n\t// quickly strip out all bond artifacts\n\tpublic static removeAll(mol:Molecule):void\n\t{\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t{\n\t\t\tlet extra = mol.atomExtra(n);\n\t\t\tlet modified = false;\n\t\t\tfor (let i = extra.length - 1; i >= 0; i--)\n\t\t\t{\n\t\t\t\tif (!extra[i].startsWith(STEREOGROUP_EXTRA_RACEMIC) && !extra[i].startsWith(STEREOGROUP_EXTRA_RELATIVE)) continue;\n\t\t\t\textra.splice(i, 1);\n\t\t\t\tmodified = true;\n\t\t\t}\n\t\t\tif (modified) mol.setAtomExtra(n, extra);\n\t\t}\n\t}\n\n\t// ------------ private methods ------------\n\n\t// if false, the atom definitely can't be an R/S tetrahedral chiral centre\n\tprivate atomHasWedge(atom:number):boolean\n\t{\n\t\tif (this.mol.is3D()) return true;\n\n\t\t// must have at least one wedge originating from the atom, and no squigglies\n\t\tlet hasWedge = false;\n\t\tfor (let b of this.mol.atomAdjBonds(atom))\n\t\t{\n\t\t\tlet bt = this.mol.bondType(b);\n\t\t\tif (bt == Molecule.BONDTYPE_UNKNOWN) return false; // squiggly\n\t\t\tif (this.mol.bondFrom(b) != atom) continue;\n\t\t\tif (bt == Molecule.BONDTYPE_INCLINED || bt == Molecule.BONDTYPE_DECLINED) hasWedge = true;\n\t\t}\n\t\treturn hasWedge;\n\t}\n\n\t// using a disposable array, finds the next suitable identifier given that some number may already been taken\n\tprivate nextIdentifier(inkeys:number[]):number\n\t{\n\t\tif (inkeys.length == 0) return 1;\n\t\tlet keys = Vec.sorted(inkeys);\n\t\tfor (let n = 0; n < keys.length - 1; n++) if (keys[n + 1] != keys[n] + 1) return keys[n] + 1;\n\t\treturn keys[keys.length - 1] + 1;\n\t}\n}\n\n","/*\n\tWebMolKit\n\n\t(c) 2010-2024 Molecular Materials Informatics, Inc.\n\n\tAll rights reserved\n\n\thttp://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {ResonanceRemover} from '../calc/ResonanceRemover';\nimport {Vec} from '../util/Vec';\nimport {BondArtifact} from './BondArtifact';\nimport {CoordUtil} from './CoordUtil';\nimport {DataSheet, DataSheetColumn} from './DataSheet';\nimport {ForeignMolecule, ForeignMoleculeTemplateDefn, ForeignMoleculeTransient} from './ForeignMolecule';\nimport {Molecule} from './Molecule';\nimport {MolUtil} from './MolUtil';\nimport {PolymerBlock, PolymerBlockConnectivity, PolymerBlockUnit} from './PolymerBlock';\nimport {QueryUtil} from './QueryUtil';\nimport {StereoGroup} from './StereoGroup';\n\n/* eslint-disable key-spacing */\n\n/*\n\tMDL Molfile reader: a somewhat flexible input parser that can turn V2000 and V3000 Molfiles into the internal molecule\n\trepresentation. The molfile format has several official variants, and a much larger number of mutant strains that\n\texist in the wild: mileage may vary. If the structure is unreadable, an exception will be thrown. For information on\n\tanything interesting that happened during the parsing process, consult the \"openmol\" member.\n\n\tMDL SDfile reader: doing the best it can to pull out the auxiliary fields in SDfiles, which can be abused in endless ways,\n\tbut one does one's best to deal with it.\n*/\n\n// valence options used by MDL/CTAB, which is much more promiscuous than the internal format\nexport const MDLMOL_VALENCE:Record<string, number[]> =\n{\n\t'H':  [1],\n\t'B':  [3],\n\t'C':  [4],\n\t'Si': [4],\n\t'N':  [3],\n\t'P':  [3, 5],\n\t'As': [3, 5],\n\t'O':  [2],\n\t'S':  [2, 4, 6],\n\t'Se': [2, 4, 6],\n\t'Te': [2, 4, 6],\n\t'F':  [1],\n\t'Cl': [1, 3, 5, 7],\n\t'Br': [1],\n\t'I':  [1, 3, 5, 7],\n\t'At': [1, 3, 5, 7],\n};\n\nexport interface MDLReaderLinkNode\n{\n\tatom:number;\n\tnbrs:number[];\n\tminRep:number;\n\tmaxRep:number;\n}\n\nexport interface MDLReaderGroupMixture\n{\n\tindex:number;\n\tparent:number;\n\ttype:string;\n\tatoms:number[];\n}\n\nexport interface MDLReaderSuperAtom\n{\n\tatoms:number[];\n\tname:string;\n\n\t// for polymers\n\tbracketType?:string;\n\tconnectType?:string;\n\tbonds?:number[];\n\tbondConn?:number[];\n\n\t// data groups\n\tvalue?:string;\n\tunit?:string;\n\tquery?:string;\n\n\t// for SCSR templates\n\ttemplateClass?:string;\n\tnatReplace?:string;\n\tattachPoints?:string[];\n}\n\nexport class MDLMOLReader\n{\n\t// options\n\tpublic parseHeader = true; // if on, the first 3 lines are the pre-ctab header\n\tpublic parseExtended = true; // if on, extended fields are parsed; otherwise legacy MDL\n\tpublic allowV3000 = true; // if on, will diverge to a separate track for V3000\n\tpublic considerRescale = true; // if on, bond lengths will be rescaled if they are funky\n\tpublic keepAromatic = false; // set this to retain \"type 4\" bonds and other queries, instead of de-rezzing\n\tpublic keepParity = false; // set this to bring in the \"parity\" labels for atoms\n\tpublic keepQuery = true; // set this to translate query-type properties into the native equivalent\n\n\t// deliverables\n\tpublic mol:Molecule = null; // the result (or partial result, if not successful)\n\tpublic molName = ''; // molecule name from the header, if any\n\tpublic overallStereoAbsolute = true; // from the counts block, overall true=interpret stereo as absolute; false=interpret as relative\n\n\t// hydrogen count & resonance bonds supposed to be query-only, but some software abuses them to get around the structural limitations\n\tpublic resBonds:boolean[] = null;\n\n\t// \"modern\" features of CTAB which are not part of the lowest common denominator\n\tpublic groupAttachAny = new Map<number, number[]>(); // bond -> list of atom indices\n\tpublic groupAttachAll = new Map<number, number[]>(); // ditto\n\tpublic groupStereoAbsolute:number[] = []; // atom centres that have absolute stereochemistry\n\tpublic groupStereoRacemic:number[][] = []; // blocks of atoms which are racemic\n\tpublic groupStereoRelative:number[][] = []; // blocks of atoms which exist in their drawn configuration OR the opposite\n\tpublic groupLinkNodes:MDLReaderLinkNode[] = []; // so-called link nodes, aka repeating atom\n\tpublic groupMixtures:MDLReaderGroupMixture[] = []; // mixture collections, which may overlap\n\tpublic scsrTemplates:ForeignMoleculeTemplateDefn[] = null; // templates (SCSR = self-contained sequence representation)\n\n\tprivate pos = 0;\n\tprivate lines:string[];\n\n\t// ----------------- public methods -----------------\n\n\tconstructor(strData:string)\n\t{\n\t\tthis.lines = strData.split(/\\r?\\n/);\n\t}\n\n\t// perform the parsing operation, and populate the result fields\n\tpublic parse():Molecule\n\t{\n\t\tif (this.parseHeader)\n\t\t{\n\t\t\tthis.molName = this.lines[0];\n\t\t\tthis.pos = 3;\n\t\t}\n\t\tthis.parseCTAB();\n\t\treturn this.mol;\n\t}\n\n\t// ----------------- private methods -----------------\n\n\tprivate nextLine():string\n\t{\n\t\tif (this.pos >= this.lines.length) throw 'MDL Molfile parser: premature end, at line ' + (this.pos + 1);\n\t\treturn this.lines[this.pos++];\n\t}\n\n\t// pull out the main CTAB block: this is where the real action is\n\tprivate parseCTAB():void\n\t{\n\t\tthis.mol = new Molecule();\n\t\tthis.mol.keepTransient = true;\n\n\t\t// check out the counts line\n\t\tlet line = this.nextLine();\n\t\tlet version = line.length >= 39 ? line.substring(34, 39) : '';\n\t\tif (this.allowV3000 && version == 'V3000')\n\t\t{\n\t\t\tthis.parseV3000();\n\t\t\tthis.mol.keepTransient = false;\n\t\t\treturn;\n\t\t}\n\t\tif (version != 'V2000') throw 'Invalid MDL MOL: no Vx000 tag.';\n\n\t\tlet numAtoms = parseInt(line.substring(0, 3).trim());\n\t\tlet numBonds = parseInt(line.substring(3, 6).trim());\n\t\tif (line.length >= 15) this.overallStereoAbsolute = parseInt(line.substring(12, 15).trim()) == 1;\n\n\t\t// read out each atom\n\t\tfor (let n = 0; n < numAtoms; n++)\n\t\t{\n\t\t\tline = this.nextLine();\n\t\t\tif (line.length < 34) throw 'Invalid MDL MOL: atom line' + (n + 1);\n\n\t\t\tlet x = parseFloat(line.substring(0, 10).trim());\n\t\t\tlet y = parseFloat(line.substring(10, 20).trim());\n\t\t\tlet z = parseFloat(line.substring(20, 30).trim());\n\t\t\tlet el = line.substring(31, 34).trim();\n\t\t\tlet chg = line.length < 39 ? 0 : parseInt(line.substring(36, 39).trim()), rad = 0;\n\t\t\tlet stereo = line.length < 42 ? 0 : parseInt(line.substring(39, 42).trim());\n\t\t\tlet hyd = line.length < 45 ? 0 : parseInt(line.substring(42, 45).trim());\n\t\t\tlet val = line.length < 51 ? 0 : parseInt(line.substring(48, 51).trim());\n\t\t\tlet mapnum = line.length < 63 ? 0 : parseInt(line.substring(60, 63).trim());\n\n\t\t\tif (chg >= 1 && chg <= 3) chg = 4 - chg;\n\t\t\telse if (chg == 4) {chg = 0; rad = 2;}\n\t\t\telse if (chg >= 5 && chg <= 7) chg = 4 - chg;\n\t\t\telse chg = 0;\n\n\t\t\tlet a = this.mol.addAtom(el, x, y, chg, rad);\n\t\t\tif (z != 0)\n\t\t\t{\n\t\t\t\tthis.mol.setAtomZ(a, z);\n\t\t\t\tthis.mol.setIs3D(true);\n\t\t\t}\n\t\t\tthis.mol.setAtomMapNum(a, mapnum);\n\n\t\t\tif (hyd > 0) QueryUtil.setQueryAtomHydrogens(this.mol, a, [hyd - 1]);\n\n\t\t\tif (stereo > 0 && this.keepParity)\n\t\t\t{\n\t\t\t\tlet trans = this.mol.atomTransient(a);\n\t\t\t\tif (stereo == 1) this.mol.setAtomTransient(a, Vec.append(trans, ForeignMoleculeTransient.AtomChiralMDLOdd));\n\t\t\t\telse if (stereo == 2) this.mol.setAtomTransient(a, Vec.append(trans, ForeignMoleculeTransient.AtomChiralMDLEven));\n\t\t\t\telse if (stereo == 3) this.mol.setAtomTransient(a, Vec.append(trans, ForeignMoleculeTransient.AtomChiralMDLRacemic));\n\t\t\t}\n\n\t\t\tif (val != 0) ForeignMolecule.markExplicitValence(this.mol, n + 1, val > 14 ? 0 : val);\n\t\t}\n\n\t\t// read out each bond\n\t\tfor (let n = 0; n < numBonds; n++)\n\t\t{\n\t\t\tline = this.nextLine();\n\t\t\tif (line.length >= 9 && line.length < 12) line = line.substring(0, 9) + '  0';\n\t\t\tif (line.length < 12) throw 'Invalid MDL MOL: bond line' + (n + 1);\n\n\t\t\tlet bfr = parseInt(line.substring(0, 3).trim()), bto = parseInt(line.substring(3, 6).trim());\n\t\t\tlet type = parseInt(line.substring(6, 9).trim()), stereo = parseInt(line.substring(9, 12).trim());\n\n\t\t\tif (bfr == bto || bfr < 1 || bfr > numAtoms || bto < 1 || bto > numAtoms) throw 'Invalid MDL MOL: bond line' + (n + 1);\n\n\t\t\tlet order = type >= 1 && type <= 3 ? type : type == 8 || type == 9 || type == 10 ? 0 : 1;\n\t\t\tlet style = Molecule.BONDTYPE_NORMAL;\n\t\t\tif (stereo == 1) style = Molecule.BONDTYPE_INCLINED;\n\t\t\telse if (stereo == 6) style = Molecule.BONDTYPE_DECLINED;\n\t\t\telse if (stereo == 3 || stereo == 4) style = Molecule.BONDTYPE_UNKNOWN;\n\n\t\t\tlet b = this.mol.addBond(bfr, bto, order, style);\n\t\t\tif (type == 9) this.mol.appendBondTransient(b, ForeignMoleculeTransient.BondZeroDative);\n\t\t\tif (type == 9) this.mol.appendBondTransient(b, ForeignMoleculeTransient.BondZeroHydrogen);\n\n\t\t\tif (this.keepQuery)\n\t\t\t{\n\t\t\t\tif (type == 4) QueryUtil.setQueryBondOrders(this.mol, b, [-1]); // aromatic query type\n\t\t\t\telse if (type == 5) QueryUtil.setQueryBondOrders(this.mol, b, [1, 2]); // single-or-double query type\n\t\t\t\telse if (type == 6) QueryUtil.setQueryBondOrders(this.mol, b, [-1, 1]); // single-or-aromatic query type\n\t\t\t\telse if (type == 7) QueryUtil.setQueryBondOrders(this.mol, b, [-1, 2]); // double-or-aromatic query type\n\t\t\t\telse if (type == 8) QueryUtil.setQueryBondOrders(this.mol, b, [-1, 0, 1, 2, 3]); // any\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// type \"4\" is special: it is defined to be a special query type to match aromatic bonds, but it is sometimes used\n\t\t\t\t// to store actual molecules; in this case, it is necessary to either \"deresonate\" the rings, or to stash the property\n\t\t\t\tif (type == 4)\n\t\t\t\t{\n\t\t\t\t\tif (this.keepAromatic) this.mol.setBondTransient(b, Vec.append(this.mol.bondTransient(b), ForeignMoleculeTransient.BondAromatic));\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.resBonds == null) this.resBonds = Vec.booleanArray(false, numBonds);\n\t\t\t\t\t\tthis.resBonds[n] = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// examine anything in the M-block\n\t\tconst MBLK_CHG = 1, MBLK_RAD = 2, MBLK_ISO = 3, MBLK_RGP = 4, MBLK_HYD = 5, MBLK_ZCH = 6, MBLK_ZBO = 7,\n\t\t\t  MBLK_ZPA = 8, MBLK_ZRI = 9, MBLK_ZAR = 10, MBLK_RBC = 11, MBLK_SUB = 12, MBLK_UNS = 13;\n\t\tlet resPaths = new Map<number, number[]>(), resRings = new Map<number, number[]>(), arenes = new Map<number, number[]>();\n\t\tlet superatoms = new Map<number, MDLReaderSuperAtom>(), mixtures = new Map<number, MDLReaderGroupMixture>();\n\n\t\twhile (true)\n\t\t{\n\t\t\tline = this.nextLine();\n\t\t\tif (line.startsWith('M  END')) break;\n\n\t\t\tlet type = 0;\n\t\t\tif (line.startsWith('M  CHG')) type = MBLK_CHG;\n\t\t\telse if (line.startsWith('M  RAD')) type = MBLK_RAD;\n\t\t\telse if (line.startsWith('M  ISO')) type = MBLK_ISO;\n\t\t\telse if (line.startsWith('M  RGP')) type = MBLK_RGP;\n\t\t\telse if (this.parseExtended && line.startsWith('M  HYD')) type = MBLK_HYD;\n\t\t\telse if (this.parseExtended && line.startsWith('M  ZCH')) type = MBLK_ZCH;\n\t\t\telse if (this.parseExtended && line.startsWith('M  ZBO')) type = MBLK_ZBO;\n\t\t\telse if (this.parseExtended && line.startsWith('M  ZPA')) type = MBLK_ZPA;\n\t\t\telse if (this.parseExtended && line.startsWith('M  ZRI')) type = MBLK_ZRI;\n\t\t\telse if (this.parseExtended && line.startsWith('M  ZAR')) type = MBLK_ZAR;\n\t\t\telse if (this.parseExtended && line.startsWith('M  RBC')) type = MBLK_RBC;\n\t\t\telse if (this.parseExtended && line.startsWith('M  SUB')) type = MBLK_SUB;\n\t\t\telse if (this.parseExtended && line.startsWith('M  UNS')) type = MBLK_UNS;\n\t\t\telse if (line.startsWith('A  ') && line.length >= 6)\n\t\t\t{\n\t\t\t\tlet anum = parseInt(line.substring(3, 6).trim());\n\t\t\t\tif (anum >= 1 && anum <= this.mol.numAtoms)\n\t\t\t\t{\n\t\t\t\t\tline = this.nextLine();\n\t\t\t\t\tif (line == null) break;\n\t\t\t\t\tthis.mol.setAtomElement(anum, line);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (line.startsWith('M  STY'))\n\t\t\t{\n\t\t\t\tlet len = parseInt(line.substring(6, 9).trim());\n\t\t\t\tfor (let n = 0; n < len; n++)\n\t\t\t\t{\n\t\t\t\t\tlet idx = parseInt(line.substring(9 + 8 * n, 13 + 8 * n).trim());\n\t\t\t\t\tlet stype = line.substring(14 + 8 * n, 17 + 8 * n);\n\t\t\t\t\tif (stype == 'SUP') superatoms.set(idx, {atoms: [], name: null});\n\t\t\t\t\telse if (stype == 'MIX' || stype == 'FOR') mixtures.set(idx, {index: idx, parent: 0, atoms: [], type: stype});\n\t\t\t\t\telse if (stype == 'SRU' || stype == 'COP' || stype == 'MUL' || stype == 'DAT') superatoms.set(idx, {atoms: [], name: null, bracketType: stype});\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (line.startsWith('M  SPL'))\n\t\t\t{\n\t\t\t\tlet len = parseInt(line.substring(6, 9).trim());\n\t\t\t\tfor (let n = 0; n < len; n++)\n\t\t\t\t{\n\t\t\t\t\tlet child = parseInt(line.substring(9 + 8 * n, 13 + 8 * n).trim());\n\t\t\t\t\tlet parent = parseInt(line.substring(13 + 8 * n, 17 + 8 * n).trim());\n\t\t\t\t\tlet mix = mixtures.get(child);\n\t\t\t\t\tif (mix != null) mix.parent = parent;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (line.startsWith('M  SAL'))\n\t\t\t{\n\t\t\t\tlet idx = parseInt(line.substring(6, 10).trim());\n\t\t\t\tlet sup = superatoms.get(idx);\n\t\t\t\tif (sup != null)\n\t\t\t\t{\n\t\t\t\t\tlet len = parseInt(line.substring(10, 13).trim());\n\t\t\t\t\tlet atoms = Vec.numberArray(0, len);\n\t\t\t\t\tfor (let n = 0; n < len; n++) atoms[n] = parseInt(line.substring(13 + 4 * n, 17 + 4 * n).trim());\n\t\t\t\t\tsup.atoms = Vec.concat(sup.atoms, atoms);\n\t\t\t\t}\n\t\t\t\tlet mix = mixtures.get(idx);\n\t\t\t\tif (mix != null)\n\t\t\t\t{\n\t\t\t\t\tlet len = parseInt(line.substring(10, 13).trim());\n\t\t\t\t\tlet atoms = Vec.numberArray(0, len);\n\t\t\t\t\tfor (let n = 0; n < len; n++) atoms[n] = parseInt(line.substring(13 + 4 * n, 17 + 4 * n).trim());\n\t\t\t\t\tmix.atoms = Vec.concat(mix.atoms, atoms);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (line.startsWith('M  SBL'))\n\t\t\t{\n\t\t\t\tlet idx = parseInt(line.substring(6, 10).trim());\n\t\t\t\tlet sup = superatoms.get(idx);\n\t\t\t\tif (sup != null)\n\t\t\t\t{\n\t\t\t\t\tlet len = parseInt(line.substring(10, 13).trim());\n\t\t\t\t\tlet bonds = Vec.numberArray(0, len);\n\t\t\t\t\tfor (let n = 0; n < len; n++) bonds[n] = parseInt(line.substring(13 + 4 * n, 17 + 4 * n).trim());\n\t\t\t\t\tsup.bonds = Vec.concat(sup.bonds, bonds);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (line.startsWith('M  SMT'))\n\t\t\t{\n\t\t\t\tlet idx = parseInt(line.substring(6, 10).trim());\n\t\t\t\tlet sup = superatoms.get(idx);\n\t\t\t\tif (sup != null) sup.name = line.substring(11).trim();\n\t\t\t}\n\t\t\telse if (line.startsWith('M  SDT'))\n\t\t\t{\n\t\t\t\tlet idx = parseInt(line.substring(6, 10).trim());\n\t\t\t\tlet sup = superatoms.get(idx);\n\t\t\t\tif (sup)\n\t\t\t\t{\n\t\t\t\t\tsup.name = line.substring(11, 41).trim();\n\t\t\t\t\tsup.unit = line.substring(43, 63).trim();\n\t\t\t\t\tsup.query = line.substring(63).trim();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (line.startsWith('M  SED'))\n\t\t\t{\n\t\t\t\tlet idx = parseInt(line.substring(6, 10).trim());\n\t\t\t\tlet sup = superatoms.get(idx);\n\t\t\t\tif (sup) sup.value = line.substring(11).trim();\n\t\t\t}\n\t\t\telse if (line.startsWith('M  SCN'))\n\t\t\t{\n\t\t\t\tlet len = parseInt(line.substring(6, 9).trim());\n\t\t\t\tfor (let n = 0; n < len; n++)\n\t\t\t\t{\n\t\t\t\t\tlet idx = parseInt(line.substring(9 + 8 * n, 13 + 8 * n).trim());\n\t\t\t\t\tlet stype = line.substring(14 + 8 * n, 17 + 8 * n);\n\t\t\t\t\tlet sup = superatoms.get(idx);\n\t\t\t\t\tif (sup != null) sup.connectType = stype.trim();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (line.startsWith('M  CRS'))\n\t\t\t{\n\t\t\t\tlet idx = parseInt(line.substring(6, 10).trim());\n\t\t\t\tlet sup = superatoms.get(idx);\n\t\t\t\tif (sup != null)\n\t\t\t\t{\n\t\t\t\t\tlet len = parseInt(line.substring(10, 13).trim());\n\t\t\t\t\tsup.bondConn = Vec.numberArray(0, len);\n\t\t\t\t\tfor (let n = 0; n < len; n++) sup.bondConn[n] = parseInt(line.substring(13 + 4 * n, 17 + 4 * n).trim());\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (line.startsWith('M  LIN'))\n\t\t\t{\n\t\t\t\tlet len = parseInt(line.substring(6, 9).trim());\n\t\t\t\tfor (let n = 0; n < len; n++)\n\t\t\t\t{\n\t\t\t\t\tlet node:MDLReaderLinkNode =\n\t\t\t\t\t{\n\t\t\t\t\t\tatom: parseInt(line.substring(9 + 8 * n, 13 + 8 * n).trim()),\n\t\t\t\t\t\tnbrs: [],\n\t\t\t\t\t\tminRep: 1,\n\t\t\t\t\t\tmaxRep: parseInt(line.substring(13 + 8 * n, 17 + 8 * n).trim()),\n\t\t\t\t\t};\n\n\t\t\t\t\tlet nbr1 = parseInt(line.substring(17 + 8 * n, 21 + 8 * n).trim());\n\t\t\t\t\tlet nbr2 = parseInt(line.substring(21 + 8 * n, 25 + 8 * n).trim());\n\t\t\t\t\tif (nbr1 > 0) node.nbrs.push(nbr1);\n\t\t\t\t\tif (nbr2 > 0) node.nbrs.push(nbr2);\n\n\t\t\t\t\tthis.groupLinkNodes.push(node);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (line.startsWith('M  ALS'))\n\t\t\t{\n\t\t\t\tlet atom = parseInt(line.substring(7, 10).trim());\n\t\t\t\tlet len = parseInt(line.substring(10, 13).trim());\n\t\t\t\tlet logic = line.charAt(14);\n\t\t\t\tlet elements:string[] = [];\n\t\t\t\tfor (let n = 0; n < len; n++) elements.push(line.substring(16 + n * 4, 20 + n * 4).trim());\n\n\t\t\t\tthis.mol.setAtomElement(atom, '*');\n\t\t\t\tif (logic == 'F') QueryUtil.setQueryAtomElements(this.mol, atom, elements);\n\t\t\t\telse if (logic == 'T') QueryUtil.setQueryAtomElementsNot(this.mol, atom, elements);\n\t\t\t}\n\n\t\t\tif (type == MBLK_ZPA || type == MBLK_ZRI || type == MBLK_ZAR)\n\t\t\t{\n\t\t\t\tlet len = parseInt(line.substring(6, 9).trim()), blk = parseInt(line.substring(9, 13).trim());\n\t\t\t\tlet map = type == MBLK_ZPA ? resPaths : type == MBLK_ZRI ? resRings : /* type == MBLK_ZAR */ arenes;\n\t\t\t\tfor (let n = 0; n < len; n++)\n\t\t\t\t{\n\t\t\t\t\tlet val = parseInt(line.substring(13 + 4 * n, 17 + 4 * n).trim());\n\t\t\t\t\tif (val < 1 || val > numAtoms) throw 'Invalid MDL MOL: M-block';\n\t\t\t\t\tlet atoms = map.get(blk);\n\t\t\t\t\tif (!atoms) map.set(blk, atoms = []);\n\t\t\t\t\tatoms.push(val);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (type > 0)\n\t\t\t{\n\t\t\t\tlet len = parseInt(line.substring(6, 9).trim());\n\t\t\t\tfor (let n = 0; n < len; n++)\n\t\t\t\t{\n\t\t\t\t\tlet pos = parseInt(line.substring(9 + 8 * n, 13 + 8 * n).trim());\n\t\t\t\t\tlet val = parseInt(line.substring(13 + 8 * n, 17 + 8 * n).trim());\n\t\t\t\t\tif (pos < 1) throw 'Invalid MDL MOL: M-block';\n\n\t\t\t\t\tif (type == MBLK_CHG) this.mol.setAtomCharge(pos, val);\n\t\t\t\t\telse if (type == MBLK_RAD)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (val == 1 || val == 3) this.mol.setAtomUnpaired(pos, 2);\n\t\t\t\t\t\telse if (val == 2) this.mol.setAtomUnpaired(pos, 1);\n\t\t\t\t\t}\n\t\t\t\t\telse if (type == MBLK_ISO) this.mol.setAtomIsotope(pos, val);\n\t\t\t\t\telse if (type == MBLK_RGP) this.mol.setAtomElement(pos, 'R' + val);\n\t\t\t\t\telse if (type == MBLK_HYD) this.mol.setAtomHExplicit(pos, val);\n\t\t\t\t\telse if (type == MBLK_ZCH) this.mol.setAtomCharge(pos, val);\n\t\t\t\t\telse if (type == MBLK_ZBO) this.mol.setBondOrder(pos, val);\n\t\t\t\t\telse if (type == MBLK_RBC && val != 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (val == -2) val = this.countRingBonds(pos);\n\t\t\t\t\t\telse if (val == -1) val = 0;\n\t\t\t\t\t\tQueryUtil.setQueryAtomRingBonds(this.mol, pos, [val]);\n\t\t\t\t\t}\n\t\t\t\t\telse if (type == MBLK_SUB && val != 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (val == -2) val = this.countSubstitutions(pos);\n\t\t\t\t\t\telse if (val == -1) val = 0;\n\t\t\t\t\t\tQueryUtil.setQueryAtomAdjacency(this.mol, pos, [val]);\n\t\t\t\t\t}\n\t\t\t\t\telse if (type == MBLK_UNS)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (val == 1) QueryUtil.setQueryAtomUnsaturated(this.mol, pos, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.postFix();\n\n\t\tif (this.parseExtended)\n\t\t{\n\t\t\tlet artifacts = new BondArtifact(this.mol);\n\t\t\tfor (let atoms of resPaths.values()) artifacts.createPath(atoms);\n\t\t\tfor (let atoms of resRings.values()) artifacts.createRing(atoms);\n\t\t\tfor (let atoms of arenes.values()) artifacts.createArene(atoms);\n\t\t\tartifacts.rewriteMolecule();\n\t\t}\n\n\t\t// process polymer superblocks first\n\t\tfor (let key of Vec.sorted(Array.from(superatoms.keys())))\n\t\t{\n\t\t\tlet value = superatoms.get(key);\n\t\t\tif (value.bracketType)\n\t\t\t{\n\t\t\t\tsuperatoms.delete(key);\n\t\t\t\tthis.applyPolymerBlock(value);\n\t\t\t}\n\t\t}\n\n\t\t// process non-polymer superblocks\n\t\tfor (let key of Vec.sorted(Array.from(superatoms.keys())))\n\t\t{\n\t\t\tlet value = superatoms.get(key);\n\t\t\tsuperatoms.delete(key);\n\t\t\tthis.applySuperAtom(value, Array.from(superatoms.values()));\n\t\t}\n\n\t\tfor (let key of Vec.sorted(Array.from(mixtures.keys()))) this.groupMixtures.push(mixtures.get(key));\n\n\t\tthis.mol.keepTransient = false;\n\t}\n\n\t// performs some intrinsic post-parse fixing\n\tprivate postFix():void\n\t{\n\t\tconst mol = this.mol;\n\n\t\t// post-fixing\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t{\n\t\t\tif (MolUtil.hasAbbrev(mol, n) || mol.atomTransient(n).some((str) => str.startsWith(ForeignMoleculeTransient.AtomSCSRClass))) continue;\n\n\t\t\tlet el = mol.atomElement(n);\n\n\t\t\t// shortcuts for isotope \"elements\"\n\t\t\tif (el == 'D') {mol.setAtomElement(n, 'H'); mol.setAtomIsotope(n, 2);}\n\t\t\telse if (el == 'T') {mol.setAtomElement(n, 'H'); mol.setAtomIsotope(n, 3);}\n\n\t\t\tif (mol.is3D && mol.atomZ(n) === undefined) mol.setAtomZ(n, 0);\n\n\t\t\t// valence, two correction scenarios\n\t\t\tlet valence = ForeignMolecule.noteExplicitValence(this.mol, n);\n\t\t\tlet options = MDLMOL_VALENCE[el];\n\t\t\tif (valence != null)\n\t\t\t{\n\t\t\t\tlet hcount = valence < 0 || valence > 14 ? 0 : valence;\n\t\t\t\tfor (let b of mol.atomAdjBonds(n)) hcount -= mol.bondOrder(b);\n\t\t\t\tif (hcount != mol.atomHydrogens(n)) mol.setAtomHExplicit(n, Math.max(0, hcount));\n\t\t\t}\n\t\t\telse if (options)\n\t\t\t{\n\t\t\t\tlet chg = mol.atomCharge(n);\n\t\t\t\tlet chgmod = (el == 'C' || el == 'H') ? Math.abs(chg) : el == 'B' ? -Math.abs(chg) : -chg;\n\t\t\t\tlet usedValence = chgmod;\n\t\t\t\tlet unp = mol.atomUnpaired(n);\n\t\t\t\tif (unp > 0 && (el == 'C' || el == 'O' || el == 'S' || el == 'N' || el == 'P')) usedValence += unp;\n\t\t\t\tfor (let b of mol.atomAdjBonds(n)) usedValence += mol.bondOrder(b);\n\t\t\t\tfor (let v of options) if (usedValence <= v)\n\t\t\t\t{\n\t\t\t\t\tlet hcount = v - usedValence;\n\t\t\t\t\tif (hcount != mol.atomHydrogens(n)) mol.setAtomHExplicit(n, Math.max(0, hcount));\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.considerRescale && Vec.isBlank(this.scsrTemplates)) CoordUtil.normaliseBondDistances(mol);\n\n\t\tif (this.resBonds != null)\n\t\t{\n\t\t\tlet derez = new ResonanceRemover(mol, this.resBonds, null);\n\t\t\ttry\n\t\t\t{\n\t\t\t\tderez.perform();\n\t\t\t\tfor (let n = 0; n < mol.numBonds; n++) mol.setBondOrder(n + 1, derez.bondOrders[n]);\n\t\t\t}\n\t\t\tcatch (ex)\n\t\t\t{\n\t\t\t\t// silent failure: de-resonance Kekulisation failed; the aromatic bonds will be left as single\n\t\t\t}\n\t\t}\n\t}\n\n\t// alternate track: only look at the specially marked V3000 tags\n\tprivate parseV3000():void\n\t{\n\t\tenum Section {Atom, Bond, Coll, SGroup, Template}\n\t\tlet inCTAB = false, inTemplate = false;\n\t\tlet section:Section = null;\n\n\t\tlet lineCounts:string = null;\n\t\tlet lineAtom:string[] = [], lineBond:string[] = [], lineColl:string[] = [], lineSgroup:string[] = [];\n\t\tlet asdrawnRBC:number[] = [], asdrawnSUB:number[] = [];\n\n\t\tlet templateBlocks:string[][] = [];\n\n\t\tconst ERRPFX = 'Invalid MDL MOL V3000: ';\n\n\t\twhile (true)\n\t\t{\n\t\t\tlet fullLine = this.nextLine();\n\t\t\tif (fullLine == 'M  END') break; // graceful end\n\n\t\t\tif (!fullLine.startsWith('M  V30 ')) continue;\n\t\t\tlet line = fullLine.substring(7);\n\n\t\t\tif (line.startsWith('BEGIN TEMPLATE')) inTemplate = true;\n\t\t\telse if (line.startsWith('END TEMPLATE')) inTemplate = false;\n\t\t\telse if (line.startsWith('TEMPLATE ') && inTemplate) templateBlocks.push([fullLine]);\n\t\t\telse if (inTemplate && templateBlocks != null) Vec.last(templateBlocks).push(fullLine);\n\t\t\telse if (line.startsWith('COUNTS ')) lineCounts = line.substring(7);\n\t\t\telse if (line.startsWith('BEGIN CTAB')) inCTAB = true;\n\t\t\telse if (line.startsWith('BEGIN ATOM')) section = Section.Atom;\n\t\t\telse if (line.startsWith('BEGIN BOND')) section = Section.Bond;\n\t\t\telse if (line.startsWith('BEGIN COLLECTION')) section = Section.Coll;\n\t\t\telse if (line.startsWith('BEGIN SGROUP')) section = Section.SGroup;\n\t\t\telse if (line.startsWith('END ')) section = null;\n\t\t\t// TO DO: make sure these are nested properly, bug out if not\n\t\t\telse if (inCTAB && section == Section.Atom) lineAtom.push(line);\n\t\t\telse if (inCTAB && section == Section.Bond) lineBond.push(line);\n\t\t\telse if (inCTAB && section == Section.Coll) lineColl.push(line);\n\t\t\telse if (inCTAB && section == Section.SGroup) lineSgroup.push(line);\n\t\t\telse if (inCTAB && section == null)\n\t\t\t{\n\t\t\t\tif (line.startsWith('LINKNODE '))\n\t\t\t\t{\n\t\t\t\t\tlet bits = this.splitWithQuotes(line.substring(9));\n\n\t\t\t\t\tlet node:MDLReaderLinkNode =\n\t\t\t\t\t{\n\t\t\t\t\t\tatom: 0,\n\t\t\t\t\t\tnbrs: [],\n\t\t\t\t\t\tminRep: parseInt(bits[0]),\n\t\t\t\t\t\tmaxRep: parseInt(bits[1])\n\t\t\t\t\t};\n\n\t\t\t\t\t// convert the list of bond {a1,a2} into central atom / neighbours\n\t\t\t\t\tlet nb = parseInt(bits[2]);\n\t\t\t\t\tlet atoms:number[] = [];\n\t\t\t\t\tfor (let n = 0; n < nb * 2; n++) atoms.push(parseInt(bits[3 + n]));\n\t\t\t\t\tVec.sort(atoms);\n\t\t\t\t\tfor (let n = 0; n < atoms.length; n++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (n < atoms.length - 1 && atoms[n] == atoms[n + 1])\n\t\t\t\t\t\t\tnode.atom = atoms[n++];\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tnode.nbrs.push(atoms[n]);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.groupLinkNodes.push(node);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// (silently ignore other stuff; don't care)\n\t\t}\n\n\t\tlet counts = lineCounts.trim().split(/\\s+/);\n\t\tif (counts.length < 2) throw ERRPFX + 'counts line malformatted';\n\t\tlet numAtoms = parseInt(counts[0]), numBonds = parseInt(counts[1]);\n\t\tif (numAtoms < 0 || numAtoms > lineAtom.length) throw ERRPFX + 'unreasonable atom count: ' + numAtoms;\n\t\tif (numBonds < 0 || numBonds > lineBond.length) throw ERRPFX + 'unreasonable bond count: ' + numBonds;\n\n\t\tlet atomBits:string[][] = [], bondBits:string[][] = [];\n\n\t\t// extract atom & bond content\n\t\tfor (let n = 0; n < lineAtom.length; n++)\n\t\t{\n\t\t\tlet line = lineAtom[n];\n\t\t\twhile (n < lineAtom.length - 1 && line.endsWith('-'))\n\t\t\t{\n\t\t\t\tn++;\n\t\t\t\tline = line.substring(0, line.length - 1) + lineAtom[n];\n\t\t\t}\n\t\t\tlet bits = this.splitWithQuotes(line);\n\t\t\tif (bits.length < 6) throw ERRPFX + 'atom line has too few components: ' + line;\n\t\t\tlet idx = parseInt(bits[0], 0);\n\t\t\tif (idx < 1 || idx > numAtoms) throw ERRPFX + 'invalid atom index: ' + bits[0];\n\t\t\tif (atomBits[idx - 1] != null) throw ERRPFX + 'duplicate atom index: ' + idx;\n\t\t\tatomBits[idx - 1] = bits;\n\t\t}\n\t\tfor (let n = 0; n < lineBond.length; n++)\n\t\t{\n\t\t\tlet line = lineBond[n];\n\t\t\twhile (n < lineBond.length - 1 && line.endsWith('-'))\n\t\t\t{\n\t\t\t\tn++;\n\t\t\t\tline = line.substring(0, line.length - 1) + lineBond[n];\n\t\t\t}\n\t\t\tlet bits = this.splitWithQuotes(line);\n\t\t\tif (bits.length < 4) throw ERRPFX + 'bond line has too few components: ' + line;\n\t\t\tlet idx = parseInt(bits[0], 0);\n\t\t\tif (idx < 1 || idx > numBonds) throw ERRPFX + 'invalid bond index: ' + bits[0];\n\t\t\tif (bondBits[idx - 1] != null) throw ERRPFX + 'duplicate bond index: ' + idx;\n\t\t\tbondBits[idx - 1] = bits;\n\t\t}\n\n\t\t// process each atom\n\t\tfor (let a = 1; a <= numAtoms; a++)\n\t\t{\n\t\t\tlet bits = atomBits[a - 1];\n\t\t\tif (bits == null) throw ERRPFX + 'atom definition missing for #' + a;\n\n\t\t\tlet type = bits[1];\n\t\t\tif (type.length > 2 && type.startsWith('\"') && type.endsWith('\"')) type = type.substring(1, type.length - 1);\n\n\t\t\tlet x = parseFloat(bits[2]), y = parseFloat(bits[3]), z = parseFloat(bits[4]);\n\t\t\tlet map = parseInt(bits[5]);\n\t\t\tthis.mol.addAtom(type, x, y);\n\t\t\tif (z != 0)\n\t\t\t{\n\t\t\t\tthis.mol.setAtomZ(a, z);\n\t\t\t\tthis.mol.setIs3D(true);\n\t\t\t}\n\t\t\tthis.mol.setAtomMapNum(a, map);\n\n\t\t\tthis.parseQueryAtomList(this.mol, a);\n\n\t\t\tfor (let i = 6; i < bits.length; i++)\n\t\t\t{\n\t\t\t\tlet eq = bits[i].indexOf('=');\n\t\t\t\tif (eq < 0) continue;\n\t\t\t\tlet key = bits[i].substring(0, eq), val = bits[i].substring(eq + 1);\n\t\t\t\tif (key == 'CHG') this.mol.setAtomCharge(a, parseInt(val));\n\t\t\t\telse if (key == 'RAD')\n\t\t\t\t{\n\t\t\t\t\tlet spin = parseInt(val);\n\t\t\t\t\tif (spin == 1 || spin == 3) this.mol.setAtomUnpaired(a, 2);\n\t\t\t\t\telse if (spin == 2) this.mol.setAtomUnpaired(a, 1);\n\t\t\t\t}\n\t\t\t\telse if (key == 'MASS') this.mol.setAtomIsotope(a, parseInt(val));\n\t\t\t\telse if (key == 'CFG')\n\t\t\t\t{\n\t\t\t\t\tlet stereo = parseInt(val);\n\t\t\t\t\tif (stereo > 0 && this.keepParity)\n\t\t\t\t\t{\n\t\t\t\t\t\t/* todo: record incoming parity\n\t\t\t\t\t\tlet trans = this.mol.atomTransient(n);\n\t\t\t\t\t\tif (stereo == 1) mol.setAtomTransient(n, Vec.append(trans, ForeignMolecule.ATOM_CHIRAL_MDL_ODD));\n\t\t\t\t\t\telse if (stereo == 2) mol.setAtomTransient(n, Vec.append(trans, ForeignMolecule.ATOM_CHIRAL_MDL_EVEN));\n\t\t\t\t\t\telse if (stereo == 3) mol.setAtomTransient(n, Vec.append(trans, ForeignMolecule.ATOM_CHIRAL_MDL_RACEMIC));*/\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (key == 'VAL') ForeignMolecule.markExplicitValence(this.mol, a, parseInt(val));\n\t\t\t\telse if (key == 'CLASS')\n\t\t\t\t{\n\t\t\t\t\tthis.mol.appendAtomTransient(a, ForeignMoleculeTransient.AtomSCSRClass + ':' + val);\n\t\t\t\t}\n\t\t\t\telse if (key == 'SEQID')\n\t\t\t\t{\n\t\t\t\t\tthis.mol.appendAtomTransient(a, ForeignMoleculeTransient.AtomSCSRSeqID + ':' + val);\n\t\t\t\t}\n\t\t\t\telse if (key == 'ATTCHORD')\n\t\t\t\t{\n\t\t\t\t\tlet attch = this.unpackStrings(val);\n\t\t\t\t\tif (attch != null) this.mol.appendAtomTransient(a, ForeignMoleculeTransient.AtomSCSRAttchOrd + ':' + attch.join(','));\n\t\t\t\t}\n\t\t\t\telse if (key == 'HCOUNT')\n\t\t\t\t{\n\t\t\t\t\tlet hyd = parseInt(val);\n\t\t\t\t\tif (hyd != 0) QueryUtil.setQueryAtomHydrogens(this.mol, a, [Math.max(hyd, 0)]);\n\t\t\t\t}\n\t\t\t\telse if (key == 'RBCNT')\n\t\t\t\t{\n\t\t\t\t\tlet rbc = parseInt(val);\n\t\t\t\t\tif (rbc == -2) asdrawnRBC.push(a);\n\t\t\t\t\telse if (rbc != 0) QueryUtil.setQueryAtomRingBonds(this.mol, a, [Math.max(rbc, 0)]);\n\t\t\t\t}\n\t\t\t\telse if (key == 'SUBST')\n\t\t\t\t{\n\t\t\t\t\tlet sub = parseInt(val);\n\t\t\t\t\tif (sub == -2) asdrawnSUB.push(a);\n\t\t\t\t\telse if (sub != 0) QueryUtil.setQueryAtomAdjacency(this.mol, a, [Math.max(sub, 0)]);\n\t\t\t\t}\n\t\t\t\telse if (key == 'UNSAT')\n\t\t\t\t{\n\t\t\t\t\tlet uns = parseInt(val);\n\t\t\t\t\tif (uns == 1) QueryUtil.setQueryAtomUnsaturated(this.mol, a, true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// process each bond\n\t\tfor (let b = 1; b <= numBonds; b++)\n\t\t{\n\t\t\tlet bits = bondBits[b - 1];\n\t\t\tif (bits == null) throw ERRPFX + 'bond definition missing for #' + b;\n\n\t\t\tlet type = parseInt(bits[1]), bfr = parseInt(bits[2]), bto = parseInt(bits[3]);\n\t\t\tlet order = type >= 1 && type <= 3 ? type : type == 9 || type == 10 ? 0 : 1;\n\t\t\tthis.mol.addBond(bfr, bto, order);\n\t\t\tif (type == 9) this.mol.appendBondTransient(b, ForeignMoleculeTransient.BondZeroDative);\n\t\t\tif (type == 10) this.mol.appendBondTransient(b, ForeignMoleculeTransient.BondZeroHydrogen);\n\n\t\t\tif (this.keepQuery)\n\t\t\t{\n\t\t\t\tif (type == 4) QueryUtil.setQueryBondOrders(this.mol, b, [-1]); // aromatic query type\n\t\t\t\telse if (type == 5) QueryUtil.setQueryBondOrders(this.mol, b, [1, 2]); // single-or-double query type\n\t\t\t\telse if (type == 6) QueryUtil.setQueryBondOrders(this.mol, b, [-1, 1]); // single-or-aromatic query type\n\t\t\t\telse if (type == 7) QueryUtil.setQueryBondOrders(this.mol, b, [-1, 2]); // double-or-aromatic query type\n\t\t\t\telse if (type == 8) QueryUtil.setQueryBondOrders(this.mol, b, [-1, 0, 1, 2, 3]); // anything\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// type \"4\" is special: it is defined to be a special query type to match aromatic bonds, but it is sometimes used\n\t\t\t\t// to store actual molecules; in this case, it is necessary to either \"deresonate\" the rings, or to stash the property\n\t\t\t\tif (type == 4)\n\t\t\t\t{\n\t\t\t\t\tif (this.keepAromatic) this.mol.setBondTransient(b, Vec.append(this.mol.bondTransient(b), ForeignMoleculeTransient.BondAromatic));\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.resBonds == null) this.resBonds = Vec.booleanArray(false, numBonds);\n\t\t\t\t\t\tthis.resBonds[b - 1] = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet endpts:number[] = null;\n\t\t\tlet attach:string = null;\n\n\t\t\tfor (let i = 4; i < bits.length; i++)\n\t\t\t{\n\t\t\t\tlet eq = bits[i].indexOf('=');\n\t\t\t\tif (eq < 0) continue;\n\t\t\t\tlet key = bits[i].substring(0, eq), val = bits[i].substring(eq + 1);\n\t\t\t\tif (key == 'CFG')\n\t\t\t\t{\n\t\t\t\t\tlet dir = parseInt(val);\n\t\t\t\t\tthis.mol.setBondType(b, dir == 1 ? Molecule.BONDTYPE_INCLINED :\n\t\t\t\t\t\t\t\t\t\t\tdir == 2 ? Molecule.BONDTYPE_UNKNOWN :\n\t\t\t\t\t\t\t\t\t\t\tdir == 3 ? Molecule.BONDTYPE_DECLINED : Molecule.BONDTYPE_NORMAL);\n\t\t\t\t}\n\t\t\t\telse if (key == 'DISP')\n\t\t\t\t{\n\t\t\t\t\tif (val == 'COORD') this.mol.setBondOrder(b, 0);\n\t\t\t\t}\n\t\t\t\telse if (key == 'ENDPTS') endpts = this.unpackList(val);\n\t\t\t\telse if (key == 'ATTACH') attach = val;\n\t\t\t}\n\n\t\t\tif (attach != null && endpts != null)\n\t\t\t{\n\t\t\t\tif (attach == 'ALL') this.groupAttachAll.set(b, endpts);\n\t\t\t\telse if (attach == 'ANY') this.groupAttachAny.set(b, endpts);\n\t\t\t}\n\t\t}\n\n\t\tfor (let atom of asdrawnRBC) QueryUtil.setQueryAtomRingBonds(this.mol, atom, [this.countRingBonds(atom)]);\n\t\tfor (let atom of asdrawnSUB) QueryUtil.setQueryAtomAdjacency(this.mol, atom, [this.countSubstitutions(atom)]);\n\n\t\tthis.postFix();\n\n\t\t// extract collection info\n\t\tfor (let n = 0; n < lineColl.length; n++)\n\t\t{\n\t\t\tlet line = lineColl[n];\n\t\t\twhile (n < lineColl.length - 1 && line.endsWith('-'))\n\t\t\t{\n\t\t\t\tn++;\n\t\t\t\tline = line.substring(0, line.length - 1) + lineColl[n];\n\t\t\t}\n\t\t\tlet bits = this.splitWithQuotes(line);\n\t\t\tif (bits[0].startsWith('MDLV30/STEABS'))\n\t\t\t{\n\t\t\t\tif (bits[1].startsWith('ATOMS=')) this.groupStereoAbsolute = this.unpackList(bits[1].substring(5));\n\t\t\t}\n\t\t\telse if (bits[0].startsWith('MDLV30/STERAC'))\n\t\t\t{\n\t\t\t\tif (bits[1].startsWith('ATOMS=')) this.groupStereoRacemic.push(this.unpackList(bits[1].substring(6)));\n\t\t\t}\n\t\t\telse if (bits[0].startsWith('MDLV30/STEREL'))\n\t\t\t{\n\t\t\t\tif (bits[1].startsWith('ATOMS=')) this.groupStereoRelative.push(this.unpackList(bits[1].substring(6)));\n\t\t\t}\n\t\t}\n\n\t\tlet stereoGroup = new StereoGroup(this.mol);\n\t\tfor (let atoms of this.groupStereoRacemic) stereoGroup.createRacemic(atoms);\n\t\tfor (let atoms of this.groupStereoRelative) stereoGroup.createRelative(atoms);\n\t\tstereoGroup.rewriteMolecule();\n\n\t\t// extract S-groups\n\t\tlet superatoms = new Map<number, MDLReaderSuperAtom>();\n\t\tfor (let n = 0; n < lineSgroup.length; n++)\n\t\t{\n\t\t\tlet line = lineSgroup[n];\n\t\t\twhile (n < lineSgroup.length - 1 && line.endsWith('-'))\n\t\t\t{\n\t\t\t\tn++;\n\t\t\t\tline = line.substring(0, line.length - 1) + lineSgroup[n];\n\t\t\t}\n\t\t\tlet bits = this.splitWithQuotes(line);\n\n\t\t\tlet idx = parseInt(bits[0]);\n\t\t\tif (bits.length > 3 && idx > 0 && bits[1] == 'SUP')\n\t\t\t{\n\t\t\t\tlet sup:MDLReaderSuperAtom = {atoms: [], name: null};\n\t\t\t\tfor (let i = 3; i < bits.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (bits[i].startsWith('ATOMS=')) sup.atoms = this.unpackList(bits[i].substring(6));\n\t\t\t\t\telse if (bits[i].startsWith('LABEL=')) sup.name = this.withoutQuotes(bits[i].substring(6));\n\t\t\t\t\telse if (bits[i].startsWith('XBONDS=')) sup.bonds = this.unpackList(bits[i].substring(7));\n\t\t\t\t\telse if (bits[i].startsWith('CLASS=')) sup.templateClass = this.withoutQuotes(bits[i].substring(6));\n\t\t\t\t\telse if (bits[i].startsWith('NATREPLACE=')) sup.natReplace = this.withoutQuotes(bits[i].substring(11));\n\t\t\t\t\telse if (bits[i].startsWith('SAP=')) \n\t\t\t\t\t{\n\t\t\t\t\t\tconst pts = this.unpackStrings(bits[i].substring(4));\n\t\t\t\t\t\tsup.attachPoints = [...(sup.attachPoints ?? []), ...pts];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tsuperatoms.set(idx, sup);\n\t\t\t}\n\t\t\telse if (bits.length > 3 && idx > 0 && (bits[1] == 'MIX' || bits[1] == 'FOR') && parseInt(bits[2]) == idx)\n\t\t\t{\n\t\t\t\tlet mix:MDLReaderGroupMixture = {index: idx, parent: 0, atoms: null, type: bits[1]};\n\t\t\t\tfor (let i = 3; i < bits.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (bits[i].startsWith('ATOMS=')) mix.atoms = this.unpackList(bits[i].substring(6));\n\t\t\t\t\telse if (bits[i].startsWith('PARENT=')) mix.parent = parseInt(bits[i].substring(7));\n\t\t\t\t}\n\t\t\t\tthis.groupMixtures.push(mix);\n\t\t\t}\n\t\t\telse if (bits.length > 3 && idx > 0 && (bits[1] == 'SRU' || bits[1] == 'COP' || bits[1] == 'MUL' || bits[1] == 'DAT'))\n\t\t\t{\n\t\t\t\tlet sup:MDLReaderSuperAtom = {atoms: [], name: null, bracketType: bits[1]};\n\t\t\t\tfor (let i = 3; i < bits.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (bits[i].startsWith('ATOMS=')) sup.atoms = this.unpackList(bits[i].substring(6));\n\t\t\t\t\telse if (bits[i].startsWith('BONDS=')) sup.bonds = this.unpackList(bits[i].substring(6));\n\t\t\t\t\telse if (bits[i].startsWith('LABEL=')) sup.name = this.withoutQuotes(bits[i].substring(6));\n\t\t\t\t\telse if (bits[i].startsWith('CONNECT=')) sup.connectType = bits[i].substring(8);\n\t\t\t\t\telse if (bits[i].startsWith('XBCORR=')) sup.bondConn = this.unpackList(bits[i].substring(7));\n\t\t\t\t\telse if (bits[i].startsWith('MULT=')) sup.name = this.withoutQuotes(bits[i].substring(5));\n\t\t\t\t\telse if (bits[i].startsWith('FIELDNAME=')) sup.name = this.withoutQuotes(bits[i].substring(10));\n\t\t\t\t\telse if (bits[i].startsWith('FIELDDATA=')) sup.value = this.withoutQuotes(bits[i].substring(10));\n\t\t\t\t}\n\t\t\t\tsuperatoms.set(idx, sup);\n\t\t\t}\n\t\t}\n\n\t\t// process polymer superblocks first\n\t\tfor (let key of Vec.sorted(Array.from(superatoms.keys())))\n\t\t{\n\t\t\tlet value = superatoms.get(key);\n\t\t\tif (value.bracketType)\n\t\t\t{\n\t\t\t\tsuperatoms.delete(key);\n\t\t\t\tthis.applyPolymerBlock(value);\n\t\t\t}\n\t\t}\n\n\t\t// process non-polymer superblocks\n\t\tfor (let key of Vec.sorted(Array.from(superatoms.keys())))\n\t\t{\n\t\t\tlet value = superatoms.get(key);\n\t\t\tsuperatoms.delete(key);\n\t\t\tthis.applySuperAtom(value, Array.from(superatoms.values()));\n\t\t}\n\n\t\tif (templateBlocks.length > 0)\n\t\t{\n\t\t\tthis.scsrTemplates = templateBlocks.map((lines) => this.parseV3000Template(lines));\n\t\t}\n\t}\n\n\t// if it's a V3000-style atom list, mark it up\n\tprivate parseQueryAtomList(mol:Molecule, atom:number):void\n\t{\n\t\tlet label = mol.atomElement(atom);\n\t\tlet not = false;\n\t\tif (label.startsWith('NOT ')) {label = label.substring(4); not = true;}\n\t\tif (label.length < 2 || !label.startsWith('[') || !label.endsWith(']')) return;\n\t\tlabel = label.substring(1, label.length - 1);\n\t\tlet elements = label.split(',');\n\n\t\tmol.setAtomElement(atom, '*');\n\t\tif (!not)\n\t\t\tQueryUtil.setQueryAtomElements(mol, atom, elements);\n\t\telse\n\t\t\tQueryUtil.setQueryAtomElementsNot(mol, atom, elements);\n\t}\n\n\t// applies a superatom block: turns the definition itself into an abbreviation if possible; also modifies any remaining superatoms so that their indexes\n\t// are still current\n\tprivate applySuperAtom(sup:MDLReaderSuperAtom, residual:MDLReaderSuperAtom[]):void\n\t{\n\t\tif (sup.name == null || Vec.isBlank(sup.atoms)) return;\n\t\tlet mask = Vec.booleanArray(true, this.mol.numAtoms);\n\t\tfor (let a of sup.atoms) mask[a - 1] = false;\n\n\t\tlet name = sup.name;\n\t\tlet i:number;\n\t\twhile ((i = name.indexOf('\\\\S')) >= 0) name = name.substring(0, i) + '{^' + name.substring(i + 2);\n\t\twhile ((i = name.indexOf('\\\\s')) >= 0) name = name.substring(0, i) + '{' + name.substring(i + 2);\n\t\twhile ((i = name.indexOf('\\\\n')) >= 0) name = name.substring(0, i) + '}' + name.substring(i + 2);\n\n\t\tlet [mod, abvAtom] = !sup.templateClass ? MolUtil.convertToAbbrevIndex(this.mol, mask, name) : [null, null];\n\t\tif (mod == null)\n\t\t{\n\t\t\tlet keyval:Record<string, string> = {};\n\t\t\tif (sup.bonds) keyval['bonds'] = sup.bonds.join(' ');\n\t\t\tif (sup.templateClass) keyval['templateClass'] = sup.templateClass;\n\t\t\tif (sup.natReplace) keyval['natReplace'] = sup.natReplace;\n\t\t\tif (sup.attachPoints) keyval['attachPoints'] = sup.attachPoints.join(' ');\n\n\t\t\tForeignMolecule.markSgroupMultiAttach(this.mol, name, sup.atoms, keyval);\n\t\t\treturn;\n\t\t}\n\t\tthis.mol = mod;\n\n\t\t// correct atom indices for ensuing superatom blocks\n\t\tlet map = Vec.maskMap(mask);\n\t\tfor (let res of residual)\n\t\t{\n\t\t\tlet subsumed = false;\n\t\t\tfor (let n = res.atoms.length - 1; n >= 0; n--)\n\t\t\t{\n\t\t\t\tlet atom = map[res.atoms[n] - 1] + 1;\n\t\t\t\tif (atom == 0)\n\t\t\t\t{\n\t\t\t\t\tres.atoms = Vec.remove(res.atoms, n);\n\t\t\t\t\tsubsumed = true;\n\t\t\t\t}\n\t\t\t\telse res.atoms[n] = atom;\n\t\t\t}\n\t\t\tif (subsumed) res.atoms = Vec.sorted(Vec.append(res.atoms, abvAtom));\n\t\t}\n\t}\n\n\t// deals with a superatom block that is marked as\n\tprivate applyPolymerBlock(sup:MDLReaderSuperAtom):void\n\t{\n\t\tif (sup.bracketType == 'MUL')\n\t\t{\n\t\t\tlet mult = parseInt(sup.name);\n\t\t\tForeignMolecule.markSgroupMultiRepeat(this.mol, mult, sup.atoms);\n\t\t\treturn;\n\t\t}\n\t\tif (sup.bracketType == 'DAT')\n\t\t{\n\t\t\tif (sup.atoms != null) ForeignMolecule.markSgroupData(this.mol, sup.name, sup.value, sup.unit, sup.query, sup.atoms);\n\t\t\treturn;\n\t\t}\n\n\t\tlet poly = new PolymerBlock(this.mol);\n\t\tlet connect:PolymerBlockConnectivity = null;\n\t\tif (sup.connectType == null) {}\n\t\telse if (sup.connectType == 'HT') connect = PolymerBlockConnectivity.HeadToTail;\n\t\telse if (sup.connectType == 'HH') connect = PolymerBlockConnectivity.HeadToHead;\n\t\telse if (sup.connectType == 'EU') connect = PolymerBlockConnectivity.Random;\n\t\telse return;\n\n\t\tlet bondConn:number[] = null;\n\t\tif (Vec.len(sup.bondConn) == 3)\n\t\t{\n\t\t\t// the V2000 style of specifying 2x2 connectivity (by leaving one out...)\n\t\t\tlet b1 = sup.bondConn[0], b2 = sup.bondConn[2], b3 = sup.bondConn[1], b4 = 0;\n\t\t\tfor (let n = 1; n <= this.mol.numBonds; n++) if (n != b1 && n != b2 && n != b3)\n\t\t\t{\n\t\t\t\tlet in1 = sup.atoms.indexOf(this.mol.bondFrom(n)) >= 0, in2 = sup.atoms.indexOf(this.mol.bondTo(n)) >= 0;\n\t\t\t\tif ((in1 && !in2) || (!in1 && in2))\n\t\t\t\t{\n\t\t\t\t\tif (b4 > 0) {b4 = 0; break;}\n\t\t\t\t\tb4 = n;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbondConn = [b1, b2, b3, b4];\n\t\t}\n\t\telse if (Vec.len(sup.bondConn) == 4)\n\t\t{\n\t\t\t// the V3000 style of specifying 2x2 connectivity, which is the same as what we're using\n\t\t\tbondConn = sup.bondConn;\n\t\t}\n\n\t\tlet unit = new PolymerBlockUnit(sup.atoms);\n\t\tunit.connect = connect;\n\t\tunit.bondConn = bondConn;\n\t\tpoly.createUnit(unit);\n\t}\n\n\t// parse out the sub-molecule SCSR template from V3000\n\tprivate parseV3000Template(lines:string[]):ForeignMoleculeTemplateDefn\n\t{\n\t\tlet header = lines[0];\n\t\tlet bits = this.splitWithQuotes(header.substring('M  V30 TEMPLATE '.length));\n\t\tlet name = bits[1], natReplace:string = null;\n\t\tfor (let n = 2; n < bits.length; n++)\n\t\t{\n\t\t\tif (bits[n].startsWith('NATREPLACE=')) natReplace = bits[n].substring(11);\n\t\t}\n\t\t\n\t\tlines[0] = '  0  0  0  0  0  0  0  0  0  0  0 V3000';\n\t\tlines.push('M  END');\n\n\t\tlet mdl = new MDLMOLReader(lines.join('\\n'));\n\t\tmdl.parseHeader = false;\n\t\tmdl.parse();\n\n\t\treturn {name, natReplace, mol: mdl.mol};\n\t}\n\n\t// removes surrounding quotes, if any\n\tprivate withoutQuotes(str:string):string\n\t{\n\t\tif (str.length >= 2 && str.startsWith('\"') && str.endsWith('\"')) return str.substring(1, str.length - 1);\n\t\treturn str;\n\t}\n\n\t// takes a line of whitespace-separated stuff and breaks it into pieces\n\tprivate splitWithQuotes(line:string):string[]\n\t{\n\t\tlet segments:string[] = [];\n\n\t\tlet seg = '';\n\t\tlet depth = 0, quote = false;\n\t\tfor (let n = 0; n < line.length; n++)\n\t\t{\n\t\t\tlet ch = line.charAt(n);\n\t\t\tif (ch == ' ' && depth == 0 && !quote)\n\t\t\t{\n\t\t\t\tif (seg.length > 0) segments.push(seg);\n\t\t\t\tseg = '';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tseg += ch;\n\t\t\t\tif (ch == '\"') quote = !quote;\n\t\t\t\telse if (ch == '(' || ch == '[') depth++;\n\t\t\t\telse if (ch == ')' || ch == ']') depth--;\n\t\t\t}\n\t\t}\n\t\tif (seg.length > 0) segments.push(seg);\n\n\t\treturn segments;\n\t}\n\n\t// converts a string of the form \"(sz v1 v2 ...)\" into an array of just the values\n\tprivate unpackList(str:string):number[]\n\t{\n\t\tif (!str.startsWith('(') || !str.endsWith(')')) return null;\n\n\t\tstr = str.substring(1, str.length - 1);\n\t\tlet values:number[] = [];\n\t\tfor (let bit of str.split(' ')) values.push(parseInt(bit));\n\t\tif (values[0] != values.length - 1) return null;\n\t\treturn Vec.remove(values, 0);\n\t}\n\tprivate unpackStrings(str:string):string[]\n\t{\n\t\tif (!str.startsWith('(') || !str.endsWith(')')) return null;\n\n\t\tstr = str.substring(1, str.length - 1);\n\t\tlet values = str.split(' ');\n\t\tif (parseInt(values[0]) != values.length - 1) return null;\n\t\treturn Vec.remove(values, 0);\n\t}\n\n\t// used when an incoming property is designated \"as drawn\"\n\tprivate countRingBonds(atom:number):number\n\t{\n\t\tlet count = 0;\n\t\tfor (let b of this.mol.atomAdjBonds(atom)) if (this.mol.bondInRing(b)) count++;\n\t\treturn count;\n\t}\n\tprivate countSubstitutions(atom:number):number\n\t{\n\t\tlet count = 0;\n\t\tfor (let adj of this.mol.atomAdjList(atom)) if (this.mol.atomElement(adj) != 'H') count++;\n\t\treturn count;\n\t}\n}\n\nexport class MDLSDFReader\n{\n\tpublic ds = new DataSheet();\n\tpublic upcastColumns = true; // if on, tries to decide on column types based on their data values; otherwise leaves as strings\n\n\tprivate pos = 0;\n\tprivate lines:string[];\n\n\t// ----------------- public methods -----------------\n\n\tconstructor(strData:string)\n\t{\n\t\tthis.lines = strData.split(/\\r?\\n/);\n\t}\n\n\t// perform the parsing operation, and populate the result fields\n\tpublic parse():DataSheet\n\t{\n\t\tthis.parseStream();\n\t\tif (this.upcastColumns) this.upcastStringColumns();\n\t\treturn this.ds;\n\t}\n\n\t// ----------------- private methods -----------------\n\n\tprivate parseStream():void\n\t{\n\t\tlet ds = this.ds;\n\t\tds.appendColumn('Molecule', DataSheetColumn.Molecule, 'Molecular structure');\n\t\tlet colName = -1;\n\t\tlet entry:string[] = [];\n\n\t\t// read the lines from the SD file, and every time a field is encountered, add it as type \"string\"\n\t\twhile (this.pos < this.lines.length)\n\t\t{\n\t\t\tlet line = this.lines[this.pos++];\n\t\t\tif (!line.startsWith('$$$$')) {entry.push(line); continue;}\n\n\t\t\tlet rn = ds.appendRow();\n\n\t\t\tlet molstr = '';\n\t\t\tlet pos = 0;\n\t\t\twhile (pos < entry.length)\n\t\t\t{\n\t\t\t\tline = entry[pos];\n\t\t\t\tif (line.startsWith('> ')) break;\n\t\t\t\tmolstr += line + '\\n';\n\t\t\t\tpos++;\n\t\t\t\tif (line.startsWith('M\tEND')) break;\n\t\t\t}\n\n\t\t\tlet mol:Molecule = null, name:string = null;\n\t\t\ttry\n\t\t\t{\n\t\t\t\tif (molstr.length > 0)\n\t\t\t\t{\n\t\t\t\t\tlet mdl = new MDLMOLReader(molstr);\n\t\t\t\t\tmdl.parse();\n\t\t\t\t\tmol = mdl.mol;\n\t\t\t\t\tname = mdl.molName;\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (ex)\n\t\t\t{\n\t\t\t\t/*let msg = \"Failed to parse CTAB, row#\" + (rn + 1) + \":\\n\" + molstr;\n\t\t\t\tif (fatalMolFailures) throw new IOException(msg,ex);\n\t\t\t\telse if (reportMolFailures) Util.errmsg(msg, ex);*/\n\t\t\t\t// (leave the molecule null\n\t\t\t}\n\t\t\tif (mol != null) ds.setMolecule(rn, 0, mol);\n\t\t\tif (name)\n\t\t\t{\n\t\t\t\tif (colName < 0) colName = ds.appendColumn('Name', DataSheetColumn.String, 'Molecule name');\n\t\t\t\tds.setString(rn, colName, name);\n\t\t\t}\n\n\t\t\tif (rn == 0 && mol != null)\n\t\t\t{\n\t\t\t\tlet str1 = entry[0], str3 = entry[2];\n\t\t\t\tif (str1.length >= 7 && str1.startsWith('$name='))\n\t\t\t\t{\n\t\t\t\t\tds.changeColumnName(0, str1.substring(6), ds.colDescr(0));\n\t\t\t\t}\n\t\t\t\tif (str3.length >= 8 && str3.startsWith('$title='))\n\t\t\t\t{\n\t\t\t\t\tds.title = str3.substring(7);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (; pos + 1 < entry.length; pos += 3)\n\t\t\t{\n\t\t\t\tlet key = entry[pos], val = entry[pos + 1];\n\t\t\t\tif (!key.startsWith('>')) continue;\n\t\t\t\tlet z = key.indexOf('<');\n\t\t\t\tif (z < 0) continue;\n\t\t\t\tkey = key.substring(z + 1);\n\t\t\t\tz = key.indexOf('>');\n\t\t\t\tif (z < 0) continue;\n\t\t\t\tkey = key.substring(0, z);\n\t\t\t\tif (key.length == 0) continue;\n\n\t\t\t\twhile (pos + 2 < entry.length && entry[pos + 2].length > 0)\n\t\t\t\t{\n\t\t\t\t\tval += '\\n' + entry[pos + 2];\n\t\t\t\t\tpos++;\n\t\t\t\t}\n\n\t\t\t\tlet cn = ds.findColByName(key);\n\t\t\t\tif (cn < 0) cn = ds.appendColumn(key, DataSheetColumn.String, '');\n\n\t\t\t\tif (val.length == 0) ds.setToNull(rn, cn);\n\t\t\t\telse ds.setString(rn, cn, val);\n\t\t\t}\n\n\t\t\tentry = [];\n\t\t}\n\n\t\tif (ds.numRows == 0) this.ds = null;\n\t}\n\n\tprivate upcastStringColumns():void\n\t{\n\t\tlet ds = this.ds;\n\t\tfor (let i = 0; i < ds.numCols; i++) if (ds.colType(i) == DataSheetColumn.String)\n\t\t{\n\t\t\tlet allnull = true, allreal = true, allint = true, allbool = true;\n\t\t\tfor (let j = 0; j < ds.numRows; j++)\n\t\t\t{\n\t\t\t\tif (!allreal && !allint && !allbool) break;\n\t\t\t\tif (ds.isNull(j, i)) continue;\n\n\t\t\t\tallnull = false;\n\n\t\t\t\tlet val = ds.getString(j, i);\n\t\t\t\tif (allbool)\n\t\t\t\t{\n\t\t\t\t\tlet lc = val.toLowerCase();\n\t\t\t\t\tif (lc != 'true' && lc != 'false') allbool = false;\n\t\t\t\t}\n\t\t\t\tif (allint)\n\t\t\t\t{\n\t\t\t\t\tlet int = parseInt(val);\n\t\t\t\t\tif (!isFinite(int) || int != parseFloat(val)) allint = false;\n\t\t\t\t}\n\t\t\t\tif (allreal)\n\t\t\t\t{\n\t\t\t\t\tif (!isFinite(parseFloat(val))) allreal = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (allnull) {} // do nothing\n\t\t\telse if (allint) ds.changeColumnType(i, DataSheetColumn.Integer);\n\t\t\telse if (allreal) ds.changeColumnType(i, DataSheetColumn.Real);\n\t\t\telse if (allbool) ds.changeColumnType(i, DataSheetColumn.Boolean);\n\t\t}\n\t}\n}\n\n","/*\n\tWebMolKit\n\n\t(c) 2010-2022 Molecular Materials Informatics, Inc.\n\n\tAll rights reserved\n\n\thttp://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Vec} from '../util/Vec';\nimport {BondArtifact} from './BondArtifact';\nimport {DataSheet, DataSheetColumn} from './DataSheet';\nimport {ForeignMolecule, ForeignMoleculeTemplateDefn, ForeignMoleculeTransient} from './ForeignMolecule';\nimport {MDLMOL_VALENCE} from './MDLReader';\nimport {Molecule} from './Molecule';\nimport {MolUtil} from './MolUtil';\nimport {PolymerBlock, PolymerBlockConnectivity} from './PolymerBlock';\nimport {QueryUtil} from './QueryUtil';\nimport {StereoGroup} from './StereoGroup';\n\n/*\n\tMDL Molfile writer: convert the native structure format to MDL Molfile. Both the older (V2000) and newer (V3000) formats are\n\tsupported. The older V2000 format is recommended as the default, since every toolkit ever created supports a common subset of\n\tits feature set. While the newer V3000 format is well supported, it is not as ubiquitous, and its feature improvements are not\n\tused by most molecules.\n\n\tMDL SDfile writer: including non-molecule fields in collections. The SDfile format is problematic for as many reasons as the\n\tmolecules; the best strategy is to avoid using it whenever possible, but it is so often not.\n*/\n\ninterface Sgroup\n{\n\ttype:string;\n\tname:string;\n\tatoms:number[];\n\n\t// DAT only\n\tvalue?:string;\n\tunit?:string;\n\tquery?:string;\n\n\t// MUL only\n\tparent?:number;\n\n\t// for SCSR templates\n\tbonds?:number[];\n\ttemplateClass?:string;\n\tnatReplace?:string;\n\tattachPoints?:string[];\n}\n\nconst VPFX = 'M  V30 ';\n\nexport class MDLMOLWriter\n{\n\t// options\n\tpublic includeHeader = true; // if on, the 3 line header will be included\n\tpublic includeCounts = true; // if on, the subsequent 1 line of counts will be included (V3000 only, ignored in V2000 mode)\n\tpublic includeEnd = true; // if on, the final M__END will be included\n\tpublic overallStereoAbsolute = true; // from the counts block, overall true=interpret stereo as absolute; false=interpret as relative\n\tpublic enhancedFields = true; // if on, non-standard MDL fields may be added\n\tpublic chargeSeparate = false; // if on, zero bonds will be split out\n\tpublic abbrevSgroups = true; // if on, abbreviations will be written as Sgroups when possible\n\tpublic polymerBlocks = true; // write polymer blocks, if any\n\tpublic molName = ''; // optional name to include in the header (if any)\n\n\t// provide these template definitions if they need to be written out with the molecule\n\tpublic scsrTemplates:ForeignMoleculeTemplateDefn[] = null;\n\n\t// some number of superatom abbreviation groups, there being several types\n\tprivate sgroups:Sgroup[] = [];\n\n\t// content in progress\n\tprivate lines:string[] = [];\n\n\t// ----------------- public methods -----------------\n\n\tconstructor(public mol:Molecule)\n\t{\n\t}\n\n\t// write out the MDL content (using V2000 format)\n\tpublic write():string\n\t{\n\t\tif (this.includeHeader)\n\t\t{\n\t\t\tthis.lines.push(this.molName);\n\t\t\tthis.lines.push('Generated by WebMolKit');\n\t\t\tthis.lines.push('');\n\t\t}\n\t\tthis.writeCTAB();\n\t\treturn this.lines.join('\\n');\n\t}\n\n\t// writes the content using the newer V3000 format\n\tpublic writeV3000():string\n\t{\n\t\tif (this.includeHeader)\n\t\t{\n\t\t\tthis.lines.push(this.molName);\n\t\t\tthis.lines.push('Generated by WebMolKit');\n\t\t\tthis.lines.push('');\n\t\t}\n\t\tthis.writeCTAB3000();\n\t\treturn this.lines.join('\\n');\n\t}\n\n\t// writes out V3000 if there is metadata that cannot be represented in the older format, V2000 otherwise\n\tpublic writeEither():string\n\t{\n\t\tlet triggered = StereoGroup.hasStereoGroups(this.mol) || this.mol.numAtoms >= 1000 || this.mol.numBonds >= 1000 || Vec.notBlank(this.scsrTemplates);\n\t\tif (!triggered) for (let n = 1; n <= this.mol.numBonds; n++)\n\t\t\tif (this.mol.bondOrder(n) == 0 && QueryUtil.queryBondOrders(this.mol, n) == null) {triggered = true; break;}\n\t\tif (triggered) return this.writeV3000(); else return this.write();\n\t}\n\n\tpublic getResult():string\n\t{\n\t\treturn this.lines.join('\\n');\n\t}\n\n\t// ----------------- private methods -----------------\n\n\t// writes the main block\n   \tprivate writeCTAB():void\n   \t{\n\t\tlet mol = this.mol = this.mol.clone();\n\t\tmol.keepTransient = true;\n\n\t\t// if allowed to write Sgroups, some abbreviations may be retained for the subsequent steps\n\t\tif (MolUtil.hasAnyAbbrev(mol) || ForeignMolecule.hasAnySgroupMultiAttach(mol) || ForeignMolecule.hasAnySgroupMultiRepeat(mol) || ForeignMolecule.hasAnySgroupData(mol))\n\t\t{\n\t\t\tif (this.abbrevSgroups)\n\t\t\t\tthis.partialAbbrevExpansion();\n\t\t\telse\n\t\t\t\tMolUtil.expandAbbrevs(mol, true);\n\t\t\tthis.prepareSgroups();\n\t\t}\n\n\t\t// pre-encode atom lists\n\t\tlet atomList1:string[] = [], atomList2:string[] = [];\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t{\n\t\t\tlet elements:string[] = null;\n\t\t\tlet logic = 'F';\n\t\t\telements = QueryUtil.queryAtomElements(mol, n);\n\t\t\tif (elements == null) {elements = QueryUtil.queryAtomElementsNot(mol, n); logic = 'T';}\n\t\t\tif (elements == null) continue;\n\n\t\t\tmol.setAtomElement(n, 'L');\n\n\t\t\tlet line = this.intrpad(n, 3) + ' ' + logic + '  ' + this.intrpad(elements.length, 3);\n\t\t\tfor (let el of elements) line += this.intrpad(Molecule.elementAtomicNumber(el), 4);\n\t\t\tatomList1.push(line);\n\n\t\t\tline = 'M  ALS ' + this.intrpad(n, 3) + this.intrpad(elements.length, 3) + ' ' + logic + ' ';\n\t\t\tfor (let el of elements) line += this.pad(el, 4);\n\t\t\tatomList2.push(line);\n\t\t}\n\n\t\tthis.lines.push(this.intrpad(mol.numAtoms, 3) + this.intrpad(mol.numBonds, 3) + this.intrpad(atomList1.length, 3) +\n\t\t\t\t\t\t'  0' + (this.overallStereoAbsolute ? '  1' : '  0') + '  0  0  0  0  0999 V2000');\n\n\t\t// data to record in the following M-block\n\t\tlet chgidx:number[] = [], chgval:number[] = [];\n\t\tlet radidx:number[] = [], radval:number[] = [];\n\t\tlet isoidx:number[] = [], isoval:number[] = [];\n\t\tlet rgpidx:number[] = [], rgpval:number[] = [];\n\t\tlet hydidx:number[] = [], hydval:number[] = [];\n\t\tlet zchidx:number[] = [], zchval:number[] = [];\n\t\tlet zboidx:number[] = [], zboval:number[] = [];\n\t\tlet rbcidx:number[] = [], rbcval:number[] = [];\n\t\tlet subidx:number[] = [], subval:number[] = [];\n\t\tlet unsidx:number[] = [], unsval:number[] = [];\n\n\t\t// export atoms, and make a few notes along the way\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t{\n\t\t\tlet x = mol.atomX(n), y = mol.atomY(n);\n\t\t\tlet z = mol.is3D() ? mol.atomZ(n) : 0;\n\t\t\tlet line = this.rpad(x.toFixed(4), 10) + this.rpad(y.toFixed(4), 10) + this.rpad(z.toFixed(4), 10);\n\n\t\t\tlet el = mol.atomElement(n);\n\t\t\tlet str = el;\n\t\t\tif (str.length > 3) str = str.substring(0, 3);\n\t\t\tif (str.length > 1 && str.charAt(0) == 'R' && str.charAt(1) >= '0' && str.charAt(1) <= '9')\n\t\t\t{\n\t\t\t\trgpidx.push(n);\n\t\t\t\trgpval.push(parseInt(str.substring(1)));\n\t\t\t\tstr = 'R#';\n\t\t\t}\n\t\t\twhile (str.length < 4) str += ' ';\n\t\t\tline += ' ' + str + '0';\n\n\t\t\tlet chg = mol.atomCharge(n), rad = mol.atomUnpaired(n), mapnum = mol.atomMapNum(n);\n\t\t\tif (chg >= -3 && chg <= -1) chg = 4 - chg;\n\t\t\telse if (chg == 0 && rad == 2) chg = 4;\n\t\t\telse if (chg >= 1 && chg <= 3) chg = 4 - chg;\n\t\t\telse chg = 0;\n\n\t\t\tlet qhyd = QueryUtil.queryAtomHydrogens(mol, n);\n\t\t\tlet hyd = 0;\n\t\t\tif (Vec.len(qhyd) == 1) hyd = qhyd[0] + 1;\n\n\t\t\tlet val = this.mdlValence(mol, n, 15);\n\n\t\t\tline += this.intrpad(chg, 3) + '  0' + this.intrpad(hyd, 3) + '  0' + this.intrpad(val, 3) + '  0  0  0' + this.intrpad(mapnum, 3) + '  0  0';\n\n\t\t\tthis.lines.push(line);\n\n\t\t\tif (mol.atomCharge(n) != 0) {chgidx.push(n); chgval.push(mol.atomCharge(n));}\n\t\t\tif (this.enhancedFields)\n\t\t\t{\n\t\t\t\tif (mol.atomHExplicit(n) != Molecule.HEXPLICIT_UNKNOWN) {hydidx.push(n); hydval.push(mol.atomHExplicit(n));}\n\t\t   \t}\n\n\t\t\tif (rad == 1) {radidx.push(n); radval.push(2);}\n\t\t\tif (rad == 2) {radidx.push(n); radval.push(1);}\n\t\t\tif (mol.atomIsotope(n) != Molecule.ISOTOPE_NATURAL) {isoidx.push(n); isoval.push(mol.atomIsotope(n));}\n\n\t\t\tlet qrbc = QueryUtil.queryAtomRingBonds(mol, n), qsub = QueryUtil.queryAtomAdjacency(mol, n);\n\t\t\tlet quns = QueryUtil.queryAtomUnsaturated(mol, n);\n\t\t\tif (Vec.len(qrbc) == 1) {rbcidx.push(n); rbcval.push(qrbc[0] == 0 ? -1 : qrbc[0]);}\n\t\t\tif (Vec.len(qsub) == 1) {subidx.push(n); subval.push(qsub[0] == 0 ? -1 : qsub[0]);}\n\t\t\tif (quns == true) {unsidx.push(n); unsval.push(1);}\n\t\t}\n\n\t\t// export bonds\n\t\tlet maskArom = ForeignMolecule.noteAromaticBonds(mol);\n\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t{\n\t\t\tlet order = mol.bondOrder(n), type = order;\n\t\t\tlet qbond = Vec.sorted(QueryUtil.queryBondOrders(mol, n) ?? []);\n\t\t\tif (maskArom[n - 1] || Vec.equals(qbond, [-1])) type = 4; // the \"aromatic\" type\n\t\t\telse if (Vec.equals(qbond, [1, 2])) type = 5; // the \"single or double\" type\n\t\t\telse if (Vec.equals(qbond, [-1, 1])) type = 6; // the \"single or aromatic\" type\n\t\t\telse if (Vec.equals(qbond, [-1, 2])) type = 7; // the \"double or aromatic\" type\n\t\t\telse if (Vec.equals(qbond, [-1, 0, 1, 2, 3])) type = 8; // the \"any\" type\n\t\t\telse if (type > 3) type = 3; // 4-or-higher bonds are not available\n\n\t\t\tlet stereo = mol.bondType(n);\n\t\t\tif (stereo == Molecule.BONDTYPE_NORMAL) {}\n\t\t\telse if (stereo == Molecule.BONDTYPE_INCLINED)\n\t\t\t{\n\t\t\t\tstereo = 1;\n\t\t\t\t//type = 1; ... documentation says that wedges have to be single\n\t\t\t}\n\t\t\telse if (stereo == Molecule.BONDTYPE_DECLINED)\n\t\t\t{\n\t\t\t\tstereo = 6;\n\t\t\t\t//type = 1; ... documentation says that wedges have to be single\n\t\t\t}\n\t\t\telse if (stereo == Molecule.BONDTYPE_UNKNOWN)\n\t\t\t{\n\t\t\t\tif (type == 1) stereo = 4; else stereo = 3;\n\t\t\t}\n\t\t\telse stereo = 0;\n\n\t\t\tlet line = this.intrpad(mol.bondFrom(n), 3) + this.intrpad(mol.bondTo(n), 3) +\n\t\t\t\t\t   this.intrpad(type, 3) + this.intrpad(stereo, 3) + '  0  0  0';\n\t\t\tthis.lines.push(line);\n\n\t\t\tif (this.enhancedFields)\n\t\t\t{\n\t\t\t\tif ((order < 1 || order > 3) || type != order && Vec.isBlank(qbond)) {zboidx.push(n); zboval.push(order);}\n\t\t\t\t// these are for retroactive bond separation, not implemented at the moment\n\t\t\t\t//if (xmol.bondOrder(n) != mol.bondOrder(n)) {zboidx.push(n); zboval.push(xmol.bondOrder(n));}\n\t\t\t}\n\t\t}\n\n\t\tthis.lines.push(...atomList1);\n\t\tthis.lines.push(...atomList2);\n\n\t\t// export the additional blocks\n\t\tthis.writeMBlockPair('CHG', chgidx, chgval);\n\t\tthis.writeMBlockPair('RAD', radidx, radval);\n\t\tthis.writeMBlockPair('ISO', isoidx, isoval);\n\t\tthis.writeMBlockPair('RGP', rgpidx, rgpval);\n\t\tthis.writeMBlockPair('HYD', hydidx, hydval);\n\t\tthis.writeMBlockPair('ZCH', zchidx, zchval);\n\t\tthis.writeMBlockPair('ZBO', zboidx, zboval);\n\t\tthis.writeMBlockPair('RBC', rbcidx, rbcval);\n\t\tthis.writeMBlockPair('SUB', subidx, subval);\n\t\tthis.writeMBlockPair('UNS', unsidx, unsval);\n\n\t\t// write bond artifacts, one line each\n\t\tif (this.enhancedFields)\n\t\t{\n\t\t\tlet artifacts = new BondArtifact(this.mol);\n\t\t\tlet idx = 0;\n\t\t\tfor (let path of artifacts.getResPaths()) this.writeMBlockFlat('ZPA', ++idx, path.atoms);\n\t\t\tfor (let ring of artifacts.getResRings()) this.writeMBlockFlat('ZRI', ++idx, ring.atoms);\n\t\t\tfor (let arene of artifacts.getArenes()) this.writeMBlockFlat('ZAR', ++idx, Vec.prepend(arene.atoms, arene.centre));\n\t\t}\n\n\t\t// encode Sgroups\n\t\tlet inSgroup = Vec.booleanArray(false, mol.numAtoms);\n\t\tfor (let s = 0; s < this.sgroups.length; s++)\n\t\t{\n\t\t\tlet sg = this.sgroups[s];\n\t\t\tfor (let n of sg.atoms) inSgroup[n - 1] = true;\n\n\t\t\tlet sidx = this.intrpad(s + 1, 4);\n\t\t\tthis.lines.push('M  STY  1' + sidx + ' ' + sg.type);\n\t\t\tfor (let n = 0; n < sg.atoms.length; n += 15)\n\t\t\t{\n\t\t\t\tlet sz = Math.min(sg.atoms.length - n, 15);\n\t\t\t\tlet line = 'M  SAL' + sidx + this.intrpad(sz, 3);\n\t\t\t\tfor (let i = 0; i < sz; i++) line += this.intrpad(sg.atoms[n + i], 4);\n\t\t\t\tthis.lines.push(line);\n\t\t\t}\n\t\t\tif (sg.type != 'DAT') this.lines.push('M  SMT' + sidx + ' ' + sg.name);\n\t\t\tif (sg.type == 'MUL')\n\t\t\t{\n\t\t\t\tlet mult = parseInt(sg.name), unit = sg.atoms.length / mult;\n\t\t\t\tfor (let n = 0; n < unit; n += 15)\n\t\t\t\t{\n\t\t\t\t\tlet sz = Math.min(unit - n, 15);\n\t\t\t\t\tlet line = 'M  SPA' + sidx + this.intrpad(sz, 3);\n\t\t\t\t\tfor (let i = 0; i < sz; i++) line += this.intrpad(sg.atoms[n + i], 4);\n\t\t\t\t\tthis.lines.push(line);\n\t\t\t\t}\n\t\t\t\tif (sg.parent > 0) this.lines.push('M  SPL    1' + sidx + this.intrpad(sg.parent, 4));\n\t\t\t}\n\t\t\tif (sg.type == 'DAT')\n\t\t\t{\n\t\t\t\tthis.lines.push('M  SDT' + sidx + ' ' + this.pad(sg.name, 32) + this.pad(sg.unit, 20) + sg.query);\n\t\t\t\tthis.lines.push('M  SED' + sidx + ' ' + sg.value);\n\t\t\t}\n\t\t}\n\n\t\tif (this.polymerBlocks) this.encodePolymerBlocks(this.sgroups.length);\n\n\t\t// export long atom names\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (mol.atomElement(n).length > 2)\n\t\t{\n\t\t\tthis.lines.push('A  ' + this.intrpad(n, 3));\n\t\t\tthis.lines.push(mol.atomElement(n));\n\t\t}\n\n\t\tif (this.includeEnd) this.lines.push('M  END');\n   \t}\n\n\t// writes a specific sub-block, e.g. M__CHG, etc., where each pair of idx/val is a separate entity\n\tprivate writeMBlockPair(token:string, idx:number[], val:number[])\n\t{\n\t\tconst sz = idx.length;\n\t\tfor (let i = 0; i < sz; i += 8)\n\t\t{\n\t\t\tlet count = Math.min(8, sz - i);\n\t\t\tlet line = 'M  ' + token + this.intrpad(count, 3);\n\t\t\tfor (let j = 0; j < count; j++) line += this.intrpad(idx[i + j], 4) + this.intrpad(val[i + j], 4);\n\t\t\tthis.lines.push(line);\n\t\t}\n\t}\n\n\t// writes a specific sub-block, whereby the master index corresponds to some number of values; these are split over multiple\n\t// lines if necessary\n\tprivate writeMBlockFlat(token:string, idx:number, val:number[])\n\t{\n\t\tconst sz = val.length;\n\t\tfor (let i = 0; i < sz; i += 15)\n\t\t{\n\t\t\tlet count = Math.min(15, sz - i);\n\t\t\tlet line = 'M  ' + token + this.intrpad(count, 3) + this.intrpad(idx, 4);\n\t\t\tfor (let j = 0; j < count; j++) line += this.intrpad(val[i + j], 4);\n\t\t\tthis.lines.push(line);\n\t\t}\n\t}\n\tprivate writeMBlockFlatIdxFirst(token:string, idx:number, val:number[])\n\t{\n\t\tconst sz = val.length;\n\t\tfor (let i = 0; i < sz; i += 15)\n\t\t{\n\t\t\tlet count = Math.min(15, sz - i);\n\t\t\tlet line = 'M  ' + token + this.intrpad(idx, 4) + this.intrpad(count, 3);\n\t\t\tfor (let j = 0; j < count; j++) line += this.intrpad(val[i + j], 4);\n\t\t\tthis.lines.push(line);\n\t\t}\n\t}\n\n\t// convenient formatting\n\tprivate intrpad(num:number, sz:number):string\n\t{\n\t\treturn this.rpad(num.toString(), sz);\n\t}\n\tprivate rpad(str:string, sz:number):string\n\t{\n\t\twhile (str.length < sz) str = ' ' + str;\n\t\treturn str;\n\t}\n\tprivate pad(str:string, sz:number):string\n\t{\n\t\twhile (str.length < sz) str += ' ';\n\t\treturn str;\n\t}\n\n\t// figures out the MDL valence override, if any; a return value of 0 means that the calculated default will suffice; if the value\n\t// needs to be explicitly zero, the 'zeroVal' parameter is returned (should be 15 for V2000, -1 for V3000)\n\tprivate mdlValence(mol:Molecule, atom:number, zeroVal:number):number\n\t{\n\t\tlet marked = ForeignMolecule.noteExplicitValence(mol, atom);\n\t\tif (marked != null) return marked > 0 ? marked : zeroVal;\n\n\t\tlet hyd = mol.atomHydrogens(atom), el = mol.atomElement(atom);\n\t\tlet options = MDLMOL_VALENCE[el];\n\n\t\t// if no implicit valence, and no hydrogens: no need\n\t\tif (options == null && hyd == 0) return 0;\n\n\t\tlet chg = mol.atomCharge(atom);\n\t\tlet chgmod = (el == 'C' || el == 'H') ? Math.abs(chg) : el == 'B' ? -Math.abs(chg) : -chg;\n\t\tlet bondSum = 0;\n\t\tfor (let b of mol.atomAdjBonds(atom)) bondSum += mol.bondOrder(b);\n\t\tlet nativeVal = chgmod + /*mol.atomUnpaired(atom) +*/ hyd + bondSum;\n\n\t\t// if this is consistent with an existing valence option, no need\n\t\tif (options?.includes(nativeVal)) return 0;\n\n\t\t// NOTE: in cases with multiple valence options, like S[2,4,6], it would be possible to leave the valence unmarked\n\t\t// when the previous state is indicated, e.g. for S{val=3} ==> +1 H to get to val=4; or we could just mark the\n\t\t// valence, since the first one is always overwhelmingly the default\n\n\t\tlet val = nativeVal - chgmod;\n\t\treturn val <= 0 || val > 14 ? zeroVal : val;\n\t}\n\n\t// processes the structure so that any non-trivial abbreviations (multiple attachment points/different bond orders) are expanded, and also makes\n\t// sure that any remaining abbreviations have no nesting within them\n\tprivate partialAbbrevExpansion():void\n\t{\n\t\tconst {mol} = this;\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (MolUtil.hasAbbrev(mol, n))\n\t\t{\n\t\t\tlet frag = MolUtil.getAbbrev(mol, n);\n\t\t\tif (frag == null || mol.atomAdjCount(n) != 1) {MolUtil.clearAbbrev(mol, n); continue;}\n\n\t\t\tif (MolUtil.hasAnyAbbrev(frag))\n\t\t\t{\n\t\t\t\tMolUtil.expandAbbrevs(frag, true);\n\t\t\t\tMolUtil.setAbbrev(mol, n, frag);\n\t\t\t}\n\n\t\t\tlet order = mol.bondOrder(mol.atomAdjBonds(n)[0]);\n\t\t\tif (frag.atomAdjCount(1) == 1 && order == frag.bondOrder(frag.atomAdjBonds(1)[0])) continue;\n\n\t\t\tMolUtil.expandOneAbbrev(mol, n, true);\n\t\t\tn--;\n\t\t}\n\t}\n\n\t// any remaining abbreviations within the molecule get turned into S-groups\n\tprivate prepareSgroups():void\n\t{\n\t\tconst {mol} = this;\n\n\t\t// note: using -ve atom mapping numbers to disambiguate\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (mol.atomMapNum(n) < 0) mol.setAtomMapNum(n, 0);\n\t\tlet next = 0;\n\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (MolUtil.hasAbbrev(mol, n))\n\t\t{\n\t\t\tthis.sgroups.push({type: 'SUP', name: mol.atomElement(n), atoms: null});\n\t\t\tlet mask = MolUtil.expandOneAbbrev(mol, n, true);\n\t\t\tif (mask == null) continue;\n\t\t\tnext--;\n\t\t\tfor (let i = 0; i < mask.length; i++) if (mask[i]) mol.setAtomMapNum(i + 1, next);\n\n\t\t\tn--;\n\t\t}\n\n\t\t// extract the layers one at a time\n\t\tfor (let idx = -1, p = 0; idx >= next; idx--, p++)\n\t\t{\n\t\t\tlet atoms:number[] = [];\n\t\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (mol.atomMapNum(n) == idx)\n\t\t\t{\n\t\t\t\tatoms.push(n);\n\t\t\t\tmol.setAtomMapNum(n, 0);\n\t\t\t}\n\t\t\tthis.sgroups[p].atoms = atoms;\n\t\t}\n\n\t\t// also encode foreign-annotated Sgroups\n\t\tfor (let ma of ForeignMolecule.noteAllSgroupMultiAttach(mol))\n\t\t{\n\t\t\tlet sg:Sgroup = {type: 'SUP', name: ma.name, atoms: ma.atoms};\n\n\t\t\tlet str = ma.keyval['bonds'];\n\t\t\tif (str) sg.bonds = str.split(' ').map((v) => parseInt(v));\n\n\t\t\tsg.templateClass = ma.keyval['templateClass'] ;\n\t\t\tsg.natReplace = ma.keyval['natReplace'];\n\n\t\t\tstr = ma.keyval['attachPoints'];\n\t\t\tif (str) sg.attachPoints = str.split(' ');\n\n\t\t\tthis.sgroups.push(sg);\n\t\t}\n\t\tfor (let mr of ForeignMolecule.noteAllSgroupMultiRepeat(mol)) this.sgroups.push({type: 'MUL', name: mr.mult.toString(), atoms: mr.atoms});\n\t\tfor (let dat of ForeignMolecule.noteAllSgroupData(mol)) this.sgroups.push({type: 'DAT', name: dat.name, value: dat.value, unit: dat.unit, query: dat.query, atoms: dat.atoms});\n\n\t\t// whenever a MUL group is subsumed by another, need to name that as the parent\n\t\tfor (let n = 0; n < this.sgroups.length; n++)\n\t\t{\n\t\t\tlet sg = this.sgroups[n];\n\t\t\tif (sg.type != 'MUL') continue;\n\t\t\tlet bestIdx = -1, bestSize = Number.MAX_SAFE_INTEGER;\n\t\t\tskip: for (let i = 0; i < this.sgroups.length; i++) if (i != n)\n\t\t\t{\n\t\t\t\tlet look = this.sgroups[i];\n\t\t\t\tif (look.type != 'MUL' || look.atoms.length >= bestSize) continue;\n\t\t\t\tfor (let a of sg.atoms) if (!look.atoms.includes(a)) continue skip;\n\t\t\t\tbestIdx = i;\n\t\t\t\tbestSize = look.atoms.length;\n\t\t\t}\n\t\t\tif (bestIdx >= 0) sg.parent = bestIdx + 1;\n\t\t}\n\t}\n\n\t// use a variant of Sgroups for any polymer blocks\n\tprivate encodePolymerBlocks(idx:number):void\n\t{\n\t\tlet polymers = new PolymerBlock(this.mol);\n\t\tfor (let id of polymers.getIDList())\n\t\t{\n\t\t\tlet unit = polymers.getUnit(id);\n\t\t\tlet sidx = this.intrpad(++idx, 4);\n\t\t\tthis.lines.push('M  STY  1' + sidx + ' SRU');\n\n\t\t\tif (unit.connect == PolymerBlockConnectivity.HeadToTail) this.lines.push('M  SCN  1' + sidx + ' HT ');\n\t\t\telse if (unit.connect == PolymerBlockConnectivity.HeadToHead) this.lines.push('M  SCN  1' + sidx + ' HH ');\n\t\t\telse if (unit.connect == PolymerBlockConnectivity.Random) this.lines.push('M  SCN  1' + sidx + ' EU ');\n\n\t\t\tthis.writeMBlockFlatIdxFirst('SAL', idx, unit.atoms);\n\n\t\t\tlet bonds:number[] = null;\n\t\t\tfor (let n = 1; n <= this.mol.numBonds; n++)\n\t\t\t{\n\t\t\t\tlet fl1 = unit.atoms.indexOf(this.mol.bondFrom(n)) >= 0, fl2 = unit.atoms.indexOf(this.mol.bondTo(n)) >= 0;\n\t\t\t\tif ((fl1 && !fl2) || (!fl1 && fl2)) bonds = Vec.append(bonds, n);\n\t\t\t}\n\t\t\tif (bonds != null) this.writeMBlockFlatIdxFirst('SBL', idx, bonds);\n\n\t\t\tif (Vec.len(unit.bondConn) == 4)\n\t\t\t{\n\t\t\t\tlet bcrs = [unit.bondConn[0], unit.bondConn[2], unit.bondConn[1]];\n\t\t\t\tthis.writeMBlockFlatIdxFirst('CRS', idx, bcrs);\n\t\t\t}\n\n\t\t\tthis.lines.push('M  SMT' + sidx + ' n');\n\t\t}\n\t}\n\n\tpublic writeCTAB3000():void\n\t{\n\t\tlet mol = this.mol;\n\n\t\t// if allowed to write Sgroups, some abbreviations may be retained for the subsequent steps\n\t\tif (MolUtil.hasAnyAbbrev(mol) || ForeignMolecule.hasAnySgroupMultiAttach(mol) || ForeignMolecule.hasAnySgroupMultiRepeat(mol) || ForeignMolecule.hasAnySgroupData(mol))\n\t\t{\n\t\t\tmol = this.mol = mol.clone();\n\t\t\tmol.keepTransient = true;\n\t\t\tif (this.abbrevSgroups)\n\t\t\t\tthis.partialAbbrevExpansion();\n\t\t\telse\n\t\t\t\tMolUtil.expandAbbrevs(mol, true);\n\t\t\tthis.prepareSgroups();\n\t\t}\n\n\t\tlet sgroupText = this.populateV3000Sgroups();\n\n\t\tif (this.includeCounts) this.lines.push('  0  0  0     0  0            999 V3000');\n\t\tthis.lines.push(VPFX + 'BEGIN CTAB');\n\n\t\tthis.lines.push(VPFX + `COUNTS ${mol.numAtoms} ${mol.numBonds} ${sgroupText.length} 0 ${this.overallStereoAbsolute ? 1 : 0}`);\n\n\t\tthis.lines.push(VPFX + 'BEGIN ATOM');\n\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t{\n\t\t\tlet label = mol.atomElement(n);\n\n\t\t\tlet qel = QueryUtil.queryAtomElements(mol, n);\n\t\t\tif (qel != null) label = '[' + qel.join(',') + ']';\n\t\t\telse\n\t\t\t{\n\t\t\t\tqel = QueryUtil.queryAtomElementsNot(mol, n);\n\t\t\t\tif (qel != null) label = 'NOT [' + qel.join(',') + ']';\n\t\t\t}\n\n\t\t\tif (label.includes(' ')) label = `\"${label}\"`;\n\t\t\tlet x = mol.atomX(n), y = mol.atomY(n);\n\t\t\tlet z = mol.is3D() ? mol.atomZ(n) : 0;\n\t\t\tlet mapnum = mol.atomMapNum(n), chg = mol.atomCharge(n), unp = mol.atomUnpaired(n);\n\t\t\tlet isotope = mol.atomIsotope(n), val = this.mdlValence(mol, n, -1);\n\n\t\t\tlet line = `${VPFX}${n} ${label} ${x.toFixed(4)} ${y.toFixed(4)} ${z.toFixed(4)} ${mapnum}`;\n\n\t\t\tif (chg != 0) line += ' CHG=' + chg;\n\t\t\tif (unp == 1) line += ' RAD=2';\n\t\t\telse if (unp == 2) line += ' RAD=1';\n\t\t\tif (isotope != 0) line += ' MASS=' + isotope;\n\t\t\tif (val != 0) line += ' VAL=' + val;\n\n\t\t\tlet qhyd = QueryUtil.queryAtomHydrogens(mol, n), qrbc = QueryUtil.queryAtomRingBonds(mol, n), qsub = QueryUtil.queryAtomAdjacency(mol, n);\n\t\t\tlet quns = QueryUtil.queryAtomUnsaturated(mol, n);\n\t\t\tif (Vec.len(qhyd) == 1) line += ' HCOUNT=' + (qhyd[0] == 0 ? -1 : qhyd[0]);\n\t\t\tif (Vec.len(qrbc) == 1) line += ' RBCNT=' + (qrbc[0] == 0 ? -1 : qrbc[0]);\n\t\t\tif (Vec.len(qsub) == 1) line += ' SUBST=' + (qsub[0] == 0 ? -1 : qsub[0]);\n\t\t\tif (quns == true) line += ' UNSAT=1';\n\n\t\t\tfor (let trans of mol.atomTransient(n))\n\t\t\t{\n\t\t\t\tif (trans.startsWith(ForeignMoleculeTransient.AtomSCSRClass)) line += ' CLASS=' + trans.substring(ForeignMoleculeTransient.AtomSCSRClass.length + 1);\n\t\t\t\telse if (trans.startsWith(ForeignMoleculeTransient.AtomSCSRSeqID)) line += ' SEQID=' + trans.substring(ForeignMoleculeTransient.AtomSCSRSeqID.length + 1);\n\t\t\t\telse if (trans.startsWith(ForeignMoleculeTransient.AtomSCSRAttchOrd))\n\t\t\t\t{\n\t\t\t\t\tlet bits = trans.substring(ForeignMoleculeTransient.AtomSCSRAttchOrd.length + 1).split(',');\n\t\t\t\t\tline += ' ATTCHORD=' + this.packV3000Strings(bits);\n\t\t\t\t}\n\t\t\t}\n\n\n\t\t\tthis.lines.push(line);\n\t\t}\n\n\t\tthis.lines.push(VPFX + 'END ATOM');\n\n\t\tif (mol.numBonds > 0)\n\t\t{\n\t\t\tthis.lines.push(VPFX + 'BEGIN BOND');\n\n\t\t\tlet maskArom = ForeignMolecule.noteAromaticBonds(mol);\n\t\t\tlet maskHBond = ForeignMolecule.noteZeroHydrogenBonds(mol); // (note: dative bond is the default kind of 0-order bond, so only need to note h-bond subclass\n\t\t\n\t\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t\t{\n\t\t\t\tlet bfr = mol.bondFrom(n), bto = mol.bondTo(n);\n\t\t\t\tlet order = mol.bondOrder(n), type = order;\n\t\t\t\tlet qbond = Vec.sorted(QueryUtil.queryBondOrders(mol, n) ?? []);\n\t\t\t\tif (maskArom[n - 1] || Vec.equals(qbond, [-1])) type = 4; // the \"aromatic\" type\n\t\t\t\telse if (Vec.equals(qbond, [1, 2])) type = 5; // the \"single or double\" type\n\t\t\t\telse if (Vec.equals(qbond, [-1, 1])) type = 6; // the \"single or aromatic\" type\n\t\t\t\telse if (Vec.equals(qbond, [-1, 2])) type = 7; // the \"double or aromatic\" type\n\t\t\t\telse if (Vec.equals(qbond, [-1, 0, 1, 2, 3])) type = 8; // the \"double or aromatic\" type\n\t\t\t\telse if (type == 0) \n\t\t\t\t{\n\t\t\t\t\tif (!maskHBond[n - 1])\n\t\t\t\t\t\ttype = 9; // the \"coordination\" type\n\t\t\t\t\telse\n\t\t\t\t\t\ttype = 10; // the \"H-bond\" type\n\t\t\t\t}\n\t\t\t\telse if (type > 3) type = 3; // 4-or-higher bonds are not available\n\n\t\t\t\tlet stereo = mol.bondType(n);\n\n\t\t\t\tlet line = `${VPFX}${n} ${type} ${bfr} ${bto}`;\n\n\t\t\t\tif (stereo == Molecule.BONDTYPE_INCLINED) line += ' CFG=1';\n\t\t\t\telse if (stereo == Molecule.BONDTYPE_DECLINED) line += ' CFG=3';\n\t\t\t\telse if (stereo == Molecule.BONDTYPE_UNKNOWN) line += ' CFG=2';\n\n\t\t\t\tif (order == 0 && !maskHBond[n - 1]) line += ' DISP=COORD';\n\n\t\t\t\tthis.lines.push(line);\n\t\t\t}\n\n\t\t\tthis.lines.push(VPFX + 'END BOND');\n\t\t}\n\n\t\tif (sgroupText.length > 0)\n\t\t{\n\t\t\tthis.lines.push(VPFX + 'BEGIN SGROUP');\n\t\t\tthis.lines.push(...sgroupText);\n\t\t\tthis.lines.push(VPFX + 'END SGROUP');\n\t\t}\n\n\t\tlet collections:string[] = [];\n\n\t\tlet stereoGroup = new StereoGroup(mol);\n\t\tlet racidx = 0, relidx = 0;\n\t\tfor (let atoms of stereoGroup.getRacemicAtoms()) collections.push(VPFX + 'MDLV30/STERAC' + (++racidx) + ' ATOMS=' + this.packV3000List(atoms));\n\t\tfor (let atoms of stereoGroup.getRelativeAtoms()) collections.push(VPFX + 'MDLV30/STEREL' + (++relidx) + ' ATOMS=' + this.packV3000List(atoms));\n\n\t\tif (collections.length > 0)\n\t\t{\n\t\t\tthis.lines.push(VPFX + 'BEGIN COLLECTION');\n\t\t\tthis.lines.push(...collections);\n\t\t\tthis.lines.push(VPFX + 'END COLLECTION');\n\t\t}\n\n\t\tthis.lines.push(VPFX + 'END CTAB');\n\n\t\tif (Vec.notBlank(this.scsrTemplates)) this.populateSCSRTemplates();\n\n\t\tif (this.includeEnd) this.lines.push('M  END');\n\t}\n\n\tprivate populateV3000Sgroups():string[]\n\t{\n\t\tlet mol = this.mol;\n\t\tlet lines:string[] = [];\n\n\t\tfor (let s = 0; s < this.sgroups.length; s++)\n\t\t{\n\t\t\tlet sg = this.sgroups[s];\n\t\t\tlet sid = lines.length + 1;\n\n\t\t\tlet txt = `${VPFX}${sid} ${sg.type} 0`;\n\t\t\tif (sg.type == 'SUP')\n\t\t\t{\n\t\t\t\ttxt += ' LABEL=' + (sg.name.includes(' ') ? `\"${sg.name}\"` : sg.name);\n\t\t\t\ttxt += ' ATOMS=' + this.packV3000List(sg.atoms);\n\t\t\t\tif (sg.bonds) txt += ' XBONDS=' + this.packV3000List(sg.bonds);\n\t\t\t\tif (sg.templateClass) txt += ' CLASS=' + sg.templateClass;\n\t\t\t\tif (sg.natReplace) txt += ' NATREPLACE=' + sg.natReplace;\n\t\t\t\tif (sg.attachPoints)\n\t\t\t\t{\n\t\t\t\t\tfor (let n = 0; n + 2 < sg.attachPoints.length; n += 3)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet v1 = sg.attachPoints[n], v2 = sg.attachPoints[n + 1], v3 = sg.attachPoints[n + 2];\n\t\t\t\t\t\ttxt += ` SAP=(3 ${v1} ${v2} ${v3})`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (sg.type == 'MUL')\n\t\t\t{\n\t\t\t\tlet mult = parseInt(sg.name), unit = sg.atoms.length / mult;\n\t\t\t\ttxt += ' MULT=' + sg.name;\n\t\t\t\ttxt += ' ATOMS=' + this.packV3000List(sg.atoms);\n\t\t\t\ttxt += ' PATOMS=' + this.packV3000List(sg.atoms.slice(0, unit));\n\t\t\t\tif (sg.parent > 0) txt += ' PARENT=' + sg.parent;\n\t\t\t}\n\t\t\telse if (sg.type == 'DAT')\n\t\t\t{\n\t\t\t\ttxt += ' ATOMS=' + this.packV3000List(sg.atoms);\n\t\t\t\ttxt += ' FIELDNAME=' + (sg.name.includes(' ') ? `\"${sg.name}\"` : sg.name);\n\t\t\t\ttxt += ' FIELDDATA=' + (sg.value.includes(' ') ? `\"${sg.value}\"` : sg.value);\n\t\t\t}\n\t\t\tlines.push(txt);\n\t\t}\n\n\t\tif (this.polymerBlocks)\n\t\t{\n\t\t\tlet polymers = new PolymerBlock(mol);\n\t\t\tfor (let id of polymers.getIDList())\n\t\t\t{\n\t\t\t\tlet sid = lines.length + 1;\n\t\t\t\tlet unit = polymers.getUnit(id);\n\n\t\t\t\tlet txt = `${VPFX}${sid} SRU 0`;\n\n\t\t\t\ttxt += ' ATOMS=' + this.packV3000List(unit.atoms);\n\n\t\t\t\tif (unit.connect == PolymerBlockConnectivity.HeadToTail) txt += ' CONNECT=HT';\n\t\t\t\telse if (unit.connect == PolymerBlockConnectivity.HeadToHead) txt += ' CONNECT=HH';\n\t\t\t\telse if (unit.connect == PolymerBlockConnectivity.Random) txt += ' CONNECT=EU';\n\n\t\t\t\tlet bonds:number[] = [];\n\t\t\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t\t\t{\n\t\t\t\t\tlet fl1 = unit.atoms.includes(mol.bondFrom(n)), fl2 = unit.atoms.includes(mol.bondTo(n));\n\t\t\t\t\tif ((fl1 && !fl2) || (!fl1 && fl2)) bonds.push(n);\n\t\t\t\t}\n\t\t\t\tif (bonds.length > 0) txt += ' BONDS=' + this.packV3000List(bonds);\n\n\t\t\t\tif (unit.bondConn != null) txt += ' XBCORR=' + this.packV3000List(unit.bondConn);\n\n\t\t\t\tlines.push(txt);\n\t\t\t}\n\t\t}\n\n\t\treturn lines;\n\t}\n\n\tprivate populateSCSRTemplates():void\n\t{\n\t\tthis.lines.push(VPFX + 'BEGIN TEMPLATE');\n\t\tfor (let n = 0; n < this.scsrTemplates.length; n++)\n\t\t{\n\t\t\tvar defn = this.scsrTemplates[n];\n\t\t\tlet line = VPFX + 'TEMPLATE ' + (n + 1) + ' ' + defn.name;\n\t\t\tif (defn.natReplace) line += ' NATREPLACE=' + defn.natReplace;\n\t\t\tthis.lines.push(line);\n\n\t\t\tvar tmdl = new MDLMOLWriter(defn.mol);\n\t\t\ttmdl.includeHeader = false;\n\t\t\ttmdl.includeCounts = false;\n\t\t\ttmdl.includeEnd = false;\n\t\t\tlet molfile = tmdl.writeV3000();\n\t\t\tfor (line of molfile.trimEnd().split('\\n')) this.lines.push(line);\n\t\t}\n\t\tthis.lines.push(VPFX + 'END TEMPLATE');\n\t}\n\n\tprivate packV3000List(values:number[]):string\n\t{\n\t\tlet str = '(' + values.length;\n\t\tfor (let v of values) str += ' ' + v;\n\t\treturn str + ')';\n\t}\n\tprivate packV3000Strings(values:string[]):string\n\t{\n\t\tlet str = '(' + values.length;\n\t\tfor (let v of values) str += ' ' + v;\n\t\treturn str + ')';\n\t}\n}\n\nexport class MDLSDFWriter\n{\n\t// options\n\tpublic enhancedFields = true; // if on, non-standard MDL fields may be added\n\tpublic chargeSeparate = false; // if on, zero bonds will be split out\n\tpublic abbrevSgroups = true; // if on, abbreviations will be written as Sgroups when possible\n\n\t// content in progress\n\tprivate lines:string[] = [];\n\n\t// ----------------- public methods -----------------\n\n\tconstructor(public ds:DataSheet)\n\t{\n\t}\n\n\t// write out the MDL content\n\tpublic write():string\n\t{\n\t\tlet ds = this.ds, lines = this.lines;\n\t\tlet colMol = this.ds.firstColOfType(DataSheetColumn.Molecule);\n\n\t\tfor (let i = 0; i < ds.numRows; i++)\n\t\t{\n\t\t\tlet mol = colMol < 0 ? null : ds.getMolecule(i, colMol);\n\t\t\tif (mol != null /*MolUtil.notBlank(mol)*/)\n\t\t\t{\n\t\t\t\tlet wtr = new MDLMOLWriter(mol);\n\t\t\t\twtr.enhancedFields = this.enhancedFields;\n\t\t\t\twtr.chargeSeparate = this.chargeSeparate;\n\t\t\t\twtr.abbrevSgroups = this.abbrevSgroups;\n\t\t\t\tlet molstr = wtr.write();\n\t\t\t\tlines.push(molstr);\n\t\t\t}\n\n\t\t\tfor (let j = 0; j < ds.numCols; j++) if (j != colMol && ds.notNull(i, j))\n\t\t\t{\n\t\t\t\tlet ct = ds.colType(j);\n\t\t\t\tlet val = '';\n\t\t\t\tif (ct == DataSheetColumn.String) val = ds.getString(i, j);\n\t\t\t\telse if (ct == DataSheetColumn.Integer) val = ds.getInteger(i, j).toString();\n\t\t\t\telse if (ct == DataSheetColumn.Real) val = ds.getReal(i, j).toString();\n\t\t\t\telse if (ct == DataSheetColumn.Boolean) val = ds.getBoolean(i, j) ? 'true' : 'false';\n\n\t\t\t\tif (val != '')\n\t\t\t\t{\n\t\t\t\t\tlines.push('> <' + ds.colName(j) + '>');\n\t\t\t\t\tlines.push(val);\n\t\t\t\t\tlines.push('');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlines.push('$$$$');\n\t\t}\n\n\t\treturn lines.join('\\n');\n\t}\n\n\tpublic getResult():string\n\t{\n\t\treturn this.lines.join('\\n');\n\t}\n\n\t// ----------------- private methods -----------------\n\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {MDLMOLReader} from './MDLReader';\nimport {MDLMOLWriter} from './MDLWriter';\nimport {Molecule} from './Molecule';\n\n/*\n\tSerialisation and deserialisation utilities for the Molecule object.\n\n\tNote that the native format (\"SketchEl\") is entirely lossless. Other molecule formats, such as MDL MOL, are lossless\n\tfor a large subset of common organic chemistry use-cases, but there is a lot of missing overlap between the two.\n*/\n\nexport class MoleculeStream\n{\n\t// tries to read a format-unknown molecule, with whatever tools are currently available\n\tpublic static readUnknown(strData:string):Molecule\n\t{\n\t\t// see if it's a JSON-encoded SketchEl string\n\t\tif (strData.startsWith('\"'))\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tlet jsonStr = JSON.parse(strData);\n\t\t\t\tlet mol = MoleculeStream.readNative(jsonStr);\n\t\t\t\tif (mol) return mol;\n\t\t\t}\n\t\t\tcatch (ex) {}\n\t\t}\n\n\t\tlet mol = MoleculeStream.readNative(strData);\n\t\tif (mol) return mol;\n\t\ttry {mol = MoleculeStream.readMDLMOL(strData);}\n\t\tcatch (e) {}\n\t\t// (... add others as available ...)\n\t\treturn mol;\n\t}\n\n\t// static method: reads in a string that is presumed to be in SketchEl format, and returns a fully instantiated Molecule; returns\n\t// null if anything went wrong\n\tpublic static readNative(strData:string):Molecule\n\t{\n\t\tlet mol = new Molecule();\n\t\tmol.keepTransient = true;\n\n\t\tlet lines = strData.split(/\\r?\\n/);\n\t\tif (lines.length < 2) return null; // cannot be valid\n\n\t\t// special deal: a clipboard hack that glues together MDL+SketchEl can be easily handled\n\t\tif (!lines[0].startsWith('SketchEl!') && lines.length >= 4 && lines[3].indexOf('V2000') >= 0)\n\t\t{\n\t\t\tlet i = strData.indexOf('SketchEl!');\n\t\t\tif (i < 0) return null;\n\t\t\tlines = strData.substring(i).split(/r?\\n/);\n\t\t}\n\n\t\t// opening and closing lines\n\t\tlet hdr = lines[0].match(/^SketchEl\\!\\((\\d+)\\,(\\d+)\\)/);\n\t\tif (!hdr) return null;\n\t\tlet numAtoms = parseInt(hdr[1]), numBonds = parseInt(hdr[2]);\n\t\tif (lines.length < 2 + numAtoms + numBonds) return null;\n\t\tif (!lines[1 + numAtoms + numBonds].match(/^!End/)) return null;\n\n\t\tfor (let n = 0; n < numAtoms; n++)\n\t\t{\n\t\t\tlet bits = lines[1 + n].split(/[=,;]/);\n\t\t\tlet num = mol.addAtom(MoleculeStream.skUnescape(bits[0]), parseFloat(bits[1]), parseFloat(bits[2]), parseInt(bits[3]), parseInt(bits[4]));\n\t\t\tlet extra:string[] = [], trans:string[] = [];\n\t\t\tfor (let i = 5; i < bits.length; i++)\n\t\t\t{\n\t\t\t\tlet ch = bits[i].charAt(0);\n\t\t\t\tif (bits[i].charAt(0) == 'i') {} // ignore\n\t\t\t\telse if (bits[i].charAt(0) == 'e') mol.setAtomHExplicit(num, parseInt(bits[i].substring(1)));\n\t\t\t\telse if (bits[i].charAt(0) == 'm') mol.setAtomIsotope(num, parseInt(bits[i].substring(1)));\n\t\t\t\telse if (bits[i].charAt(0) == 'n') mol.setAtomMapNum(num, parseInt(bits[i].substring(1)));\n\t\t\t\telse if (bits[i].charAt(0) == 'x') extra.push(MoleculeStream.skUnescape(bits[i]));\n\t\t\t\telse if (bits[i].charAt(0) == 'y') trans.push(MoleculeStream.skUnescape(bits[i]));\n\t\t\t\telse if (bits[i].charAt(0) == 'z') {mol.setAtomZ(num, parseFloat(bits[i].substring(1))); mol.setIs3D(true);}\n\t\t\t\telse extra.push(MoleculeStream.skUnescape(bits[i])); // preserve unrecognised\n\t\t\t}\n\t\t\tmol.setAtomExtra(num, extra);\n\t\t\tmol.setAtomTransient(num, trans);\n\t\t}\n\t\tfor (let n = 0; n < numBonds; n++)\n\t\t{\n\t\t\tlet bits = lines[1 + numAtoms + n].split(/[=,]/);\n\t\t\tlet frto = bits[0].split('-');\n\t\t\tlet bfr = parseInt(frto[0].trim()), bto = parseInt(frto[1].trim());\n\t\t\tif (bfr == bto) continue; // silent trimming\n\n\t\t\tlet num = mol.addBond(bfr, bto, parseInt(bits[1]), parseInt(bits[2]));\n\t\t\tlet extra = new Array(), trans = new Array();\n\t\t\tfor (let i = 3; i < bits.length; i++)\n\t\t\t{\n\t\t\t\tlet ch = bits[i].charAt(0);\n\t\t\t\tif (bits[i].charAt(0) == 'x') extra.push(MoleculeStream.skUnescape(bits[i]));\n\t\t\t\telse if (bits[i].charAt(0) == 'y') trans.push(MoleculeStream.skUnescape(bits[i]));\n\t\t\t\telse extra.push(MoleculeStream.skUnescape(bits[i])); // preserve unrecognised\n\t\t\t}\n\t\t\tmol.setBondExtra(num, extra);\n\t\t\tmol.setBondTransient(num, trans);\n\t\t}\n\n\t\tmol.keepTransient = false;\n\t\treturn mol;\n\t}\n\n\t// static method: converts a molecule into a string which represents it using the SketchEl format\n\tpublic static writeNative(mol:Molecule):string\n\t{\n\t\tlet ret = 'SketchEl!(' + mol.numAtoms + ',' + mol.numBonds + ')\\n';\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t{\n\t\t\tlet el = mol.atomElement(n), x = mol.atomX(n), y = mol.atomY(n), charge = mol.atomCharge(n), unpaired = mol.atomUnpaired(n);\n\t\t\tlet hy = mol.atomHExplicit(n) != Molecule.HEXPLICIT_UNKNOWN ? ('e' + mol.atomHExplicit(n)) : ('i' + mol.atomHydrogens(n));\n\t\t\tret += MoleculeStream.skEscape(el) + '=' + x.toFixed(4) + ',' + y.toFixed(4) + ';' + charge + ',' + unpaired + ',' + hy;\n\t\t\tif (mol.is3D()) ret += ',z' + mol.atomZ(n);\n\t\t\tif (mol.atomIsotope(n) != Molecule.ISOTOPE_NATURAL) ret += ',m' + mol.atomIsotope(n);\n\t\t\tif (mol.atomMapNum(n) > 0) ret += ',n' + mol.atomMapNum(n);\n\t\t\tret += MoleculeStream.skEncodeExtra(mol.atomExtra(n));\n\t\t\tret += MoleculeStream.skEncodeExtra(mol.atomTransient(n));\n\t\t\tret += '\\n';\n\t\t}\n\n\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t{\n\t\t\tret += mol.bondFrom(n) + '-' + mol.bondTo(n) + '=' + mol.bondOrder(n) + ',' + mol.bondType(n);\n\t\t\tret += MoleculeStream.skEncodeExtra(mol.bondExtra(n));\n\t\t\tret += MoleculeStream.skEncodeExtra(mol.bondTransient(n));\n\t\t\tret += '\\n';\n\t\t}\n\n\t\tret += '!End\\n';\n\t\treturn ret;\n\t}\n\n\t// parses a string that is expected to be using MDL Molfile format, and turns it into a molecule; or null if\n\tpublic static readMDLMOL(strData:string):Molecule\n\t{\n\t\tlet src = new MDLMOLReader(strData);\n\t\tsrc.parseHeader = true;\n\t\tsrc.parse();\n\t\treturn src.mol;\n\t}\n\n\t// converts the molecule to MDL Molfile format, using default options; see the MDLMOLWriter class for finer control\n\tpublic static writeMDLMOL(mol:Molecule):string\n\t{\n\t\treturn new MDLMOLWriter(mol).write();\n\t}\n\n\t// static method: decodes a string from a sketchel field\n\tpublic static skUnescape(str:string):string\n\t{\n\t\tlet ret = '', match:RegExpMatchArray;\n\t\twhile (match = str.match(/^(.*?)\\\\([0-9A-Fa-f][0-9A-Fa-f][0-9A-Fa-f][0-9A-Fa-f])(.*)/))\n\t\t{\n\t\t\tret += match[1] + String.fromCharCode(parseInt('0x' + match[2]));\n\t\t\tstr = match[3];\n\t\t}\n\t\treturn ret + str;\n\t}\n\n\t// static method: makes a string safe for inclusion as a SketchEl field\n\tpublic static skEscape(str:string):string\n\t{\n\t\tlet ret = '';\n\t\tfor (let n = 0; n < str.length; n++)\n\t\t{\n\t\t\tlet ch = str.charAt(n), code = str.charCodeAt(n);\n\t\t\tif (code <= 32 || code > 127 || ch == '\\\\' || ch == ',' || ch == ';' || ch == '=')\n\t\t\t{\n\t\t\t\tlet hex = (code & 0xFFFF).toString(16).toUpperCase();\n\t\t\t\tret += '\\\\';\n\t\t\t\tfor (let i = 4 - hex.length; i > 0; i--) ret += '0';\n\t\t\t\tret += hex;\n\t\t\t}\n\t\t\telse ret += ch;\n\t\t}\n\t\treturn ret;\n\t}\n\n\t// internal utility for writing SketchEl extra/transient content\n\tpublic static skEncodeExtra(extra:string[]):string\n\t{\n\t\tlet ret = '';\n\t\tfor (let n = 0; n < extra.length; n++) ret += ',' + MoleculeStream.skEscape(extra[n]);\n\t\treturn ret;\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Box} from '../util/Geom';\nimport {deepClone} from '../util/util';\nimport {Vec} from '../util/Vec';\nimport {Chemistry} from './Chemistry';\nimport {MoleculeStream} from './MoleculeStream';\n\n/*\n\tA dynamic representation of a molecule, which is analogous to the com.mmi.core.mol.Molecule class.\n\n\tThe molecule representation is conveniently interconvertible with the SketchEl format, which is the \"string\"\n\trepresentation.\n*/\n\nclass Atom\n{\n\tpublic element:string;\n\tpublic x:number;\n\tpublic y:number;\n\tpublic z:number;\n\tpublic charge:number;\n\tpublic unpaired:number;\n\tpublic isotope:number;\n\tpublic hExplicit:number;\n\tpublic mapNum:number;\n\tpublic extra:string[];\n\tpublic transient:string[];\n}\n\nclass Bond\n{\n\tpublic from:number;\n\tpublic to:number;\n\tpublic order:number;\n\tpublic type:number;\n\tpublic extra:string[];\n\tpublic transient:string[];\n}\n\nexport class Molecule\n{\n\tprivate atoms:Atom[] = [];\n\tprivate bonds:Bond[] = [];\n\tprivate hasZCoord = false;\n\n\tpublic keepTransient = false;\n\tprivate hasTransient = false;\n\n\t// cached properties: note that these are treated as shallow copies: read-only or rebuild\n\tprivate graph:number[][] = null;\n\tprivate graphBond:number[][] = null;\n\tprivate ringID:number[] = null;\n\tprivate compID:number[] = null;\n\tprivate ring3:number[][] = null;\n\tprivate ring4:number[][] = null;\n\tprivate ring5:number[][] = null;\n\tprivate ring6:number[][] = null;\n\tprivate ring7:number[][] = null;\n\n\tpublic static IDEALBOND = 1.5;\n\tpublic static HEXPLICIT_UNKNOWN = -1;\n\tpublic static ISOTOPE_NATURAL = 0;\n\tpublic static BONDTYPE_NORMAL = 0;\n\tpublic static BONDTYPE_INCLINED = 1;\n\tpublic static BONDTYPE_DECLINED = 2;\n\tpublic static BONDTYPE_UNKNOWN = 3;\n\n\tpublic static HYVALENCE_EL = ['C', 'N', 'O', 'S', 'P'];\n\tpublic static HYVALENCE_VAL = [4, 3, 2, 2, 3];\n\n\t// recommended prefix for extra/transient\n\tpublic static PREFIX_EXTRA = 'x';\n\tpublic static PREFIX_TRANSIENT = 'y';\n\n\t// ------------ public methods ------------\n\n\tconstructor()\n\t{\n\t}\n\n\tpublic clone():Molecule\n\t{\n\t\t/*let dup = Molecule.fromString(this.toString());\n\t\tdup.keepTransient = this.keepTransient;*/\n\n\t\tlet dup = new Molecule();\n\t\tdup.atoms = deepClone(this.atoms);\n\t\tdup.bonds = deepClone(this.bonds);\n\t\tdup.hasZCoord = this.hasZCoord;\n\t\tdup.keepTransient = this.keepTransient;\n\t\tdup.hasTransient = this.hasTransient;\n\t\tdup.graph = this.graph;\n\t\tdup.graphBond = this.graphBond;\n\t\tdup.ringID = this.ringID;\n\t\tdup.compID = this.compID;\n\t\tdup.ring3 = this.ring3;\n\t\tdup.ring4 = this.ring4;\n\t\tdup.ring5 = this.ring5;\n\t\tdup.ring6 = this.ring6;\n\t\tdup.ring7 = this.ring7;\n\t\treturn dup;\n\t}\n\tpublic static fromString(strData:string):Molecule {return MoleculeStream.readNative(strData);}\n\tpublic toString():string {return MoleculeStream.writeNative(this);}\n\n\t// takes the indicated molecular fragment and appends it to the end of the current molecule, with order preserved\n\tpublic append(frag:Molecule):void\n\t{\n\t\tlet base = this.atoms.length;\n\t\tfor (let n = 1; n <= frag.numAtoms; n++)\n\t\t{\n\t\t\tlet num = this.addAtom(frag.atomElement(n), frag.atomX(n), frag.atomY(n), frag.atomCharge(n), frag.atomUnpaired(n));\n\t\t\tthis.setAtomIsotope(num, frag.atomIsotope(n));\n\t\t\tthis.setAtomHExplicit(num, frag.atomHExplicit(n));\n\t\t\tthis.setAtomMapNum(num, frag.atomMapNum(n));\n\t\t\tthis.setAtomExtra(num, frag.atomExtra(n));\n\t\t\tthis.setAtomTransient(num, frag.atomTransient(n));\n\t\t}\n\t\tfor (let n = 1; n <= frag.numBonds; n++)\n\t\t{\n\t\t\tlet num = this.addBond(frag.bondFrom(n) + base, frag.bondTo(n) + base, frag.bondOrder(n), frag.bondType(n));\n\t\t\tthis.setBondExtra(num, frag.bondExtra(n));\n\t\t\tthis.setBondTransient(num, frag.bondTransient(n));\n\t\t}\n\t\tthis.trashTransient();\n\t}\n\n\tpublic get numAtoms():number {return this.atoms.length;}\n\tpublic getAtom(idx:number):Atom\n\t{\n\t\tif (idx < 1 || idx > this.atoms.length)\n\t\t\tthrow new Error(`Molecule.getAtom: index ${idx} out of range (#atoms=${this.atoms.length})`);\n\t\treturn this.atoms[idx - 1];\n\t}\n\n\tpublic atomElement(idx:number):string {return this.getAtom(idx).element;}\n\tpublic atomX(idx:number):number {return this.getAtom(idx).x;}\n\tpublic atomY(idx:number):number {return this.getAtom(idx).y;}\n\tpublic atomCharge(idx:number):number {return this.getAtom(idx).charge;}\n\tpublic atomUnpaired(idx:number):number {return this.getAtom(idx).unpaired;}\n\tpublic atomIsotope(idx:number):number {return this.getAtom(idx).isotope;}\n\tpublic atomHExplicit(idx:number):number {return this.getAtom(idx).hExplicit;}\n\tpublic atomMapNum(idx:number):number {return this.getAtom(idx).mapNum;}\n\tpublic atomExtra(idx:number):string[] {return this.getAtom(idx).extra.slice(0);}\n\tpublic atomTransient(idx:number):string[] {return this.getAtom(idx).transient.slice(0);}\n\n\tpublic get numBonds():number {return this.bonds.length;}\n\tpublic getBond(idx:number):Bond\n\t{\n\t\tif (idx < 1 || idx > this.bonds.length)\n\t\t\tthrow new Error(`Molecule.getBond: index ${idx} out of range (#bonds=${this.bonds.length})`);\n\t\treturn this.bonds[idx - 1];\n\t}\n\n\tpublic bondFrom(idx:number):number {return this.getBond(idx).from;}\n\tpublic bondTo(idx:number):number {return this.getBond(idx).to;}\n\tpublic bondOrder(idx:number):number {return this.getBond(idx).order;}\n\tpublic bondType(idx:number):number {return this.getBond(idx).type;}\n\tpublic bondExtra(idx:number):string[] {return this.getBond(idx).extra.slice(0);}\n\tpublic bondTransient(idx:number):string[] {return this.getBond(idx).transient.slice(0);}\n\tpublic bondFromTo(idx:number):number[] {let b = this.getBond(idx); return [b.from, b.to];}\n\n\tpublic addAtom(element:string, x:number, y:number, charge:number = 0, unpaired:number = 0):number\n\t{\n\t\tlet a = new Atom();\n\t\ta.element = element;\n\t\ta.x = x;\n\t\ta.y = y;\n\t\ta.charge = charge;\n\t\ta.unpaired = unpaired;\n\t\ta.isotope = Molecule.ISOTOPE_NATURAL;\n\t\ta.hExplicit = Molecule.HEXPLICIT_UNKNOWN;\n\t\ta.mapNum = 0;\n\t\ta.extra = [];\n\t\ta.transient = [];\n\t\tthis.atoms.push(a);\n\t\tthis.trashTransient();\n\t\tthis.trashGraph();\n\t\treturn this.atoms.length;\n\t}\n\n\tpublic setAtomElement(idx:number, element:string):void\n\t{\n\t\tthis.getAtom(idx).element = element;\n\t\tthis.trashTransient();\n\t}\n\tpublic setAtomPos(idx:number, x:number, y:number, z?:number):void\n\t{\n\t\tlet a = this.getAtom(idx);\n\t\ta.x = x;\n\t\ta.y = y;\n\t\ta.z = z == null ? 0 : z;\n\t\tthis.trashTransient();\n\t}\n\tpublic setAtomX(idx:number, x:number):void\n\t{\n\t\tthis.getAtom(idx).x = x;\n\t\tthis.trashTransient();\n\t}\n\tpublic setAtomY(idx:number, y:number):void\n\t{\n\t\tthis.getAtom(idx).y = y;\n\t\tthis.trashTransient();\n\t}\n\tpublic setAtomCharge(idx:number, charge:number):void\n\t{\n\t\tthis.getAtom(idx).charge = charge;\n\t\tthis.trashTransient();\n\t}\n\tpublic setAtomUnpaired(idx:number, unpaired:number):void\n\t{\n\t\tthis.getAtom(idx).unpaired = unpaired;\n\t\tthis.trashTransient();\n\t}\n\tpublic setAtomIsotope(idx:number, isotope:number):void\n\t{\n\t\tthis.getAtom(idx).isotope = isotope;\n\t\tthis.trashTransient();\n\t}\n\tpublic setAtomHExplicit(idx:number, hExplicit:number):void\n\t{\n\t\tthis.getAtom(idx).hExplicit = hExplicit;\n\t\tthis.trashTransient();\n\t}\n\tpublic setAtomMapNum(idx:number, mapNum:number):void\n\t{\n\t\tthis.getAtom(idx).mapNum = mapNum;\n\t\tthis.trashTransient();\n\t}\n\tpublic setAtomExtra(idx:number, extra:string[]):void\n\t{\n\t\tthis.getAtom(idx).extra = extra.slice(0);\n\t}\n\tpublic setAtomTransient(idx:number, transi:string[]):void\n\t{\n\t\tthis.getAtom(idx).transient = transi.slice(0);\n\t\tif (transi.length > 0) this.hasTransient = true;\n\t}\n\n\tpublic swapAtoms(a1:number, a2:number):void\n\t{\n\t\tlet a = this.atoms[a1 - 1];\n\t\tthis.atoms[a1 - 1] = this.atoms[a2 - 1];\n\t\tthis.atoms[a2 - 1] = a;\n\n\t\tfor (let n = 0; n < this.bonds.length; n++)\n\t\t{\n\t\t\tlet b = this.bonds[n];\n\t\t\tif (b.from == a2) b.from = a1; else if (b.from == a1) b.from = a2;\n\t\t\tif (b.to == a2) b.to = a1; else if (b.to == a1) b.to = a2;\n\t\t}\n\n\t\tthis.trashGraph();\n\t}\n\n\tpublic addBond(from:number, to:number, order:number, type:number = Molecule.BONDTYPE_NORMAL):number\n\t{\n\t\tlet b = new Bond();\n\t\tb.from = from;\n\t\tb.to = to;\n\t\tb.order = order;\n\t\tb.type = type;\n\t\tb.extra = [];\n\t\tb.transient = [];\n\t\tthis.bonds.push(b);\n\t\tthis.trashTransient();\n\t\tthis.trashGraph();\n\t\treturn this.bonds.length;\n\t}\n\n\tpublic setBondFrom(idx:number, bfr:number):void\n\t{\n\t\tthis.getBond(idx).from = bfr;\n\t\tthis.trashTransient();\n\t\tthis.trashGraph();\n\t}\n\tpublic setBondTo(idx:number, to:number):void\n\t{\n\t\tthis.getBond(idx).to = to;\n\t\tthis.trashTransient();\n\t\tthis.trashGraph();\n\t}\n\tpublic setBondFromTo(idx:number, bfr:number, bto:number):void\n\t{\n\t\tthis.getBond(idx).from = bfr;\n\t\tthis.getBond(idx).to = bto;\n\t\tthis.trashTransient();\n\t\tthis.trashGraph();\n\t}\n\tpublic setBondOrder(idx:number, order:number):void\n\t{\n\t\tthis.getBond(idx).order = order;\n\t\tthis.trashTransient();\n\t}\n\tpublic setBondType(idx:number, type:number):void\n\t{\n\t\tthis.getBond(idx).type = type;\n\t\tthis.trashTransient();\n\t}\n\tpublic setBondExtra(idx:number, extra:string[]):void\n\t{\n\t\tthis.getBond(idx).extra = extra.slice(0);\n\t}\n\tpublic setBondTransient(idx:number, transi:string[]):void\n\t{\n\t\tthis.getBond(idx).transient = transi.slice(0);\n\t\tif (transi.length > 0) this.hasTransient = true;\n\t}\n\n\tpublic deleteAtomAndBonds(idx:number):void\n\t{\n\t\tfor (let n = this.numBonds; n >= 1; n--)\n\t\t{\n\t\t\tif (this.bondFrom(n) == idx || this.bondTo(n) == idx)\n\t\t\t\tthis.deleteBond(n);\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.bondFrom(n) > idx) this.setBondFrom(n, this.bondFrom(n) - 1);\n\t\t\t\tif (this.bondTo(n) > idx) this.setBondTo(n, this.bondTo(n) - 1);\n\t\t\t}\n\t\t}\n\t\tthis.atoms.splice(idx - 1, 1);\n\t\tthis.trashTransient();\n\t\tthis.trashGraph();\n\t}\n\tpublic deleteBond(idx:number):void\n\t{\n\t\tthis.bonds.splice(idx - 1, 1);\n\t\tthis.trashTransient();\n\t\tthis.trashGraph();\n\t}\n\n\t// uses either explicit or computed number to determine how many hydrogens the atom has; the field for explicit hydrogens takes\n\t// absolute preference; if it has its default value of 'unknown', the number is computed by looking up the hydrogen capacity for\n\t// the element (most of which are zero), subtracting the total of bond orders, then returning the difference, or zero; the calculation\n\t// tends to err on the side of too few, since the concept is just an aid to drawing organic structures, not a cheminformatic attempt\n\t// to compensate for 4 decades of bad file formats\n\t// (note: returns \"implicit\"+\"explicit\", but does NOT count \"actual\" hydrogens, i.e. those which have their own atom nodes)\n\tpublic atomHydrogens(idx:number):number\n\t{\n\t\tlet hy = this.atomHExplicit(idx);\n\t\tif (hy != Molecule.HEXPLICIT_UNKNOWN) return hy;\n\n\t\tfor (let n = 0; n < Molecule.HYVALENCE_EL.length; n++) if (Molecule.HYVALENCE_EL[n] == this.atomElement(idx))\n\t\t{\n\t\t\thy = Molecule.HYVALENCE_VAL[n];\n\t\t\tbreak;\n\t\t}\n\t\tif (hy == Molecule.HEXPLICIT_UNKNOWN) return 0;\n\t\tlet ch = this.atomCharge(idx);\n\t\tif (this.atomElement(idx) == 'C') ch = -Math.abs(ch);\n\t\thy += ch - this.atomUnpaired(idx);\n\t\tlet adjBonds = this.atomAdjBonds(idx);\n\t\tfor (let n = 0; n < adjBonds.length; n++) hy -= this.bondOrder(adjBonds[n]);\n\t\treturn hy < 0 ? 0 : hy;\n\t}\n\n\t// returns the index of the bond between the two atoms, or 0 if none\n\t// NOTE: uncached==>slow\n\tpublic findBond(a1:number, a2:number):number\n\t{\n\t\tfor (let n = 1; n <= this.numBonds; n++)\n\t\t{\n\t\t\tlet b1 = this.bondFrom(n), b2 = this.bondTo(n);\n\t\t\tif ((a1 == b1 && a2 == b2) || (a1 == b2 && a2 == b1)) return n;\n\t\t}\n\t\treturn 0;\n\t}\n\n\t// for a bond, returns the end which is not==Ref; return value will be From,To or 0\n\tpublic bondOther(idx:number, ref:number):number\n\t{\n\t\tlet b1 = this.bondFrom(idx), b2 = this.bondTo(idx);\n\t\tif (b1 == ref) return b2;\n\t\tif (b2 == ref) return b1;\n\t\treturn 0;\n\t}\n\n\t// returns whether an atom logically ought to be drawn \"explicitly\";if false, it is a carbon which should be just a dot\n\tpublic atomExplicit(idx:number):boolean\n\t{\n\t\tlet a = this.atoms[idx - 1];\n\t\tif (a.isotope != Molecule.ISOTOPE_NATURAL) return true;\n\t\tif (a.element != 'C' || a.charge != 0 || a.unpaired != 0) return true;\n\t\tif (this.atomAdjCount(idx) == 0) return true;\n\t\treturn false;\n\t}\n\n\t// returns the numerical ID of the ring block in which the atom resides, or 0 if it is not in a ring\n\tpublic atomRingBlock(idx:number):number\n\t{\n\t\tif (this.graph == null) this.buildGraph();\n\t\tif (this.ringID == null) this.buildRingID();\n\t\treturn this.ringID[idx - 1];\n\t}\n\n\t// returns whether or not a bond resides in a ring (i.e. ring block of each end is the same and nonzero)\n\tpublic bondInRing(idx:number):boolean\n\t{\n\t\tlet r1 = this.atomRingBlock(this.bondFrom(idx)), r2 = this.atomRingBlock(this.bondTo(idx));\n\t\treturn r1 > 0 && r1 == r2;\n\t}\n\n\t// returns the connected component ID of the atom, always 1 or more\n\tpublic atomConnComp(idx:number):number\n\t{\n\t\tif (this.graph == null) this.buildGraph();\n\t\tif (this.compID == null) this.buildConnComp();\n\t\treturn this.compID[idx - 1];\n\t}\n\n\t// returns the number of neighbours of an atom\n\t// NOTE: uncached==>slow\n\tpublic atomAdjCount(idx:number):number\n\t{\n\t\tthis.buildGraph();\n\t\treturn this.graph[idx - 1].length;\n\t}\n\n\t// returns the actual adjacency list of an atom; the return value is a 1-based deep copy\n\tpublic atomAdjList(idx:number):number[]\n\t{\n\t\tthis.buildGraph();\n\t\tlet adj = this.graph[idx - 1].slice(0);\n\t\tfor (let n = adj.length - 1; n >= 0; n--) adj[n]++;\n\t\treturn adj;\n\t}\n\n\t// returns the bond indices of the adjacency list for the atom; the return value is a 1-based deep copy\n\tpublic atomAdjBonds(idx:number):number[]\n\t{\n\t\tthis.buildGraph();\n\t\treturn this.graphBond[idx - 1].slice(0);\n\t}\n\n\t// returns _all_ rings of indicated size; each item in the array list is an array of int[Size], a consecutively ordered array of atom\n\t// numbers; uses a recursive depth first search, which must be bounded above by Size being small in order to avoid exponential blowup\n\tpublic findRingsOfSize(size:number):number[][]\n\t{\n\t\tlet rings:number[][] = null;\n\t\tif (size == 3 && this.ring3 != null) rings = this.ring3;\n\t\tif (size == 4 && this.ring4 != null) rings = this.ring4;\n\t\tif (size == 5 && this.ring5 != null) rings = this.ring5;\n\t\tif (size == 6 && this.ring6 != null) rings = this.ring6;\n\t\tif (size == 7 && this.ring7 != null) rings = this.ring7;\n\n\t\tif (rings == null)\n\t\t{\n\t\t\tif (this.graph == null) this.buildGraph();\n\t\t\tif (this.ringID == null) this.buildRingID();\n\n\t\t\trings = [];\n\t\t\tfor (let n = 1; n <= this.atoms.length; n++)\n\t\t\t{\n\t\t\t\tif (this.ringID[n - 1] > 0)\n\t\t\t\t{\n\t\t\t\t\tlet path = Vec.numberArray(0, size);\n\t\t\t\t\tpath[0] = n;\n\t\t\t\t\tthis.recursiveRingFind(path, 1, size, this.ringID[n - 1], rings);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (size == 3) this.ring3 = rings;\n\t\t\tif (size == 4) this.ring4 = rings;\n\t\t\tif (size == 5) this.ring5 = rings;\n\t\t\tif (size == 6) this.ring6 = rings;\n\t\t\tif (size == 7) this.ring7 = rings;\n\t\t}\n\n\t\tlet ret:number[][] = [];\n\t\tfor (let n = 0; n < rings.length; n++) ret.push(rings[n].slice(0));\n\t\treturn ret;\n\t}\n\n\t// molecule boundaries\n\tpublic boundary():Box\n\t{\n\t\tif (this.atoms.length == 0) return Box.zero();\n\t\tlet x1 = this.atoms[0].x, x2 = x1;\n\t\tlet y1 = this.atoms[0].y, y2 = y1;\n\t\tfor (let n = 1; n < this.atoms.length; n++)\n\t\t{\n\t\t\tx1 = Math.min(x1, this.atoms[n].x);\n\t\t\ty1 = Math.min(y1, this.atoms[n].y);\n\t\t\tx2 = Math.max(x2, this.atoms[n].x);\n\t\t\ty2 = Math.max(y2, this.atoms[n].y);\n\t\t}\n\t\treturn new Box(x1, y1, x2 - x1, y2 - y1);\n\t}\n\n\t// lookup the atomic number for the element, or return 0 if not in the periodic table\n\tpublic atomicNumber(idx:number):number\n\t{\n\t\treturn Molecule.elementAtomicNumber(this.atomElement(idx));\n\t}\n\n\tpublic static elementAtomicNumber(element:string):number\n\t{\n\t\treturn Math.max(0, Chemistry.ELEMENTS.indexOf(element));\n\t}\n\n\t// Z coordinate: somewhat aloof from the (X,Y) coordinates, because the container is oriented toward 2D molecules\n\tpublic is3D():boolean {return this.hasZCoord;}\n\tpublic setIs3D(v:boolean):void {this.hasZCoord = v;}\n\tpublic atomZ(idx:number):number {return this.getAtom(idx).z;}\n\tpublic setAtomZ(idx:number, z:number) {this.getAtom(idx).z = z;}\n\n\t// literal comparison to another molecule, which can be used for ordering purposes: returns -1/0/1\n\tpublic compareTo(other:Molecule):number\n\t{\n\t\tif (other == null || other.numAtoms == 0) return this.numAtoms == 0 ? 0 : 1; // null is equivalent to empty\n\t\tif (this.numAtoms < other.numAtoms) return -1;\n\t\tif (this.numAtoms > other.numAtoms) return 1;\n\t\tif (this.numBonds < other.numBonds) return -1;\n\t\tif (this.numBonds > other.numBonds) return 1;\n\n\t\tfor (let n = 1; n <= this.numAtoms; n++)\n\t\t{\n\t\t\tif (this.atomElement(n) < other.atomElement(n)) return -1;\n\t\t\tif (this.atomElement(n) > other.atomElement(n)) return 1;\n\t\t\tif (this.atomX(n) < other.atomX(n)) return -1; if (this.atomX(n) > other.atomX(n)) return 1;\n\t\t\tif (this.atomY(n) < other.atomY(n)) return -1; if (this.atomY(n) > other.atomY(n)) return 1;\n\t\t\tif (this.atomCharge(n) < other.atomCharge(n)) return -1; if (this.atomCharge(n) > other.atomCharge(n)) return 1;\n\t\t\tif (this.atomUnpaired(n) < other.atomUnpaired(n)) return -1; if (this.atomUnpaired(n) > other.atomUnpaired(n)) return 1;\n\t\t\tif (this.atomHExplicit(n) < other.atomHExplicit(n)) return -1; if (this.atomHExplicit(n) > other.atomHExplicit(n)) return 1;\n\t\t\tif (this.atomIsotope(n) < other.atomIsotope(n)) return -1; if (this.atomIsotope(n) > other.atomIsotope(n)) return 1;\n\t\t\tif (this.atomMapNum(n) < other.atomMapNum(n)) return -1; if (this.atomMapNum(n) > other.atomMapNum(n)) return 1;\n\n\t\t\tlet tx1 = this.atomExtra(n), tx2 = other.atomExtra(n);\n\t\t\tif (tx1.length < tx2.length) return -1; if (tx1.length > tx2.length) return 1;\n\t\t\tfor (let i = 0; i < tx1.length; i++) if (tx1[i] < tx2[i]) return -1; else if (tx1[i] > tx2[i]) return 1;\n\n\t\t\ttx1 = this.atomTransient(n); tx2 = other.atomTransient(n);\n\t\t\tif (tx1.length < tx2.length) return -1; if (tx1.length > tx2.length) return 1;\n\t\t\tfor (let i = 0; i < tx1.length; i++) if (tx1[i] < tx2[i]) return -1; else if (tx1[i] > tx2[i]) return 1;\n\t\t}\n\t\tfor (let n = 1; n <= this.numBonds; n++)\n\t\t{\n\t\t\tif (this.bondFrom(n) < other.bondFrom(n)) return -1; if (this.bondFrom(n) > other.bondFrom(n)) return 1;\n\t\t\tif (this.bondTo(n) < other.bondTo(n)) return -1; if (this.bondTo(n) > other.bondTo(n)) return 1;\n\t\t\tif (this.bondOrder(n) < other.bondOrder(n)) return -1; if (this.bondOrder(n) > other.bondOrder(n)) return 1;\n\t\t\tif (this.bondType(n) < other.bondType(n)) return -1; if (this.bondType(n) > other.bondType(n)) return 1;\n\n\t\t\tlet tx1 = this.bondExtra(n), tx2 = other.bondExtra(n);\n\t\t\tif (tx1.length < tx2.length) return -1; if (tx1.length > tx2.length) return 1;\n\t\t\tfor (let i = 0; i < tx1.length; i++) if (tx1[i] < tx2[i]) return -1; else if (tx1[i] > tx2[i]) return 1;\n\n\t\t\ttx1 = this.bondTransient(n); tx2 = other.bondTransient(n);\n\t\t\tif (tx1.length < tx2.length) return -1; if (tx1.length > tx2.length) return 1;\n\t\t\tfor (let i = 0; i < tx1.length; i++) if (tx1[i] < tx2[i]) return -1; else if (tx1[i] > tx2[i]) return 1;\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\t// must be called when _any_ change to the molecule is affected; the transient extension fields are cleared out\n\tpublic trashTransient():void\n\t{\n\t\tif (this.keepTransient || !this.hasTransient) return;\n\t\tfor (let a of this.atoms) a.transient = [];\n\t\tfor (let b of this.bonds) b.transient = [];\n\t\tthis.hasTransient = false;\n\t}\n\n\t// convenience methods\n\tpublic appendAtomExtra(atom:number, extra:string):void\n\t{\n\t\tthis.getAtom(atom).extra.push(extra);\n\t}\n\tpublic appendAtomTransient(atom:number, trans:string):void\n\t{\n\t\tthis.getAtom(atom).transient.push(trans);\n\t}\n\tpublic appendBondExtra(bond:number, extra:string):void\n\t{\n\t\tthis.getBond(bond).extra.push(extra);\n\t}\n\tpublic appendBondTransient(bond:number, trans:string):void\n\t{\n\t\tthis.getBond(bond).transient.push(trans);\n\t}\n\n\t// ------------ private methods ------------\n\n\t// must be called when the molecule's graph changes; do not call for changing labels or coordinates\n\tprivate trashGraph():void\n\t{\n\t\tthis.graph = null;\n\t\tthis.graphBond = null;\n\t\tthis.ringID = null;\n\t\tthis.compID = null;\n\t\tthis.ring3 = null;\n\t\tthis.ring4 = null;\n\t\tthis.ring5 = null;\n\t\tthis.ring6 = null;\n\t\tthis.ring7 = null;\n\t}\n\n\t// if the computed graph is not defined, rebuild it\n\tprivate buildGraph():void\n\t{\n\t\tif (this.graph != null && this.graphBond != null) return;\n\n\t\tlet graph:number[][] = [], graphBond:number[][] = [];\n\t\tlet na = this.numAtoms, nb = this.numBonds;\n\n\t\tfor (let n = 0; n < na; n++)\n\t\t{\n\t\t\tgraph.push([]);\n\t\t\tgraphBond.push([]);\n\t\t}\n\t\tfor (let n = 1; n <= nb; n++)\n\t\t{\n\t\t\tlet b = this.getBond(n);\n\t\t\tgraph[b.from - 1].push(b.to - 1);\n\t\t\tgraph[b.to - 1].push(b.from - 1);\n\t\t\tgraphBond[b.from - 1].push(n);\n\t\t\tgraphBond[b.to - 1].push(n);\n\t\t}\n\n\t\tthis.graph = graph;\n\t\tthis.graphBond = graphBond;\n\t}\n\n\t// passes over the graph establishing which component each atom belongs to\n\tprivate buildConnComp():void\n\t{\n\t\tconst numAtoms = this.atoms.length;\n\n\t\tthis.compID = Vec.numberArray(0, numAtoms);\n\t\tfor (let n = 0; n < numAtoms; n++) this.compID[n] = 0;\n\t\tlet comp = 1;\n\t\tthis.compID[0] = comp;\n\n\t\t// (not very efficient, should use a stack-based depth first search)\n\t\twhile (true)\n\t\t{\n\t\t\tlet anything = false;\n\t\t\tfor (let n = 0; n < numAtoms; n++) if (this.compID[n] == comp)\n\t\t\t{\n\t\t\t\tfor (let i = 0; i < this.graph[n].length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (this.compID[this.graph[n][i]] == 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.compID[this.graph[n][i]] = comp;\n\t\t\t\t\t\tanything = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!anything)\n\t\t\t{\n\t\t\t\tfor (let n = 0; n < numAtoms; n++)\n\t\t\t\t{\n\t\t\t\t\tif (this.compID[n] == 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.compID[n] = ++comp;\n\t\t\t\t\t\tanything = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!anything) break;\n\t\t\t}\n\t\t}\n\t}\n\n\t// update the ring-block-identifier for each atom\n\tprivate buildRingID():void\n\t{\n\t\tconst numAtoms = this.atoms.length;\n\n\t\tthis.ringID = Vec.numberArray(0, numAtoms);\n\t\tif (numAtoms == 0) return;\n\t\tlet visited = Vec.booleanArray(false, numAtoms);\n\t\tfor (let n = 0; n < numAtoms; n++)\n\t\t{\n\t\t\tthis.ringID[n] = 0;\n\t\t\tvisited[n] = false;\n\t\t}\n\n\t\tlet path = Vec.numberArray(0, numAtoms + 1), plen = 0, numVisited = 0;\n\t\twhile (true)\n\t\t{\n\t\t\tlet last:number, current:number;\n\n\t\t\tif (plen == 0) // find an element of a new component to visit\n\t\t\t{\n\t\t\t\tlast = -1;\n\t\t\t\tfor (current = 0; visited[current]; current++) {}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlast = path[plen - 1];\n\t\t\t\tcurrent = -1;\n\t\t\t\tfor (let n = 0; n < this.graph[last].length; n++)\n\t\t\t\t{\n\t\t\t\t\tif (!visited[this.graph[last][n]])\n\t\t\t\t\t{\n\t\t\t\t\t\tcurrent = this.graph[last][n];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (current >= 0 && plen >= 2) // path is at least 2 items long, so look for any not-previous visited neighbours\n\t\t\t{\n\t\t\t\tlet back = path[plen - 1];\n\t\t\t\t//System.out.println(\" back=\"+back);\n\t\t\t\tfor (let n = 0; n < this.graph[current].length; n++)\n\t\t\t\t{\n\t\t\t\t\tlet join = this.graph[current][n];\n\t\t\t\t\tif (join != back && visited[join])\n\t\t\t\t\t{\n\t\t\t\t\t\tpath[plen] = current;\n\t\t\t\t\t\tfor (let i = plen; i == plen || path[i + 1] != join; i--)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet id = this.ringID[path[i]];\n\t\t\t\t\t\t\tif (id == 0) this.ringID[path[i]] = last;\n\t\t\t\t\t\t\telse if (id != last)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfor (let j = 0; j < numAtoms; j++)\n\t\t\t\t\t\t\t\t\tif (this.ringID[j] == id) this.ringID[j] = last;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (current >= 0) // can mark the new one as visited\n\t\t\t{\n\t\t\t\tvisited[current] = true;\n\t\t\t\tpath[plen++] = current;\n\t\t\t\tnumVisited++;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// otherwise, found nothing and must rewind the path\n\t\t\t\tplen--;\n\t\t\t}\n\n\t\t\tif (numVisited == numAtoms) break;\n\t\t}\n\n\t\t// the ring ID's are not necessarily consecutive, so reassign them to 0=none, 1..NBlocks\n\t\tlet nextID = 0;\n\t\tfor (let i = 0; i < numAtoms; i++)\n\t\t{\n\t\t\tif (this.ringID[i] > 0)\n\t\t\t{\n\t\t\t\tnextID--;\n\t\t\t\tfor (let j = numAtoms - 1; j >= i; j--) if (this.ringID[j] == this.ringID[i]) this.ringID[j] = nextID;\n\t\t\t}\n\t\t}\n\t\tfor (let i = 0; i < numAtoms; i++) this.ringID[i] = -this.ringID[i];\n\t}\n\n\t// ring hunter: recursive step; finds, compares and collects\n\tprivate recursiveRingFind(path:number[], psize:number, capacity:number, rblk:number, rings:number[][]):void\n\t{\n\t\tconst {graph} = this;\n\n\t\t// not enough atoms yet, so look for new possibilities\n\t\tif (psize < capacity)\n\t\t{\n\t\t\tlet last = path[psize - 1];\n\t\t\tfor (let n = 0; n < graph[last - 1].length; n++)\n\t\t\t{\n\t\t\t\tlet adj = graph[last - 1][n] + 1;\n\t\t\t\tif (this.ringID[adj - 1] != rblk) continue;\n\t\t\t\tlet fnd = false;\n\t\t\t\tfor (let i = 0; i < psize; i++)\n\t\t\t\t{\n\t\t\t\t\tif (path[i] == adj)\n\t\t\t\t\t{\n\t\t\t\t\t\tfnd = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!fnd)\n\t\t\t\t{\n\t\t\t\t\tlet newPath = path.slice(0);\n\t\t\t\t\tnewPath[psize] = adj;\n\t\t\t\t\tthis.recursiveRingFind(newPath, psize + 1, capacity, rblk, rings);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t// path is full, so make sure it eats its tail\n\t\tlet last = path[psize - 1];\n\t\tlet fnd = false;\n\t\tfor (let n = 0; n < graph[last - 1].length; n++)\n\t\t{\n\t\t\tif (graph[last - 1][n] + 1 == path[0])\n\t\t\t{\n\t\t\t\tfnd = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (!fnd) return;\n\n\t\t// make sure every element in the path has exactly 2 neighbours within the path; otherwise it is spanning a bridge, which\n\t\t// is an undesirable ring definition\n\t\tfor (let n = 0; n < path.length; n++)\n\t\t{\n\t\t\tlet count = 0, p = path[n] - 1;\n\t\t\tfor (let i = 0; i < graph[p].length; i++) if (path.indexOf(graph[p][i] + 1) >= 0) count++;\n\t\t\tif (count != 2) return; // invalid\n\t\t}\n\n\t\t// reorder the array then look for duplicates\n\t\tlet first = 0;\n\t\tfor (let n = 1; n < psize; n++) if (path[n] < path[first]) first = n;\n\t\tlet fm = (first - 1 + psize) % psize, fp = (first + 1) % psize;\n\t\tlet flip = path[fm] < path[fp];\n\t\tif (first != 0 || flip)\n\t\t{\n\t\t\tlet newPath = Vec.numberArray(0, psize);\n\t\t\tfor (let n = 0; n < psize; n++) newPath[n] = path[(first + (flip ? psize - n : n)) % psize];\n\t\t\tpath = newPath;\n\t\t}\n\n\t\tfor (let n = 0; n < rings.length; n++)\n\t\t{\n\t\t\tlet look = rings[n];\n\t\t\tlet same = true;\n\t\t\tfor (let i = 0; i < psize; i++)\n\t\t\t{\n\t\t\t\tif (look[i] != path[i])\n\t\t\t\t{\n\t\t\t\t\tsame = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (same) return;\n\t\t}\n\n\t\trings.push(path);\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {deepClone, safeFloat, safeInt} from '../util/util';\nimport {Vec} from '../util/Vec';\nimport {Molecule} from './Molecule';\n\n/*\n\tWraps an object representation of a datasheet with access functions that are analogous to the Java com.mmi.core.ds.DataSheet class.\n\n\tThe format of the data parameter is:\n\n\t\ttitle, description: string\n\t\tnumCols, numRows, numExtens: integer\n\t\tcolData: array of {name:string, type:string, descr:string}\n\t\trowData: matrix, rowData[row][col]=value\n\t\textData: array of {name:string, type:string, data:string}\n\n\tImportant differences to remember:\n\n\t- column types are represented as strings, not integers (see constants below)\n\t- molecules are represented as strings, in SketchEl format, not objects\n*/\n\nexport const enum DataSheetColumn\n{\n\tMolecule = 'molecule',\n\tString = 'string',\n\tReal = 'real',\n\tInteger = 'integer',\n\tBoolean = 'boolean',\n\tExtend = 'extend',\n}\n\ninterface DataSheetContentColumn\n{\n\tname:string;\n\ttype:DataSheetColumn;\n\tdescr:string;\n}\n\ninterface DataSheetContentExt\n{\n\tname:string;\n\ttype:string;\n\tdata:string;\n}\n\ninterface DataSheetContent\n{\n\ttitle?:string;\n\tdescription?:string;\n\tnumCols?:number;\n\tnumRows?:number;\n\tnumExtens?:number;\n\tcolData?:DataSheetContentColumn[];\n\trowData?:any[][];\n\textData?:DataSheetContentExt[];\n}\n\nexport class DataSheet\n{\n\tprivate data:DataSheetContent;\n\n\t// instantiates the data using a JSON-encoded datasheet; it may be null or empty\n\t// note: this class reserves the right to modify the data parameter; it is the caller's responsibility to ensure that there are no\n\t// troublesome references elsewhere\n\tconstructor(data?:any)\n\t{\n\t\tif (!data) data = {};\n\n\t\tif (!data.title) data.title = '';\n\t\tif (!data.description) data.description = '';\n\n\t\tif (data.numCols == null) data.numCols = Vec.len(data.colData);\n\t\tif (data.numRows == null) data.numRows = Vec.len(data.rowData);\n\t\tif (data.numExtens == null) data.numExtens = Vec.len(data.extData);\n\n\t\tif (data.colData == null) data.colData = [];\n\t\tif (data.rowData == null) data.rowData = [];\n\t\tif (data.extData == null) data.extData = [];\n\n\t\tthis.data = data;\n\t}\n\n\t// make a deep clone of the datasheet that can be safely modified without consequences\n\tpublic clone(withRows = true):DataSheet\n\t{\n\t\tlet {numCols, numRows, colData, rowData} = this.data;\n\t\tlet data:DataSheetContent =\n\t\t{\n\t\t\ttitle: this.data.title,\n\t\t\tdescription: this.data.description,\n\t\t\tnumCols: numCols,\n\t\t\tnumRows: withRows ? numRows : 0,\n\t\t\tnumExtens: this.data.numExtens,\n\t\t\tcolData: deepClone(colData),\n\t\t\trowData: withRows ? new Array(numRows) : [],\n\t\t\textData: deepClone(this.data.extData),\n\t\t};\n\t\tif (withRows) for (let r = 0; r < numRows; r++)\n\t\t{\n\t\t\tlet inRow = rowData[r], outRow:any[] = new Array(numCols);\n\t\t\tfor (let c = 0; c < numCols; c++)\n\t\t\t{\n\t\t\t\tif (inRow[c] != null && colData[c].type == DataSheetColumn.Molecule && inRow[c] instanceof Molecule)\n\t\t\t\t\toutRow[c] = (inRow[c] as Molecule).clone();\n\t\t\t\telse\n\t\t\t\t\toutRow[c] = inRow[c];\n\t\t\t}\n\t\t\tdata.rowData[r] = outRow;\n\t\t}\n\t\treturn new DataSheet(data);\n\t}\n\n\t// clone with more detailed control about what to include; note that null rowMask is a shortcut for empty\n\tpublic cloneMask(colMask:boolean[], rowMask:boolean[] = null, inclExtn:boolean = true):DataSheet\n\t{\n\t\tlet {numCols, numRows, colData, rowData} = this.data;\n\t\tlet data:DataSheetContent =\n\t\t{\n\t\t\ttitle: this.data.title,\n\t\t\tdescription: this.data.description,\n\t\t\tnumCols: Vec.maskCount(colMask),\n\t\t\tnumRows: rowMask ? Vec.maskCount(rowMask) : 0,\n\t\t\tnumExtens: inclExtn ? this.data.numExtens : 0,\n\t\t\tcolData: deepClone(Vec.maskGet(colData, colMask)),\n\t\t\trowData: [],\n\t\t\textData: inclExtn ? deepClone(this.data.extData) : [],\n\t\t};\n\n\t\tif (rowMask) for (let r = 0; r < numRows; r++) if (rowMask[r])\n\t\t{\n\t\t\tlet inRow = rowData[r], outRow:any[] = Vec.maskGet(inRow, colMask);\n\t\t\tdata.rowData.push(outRow);\n\t\t}\n\n\t\t// molecule instances need to be cloned explicitly\n\t\tconst {colData: outCols, rowData: outRows} = data;\n\t\tfor (let c = outCols.length - 1; c >= 0; c--) if (outCols[c].type == DataSheetColumn.Molecule)\n\t\t{\n\t\t\tfor (let r = outRows.length - 1; r >= 0; r--) if (outRows[r][c] != null && outRows[r][c] instanceof Molecule)\n\t\t\t\toutRows[r][c] = (outRows[r][c] as Molecule).clone();\n\t\t}\n\n\t\treturn new DataSheet(data);\n\t}\n\n\t// returns the data upon which is class is based; this is in the correct format for sending to the server as a\n\t// \"JSON-formatted datasheet\", and is also suitable\n\tpublic getData():any\n\t{\n\t\treturn this.data;\n\t}\n\n\tpublic get numCols():number\n\t{\n\t\treturn this.data.numCols;\n\t}\n\tpublic get numRows():number\n\t{\n\t\treturn this.data.numRows;\n\t}\n\tpublic get title():string {return this.data.title;}\n\tpublic set title(title:string) {this.data.title = title;}\n\tpublic get description():string {return this.data.description;}\n\tpublic set description(description:string) {this.data.description = description;}\n\tpublic get numExtensions():number\n\t{\n\t\treturn this.data.numExtens;\n\t}\n\tpublic getExtName(idx:number):string\n\t{\n\t\treturn this.data.extData[idx].name;\n\t}\n\tpublic getExtType(idx:number):string\n\t{\n\t\treturn this.data.extData[idx].type;\n\t}\n\tpublic getExtData(idx:number):string\n\t{\n\t\treturn this.data.extData[idx].data;\n\t}\n\tpublic setExtName(idx:number, val:string):void\n\t{\n\t\tthis.data.extData[idx].name = val;\n\t}\n\tpublic setExtType(idx:number, val:string):void\n\t{\n\t\tthis.data.extData[idx].type = val;\n\t}\n\tpublic setExtData(idx:number, val:string):void\n\t{\n\t\tthis.data.extData[idx].data = val;\n\t}\n\tpublic appendExtension(name:string, type:string, data:string):number\n\t{\n\t\tthis.data.numExtens++;\n\t\tthis.data.extData.push({name, type, data});\n\t\treturn this.data.numExtens - 1;\n\t}\n\tpublic insertExtension(idx:number, name:string, type:string, data:string):void\n\t{\n\t\tthis.data.numExtens++;\n\t\tthis.data.extData.splice(idx, 0, {name, type, data});\n\t}\n\tpublic deleteExtension(idx:number):void\n\t{\n\t\tthis.data.extData.splice(idx, 1);\n\t\tthis.data.numExtens--;\n\t}\n\tpublic colName(col:number):string\n\t{\n\t\treturn this.data.colData[col].name;\n\t}\n\tpublic colType(col:number):DataSheetColumn\n\t{\n\t\treturn this.data.colData[col].type;\n\t}\n\tpublic colDescr(col:number):string\n\t{\n\t\treturn this.data.colData[col].descr;\n\t}\n\tpublic isNull(row:number, col:number | string):boolean\n\t{\n\t\tif (typeof col === 'string') col = this.findColByName(col);\n\t\tif (col < 0) return null;\n\t\treturn this.data.rowData[row][col] == null;\n\t}\n\tpublic notNull(row:number, col:number | string):boolean\n\t{\n\t\treturn !this.isNull(row, col);\n\t}\n\tpublic isBlank(row:number, col:number | string):boolean\n\t{\n\t\tif (typeof col === 'string') col = this.findColByName(col);\n\t\tif (this.isNull(row, col)) return true;\n\t\tlet ct = this.colType(col);\n\t\tif (ct == DataSheetColumn.Molecule) return this.getMolecule(row, col).numAtoms == 0;\n\t\tif (ct == DataSheetColumn.String) return this.getString(row, col).length == 0;\n\t\tif (ct == DataSheetColumn.Extend) return this.getExtend(row, col).length == 0;\n\t\treturn false;\n\t}\n\tpublic notBlank(row:number, col:number | string):boolean\n\t{\n\t\treturn !this.isBlank(row, col);\n\t}\n\n\tpublic getObject(row:number, col:number | string):any\n\t{\n\t\tif (typeof col === 'string') col = this.findColByName(col);\n\t\treturn this.data.rowData[row][col];\n\t}\n\t// NOTE: the molecule object is a direct pointer, so be careful to clone before modifying frivolously\n\tpublic getMolecule(row:number, col:number | string):Molecule\n\t{\n\t\tif (typeof col === 'string') col = this.findColByName(col);\n\t\tif (col < 0) return null;\n\t\tlet datum = this.data.rowData[row][col];\n\t\tif (datum == null) return null;\n\t\tif (typeof datum === 'string')\n\t\t{\n\t\t\tdatum = Molecule.fromString(datum);\n\t\t\tthis.data.rowData[row][col] = datum;\n\t\t}\n\t\treturn datum;\n\t}\n\tpublic getMoleculeClone(row:number, col:number | string):Molecule\n\t{\n\t\tlet mol = this.getMolecule(row, col);\n\t\treturn mol == null ? null : mol.clone();\n\t}\n\tpublic getMoleculeBlank(row:number, col:number | string):Molecule\n\t{\n\t\tlet mol = this.getMolecule(row, col);\n\t\treturn mol ? mol : new Molecule();\n\t}\n\tpublic getString(row:number, col:number | string):string\n\t{\n\t\tif (typeof col === 'string') col = this.findColByName(col);\n\t\tif (col < 0) return null;\n\t\tlet str = this.data.rowData[row][col] as string;\n\t\treturn str == null ? '' : str;\n\t}\n\tpublic getInteger(row:number, col:number | string):number\n\t{\n\t\tif (typeof col === 'string') col = this.findColByName(col);\n\t\tif (col < 0) return null;\n\t\treturn this.data.rowData[row][col];\n\t}\n\tpublic getReal(row:number, col:number | string):number\n\t{\n\t\tif (typeof col === 'string') col = this.findColByName(col);\n\t\tif (col < 0) return null;\n\t\treturn this.data.rowData[row][col];\n\t}\n\tpublic getBoolean(row:number, col:number | string):boolean\n\t{\n\t\tif (typeof col === 'string') col = this.findColByName(col);\n\t\tif (col < 0) return null;\n\t\treturn this.data.rowData[row][col];\n\t}\n\tpublic getExtend(row:number, col:number | string):string\n\t{\n\t\tif (typeof col === 'string') col = this.findColByName(col);\n\t\tif (col < 0) return null;\n\t\treturn this.data.rowData[row][col];\n\t}\n\tpublic setToNull(row:number, col:number | string):void\n\t{\n\t\tif (typeof col === 'string') col = this.findColByName(col);\n\t\tif (col < 0) return;\n\t\tthis.data.rowData[row][col] = null;\n\t}\n\tpublic setObject(row:number, col:number | string, val:any):void\n\t{\n\t\tif (typeof col === 'string') col = this.findColByName(col);\n\t\tif (col < 0) return;\n\t\tthis.data.rowData[row][col] = val;\n\t}\n\tpublic setMolecule(row:number, col:number | string, mol:Molecule):void\n\t{\n\t\tif (typeof col === 'string') col = this.findColByName(col);\n\t\tif (col < 0) return;\n\t\tthis.data.rowData[row][col] = mol ? mol.clone() : null;\n\t}\n\tpublic setString(row:number, col:number | string, val:string):void\n\t{\n\t\tif (typeof col === 'string') col = this.findColByName(col);\n\t\tif (col < 0) return;\n\t\tthis.data.rowData[row][col] = val;\n\t}\n\tpublic setInteger(row:number, col:number | string, val:number):void\n\t{\n\t\tif (typeof col === 'string') col = this.findColByName(col);\n\t\tif (col < 0) return;\n\t\tthis.data.rowData[row][col] = val;\n\t}\n\tpublic setReal(row:number, col:number | string, val:number):void\n\t{\n\t\tif (typeof col === 'string') col = this.findColByName(col);\n\t\tif (col < 0) return;\n\t\tthis.data.rowData[row][col] = val;\n\t}\n\tpublic setBoolean(row:number, col:number | string, val:boolean):void\n\t{\n\t\tif (typeof col === 'string') col = this.findColByName(col);\n\t\tif (col < 0) return;\n\t\tthis.data.rowData[row][col] = val;\n\t}\n\tpublic setExtend(row:number, col:number | string, val:string):void\n\t{\n\t\tif (typeof col === 'string') col = this.findColByName(col);\n\t\tif (col < 0) return;\n\t\tthis.data.rowData[row][col] = val;\n\t}\n\tpublic isEqualMolecule(row:number, col:number | string, mol:Molecule):boolean\n\t{\n\t\tif (typeof col === 'string') col = this.findColByName(col);\n\t\tif (this.isNull(row, col) != (mol == null)) return false;\n\t\tif (mol == null) return true;\n\t\treturn this.getMolecule(row, col).compareTo(mol) == 0;\n\t}\n\tpublic isEqualString(row:number, col:number | string, val:string):boolean\n\t{\n\t\tif (typeof col === 'string') col = this.findColByName(col);\n\t\tif (this.isNull(row, col) != (val == null || val == '')) return false;\n\t\tif (val == null || val == '') return true;\n\t\treturn this.getString(row, col) == val;\n\t}\n\tpublic isEqualInteger(row:number, col:number | string, val:number):boolean\n\t{\n\t\tif (typeof col === 'string') col = this.findColByName(col);\n\t\tif (this.isNull(row, col) != (val == null)) return false;\n\t\tif (val == null) return true;\n\t\treturn this.getInteger(row, col) == val;\n\t}\n\tpublic isEqualReal(row:number, col:number | string, val:number):boolean\n\t{\n\t\tif (typeof col === 'string') col = this.findColByName(col);\n\t\tif (this.isNull(row, col) != (val == null)) return false;\n\t\tif (val == null) return true;\n\t\treturn this.getReal(row, col) == val;\n\t}\n\tpublic isEqualBoolean(row:number, col:number | string, val:boolean):boolean\n\t{\n\t\tif (typeof col === 'string') col = this.findColByName(col);\n\t\tif (this.isNull(row, col) != (val == null)) return false;\n\t\tif (val == null) return true;\n\t\treturn this.getBoolean(row, col) == val;\n\t}\n\tpublic appendColumn(name:string, type:DataSheetColumn, descr:string):number\n\t{\n\t\tthis.data.numCols++;\n\t\tthis.data.colData.push({name, type, descr});\n\t\tfor (let n = 0; n < this.data.numRows; n++) this.data.rowData[n].push(null);\n\t\treturn this.data.numCols - 1;\n\t}\n\tpublic insertColumn(col:number, name:string, type:DataSheetColumn, descr:string):void\n\t{\n\t\tthis.data.numCols++;\n\t\tthis.data.colData.splice(col, 0, {name, type, descr});\n\t\tfor (let n = 0; n < this.data.numRows; n++) this.data.rowData[n].splice(col, 0, null);\n\t}\n\tpublic deleteColumn(col:number):void\n\t{\n\t\tthis.data.numCols--;\n\t\tthis.data.colData.splice(col, 1);\n\t\tfor (let n = 0; n < this.data.numRows; n++) this.data.rowData[n].splice(col, 1);\n\t}\n\tpublic changeColumnName(col:number, name:string, descr:string):void\n\t{\n\t\tthis.data.colData[col].name = name;\n\t\tthis.data.colData[col].descr = descr;\n\t}\n\tpublic changeColumnType(col:number, newType:DataSheetColumn):void\n\t{\n\t\tlet oldType = this.colType(col);\n\t\tif (oldType == newType) return;\n\n\t\tlet incompatible = oldType == DataSheetColumn.Molecule || newType == DataSheetColumn.Molecule ||\n\t\t\t\t\t\t   oldType == DataSheetColumn.Extend || newType == DataSheetColumn.Extend;\n\n\t\tfor (let n = this.data.rowData.length - 1; n >= 0; n--)\n\t\t{\n\t\t\tlet row = this.data.rowData[n];\n\t\t\tif (row[col] == null) continue;\n\t\t\tif (incompatible) {row[col] = null; continue;}\n\n\t\t\tlet val = '';\n\t\t\tif (oldType == DataSheetColumn.String) val = row[col] as string;\n\t\t\telse if (oldType == DataSheetColumn.Integer) val = (row[col] as number).toString();\n\t\t\telse if (oldType == DataSheetColumn.Real) val = (row[col] as number).toString();\n\t\t\telse if (oldType == DataSheetColumn.Boolean) val = row[col] as boolean ? 'true' : 'false';\n\n\t\t\trow[col] = null;\n\n\t\t\tif (newType == DataSheetColumn.String) row[col] = val;\n\t\t\telse if (newType == DataSheetColumn.Integer) {let num = parseInt(val); row[col] = isFinite(num) ? num : null;}\n\t\t\telse if (newType == DataSheetColumn.Real) {let num = parseFloat(val); row[col] = isFinite(num) ? num : null;}\n\t\t\telse if (newType == DataSheetColumn.Boolean) row[col] = val.toLowerCase() == 'true' ? true : false;\n\t\t}\n\n\t\tthis.data.colData[col].type = newType;\n\t}\n\tpublic ensureColumn(name:string, type:DataSheetColumn, descr:string):number\n\t{\n\t\tfor (let n = 0; n < this.data.numCols; n++) if (this.data.colData[n].name == name)\n\t\t{\n\t\t\tif (this.data.colData[n].type != type) this.changeColumnType(n, type);\n\t\t\tthis.data.colData[n].descr = descr;\n\t\t\treturn n;\n\t\t}\n\t\treturn this.appendColumn(name, type, descr);\n\t}\n\tpublic reorderColumns(order:number[]):void\n\t{\n\t\tlet identity = true;\n\t\tfor (let n = 0; n < order.length - 1; n++) if (order[n] != order[n + 1] - 1) {identity = false; break;}\n\t\tif (identity) return; // nothing to do\n\n\t\tthis.data.colData = Vec.idxGet(this.data.colData, order);\n\t\tfor (let n = 0; n < this.data.numRows; n++) this.data.rowData[n] = Vec.idxGet(this.data.rowData[n], order);\n\t}\n\tpublic appendRow():number\n\t{\n\t\tthis.data.numRows++;\n\t\tlet row = new Array();\n\t\tfor (let n = 0; n < this.data.numCols; n++) row.push(null);\n\t\tthis.data.rowData.push(row);\n\t\treturn this.data.numRows - 1;\n\t}\n\tpublic appendRowFrom(srcDS:DataSheet, row:number):number\n\t{\n\t\tthis.data.numRows++;\n\t\tthis.data.rowData.push(srcDS.data.rowData[row].slice(0));\n\t\treturn this.data.numRows - 1;\n\t}\n\tpublic insertRow(row:number):void\n\t{\n\t\tthis.data.numRows++;\n\t\tlet data = new Array();\n\t\tfor (let n = 0; n < this.data.numCols; n++) data.push(null);\n\t\tthis.data.rowData.splice(row, 0, data);\n\t}\n\tpublic deleteRow(row:number):void\n\t{\n\t\tthis.data.numRows--;\n\t\tthis.data.rowData.splice(row, 1);\n\t}\n\tpublic deleteAllRows():void\n\t{\n\t\tthis.data.numRows = 0;\n\t\tthis.data.rowData = new Array();\n\t}\n\tpublic moveRowUp(row:number):void\n\t{\n\t\tlet data = this.data.rowData[row];\n\t\tthis.data.rowData[row] = this.data.rowData[row - 1];\n\t\tthis.data.rowData[row - 1] = data;\n\t}\n\tpublic moveRowDown(row:number):void\n\t{\n\t\tlet data = this.data.rowData[row];\n\t\tthis.data.rowData[row] = this.data.rowData[row + 1];\n\t\tthis.data.rowData[row + 1] = data;\n\t}\n\tpublic swapRows(row1:number, row2:number):void\n\t{\n\t\tVec.swap(this.data.rowData, row1, row2);\n\t}\n\tpublic exciseSingleRow(row:number):DataSheet\n\t{\n\t\tlet newData =\n\t\t{\n\t\t\ttitle: this.data.title,\n\t\t\tdescription: this.data.description,\n\t\t\tnumCols: this.data.numCols,\n\t\t\tnumRows: 1,\n\t\t\tnumExtens: this.data.numExtens,\n\t\t\tcolData: this.data.colData.slice(0),\n\t\t\trowData: [this.data.rowData[row].slice(0)],\n\t\t\textData: this.data.extData.slice(0)\n\t\t};\n\t\treturn new DataSheet(newData);\n\t}\n\tpublic colIsPrimitive(col:number | string):boolean\n\t{\n\t\tif (typeof col === 'string') col = this.findColByName(col);\n\t\tlet ct = this.data.colData[col].type;\n\t\treturn ct == 'string' || ct == 'real' || ct == 'integer' || ct == 'boolean';\n\t}\n\tpublic findColByName(name:string, type?:string):number\n\t{\n\t\tfor (let n = 0; n < this.data.numCols; n++) if (this.data.colData[n].name == name)\n\t\t{\n\t\t\tif (type == null || this.data.colData[n].type == type) return n;\n\t\t}\n\t\treturn -1;\n\t}\n\tpublic firstColOfType(type:string):number\n\t{\n\t\tfor (let n = 0; n < this.data.numCols; n++) if (this.data.colData[n].type == type) return n;\n\t\treturn -1;\n\t}\n\n\t// bring in a cell from the contents of another datasheet's cell, making an honest attempt to convert the data\n\t// if the type is different; completely incompatible data equates to null\n\tpublic copyCell(toRow:number, toCol:number, fromDS:DataSheet, fromRow:number, fromCol:number):void\n\t{\n\t\tthis.setToNull(toRow, toCol);\n\t\tif (fromDS.isNull(fromRow, fromCol)) return;\n\t\tlet obj = fromDS.getObject(fromRow, fromCol);\n\t\tthis.setObject(toRow, toCol, DataSheet.convertType(obj, fromDS.colType(fromCol), this.colType(toCol)));\n\t}\n\n\t// when possibly converting between two column types, make sure that the object is compatible\n\tpublic static convertType(obj:any, fromType:DataSheetColumn, toType:DataSheetColumn):any\n\t{\n\t\tconst ft = fromType, tt = toType;\n\t\tif (obj == null || ft == tt || (typeof obj == 'string' && obj == '')) return obj;\n\n\t\tif (tt == DataSheetColumn.String)\n\t\t{\n\t\t\tif (ft == DataSheetColumn.Integer) return obj.toString();\n\t\t\telse if (ft == DataSheetColumn.Real) return obj.toString();\n\t\t\telse if (ft == DataSheetColumn.Boolean) return obj ? 'true' : 'false';\n\t\t}\n\t\telse if (tt == DataSheetColumn.Real)\n\t\t{\n\t\t\tif (ft == DataSheetColumn.String) return safeFloat(obj, null);\n\t\t\telse if (ft == DataSheetColumn.Integer) return obj;\n\t\t\telse if (ft == DataSheetColumn.Boolean) return obj ? 1 : 0;\n\t\t}\n\t\telse if (tt == DataSheetColumn.Integer)\n\t\t{\n\t\t\tif (ft == DataSheetColumn.String) return safeInt(obj, null);\n\t\t\telse if (ft == DataSheetColumn.Real) return Math.round(obj);\n\t\t\telse if (ft == DataSheetColumn.Boolean) return obj ? 1 : 0;\n\t\t}\n\t\telse if (tt == DataSheetColumn.Boolean)\n\t\t{\n\t\t\tif (ft == DataSheetColumn.String) return (obj as string).toLowerCase() == 'true';\n\t\t\telse if (ft == DataSheetColumn.Integer) return obj > 0;\n\t\t\telse if (ft == DataSheetColumn.Real) return obj >= 0.5;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t// converts a cell to a string by whatever means necessary (or returns null)\n\tpublic toString(row:number, col:number | string):string\n\t{\n\t\tif (typeof col === 'string') col = this.findColByName(col);\n\t\tlet obj = this.data.rowData[row][col];\n\t\treturn obj == null ? null : obj.toString();\n\t}\n\n\t// converts a cell to a number; returns null or NaN as appropriate\n\tpublic toInt(row:number, col:number):number\n\t{\n\t\tif (!this.colIsPrimitive(col)) return null;\n\t\tlet obj = this.data.rowData[row][col];\n\t\treturn obj == null ? null : parseInt(obj);\n\t}\n\tpublic toReal(row:number, col:number):number\n\t{\n\t\tif (!this.colIsPrimitive(col)) return null;\n\t\tlet obj = this.data.rowData[row][col];\n\t\treturn obj == null ? null : parseFloat(obj);\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {DataSheet} from '../data/DataSheet';\nimport {MetaVector} from '../gfx/MetaVector';\nimport {RenderPolicy} from '../gfx/Rendering';\nimport {Vec} from '../util/Vec';\n\n/*\n\tAbstract base class for all \"Aspects\".\n\n\tAn aspect is a piece of functionality that sits on top of an existing datasheet and provides an extra layer of\n\tinterpretation. The scalar datatypes used by datasheets are very basic, and can be used or abused with relatively\n\tlittle implied structure.\n\n\tAspects can be created explicitly in code, and they will be handed a datasheet instance to operate on. They are\n\texpected to install whatever metadata they need, within the constructor (e.g. extensions, and additional fields).\n\n\tIf the aspect installs an extension which is given the type \"org.mmi.aspect.{something}\", then it is possible for the\n\taspect to be installed automatically at key points (by the AspectList class), as long as the class named\n\t\"com.mmi.core.aspect.{something\"} or \"com.mmi.aspect.{something}\" can be found (note the switch from 'org' to 'com').\n\n\tAn aspect must always be pessimistic about the integrity of its data. DataSheets can be modified by non-aspect-aware\n\teditors. On creation it must be prepared to create its metadata/necessary fields from scratch, or to repair _any_ kind of\n\tcorruption performed by an external process. Implementation of certain methods in the Aspect class can help to\n\tprevent these conflicts, but they should not be relied on.\n*/\n\nexport interface AspectTextRendering\n{\n\tname:string;\n\tdescr:string;\n\ttext:string;\n\ttype:number; // one of Aspect.TEXT_*\n}\nexport interface AspectGraphicRendering\n{\n\tname:string;\n\tmetavec:MetaVector;\n}\n\nexport abstract class Aspect\n{\n\tpublic ds:DataSheet;\n\tprotected allowModify = true; // if set to false, aspect is not allowed to modify any part of the header\n\n\t// usually provide an existing datasheet with the aspect already installed; if not, it will be added (as long as\n\t// modification is allowed); if no datasheet, creates a blank one\n\tconstructor(public code:string, ds?:DataSheet, allowModify?:boolean)\n\t{\n\t\tthis.ds = ds ? ds : new DataSheet();\n\t\tif (allowModify != null) this.allowModify = allowModify;\n\t}\n\n\t// must return a simple, short string describing the aspect\n\tpublic abstract plainHeading():string;\n\n\t// if the aspect wants to \"claim\" any column names (whether they exist or not) for its own purposes - nominally both\n\t// rendering and editing - it should override this method and return true; various implementations may or may not choose\n\t// to honour this\n\tpublic isColumnReserved(colName:string):boolean {return false;}\n\n\t// a bulk version of above: override this only if is overhead per determination\n\tpublic areColumnsReserved(colNames:string[]):boolean[]\n\t{\n\t\tlet resMask = Vec.booleanArray(false, colNames.length);\n\t\tfor (let n = 0; n < colNames.length; n++) resMask[n] = this.isColumnReserved(colNames[n]);\n\t\treturn resMask;\n\t}\n\n\t// some aspects reserve multiple rows as a \"block\" (e.g. multistep reaction experiments); the following two methods must\n\t// be overidden to achieve this: a row must be able to indicate whether it is the beginning of a block; and the block size\n\t// must be countable; the default implementation implies each row is a singleton; note that both of these methods are\n\t// required, because the implied results may be inconsistent with inconsistent datasheets (e.g. streams)\n\tpublic rowFirstBlock(row:number):boolean {return true;}\n\tpublic rowBlockCount(row:number):number {return 1;}\n\n\t// given another aspect (presumed to be the same type), make sure the parameters of the current aspect are such that it can\n\t// accommodate data from the new one; various header settings and columns must be modified as necessary\n\tpublic aspectUnion(other:Aspect):void {}\n\n\t// provides an opportunity to carry out modifications on a newly added row, which is intended to represent a new unit entity - the aspect may need\n\t// to setup some defaults\n\tpublic initiateNewRow(row:number):void {}\n\n\t// companion to above: returns a list of rows that can be considered blank because they are auto-created\n\tpublic columnEffectivelyBlank(row:number):string[] {return [];}\n\n\t// rendering:\n\t//\t\tan aspect may optionally volunteer to provide some static visualisation data to describe itself; this balances\n\t//\t\tout against the aspect's ability to reserve columns, which typically means that they will not be displayed; the\n\t//\t\tnumber and types of renderings can vary from row to row\n\n\t// text rendering: this is analogous to a pseudocolumn, and so name & description may optionally be manufactured as well\n\t// as text content\n\tpublic static TEXT_PLAIN = 0;\n\tpublic static TEXT_LINK = 1;\n\tpublic static TEXT_HTML = 2;\n\n\tpublic numTextRenderings(row:number):number {return 0;}\n\tpublic produceTextRendering(row:number, idx:number):AspectTextRendering {return null;}\n\n\t// graphical rendering: the caller must provide a vector graphics context, into which will be drawn a visual representation\n\t// of the rendering; a render policy is provided, and the implementation is expected make use of it (e.g. scale, foreground\n\t// colour); the returned object provides additional metadata: the vector graphics builder object is typically the\n\t// same object as provided as the parameter\n\tpublic numGraphicRenderings(row:number):number {return 0;}\n\tpublic produceGraphicRendering(row:number, idx:number, policy:RenderPolicy):AspectGraphicRendering {return null;}\n\n\t// header rendering: some number of text items that describe the datasheet overall; these are typically {name:value} pairs, which\n\t// are shown at the beginning of the datasheet, and supplement the universal title & description fields\n\tpublic numHeaderRenderings():number {return 0;}\n\tpublic produceHeaderRendering(idx:number):AspectTextRendering {return null;}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {DataSheet} from '../data/DataSheet';\nimport {Aspect} from './Aspect';\n\n/*\n\tThe AspectList class is used as a way to fetch all of the recognised aspects that are installed within a given datasheet, without\n\thaving to manually invoke each of the classes individually. Each aspect that is implemented within the toolkit needs to be added\n\texplicitly here, if it is going to get automatically considered during routine operations (e.g. rendering arbitrary datasheets).\n*/\n\ninterface SupportedAspect\n{\n\tcode:string;\n\tname:string;\n\tclassdef:any;\n}\nlet supportedAspects:Record<string, SupportedAspect> = {}; // code-to-definition\n\n//\teach aspect has to call this method globally as early as possible in order to be recognised; e.g.\n//\t\tclass CustomAspect extends Aspect {...}\n//\t\tregisterAspect(CustomAspect);\nexport function registerAspect(classdef:any):void\n{\n\tlet code = classdef.CODE as string, name = classdef.NAME as string;\n\tsupportedAspects[code] = {code, name, classdef};\n}\n\nexport class AspectList\n{\n\tconstructor(public ds:DataSheet)\n\t{\n\t}\n\n\t// returns two arrays: the first is a list of aspect codes that exist within the datasheet's header already; the second is a list of\n\t// codes from the recognised list that are not; note that any aspects that are not in either of these lists are missing because they're\n\t// not encoded within this class, which means that they're probably not supported at all by this toolkit\n\tpublic list():[string[], string[]]\n\t{\n\t\tlet present:string[] = [], absent:string[] = [];\n\n\t\tlet codes = new Set<string>();\n\t\tfor (let n = 0; n < this.ds.numExtensions; n++) codes.add(this.ds.getExtType(n));\n\n\t\tfor (let code in supportedAspects) if (codes.has(code)) present.push(code); else absent.push(code);\n\n\t\treturn [present, absent];\n\t}\n\n\t// instantiates an aspect by creating the class instance that matches the given code; if the code is not in the supported list,\n\t// returns null; note that calling this function takes action that can modify the datasheet: it will be inducted if it does not\n\t// already exist; if it does exist, it is given the chance to make corrective changes to the content\n\tpublic instantiate(code:string):Aspect\n\t{\n\t\tlet supp = supportedAspects[code];\n\t\tif (supp) return new supp.classdef(this.ds) as Aspect;\n\t\treturn null;\n\t}\n\n\t// goes through the header and instantiates every applicable aspect that is inducted (equivalent to using list & instantiate each)\n\tpublic enumerate():Aspect[]\n\t{\n\t\tlet aspects:Aspect[] = [];\n\t\tfor (let n = 0; n < this.ds.numExtensions; n++)\n\t\t{\n\t\t\tlet code = this.ds.getExtType(n);\n\t\t\tif (supportedAspects[code]) aspects.push(this.instantiate(code));\n\t\t}\n\t\treturn aspects;\n\t}\n\n\t// fetches just the name of an aspect, without instantiating it\n\tpublic aspectName(code:string):string\n\t{\n\t\tlet supp = supportedAspects[code];\n\t\treturn supp ? supp.name : null;\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n    [PKG=webmolkit]\n*/\n\nimport {DataSheet, DataSheetColumn} from '../data/DataSheet';\nimport {Molecule} from '../data/Molecule';\nimport {MoleculeStream} from '../data/MoleculeStream';\nimport {Aspect, AspectTextRendering} from './Aspect';\nimport {registerAspect} from './AspectList';\n\n/* eslint-disable @typescript-eslint/naming-convention */\n\n/*\n\tAssayProvenance: informs that a datasheet originates from a distinct assay measurement of a particular\n\tbiological target or property, and that each row represents a compound and a measurement. There is some\n\tlatitude to the specifics of each row, but most of the information has defaults that are stored in the\n\theader.\n*/\n\nexport class AssayProvenanceHeader\n{\n\tpublic prefixes:Record<string, string> = {};\n\tpublic targetName = '';\n\tpublic targetURI = '';\n\tpublic organismName = '';\n\tpublic organismURI = '';\n\tpublic targetTypeName = '';\n\tpublic targetTypeURI = '';\n\tpublic cellName = '';\n\tpublic cellURI = '';\n\tpublic assayTypeName = '';\n\tpublic assayTypeURI = '';\n\tpublic assayDescription = '';\n\tpublic sourceName = '';\n\tpublic sourceURI = '';\n\tpublic sourceVersion = '';\n\tpublic documentName = '';\n\tpublic documentURI = '';\n\tpublic measureTypeName = '';\n\tpublic measureTypeURI = '';\n\tpublic unitNames:string[] = [];\n\tpublic unitURIs:string[] = [];\n}\n\nexport class AssayProvenance extends Aspect\n{\n\tpublic static CODE = 'org.mmi.aspect.AssayProvenance';\n\tpublic static NAME = 'Assay Provenance';\n\n\tpublic static COLNAME_MOLECULE = 'Molecule'; // molecule\n\tpublic static COLNAME_NAME = 'Name'; // string\n\tpublic static COLNAME_VALUE = 'Value'; // real\n\tpublic static COLNAME_ERROR = 'Error'; // real\n\tpublic static COLNAME_UNITS = 'Units'; // string\n\tpublic static COLNAME_RELATION = 'Relation'; // string\n\tpublic static COLNAME_SOURCEURI = 'SourceURI'; // string\n\n\t//\tprivate static final String[] RESERVED_COLUMNS = {COLNAME_MOLECULE, COLNAME_NAME, COLNAME_VALUE, COLNAME_ERROR, COLNAME_UNITS, COLNAME_RELATION, COLNAME_SOURCEURI};\n\n\t// convenient suggestions for unit URIs\n\tpublic static URI_UNIT_M = 'http://purl.obolibrary.org/obo/UO_0000062'; // moles per litre (mol/L)\n\tpublic static URI_UNIT_mM = 'http://purl.obolibrary.org/obo/UO_0000063'; // milli-moles per litre\n\tpublic static URI_UNIT_uM = 'http://purl.obolibrary.org/obo/UO_0000064'; // micro-moles per litre\n\tpublic static URI_UNIT_nM = 'http://purl.obolibrary.org/obo/UO_0000065'; // nano-moles per litre\n\tpublic static URI_UNIT_pM = 'http://purl.obolibrary.org/obo/UO_0000066'; // pico-moles per litre\n\tpublic static URI_UNIT_logM = 'http://www.bioassayontology.org/bao#BAO_0000101'; // log10 of mol/L\n\tpublic static URI_UNIT_perM = 'http://www.bioassayontology.org/bao#BAO_0000102'; // -log10 of mol/L\n\tpublic static URI_UNIT_gL = 'http://purl.obolibrary.org/obo/UO_0000175'; // grams per litre (g/L)\n\tpublic static URI_UNIT_mgL = 'http://purl.obolibrary.org/obo/UO_0000273'; // milligrams per litre\n\tpublic static URI_UNIT_ugL = 'http://purl.obolibrary.org/obo/UO_0000275'; // micrograms per litre\n\tpublic static URI_UNIT_binary = 'http://www.bioassayontology.org/bao#BAO_0080023'; // true/false\n\n\t// ----------------- public methods -----------------\n\n\t// used to test if a datasheet has the appropriate metadata flagging it as a feedstock-containing datasheet\n\tpublic static isAssayProvenance(ds:DataSheet):boolean\n\t{\n\t\tfor (let n = 0; n < ds.numExtensions; n++) if (ds.getExtType(n) == AssayProvenance.CODE) return true;\n\t\treturn false;\n\t}\n\n\tconstructor(ds?:DataSheet, allowModify?:boolean)\n\t{\n\t\tsuper(AssayProvenance.CODE, ds, allowModify);\n\t\tthis.setup();\n\t}\n\n\t// data access\n\tpublic getHeader():AssayProvenanceHeader\n\t{\n\t\tfor (let n = 0; n < this.ds.numExtensions; n++) if (this.ds.getExtType(n) == AssayProvenance.CODE)\n\t\t\treturn this.parseMetaData(this.ds.getExtData(n));\n\t\treturn null;\n\t}\n\tpublic setHeader(header:AssayProvenanceHeader):void\n\t{\n\t\tlet content = this.formatMetaData(header);\n\t\tfor (let n = 0; n < this.ds.numExtensions; n++) if (this.ds.getExtType(n) == AssayProvenance.CODE)\n\t\t{\n\t\t\tthis.ds.setExtData(n, content);\n\t\t\treturn;\n\t\t}\n\t\tthis.ds.appendExtension(AssayProvenance.NAME, AssayProvenance.CODE, content);\n\t}\n\n\tpublic getMolecule(row:number):Molecule\n\t{\n\t\tlet col = this.ds.findColByName(AssayProvenance.COLNAME_MOLECULE);\n\t\treturn col < 0 ? null : this.ds.getMolecule(row, col);\n\t}\n\tpublic getName(row:number):string\n\t{\n\t\tlet col = this.ds.findColByName(AssayProvenance.COLNAME_NAME);\n\t\treturn col < 0 ? null : this.ds.getString(row, col);\n\t}\n\tpublic getValue(row:number):number\n\t{\n\t\tlet col = this.ds.findColByName(AssayProvenance.COLNAME_VALUE);\n\t\treturn col < 0 ? null : this.ds.isNull(row, col) ? Number.NaN : this.ds.getReal(row, col);\n\t}\n\tpublic getError(row:number):number\n\t{\n\t\tlet col = this.ds.findColByName(AssayProvenance.COLNAME_ERROR);\n\t\tif (col < 0) return null;\n\t\tif (this.ds.isNull(row, col)) return Number.NaN;\n\t\tlet err = this.ds.getReal(row, col);\n\t\tif (err <= 0) return Number.NaN;\n\t\treturn err;\n\t}\n\tpublic getUnits(row:number):string\n\t{\n\t\tlet col = this.ds.findColByName(AssayProvenance.COLNAME_UNITS);\n\t\treturn col < 0 ? null : this.ds.getString(row, col);\n\t}\n\tpublic getRelation(row:number):string\n\t{\n\t\tlet col = this.ds.findColByName(AssayProvenance.COLNAME_RELATION);\n\t\treturn col < 0 ? null : this.ds.getString(row, col);\n\t}\n\tpublic getSourceURI(row:number):string\n\t{\n\t\tlet col = this.ds.findColByName(AssayProvenance.COLNAME_SOURCEURI);\n\t\treturn col < 0 ? null : this.ds.getString(row, col);\n\t}\n\tpublic setMolecule(row:number, v:Molecule):void\n\t{\n\t\tlet col = this.ds.findColByName(AssayProvenance.COLNAME_MOLECULE);\n\t\tif (col >= 0) this.ds.setMolecule(row, col, v);\n\t}\n\tpublic setName(row:number, v:string):void\n\t{\n\t\tlet col = this.ds.findColByName(AssayProvenance.COLNAME_NAME);\n\t\tif (col >= 0) this.ds.setString(row, col, v);\n\t}\n\tpublic setValue(row:number, v:number):void\n\t{\n\t\tlet col = this.ds.findColByName(AssayProvenance.COLNAME_VALUE);\n\t\tif (col < 0) {}\n\t\telse if (Number.isNaN(v)) this.ds.setToNull(row, col);\n\t\telse this.ds.setReal(row, col, v);\n\t}\n\tpublic setError(row:number, v:number):void\n\t{\n\t\tlet col = this.ds.findColByName(AssayProvenance.COLNAME_ERROR);\n\t\tif (col < 0) {}\n\t\telse if (Number.isNaN(v)) this.ds.setToNull(row, col);\n\t\telse this.ds.setReal(row, col, v);\n\t}\n\tpublic setUnits(row:number, v:string):void\n\t{\n\t\tlet col = this.ds.findColByName(AssayProvenance.COLNAME_UNITS);\n\t\tif (col >= 0) this.ds.setString(row, col, v);\n\t}\n\tpublic setRelation(row:number, v:string):void\n\t{\n\t\tlet col = this.ds.findColByName(AssayProvenance.COLNAME_RELATION);\n\t\tif (col >= 0) this.ds.setString(row, col, v);\n\t}\n\tpublic setSourceURI(row:number, v:string):void\n\t{\n\t\tlet col = this.ds.findColByName(AssayProvenance.COLNAME_SOURCEURI);\n\t\tif (col >= 0) this.ds.setString(row, col, v);\n\t}\n\n\t// ----------------- private methods -----------------\n\n\t// workhorse for the constructor\n\tprivate setup():void\n\t{\n\t\tthis.parseAndCorrect();\n\t}\n\n\t// assuming that the underlying datasheet definitely is a datasheet, makes any necessary corrections to force it into compliance\n\tprivate parseAndCorrect():void\n\t{\n\t\tlet header = new AssayProvenanceHeader();\n\n\t\tlet got = false;\n\t\tfor (let n = 0; n < this.ds.numExtensions; n++) if (this.ds.getExtType(n) == AssayProvenance.CODE)\n\t\t{\n\t\t\theader = this.parseMetaData(this.ds.getExtData(n));\n\t\t\tgot = true;\n\t\t\tbreak;\n\t\t}\n\n\t\tif (this.allowModify)\n\t\t{\n\t\t\tthis.ds.ensureColumn(AssayProvenance.COLNAME_MOLECULE, DataSheetColumn.Molecule, 'Molecular structure of compound being measured');\n\t\t\tthis.ds.ensureColumn(AssayProvenance.COLNAME_NAME, DataSheetColumn.String, 'Name of compound');\n\t\t\tthis.ds.ensureColumn(AssayProvenance.COLNAME_VALUE, DataSheetColumn.Real, 'Measured value');\n\t\t\tthis.ds.ensureColumn(AssayProvenance.COLNAME_ERROR, DataSheetColumn.Real, 'Experimental error of measurement');\n\t\t\tthis.ds.ensureColumn(AssayProvenance.COLNAME_UNITS, DataSheetColumn.String, 'Units of measurement');\n\t\t\tthis.ds.ensureColumn(AssayProvenance.COLNAME_RELATION, DataSheetColumn.String, 'Relation: exact, greater or less');\n\t\t\tthis.ds.ensureColumn(AssayProvenance.COLNAME_SOURCEURI, DataSheetColumn.String, 'Source identifier for activity measurement');\n\t\t}\n\n\t\tif (!got && this.allowModify)\n\t\t{\n\t\t\tlet content = this.formatMetaData(header);\n\t\t\tthis.ds.appendExtension(AssayProvenance.NAME, AssayProvenance.CODE, content);\n\t\t}\n\t}\n\n\t// interprets the string metadata from the extensions\n\tprivate parseMetaData(content:string):AssayProvenanceHeader\n\t{\n\t\tlet header = new AssayProvenanceHeader();\n\n\t\tfor (let line of content.split(/\\r?\\n/))\n\t\t{\n\t\t\tlet eq = line.indexOf('=');\n\t\t\tif (eq < 0) continue;\n\t\t\tif (line.startsWith('pfx:')) header.prefixes[MoleculeStream.skUnescape(line.substring(4, eq))] = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('targetName=')) header.targetName = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('targetURI=')) header.targetURI = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('organismName=')) header.organismName = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('organismURI=')) header.organismURI = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('targetTypeName=')) header.targetTypeName = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('targetTypeURI=')) header.targetTypeURI = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('cellName=')) header.cellName = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('cellURI=')) header.cellURI = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('assayTypeName=')) header.assayTypeName = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('assayTypeURI=')) header.assayTypeURI = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('assayDescription=')) header.assayDescription = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('sourceName=')) header.sourceName = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('sourceURI=')) header.sourceURI = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('sourceVersion=')) header.sourceVersion = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('documentName=')) header.documentName = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('documentURI=')) header.documentURI = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('measureTypeName=')) header.measureTypeName = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('measureTypeURI=')) header.measureTypeURI = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('unit:'))\n\t\t\t{\n\t\t\t\theader.unitNames.push(MoleculeStream.skUnescape(line.substring(5, eq)));\n\t\t\t\theader.unitURIs.push(MoleculeStream.skUnescape(line.substring(eq + 1)));\n\t\t\t}\n\t\t}\n\n\t\treturn header;\n\t}\n\n\t// deserialises the header metadata\n\tprivate formatMetaData(header:AssayProvenanceHeader):string\n\t{\n\t\tlet content = '';\n\n\t\tfor (let pfx in header.prefixes) content += 'pfx:' + MoleculeStream.skEscape(pfx) + '=' + MoleculeStream.skEscape(header.prefixes[pfx]) + '\\n';\n\t\tcontent += 'targetName=' + MoleculeStream.skEscape(header.targetName) + '\\n';\n\t\tcontent += 'targetURI=' + MoleculeStream.skEscape(header.targetURI) + '\\n';\n\t\tcontent += 'organismName=' + MoleculeStream.skEscape(header.organismName) + '\\n';\n\t\tcontent += 'organismURI=' + MoleculeStream.skEscape(header.organismURI) + '\\n';\n\t\tcontent += 'targetTypeName=' + MoleculeStream.skEscape(header.targetTypeName) + '\\n';\n\t\tcontent += 'targetTypeURI=' + MoleculeStream.skEscape(header.targetTypeURI) + '\\n';\n\t\tcontent += 'cellName=' + MoleculeStream.skEscape(header.cellName) + '\\n';\n\t\tcontent += 'cellURI=' + MoleculeStream.skEscape(header.cellURI) + '\\n';\n\t\tcontent += 'assayTypeName=' + MoleculeStream.skEscape(header.assayTypeName) + '\\n';\n\t\tcontent += 'assayTypeURI=' + MoleculeStream.skEscape(header.assayTypeURI) + '\\n';\n\t\tcontent += 'assayDescription=' + MoleculeStream.skEscape(header.assayDescription) + '\\n';\n\t\tcontent += 'sourceName=' + MoleculeStream.skEscape(header.sourceName) + '\\n';\n\t\tcontent += 'sourceURI=' + MoleculeStream.skEscape(header.sourceURI) + '\\n';\n\t\tcontent += 'sourceVersion=' + MoleculeStream.skEscape(header.sourceVersion) + '\\n';\n\t\tcontent += 'documentName=' + MoleculeStream.skEscape(header.documentName) + '\\n';\n\t\tcontent += 'documentURI=' + MoleculeStream.skEscape(header.documentURI) + '\\n';\n\t\tcontent += 'measureTypeName=' + MoleculeStream.skEscape(header.measureTypeName) + '\\n';\n\t\tcontent += 'measureTypeURI=' + MoleculeStream.skEscape(header.measureTypeURI) + '\\n';\n\t\tfor (let n = 0, num = Math.min(header.unitNames.length, header.unitURIs.length); n < num; n++)\n\t\t\tcontent += 'unit:' + MoleculeStream.skEscape(header.unitNames[n]) + '=' + MoleculeStream.skEscape(header.unitURIs[n]) + '\\n';\n\n\t\treturn content;\n\t}\n\n\t// ------------------ aspect implementation --------------------\n\n\tpublic plainHeading():string {return AssayProvenance.NAME;}\n\n\tpublic isColumnReserved(colName:string):boolean\n\t{\n\t\treturn colName == AssayProvenance.COLNAME_VALUE || colName == AssayProvenance.COLNAME_ERROR ||\n\t\t\t\tcolName == AssayProvenance.COLNAME_UNITS || colName == AssayProvenance.COLNAME_RELATION ||\n\t\t\t\tcolName == AssayProvenance.COLNAME_SOURCEURI;\n\t}\n\n\tpublic numTextRenderings(row:number):number {return 2;}\n\tpublic produceTextRendering(row:number, idx:number):AspectTextRendering\n\t{\n\t\tlet header = this.getHeader();\n\n\t\tif (idx == 0)\n\t\t{\n\t\t\tlet tr:AspectTextRendering =\n\t\t\t{\n\t\t\t\tname: 'Activity',\n\t\t\t\tdescr: 'Activity measurement details for this record',\n\t\t\t\ttext: '',\n\t\t\t\ttype: Aspect.TEXT_PLAIN\n\t\t\t};\n\n\t\t\tlet val = this.getValue(row), error = this.getError(row);\n\t\t\tlet units = this.getUnits(row), rel = this.getRelation(row);\n\n\t\t\ttr.text = '';\n\t\t\tif (!Number.isNaN(val))\n\t\t\t{\n\t\t\t\tif (rel) tr.text += rel + ' ';\n\t\t\t\ttr.text += val;\n\t\t\t\tif (!Number.isNaN(error)) tr.text += ' \\u{00B1} ' + error;\n\t\t\t\tif (units) tr.text += ' ' + units;\n\t\t\t}\n\t\t\treturn tr;\n\t\t}\n\t\telse if (idx == 1)\n\t\t{\n\t\t\tlet tr:AspectTextRendering =\n\t\t\t{\n\t\t\t\tname: 'Source',\n\t\t\t\tdescr: 'Origin of the structure and activity measurement',\n\t\t\t\ttext: '',\n\t\t\t\ttype: Aspect.TEXT_LINK\n\t\t\t};\n\n\t\t\tlet url = this.getSourceURI(row);\n\t\t\tfor (let pfx in header.prefixes) if (url.startsWith(pfx + ':'))\n\t\t\t{\n\t\t\t\turl = header.prefixes[pfx] + url.substring(pfx.length + 1);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\ttr.text = url;\n\t\t\treturn tr;\n\t\t}\n\n\t\treturn null;\n\t}\n}\n\nregisterAspect(AssayProvenance);\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {DataSheet} from '../data/DataSheet';\nimport {MoleculeStream} from '../data/MoleculeStream';\nimport {Aspect} from './Aspect';\nimport {registerAspect} from './AspectList';\n\n/*\n\tBayesianSource: tracks some number of numeric columns which can be used to create Bayesian models. Keeps track of various pre-processing\n\trequirements (e.g. threshold), parameters (e.g. folding) and metadata (e.g. description).\n*/\n\nexport class BayesianSourceModel\n{\n\tpublic colNameMolecule = ''; // where to grab the molecules from\n\tpublic colNameValue = ''; // name of column with numeric source content (integer/real/boolean)\n\tpublic thresholdValue = 0.5; // threshold for turning free numbers into booleans\n\tpublic thresholdRelation = '>='; // one of \"<\", \">\", \"<=\", \">=\"\n\t// (wouldn't it be a good idea to put the fingerprint type in here?)\n\tpublic folding = 0; // bitscale: 0=no folding, 2^n=folding into a bitmask range\n\tpublic noteField = ''; // field name for output model; defaults to value column name\n\tpublic noteTitle = ''; // model title: defaults to datasheet title\n\tpublic noteOrigin = ''; // model origin: defaults to filename\n\tpublic noteComment = ''; // totally optional, no default\n}\n\nexport class BayesianSource extends Aspect\n{\n\tpublic static CODE = 'org.mmi.aspect.BayesianSource';\n\tpublic static NAME = 'Bayesian Source';\n\n\t// ----------------- public methods -----------------\n\n\t// used to test if a datasheet has the appropriate metadata flagging it as this aspect\n\tpublic static isBayesianSource(ds:DataSheet):boolean\n\t{\n\t\tfor (let n = 0; n < ds.numExtensions; n++) if (ds.getExtType(n) == BayesianSource.CODE) return true;\n\t\treturn false;\n\t}\n\n\tconstructor(ds?:DataSheet, allowModify?:boolean)\n\t{\n\t\tsuper(BayesianSource.CODE, ds, allowModify);\n\t\tthis.setup();\n\t}\n\n\t// data access\n\tpublic getModels():BayesianSourceModel[]\n\t{\n\t\tlet content = '';\n\t\tfor (let n = 0; n < this.ds.numExtensions; n++) if (this.ds.getExtType(n) == BayesianSource.CODE)\n\t\t{\n\t\t\tcontent = this.ds.getExtData(n);\n\t\t\tbreak;\n\t\t}\n\n\t\tlet models:BayesianSourceModel[] = [];\n\t\tlet m:BayesianSourceModel = null;\n\n\t\tfor (let line of content.split('\\n'))\n\t\t{\n\t\t\tif (line == 'model:')\n\t\t\t{\n\t\t\t\tif (m != null) models.push(m);\n\t\t\t\tm = {} as BayesianSourceModel;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (m == null) continue;\n\t\t\tlet eq = line.indexOf('=');\n\t\t\tif (eq < 0) continue;\n\n\t\t\tif (line.startsWith('colNameMolecule=')) m.colNameMolecule = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('colNameValue=')) m.colNameValue = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('thresholdValue=')) m.thresholdValue = parseFloat(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('thresholdRelation=')) m.thresholdRelation = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('folding=')) m.folding = parseInt(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('noteField=')) m.noteField = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('noteTitle=')) m.noteTitle = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('noteOrigin=')) m.noteOrigin = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('noteComment=')) m.noteComment = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t}\n\n\t\tif (m != null) models.push(m);\n\t\treturn models;\n\t}\n\tpublic setModels(models:BayesianSourceModel[]):void\n\t{\n\t\tlet lines:string[] = [];\n\n\t\tfor (let m of models)\n\t\t{\n\t\t\tlines.push('model:');\n\t\t\tlines.push('colNameMolecule=' + MoleculeStream.skEscape(m.colNameMolecule));\n\t\t\tlines.push('colNameValue=' + MoleculeStream.skEscape(m.colNameValue));\n\t\t\tlines.push('thresholdValue=' + m.thresholdValue);\n\t\t\tlines.push('thresholdRelation=' + MoleculeStream.skEscape(m.thresholdRelation));\n\t\t\tlines.push('folding=%d' + m.folding);\n\t\t\tlines.push('noteField=' + MoleculeStream.skEscape(m.noteField));\n\t\t\tlines.push('noteTitle=' + MoleculeStream.skEscape(m.noteTitle));\n\t\t\tlines.push('noteOrigin=' + MoleculeStream.skEscape(m.noteOrigin));\n\t\t\tlines.push('noteComment=' + MoleculeStream.skEscape(m.noteComment));\n\t\t}\n\n\t\tlet content = lines.join('\\n');\n\t\tfor (let n = 0; n < this.ds.numExtensions; n++) if (this.ds.getExtType(n) == BayesianSource.CODE)\n\t\t{\n\t\t\tthis.ds.setExtData(n, content.toString());\n\t\t\treturn;\n\t\t}\n\t\tthis.ds.appendExtension('BayesianSource', BayesianSource.CODE, content.toString());\n\t}\n\n\t// ----------------- private methods -----------------\n\n\t// workhorse for the constructor\n\tprivate setup():void\n\t{\n\t\tif (this.allowModify)\n\t\t{\n\t\t\tlet models = this.getModels();\n\t\t\tthis.setModels(models);\n\t\t}\n\t}\n\n\t// ------------------ aspect implementation --------------------\n\n\tpublic plainHeading():string {return BayesianSource.NAME;}\n}\n\nregisterAspect(BayesianSource);\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {DataSheet, DataSheetColumn} from '../data/DataSheet';\nimport {MoleculeStream} from '../data/MoleculeStream';\nimport {Aspect} from './Aspect';\nimport {registerAspect} from './AspectList';\nimport {BayesianSource} from './BayesianSource';\n\n/*\n\tBayesian prediction: records some number of outcomes from Bayesian models, noting the columns that hold the predictions themselves and\n\tkeeping some metadata about each.\n*/\n\nexport class BayesianPredictionModel\n{\n\tpublic colMolecule:string;\n\tpublic colRaw:string;\n\tpublic colScaled:string;\n\tpublic colArcTan:string;\n\tpublic colDomain:string;\n\tpublic colAtoms:string;\n\tpublic name:string;\n\tpublic description:string;\n\tpublic targetName:string;\n\tpublic isOffTarget:boolean;\n}\n\nexport class BayesianPredictionOutcome\n{\n\tpublic raw:number;\n\tpublic scaled:number;\n\tpublic arctan:number;\n\tpublic domain:number;\n\tpublic atoms:number[];\n}\n\nexport class BayesianPrediction extends Aspect\n{\n\tpublic static CODE = 'org.mmi.aspect.BayesianPrediction';\n\tpublic static NAME = 'Bayesian Prediction';\n\n\t// ----------------- public methods -----------------\n\n\t// used to test if a datasheet has the appropriate metadata flagging it as this aspect\n\tpublic static isBayesianPrediction(ds:DataSheet):boolean\n\t{\n\t\tfor (let n = 0; n < ds.numExtensions; n++) if (ds.getExtType(n) == BayesianPrediction.CODE) return true;\n\t\treturn false;\n\t}\n\n\tconstructor(ds?:DataSheet, allowModify?:boolean)\n\t{\n\t\tsuper(BayesianPrediction.CODE, ds, allowModify);\n\t\tthis.setup();\n\t}\n\n\tpublic getModels():BayesianPredictionModel[]\n\t{\n\t\tlet content = '';\n\t\tfor (let n = 0; n < this.ds.numExtensions; n++) if (this.ds.getExtType(n) == BayesianPrediction.CODE)\n\t\t{\n\t\t\tcontent = this.ds.getExtData(n);\n\t\t\tbreak;\n\t\t}\n\n\t\tlet models:BayesianPredictionModel[] = [];\n\t\tlet m:BayesianPredictionModel = null;\n\n\t\tfor (let line of content.split('\\n'))\n\t\t{\n\t\t\tif (line == 'model:')\n\t\t\t{\n\t\t\t\tif (m != null) models.push(m);\n\t\t\t\tm = {} as BayesianPredictionModel;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (m == null) continue;\n\t\t\tlet eq = line.indexOf('=');\n\t\t\tif (eq < 0) continue;\n\n\t\t\tif (line.startsWith('colMolecule=')) m.colMolecule = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('colRaw=')) m.colRaw = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('colScaled=')) m.colScaled = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('colArcTan=')) m.colArcTan = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('colDomain=')) m.colDomain = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('colAtoms=')) m.colAtoms = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('name=')) m.name = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('description=')) m.description = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('targetName=')) m.targetName = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('isOffTarget=')) m.isOffTarget = line.substring(eq + 1) == 'true';\n\t\t}\n\n\t\tif (m != null) models.push(m);\n\t\treturn models;\n\t}\n\tpublic setModels(models:BayesianPredictionModel[]):void\n\t{\n\t\tlet lines:string[] = [];\n\n\t\tfor (let m of models)\n\t\t{\n\t\t\tlines.push('model:');\n\t\t\tlines.push('colMolecule=' + MoleculeStream.skEscape(m.colMolecule));\n\t\t\tlines.push('colRaw=' + MoleculeStream.skEscape(m.colRaw));\n\t\t\tlines.push('colScaled=' + MoleculeStream.skEscape(m.colScaled));\n\t\t\tlines.push('colArcTan=' + MoleculeStream.skEscape(m.colArcTan));\n\t\t\tlines.push('colDomain=' + MoleculeStream.skEscape(m.colDomain));\n\t\t\tlines.push('colAtoms=' + MoleculeStream.skEscape(m.colAtoms));\n\t\t\tlines.push('name=' + MoleculeStream.skEscape(m.name));\n\t\t\tlines.push('description=' + MoleculeStream.skEscape(m.description));\n\t\t\tlines.push('targetName=' + MoleculeStream.skEscape(m.targetName));\n\t\t\tlines.push('isOffTarget=' + m.isOffTarget);\n\t\t}\n\n\t\tlet content = lines.join('\\n');\n\t\tfor (let n = 0; n < this.ds.numExtensions; n++) if (this.ds.getExtType(n) == BayesianSource.CODE)\n\t\t{\n\t\t\tthis.ds.setExtData(n, content.toString());\n\t\t\treturn;\n\t\t}\n\t\tthis.ds.appendExtension('BayesianPrediction', BayesianPrediction.CODE, content.toString());\n\t}\n\n\t// rowdata access\n\tpublic getOutcome(row:number, model:BayesianPredictionModel):BayesianPredictionOutcome\n\t{\n\t\tlet outcome = new BayesianPredictionOutcome();\n\t\toutcome.raw = this.ds.getReal(row, model.colRaw);\n\t\toutcome.scaled = this.ds.getReal(row, model.colScaled);\n\t\toutcome.arctan = this.ds.getReal(row, model.colArcTan);\n\t\toutcome.domain = this.ds.getReal(row, model.colDomain);\n\n\t\tlet strAtoms = this.ds.getString(row, model.colAtoms);\n\t\tif (strAtoms)\n\t\t{\n\t\t\toutcome.atoms = [];\n\t\t\tfor (let b of strAtoms.split(',')) outcome.atoms.push(parseFloat(b));\n\t\t}\n\n\t\treturn outcome;\n\t}\n\tpublic setOutcome(row:number, model:BayesianPredictionModel, outcome:BayesianPredictionOutcome):void\n\t{\n\t\tlet col = this.ds.findColByName(model.colRaw, DataSheetColumn.Real);\n\t\tif (col >= 0) this.ds.setReal(row, col, outcome.raw);\n\n\t\tcol = this.ds.findColByName(model.colScaled, DataSheetColumn.Real);\n\t\tif (col >= 0) this.ds.setReal(row, col, outcome.scaled);\n\n\t\tcol = this.ds.findColByName(model.colArcTan, DataSheetColumn.Real);\n\t\tif (col >= 0) this.ds.setReal(row, col, outcome.arctan);\n\n\t\tcol = this.ds.findColByName(model.colDomain, DataSheetColumn.Real);\n\t\tif (col >= 0) this.ds.setReal(row, col, outcome.domain);\n\n\t\tcol = this.ds.findColByName(model.colAtoms, DataSheetColumn.String);\n\t\tif (col >= 0) this.ds.setString(row, col, outcome.atoms ? outcome.atoms.toString() : null);\n\t}\n\n\t// ----------------- private methods -----------------\n\n\t// workhorse for the constructor\n\tprivate setup():void\n\t{\n\t\tif (this.allowModify)\n\t\t{\n\t\t\tlet models = this.getModels();\n\t\t\tthis.setModels(models);\n\t\t}\n\t}\n\n\t// ------------------ aspect implementation --------------------\n\n\tpublic plainHeading():string {return BayesianSource.NAME;}\n}\n\nregisterAspect(BayesianPrediction);\n\n","/*\n    WebMolKit\n\n    (c) 2010-2020 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n    [PKG=webmolkit]\n*/\n\nimport {DataSheet, DataSheetColumn} from '../data/DataSheet';\nimport {MoleculeStream} from '../data/MoleculeStream';\nimport {Vec} from '../util/Vec';\nimport {Aspect, AspectTextRendering} from './Aspect';\nimport {registerAspect} from './AspectList';\n\n/*\n\tMeasurement: provides some number of measurement fields, which augment an ordinary numeric field to add units,\n    modifier, error and overall metadata. This aspect is useful for collecting multiple columns of measurements such as\n    physical properties or assay readouts.\n*/\n\nexport interface MeasurementDataUnit\n{\n\tname:string;\n\turi:string;\n}\n\nexport interface MeasurementDataField\n{\n\tname:string;\n\tunits:string[];\n\tdefnURI:string[];\n}\n\nexport interface MeasurementDataHeader\n{\n\tunits:MeasurementDataUnit[];\n\tfields:MeasurementDataField[];\n}\n\nexport interface MeasurementDataValue\n{\n\tvalue:number;\n\terror:number;\n\tunits:string;\n\tmod:string;\n}\n\nexport class MeasurementData extends Aspect\n{\n\tpublic static CODE = 'org.mmi.aspect.MeasurementData';\n\tpublic static NAME = 'Measurement Data';\n\n\tpublic static SUFFIX_VALUE = '';\n\tpublic static SUFFIX_ERROR = '_error';\n\tpublic static SUFFIX_UNITS = '_units';\n\tpublic static SUFFIX_MOD = '_mod';\n\n\tprivate header:MeasurementDataHeader = {units: [], fields: []};\n\n\t// ----------------- public methods -----------------\n\n\t// used to test if a datasheet has the appropriate metadata\n\tpublic static isMeasurementData(ds:DataSheet):boolean\n\t{\n\t\tfor (let n = 0; n < ds.numExtensions; n++) if (ds.getExtType(n) == MeasurementData.CODE) return true;\n\t\treturn false;\n\t}\n\n\tconstructor(ds?:DataSheet, allowModify?:boolean)\n\t{\n\t\tsuper(MeasurementData.CODE, ds, allowModify);\n\t\tthis.setup();\n\t}\n\n\t// data access\n\tpublic getHeader():MeasurementDataHeader\n\t{\n\t\treturn this.header;\n\t}\n\tpublic setHeader(header:MeasurementDataHeader):void\n\t{\n\t\tthis.header = header;\n\t\tlet content = this.formatMetaData(header);\n\t\tfor (let n = 0; n < this.ds.numExtensions; n++) if (this.ds.getExtType(n) == MeasurementData.CODE)\n\t\t{\n\t\t\tthis.ds.setExtData(n, content);\n\t\t\treturn;\n\t\t}\n\t\tthis.ds.appendExtension(MeasurementData.NAME, MeasurementData.CODE, content);\n\t}\n\n\t// applies the header, and also updates the columns if necessary\n\tpublic effectHeader(header:MeasurementDataHeader):void\n\t{\n\t\tthis.setHeader(header);\n\t\tthis.ensureFields();\n\t}\n\n\t// renames a field, updating both the header and the underlying columns\n\tpublic rename(fldidx:number, newName:string):void\n\t{\n\t\tlet oldName = this.header.fields[fldidx].name;\n\t\tif (oldName == newName) return;\n\n\t\tthis.header.fields[fldidx].name = newName;\n\t\tthis.setHeader(this.header);\n\n\t\tfor (let sfx of [MeasurementData.SUFFIX_VALUE, MeasurementData.SUFFIX_ERROR, MeasurementData.SUFFIX_UNITS, MeasurementData.SUFFIX_MOD])\n\t\t{\n\t\t\tlet col = this.ds.findColByName(oldName + sfx);\n\t\t\tif (col >= 0) this.ds.changeColumnName(col, newName + sfx, this.ds.colDescr(col));\n\t\t}\n\t}\n\n\t// return the list of columns that's reserved for just the indicated field\n\tpublic reservedColumns(fldidx:number):string[]\n\t{\n\t\tlet fieldName = this.header.fields[fldidx].name;\n\t\treturn [fieldName + MeasurementData.SUFFIX_VALUE, fieldName + MeasurementData.SUFFIX_ERROR,\n\t\t\t\tfieldName + MeasurementData.SUFFIX_UNITS, fieldName + MeasurementData.SUFFIX_MOD];\n\t}\n\n\t// getting and setting values\n\tpublic getValue(row:number, fldidx:number):MeasurementDataValue\n\t{\n\t\treturn this.getValueField(row, this.header.fields[fldidx]);\n\t}\n\tpublic getValueField(row:number, field:MeasurementDataField):MeasurementDataValue\n\t{\n\t\tlet value:MeasurementDataValue = {value: Number.NaN, error: Number.NaN, units: '', mod: ''};\n\n\t\tlet colValue = this.ds.findColByName(field.name + MeasurementData.SUFFIX_VALUE, DataSheetColumn.Real);\n\t\tlet colError = this.ds.findColByName(field.name + MeasurementData.SUFFIX_ERROR, DataSheetColumn.Real);\n\t\tlet colUnits = this.ds.findColByName(field.name + MeasurementData.SUFFIX_UNITS, DataSheetColumn.String);\n\t\tlet colMod = this.ds.findColByName(field.name + MeasurementData.SUFFIX_MOD, DataSheetColumn.String);\n\n\t\tif (colValue >= 0 && this.ds.notNull(row, colValue)) value.value = this.ds.getReal(row, colValue);\n\t\tif (colError >= 0 && this.ds.notNull(row, colError)) value.error = this.ds.getReal(row, colError);\n\t\tif (colUnits >= 0) value.units = this.ds.getString(row, colUnits);\n\t\tif (colMod >= 0) value.mod = this.ds.getString(row, colMod);\n\n\t\treturn value;\n\t}\n\n\tpublic setValue(row:number, fldidx:number, value:MeasurementDataValue):void\n\t{\n\t\tlet fieldName = this.header.fields[fldidx].name;\n\t\tlet colValue = this.ds.findColByName(fieldName + MeasurementData.SUFFIX_VALUE, DataSheetColumn.Real);\n\t\tlet colError = this.ds.findColByName(fieldName + MeasurementData.SUFFIX_ERROR, DataSheetColumn.Real);\n\t\tlet colUnits = this.ds.findColByName(fieldName + MeasurementData.SUFFIX_UNITS, DataSheetColumn.String);\n\t\tlet colMod = this.ds.findColByName(fieldName + MeasurementData.SUFFIX_MOD, DataSheetColumn.String);\n\n\t\tif (colValue >= 0) if (isNaN(value.value)) this.ds.setToNull(row, colValue); else this.ds.setReal(row, colValue, value.value);\n\t\tif (colError >= 0) if (isNaN(value.error)) this.ds.setToNull(row, colError); else this.ds.setReal(row, colError, value.error);\n\t\tif (colUnits >= 0) this.ds.setString(row, colUnits, value.units);\n\t\tif (colMod >= 0) this.ds.setString(row, colMod, value.mod);\n\t}\n\n\tpublic clearValue(row:number, fldidx:number):void\n\t{\n\t\tlet fieldName = this.header.fields[fldidx].name;\n\t\tlet colValue = this.ds.findColByName(fieldName + MeasurementData.SUFFIX_VALUE, DataSheetColumn.Real);\n\t\tlet colError = this.ds.findColByName(fieldName + MeasurementData.SUFFIX_ERROR, DataSheetColumn.Real);\n\t\tlet colUnits = this.ds.findColByName(fieldName + MeasurementData.SUFFIX_UNITS, DataSheetColumn.String);\n\t\tlet colMod = this.ds.findColByName(fieldName + MeasurementData.SUFFIX_MOD, DataSheetColumn.String);\n\n\t\tif (colValue >= 0) this.ds.setToNull(row, colValue);\n\t\tif (colError >= 0) this.ds.setToNull(row, colError);\n\t\tif (colUnits >= 0) this.ds.setToNull(row, colUnits);\n\t\tif (colMod >= 0) this.ds.setToNull(row, colMod);\n\t}\n\n\t// getting/setting description\n\tpublic getDescr(row:number, fldidx:number):string\n\t{\n\t\tlet col = this.ds.findColByName(this.header.fields[fldidx].name);\n\t\treturn col < 0 ? '' : this.ds.colDescr(col);\n\t}\n\tpublic setDescr(row:number, fldidx:number, descr:string):void\n\t{\n\t\tlet col = this.ds.findColByName(this.header.fields[fldidx].name);\n\t\tif (col >= 0) this.ds.changeColumnName(col, this.ds.colName(col), descr);\n\t}\n\n\t// ----------------- private methods -----------------\n\n\t// workhorse for the constructor\n\tprivate setup():void\n\t{\n\t\tthis.parseAndCorrect();\n\t}\n\n\t// assuming that the underlying datasheet definitely is a datasheet, makes any necessary corrections to force it into compliance\n\tprivate parseAndCorrect():void\n\t{\n\t\tthis.header = {units: [], fields: []};\n\n\t\tlet got = false;\n\t\tfor (let n = 0; n < this.ds.numExtensions; n++) if (this.ds.getExtType(n) == MeasurementData.CODE)\n\t\t{\n\t\t\tthis.header = this.parseMetaData(this.ds.getExtData(n));\n\t\t\tgot = true;\n\t\t\tbreak;\n\t\t}\n\n\t\tthis.ensureFields();\n\n\t\tif (!got && this.allowModify)\n\t\t{\n\t\t\tlet content = this.formatMetaData(this.header);\n\t\t\tthis.ds.appendExtension(MeasurementData.NAME, MeasurementData.CODE, content);\n\t\t}\n\t}\n\n\t// makes sure the fields mentioned in the header are available\n\tprivate ensureFields():void\n\t{\n\t\tfor (let f of this.header.fields)\n\t\t{\n\t\t\tlet descr = 'Measurement';\n\t\t\tlet colidx = this.ds.findColByName(f.name);\n\t\t\tif (colidx >= 0) descr = this.ds.colDescr(colidx);\n\n\t\t\tif (this.allowModify)\n\t\t\t{\n\t\t\t\tthis.ds.ensureColumn(f.name + MeasurementData.SUFFIX_VALUE, DataSheetColumn.Real, descr);\n\t\t\t\tthis.ds.ensureColumn(f.name + MeasurementData.SUFFIX_ERROR, DataSheetColumn.Real, 'Error');\n\t\t\t\tthis.ds.ensureColumn(f.name + MeasurementData.SUFFIX_UNITS, DataSheetColumn.String, 'Units');\n\t\t\t\tthis.ds.ensureColumn(f.name + MeasurementData.SUFFIX_MOD, DataSheetColumn.String, 'Modifier');\n\t\t\t}\n\t\t}\n\t}\n\n\t// interprets the string metadata from the extensions\n\tprivate parseMetaData(content:string):MeasurementDataHeader\n\t{\n\t\tlet header:MeasurementDataHeader = {units: [], fields: []};\n\n\t\tfor (let line of content.split(/\\r?\\n/))\n\t\t{\n\t\t\tlet eq = line.indexOf('=');\n\t\t\tif (eq < 0) continue;\n\t\t\tif (line.startsWith('unit='))\n\t\t\t{\n\t\t\t\tlet bits = line.substring(eq + 1).split(',');\n\t\t\t\tif (bits.length >= 2) header.units.push({name: MoleculeStream.skUnescape(bits[0]), uri: MoleculeStream.skUnescape(bits[1])});\n\t\t\t}\n\t\t\telse if (line.startsWith('field='))\n\t\t\t{\n\t\t\t\tlet bits = line.substring(eq + 1).split(',');\n\t\t\t\tlet f:MeasurementDataField = {name: MoleculeStream.skUnescape(bits[0]), units: [], defnURI: []};\n\t\t\t\tfor (let n = 1; n < bits.length; n++) f.units.push(MoleculeStream.skUnescape(bits[n]));\n\t\t\t\theader.fields.push(f);\n\t\t\t}\n\t\t\telse if (line.startsWith('definition='))\n\t\t\t{\n\t\t\t\tlet bits = line.substring(eq + 1).split(',');\n\t\t\t\tif (bits.length >= 2)\n\t\t\t\t{\n\t\t\t\t\tlet f = header.fields.find((f) => f.name == bits[0]);\n\t\t\t\t\tif (!f) continue;\n\t\t\t\t\tfor (let n = 1; n < bits.length; n++) f.defnURI.push(MoleculeStream.skUnescape(bits[n]));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn header;\n\t}\n\n\t// deserialises the header metadata\n\tprivate formatMetaData(header:MeasurementDataHeader):string\n\t{\n\t\tlet lines:string[] = [];\n\n\t\tfor (let u of header.units)\n\t\t{\n\t\t\tlines.push('unit=' + MoleculeStream.skEscape(u.name) + ',' + MoleculeStream.skEscape(u.uri));\n\t\t}\n\t\tfor (let f of header.fields)\n\t\t{\n\t\t\tlet line = 'field=' + MoleculeStream.skEscape(f.name);\n\t\t\tfor (let u of f.units) line += ',' + MoleculeStream.skEscape(u);\n\t\t\tlines.push(line);\n\n\t\t\tif (Vec.notBlank(f.defnURI))\n\t\t\t{\n\t\t\t\tline = 'definition=' + MoleculeStream.skEscape(f.name);\n\t\t\t\tfor (let d of f.defnURI) line += ',' + MoleculeStream.skEscape(d);\n\t\t\t\tlines.push(line);\n\t\t\t}\n\t\t}\n\n\t\treturn lines.join('\\n');\n\t}\n\n\t// ------------------ aspect implementation --------------------\n\n\tpublic plainHeading():string {return MeasurementData.NAME;}\n\n\tpublic isColumnReserved(colName:string):boolean\n\t{\n\t\treturn this.areColumnsReserved([colName])[0];\n\t}\n\tpublic areColumnsReserved(colNames:string[]):boolean[]\n\t{\n\t\tlet names = new Set<string>();\n\t\tfor (let f of this.header.fields)\n\t\t{\n\t\t\tnames.add(f.name + MeasurementData.SUFFIX_VALUE);\n\t\t\tnames.add(f.name + MeasurementData.SUFFIX_ERROR);\n\t\t\tnames.add(f.name + MeasurementData.SUFFIX_UNITS);\n\t\t\tnames.add(f.name + MeasurementData.SUFFIX_MOD);\n\t\t}\n\t\tlet resv:boolean[] = [];\n\t\tfor (let col of colNames) resv.push(names.has(col));\n\t\treturn resv;\n\t}\n\n\tpublic numTextRenderings(row:number):number {return this.header.fields.length;}\n\tpublic produceTextRendering(row:number, idx:number):AspectTextRendering\n\t{\n\t\tlet field = this.header.fields[idx];\n\t\tlet colField = this.ds.findColByName(field.name);\n\n\t\tlet tr:AspectTextRendering =\n\t\t{\n\t\t\tname: field.name,\n\t\t\tdescr: colField < 0 ? '' : this.ds.colDescr(colField),\n\t\t\ttext: '',\n\t\t\ttype: Aspect.TEXT_PLAIN\n\t\t};\n\n\t\tlet datum = this.getValue(row, idx);\n\t\tif (!Number.isNaN(datum.value))\n\t\t{\n\t\t\tif (datum.mod) tr.text += datum.mod + ' ';\n\t\t\ttr.text += datum.value;\n\t\t\tif (!Number.isNaN(datum.error)) tr.text += ' \\u{00B1} ' + datum.error;\n\t\t\tif (datum.units) tr.text += ' ' + datum.units;\n\t\t}\n\t\treturn tr;\n\t}\n}\n\nregisterAspect(MeasurementData);\n\n","/*\n    WebMolKit\n\n    (c) 2010-2020 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n    [PKG=webmolkit]\n*/\n\nimport {DataSheet, DataSheetColumn} from '../data/DataSheet';\nimport {MoleculeStream} from '../data/MoleculeStream';\nimport {deepClone} from '../util/util';\nimport {Aspect} from './Aspect';\nimport {registerAspect} from './AspectList';\nimport {MeasurementData} from './MeasurementData';\n\n/*\n\tBinaryData: describes how continuous numeric data can be transformed into a true/false value, which is often an effective way\n\tto describe data where the criteria & binary data are known, but the precursor data may or may not.\n*/\n\nexport class BinaryDataField\n{\n\tpublic colNameSource:string; // the input feed (should be numeric)\n\tpublic colNameDest:string; // output column: enforced to be boolean\n\tpublic thresholdValue:number; // threshold for turning free numbers into booleans\n\tpublic thresholdRelation:string; // one of \"<\", \">\", \"<=\", \">=\"\n}\n\nexport class BinaryData extends Aspect\n{\n\tpublic static CODE = 'org.mmi.aspect.BinaryData';\n\tpublic static NAME = 'Binary Data';\n\n\tprivate fields:BinaryDataField[] = [];\n\n\t// ----------------- public methods -----------------\n\n\t// used to test if a datasheet has the appropriate metadata flagging it as a feedstock-containing datasheet\n\tpublic static isBinaryData(ds:DataSheet):boolean\n\t{\n\t\tfor (let n = 0; n < ds.numExtensions; n++) if (ds.getExtType(n) == BinaryData.CODE) return true;\n\t\treturn false;\n\t}\n\n\tconstructor(ds?:DataSheet, allowModify?:boolean)\n\t{\n\t\tsuper(BinaryData.CODE, ds, allowModify);\n\t\tthis.setup();\n\t}\n\n\t// data access\n\tpublic getFields():BinaryDataField[]\n\t{\n\t\treturn deepClone(this.fields);\n\t}\n\tpublic setFields(fields:BinaryDataField[])\n\t{\n\t\tthis.fields = deepClone(fields);\n\t\tlet content = this.formatMetaData(fields);\n\t\tfor (let n = 0; n < this.ds.numExtensions; n++) if (this.ds.getExtType(n) == MeasurementData.CODE)\n\t\t{\n\t\t\tthis.ds.setExtData(n, content);\n\t\t\treturn;\n\t\t}\n\t\tthis.ds.appendExtension(MeasurementData.NAME, MeasurementData.CODE, content);\n\t}\n\n\t// obtain the value, where destination takes precedence\n\tpublic getValue(row:number, field:BinaryDataField):boolean\n\t{\n\t\tlet value = this.getDestValue(row, field);\n\t\tif (value != null) return value;\n\t\treturn this.getSourceValue(row, field);\n\t}\n\tpublic getSourceValue(row:number, field:BinaryDataField):boolean\n\t{\n\t\tlet col = this.ds.findColByName(field.colNameSource);\n\t\tif (col < 0 || this.ds.isNull(row, col)) return null;\n\n\t\tlet ct = this.ds.colType(col);\n\t\tlet value = 0;\n\t\tif (ct == DataSheetColumn.Boolean) return this.ds.getBoolean(row, col);\n\t\telse if (ct == DataSheetColumn.Integer) value = this.ds.getInteger(row, col);\n\t\telse if (ct == DataSheetColumn.Real) value = this.ds.getReal(row, col);\n\t\telse return null;\n\n\t\tif (field.thresholdRelation == '>') return value > field.thresholdValue;\n\t\tif (field.thresholdRelation == '<') return value < field.thresholdValue;\n\t\tif (field.thresholdRelation == '>=') return value >= field.thresholdValue;\n\t\tif (field.thresholdRelation == '<=') return value <= field.thresholdValue;\n\t\treturn null;\n\t}\n\tpublic getDestValue(row:number, field:BinaryDataField):boolean\n\t{\n\t\treturn this.ds.getBoolean(row, field.colNameDest);\n\t}\n\n\t// ----------------- private methods -----------------\n\n\t// workhorse for the constructor\n\tprivate setup():void\n\t{\n\t\tthis.parseAndCorrect();\n\t}\n\n\t// assuming that the underlying datasheet definitely is a datasheet, makes any necessary corrections to force it into compliance\n\tprivate parseAndCorrect():void\n\t{\n\t\tlet got = false;\n\t\tfor (let n = 0; n < this.ds.numExtensions; n++) if (this.ds.getExtType(n) == MeasurementData.CODE)\n\t\t{\n\t\t\tthis.fields = this.parseMetaData(this.ds.getExtData(n));\n\t\t\tgot = true;\n\t\t\tbreak;\n\t\t}\n\n\t\tif (!got && this.allowModify)\n\t\t{\n\t\t\tlet content = this.formatMetaData(this.fields);\n\t\t\tthis.ds.appendExtension(MeasurementData.NAME, MeasurementData.CODE, content);\n\t\t}\n\t}\n\n\t// interprets the string metadata from the extensions\n\tprivate parseMetaData(content:string):BinaryDataField[]\n\t{\n\t\tlet fields:BinaryDataField[] = [];\n\t\tlet f:BinaryDataField = null;\n\n\t\tfor (let line of content.split(/\\r?\\n/))\n\t\t{\n\t\t\tif (line == 'field:')\n\t\t\t{\n\t\t\t\tif (f != null) fields.push(f as BinaryDataField);\n\t\t\t\tf = {colNameSource: '', colNameDest: '', thresholdValue: 0.5, thresholdRelation: '>='};\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (f == null) continue;\n\t\t\tlet eq = line.indexOf('=');\n\t\t\tif (eq < 0) continue;\n\n\t\t\tif (line.startsWith('colNameSource=')) f.colNameSource = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('colNameDest=')) f.colNameDest = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('thresholdValue=')) f.thresholdValue = parseFloat(line.substring(eq + 1));\n\t\t\telse if (line.startsWith('thresholdRelation=')) f.thresholdRelation = MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t}\n\n\t\tif (f != null) fields.push(f);\n\n\t\treturn fields;\n\t}\n\n\t// deserialises the header metadata\n\tprivate formatMetaData(fields:BinaryDataField[]):string\n\t{\n\t\tlet lines:string[] = [];\n\n\t\tfor (let f of fields)\n\t\t{\n\t\t\tlines.push('field:');\n\t\t\tlines.push('colNameSource=' + MoleculeStream.skEscape(f.colNameSource));\n\t\t\tlines.push('colNameDest=' + MoleculeStream.skEscape(f.colNameDest));\n\t\t\tlines.push('thresholdValue=' + f.thresholdValue);\n\t\t\tlines.push('thresholdRelation=' + MoleculeStream.skEscape(f.thresholdRelation));\n\t\t}\n\n\t\treturn lines.join('\\n');\n\t}\n\n\t// ------------------ aspect implementation --------------------\n\n\tpublic plainHeading():string {return BinaryData.NAME;}\n\n\tpublic isColumnReserved(colName:string):boolean\t{return false;}\n}\n\nregisterAspect(BinaryData);\n\n","/*\n    WebMolKit\n\n    (c) 2010-2021 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {MoleculeStream} from './MoleculeStream';\n\n/*\n\tExperiment reaction metadata: utilities and definitions.\n*/\n\nexport enum ExperimentMetaType\n{\n\tRole = 'role', // to assign an explicit role to a reagent (see ComponentClassType; default is auto)\n\tPressure = 'pressure', // when a reagent is applied at a nonstandard pressure\n\tTurnoverNumber = 'turnover_number', // catalyst turnovers (unitless)\n\tEnantiomericExcess = 'enantiomeric_excess', // percent of desired enantiomer above undesired\n\tTime = 'time', // total time for reaction step\n\tHeat = 'heat', // maximum temperature of reaction step\n\tLight = 'light', // denotes reaction powered by EM radiation\n}\n\nexport enum ExperimentMetaApplic\n{\n\tExperiment,\n\tStep,\n\tReactant,\n\tReagent,\n\tProduct,\n}\n\nexport enum ExperimentMetaValue\n{\n\tBoolean, // present = true, absent = false\n\tNumber, // requires a numeric value\n\tOptional, // numeric value is optiona; mere presence can be used as a flag\n\tString, // requires a string value\n}\n\nexport enum ExperimentMetaRoleType\n{\n\tReagent = 'reagent',\n\tCatalyst = 'catalyst',\n\tSolvent = 'solvent',\n\tAdjunct = 'adjunct',\n}\n\nexport class ExperimentMeta\n{\n\tpublic static APPLICABILITY =\n\t{\n\t\t[ExperimentMetaType.Role]: [ExperimentMetaApplic.Reagent],\n\t\t[ExperimentMetaType.Pressure]: [ExperimentMetaApplic.Reactant, ExperimentMetaApplic.Reagent],\n\t\t[ExperimentMetaType.TurnoverNumber]: [ExperimentMetaApplic.Reagent],\n\t\t[ExperimentMetaType.EnantiomericExcess]: [ExperimentMetaApplic.Product],\n\t\t[ExperimentMetaType.Time]: [ExperimentMetaApplic.Step],\n\t\t[ExperimentMetaType.Heat]: [ExperimentMetaApplic.Step],\n\t\t[ExperimentMetaType.Light]: [ExperimentMetaApplic.Step],\n\t};\n\n\tpublic static NAMES =\n\t{\n\t\t[ExperimentMetaType.Role]: 'Role',\n\t\t[ExperimentMetaType.Pressure]: 'Pressure',\n\t\t[ExperimentMetaType.TurnoverNumber]: 'Turnover Number',\n\t\t[ExperimentMetaType.EnantiomericExcess]: 'Enantiomeric Excess',\n\t\t[ExperimentMetaType.Time]: 'Time',\n\t\t[ExperimentMetaType.Heat]: 'Heat',\n\t\t[ExperimentMetaType.Light]: 'Light',\n\t};\n\n\tpublic static UNITS =\n\t{\n\t\t[ExperimentMetaType.Pressure]: 'atm',\n\t\t[ExperimentMetaType.TurnoverNumber]: null as string,\n\t\t[ExperimentMetaType.EnantiomericExcess]: '%',\n\t\t[ExperimentMetaType.Time]: 'hr',\n\t\t[ExperimentMetaType.Heat]: '\\u{00B0}C',\n\t\t[ExperimentMetaType.Light]: 'nm',\n\t};\n\n\tpublic static VALUES =\n\t{\n\t\t[ExperimentMetaType.Role]: ExperimentMetaValue.String,\n\t\t[ExperimentMetaType.Pressure]: ExperimentMetaValue.Number,\n\t\t[ExperimentMetaType.TurnoverNumber]: ExperimentMetaValue.Number,\n\t\t[ExperimentMetaType.EnantiomericExcess]: ExperimentMetaValue.Number,\n\t\t[ExperimentMetaType.Time]: ExperimentMetaValue.Number,\n\t\t[ExperimentMetaType.Heat]: ExperimentMetaValue.Optional,\n\t\t[ExperimentMetaType.Light]: ExperimentMetaValue.Optional,\n\t};\n\n\t// given a string that contains some number of lines, returns a convenient array representation\n\tpublic static unpackMeta(str:string):[ExperimentMetaType, number | string][]\n\t{\n\t\tif (!str) return [];\n\t\tlet list:[ExperimentMetaType, number | string][] = [];\n\t\tfor (let line of str.split('\\n')) if (line)\n\t\t{\n\t\t\tlet eq = line.indexOf('=');\n\t\t\tlet type = MoleculeStream.skUnescape(eq < 0 ? line : line.substring(0, eq)) as ExperimentMetaType;\n\t\t\tlet value:number | string = eq < 0 ? null : MoleculeStream.skUnescape(line.substring(eq + 1));\n\t\t\tlet vtype = this.VALUES[type];\n\t\t\tif (value != null && (vtype == ExperimentMetaValue.Number || vtype == ExperimentMetaValue.Optional)) value = parseFloat(value);\n\t\t\tlist.push([type, value]);\n\t\t}\n\t\tlist.sort((l1, l2) => (l1[0] as string).localeCompare(l2[0] as string));\n\t\treturn list;\n\t}\n\n\t// convert a list of type/value codes into packed string representation\n\tpublic static packMeta(list:[ExperimentMetaType, number | string][]):string\n\t{\n\t\tlet lines:string[] = [];\n\t\tfor (let [type, value] of list)\n\t\t{\n\t\t\tif (value == null)\n\t\t\t\tlines.push(MoleculeStream.skEscape(type));\n\t\t\telse\n\t\t\t\tlines.push(MoleculeStream.skEscape(type) + '=' + MoleculeStream.skEscape(value.toString()));\n\t\t}\n\t\treturn lines.join('\\n');\n\t}\n\n\t// unpacks, sets & packs, all in one go\n\tpublic static withMetaKey(metastr:string, type:ExperimentMetaType, value:string):string\n\t{\n\t\tlet list = this.unpackMeta(metastr);\n\t\tlet item = list.find((look) => look[0] == type);\n\t\tif (value != null)\n\t\t{\n\t\t\tif (item) item[1] = value; else list.push([type, value]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlist = list.filter((look) => look[0] != type);\n\t\t}\n\t\treturn this.packMeta(list);\n\t}\n\n\t// return a short description of the instantiated value for display onscreen\n\tpublic static describeMeta(type:ExperimentMetaType, value:number | string):string\n\t{\n\t\tlet formatFloat = (val:number, maxSigFig:number):string =>\n\t\t{\n\t\t\tif (val == null) return '';\n\t\t\tif (val == 0) return '0';\n\t\t\tlet digits = Math.ceil(-Math.log10(Math.abs(val)));\n\t\t\tdigits = Math.max(0, Math.max(digits, maxSigFig));\n\t\t\tlet str = val.toFixed(digits);\n\t\t\tif (str.indexOf('.') < 0) return str;\n\t\t\twhile (str.endsWith('0')) str = str.substring(0, str.length - 1);\n\t\t\tif (str.endsWith('.')) str = str.substring(0, str.length - 1);\n\t\t\treturn str;\n\t\t};\n\n\t\tif (type == ExperimentMetaType.Role)\n\t\t{\n\t\t\tif (!value) return null;\n\t\t\treturn `role: ${value}`;\n\t\t}\n\t\telse if (type == ExperimentMetaType.Pressure)\n\t\t{\n\t\t\tif (value == null) return null;\n\t\t\treturn `${formatFloat(value as number, 2)} atm`;\n\t\t}\n\t\telse if (type == ExperimentMetaType.TurnoverNumber)\n\t\t{\n\t\t\tif (value == null) return null;\n\t\t\treturn `${formatFloat(value as number, 2)} turnover${value == 1 ? '' : 's'}`;\n\t\t}\n\t\telse if (type == ExperimentMetaType.EnantiomericExcess)\n\t\t{\n\t\t\tif (value == null) return null;\n\t\t\treturn `${formatFloat(value as number, 2)}% ee`;\n\t\t}\n\t\telse if (type == ExperimentMetaType.Time)\n\t\t{\n\t\t\tif (value == null) return null;\n\t\t\tif (value as number < 1)\n\t\t\t{\n\t\t\t\tlet mins = value as number * 60;\n\t\t\t\treturn `${formatFloat(mins, 2)} min${mins == 1 ? '' : 's'}`;\n\t\t\t}\n\t\t\telse return `${formatFloat(value as number, 2)} hour${value == 1 ? '' : 's'}`;\n\t\t}\n\t\telse if (type == ExperimentMetaType.Heat)\n\t\t{\n\t\t\tif (value == null) return '\\u{0394}';\n\t\t\treturn `${formatFloat(value as number, 2)} \\u{00B0}C`;\n\t\t}\n\t\telse if (type == ExperimentMetaType.Light)\n\t\t{\n\t\t\tif (value == null) return 'h\\u{03BD}';\n\t\t\treturn `${formatFloat(value as number, 2)} nm`;\n\t\t}\n\t\treturn null;\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {ExperimentComponent, ExperimentComponentType, ExperimentEntry} from '../aspect/Experiment';\nimport {formatDouble} from '../util/util';\nimport {Vec} from '../util/Vec';\nimport {MolUtil} from './MolUtil';\n\n/*\n\tQuantity interconversions: for an Experiment entry, figure out all of the real-and-converted quantities, and\n\tmark them as such for convenient recall.\n*/\n\nexport const enum QuantityCalcRole\n{\n\tPrimary = 1, // a reactant upon which ratios depend\n\tSecondary, // a stoichiometric reactant, intermediate or waste product\n\tProduct, // a final product for which yield should be calculated\n\tIndependent, // a nonstoichiometric reagent or waste product\n}\n\nexport const enum QuantityCalcStat\n{\n\tUnknown = 0, // no data, i.e. not provided and cannot be calculated\n\tActual, // user-provided data\n\tVirtual, // calculated data\n\tConflict, // user-provided data that clashes\n}\n\nexport class QuantityCalcComp\n{\n\tpublic role = 0;\n\tpublic molw = 0;\n\tpublic valueEquiv = 0;\n\tpublic statEquiv = QuantityCalcStat.Unknown;\n\tpublic valueMass = QuantityCalc.UNSPECIFIED;\n\tpublic statMass = QuantityCalcStat.Unknown;\n\tpublic valueVolume = QuantityCalc.UNSPECIFIED;\n\tpublic statVolume = QuantityCalcStat.Unknown;\n\tpublic valueMoles = QuantityCalc.UNSPECIFIED;\n\tpublic statMoles = QuantityCalcStat.Unknown;\n\tpublic valueDensity = QuantityCalc.UNSPECIFIED;\n\tpublic statDensity = QuantityCalcStat.Unknown;\n\tpublic valueConc = QuantityCalc.UNSPECIFIED;\n\tpublic statConc = QuantityCalcStat.Unknown;\n\tpublic valueYield = QuantityCalc.UNSPECIFIED;\n\tpublic statYield = QuantityCalcStat.Unknown;\n\n\tconstructor(public comp:ExperimentComponent, public step:number, public type:ExperimentComponentType, public idx:number)\n\t{\n\t}\n}\n\nexport class GreenMetrics\n{\n\tpublic step = 0; // reaction step\n\tpublic idx = 0; // index into the overall quantity list\n\tpublic massReact:number[] = [];\n\tpublic massProd:number[] = [];\n\tpublic massWaste:number[] = [];\n\tpublic massProdWaste:number[] = [];\n\tpublic molwReact:number[] = [];\n\tpublic molwProd:number[] = [];\n\tpublic impliedWaste = 0;\n\tpublic isBlank = false; // set to true if there's no content (blank entries can still be useful as placeholders)\n}\n\nexport class QuantityCalc\n{\n\tpublic static UNSPECIFIED = -1;\n\n\tpublic quantities:QuantityCalcComp[] = [];\n\n\tpublic primaryMoles:number[] = [];\n\tpublic idxPrimary:number[] = [];\n\tpublic idxYield:number[] = [];\n\tpublic allMassReact:number[] = [];\n\tpublic allMassProd:number[] = [];\n\tpublic allMassWaste:number[] = [];\n\n\tpublic greenMetrics:GreenMetrics[] = [];\n\n\t// ---------------- static methods -----------------\n\n\t// returns true if the stoichiometry string is equivalent to zero, i.e. non-stoichiometric\n\tpublic static isStoichZero(stoich:string):boolean\n\t{\n\t\tif (this.isStoichUnity(stoich)) return false;\n\t\tif (parseFloat(stoich) == 0) return true;\n\t\treturn false;\n\t}\n\t// returns true if the stoichiometry string is equivalent to one, which is the default state\n\tpublic static isStoichUnity(stoich:string):boolean\n\t{\n\t\tif (!stoich || stoich == '1') return true;\n\t\tlet [numer, denom] = this.extractStoichFraction(stoich);\n\t\treturn numer != 0 && numer == denom;\n\t}\n\t// extracts the numerator and denominator from the stoichiometry and expresses them as numerator/denominator; makes\n\t// up suitable values if it is not expressed as a fraction\n\tpublic static extractStoichFraction(stoich:string):[number, number]\n\t{\n\t\tif (!stoich) return [1, 1];\n\n\t\tlet numer = 1, denom = 1;\n\n\t\tlet i = stoich.indexOf('/');\n\t\tif (i < 0)\n\t\t{\n\t\t\tlet v = parseFloat(stoich);\n\t\t\tif (v >= 0) numer = v;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet v1 = parseFloat(stoich.substring(0, i)), v2 = parseFloat(stoich.substring(i + 1));\n\t\t\tif (v1 >= 0) numer = v1;\n\t\t\tif (v2 >= 0) denom = v2;\n\t\t}\n\t\treturn [numer, denom];\n\t}\n\n\t// as above, but just returns the number, as a decimal ratio\n\tpublic static extractStoichValue(stoich:string):number\n\t{\n\t\tlet [numer, denom] = this.extractStoichFraction(stoich);\n\t\treturn denom <= 1 ? numer : numer / denom;\n\t}\n\n\t// attempts to express the stoichiometry as a ratio; ideally this involves pulling out the numbers, but when they are provided\n\t// as a floating point number, has to have a go at finding the closest fraction; it will lock onto the closest match with a small-ish\n\t// denominator, so for obscure ratios, it may be an approximation\n\tprivate static MAX_DENOM = 16;\n\tprivate static RATIO_FRACT:number[] = null;\n\tpublic static stoichAsRatio(stoich:string):[number, number]\n\t{\n\t\tlet [numer, denom] = this.extractStoichFraction(stoich);\n\t\tif (numer == Math.floor(numer)) return [numer, denom];\n\t\treturn this.stoichFractAsRatio(numer);\n\t}\n\tpublic static stoichFractAsRatio(fract:number):[number, number]\n\t{\n\t\tif (fract == Math.floor(fract)) return [fract, 1];\n\n\t\tconst MAX_DENOM = QuantityCalc.MAX_DENOM;\n\t\tif (QuantityCalc.RATIO_FRACT == null)\n\t\t{\n\t\t\tQuantityCalc.RATIO_FRACT = [];\n\t\t\tfor (let p = 0, j = 2; j <= MAX_DENOM; j++) for (let i = 1; i < j && i < MAX_DENOM - 1; i++) QuantityCalc.RATIO_FRACT.push(i * 1.0 / j);\n\t\t}\n\n\t\tlet whole = Math.floor(fract);\n\t\tlet resid = fract - whole;\n\n\t\tlet bestDiff = Number.MAX_VALUE;\n\t\tlet bestOver = 1, bestUnder = 1;\n\t\tfor (let p = 0, j = 2; j <= MAX_DENOM; j++) for (let i = 1; i < j && i < MAX_DENOM - 1; i++)\n\t\t{\n\t\t\tlet diff = Math.abs(QuantityCalc.RATIO_FRACT[p++] - resid);\n\t\t\tif (diff < bestDiff) {bestDiff = diff; bestOver = i; bestUnder = j;}\n\t\t}\n\n\t\treturn [bestOver + (whole * bestUnder), bestUnder];\n\t}\n\n\t// if the given reagent has a molecule with mapping numbers, checks to see if they line up with product(s), and derives stoichiometry from\n\t// there; a value of 0 means that nothing could be determined\n\tpublic static impliedReagentStoich(reagent:ExperimentComponent, products:ExperimentComponent[]):number\n\t{\n\t\tif (MolUtil.isBlank(reagent.mol) || products.length == 0) return 0;\n\n\t\tlet pstoich = Vec.numberArray(-1, products.length);\n\t\tlet rmol = reagent.mol;\n\t\tlet highest = 0;\n\n\t\tfor (let n = 1; n <= rmol.numAtoms; n++)\n\t\t{\n\t\t\tlet m = rmol.atomMapNum(n);\n\t\t\tif (m == 0) continue;\n\t\t\tlet total = 0;\n\t\t\tfor (let i = 0; i < products.length; i++)\n\t\t\t{\n\t\t\t\tlet pmol = products[i].mol;\n\t\t\t\tif (MolUtil.isBlank(pmol)) continue;\n\n\t\t\t\tlet pcount = 0;\n\t\t\t\tfor (let j = 1; j <= pmol.numAtoms; j++) if (pmol.atomMapNum(j) == m) pcount++;\n\t\t\t\tif (pcount > 0)\n\t\t\t\t{\n\t\t\t\t\tlet rcount = 0;\n\t\t\t\t\tfor (let k = 1; k <= rmol.numAtoms; k++) if (rmol.atomMapNum(k) == m) rcount++;\n\t\t\t\t\tif (pstoich[i] < 0) pstoich[i] = QuantityCalc.extractStoichValue(products[i].stoich);\n\t\t\t\t\ttotal += pcount * pstoich[i] / rcount;\n\t\t\t\t}\n\t\t\t}\n\t\t\thighest = Math.max(highest, total);\n\t\t}\n\t\treturn highest;\n\t}\n\n\t/*\n\t// for a given step in a reaction, adds up all the structures on both the left and right hand sides; the structures on each side are combined\n\t// into a single molecule instance, and are expanded out based on the relative ratio of stoichiometry; zero stoichiometry is treated as 1\n\tpublic static Molecule[] combinedSides(Experiment.Entry entry, int step)\n\t{\n\t\tList<Molecule> left = new ArrayList<>(), right = new ArrayList<>();\n\t\tIntVector numer = new IntVector(), denom = new IntVector();\n\n\t\tComponent[] reactants = step == 0 ? entry.steps[0].reactants : entry.steps[step - 1].products;\n\t\tfor (Component comp : reactants) if (MolUtil.notBlank(comp.mol))\n\t\t{\n\t\t\tPairTwoInt ratio = stoichAsRatio(comp.stoich);\n\t\t\tleft.add(comp.mol);\n\t\t\tnumer.add(ratio.val1 == 0 ? 1 : ratio.val1);\n\t\t\tdenom.add(ratio.val2);\n\t\t}\n\t\tfor (Component comp : entry.steps[step].reagents) if (MolUtil.notBlank(comp.mol))\n\t\t{\n\t\t\tfloat fract = impliedReagentStoich(comp, entry.steps[step].products);\n\t\t\tPairTwoInt ratio = fract == 0 ? new PairTwoInt(1, 1) : stoichAsRatio(fract);\n\t\t\tleft.add(comp.mol);\n\t\t\tnumer.add(ratio.val1 == 0 ? 1 : ratio.val1);\n\t\t\tdenom.add(ratio.val2);\n\t\t}\n\n\t\tfor (Component comp : entry.steps[step].products) if (MolUtil.notBlank(comp.mol))\n\t\t{\n\t\t\tPairTwoInt ratio = stoichAsRatio(comp.stoich);\n\t\t\tright.add(comp.mol);\n\t\t\tnumer.add(ratio.val1 == 0 ? 1 : ratio.val1);\n\t\t\tdenom.add(ratio.val2);\n\t\t}\n\n\t\tint bigDenom = 1;\n\t\tfor (int n = 0; n < numer.size(); n++)\n\t\t{\n\t\t\tint d = denom.get(n);\n\t\t\tif (d == 1) continue;\n\t\t\tif (bigDenom % d != 0) bigDenom *= d;\n\t\t}\n\t\t// (any way to bring it back down?)\n\n\t\tMolecule mol1 = new Molecule(), mol2 = new Molecule();\n\t\tfor (int n = 0; n < left.size(); n++)\n\t\t{\n\t\t\tint num = numer.get(n) * bigDenom / denom.get(n);\n\t\t\tfor (int i = 0; i < num; i++) MolUtil.append(mol1, left.get(n));\n\t\t}\n\t\tfor (int n = 0; n < right.size(); n++)\n\t\t{\n\t\t\tint nn = left.size() + n, num = numer.get(nn) * bigDenom / denom.get(nn);\n\t\t\tfor (int i = 0; i < num; i++) MolUtil.append(mol2, right.get(n));\n\t\t}\n\n\t\treturn new Molecule[]{mol1, mol2};\n\t}*/\n\n\t// for a given step, works out the integral stoichiometry of {reactants, reagents, components}\n\tpublic static componentRatio(entry:ExperimentEntry, step:number):[number[], number[], number[]]\n\t{\n\t\tlet numer:number[] = [], denom:number[] = [];\n\n\t\tlet reactants = step == 0 ? entry.steps[0].reactants : entry.steps[step - 1].products;\n\t\tfor (let comp of reactants)\n\t\t{\n\t\t\tlet [num, den] = this.stoichAsRatio(comp.stoich);\n\t\t\tnumer.push(num);\n\t\t\tdenom.push(den);\n\t\t}\n\t\tfor (let comp of entry.steps[step].reagents)\n\t\t{\n\t\t\tlet fract = this.impliedReagentStoich(comp, entry.steps[step].products);\n\t\t\tlet [num, den] = fract == 0 ? [0, 1] : this.stoichFractAsRatio(fract);\n\t\t\tnumer.push(num == 0 ? 1 : num);\n\t\t\tdenom.push(den);\n\t\t}\n\t\tfor (let comp of entry.steps[step].products)\n\t\t{\n\t\t\tlet [num, den] = this.stoichAsRatio(comp.stoich);\n\t\t\tnumer.push(num == 0 ? 1 : num);\n\t\t\tdenom.push(den);\n\t\t}\n\n\t\tlet bigDenom = 1;\n\t\tfor (let n = 0; n < numer.length; n++) if (denom[n] > 1 && bigDenom % denom[n] != 0) bigDenom *= denom[n];\n\n\t\tlet ratioReactants:number[] = [], ratioReagents:number[] = [], ratioProducts:number[] = [];\n\t\tlet p = 0;\n\t\tfor (let n = 0; n < reactants.length; n++, p++) ratioReactants.push(numer[p] * bigDenom / denom[p]);\n\t\tfor (let n = 0; n < entry.steps[step].reagents.length; n++, p++) ratioReagents.push(numer[p] * bigDenom / denom[p]);\n\t\tfor (let n = 0; n < entry.steps[step].products.length; n++, p++) ratioProducts.push(numer[p] * bigDenom / denom[p]);\n\n\t\treturn [ratioReactants, ratioReagents, ratioProducts];\n\t}\n\n\t// ---------------- public methods -----------------\n\n\tconstructor(public entry:ExperimentEntry)\n\t{\n\t}\n\n\t// fill in all the details\n\tpublic calculate():void\n\t{\n\t\t// the basic quantities: iteratively ifer everything possible\n\t\tthis.classifyTypes();\n\t\twhile (this.calculateSomething()) {}\n\n\t\t// work out green metrics, where applicable\n\t\tthis.allMassReact = [];\n\t\tthis.allMassProd = [];\n\t\tthis.allMassWaste = [];\n\t\tfor (let n = 0; n < this.quantities.length; n++)\n\t\t{\n\t\t\tlet qc = this.quantities[n];\n\n\t\t\tif (qc.type == ExperimentComponentType.Reactant || qc.type == ExperimentComponentType.Reagent)\n\t\t\t{\n\t\t\t\tif (qc.valueEquiv == 0 && qc.type == ExperimentComponentType.Reagent) continue;\n\t\t\t\tthis.allMassReact.push(qc.valueMass);\n\t\t\t}\n\t\t\telse if (qc.type == ExperimentComponentType.Product)\n\t\t\t{\n\t\t\t\tif (!qc.comp.waste)\n\t\t\t\t{\n\t\t\t\t\tthis.allMassProd.push(qc.valueMass);\n\t\t\t\t\tthis.calculateGreenMetrics(n);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.allMassWaste.push(qc.valueMass);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// access to determined results\n\tpublic get numQuantities():number {return this.quantities.length;}\n\tpublic getQuantity(idx:number):QuantityCalcComp {return this.quantities[idx];}\n\tpublic getAllQuantities():QuantityCalcComp[] {return this.quantities.slice(0);}\n\tpublic get numGreenMetrics():number {return this.greenMetrics.length;}\n\tpublic getGreenMetrics(idx:number):GreenMetrics {return this.greenMetrics[idx];}\n\tpublic getAllGreenMetrics():GreenMetrics[] {return this.greenMetrics.slice(0);}\n\tpublic getAllMassReact():number[] {return this.allMassReact.slice(0);}\n\tpublic getAllMassProd():number[] {return this.allMassProd.slice(0);}\n\tpublic getAllMassWaste():number[] {return this.allMassWaste.slice(0);}\n\n\t// convenience: locate a component somewhere within the entry\n\tpublic findComponent(step:number, type:number, idx:number):QuantityCalcComp\n\t{\n\t\tfor (let qc of this.quantities) if (qc.step == step && qc.type == type && qc.idx == idx) return qc;\n\t\treturn null;\n\t}\n\n\t// convenience formatting tools, which pick appropriate units\n\tpublic static formatMolWeight(value:number):string\n\t{\n\t\tif (value == QuantityCalc.UNSPECIFIED) return '';\n\t\treturn formatDouble(value, 6) + ' g/mol';\n\t}\n\tpublic static formatMass(value:number):string\n\t{\n\t\tif (value == QuantityCalc.UNSPECIFIED) return '';\n\t\tif (value <= 1E-6) return formatDouble(value * 1E6, 6) + ' \\u03BCg';\n\t\tif (value <= 1E-3) return formatDouble(value * 1E3, 6) + ' mg';\n\t\tif (value >= 1E3) return formatDouble(value * 1E-3, 6) + ' kg';\n\t\treturn formatDouble(value, 6) + ' g';\n\t}\n\tpublic static formatVolume(value:number):string\n\t{\n\t\tif (value == QuantityCalc.UNSPECIFIED) return '';\n\t\tif (value <= 1E-6) return formatDouble(value * 1E6, 6) + ' nL';\n\t\tif (value <= 1E-3) return formatDouble(value * 1E3, 6) + ' \\u03BCL';\n\t\tif (value >= 1E3) return formatDouble(value * 1E-3, 6) + ' L';\n\t\treturn formatDouble(value, 6) + ' mL';\n\t}\n\tpublic static formatMoles(value:number):string\n\t{\n\t\tif (value == QuantityCalc.UNSPECIFIED) return '';\n\t\tif (value <= 1E-9) return formatDouble(value * 1E9, 6) + ' nmol';\n\t\tif (value <= 1E-6) return formatDouble(value * 1E6, 6) + ' \\u03BCmol';\n\t\tif (value <= 1E-3) return formatDouble(value * 1E3, 6) + ' mmol';\n\t\treturn formatDouble(value, 6) + ' mol';\n\t}\n\tpublic static formatDensity(value:number):string\n\t{\n\t\tif (value == QuantityCalc.UNSPECIFIED) return '';\n\t\treturn formatDouble(value, 6) + ' g/mL';\n\t}\n\tpublic static formatConc(value:number):string\n\t{\n\t\tif (value == QuantityCalc.UNSPECIFIED) return '';\n\t\tif (value <= 1E-9) return formatDouble(value * 1E9, 6) + ' nmol/L';\n\t\tif (value <= 1E-6) return formatDouble(value * 1E6, 6) + ' \\u03BCmol/L';\n\t\tif (value <= 1E-3) return formatDouble(value * 1E3, 6) + ' mmol/L';\n\t\treturn formatDouble(value, 6) + ' mol/L';\n\t}\n\tpublic static formatPercent(value:number):string\n\t{\n\t\tif (value == QuantityCalc.UNSPECIFIED) return '';\n\t\treturn formatDouble(value, 6) + '%';\n\t}\n\tpublic static formatEquiv(value:number):string\n\t{\n\t\tif (value == QuantityCalc.UNSPECIFIED) return '';\n\t\treturn formatDouble(value, 4) + ' equiv';\n\t}\n\n\t// ---------------- private methods -----------------\n\n\t// do a first pass of pulling out the raw data\n\tprivate classifyTypes():void\n\t{\n\t\tfor (let s = 0; s < this.entry.steps.length; s++)\n\t\t{\n\t\t\tlet step = this.entry.steps[s];\n\t\t\tfor (let n = 0; n < step.reactants.length; n++) this.quantities.push(new QuantityCalcComp(step.reactants[n], s, ExperimentComponentType.Reactant, n));\n\t\t\tfor (let n = 0; n < step.reagents.length; n++) this.quantities.push(new QuantityCalcComp(step.reagents[n], s, ExperimentComponentType.Reagent, n));\n\t\t\tfor (let n = 0; n < step.products.length; n++) this.quantities.push(new QuantityCalcComp(step.products[n], s, ExperimentComponentType.Product, n));\n\t\t}\n\n\t\t// classify each component into roles, and fill in some basic properties\n\t\tfor (let n = 0; n < this.quantities.length; n++)\n\t\t{\n\t\t\tlet qc = this.quantities[n];\n\n\t\t\tif (qc.type == ExperimentComponentType.Reagent)\n\t\t\t{\n\t\t\t\tif (qc.comp.equiv != null) qc.valueEquiv = qc.comp.equiv;\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tlet eq = QuantityCalc.impliedReagentStoich(qc.comp, this.entry.steps[qc.step].products);\n\t\t\t\t\tif (eq > 0) qc.valueEquiv = eq;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tqc.valueEquiv = QuantityCalc.extractStoichValue(qc.comp.stoich);\n\t\t\t}\n\n\t\t\tif (qc.comp.mol != null) qc.molw = MolUtil.molecularWeight(qc.comp.mol);\n\n\t\t\tqc.role = QuantityCalcRole.Independent;\n\t\t\tif (qc.step == 0 && qc.type == ExperimentComponentType.Reactant)\n\t\t\t{\n\t\t\t\tif (qc.comp.primary)\n\t\t\t\t{\n\t\t\t\t\tqc.role = QuantityCalcRole.Primary;\n\t\t\t\t\tthis.idxPrimary.push(n);\n\t\t\t\t}\n\t\t\t\telse qc.role = QuantityCalcRole.Secondary;\n\t\t\t}\n\t\t\telse if (qc.type == ExperimentComponentType.Reagent)\n\t\t\t{\n\t\t\t\tif (qc.valueEquiv > 0) qc.role = QuantityCalcRole.Secondary;\n\t\t\t}\n\t\t\telse if (qc.type == ExperimentComponentType.Product && !qc.comp.waste)\n\t\t\t{\n\t\t\t\tqc.role = QuantityCalcRole.Product;\n\t\t\t\tthis.idxYield.push(n);\n\t\t\t}\n\t\t\telse if (qc.valueEquiv > 0)\n\t\t\t{\n\t\t\t\tqc.role = QuantityCalcRole.Secondary;\n\t\t\t}\n\n\t\t\t// fill in any user-specified values\n\t\t\tif (qc.comp.mass != null) qc.valueMass = qc.comp.mass;\n\t\t\tif (qc.comp.volume != null) qc.valueVolume = qc.comp.volume;\n\t\t\tif (qc.comp.moles != null) qc.valueMoles = qc.comp.moles;\n\t\t\tif (qc.comp.density != null) qc.valueDensity = qc.comp.density;\n\t\t\tif (qc.comp.conc != null) qc.valueConc = qc.comp.conc;\n\t\t\tif (qc.comp.yield != null) qc.valueYield = qc.comp.yield;\n\n\t\t\tqc.statEquiv = qc.valueEquiv == QuantityCalc.UNSPECIFIED ? QuantityCalcStat.Unknown : QuantityCalcStat.Actual;\n\t\t\tqc.statMass = qc.valueMass == QuantityCalc.UNSPECIFIED ? QuantityCalcStat.Unknown : QuantityCalcStat.Actual;\n\t\t\tqc.statVolume = qc.valueVolume == QuantityCalc.UNSPECIFIED ? QuantityCalcStat.Unknown : QuantityCalcStat.Actual;\n\t\t\tqc.statMoles = qc.valueMoles == QuantityCalc.UNSPECIFIED ? QuantityCalcStat.Unknown : QuantityCalcStat.Actual;\n\t\t\tqc.statDensity = qc.valueDensity == QuantityCalc.UNSPECIFIED ? QuantityCalcStat.Unknown : QuantityCalcStat.Actual;\n\t\t\tqc.statConc = qc.valueConc == QuantityCalc.UNSPECIFIED ? QuantityCalcStat.Unknown : QuantityCalcStat.Actual;\n\t\t\tqc.statYield = qc.valueYield == QuantityCalc.UNSPECIFIED ? QuantityCalcStat.Unknown : QuantityCalcStat.Actual;\n\t\t}\n\n\t\t// if no rate limiting reactants, pick everything from step 1\n\t\tif (this.idxPrimary.length == 0)\n\t\t{\n\t\t\tfor (let n = 0; n < this.quantities.length; n++)\n\t\t\t{\n\t\t\t\tlet qc = this.quantities[n];\n\t\t\t\tif (qc.type == ExperimentComponentType.Reactant && qc.step == 0)\n\t\t\t\t{\n\t\t\t\t\tqc.role = QuantityCalcRole.Primary;\n\t\t\t\t\tthis.idxPrimary.push(n);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// attempt to replace at least one unknown value with an inferred value; returns true if anything happened, which\n\t// signals that another round should be repeated, in case more possibilities come online\n\tprivate calculateSomething():boolean\n\t{\n\t\tlet anything = false;\n\n\t\t// ---- part 1: look for any interconversions that are internal to a component\n\n\t\tfor (let qc of this.quantities)\n\t\t{\n\t\t\t// molar interconversion\n\t\t\tif (qc.molw > 0 && qc.valueMass == QuantityCalc.UNSPECIFIED && qc.statMoles == QuantityCalcStat.Actual)\n\t\t\t{\n\t\t\t\tqc.valueMass = qc.valueMoles * qc.molw;\n\t\t\t\tqc.statMass = QuantityCalcStat.Virtual;\n\t\t\t\tanything = true;\n\t\t\t}\n\t\t\tif (qc.molw > 0 && qc.valueMass != QuantityCalc.UNSPECIFIED && qc.valueMoles == QuantityCalc.UNSPECIFIED)\n\t\t\t{\n\t\t\t\tqc.valueMoles = qc.valueMass / qc.molw;\n\t\t\t\tqc.statMoles = QuantityCalcStat.Virtual;\n\t\t\t\tanything = true;\n\t\t\t}\n\t\t\tif (qc.molw > 0 && qc.statMass == QuantityCalcStat.Actual && qc.statMoles == QuantityCalcStat.Actual)\n\t\t\t{\n\t\t\t\tlet calcMoles = qc.valueMass / qc.molw;\n\t\t\t\tif (!this.closeEnough(qc.valueMoles, calcMoles))\n\t\t\t\t{\n\t\t\t\t\tqc.statMass = QuantityCalcStat.Conflict;\n\t\t\t\t\tqc.statMoles = QuantityCalcStat.Conflict;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet isSoln = qc.statConc == QuantityCalcStat.Actual ||\n\t\t\t\t(qc.statVolume == QuantityCalcStat.Actual && (qc.statMass == QuantityCalcStat.Actual || qc.statMoles == QuantityCalcStat.Actual));\n\n\t\t\t// non solutions, mass/density/volume\n\t\t\tif (!isSoln)\n\t\t\t{\n\t\t\t\tif (qc.valueDensity > 0 && qc.valueMass == QuantityCalc.UNSPECIFIED && qc.valueVolume != QuantityCalc.UNSPECIFIED)\n\t\t\t\t{\n\t\t\t\t\tqc.valueMass = qc.valueVolume * qc.valueDensity;\n\t\t\t\t\tqc.statMass = QuantityCalcStat.Virtual;\n\t\t\t\t\tanything = true;\n\t\t\t\t}\n\t\t\t\tif (qc.valueDensity > 0 && qc.valueMass != QuantityCalc.UNSPECIFIED && qc.valueVolume == QuantityCalc.UNSPECIFIED)\n\t\t\t\t{\n\t\t\t\t\tqc.valueVolume = qc.valueMass / qc.valueDensity;\n\t\t\t\t\tqc.statVolume = QuantityCalcStat.Virtual;\n\t\t\t\t\tanything = true;\n\t\t\t\t}\n\t\t\t\tif (qc.valueDensity == QuantityCalc.UNSPECIFIED && qc.valueMass != QuantityCalc.UNSPECIFIED &&\n\t\t\t\t\tqc.valueVolume != QuantityCalc.UNSPECIFIED && qc.valueConc == QuantityCalc.UNSPECIFIED)\n\t\t\t\t{\n\t\t\t\t\tif (qc.statMass == QuantityCalcStat.Actual || qc.statMoles == QuantityCalcStat.Actual) // don't guess density from stoichoimetry\n\t\t\t\t\t{\n\t\t\t\t\t\tqc.valueDensity = qc.valueMass / qc.valueVolume;\n\t\t\t\t\t\tqc.statDensity = QuantityCalcStat.Virtual;\n\t\t\t\t\t\tanything = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// solutions, moles/conc/volume\n\t\t\tif (isSoln)\n\t\t\t{\n\t\t\t\tif (qc.valueConc > 0 && qc.valueMoles == QuantityCalc.UNSPECIFIED && qc.valueVolume != QuantityCalc.UNSPECIFIED)\n\t\t\t\t{\n\t\t\t\t\tqc.valueMoles = 0.001 * qc.valueVolume * qc.valueConc;\n\t\t\t\t\tqc.statMoles = QuantityCalcStat.Virtual;\n\t\t\t\t\tanything = true;\n\t\t\t\t}\n\t\t\t\tif (qc.valueConc > 0 && qc.valueMoles != QuantityCalc.UNSPECIFIED && qc.valueVolume == QuantityCalc.UNSPECIFIED)\n\t\t\t\t{\n\t\t\t\t\tqc.valueVolume = 1000 * qc.valueMoles / qc.valueConc;\n\t\t\t\t\tqc.statVolume = QuantityCalcStat.Virtual;\n\t\t\t\t\tanything = true;\n\t\t\t\t}\n\t\t\t\tif (qc.valueConc == QuantityCalc.UNSPECIFIED && qc.valueMass != QuantityCalc.UNSPECIFIED && qc.valueVolume != QuantityCalc.UNSPECIFIED)\n\t\t\t\t{\n\t\t\t\t\tqc.valueConc = 1000 * qc.valueMoles / qc.valueVolume;\n\t\t\t\t\tqc.statConc = QuantityCalcStat.Virtual;\n\t\t\t\t\tanything = true;\n\t\t\t\t}\n\t\t\t\tif (qc.statConc == QuantityCalcStat.Actual && qc.valueMoles > 0 && qc.statVolume == QuantityCalcStat.Actual)\n\t\t\t\t{\n\t\t\t\t\tlet calcVolume = 1000 * qc.valueMoles / qc.valueConc;\n\t\t\t\t\tif (!this.closeEnough(qc.valueVolume, calcVolume))\n\t\t\t\t\t{\n\t\t\t\t\t\tqc.statConc = QuantityCalcStat.Conflict;\n\t\t\t\t\t\tif (qc.statMass == QuantityCalcStat.Actual) qc.statMass = QuantityCalcStat.Conflict;\n\t\t\t\t\t\tif (qc.statMoles == QuantityCalcStat.Actual) qc.statMoles = QuantityCalcStat.Conflict;\n\t\t\t\t\t\tqc.statVolume = QuantityCalcStat.Conflict;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// calculating mass from virtual molar mass\n\t\t\tif (qc.molw > 0 && qc.valueMass == QuantityCalc.UNSPECIFIED && qc.valueMoles != QuantityCalc.UNSPECIFIED)\n\t\t\t{\n\t\t\t\tqc.valueMass = qc.valueMoles * qc.molw;\n\t\t\t\tqc.statMass = QuantityCalcStat.Virtual;\n\t\t\t\tanything = true;\n\t\t\t}\n\n\t\t\t// providing a concentration and density is disallowed\n\t\t\tif (qc.statDensity == QuantityCalcStat.Actual && qc.statConc == QuantityCalcStat.Actual)\n\t\t\t{\n\t\t\t\tqc.statDensity = QuantityCalcStat.Conflict;\n\t\t\t\tqc.statConc = QuantityCalcStat.Conflict;\n\t\t\t}\n\t\t}\n\n\t\tif (anything) return true; // want to make it cycle over all the reactants before moving on\n\n\t\t// ---- part 2: determine the molar quantity baseline, for each step, where applicable\n\n\t\tlet hasRef = false;\n\t\tlet numSteps = this.entry.steps.length;\n\t\tlet primaryCounts = Vec.numberArray(0, numSteps);\n\t\tlet primaryEquivs = Vec.numberArray(0, numSteps);\n\t\tlet primaryMoles = this.primaryMoles = Vec.numberArray(0, numSteps);\n\n\t\t// go over components: first step uses reactants; next steps use products from previous\n\t\tfor (let qc of this.quantities)\n\t\t{\n\t\t\tlet ref = -1;\n\t\t\tif (qc.step == 0 && qc.type == ExperimentComponentType.Reactant && qc.comp.primary) ref = qc.step;\n\t\t\telse if (qc.step < numSteps - 1 && qc.type == ExperimentComponentType.Product && !qc.comp.waste) ref = qc.step + 1;\n\t\t\telse continue;\n\t\t\tif (primaryEquivs[ref] < 0) continue;\n\n\t\t\tif (qc.statMoles == QuantityCalcStat.Actual)\n\t\t\t{\n\t\t\t\tprimaryEquivs[ref] = -1;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tprimaryCounts[ref]++;\n\t\t\tprimaryEquivs[ref] += qc.valueEquiv;\n\t\t\tprimaryMoles[ref] += qc.valueMoles;\n\t\t}\n\n\t\t// special deal: if no primary reactants, use all of the primaries\n\t\tif (primaryEquivs[0] <= 0)\n\t\t{\n\t\t\tprimaryCounts[0] = 0;\n\t\t\tprimaryEquivs[0] = 0;\n\t\t\tprimaryMoles[0] = 0;\n\t\t\tfor (let i of this.idxPrimary)\n\t\t\t{\n\t\t\t\tlet qc = this.quantities[i];\n\t\t\t\tif (qc.statMoles == QuantityCalcStat.Unknown)\n\t\t\t\t{\n\t\t\t\t\tprimaryCounts[0] = 0;\n\t\t\t\t\tprimaryEquivs[0] = -1;\n\t\t\t\t\tprimaryMoles[0] = 0;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tprimaryCounts[0]++;\n\t\t\t\tprimaryEquivs[0] += qc.valueEquiv;\n\t\t\t\tprimaryMoles[0] += qc.valueMoles;\n\t\t\t}\n\t\t}\n\t\tlet refMoles = Vec.numberArray(0, numSteps);\n\t\tfor (let n = 0; n < numSteps; n++)\n\t\t{\n\t\t\trefMoles[n] = primaryCounts[n] == 0 || primaryEquivs[n] <= 0 ? 0 : primaryMoles[n] / primaryEquivs[n];\n\t\t\tif (refMoles[n] > 0) hasRef = true;\n\t\t}\n\n\t\t// if no reference moles at all, try formulating some by making use of product quantities\n\t\tif (!hasRef)\n\t\t{\n\t\t\tfor (let n = 0; n < numSteps; n++)\n\t\t\t{\n\t\t\t\tlet prodMolar:number[] = [];\n\t\t\t\tfor (let qc of this.quantities)\n\t\t\t\t{\n\t\t\t\t\tif (qc.step != n || qc.role != QuantityCalcRole.Product) continue;\n\t\t\t\t\t//if (qc.statMoles == QuantityCalcStat.Actual || qc.valueMoles <= 0 || qc.valueEquiv <= 0) continue;\n\t\t\t\t\tif (qc.statMoles == QuantityCalcStat.Unknown || qc.valueMoles <= 0 || qc.valueEquiv <= 0) continue;\n\t\t\t\t\tlet yld = qc.valueYield > 0 ? qc.valueYield * 0.01 : 1;\n\t\t\t\t\tprodMolar.push(qc.valueMoles / (qc.valueEquiv * yld));\n\t\t\t\t}\n\t\t\t\tif (prodMolar.length > 0)\n\t\t\t\t{\n\t\t\t\t\trefMoles[n] = Vec.sum(prodMolar) / prodMolar.length;\n\t\t\t\t\thasRef = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!hasRef) return false; // can't do anything else\n\n\t\t// ---- part 3: look for ways to apply the yield\n\n\t\tfor (let qc of this.quantities)\n\t\t{\n\t\t\tif (qc.type != ExperimentComponentType.Product) continue;\n\n\t\t\tif (refMoles[qc.step] == 0) continue;\n\n\t\t\tif (qc.valueYield == QuantityCalc.UNSPECIFIED && qc.valueMoles != QuantityCalc.UNSPECIFIED)\n\t\t\t{\n\t\t\t\tqc.valueYield = 100 * qc.valueMoles / (refMoles[qc.step] * qc.valueEquiv);\n\t\t\t\tqc.statYield = QuantityCalcStat.Virtual;\n\t\t\t\tanything = true;\n\t\t\t}\n\t\t\tif (qc.valueYield != QuantityCalc.UNSPECIFIED && qc.valueMoles == QuantityCalc.UNSPECIFIED)\n\t\t\t{\n\t\t\t\tqc.valueMoles = qc.valueYield * 0.01 * (refMoles[qc.step] * qc.valueEquiv);\n\t\t\t\tqc.statMoles = QuantityCalcStat.Virtual;\n\t\t\t\tanything = true;\n\t\t\t}\n\t\t\tif (qc.valueMoles > 0 && qc.statYield == QuantityCalcStat.Actual)\n\t\t\t{\n\t\t\t\tlet calcYield = 100 * qc.valueMoles / (refMoles[qc.step] * qc.valueEquiv);\n\t\t\t\tif (!this.closeEnough(qc.valueYield, calcYield))\n\t\t\t\t{\n\t\t\t\t\tif (qc.statMass == QuantityCalcStat.Actual) qc.statMass = QuantityCalcStat.Conflict;\n\t\t\t\t\tif (qc.statMoles == QuantityCalcStat.Actual) qc.statMoles = QuantityCalcStat.Conflict;\n\t\t\t\t\tqc.statYield = QuantityCalcStat.Conflict;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (anything) return true;\n\n\t\t// ---- part 4: look for stoichiometric components where molarity can be filled in\n\n\t\tfor (let qc of this.quantities)\n\t\t{\n\t\t\tif (refMoles[qc.step] == 0) continue;\n\n\t\t\tif (qc.valueMass == QuantityCalc.UNSPECIFIED && qc.valueMoles == QuantityCalc.UNSPECIFIED && qc.valueEquiv > 0)\n\t\t\t{\n\t\t\t\tqc.valueMoles = refMoles[qc.step] * qc.valueEquiv;\n\t\t\t\tqc.statMoles = QuantityCalcStat.Virtual;\n\t\t\t\tanything = true;\n\t\t\t}\n\t\t\tif (qc.valueMoles != QuantityCalc.UNSPECIFIED && qc.valueEquiv == QuantityCalc.UNSPECIFIED)\n\t\t\t{\n\t\t\t\tqc.valueEquiv = qc.valueMoles / refMoles[qc.step];\n\t\t\t\tqc.statEquiv = QuantityCalcStat.Virtual;\n\t\t\t\tanything = true;\n\t\t\t}\n\t\t}\n\n\t\treturn anything;\n\t}\n\n\t// work out all available green metrics for a particular product index\n\tprivate calculateGreenMetrics(idx:number):void\n\t{\n\t\tlet qc = this.quantities[idx];\n\t\tlet gm = new GreenMetrics();\n\n\t\tgm.step = qc.step;\n\t\tgm.idx = qc.idx;\n\t\tgm.isBlank = true;\n\n\t\tfor (let n = 0; n < this.quantities.length; n++)\n\t\t{\n\t\t\tlet sub = this.quantities[n];\n\t\t\tif (sub.step > gm.step) continue;\n\n\t\t\tlet eq = sub.valueEquiv;\n\t\t\tif (eq == 0 && sub.type == ExperimentComponentType.Reagent) continue;\n\n\t\t\tif (sub.valueMass != QuantityCalc.UNSPECIFIED) gm.isBlank = false;\n\n\t\t\tif (sub.type == ExperimentComponentType.Reactant || sub.type == ExperimentComponentType.Reagent)\n\t\t\t{\n\t\t\t\tgm.massReact.push(sub.valueMass);\n\t\t\t\tif (sub.step == gm.step && eq > 0 && sub.molw > 0) gm.molwReact.push(eq * sub.molw);\n\t\t\t}\n\t\t\telse if (sub.type == ExperimentComponentType.Product)\n\t\t\t{\n\t\t\t\tif (!sub.comp.waste)\n\t\t\t\t{\n\t\t\t\t\tif (sub.step == gm.step) gm.massProd.push(sub.valueMass);\n\t\t\t\t\tif (eq > 0 && sub.molw > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (sub.step == gm.step) gm.molwProd.push(eq * sub.molw);\n\t\t\t\t\t\telse if (sub.step == gm.step - 1) gm.molwReact.push(eq * sub.molw);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tgm.massWaste.push(sub.valueMass);\n\t\t\t\t}\n\t\t\t\tif (sub.step == gm.step) gm.massProdWaste.push(sub.valueMass);\n\t\t\t}\n\t\t}\n\n\t\tgm.impliedWaste = Vec.sum(gm.massReact) - Vec.sum(gm.massProdWaste);\n\t\tif (Math.abs(gm.impliedWaste) > 1E-3) gm.impliedWaste = 0;\n\n\t\tthis.greenMetrics.push(gm);\n\t}\n\n\t// figure out if two values are not in conflict\n\tprivate closeEnough(value1:number, value2:number):boolean\n\t{\n\t\tif (value1 <= 0 || value2 <= 0) return true;\n\t\tlet ratio = value1 / value2;\n\t\treturn ratio >= 0.99 && ratio <= 1.01;\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {clone} from '../util/util';\n\n/*\n\tRenderPolicy: controls the parameters of rendering for molecules (and some composites like reactions). These policies are\n\tgeneral, i.e. can apply to any instantiated molecule instance.\n*/\n\ninterface RenderData\n{\n\tname:string;\n\tpointScale:number;\n\tresolutionDPI:number;\n\tfontSize:number;\n\tlineSize:number;\n\tbondSep:number;\n\tdefaultPadding:number;\n\tforeground:number;\n\tbackground:number;\n\tatomCols:number[];\n}\n\nexport class RenderPolicy\n{\n\tpublic data:RenderData;\n\n\tconstructor(data?:RenderData)\n\t{\n\t\tif (!data)\n\t\t{\n\t\t\tdata =\n\t\t\t{\n\t\t\t\tname: 'default',\n\t\t\t\tpointScale: 20,\n\t\t\t\tresolutionDPI: 100,\n\t\t\t\tfontSize: 0.65,\n\t\t\t\tlineSize: 0.075,\n\t\t\t\tbondSep: 0.2,\n\t\t\t\tdefaultPadding: 0.2,\n\t\t\t\tforeground: 0x000000,\n\t\t\t\tbackground: 0xFFFFFF,\n\t\t\t\tatomCols: new Array(112)\n\t\t\t};\n\t\t\tfor (let n = 0; n <= 111; n++) data.atomCols[n] = 0x000000;\n\t\t\tthis.data = data;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.data = clone(data) as RenderData;\n\t\t}\n\t}\n\n\tpublic clone():RenderPolicy {return new RenderPolicy(this.data);}\n\n\t// static methods for creating new default schemes\n\tpublic static defaultBlackOnWhite(pixPerAng?:number):RenderPolicy\n\t{\n\t\tlet policy = new RenderPolicy();\n\t\tif (pixPerAng) policy.data.pointScale = pixPerAng;\n\t\treturn policy;\n\t}\n\tpublic static defaultWhiteOnBlack(pixPerAng?:number):RenderPolicy\n\t{\n\t\tlet policy = new RenderPolicy();\n\t\tif (pixPerAng) policy.data.pointScale = pixPerAng;\n\t\tpolicy.data.foreground = 0xFFFFFF;\n\t\tpolicy.data.background = 0x000000;\n\t\tfor (let n = 0; n <= 111; n++) policy.data.atomCols[n] = 0xFFFFFF;\n\t\treturn policy;\n\t}\n\tpublic static defaultColourOnWhite(pixPerAng?:number):RenderPolicy\n\t{\n\t\tlet policy = RenderPolicy.defaultBlackOnWhite(pixPerAng);\n\t\tpolicy.data.atomCols[0] = 0x404040;\n\t\tpolicy.data.atomCols[1] = 0x808080;\n\t\tpolicy.data.atomCols[6] = 0x000000;\n\t\tpolicy.data.atomCols[7] = 0x0000FF;\n\t\tpolicy.data.atomCols[8] = 0xFF0000;\n\t\tpolicy.data.atomCols[9] = 0xFF8080;\n\t\tpolicy.data.atomCols[15] = 0xFF8000;\n\t\tpolicy.data.atomCols[16] = 0x808000;\n\t\tpolicy.data.atomCols[17] = 0x00C000;\n\t\tpolicy.data.atomCols[35] = 0xC04000;\n\t\treturn policy;\n\t}\n\tpublic static defaultColourOnBlack(pixPerAng?:number):RenderPolicy\n\t{\n\t\tlet policy = RenderPolicy.defaultWhiteOnBlack(pixPerAng);\n\t\tpolicy.data.atomCols[0] = 0xA0A0A0;\n\t\tpolicy.data.atomCols[1] = 0x808080;\n\t\tpolicy.data.atomCols[6] = 0xFFFFFF;\n\t\tpolicy.data.atomCols[7] = 0x4040FF;\n\t\tpolicy.data.atomCols[8] = 0xFF4040;\n\t\tpolicy.data.atomCols[9] = 0xFF8080;\n\t\tpolicy.data.atomCols[15] = 0xFF8000;\n\t\tpolicy.data.atomCols[16] = 0xFFFF00;\n\t\tpolicy.data.atomCols[17] = 0x40FF40;\n\t\tpolicy.data.atomCols[35] = 0xFF8040;\n\t\treturn policy;\n\t}\n\tpublic static defaultPrintedPublication():RenderPolicy\n\t{\n\t\tlet policy = RenderPolicy.defaultBlackOnWhite(9.6);\n\t\tpolicy.data.resolutionDPI = 600;\n\t\tpolicy.data.fontSize = 0.80;\n\t\tpolicy.data.bondSep = 0.27;\n\t\tpolicy.data.lineSize = 0.0625;\n\t\treturn policy;\n\t}\n}\n\n/*\n\tRenderEffects: provides the ability to request additional drawing effects for a specific molecule instance, in\n\taddition to the basic rendering.\n*/\n\nexport class RenderEffects\n{\n\t// optional replacement colours, by object index: to override defaults\n\tpublic colAtom:Record<number, number> = {};\n\tpublic colBond:Record<number, number> = {};\n\n\t// atoms that should be surrounded by a dotted rectangular outline (atom = colour)\n\tpublic dottedRectOutline:Record<number, number> = {};\n\n\t// bonds that should have a dotted line plotted across them (bond = colour)\n\tpublic dottedBondCross:Record<number, number> = {};\n\n\t// list of atom/bond indices to NOT draw\n\tpublic hideAtoms = new Set<number>();\n\tpublic hideBonds = new Set<number>();\n\n\t// rectangular frames to draw around atoms\n\tpublic atomFrameDotSz:number[] = [];\n\tpublic atomFrameCol:number[] = [];\n\n\t// solid dots to draw over top of atoms\n\tpublic atomCircleSz:number[] = [];\n\tpublic atomCircleCol:number[] = [];\n\n\t// atom & bond decoration: text to display, colour, and font size (in Angstrom units)\n\tpublic atomDecoText:string[] = [];\n\tpublic atomDecoCol:number[] = [];\n\tpublic atomDecoSize:number[] = [];\n\tpublic bondDecoText:string[] = [];\n\tpublic bondDecoCol:number[] = [];\n\tpublic bondDecoSize:number[] = [];\n\n\t// list of atom indices which are considered to be \"overlapping\", i.e. this is bad\n\tpublic overlapAtoms:number[] = [];\n}\n\n/*\n\tRenderMnemonics: a convenient container for recording information about a rendering process, which is useful for\n\tvalidation procedures.\n*/\n\nexport enum RenderMnemonicType\n{\n\tAtom = 'A',\n\tBond = 'B',\n\tArtifact = 'R',\n\tEffect = 'E',\n}\n\nexport interface RenderMnemonicItem\n{\n\ttype:RenderMnemonicType | string; // general category: known type or custom\n\tdetails:string; // arbitrary information about the payload, keep it concise, don't use the separator ('|')\n\tcoords?:number[];\n}\n\nexport class RenderMnemonics\n{\n\tpublic items:RenderMnemonicItem[] = [];\n\n\t// ------------ public methods ------------\n\n\tconstructor(encoded?:string)\n\t{\n\t\tlet lines = (encoded || '').split('&');\n\t\tfor (let line of lines)\n\t\t{\n\t\t\tlet bits = line.split('|');\n\t\t\tif (bits.length != 3) continue;\n\t\t\tlet item:RenderMnemonicItem =\n\t\t\t{\n\t\t\t\ttype: bits[0],\n\t\t\t\tdetails: bits[1],\n\t\t\t\tcoords: bits[2].split(',').map((str) => parseFloat(str)),\n\t\t\t};\n\t\t\tthis.items.push(item);\n\t\t}\n\t}\n\n\tpublic append(type:RenderMnemonicType | string, details:string, coords?:number[]):void\n\t{\n\t\tfor (let n = details.length - 1; n >= 0; n--) if (details[n] == '|' || details[n] == '&') details = details.substring(0, n) + details.substring(n + 1);\n\t\tthis.items.push({type, details, coords});\n\t}\n\n\tpublic serialise():string\n\t{\n\t\tlet lines:string[] = [];\n\t\tfor (let item of this.items)\n\t\t{\n\t\t\tlet coords = (item.coords ?? []).map((coord) => coord.toFixed(1)).join(',');\n\t\t\tlines.push(`${item.type}|${item.details}|${coords}`);\n\t\t}\n\t\treturn lines.join('&');\n\t}\n\n\t// produce a quasi-human-readable representation of the mnemonics, so that two sets can be compared with each other;\n\t// a sans-coordinate version is provided as well, in case a rougher comparison is wanted\n\tpublic packWithCoords():string {return this.serialise();}\n\tpublic packWithoutCoords():string\n\t{\n\t\treturn this.items.map((item) => `${item.type}|${item.details}`).join('&');\n\t}\n\n\t// ------------ private methods ------------\n}\n\n","/*\n\tWebMolKit\n\n\t(c) 2010-2024 Molecular Materials Informatics, Inc.\n\n\tAll rights reserved\n\n\thttp://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {BondArtifact} from '../data/BondArtifact';\nimport {CoordUtil} from '../data/CoordUtil';\nimport {Molecule} from '../data/Molecule';\nimport {PolymerBlock, PolymerBlockConnectivity, PolymerBlockUnit} from '../data/PolymerBlock';\nimport {QueryUtil} from '../data/QueryUtil';\nimport {FitRotatedEllipse} from '../util/FitRotatedEllipse';\nimport {Box, GeomUtil, Line, Oval, QuickHull} from '../util/Geom';\nimport {angleDiff, clone, DEGRAD, invZ, norm2_xy, norm_xy, RADDEG, sqr, TWOPI} from '../util/util';\nimport {Vec} from '../util/Vec';\nimport {ArrangeMeasurement} from './ArrangeMeasurement';\nimport {FontData} from './FontData';\nimport {RenderEffects, RenderPolicy} from './Rendering';\n\n/*\n\tThe algorithm for examining the contents of a molecule representation, and converting this into graphics primitives\n\twhich are arranged on some virtual canvas, according to layout metrics. Most of the hard work of displaying a\n\tmolecular structure is done within this class.\n*/\n\nexport interface APoint\n{\n\tanum:number; // corresponds to molecule atom index\n\ttext:string; // the primary label, or null if invisible\n\tfsz:number; // font size for label\n\t//bold:boolean;\n\tcol:number;\n\toval:Oval;\n\trotation?:number; // degrees to rotate text\n}\n\nexport enum BLineType\n{\n\tNormal = 1, // a line segment; may be single bond, part of a multiple bond, or dissected bond\n\tInclined, // an up-wedge bond\n\tDeclined, // a down-wedge bond\n\tUnknown, // a squiggly bond\n\tDotted, // dotted line\n\tDotDir, // dotted line, with inclined destination\n\tIncDouble, // inclined destination, order=2\n\tIncTriple, // inclined destination, order=3\n\tIncQuadruple // inclined destination, order=4\n}\n\nexport interface BLine\n{\n\tbnum:number; // molecule bond index\n\tbfr:number;\n\tbto:number;\n\ttype:BLineType;\n\tline:Line;\n\tsize:number; // line or dot size, where it applies\n\thead:number; // the maximum width of a wedge-type bond\n\tcol:number;\n}\n\nexport interface XRing\n{\n\tatoms:number[];\n\tcx:number;\n\tcy:number;\n\trw:number;\n\trh:number;\n\ttheta:number;\n\tsize:number; // line size\n}\n\nexport interface XPath\n{\n\tatoms:number[];\n\tpx:number[];\n\tpy:number[];\n\tctrl:boolean[];\n\tsize:number; // line size\n}\n\nexport interface SpaceFiller\n{\n\tanum:number; // origin, if any\n\tbnum:number;\n\tbox:Box; // bounding limit\n\tpx:number[];\n\tpy:number[];\n}\n\n// try to avoid compressing bonds too much; simple-line bonds are more resilient than things like dotted lines\nconst MINBOND_LINE = 0.25;\nconst MINBOND_EXOTIC = 0.5;\n\nexport class ArrangeMolecule\n{\n\tprivate scale:number; // extracted from the measurement instance: useful to note when it changes\n\n\t// extracts, for efficiency\n\tprivate bondSepPix:number;\n\tprivate lineSizePix:number;\n\tprivate fontSizePix:number;\n\tprivate ymul:number; // -1 if Y is up, +1 if it is down\n\n\t// the angstrom-to-ascent height is corrected by this factor\n\tprivate static FONT_CORRECT = 1.5;\n\n\t// note: the first {#atoms} entries in the points array correspond to the atoms - and likewise for the space array; anything\n\t// listed after that is arbitrary; the lines are not listed in any kind of order\n\tprivate points:APoint[] = [];\n\tprivate lines:BLine[] = [];\n\tprivate rings:XRing[] = [];\n\tprivate paths:XPath[] = [];\n\tprivate space:SpaceFiller[] = [];\n\n\t// bond artifacts: by default they are derived automatically, but can also be disabled; these properties are also used to\n\t// override the default rendering of atom/bond properties\n\tprivate wantArtifacts = true;\n\tprivate artifacts:BondArtifact = null;\n\tprivate bondOrder:number[] = []; // replacement bond orders; special case: -1 for do-not-draw\n\tprivate atomCharge:number[] = [];\n\tprivate atomUnpaired:number[] = [];\n\tprivate artifactCharge = new Map<object, number>();\n\tprivate artifactUnpaired = new Map<object, number>();\n\tprivate artifactFract = new Map<object, boolean>();// bond order < 1: replaces the bond itself\n\n\t// --------------------- static methods ---------------------\n\n\t// when it is necessary to define a boundary box in which to draw a molecule, the only way to get it right is to do a\n\t// full arrangement, but this is computationally intensive; this method is fast, and delivers an approximate estimate\n\tpublic static guestimateSize(mol:Molecule, policy:RenderPolicy, maxW?:number, maxH?:number):number[]\n\t{\n\t\tlet box = mol.boundary();\n\t\tlet minX = box.minX(), minY = box.minY(), maxX = box.maxX(), maxY = box.maxY();\n\t\tlet fontSize = policy.data.fontSize * this.FONT_CORRECT;\n\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (mol.atomExplicit(n))\n\t\t{\n\t\t\tlet numsym = 0;\n\t\t\tfor (let ch of mol.atomElement(n)) if (!'|{}^'.includes(ch)) numsym++;\n\t\t\tlet plusH = mol.atomHydrogens(n) > 0 ? 1 : 0;\n\t\t\tconst aw = 0.5 * 0.7 * fontSize * (numsym + plusH);\n\t\t\tconst ah = 0.75 * fontSize * (1 + 0.2 * plusH);\n\t\t\tconst ax = mol.atomX(n), ay = mol.atomY(n);\n\t\t\tminX = Math.min(minX, ax - aw);\n\t\t\tmaxX = Math.max(maxX, ax + aw);\n\t\t\tminY = Math.min(minY, ay - ah);\n\t\t\tmaxY = Math.max(maxY, ay + ah);\n\t\t}\n\t\tlet w = Math.max(1, (maxX - minX)) * policy.data.pointScale;\n\t\tlet h = Math.max(1, (maxY - minY)) * policy.data.pointScale;\n\t\tif (maxW > 0 && w > maxW) {h *= maxW / w; w = maxW;}\n\t\tif (maxH > 0 && h > maxH) {w *= maxH / h; h = maxH;}\n\t\treturn [w, h];\n\t}\n\n\t// --------------------- public methods ---------------------\n\n\tconstructor(private mol:Molecule, private measure:ArrangeMeasurement, private policy:RenderPolicy,\n\t\t\t\tprivate effects:RenderEffects = new RenderEffects())\n\t{\n\t}\n\n\t// access to setup info\n\tpublic getMolecule():Molecule {return this.mol;}\n\tpublic getMeasure():ArrangeMeasurement {return this.measure;}\n\tpublic getPolicy():RenderPolicy {return this.policy;}\n\tpublic getEffects():RenderEffects {return this.effects;}\n\tpublic getScale():number {return this.scale;} // may be different from measure.scale() if modified after layout\n\n\t// bond artifacts: can decide whether they're to be derived, or provide them already\n\tpublic setWantArtifacts(want:boolean) {this.wantArtifacts = want;}\n\tpublic getArtifacts():BondArtifact {return this.artifacts;}\n\tpublic setArtifacts(artifacts:BondArtifact):void {this.artifacts = artifacts;}\n\n\t// the action method: call this before accessing any of the resultant data\n\tpublic arrange():void\n\t{\n\t\tconst {mol, measure, policy, effects} = this;\n\n\t\tthis.scale = measure.scale();\n\t\tthis.bondSepPix = policy.data.bondSep * measure.scale();\n\t\tthis.lineSizePix = policy.data.lineSize * measure.scale();\n\t\tthis.fontSizePix = policy.data.fontSize * measure.scale() * ArrangeMolecule.FONT_CORRECT;\n\t\tthis.ymul = measure.yIsUp() ? -1 : 1;\n\n\t\tlet artmask:boolean[] = null;\n\t\tif (this.wantArtifacts && this.artifacts == null)\n\t\t{\n\t\t\tthis.artifacts = new BondArtifact(mol);\n\n\t\t\tartmask = Vec.booleanArray(false, mol.numAtoms);\n\t\t\tfor (let path of this.artifacts.getResPaths()) for (let a of path.atoms) artmask[a - 1] = true;\n\t\t\tfor (let ring of this.artifacts.getResRings()) for (let a of ring.atoms) artmask[a - 1] = true;\n\t\t\tfor (let arene of this.artifacts.getArenes()) {artmask[arene.centre - 1] = true; for (let a of arene.atoms) artmask[a - 1] = true;}\n\t\t}\n\n\t\tthis.setupBondOrders();\n\n\t\t// fill in each of the atom centres\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t{\n\t\t\t// atom symbols which are more than 2 characters long are labels rather than elements, and get different treatment;\n\t\t\t// note we put in a null placeholder here, so that the points will be kept in their original atom order\n\t\t\tif (mol.atomElement(n).length > 2 && mol.atomHydrogens(n) == 0)\n\t\t\t{\n\t\t\t\tthis.points.push(null);\n\t\t\t\tthis.space.push(null);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// proceed with a regular atom symbol\n\t\t\tlet a:APoint =\n\t\t\t{\n\t\t\t\tanum: n,\n\t\t\t\ttext: /*this.effects.showCarbon ||*/ mol.atomExplicit(n) || CoordUtil.atomIsWeirdLinear(mol, n) ? mol.atomElement(n) : null,\n\t\t\t\tfsz: this.fontSizePix,\n\t\t\t\tcol: this.policy.data.atomCols[mol.atomicNumber(n)],\n\t\t\t\toval: new Oval(this.measure.angToX(mol.atomX(n)), this.measure.angToY(mol.atomY(n)), 0, 0)\n\t\t\t};\n\t\t\tlet overCol = this.effects.colAtom[n];\n\t\t\tif (overCol) a.col = overCol;\n\n\t\t\t//if (policy.mappedColour >= 0 && mol.atomMapNum(n) > 0) a.col = policy.mappedColour;\n\n\t\t\t// decide whether this atom is to have a label\n\t\t\t//let explicit = mol.atomExplicit(n) /*|| this.effects.showCarbon;*/\n\t\t\t//if (explicit && /*!effects.showCarbon &&*/ mol.atomElement(n) == 'C' && !this.atomIsWeirdLinear(n)) explicit = !artmask[n - 1];\n\t\t\t//a.text = explicit ? mol.atomElement(n) : null;\n\t\t\tif (artmask && artmask[n - 1] && mol.atomElement(n) == 'C') a.text = null;\n\n\t\t\t// if it has a label, then how big\n\t\t\tif (a.text != null)\n\t\t\t{\n\t\t\t\tlet wad = this.measure.measureText(a.text, a.fsz);\n\t\t\t\tconst PADDING = 1.1; // want a bit more room\n\t\t\t\ta.oval.rw = 0.5 * wad[0] * PADDING;\n\t\t\t\ta.oval.rh = 0.5 * wad[1] * PADDING;\n\t\t\t}\n\n\t\t\tthis.points.push(a);\n\t\t\tthis.space.push(this.computeSpacePoint(a));\n\t\t}\n\n\t\t// pick up the label-style elements, and deal with them\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (this.points[n - 1] == null) this.processLabel(n);\n\n\t\t// resolve the bonds which can be analyzed immediately\n\t\tlet bdbl = Vec.booleanArray(false, mol.numBonds); // gets set to true if bond is awaiting a double bond assignment\n\n\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t{\n\t\t\tlet bfr = mol.bondFrom(n), bto = mol.bondTo(n);\n\t\t\tlet bt = mol.bondType(n), bo = this.bondOrder[n - 1];\n\t\t\tif (bo < 0) continue; // do not draw\n\n\t\t\tlet col = this.effects.colBond[n];\n\t\t\tif (!col) col = this.policy.data.foreground;\n\n\t\t\tbdbl[n - 1] = bo == 2 && (bt == Molecule.BONDTYPE_NORMAL || bt == Molecule.BONDTYPE_UNKNOWN);\n\n\t\t\tlet a1 = this.points[bfr - 1], a2 = this.points[bto - 1];\n\t\t\tlet x1 = a1.oval.cx, y1 = a1.oval.cy, x2 = a2.oval.cx, y2 = a2.oval.cy;\n\n\t\t\t // miniscule resolution: do not give it a bond line; and remove the double bond flag so it doesn't get processed later either\n\t\t\tif (Math.abs(x2 - x1) <= 1 && Math.abs(y2 - y1) <= 1)\n\t\t\t{\n\t\t\t\tbdbl[n - 1] = false;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// for non-double bonds, can add the constituents right away\n\t\t\tif (bdbl[n - 1]) continue;\n\n\t\t\tlet minDist = (bo == 1 && bt == Molecule.BONDTYPE_NORMAL ? MINBOND_LINE : MINBOND_EXOTIC) * measure.scale();\n\t\t\tlet xy1 = this.shrinkBond(x1, y1, x2, y2, this.backOffAtom(bfr, x1, y1, x2, y2, minDist));\n\t\t\tlet xy2 = this.shrinkBond(x2, y2, x1, y1, this.backOffAtom(bto, x2, y2, x1, y1, minDist));\n\t\t\tthis.ensureMinimumBondLength(xy1, xy2, x1, y1, x2, y2, minDist);\n\n\t\t\tlet sz = this.lineSizePix, head = 0;\n\t\t\tlet qbonds = QueryUtil.queryBondOrders(mol, n);\n\t\t\tif (Vec.notBlank(qbonds))\n\t\t\t{\n\t\t\t\tVec.sort(qbonds);\n\t\t\t\tif (qbonds[0] == -1) {qbonds.splice(0, 1); qbonds.push(-1);}\n\t\t\t\tlet qtxt = Vec.equals(qbonds, [0, 1, 2, 3, -1]) ? '?' : qbonds.map((o) => o == -1 ? 'A' : o.toString()).join('');\n\t\t\t\tlet oxy = this.orthogonalDelta(xy1[0], xy1[1], xy2[0], xy2[1], 1.3 * this.bondSepPix);\n\t\t\t\tlet v = -0.5;\n\t\t\t\tfor (let i = 0; i < 2; i++, v++)\n\t\t\t\t{\n\t\t\t\t\tlet lx1 = xy1[0] + v * oxy[0], ly1 = xy1[1] + v * oxy[1], lx2 = xy2[0] + v * oxy[0], ly2 = xy2[1] + v * oxy[1];\n\t\t\t\t\tlet b:BLine =\n\t\t\t\t\t{\n\t\t\t\t\t\tbnum: n,\n\t\t\t\t\t\tbfr,\n\t\t\t\t\t\tbto,\n\t\t\t\t\t\ttype: BLineType.Dotted,\n\t\t\t\t\t\tline: new Line(lx1, ly1, lx2, ly2),\n\t\t\t\t\t\tsize: 0.5 * sz,\n\t\t\t\t\t\thead,\n\t\t\t\t\t\tcol: (col & 0xFFFFFF) | 0x80000000,\n\t\t\t\t\t};\n\t\t\t\t\tthis.lines.push(b);\n\t\t\t\t\tthis.space.push(this.computeSpaceLine(b));\n\t\t\t\t}\n\n\t\t\t\tlet rotation = Math.atan2(xy2[1] - xy1[1], xy2[0] - xy1[0]) * RADDEG;\n\t\t\t\tif (rotation < -90 || rotation > 90) rotation += 180; // don't want text to be upside down\n\n\t\t\t\tlet a:APoint =\n\t\t\t\t{\n\t\t\t\t\tanum: 0,\n\t\t\t\t\ttext: qtxt,\n\t\t\t\t\tfsz: 0.35 * this.fontSizePix,\n\t\t\t\t\tcol,\n\t\t\t\t\toval: new Oval(0.5 * (xy1[0] + xy2[0]), 0.5 * (xy1[1] + xy2[1]), 0, 0),\n\t\t\t\t\trotation\n\t\t\t\t};\n\t\t\t\tthis.points.push(a);\n\t\t\t\tthis.space.push(this.computeSpacePoint(a));\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet ltype = BLineType.Normal;\n\t\t\tif (bo == 1 && bt == Molecule.BONDTYPE_INCLINED)\n\t\t\t{\n\t\t\t\tltype = BLineType.Inclined;\n\t\t\t\thead = 0.15 * measure.scale();\n\t\t\t}\n\t\t\telse if (bo == 1 && bt == Molecule.BONDTYPE_DECLINED)\n\t\t\t{\n\t\t\t\tltype = BLineType.Declined;\n\t\t\t\thead = 0.15 * measure.scale();\n\t\t\t}\n\t\t\telse if (bt == Molecule.BONDTYPE_UNKNOWN)\n\t\t\t{\n\t\t\t\tltype = BLineType.Unknown;\n\t\t\t\thead = 0.2 * measure.scale();\n\t\t\t}\n\t\t\telse if (bo == 0)\n\t\t\t{\n\t\t\t\tif (bt == Molecule.BONDTYPE_INCLINED || bt == Molecule.BONDTYPE_DECLINED) ltype = BLineType.DotDir;\n\t\t\t\telse ltype = BLineType.Dotted;\n\t\t\t}\n\t\t\telse if ((bo == 2 || bo == 3 || bo == 4) && (bt == Molecule.BONDTYPE_INCLINED || bt == Molecule.BONDTYPE_DECLINED))\n\t\t\t{\n\t\t\t\tltype = bo == 2 ? BLineType.IncDouble : bo == 3 ? BLineType.IncTriple : BLineType.IncQuadruple;\n\t\t\t\thead = (bo == 2 ? 0.20 : 0.25) * measure.scale();\n\t\t\t}\n\n\t\t\t// for dotted lines, back off intersections if non-terminal\n\t\t\tif (bo == 0)\n\t\t\t{\n\t\t\t\tlet dx = xy2[0] - xy1[0], dy = xy2[1] - xy1[1];\n\t\t\t\tlet d = norm_xy(dx, dy), invD = 1 / d;\n\t\t\t\tlet ox = 0.5 * dx * invD * this.bondSepPix, oy = 0.5 * dy * invD * this.bondSepPix;\n\t\t\t\tif (mol.atomAdjCount(bfr) > 1) {xy1[0] += ox; xy1[1] += oy;}\n\t\t\t\tif (mol.atomAdjCount(bto) > 1) {xy2[0] -= ox; xy2[1] -= oy;}\n\t\t\t}\n\n\t\t\t// for dotted/declined, swap the sides\n\t\t\tif (bo != 1 && bt == Molecule.BONDTYPE_DECLINED) [xy1, xy2] = [xy2, xy1];\n\n\t\t\t// for flat multi-order bonds, add multiple lines\n\t\t\tif (bo > 1 && (bt == Molecule.BONDTYPE_NORMAL || bt == Molecule.BONDTYPE_UNKNOWN))\n\t\t\t{\n\t\t\t\tlet oxy = this.orthogonalDelta(xy1[0], xy1[1], xy2[0], xy2[1], this.bondSepPix);\n\n\t\t\t\t// check the intersections for each individual line\n\t\t\t\tlet ext1 = 1, ext2 = 1;\n\t\t\t\tfor (let i = 0, v = -0.5 * (bo - 1); i < bo; i++, v++)\n\t\t\t\t{\n\t\t\t\t\tlet lx1 = xy1[0] + v * oxy[0], ly1 = xy1[1] + v * oxy[1], lx2 = xy2[0] + v * oxy[0], ly2 = xy2[1] + v * oxy[1];\n\t\t\t\t\text1 = Math.min(ext1, this.backOffAtom(bfr, lx1, ly1, lx2, ly2, minDist));\n\t\t\t\t}\n\t\t\t\txy1 = this.shrinkBond(xy1[0], xy1[1], xy2[0], xy2[1], ext1);\n\t\t\t\tfor (let i = 0, v = -0.5 * (bo - 1); i < bo; i++, v++)\n\t\t\t\t{\n\t\t\t\t\tlet lx1 = xy1[0] + v * oxy[0], ly1 = xy1[1] + v * oxy[1], lx2 = xy2[0] + v * oxy[0], ly2 = xy2[1] + v * oxy[1];\n\t\t\t\t\text2 = Math.min(ext2, this.backOffAtom(bto, lx2, ly2, lx1, ly1, minDist));\n\t\t\t\t}\n\t\t\t\txy2 = this.shrinkBond(xy2[0], xy2[1], xy1[0], xy1[1], ext2);\n\n\t\t\t\t// instantiate objects\n\t\t\t\tfor (let i = 0, v = -0.5 * (bo - 1); i < bo; i++, v++)\n\t\t\t\t{\n\t\t\t\t\tlet lx1 = xy1[0] + v * oxy[0], ly1 = xy1[1] + v * oxy[1], lx2 = xy2[0] + v * oxy[0], ly2 = xy2[1] + v * oxy[1];\n\t\t\t\t\tlet b:BLine =\n\t\t\t\t\t{\n\t\t\t\t\t\tbnum: n,\n\t\t\t\t\t\tbfr,\n\t\t\t\t\t\tbto,\n\t\t\t\t\t\ttype: ltype,\n\t\t\t\t\t\tline: new Line(lx1, ly1, lx2, ly2),\n\t\t\t\t\t\tsize: sz,\n\t\t\t\t\t\thead,\n\t\t\t\t\t\tcol\n\t\t\t\t\t};\n\t\t\t\t\tthis.lines.push(b);\n\t\t\t\t\tthis.space.push(this.computeSpaceLine(b));\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// just one line, of whatever style was determined\n\t\t\t\tlet b:BLine =\n\t\t\t\t{\n\t\t\t\t\tbnum: n,\n\t\t\t\t\tbfr,\n\t\t\t\t\tbto,\n\t\t\t\t\ttype: ltype,\n\t\t\t\t\tline: new Line(xy1[0], xy1[1], xy2[0], xy2[1]),\n\t\t\t\t\tsize: sz,\n\t\t\t\t\thead,\n\t\t\t\t\tcol\n\t\t\t\t};\n\t\t\t\tthis.lines.push(b);\n\t\t\t\tthis.space.push(this.computeSpaceLine(b));\n\t\t\t}\n\t\t}\n\n\t\t// process double bonds in rings\n\t\tlet rings = this.orderedRingList();\n\t\tfor (let i = 0; i < rings.length; i++)\n\t\t{\n\t\t\tfor (let j = 0; j < rings[i].length; j++)\n\t\t\t{\n\t\t\t\tlet k = mol.findBond(rings[i][j], rings[i][j < rings[i].length - 1 ? j + 1 : 0]);\n\t\t\t\tif (bdbl[k - 1])\n\t\t\t\t{\n\t\t\t\t\tthis.processDoubleBond(k, rings[i]);\n\t\t\t\t\tbdbl[k - 1] = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// process all remaining double bonds\n\t\tfor (let i = 1; i <= mol.numBonds; i++) if (bdbl[i - 1]) this.processDoubleBond(i, this.priorityDoubleSubstit(i));\n\n\t\t// place hydrogen labels as explicit \"atom centres\"\n\t\tlet hcount = Vec.numberArray(0, mol.numAtoms);\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) hcount[n - 1] = /*!effects.showHydrogen ||*/ this.points[n - 1].text == null ? 0 : mol.atomHydrogens(n);\n\t\tfor (let n = 0; n < mol.numAtoms; n++) if (hcount[n] > 0 && this.placeHydrogen(n, hcount[n], true)) hcount[n] = 0;\n\t\tfor (let n = 0; n < mol.numAtoms; n++) if (hcount[n] > 0) this.placeHydrogen(n, hcount[n], false);\n\n\t\t// look for atoms with isotope labels, and place them\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (mol.atomIsotope(n) != Molecule.ISOTOPE_NATURAL)\n\t\t{\n\t\t\tlet isostr = mol.atomIsotope(n).toString();\n\t\t\tlet col = policy.data.atomCols[mol.atomicNumber(n)];\n\t\t\tthis.placeAdjunct(n, isostr, this.fontSizePix * 0.6, col, 150 * DEGRAD);\n\t\t}\n\n\t\t// do atomic charges/radical notation\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t{\n\t\t\tlet str = '';\n\t\t\tlet chg = this.atomCharge[n - 1];\n\t\t\tif (chg == -1) str = '-';\n\t\t\telse if (chg == 1) str = '+';\n\t\t\telse if (chg < -1) str = Math.abs(chg) + '-';\n\t\t\telse if (chg > 1) str = chg + '+';\n\t\t\tfor (let i = this.atomUnpaired[n - 1]; i > 0; i--) str += '.';\n\t\t\tif (str.length == 0) continue;\n\t\t\tlet col = policy.data.atomCols[mol.atomicNumber(n)];\n\t\t\tthis.placeAdjunct(n, str, str.length == 1 ? 0.8 * this.fontSizePix : 0.6 * this.fontSizePix, col, 30 * DEGRAD);\n\t\t}\n\n\t\t// add in any explicitly user-requested decorations\n\t\tfor (let n = 0; n < effects.atomDecoText.length; n++)\n\t\t{\n\t\t\tlet txt = effects.atomDecoText[n];\n\t\t\tif (!txt) continue;\n\t\t\tthis.annotateAtom(n + 1, txt, effects.atomDecoCol[n], effects.atomDecoSize[n] * this.scale * ArrangeMolecule.FONT_CORRECT);\n\t\t}\n\t\tfor (let n = 0; n < effects.bondDecoText.length; n++)\n\t\t{\n\t\t\tlet txt = effects.bondDecoText[n];\n\t\t\tif (!txt) continue;\n\t\t\tthis.annotateBond(n + 1, txt, effects.bondDecoCol[n], effects.bondDecoSize[n] * this.scale * ArrangeMolecule.FONT_CORRECT);\n\t\t}\n\n\t\t// atom circles need space reserved for them\n\t\tfor (let n = 0; n < Math.min(effects.atomCircleSz.length, mol.numAtoms); n++) if (effects.atomCircleSz[n] > 0)\n\t\t{\n\t\t\tlet dw = effects.atomCircleSz[n] * this.scale;\n\t\t\tlet a = this.points[n];\n\t\t\tlet box = new Box(a.oval.cx - dw, a.oval.cy - dw, 2 * dw, 2 * dw);\n\t\t\tlet spc:SpaceFiller =\n\t\t\t{\n\t\t\t\tanum: 0,\n\t\t\t\tbnum: 0,\n\t\t\t\tbox,\n\t\t\t\tpx: [box.minX(), box.maxX(), box.maxX(), box.minX()],\n\t\t\t\tpy: [box.minY(), box.minY(), box.maxY(), box.maxY()]\n\t\t\t};\n\t\t\tthis.space.push(spc);\n\t\t}\n\n\t\tif (this.artifacts != null)\n\t\t{\n\t\t\tfor (let path of this.artifacts.getResPaths())\n\t\t\t{\n\t\t\t\tthis.createCurvedPath(path.atoms, this.artifactFract.get(path), 0);\n\t\t\t\tthis.delocalisedAnnotation(path.atoms, this.artifactCharge.get(path), this.artifactUnpaired.get(path));\n\t\t\t}\n\t\t\tfor (let ring of this.artifacts.getResRings())\n\t\t\t{\n\t\t\t\tthis.createCircularRing(ring.atoms);\n\t\t\t\tthis.delocalisedAnnotation(ring.atoms, this.artifactCharge.get(ring), this.artifactUnpaired.get(ring));\n\t\t\t}\n\t\t\tfor (let arene of this.artifacts.getArenes())\n\t\t\t{\n\t\t\t\tlet isRing = arene.atoms.length > 2;\n\t\t\t\tif (isRing) for (let n = 0; n < arene.atoms.length; n++)\n\t\t\t\t{\n\t\t\t\t\tlet nn = n < arene.atoms.length - 1 ? n + 1 : 0;\n\t\t\t\t\tif (mol.findBond(arene.atoms[n], arene.atoms[nn]) == 0) {isRing = false; break;}\n\t\t\t\t}\n\t\t\t\tlet alkeneLike = arene.atoms.length == 2;\n\n\t\t\t\tthis.createBondCentroid(arene.centre, arene.atoms);\n\t\t\t\tif (!alkeneLike)\n\t\t\t\t{\n\t\t\t\t\tif (isRing) this.createCircularRing(arene.atoms); else this.createCurvedPath(arene.atoms, false, arene.centre);\n\t\t\t\t}\n\t\t\t\tthis.delocalisedAnnotation(arene.atoms, this.artifactCharge.get(arene), this.artifactUnpaired.get(arene));\n\t\t\t}\n\t\t}\n\n\t\t// perform a pseudo-embedding of the structure to resolve line-crossings\n/* ... to be done....\n\t\tPseudoEmbedding emb = new PseudoEmbedding(mol);\n\t\temb.calculateCrossings();\n\t\tfor (int n = 0; n < emb.numCrossings(); n++)\n\t\t{\n\t\t\tPseudoEmbedding.LineCrossing c = emb.getCrossing(n);\n\t\t\tif (c.higher == 1) resolveLineCrossings(c.bond1, c.bond2);\n\t\t\telse if (c.higher == 2) resolveLineCrossings(c.bond2, c.bond1);\n\t\t}*/\n\n\t\t// create polymer brackets\n\t\tlet polymers = new PolymerBlock(mol);\n\t\tfor (let id of polymers.getIDList()) this.processPolymerUnit(polymers.getUnit(id), polymers.getUnits());\n\t}\n\n   \t// access to atom information; it is valid to assume that {atomcentre}[N-1] matches {moleculeatom}[N], if N<=mol.numAtoms\n\tpublic numPoints():number {return this.points.length;}\n\tpublic getPoint(idx:number):APoint {return this.points[idx];}\n\tpublic getPoints():APoint[] {return this.points;}\n\n\t// access to bond information; it is _NOT_ valid to read anything into the indices; they do not correlate with bond numbers\n\tpublic numLines():number {return this.lines.length;}\n\tpublic getLine(idx:number):BLine {return this.lines[idx];}\n\tpublic getLines():BLine[] {return this.lines;}\n\n\t// access to extra ring/resonance information\n\tpublic numRings():number {return this.rings.length;}\n\tpublic getRing(idx:number):XRing {return this.rings[idx];}\n\tpublic getRings():XRing[] {return this.rings;}\n\tpublic numPaths():number {return this.paths.length;}\n\tpublic getPath(idx:number):XPath {return this.paths[idx];}\n\tpublic getPaths():XPath[] {return this.paths;}\n\n\t// access to space-fillers (useful for calculating bounding boxes)\n\tpublic numSpace():number {return this.space.length;}\n\tpublic getSpace(idx:number):SpaceFiller {return this.space[idx];}\n\tpublic getSpaces():SpaceFiller[] {return this.space;}\n\n\t// goes through all the objects and nudges them by the given offset\n\tpublic offsetEverything(dx:number, dy:number):void\n\t{\n\t\tfor (let a of this.points) a.oval.offsetBy(dx, dy);\n\t\tfor (let b of this.lines) b.line.offsetBy(dx, dy);\n\t\tfor (let r of this.rings)\n\t\t{\n\t\t\tr.cx += dx;\n\t\t\tr.cy += dy;\n\t\t}\n\t\tfor (let p of this.paths)\n\t\t{\n\t\t\tVec.addTo(p.px, dx);\n\t\t\tVec.addTo(p.py, dy);\n\t\t}\n\t\tfor (let spc of this.space)\n\t\t{\n\t\t\tspc.box.offsetBy(dx, dy);\n\t\t\tVec.addTo(spc.px, dx);\n\t\t\tVec.addTo(spc.py, dy);\n\t\t}\n\t}\n\n\t// ensure that the origin is at (0,0)\n\tpublic offsetOrigin():void\n\t{\n\t\tlet bounds = this.determineBoundary();\n\t\tif (bounds[0] != 0 || bounds[1] != 0) this.offsetEverything(-bounds[0], -bounds[1]);\n\t}\n\n\t// goes through all of the objects and scales them by the provided factor\n\tpublic scaleEverything(scaleBy:number):void\n\t{\n\t\tif (scaleBy == 1) return;\n\n\t\tthis.scale *= scaleBy;\n\t\tfor (let a of this.points)\n\t\t{\n\t\t\ta.oval.scaleBy(scaleBy);\n\t\t\ta.fsz *= scaleBy;\n\t\t}\n\t\tfor (let b of this.lines)\n\t\t{\n\t\t\tb.line.scaleBy(scaleBy);\n\t\t\tb.size *= scaleBy;\n\t\t\tb.head *= scaleBy;\n\t\t}\n\t\tfor (let r of this.rings)\n\t\t{\n\t\t\tr.cx *= scaleBy;\n\t\t\tr.cy *= scaleBy;\n\t\t\tr.rw *= scaleBy;\n\t\t\tr.rh *= scaleBy;\n\t\t\tr.size *= scaleBy;\n\t\t}\n\t\tfor (let p of this.paths)\n\t\t{\n\t\t\tVec.mulBy(p.px, scaleBy);\n\t\t\tVec.mulBy(p.py, scaleBy);\n\t\t\tp.size *= scaleBy;\n\t\t}\n\t\tfor (let spc of this.space)\n\t\t{\n\t\t\tspc.box.scaleBy(scaleBy);\n\t\t\tVec.mulBy(spc.px, scaleBy);\n\t\t\tVec.mulBy(spc.py, scaleBy);\n\t\t}\n\t}\n\n\t// goes through all of the primitives and works out {minX,minY,maxX,maxY}\n\tpublic determineBoundary(padding?:number):number[]\n\t{\n\t\tif (padding == null) padding = 0;\n\t\tif (this.space.length == 0) return [0, 0, 2 * padding, 2 * padding];\n\n\t\tlet bounds = Vec.numberArray(0, 4);\n\t\tlet spc = this.space[0];\n\t\tbounds[0] = spc.box.x;\n\t\tbounds[1] = spc.box.y;\n\t\tbounds[2] = spc.box.x + spc.box.w;\n\t\tbounds[3] = spc.box.y + spc.box.h;\n\n\t\tfor (let n = this.space.length - 1; n > 0; n--)\n\t\t{\n\t\t\tspc = this.space[n];\n\t\t\tbounds[0] = Math.min(bounds[0], spc.box.x);\n\t\t\tbounds[1] = Math.min(bounds[1], spc.box.y);\n\t\t\tbounds[2] = Math.max(bounds[2], spc.box.x + spc.box.w);\n\t\t\tbounds[3] = Math.max(bounds[3], spc.box.y + spc.box.h);\n\t\t}\n\n\t\t// !! factor in the boundary...\n\n\t\treturn bounds;\n\t}\n\tpublic determineBoundaryBox():Box\n\t{\n\t\tlet [x1, y1, x2, y2] = this.determineBoundary();\n\t\treturn new Box(x1, y1, x2 - x1, y2 - y1);\n\t}\n\n\t// convenience method: determines the boundaries of the arrangement, and makes sure that it all fits into the given\n\t// box; will be scaled down if necessary, but not scaled up\n\tpublic squeezeInto(x:number, y:number, w:number, h:number, padding?:number):void\n\t{\n\t\tif (padding != null && padding > 0)\n\t\t{\n\t\t\tx += padding;\n\t\t\ty += padding;\n\t\t\tw -= 2 * padding;\n\t\t\th -= 2 * padding;\n\t\t}\n\t\tlet bounds = this.determineBoundary(0);\n\t\tlet bw = bounds[2] - bounds[0], bh = bounds[3] - bounds[1];\n\t\tif (bw > w || bh > h)\n\t\t{\n\t\t\tlet downScale = 1;\n\t\t\tif (bw > w) downScale = w / bw;\n\t\t\tif (bh > h) downScale = Math.min(downScale, h / bh);\n\t\t\tthis.scaleEverything(downScale);\n\t\t\tVec.mulBy(bounds, downScale);\n\t\t}\n\t\tthis.offsetEverything(x - bounds[0] + 0.5 * (w - bounds[2] + bounds[0]), y - bounds[1] + 0.5 * (h - bounds[3] + bounds[1]));\n\t}\n\n\t// if either boundary is greater than the given width/height, scales the objects down so that it fits; the origin is at (0,0) and the\n\t// size is as big as it needs to be\n\tpublic limitBounds(w:number, h:number):void\n\t{\n\t\tlet bounds = this.determineBoundary(0);\n\t\tif (bounds[0] == bounds[2] && bounds[1] == bounds[3]) return;\n\n\t\tlet scale = Math.min(1, Math.min(w / (bounds[2] - bounds[0]), h / (bounds[3] - bounds[1])));\n\t\tthis.offsetEverything(-bounds[0], -bounds[1]);\n\t\tthis.scaleEverything(scale);\n\t}\n\n\t// converts all drawing objects to a single colour\n\tpublic monochromate(col:number):void\n\t{\n\t\tfor (let a of this.points) a.col = col;\n\t\tfor (let b of this.lines) b.col = col;\n\t}\n\n\t// for a specific location, returns a measure of how \"congested\" it is; lower values mean that the point is generally far away\n\t// from things\n\tpublic spatialCongestion(x:number, y:number, thresh?:number):number\n\t{\n\t\tif (thresh == null) thresh = 0.001;\n\t\tlet congest = 0;\n\t\tfor (let n = 0; n < this.points.length; n++)\n\t\t{\n\t\t\tlet a = this.points[n];\n\t\t\tif (a == null) continue;\n\t\t\tlet dx = a.oval.cx - x, dy = a.oval.cy - y;\n\t\t\tcongest += 1 / (dx * dx + dy * dy + thresh);\n\t\t}\n\t\treturn congest;\n\t}\n\n\t// makes a moderately deep copy: the layout metrics can be tinkered with, but not the core ingredients\n\tpublic clone():ArrangeMolecule\n\t{\n\t\tlet dup = new ArrangeMolecule(this.mol, this.measure, this.policy, this.effects);\n\t\tdup.scale = this.scale;\n\t\tdup.bondSepPix = this.bondSepPix;\n\t\tdup.lineSizePix = this.lineSizePix;\n\t\tdup.fontSizePix = this.fontSizePix;\n\t\tdup.ymul = this.ymul;\n\t\tfor (let a of this.points) dup.points.push(clone(a));\n\t\tfor (let b of this.lines) dup.lines.push(clone(b));\n\t\tfor (let s of this.space) dup.space.push(clone(s));\n\t\treturn dup;\n\t}\n\n\t// --------------------- private methods ---------------------\n\n\t// extract bond orders and other artifact-overriden content, and then overwrite them if an artifact applies\n\tprivate setupBondOrders():void\n\t{\n\t\tconst mol = this.mol;\n\n\t\tfor (let n = 0; n < mol.numBonds; n++) this.bondOrder[n] = mol.bondOrder(n + 1);\n\n\t\tfor (let n = 0; n < mol.numAtoms; n++)\n\t\t{\n\t\t\tthis.atomCharge[n] = mol.atomCharge(n + 1);\n\t\t\tthis.atomUnpaired[n] = mol.atomUnpaired(n + 1);\n\t\t}\n\n\t\tlet delocalise = (obj:any, atoms:number[]) =>\n\t\t{\n\t\t\t// move charge/unpaired off the atoms and into the resonance system\n\t\t\tlet charge = 0, unpaired = 0;\n\t\t\tfor (let a of atoms)\n\t\t\t{\n\t\t\t\tcharge += this.atomCharge[a - 1];\n\t\t\t\tunpaired += this.atomUnpaired[a - 1];\n\t\t\t\tthis.atomCharge[a - 1] = this.atomUnpaired[a - 1] = 0;\n\t\t\t}\n\t\t\tthis.artifactCharge.set(obj, charge);\n\t\t\tthis.artifactUnpaired.set(obj, unpaired);\n\n\t\t\t// any bonds sticking out of the resonance system are depicted as single lines\n\t\t\tfor (let a1 of atoms) for (let a2 of mol.atomAdjList(a1)) if (!atoms.includes(a2))\n\t\t\t{\n\t\t\t\tlet b = mol.findBond(a1, a2);\n\t\t\t\tif (this.bondOrder[b - 1] >= 0) this.bondOrder[b - 1] = 1;\n\t\t\t}\n\t\t};\n\n\t\t// any bond that's affected by an artifact gets set to single-order for rendering purposes\n\t\tif (this.artifacts == null) return;\n\n\t\tfor (let path of this.artifacts.getResPaths())\n\t\t{\n\t\t\t// figure out if the average bond order is less than 1 (using the original values)\n\t\t\tlet charge = 0, unpaired = 0, orders = 0;\n\t\t\tfor (let n = 0; n < path.atoms.length; n++)\n\t\t\t{\n\t\t\t\tcharge += mol.atomCharge(path.atoms[n]);\n\t\t\t\tunpaired += mol.atomUnpaired(path.atoms[n]);\n\t\t\t\tlet b = mol.findBond(path.atoms[n], path.atoms[n < path.atoms.length - 1 ? n + 1 : 0]);\n\t\t\t\tif (b > 0) orders += mol.bondOrder(b);\n\t\t\t}\n\t\t\tlet fractional = (2 * orders - charge + unpaired) / path.atoms.length < 1;\n\t\t\tthis.artifactFract.set(path, fractional);\n\n\t\t\tfor (let n = 0; n < path.atoms.length - 1; n++)\n\t\t\t{\n\t\t\t\tlet b = mol.findBond(path.atoms[n], path.atoms[n + 1]);\n\t\t\t\tif (b > 0) this.bondOrder[b - 1] = fractional ? -1 : 1;\n\t\t\t}\n\t\t\tdelocalise(path, path.atoms);\n\t\t}\n\t\tfor (let ring of this.artifacts.getResRings())\n\t\t{\n\t\t\tfor (let n = 0; n < ring.atoms.length; n++)\n\t\t\t{\n\t\t\t\tlet b = mol.findBond(ring.atoms[n], ring.atoms[n < ring.atoms.length - 1 ? n + 1 : 0]);\n\t\t\t\tif (b > 0) this.bondOrder[b - 1] = 1;\n\t\t\t}\n\t\t\tdelocalise(ring, ring.atoms);\n\t\t}\n\t\tfor (let arene of this.artifacts.getArenes())\n\t\t{\n\t\t\tlet alkeneLike = arene.atoms.length == 2;\n\n\t\t\tfor (let n = 0; n < arene.atoms.length; n++)\n\t\t\t{\n\t\t\t\tif (!alkeneLike)\n\t\t\t\t{\n\t\t\t\t\tlet b = mol.findBond(arene.atoms[n], arene.atoms[n < arene.atoms.length - 1 ? n + 1 : 0]);\n\t\t\t\t\tif (b > 0) this.bondOrder[b - 1] = 1;\n\t\t\t\t}\n\t\t\t\tlet b = mol.findBond(arene.centre, arene.atoms[n]);\n\t\t\t\tif (b > 0) this.bondOrder[b - 1] = -1;\n\t\t\t}\n\t\t\tdelocalise(arene, arene.atoms);\n\t\t}\n\t}\n\n\t// for a given adjunct to an atom, find a suitable position for it, based on the provided direction (angdir, radians);\n\t// the placement algorithm will try pretty hard to find a suitable position which is close to the parent atom, not\n\t// overlapping anything, and projected in the requested direction\n\tprivate placeAdjunct(atom:number, str:string, fsz:number, col:number, angdir:number):void\n\t{\n\t\tlet wad = this.measure.measureText(str, fsz);\n\t\tlet a = this.points[atom - 1];\n\t\tlet cx = a.oval.cx, cy = a.oval.cy, rw = 0.55 * wad[0], rh = 0.55 * wad[1];\n\n\t\t// special deal: carbenes with a zero bond\n\t\tif (str == '..')\n\t\t{\n\t\t\tlet zeroBonds = this.mol.atomAdjBonds(atom).filter((b) => this.mol.bondOrder(b) == 0);\n\t\t\tif (zeroBonds.length == 1)\n\t\t\t{\n\t\t\t\tlet zpt = this.getPoint(this.mol.bondOther(zeroBonds[0], atom) - 1);\n\t\t\t\tlet dx = zpt.oval.cx - cx, dy = zpt.oval.cy - cy, inv = 1 / norm_xy(dx, dy);\n\t\t\t\tlet r = fsz * 0.15;\n\t\t\t\tlet ox = dy * inv * 2.5 * r, oy = -dx * inv * 2.5 * r;\n\t\t\t\tlet ext = 1.2 * (rw + rh) * inv;\n\t\t\t\t[dx, dy] = [dx * ext, dy * ext];\n\n\t\t\t\tthis.points.push({anum: 0, text: '.', fsz, col, oval: new Oval(cx + dx + ox, cy + dy + oy, r, r)});\n\t\t\t\tthis.points.push({anum: 0, text: '.', fsz, col, oval: new Oval(cx + dx - ox, cy + dy - oy, r, r)});\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// begin the circular sweep\n\t\tlet bestScore = 0, bestDX = 0, bestDY = 0;\n\t\tlet px = Vec.numberArray(0, 4), py = Vec.numberArray(0, 4);\n\t\tlet angThresh = 10; // angular threshold for short-circuiting\n\t\tlet shorted = false;\n\t\tfor (let ext = 0.5 * (a.oval.rw + a.oval.rh); !shorted && ext < 1.5 * this.measure.scale(); ext += 0.1 * this.measure.scale())\n\t\t{\n\t\t\tconst DELTA = 5 * DEGRAD;\n\t\t\tfor (let d = 0; !shorted && d < Math.PI - 0.0001; d += DELTA) for (let s = -1; s <= 1; s += 2)\n\t\t\t{\n\t\t\t\tlet dang = d * s + (s > 0 ? DELTA : 0), ang = angdir + dang;\n\t\t\t\tlet dx = ext * Math.cos(ang), dy = ext * Math.sin(ang) * -this.ymul;\n\t\t\t\tlet x1 = cx + dx - rw, x2 = cx + dx + rw, y1 = cy + dy - rh, y2 = cy + dy + rh;\n\t\t\t\tpx[0] = x1; py[0] = y1;\n\t\t\t\tpx[1] = x2; py[1] = y1;\n\t\t\t\tpx[2] = x2; py[2] = y2;\n\t\t\t\tpx[3] = x1; py[3] = y2;\n\t\t\t\tlet viol = this.countPolyViolations(px, py, null, false);\n\t\t\t\tlet score = 10 * viol + Math.abs(dang) + 10 * ext;\n\n\t\t\t\tlet shortCircuit = viol == 0 && Math.abs(dang) < (angThresh + 1) * DEGRAD;\n\n\t\t\t\tif (bestScore == 0 || shortCircuit || score < bestScore)\n\t\t\t\t{\n\t\t\t\t\tbestScore = score;\n\t\t\t\t\tbestDX = dx;\n\t\t\t\t\tbestDY = dy;\n\t\t\t\t}\n\t\t\t\tif (shortCircuit) {shorted = true; break;}\n\t\t\t}\n\n\t\t\tangThresh += 5;\n\t\t}\n\n\t\t// create a point for it\n\t\ta =\n\t\t{\n\t\t\tanum: 0,\n\t\t\ttext: str,\n\t\t\tfsz,\n\t\t\tcol,\n\t\t\toval: new Oval(cx + bestDX, cy + bestDY, rw, rh)\n\t\t};\n\t\tthis.points.push(a);\n\n\t\t// create a square spacefiller\n\t\t// TODO: spacefiller should use the glyph rather than just a box...\n\t\tlet spc:SpaceFiller =\n\t\t{\n\t\t\tanum: 0,\n\t\t\tbnum: 0,\n\t\t\tbox: new Box(a.oval.cx - rw, a.oval.cy - rh, 2 * rw, 2 * rh),\n\t\t\tpx: [a.oval.cx - rw, a.oval.cx + rw, a.oval.cx + rw, a.oval.cx - rw],\n\t\t\tpy: [a.oval.cy - rh, a.oval.cy - rh, a.oval.cy + rh, a.oval.cy + rh]\n\t\t};\n\t\tthis.space.push(spc);\n\t}\n\n\t// deals with an atom symbol which is a label rather than an element/short token\n\tprivate processLabel(anum:number):void\n\t{\n\t\tlet ax = this.mol.atomX(anum), ay = this.mol.atomY(anum);\n\n\t\t// decide whether the label goes on the left, or the right, or is centred\n\t\tlet left = 0, right = 0;\n\t\tlet adj = this.mol.atomAdjList(anum);\n\t\tfor (let n = 0; n < adj.length; n++)\n\t\t{\n\t\t\tlet theta = Math.atan2(this.mol.atomY(adj[n]) - ay, this.mol.atomX(adj[n]) - ax) * RADDEG;\n\t\t\tif (theta >= -15 && theta <= 15) right += 3;\n\t\t\telse if (theta >= -85 && theta <= 85) right++;\n\t\t\telse if (theta > 85 && theta < 95) {} // orthogonal\n\t\t\telse if (theta < -85 && theta > -95) {} // orthogonal\n\t\t\telse if (theta > 165 || theta < -165) left += 3;\n\t\t\telse left++;\n\t\t}\n\n\t\tlet label = this.mol.atomElement(anum);\n\t\tlet ibar = label.indexOf('|'), ibrace = label.indexOf('{');\n\n\t\tlet side = 0;\n\t\tif (left == 0 && right == 0 && ibar < 0 && ibrace < 0) {} // stay in middle\n\t\telse if (left < right) side = -1;\n\t\telse if (right < left) side = 1;\n\t\telse\n\t\t{\n\t\t\t// pick based on congestion; notice the bias toward placing on the right\n\t\t\t// !! if (spatialCongestion(ax-1,ay)<0.5f*spatialCongestion(ax+1,ay)) side=-1; else side=1;\n\t\t\tlet score1 = CoordUtil.congestionPoint(this.mol, ax - 1, ay);\n\t\t\tlet score2 = CoordUtil.congestionPoint(this.mol, ax + 1, ay);\n\t\t\tif (score1 < 0.5 * score2) side = -1; else side = 1;\n\t\t}\n\n\t\t// break up the label, if special characters are being used, and measure each\n\t\tlet chunks:string[] = null;\n\t\tlet position:number[] = null;\n\t\tlet primary:boolean[] = null;\n\t\tlet refchunk = 0;\n\n\t\tif (ibar < 0 && ibrace < 0) // one piece: it's simple\n\t\t{\n\t\t\tif (side == 0) chunks = [label];\n\t\t\telse if (side < 0)\n\t\t\t{\n\t\t\t\tchunks = [label.substring(0, label.length - 1), label.substring(label.length - 1)];\n\t\t\t\trefchunk = 1;\n\t\t\t}\n\t\t\telse chunks = [label.substring(0, 1), label.substring(1)];\n\t\t}\n\t\telse // multiple pieces: split it up\n\t\t{\n\t\t\tlet bits:string[] = [];\n\t\t\tlet bpos:number[] = [];\n\t\t\tlet bpri:boolean[] = [];\n\n\t\t\tlet blocks:string[] = label.split('|');\n\t\t\tif (side < 0) blocks = Vec.reverse(blocks);\n\n\t\t\tlet buff = '';\n\t\t\tfor (let i = 0; i < blocks.length; i++)\n\t\t\t{\n\t\t\t\tlet isPrimary = (side >= 0 && i == 0) || (side < 0 && i == blocks.length - 1);\n\n\t\t\t\tif (side < 0 && refchunk == 0 && i == blocks.length - 1) refchunk = bits.length;\n\t\t\t\tlet pos = 0;\n\t\t\t\tbuff = '';\n\t\t\t\tfor (let j = 0; j < blocks[i].length; j++)\n\t\t\t\t{\n\t\t\t\t\tlet ch = blocks[i].charAt(j);\n\t\t\t\t\tif (ch == '{' || ch == '}')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (buff.length > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbits.push(buff.toString());\n\t\t\t\t\t\t\tbpos.push(pos);\n\t\t\t\t\t\t\tbpri.push(isPrimary);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbuff = '';\n\t\t\t\t\t\tpos = ch == '{' ? -1 : 0;\n\t\t\t\t\t}\n\t\t\t\t\t// NOTE: to do this, have to also protect the split by '|' part above...\n\t\t\t\t\t//else if (ch == '\\\\' && j < blocks[i].length() - 1) {buff.append(blocks[i].charAt(j + 1)); j++;}\n\t\t\t\t\telse if (ch == '^' && pos == -1 && buff.length == 0) pos = 1;\n\t\t\t\t\telse buff += ch;\n\t\t\t\t}\n\t\t\t\tif (buff.length > 0)\n\t\t\t\t{\n\t\t\t\t\tbits.push(buff.toString());\n\t\t\t\t\tbpos.push(pos);\n\t\t\t\t\tbpri.push(isPrimary);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tchunks = bits;\n\t\t\tposition = bpos;\n\t\t\tprimary = bpri;\n\n\t\t\t// in case it leads with sub/superscript\n\t\t\twhile (refchunk < chunks.length - 1 && position[refchunk] != 0) refchunk++;\n\t\t}\n\n\t\tlet PADDING = 1.1;\n\t\tlet SSFRACT = 0.6;\n\n\t\tlet chunkw = Vec.numberArray(0, chunks.length);\n\t\tlet tw = 0;\n\t\tfor (let n = 0; n < chunks.length; n++)\n\t\t{\n\t\t\tchunkw[n] = this.measure.measureText(chunks[n], this.fontSizePix)[0];\n\t\t\tif (position != null && position[n] != 0) chunkw[n] *= SSFRACT;\n\t\t\ttw += chunkw[n];\n\t\t}\n\n\t\tlet x = this.measure.angToX(ax), y = this.measure.angToY(ay);\n\t\tfor (let n = 0; n < refchunk; n++) x -= chunkw[n];\n\t\tx -= 0.5 * chunkw[refchunk];\n\n\t\tfor (let n = 0; n < chunks.length; n++)\n\t\t{\n\t\t\tlet a:APoint =\n\t\t\t{\n\t\t\t\tanum: (n == refchunk || (primary != null && primary[n])) ? anum : 0,\n\t\t\t\ttext: chunks[n],\n\t\t\t\tfsz: this.fontSizePix,\n\t\t\t\tcol: this.policy.data.atomCols[this.mol.atomicNumber(anum)],\n\t\t\t\toval: new Oval(x + 0.5 * chunkw[n], y, 0.5 * chunkw[n] * PADDING, 0.5 * this.fontSizePix * PADDING)\n\t\t\t};\n\n\t\t\tif (position != null && position[n] != 0)\n\t\t\t{\n\t\t\t\ta.fsz *= SSFRACT;\n\t\t\t\t//a.cy += a.fsz * 0.7f * (measure.yIsUp() ? -1 : 1);\n\n\t\t\t\tif (position[n] < 0)\n\t\t\t\t\ta.oval.cy += a.fsz * 0.7 * (this.measure.yIsUp() ? -1 : 1);\n\t\t\t\telse\n\t\t\t\t\ta.oval.cy -= a.fsz * 0.3 * (this.measure.yIsUp() ? -1 : 1);\n\t\t\t}\n\t\t\tif (n == refchunk)\n\t\t\t{\n\t\t\t\tthis.points[anum - 1] = a;\n\t\t\t\tthis.space[anum - 1] = this.computeSpacePoint(a);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.points.push(a);\n\t\t\t\tthis.space.push(this.computeSpacePoint(a));\n\t\t\t}\n\n\t\t\tx += chunkw[n];\n\t\t}\n\t}\n\n\t// given that the position (X,Y) connects with atom N, and is part of a bond that connects at the other end\n\t// with (FX,FY), considers the possibility that a new (X,Y) may need to be calculated by backing up along the line;\n\t// the return value is the fraction the it needs to backup, i.e. 1 = don't change, <1 = needs to be shorter\n\tprivate backOffAtom(atom:number, x:number, y:number, fx:number, fy:number, minDist:number):number\n\t{\n\t\tif (x == fx && y == fy) return 1; // can happen when really small\n\n\t\tlet dx = x - fx, dy = y - fy, dist = norm_xy(dx, dy), inv = 1.0 / dist;\n\t\tconst bump = 0.1 * this.measure.scale();\n\t\tlet xbump = x + 2 * bump * dx * inv, ybump = y + 2 * bump * dy * inv;\n\n\t\tlet ext = dist;\n\t\tlet active = false;\n\t\tfor (let spc of this.space) if (spc.anum == atom)\n\t\t{\n\t\t\tconst sz = spc.px.length;\n\t\t\tif (sz == 0) continue;\n\n\t\t\tfor (let n = 0; n < sz; n++)\n\t\t\t{\n\t\t\t\tlet nn = n < sz - 1 ? n + 1 : 0;\n\t\t\t\tlet x1 = spc.px[n], y1 = spc.py[n], x2 = spc.px[nn], y2 = spc.py[nn];\n\t\t\t\tif (!GeomUtil.doLineSegsIntersect(xbump, ybump, fx, fy, x1, y1, x2, y2)) continue;\n\t\t\t\tlet xy = GeomUtil.lineIntersect(x, y, fx, fy, x1, y1, x2, y2);\n\n\t\t\t\tactive = true;\n\t\t\t\text = Math.min(ext, norm_xy(xy[0] - fx, xy[1] - fy));\n\t\t\t}\n\t\t}\n\n\t\tif (active)\n\t\t{\n\t\t\text = Math.max(minDist, ext - bump);\n\t\t\treturn ext / dist;\n\t\t}\n\t\telse return 1;\n\t}\n\n\t// as above, except returns {reduced distance squared, dx, dy}\n\tprivate backOffAtomDelta(atom:number, x:number, y:number, fx:number, fy:number, minDist:number):number[]\n\t{\n\t\tlet ext = this.backOffAtom(atom, x, y, fx, fy, minDist);\n\t\tif (ext >= 1) return null;\n\t\text = 1 - ext;\n\t\tlet dx = (fx - x) * ext, dy = (fy - y) * ext;\n\t\treturn [norm2_xy(dx, dy), dx, dy];\n\t}\n\n\t// applies the impact of the back-off extent, calculated above; returns new coordinates for [x,y]\n\tprivate shrinkBond(x:number, y:number, fx:number, fy:number, ext:number):number[]\n\t{\n\t\tif (ext == 1) return [x, y];\n\t\tlet dx = x - fx, dy = y - fy;\n\t\treturn [fx + ext * dx, fy + ext * dy];\n\t}\n\n\t// for bond begin/end points, compares the current distance to the original distance, to make sure that it hasn't been\n\t// squished below a certain length, which tends to render badly\n\tprivate ensureMinimumBondLength(xy1:number[], xy2:number[], x1:number, y1:number, x2:number, y2:number, minDist:number):void\n\t{\n\t\tlet dx = xy2[0] - xy1[0], dy = xy2[1] - xy1[1];\n\t\tlet dsq = norm2_xy(dx, dy);\n\t\tminDist = Math.min(minDist, norm_xy(x2 - x1, y2 - y1));\n\t\tif (dsq >= sqr(minDist - 0.0001)) return;\n\n\t\t// scale the bond back up to its minimum size\n\t\tlet d12 = Math.sqrt(dsq), d1 = norm_xy(xy1[0] - x1, xy1[1] - y1), d2 = norm_xy(x2 - xy2[0], y2 - xy2[1]);\n\t\tlet mag = 1 - minDist / d12, invD12 = 1.0 / (d1 + d2), mag1 = d1 * mag * invD12, mag2 = d2 * mag * invD12;\n\t\txy1[0] -= dx * mag1;\n\t\txy1[1] -= dy * mag1;\n\t\txy2[0] += dx * mag2;\n\t\txy2[1] += dy * mag2;\n\t}\n\n\t// produces a list of small rings, ordered in a terminal-first manner, which is to be used as the sequence for assigning sides\n\t// of bond orders\n\tprivate orderedRingList():number[][]\n\t{\n\t\tlet rings:number[][] = [];\n\t\tlet SIZE_ORDER = [6, 5, 7, 4, 3];\n\t\tfor (let i = 0; i < SIZE_ORDER.length; i++)\n\t\t{\n\t\t\tlet nring = this.mol.findRingsOfSize(SIZE_ORDER[i]);\n\t\t\tfor (let j = 0; j < nring.length; j++) rings.push(nring[j]);\n\t\t}\n\t\tlet ringsz = rings.length;\n\n\t\t// for each atom add up the number of times it occurs in a small ring\n\t\tlet ringbusy = Vec.numberArray(0, this.mol.numAtoms);\n\t\tfor (let n = 0; n < ringsz; n++)\n\t\t{\n\t\t\tlet r = rings[n];\n\t\t\tfor (let i = 0; i < r.length; i++) ringbusy[r[i] - 1]++;\n\t\t}\n\n\t\t// score the rings by the sum of the busy quotient\n\t\tlet ringscore = Vec.numberArray(0, ringsz);\n\t\tfor (let n = 0; n < ringsz; n++)\n\t\t{\n\t\t\tlet r = rings[n];\n\t\t\tfor (let i = 0; i < r.length; i++) ringscore[n] += ringbusy[r[i] - 1];\n\t\t}\n\t\tlet ringorder = Vec.idxSort(ringscore);\n\n\t\t// count the number of double bonds in each ring, and use this to override the primary sort order (most=first)\n\t\tlet resbcount = Vec.numberArray(0, ringsz), maxbcount = 0;\n\t\tfor (let n = 0; n < ringsz; n++)\n\t\t{\n\t\t\tlet r = rings[ringorder[n]];\n\t\t\tfor (let i = 0; i < r.length; i++)\n\t\t\t{\n\t\t\t\tlet j = this.mol.findBond(r[i], r[i + 1 < r.length ? i + 1 : 0]);\n\t\t\t\tif (this.mol.bondOrder(j) == 2) resbcount[n]++;\n\t\t\t}\n\t\t\tmaxbcount = Math.max(maxbcount, resbcount[n]);\n\t\t}\n\n\t\tlet pos = 0, ret:number[][] = [];\n\t\tfor (let sz = maxbcount; sz >= 0; sz--)\n\t\t{\n\t\t\tfor (let n = 0; n < ringsz; n++) if (resbcount[n] == sz) ret.push(rings[ringorder[n]]);\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\t// convenience function which returns {ox,oy} which is orthogonal to the direction of the input vector, of magnitude D; the\n\t// direction of {ox,oy} is to the \"left\" of the input vector\n\tprivate orthogonalDelta(x1:number, y1:number, x2:number, y2:number, d:number):number[]\n\t{\n\t\tlet ox = y1 - y2, oy = x2 - x1, dsq = norm2_xy(ox, oy);\n\t\tlet sc = dsq > 0 ? d / Math.sqrt(dsq) : 1;\n\t\treturn [ox * sc, oy * sc];\n\t}\n\n\t// given the guideline index of a double bond, and some information about the atoms which are on the \"important side\", creates\n\t// the appropriate line segments\n\tprivate processDoubleBond(idx:number, priority:number[]):void\n\t{\n\t\tlet bfr = this.mol.bondFrom(idx), bto = this.mol.bondTo(idx);\n\t\tlet nfr = this.mol.atomAdjList(bfr), nto = this.mol.atomAdjList(bto);\n\n\t\tlet a1 = this.points[bfr - 1], a2 = this.points[bto - 1];\n\t\tlet x1 = a1.oval.cx, y1 = a1.oval.cy, x2 = a2.oval.cx, y2 = a2.oval.cy;\n\t\tlet oxy = this.orthogonalDelta(x1, y1, x2, y2, this.bondSepPix);\n\n\t\tconst minDist = MINBOND_EXOTIC * this.measure.scale();\n\t\tlet dx = x2 - x1, dy = y2 - y1, btheta = Math.atan2(dy, dx);\n\n\t\t// count number of priority atoms on either side of the bond vector\n\t\tlet countFLeft = 0, countFRight = 0, countTLeft = 0, countTRight = 0;\n\t\tlet idxFLeft = 0, idxFRight = 0, idxTLeft = 0, idxTRight = 0;\n\t\tlet noshift = false; // true if definitely not alkene-ish\n\t\tfor (let n = 0; n < nfr.length; n++) if (nfr[n] != bto)\n\t\t{\n\t\t\tlet bo = this.mol.bondOrder(this.mol.findBond(bfr, nfr[n]));\n\t\t\tif (bo == 0) continue;\n\t\t\tif (bo > 1) {noshift = true; break;}\n\n\t\t\tlet ispri = false;\n\t\t\tfor (let i = 0; i < (priority == null ? 0 : priority.length); i++) if (priority[i] == nfr[n]) ispri = true;\n\n\t\t\tlet theta = angleDiff(Math.atan2(this.points[nfr[n] - 1].oval.cy - y1, this.points[nfr[n] - 1].oval.cx - x1), btheta);\n\t\t\tif (Math.abs(theta) * RADDEG > 175) {noshift = true; break;} // linear\n\n\t\t\tif (theta > 0)\n\t\t\t{\n\t\t\t\tif (ispri) countFLeft++;\n\t\t\t\tidxFLeft = nfr[n];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (ispri) countFRight++;\n\t\t\t\tidxFRight = nfr[n];\n\t\t\t}\n\t\t}\n\t\tfor (let n = 0; n < nto.length; n++) if (nto[n] != bfr)\n\t\t{\n\t\t\tlet bo = this.mol.bondOrder(this.mol.findBond(bto, nto[n]));\n\t\t\tif (bo == 0) continue;\n\t\t\tif (bo > 1) {noshift = true; break;}\n\n\t\t\tlet ispri = false;\n\t\t\tfor (let i = 0; i < (priority == null ? 0 : priority.length); i++) if (priority[i] == nto[n]) ispri = true;\n\n\t\t\tlet theta = angleDiff(Math.atan2(this.points[nto[n] - 1].oval.cy - y2, this.points[nto[n] - 1].oval.cx - x2), btheta);\n\t\t\tif (Math.abs(theta) * RADDEG > 175) {noshift = true; break;} // linear\n\n\t\t\tif (theta > 0)\n\t\t\t{\n\t\t\t\tif (ispri) countTLeft++;\n\t\t\t\tidxTLeft = nto[n];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (ispri) countTRight++;\n\t\t\t\tidxTRight = nto[n];\n\t\t\t}\n\t\t}\n\n\t\t// decide which side the bond should be shifted to, if either\n\t\tlet side = 0;\n\t\tif (noshift || countFLeft > 1 || countFRight > 1 || countTLeft > 1 || countTRight > 1) {} // inappropriate\n\t\telse if (countFLeft > 0 && countFRight > 0) {} // ambiguous\n\t\telse if (countTLeft > 0 && countTRight > 0) {} // ambiguous\n\t\telse if (countFLeft > 0 || countTLeft > 0) side = 1; // left\n\t\telse if (countFRight > 0 || countTRight > 0) side = -1; // right\n\n\t\t// create the bond lines\n\n\t\tlet sz = this.lineSizePix;\n\t\tlet ax1 = x1, ay1 = y1, ax2 = x2, ay2 = y2;\n\t\tlet bx1 = 0, by1 = 0, bx2 = 0, by2 = 0;\n\n\t\t// side==0 means that the double bond straddles the line between the two points; !=0 means that the first line (A) is like a\n\t\t// regular single bond, while the second line is an adjunct off to one side\n\t\tif (side == 0)\n\t\t{\n\t\t\tax1 = x1 + 0.5 * oxy[0]; ay1 = y1 + 0.5 * oxy[1];\n\t\t\tax2 = x2 + 0.5 * oxy[0]; ay2 = y2 + 0.5 * oxy[1];\n\t\t\tbx1 = x1 - 0.5 * oxy[0]; by1 = y1 - 0.5 * oxy[1];\n\t\t\tbx2 = x2 - 0.5 * oxy[0]; by2 = y2 - 0.5 * oxy[1];\n\t\t}\n\t\telse if (side > 0)\n\t\t{\n\t\t\tbx1 = x1 + oxy[0]; by1 = y1 + oxy[1];\n\t\t\tbx2 = x2 + oxy[0]; by2 = y2 + oxy[1];\n\t\t\tif (nfr.length > 1 && this.points[bfr - 1].text == null) {bx1 += oxy[1]; by1 -= oxy[0];}\n\t\t\tif (nto.length > 1 && this.points[bto - 1].text == null) {bx2 -= oxy[1]; by2 += oxy[0];}\n\t\t}\n\t\telse if (side < 0)\n\t\t{\n\t\t\tbx1 = x1 - oxy[0]; by1 = y1 - oxy[1];\n\t\t\tbx2 = x2 - oxy[0]; by2 = y2 - oxy[1];\n\t\t\tif (nfr.length > 1 && this.points[bfr - 1].text == null) {bx1 += oxy[1]; by1 -= oxy[0];}\n\t\t\tif (nto.length > 1 && this.points[bto - 1].text == null) {bx2 -= oxy[1]; by2 += oxy[0];}\n\t\t}\n\n\t\t// if there's shifting happening, check to see if either end has a terminal heteroatom\n\t\tif (side != 0)\n\t\t{\n\t\t\tif (this.mol.atomElement(bfr).length <= 2 && this.mol.atomAdjCount(bfr) == 1 && this.points[bfr - 1].text != null)\n\t\t\t{\n\t\t\t\tthis.bumpAtomPosition(bfr, 0.5 * oxy[0] * side, 0.5 * oxy[1] * side);\n\t\t\t}\n\t\t\tif (this.mol.atomElement(bto).length <= 2 && this.mol.atomAdjCount(bto) == 1 && this.points[bto - 1].text != null)\n\t\t\t{\n\t\t\t\tthis.bumpAtomPosition(bto, 0.5 * oxy[0] * side, 0.5 * oxy[1] * side);\n\t\t\t}\n\t\t}\n\n\t\t// see if either of the lines approaches too close to something and, if so, back them both off by the same extent\n\t\tlet delta1 = this.backOffAtomDelta(bfr, ax1, ay1, ax2, ay2, minDist), delta2 = this.backOffAtomDelta(bfr, bx1, by1, bx2, by2, minDist);\n\t\tif (delta1 != null || delta2 != null)\n\t\t{\n\t\t\tlet delta = (delta1 == null ? 0 : delta1[0]) > (delta2 == null ? 0 : delta2[0]) ? delta1 : delta2;\n\t\t\tax1 += delta[1];\n\t\t\tay1 += delta[2];\n\t\t\tbx1 += delta[1];\n\t\t\tby1 += delta[2];\n\t\t}\n\t\tlet delta3 = this.backOffAtomDelta(bto, ax2, ay2, ax1, ay1, minDist), delta4 = this.backOffAtomDelta(bto, bx2, by2, bx1, by1, minDist);\n\t\tif (delta3 != null || delta4 != null)\n\t\t{\n\t\t\tlet delta = (delta3 == null ? 0 : delta3[0]) > (delta4 == null ? 0 : delta4[0]) ? delta3 : delta4;\n\t\t\tax2 += delta[1];\n\t\t\tay2 += delta[2];\n\t\t\tbx2 += delta[1];\n\t\t\tby2 += delta[2];\n\t\t}\n\n\t\t// if both sides are evenly balanced, want to make the double bonds intersect with their adjacent bonds\n\t\tif (side == 0 && !noshift)\n\t\t{\n\t\t\tlet xy:number[] = null;\n\t\t\tif (this.points[bfr - 1].text == null && !this.mol.bondInRing(idx))\n\t\t\t{\n\t\t\t\txy = this.adjustBondPosition(idxFLeft, bfr, ax1, ay1, ax2, ay2);\n\t\t\t\tif (xy != null) {ax1 = xy[0]; ay1 = xy[1];}\n\t\t\t\txy = this.adjustBondPosition(idxFRight, bfr, bx1, by1, bx2, by2);\n\t\t\t\tif (xy != null) {bx1 = xy[0]; by1 = xy[1];}\n\t\t\t}\n\t\t\tif (this.points[bto - 1].text == null && !this.mol.bondInRing(idx))\n\t\t\t{\n\t\t\t\txy = this.adjustBondPosition(idxTLeft, bto, ax2, ay2, ax1, ay1);\n\t\t\t\tif (xy != null) {ax2 = xy[0]; ay2 = xy[1];}\n\t\t\t\txy = this.adjustBondPosition(idxTRight, bto, bx2, by2, bx1, by1);\n\t\t\t\tif (xy != null) {bx2 = xy[0]; by2 = xy[1];}\n\t\t\t}\n\t\t}\n\n\t\tlet lt = this.mol.bondType(idx) == Molecule.BONDTYPE_UNKNOWN ? BLineType.Unknown : BLineType.Normal;\n\t\tlet head = lt == BLineType.Unknown ? 0.1 * this.scale : 0;\n\t\tlet col = this.effects.colBond[idx];\n\t\tif (!col) col = this.policy.data.foreground;\n\n\t\tlet b1:BLine =\n\t\t{\n\t\t\tbnum: idx,\n\t\t\tbfr,\n\t\t\tbto,\n\t\t\ttype: lt,\n\t\t\tline: new Line(ax1, ay1, ax2, ay2),\n\t\t\tsize: sz,\n\t\t\thead,\n\t\t\tcol\n\t\t};\n\t\tlet b2:BLine =\n\t\t{\n\t\t\tbnum: idx,\n\t\t\tbfr,\n\t\t\tbto,\n\t\t\ttype: lt,\n\t\t\tline: new Line(bx1, by1, bx2, by2),\n\t\t\tsize: sz,\n\t\t\thead,\n\t\t\tcol\n\t\t};\n\n\t\tthis.lines.push(b1);\n\t\tthis.lines.push(b2);\n\t\tthis.space.push(this.computeSpaceLine(b1));\n\t\tthis.space.push(this.computeSpaceLine(b2));\n\t}\n\n\t// for a point index (0-based), attempt to place some number of hydrogen atoms as a label (H, H2, H3, etc.); if the fussy\n\t// parameter is set, will insist on placing it in one of the 4 axial directions, starting with the atom's default preference;\n\t// will return false if this cannot be accomplished without stepping on something; if fussy is not enabled, will just try to\n\t// get it as close as possible\n\tprivate placeHydrogen(idx:number, hcount:number, fussy:boolean):boolean\n\t{\n\t\tlet font = FontData.main;\n\t\tconst SSFRACT = 0.6;\n\t\tconst GLYPH_H = font.getIndex('H');\n\n\t\tlet a = this.points[idx];\n\t\tlet emscale = a.fsz * font.INV_UNITS_PER_EM;\n\t\tlet sub = hcount >= 2 ? hcount.toString() : '';\n\n\t\t// create polygonal outline: start with the precomputed convex hull of the letter 'H', then grow as necessary\n\t\tlet outlineX = font.getOutlineX(GLYPH_H), outlineY = font.getOutlineY(GLYPH_H);\n\n\t\tlet firstEMW = font.HORIZ_ADV_X[GLYPH_H], emw = firstEMW;\n\t\tfor (let n = 0; n < sub.length; n++)\n\t\t{\n\t\t\tlet ch = sub.charAt(n), g = font.getIndex(ch);\n\t\t\tif (n == 0)\n\t\t\t{\n\t\t\t\temw += font.getKerning('H', ch);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet chp = sub.charAt(n - 1);\n\t\t\t\temw += font.getKerning(chp, ch) * SSFRACT;\n\t\t\t}\n\n\t\t\tlet extraX = font.getOutlineX(g), extraY = font.getOutlineY(g);\n\t\t\tVec.addTo(extraX, emw / SSFRACT);\n\t\t\tVec.addTo(extraY, (SSFRACT - 1) * font.ASCENT * 1.30);\n\t\t\tVec.mulBy(extraX, SSFRACT);\n\t\t\tVec.mulBy(extraY, SSFRACT);\n\t\t\toutlineX = outlineX.concat(extraX);\n\t\t\toutlineY = outlineY.concat(extraY);\n\t\t\temw += font.HORIZ_ADV_X[g] * SSFRACT;\n\t\t}\n\n\t\t// if multiple, take the convex hull of all of the above\n\t\tif (sub.length > 0)\n\t\t{\n\t\t\tlet qh = new QuickHull(outlineX, outlineY, 0);\n\t\t\toutlineX = qh.hullX;\n\t\t\toutlineY = qh.hullY;\n\t\t}\n\n\t\t// transform the outline into the right position\n\t\tlet emdx = -0.5 * firstEMW, emdy = 0.5 * font.ASCENT * font.ASCENT_FUDGE;\n\t\tfor (let n = 0; n < outlineX.length; n++)\n\t\t{\n\t\t\toutlineX[n] = a.oval.cx + (emdx + outlineX[n]) * emscale;\n\t\t\toutlineY[n] = a.oval.cy + (emdy - outlineY[n]) * emscale * this.ymul;\n\t\t}\n\n\t\t// for the \"fussy\" cases, only attempt the 4 axis-oriented directions\n\t\tlet dx = 0, dy = 0;\n\t\tlet srcWAD = this.measure.measureText(a.text, a.fsz);\n\t\tif (fussy)\n\t\t{\n\t\t\t// decide on the order: {0,1,2,3} is right,left,up,down; but priority can vary\n\t\t\tlet RIGHTLEFT = [0, 1, 2, 3];\n\t\t\tlet LEFTRIGHT = [1, 0, 2, 3];\n\t\t\tlet UPDOWN = [2, 3, 0, 1];\n\t\t\tlet DOWNUP = [3, 2, 0, 1];\n\t\t\tlet quad = RIGHTLEFT, adj = this.mol.atomAdjList(a.anum);\n\n\t\t\tif (adj.length == 0)\n\t\t\t{\n\t\t\t\tlet LEFTIES = ['O', 'S', 'F', 'Cl', 'Br', 'I'];\n\t\t\t\tif (this.mol.atomCharge(a.anum) == 0 && this.mol.atomUnpaired(a.anum) == 0 &&\n\t\t\t\t\tLEFTIES.indexOf(this.mol.atomElement(a.anum)) >= 0) quad = LEFTRIGHT; // e.g. H2O, H2S\n\t\t\t\telse quad = RIGHTLEFT; // e.g. NH3, -OH\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet allLeft = true, allRight = true, allUp = true, allDown = true;\n\t\t\t\tconst ax = this.mol.atomX(a.anum), ay = this.mol.atomY(a.anum);\n\t\t\t\tfor (let n = 0; n < adj.length; n++)\n\t\t\t\t{\n\t\t\t\t\tconst bx = this.mol.atomX(adj[n]), by = this.mol.atomY(adj[n]);\n\t\t\t\t\tif (bx > ax + 0.01) allLeft = false;\n\t\t\t\t\tif (bx < ax - 0.01) allRight = false;\n\t\t\t\t\tif (by < ay - 0.01) allUp = false;\n\t\t\t\t\tif (by > ay + 0.01) allDown = false;\n\t\t\t\t}\n\t\t\t\tif (allLeft) {}\n\t\t\t\telse if (allRight) quad = LEFTRIGHT;\n\t\t\t\telse if (allUp) quad = DOWNUP;\n\t\t\t\telse if (allDown) quad = UPDOWN;\n\t\t\t}\n\t\t\tfor (let n = 0; n < 4; n++)\n\t\t\t{\n\t\t\t\tlet tx = 0, ty = 0;\n\t\t\t\tif (quad[n] == 0) tx = 0.5 * srcWAD[0] + 0.5 * firstEMW * emscale; // right\n\t\t\t\telse if (quad[n] == 1) tx = -0.5 * srcWAD[0] - (emw - 0.5 * firstEMW) * emscale; // left\n\t\t\t\telse if (quad[n] == 2) ty = (1.1 * srcWAD[1] + 0.5 * srcWAD[2]) * -this.ymul; // up\n\t\t\t\telse if (quad[n] == 3) ty = (1.1 * srcWAD[1] + 0.5 * srcWAD[2]) * this.ymul; // down\n\n\t\t\t\t// if it can be placed without overlap, we'll take it\n\t\t\t\tVec.addTo(outlineX, tx);\n\t\t\t\tVec.addTo(outlineY, ty);\n\t\t\t\tlet viol = this.countPolyViolations(outlineX, outlineY, null, true);\n\t\t\t\tVec.addTo(outlineX, -tx);\n\t\t\t\tVec.addTo(outlineY, -ty);\n\n\t\t\t\tif (viol == 0)\n\t\t\t\t{\n\t\t\t\t\tdx = tx;\n\t\t\t\t\tdy = ty;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (dx == 0 && dy == 0) return false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// for this one, we need a version of the outline polygon that's slightly bigger so it's not adjacent\n\t\t\tconst mx1 = Vec.min(outlineY), mx2 = Vec.max(outlineX), my1 = Vec.min(outlineY), my2 = Vec.max(outlineY), cx = 0.5 * (mx1 + mx2), cy = 0.5 * (my1 + my2);\n\t\t\tconst mag = 1 + this.measure.scale() * this.policy.data.fontSize * ArrangeMolecule.FONT_CORRECT * 0.1 / Math.max(mx2 - cx, my2 - cy);\n\t\t\tconst psz = outlineX.length;\n\n\t\t\tlet magPX = outlineX.slice(0), magPY = outlineY.slice(0);\n\t\t\tfor (let n = 0; n < psz; n++)\n\t\t\t{\n\t\t\t\tmagPX[n] = (magPX[n] - cx) * mag + cx;\n\t\t\t\tmagPY[n] = (magPY[n] - cy) * mag + cy;\n\t\t\t}\n\n\t\t\t// do a circular sweep, with an extending radius; if at any extension there's a non-overlapping\n\t\t\tlet bestScore = 0, bestExt = 0, bestAng = 0;\n\t\t\tfor (let ext = 0.5 * (a.oval.rw + a.oval.rh); ext < 1.5 * this.measure.scale(); ext += 0.1 * this.measure.scale())\n\t\t\t{\n\t\t\t\tlet anyNoClash = false;\n\n\t\t\t\tfor (let ang = 0; ang < 2 * Math.PI; ang += 5 * DEGRAD)\n\t\t\t\t{\n\t\t\t\t\tlet tx = ext * Math.cos(ang), ty = ext * Math.sin(ang);\n\t\t\t\t\tVec.addTo(magPX, tx);\n\t\t\t\t\tVec.addTo(magPY, ty);\n\t\t\t\t\tlet viol = this.countPolyViolations(magPX, magPY, null, false);\n\t\t\t\t\tVec.addTo(magPX, -tx);\n\t\t\t\t\tVec.addTo(magPY, -ty);\n\t\t\t\t\tif (viol == 0) anyNoClash = true;\n\t\t\t\t\tlet score = 10 * viol + this.spatialCongestion(a.oval.cx + tx, a.oval.cy + ty, 0.5) + 2 * ext;\n\t\t\t\t\tif (bestScore == 0 || score < bestScore)\n\t\t\t\t\t{\n\t\t\t\t\t\tbestScore = score;\n\t\t\t\t\t\tbestExt = ext;\n\t\t\t\t\t\tbestAng = ang;\n\t\t\t\t\t\tdx = tx;\n\t\t\t\t\t\tdy = ty;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (anyNoClash) break;\n\t\t\t}\n\t\t}\n\n\t\t// apply the result\n\t\tlet wad = this.measure.measureText('H', a.fsz);\n\t\tconst PADDING = 1.1;\n\t\tlet ah:APoint =\n\t\t{\n\t\t\tanum: 0,\n\t\t\ttext: 'H',\n\t\t\tfsz: a.fsz,\n\t\t\tcol: a.col,\n\t\t\toval: new Oval(a.oval.cx + dx, a.oval.cy + dy, 0.5 * wad[0] * PADDING, 0.5 * wad[1] * PADDING)\n\t\t};\n\t\tthis.points.push(ah);\n\n\t\tif (sub.length > 0)\n\t\t{\n\t\t\tconst subFsz = SSFRACT * a.fsz;\n\t\t\twad = this.measure.measureText(sub, subFsz);\n\t\t\tlet an:APoint =\n\t\t\t{\n\t\t\t\tanum: 0,\n\t\t\t\ttext: sub,\n\t\t\t\tfsz: subFsz,\n\t\t\t\tcol: a.col,\n\t\t\t\toval: new Oval(ah.oval.cx + 0.5 * firstEMW * a.fsz * font.INV_UNITS_PER_EM + 0.5 * wad[0],\n\t\t\t\t\t\t\t\t ah.oval.cy + (1 - SSFRACT) * a.fsz, 0.5 * wad[0] * PADDING, 0.5 * wad[1] * PADDING)\n\t\t\t};\n\t\t\tthis.points.push(an);\n\t\t}\n\n\t\t// the space-filler is for the H and its label\n\t\tVec.addTo(outlineX, dx);\n\t\tVec.addTo(outlineY, dy);\n\t\tlet minX = Vec.min(outlineX), minY = Vec.min(outlineY);\n\t\tlet spc:SpaceFiller =\n\t\t{\n\t\t\tanum: 0,\n\t\t\tbnum: 0,\n\t\t\tbox: new Box(minX, minY, Vec.max(outlineX) - minX, Vec.max(outlineY) - minY),\n\t\t\tpx: outlineX,\n\t\t\tpy: outlineY\n\t\t};\n\t\tthis.space.push(spc);\n\n\t\treturn true;\n\t}\n\n\t// creates a \"space filling\" outline for a point, which provides sufficient detail to maneuvre other objects around it\n\tprivate computeSpacePoint(a:APoint):SpaceFiller\n\t{\n\t\tlet s:SpaceFiller =\n\t\t{\n\t\t\tanum: a.anum,\n\t\t\tbnum: 0,\n\t\t\tbox: new Box(),\n\t\t\tpx: [],\n\t\t\tpy: []\n\t\t};\n\n\t\tconst font = FontData.main;\n\t\tlet outlineX:number[] = [], outlineY:number[] = [];\n\t\tlet emw = 0, nglyphs = 0;\n\t\tif (a.text != null)\n\t\t{\n\t\t\tfor (let n = 0; n < a.text.length; n++)\n\t\t\t{\n\t\t\t\tlet ch1 = a.text.charAt(n);\n\t\t\t\tlet i = font.getIndex(ch1);\n\t\t\t\tif (i >= 0)\n\t\t\t\t{\n\t\t\t\t\tif (emw == 0)\n\t\t\t\t\t{\n\t\t\t\t\t\toutlineX = font.getOutlineX(i);\n\t\t\t\t\t\toutlineY = font.getOutlineY(i);\n\t\t\t\t\t\tnglyphs = 1;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tlet extraX = font.getOutlineX(i), extraY = font.getOutlineY(i);\n\t\t\t\t\t\tif (extraX.length > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tVec.addTo(extraX, emw);\n\t\t\t\t\t\t\toutlineX = outlineX.concat(extraX);\n\t\t\t\t\t\t\toutlineY = outlineY.concat(extraY);\n\t\t\t\t\t\t\tnglyphs++;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\temw += font.HORIZ_ADV_X[i];\n\t\t\t\t}\n\t\t\t\telse emw += font.MISSING_HORZ;\n\n\t\t\t\tif (n < a.text.length - 1)\n\t\t\t\t{\n\t\t\t\t\tlet ch2 = a.text.charAt(n + 1);\n\t\t\t\t\temw += font.getKerning(ch1, ch2);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (outlineX.length > 0)\n\t\t{\n\t\t\tif (nglyphs > 1)\n\t\t\t{\n\t\t\t\tlet qh = new QuickHull(outlineX, outlineY, 0);\n\t\t\t\toutlineX = qh.hullX;\n\t\t\t\toutlineY = qh.hullY;\n\t\t\t}\n\n\t\t\tlet emdx = -0.5 * emw, emdy = 0.5 * font.ASCENT * font.ASCENT_FUDGE;\n\t\t\tlet emscale = a.fsz * font.INV_UNITS_PER_EM;\n\t\t\tfor (let n = 0; n < outlineX.length; n++)\n\t\t\t{\n\t\t\t\toutlineX[n] = a.oval.cx + (emdx + outlineX[n]) * emscale;\n\t\t\t\toutlineY[n] = a.oval.cy + (emdy - outlineY[n]) * emscale * this.ymul;\n\t\t\t}\n\n\t\t\ts.px = outlineX;\n\t\t\ts.py = outlineY;\n\t\t\tlet minX = Vec.min(outlineX), minY = Vec.min(outlineY);\n\t\t\ts.box = new Box(minX, minY, Vec.max(outlineX) - minX, Vec.max(outlineY) - minY);\n\t\t}\n\t\telse\n\t\t{\n\t\t\ts.box = Box.fromOval(a.oval);\n\t\t\tif (s.box.w > 0 && s.box.h > 0)\n\t\t\t{\n\t\t\t\ts.px = [s.box.minX(), s.box.maxX(), s.box.maxX(), s.box.minX()];\n\t\t\t\ts.py = [s.box.minY(), s.box.minY(), s.box.maxY(), s.box.maxY()];\n\t\t\t}\n\t\t}\n\n\t\treturn s;\n\t}\n\n\t// creates a \"space filling\" outline for a line, which may end up being described as a line segment or a polygon\n\tprivate computeSpaceLine(b:BLine):SpaceFiller\n\t{\n\t\tlet s:SpaceFiller =\n\t\t{\n\t\t\tanum: 0,\n\t\t\tbnum: b.bnum,\n\t\t\tbox: new Box(),\n\t\t\tpx: [],\n\t\t\tpy: []\n\t\t};\n\t\tif (b.type == BLineType.Normal || b.type == BLineType.Dotted || b.type == BLineType.DotDir)\n\t\t{\n\t\t\t// line segment\n\t\t\ts.px = [b.line.x1, b.line.x2];\n\t\t\ts.py = [b.line.y1, b.line.y2];\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// create a wedge of fat-body outline\n\t\t\tconst dx = b.line.x2 - b.line.x1, dy = b.line.y2 - b.line.y1;\n\t\t\tconst norm = b.head / Math.sqrt(dx * dx + dy * dy);\n\t\t\tconst ox = norm * dy, oy = -norm * dx;\n\n\t\t\tif (b.type == BLineType.Unknown)\n\t\t\t{\n\t\t\t\ts.px = [b.line.x1 + ox, b.line.x1 - ox, b.line.x2 - ox, b.line.x2 + ox];\n\t\t\t\ts.py = [b.line.y1 + oy, b.line.y1 - oy, b.line.y2 - oy, b.line.y2 + oy];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ts.px = [b.line.x1, b.line.x2 - ox, b.line.x2 + ox];\n\t\t\t\ts.py = [b.line.y1, b.line.y2 - oy, b.line.y2 + oy];\n\t\t\t}\n\t\t}\n\n\t\ts.box.x = Vec.min(s.px) - b.size;\n\t\ts.box.y = Vec.min(s.py) - b.size;\n\t\ts.box.w = Vec.max(s.px) - s.box.x + b.size;\n\t\ts.box.h = Vec.max(s.py) - s.box.y + b.size;\n\t\treturn s;\n\t}\n\n\t// adjusts the point, and associated spacefillers, for an atom\n\tprivate bumpAtomPosition(atom:number, dx:number, dy:number):void\n\t{\n\t\tlet p = this.points[atom - 1];\n\t\tp.oval.cx += dx;\n\t\tp.oval.cy += dy;\n\n\t\tfor (let n = this.space.length - 1; n >= 0; n--)\n\t\t{\n\t\t\tlet s = this.space[n - 1];\n\t\t\tif (s == null || s.anum != atom) continue;\n\t\t\ts.box.x += dx;\n\t\t\ts.box.y += dy;\n\t\t\tVec.addTo(s.px, dx);\n\t\t\tVec.addTo(s.py, dy);\n\t\t}\n\t}\n\n\t// returns a subset of the space-filling outlines: only those whose bounding boxes match the supplied rectangle\n\tprivate spaceSubset(x:number, y:number, w:number, h:number):SpaceFiller[]\n\t{\n\t\tlet subset:SpaceFiller[] = [];\n\t\tfor (let s of this.space) if (GeomUtil.rectsIntersect(x, y, w, h, s.box.x, s.box.y, s.box.w, s.box.h)) subset.push(s);\n\t\treturn subset;\n\t}\n\n\t// for a provided polygon, counts the number of times each of its lines intersects with the lines of one of the space-filling\n\t// polygons already placed; if the shortCircuit parameter is true, will return as soon as one is found\n\tprivate countPolyViolations(px:number[], py:number[], space:SpaceFiller[], shortCircuit:boolean):number\n\t{\n\t\tif (space == null) space = this.space;\n\n\t\tlet hits = 0;\n\t\tconst psz = px.length, nspc = space.length;\n\n\t\t// check for line-crossings first: this is the usual way that collisions happen\n\t\tlet pr = new Box(), sr = new Box();\n\t\tfor (let i1 = 0; i1 < psz; i1++)\n\t\t{\n\t\t\tlet i2 = i1 < psz - 1 ? i1 + 1 : 0;\n\t\t\tpr.x = Math.min(px[i1], px[i2]) - 1;\n\t\t\tpr.y = Math.min(py[i1], py[i2]) - 1;\n\t\t\tpr.w = Math.max(px[i1], px[i2]) - pr.x + 2;\n\t\t\tpr.h = Math.max(py[i1], py[i2]) - pr.y + 2;\n\n\t\t\tfor (let j = 0; j < nspc; j++)\n\t\t\t{\n\t\t\t\tlet spc = space[j];\n\t\t\t\tif (spc.px == null) continue;\n\t\t\t\tsr.x = spc.box.x - 1;\n\t\t\t\tsr.y = spc.box.y - 1;\n\t\t\t\tsr.w = spc.box.w + 1;\n\t\t\t\tsr.h = spc.box.h + 1;\n\t\t\t\tif (!pr.intersects(sr)) continue; // will eliminate almost everything\n\n\t\t\t\tlet ssz = spc.px.length;\n\t\t\t\tfor (let j1 = 0; j1 < ssz; j1++)\n\t\t\t\t{\n\t\t\t\t\tlet j2 = j1 < ssz - 1 ? j1 + 1 : 0;\n\t\t\t\t\tsr.x = Math.min(spc.px[j1], spc.px[j2]) - 1;\n\t\t\t\t\tsr.y = Math.min(spc.py[j1], spc.py[j2]) - 1;\n\t\t\t\t\tsr.w = Math.max(spc.px[j1], spc.px[j2]) - sr.x + 2;\n\t\t\t\t\tsr.h = Math.max(spc.py[j1], spc.py[j2]) - sr.y + 2;\n\t\t\t\t\tif (!pr.intersects(sr)) continue; // almost everything else\n\n\t\t\t\t\tif (GeomUtil.doLineSegsIntersect(px[i1], py[i1], px[i2], py[i2], spc.px[j1], spc.py[j1], spc.px[j2], spc.py[j2]))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (shortCircuit) return 1;\n\t\t\t\t\t\thits++;\n\t\t\t\t\t\tbreak; // (no need to count all the lines in this spacefiller)\n\t\t\t\t\t}\n\n\t\t\t\t\tif (ssz == 1) break; // it's a line, not a polygon; one pass only\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// now iterate over the spacefillers, and see if it's possible for either polygon to enclose the other\n\t\tpr.x = Vec.min(px);\n\t\tpr.y = Vec.min(py);\n\t\tpr.w = Vec.max(px) - pr.x;\n\t\tpr.h = Vec.max(py) - pr.y;\n\n\t\tfor (let n = nspc - 1; n >= 0; n--)\n\t\t{\n\t\t\tlet spc = space[n];\n\t\t\tsr.x = spc.box.x;\n\t\t\tsr.y = spc.box.y;\n\t\t\tsr.w = spc.box.w;\n\t\t\tsr.h = spc.box.h;\n\t\t\tif (!pr.intersects(sr)) continue; // eliminates most\n\n\t\t\t// see if the spacefiller is inside the parameter polygon\n\t\t\tfor (let i = spc.px.length - 1; i >= 0; i--) if (GeomUtil.pointInPolygon(spc.px[i], spc.py[i], px, py))\n\t\t\t{\n\t\t\t\tif (shortCircuit) return 1;\n\t\t\t\thits++;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// see if the parameter polygon is inside the spacefiller\n\t\t\tfor (let i = 0; i < psz; i++) if (GeomUtil.pointInPolygon(px[i], py[i], spc.px, spc.py))\n\t\t\t{\n\t\t\t\tif (shortCircuit) return 1;\n\t\t\t\thits++;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn hits;\n\t}\n\n\t// considering any bonds between (bf,bt), given that 'bt' is the source of a double bond line at position (x,y) and heading\n\t// out in the direction (dx,dy), make sure that two lines are adjusted to their intersection position; the position of\n\t// the line involving 'bf' is modified directly, while the new position is returned as an array of [x,y], for the caller\n\t// to update\n\tprivate adjustBondPosition(bf:number, bt:number, x1:number, y1:number, x2:number, y2:number):number[]\n\t{\n\t\tif (bf == 0 || bt == 0) return null;\n\n\t\tfor (let n = 0; n < this.lines.length; n++)\n\t\t{\n\t\t\tlet b = this.lines[n];\n\t\t\tif (this.mol.bondOrder(b.bnum) != 1 || this.mol.bondType(b.bnum) != Molecule.BONDTYPE_NORMAL) continue;\n\n\t\t\tlet alt = false;\n\t\t\tif (this.mol.bondFrom(b.bnum) == bf && this.mol.bondTo(b.bnum) == bt) {}\n\t\t\telse if (this.mol.bondFrom(b.bnum) == bt && this.mol.bondTo(b.bnum) == bf) alt = true;\n\t\t\telse continue;\n\n\t\t\t// if lines are anywhere near parallel, don't do this\n\t\t\t//if (GeomUtil.areLinesParallel(b.x1,b.y1,b.x2,b.y2,x1,y1,x2,y2)) continue; (this is too precise)\n\t\t\tlet th = angleDiff(Math.atan2(b.line.y2 - b.line.y1, b.line.x2 - b.line.x1), Math.atan2(y2 - y1, x2 - x1)) * RADDEG;\n\t\t\tif ((th > -5 && th < 5) || th > 175 || th < -175) continue;\n\n\t\t\tlet xy = GeomUtil.lineIntersect(b.line.x1, b.line.y1, b.line.x2, b.line.y2, x1, y1, x2, y2);\n\n\t\t\t// separate the non-double bond attachments (but only if not in a ring)\n\t\t\tif (this.mol.atomRingBlock(bt) == 0)\n\t\t\t{\n\t\t\t\tif (alt)\n\t\t\t\t\t{b.line.x1 = xy[0]; b.line.y1 = xy[1];}\n\t\t\t\telse\n\t\t\t\t\t{b.line.x2 = xy[0]; b.line.y2 = xy[1];}\n\t\t\t}\n\n\t\t\treturn xy;\n\t\t}\n\t\treturn null;\n\t}\n\n\t// for the guideline index of a double bond, determines which side has weighting priority for the drawing of the bond;\n\t// assumes a chain-like bond (though it could still be in a large ring); a null/empty/ambiguous set implies that there\n\t// is no priority, and that the bond should not be drawn in a side-shifted manner...\n\tprivate priorityDoubleSubstit(idx:number):number[]\n\t{\n\t\tlet bf = this.mol.bondFrom(idx), bt = this.mol.bondTo(idx);\n\t\tlet nf = this.mol.atomAdjList(bf), nt = this.mol.atomAdjList(bt);\n\t\tlet a1 = this.points[bf - 1], a2 = this.points[bt - 1];\n\t\tlet x1 = a1.oval.cx, y1 = a1.oval.cy, x2 = a2.oval.cx, y2 = a2.oval.cy;\n\t\tlet dx = x2 - x1, dy = y2 - y1, btheta = Math.atan2(dy, dx);\n\n\t\tlet idxFLeft = 0, idxFRight = 0, idxTLeft = 0, idxTRight = 0;\n\n\t\tfor (let n = 0; n < nf.length; n++) if (nf[n] != bt)\n\t\t{\n\t\t\tlet theta = angleDiff(Math.atan2(this.points[nf[n] - 1].oval.cy - y1, this.points[nf[n] - 1].oval.cx - x1), btheta);\n\t\t\tif (theta > 0) {if (idxFLeft != 0) return null; idxFLeft = nf[n];}\n\t\t\telse {if (idxFRight != 0) return null; idxFRight = nf[n];}\n\t\t}\n\t\tfor (let n = 0; n < nt.length; n++) if (nt[n] != bf)\n\t\t{\n\t\t\tlet theta = angleDiff(Math.atan2(this.points[nt[n] - 1].oval.cy - y2, this.points[nt[n] - 1].oval.cx - x2), btheta);\n\t\t\tif (theta > 0) {if (idxTLeft != 0) return null; idxTLeft = nt[n];}\n\t\t\telse {if (idxTRight != 0) return null; idxTRight = nt[n];}\n\t\t}\n\n\t\tlet sumFrom = (idxFLeft > 0 ? 1 : 0) + (idxFRight > 0 ? 1 : 0), sumTo = (idxTLeft > 0 ? 1 : 0) + (idxTRight > 0 ? 1 : 0);\n\n\t\tif (sumFrom == 1 && sumTo == 0) return [idxFLeft > 0 ? idxFLeft : idxFRight];\n\t\tif (sumFrom == 0 && sumTo == 1) return [idxTLeft > 0 ? idxTLeft : idxTRight];\n\t\tif (sumFrom == 1 && sumTo == 1)\n\t\t{\n\t\t\t// cis? if so, then side is obvious\n\t\t\tif (idxFLeft > 0 && idxTLeft > 0) return [idxFLeft, idxTLeft];\n\t\t\tif (idxFRight > 0 && idxTRight > 0) return [idxFRight, idxTRight];\n\n\t\t\t// trans? either is fine, so go with congestion\n\t\t\tlet oxy = this.orthogonalDelta(x1, y1, x2, y2, this.bondSepPix);\n\t\t\tlet congestLeft = this.spatialCongestion(0.5 * (x1 + x2) + oxy[0], 0.5 * (y1 + y2) + oxy[1]);\n\t\t\tlet congestRight = this.spatialCongestion(0.5 * (x1 + x2) - oxy[0], 0.5 * (y1 + y2) - oxy[1]);\n\t\t\tif (congestLeft < congestRight) return [idxFLeft > 0 ? idxFLeft : idxTLeft];\n\t\t\telse return [idxFRight > 0 ? idxFRight : idxTRight];\n\t\t}\n\t\tif (sumFrom == 2 && sumTo == 1)\n\t\t{\n\t\t\t// side with the majority\n\t\t\tif (idxTLeft == 0) return [idxFRight, idxTRight];\n\t\t\telse return [idxFLeft, idxTLeft];\n\t\t}\n\t\tif (sumFrom == 1 && sumTo == 2)\n\t\t{\n\t\t\t// side with the majority\n\t\t\tif (idxFLeft == 0) return [idxFRight, idxTRight];\n\t\t\telse return [idxFLeft, idxTLeft];\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t// adding additional non-core annotations, later on in the process; it is assumed that there is no directional preference\n\tprivate annotateAtom(atom:number, text:string, col:number, fsz:number):void\n\t{\n\t\tlet [tw, ta] = this.measure.measureText(text, fsz);\n\t\tlet a = this.points[atom - 1];\n\t\tlet cx = a.oval.cx, cy = a.oval.cy, rw = 0.6 * tw, rh = 0.6 * ta;\n\n\t\tlet otherTheta:number[] = [];\n\t\tfor (let a of this.mol.atomAdjList(atom))\n\t\t{\n\t\t\tlet dx = this.points[a - 1].oval.cx - cx, dy = this.points[a - 1].oval.cy - cy;\n\t\t\totherTheta.push(Math.atan2(dy, dx));\n\t\t}\n\n\t\tlet minExt = 0.5 * (a.oval.rw + a.oval.rh), stepsz = 0.1 * this.scale, nsteps = 8;\n\t\tlet angsteps = 36, angsz = TWOPI / angsteps;\n\n\t\t// begin the circular sweep\n\t\tlet bestScore = Number.POSITIVE_INFINITY, bestDX = 0, bestDY = 0;\n\t\tlet px = [0, 0, 0, 0], py = [0, 0, 0, 0];\n\n\t\tlet limX = rw + minExt + nsteps * stepsz, limY = rh + minExt + nsteps * stepsz;\n\t\tlet subSpace = this.spaceSubset(cx - limX, cy - limY, 2 * limX, 2 * limY);\n\n\t\tfor (let step = 0; step < nsteps; step++)\n\t\t{\n\t\t\tlet ext = minExt + step * stepsz;\n\t\t\tfor (let ang = 0; ang < angsteps; ang++)\n\t\t\t{\n\t\t\t\tlet th = angsz * ang;\n\t\t\t\tlet dx = ext * Math.cos(th), dy = ext * Math.sin(th);\n\t\t\t\tlet x1 = cx + dx - rw, x2 = cx + dx + rw, y1 = cy + dy - rh, y2 = cy + dy + rh;\n\t\t\t\tpx[0] = x1; py[0] = y1;\n\t\t\t\tpx[1] = x2; py[1] = y1;\n\t\t\t\tpx[2] = x2; py[2] = y2;\n\t\t\t\tpx[3] = x1; py[3] = y2;\n\t\t\t\tlet viol = this.countPolyViolations(px, py, subSpace, false);\n\t\t\t\tlet score = viol * 1000;\n\t\t\t\tfor (let oth of otherTheta) score -= Math.abs(angleDiff(th, oth));\n\n\t\t\t\tif (score < bestScore)\n\t\t\t\t{\n\t\t\t\t\tbestScore = score;\n\t\t\t\t\tbestDX = dx;\n\t\t\t\t\tbestDY = dy;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (bestScore < 500) break;\n\t\t}\n\n\t\tlet x = cx + bestDX, y = cy + bestDY;\n\n\t\t// create a point for it\n\t\tlet an:APoint =\n\t\t{\n\t\t\tanum: 0,\n\t\t\ttext,\n\t\t\tfsz,\n\t\t\tcol,\n\t\t\toval: new Oval(x, y, rw, rh),\n\t\t};\n\t\tthis.points.push(an);\n\n\t\t// create a square spacefiller\n\t\tlet spc:SpaceFiller =\n\t\t{\n\t\t\tanum: 0,\n\t\t\tbnum: 0,\n\t\t\tbox: new Box(x - rw, y - rh, 2 * rw, 2 * rh),\n\t\t\tpx: [x - rw, x + rw, x + rw, x - rw],\n\t\t\tpy: [y - rh, y - rh, y + rh, y + rh],\n\t\t};\n\t\tthis.space.push(spc);\n\t}\n\tprivate annotateBond(bond:number, text:string, col:number, fsz:number):void\n\t{\n\t\tlet [tw, ta] = this.measure.measureText(text, fsz);\n\t\tlet bfr = this.mol.bondFrom(bond), bto = this.mol.bondTo(bond);\n\t\tlet a1 = this.points[bfr - 1], a2 = this.points[bto - 1];\n\t\tlet cx = 0.5 * (a1.oval.cx + a2.oval.cx), cy = 0.5 * (a1.oval.cy + a2.oval.cy), rw = 0.6 * tw, rh = 0.6 * ta;\n\n\t\tlet bth = Math.atan2(a2.oval.cy - a1.oval.cy, a2.oval.cx - a1.oval.cx);\n\t\tlet otherTheta:number[] = [bth, bth + Math.PI];\n\t\tfor (let a of this.mol.atomAdjList(bfr)) if (a != bto)\n\t\t{\n\t\t\tlet dx = this.points[a - 1].oval.cx - this.points[bfr - 1].oval.cx, dy = this.points[a - 1].oval.cy - this.points[bfr - 1].oval.cy;\n\t\t\totherTheta.push(Math.atan2(dy, dx));\n\t\t}\n\t\tfor (let a of this.mol.atomAdjList(bto)) if (a != bfr)\n\t\t{\n\t\t\tlet dx = this.points[a - 1].oval.cx - this.points[bto - 1].oval.cx, dy = this.points[a - 1].oval.cy - this.points[bto - 1].oval.cy;\n\t\t\totherTheta.push(Math.atan2(dy, dx));\n\t\t}\n\n\t\tlet minExt = 0.2 * this.scale * this.bondOrder[bond - 1], stepsz = 0.1 * this.scale, nsteps = 8;\n\t\tlet angsteps = 36, angsz = TWOPI / angsteps;\n\n\t\t// begin the circular sweep\n\t\tlet bestScore = Number.POSITIVE_INFINITY, bestDX = 0, bestDY = 0;\n\t\tlet px = [0, 0, 0, 0], py = [0, 0, 0, 0];\n\n\t\tlet limX = rw + minExt + nsteps * stepsz, limY = rh + minExt + nsteps * stepsz;\n\t\tlet subSpace = this.spaceSubset(cx - limX, cy - limY, 2 * limX, 2 * limY);\n\n\t\tfor (let step = 0; step < nsteps; step++)\n\t\t{\n\t\t\tlet ext = minExt + step * stepsz;\n\t\t\tfor (let ang = 0; ang < angsteps; ang++)\n\t\t\t{\n\t\t\t\tlet th = angsz * ang;\n\t\t\t\tlet dx = ext * Math.cos(th), dy = ext * Math.sin(th);\n\t\t\t\tlet x1 = cx + dx - rw, x2 = cx + dx + rw, y1 = cy + dy - rh, y2 = cy + dy + rh;\n\t\t\t\tpx[0] = x1; py[0] = y1;\n\t\t\t\tpx[1] = x2; py[1] = y1;\n\t\t\t\tpx[2] = x2; py[2] = y2;\n\t\t\t\tpx[3] = x1; py[3] = y2;\n\t\t\t\tlet viol = this.countPolyViolations(px, py, subSpace, false);\n\t\t\t\tlet score = viol * 1000;\n\t\t\t\tfor (let oth of otherTheta) score -= Math.abs(angleDiff(th, oth));\n\n\t\t\t\tif (score < bestScore)\n\t\t\t\t{\n\t\t\t\t\tbestScore = score;\n\t\t\t\t\tbestDX = dx;\n\t\t\t\t\tbestDY = dy;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (bestScore < 500) break;\n\t\t}\n\n\t\tlet x = cx + bestDX, y = cy + bestDY;\n\n\t\t// create a point for it\n\t\tlet an:APoint =\n\t\t{\n\t\t\tanum: 0,\n\t\t\ttext,\n\t\t\tfsz,\n\t\t\tcol,\n\t\t\toval: new Oval(x, y, rw, rh),\n\t\t};\n\t\tthis.points.push(an);\n\n\t\t// create a square spacefiller\n\t\tlet spc:SpaceFiller =\n\t\t{\n\t\t\tanum: 0,\n\t\t\tbnum: 0,\n\t\t\tbox: new Box(x - rw, y - rh, 2 * rw, 2 * rh),\n\t\t\tpx: [x - rw, x + rw, x + rw, x - rw],\n\t\t\tpy: [y - rh, y - rh, y + rh, y + rh],\n\t\t};\n\t\tthis.space.push(spc);\n\t}\n\n\t// returns true if the indicated box intersects with any of the currently defined atom centres or bond lines; can optionally\n\t// pass masks for the points & lines which we could possibly care about\n\tprivate boxOverlaps(x:number, y:number, w:number, h:number, pointmask?:boolean[], linemask?:boolean[]):boolean\n\t{\n\t\tlet vx1 = x, vy1 = y, vx2 = x + w, vy2 = y + h;\n\n\t\tfor (let n = 0; n < this.points.length; n++)\n\t\t{\n\t\t\tif (pointmask != null && !pointmask[n]) continue;\n\n\t\t\tlet a = this.points[n];\n\t\t\tlet wx1 = a.oval.cx - a.oval.rw, wy1 = a.oval.cy - a.oval.rh, wx2 = a.oval.cx + a.oval.rw, wy2 = a.oval.cy + a.oval.rh;\n\n\t\t\t// test for any intersection of rectangles\n\t\t\tif (vx2 < wx1 || vx1 > wx2 || vy2 < wy1 || vy1 > wy2) continue; // no intersection of rectangles\n\n\t\t\treturn true;\n\t\t}\n\n\t\tfor (let n = 0; n < this.lines.length; n++)\n\t\t{\n\t\t\tif (linemask != null && !linemask[n]) continue;\n\n\t\t\tlet b = this.lines[n];\n\n\t\t\tlet wx1 = b.line.x1, wy1 = b.line.y1, wx2 = b.line.x2, wy2 = b.line.y2;\n\n\t\t\t// test for any intersection with line's rectangle\n\t\t\tif (vx2 < Math.min(wx1, wx2) || vx1 > Math.max(wx1, wx2) || vy2 < Math.min(wy1, wy2) || vy1 > Math.max(wy1, wy2)) continue; // no intersection of rectangles\n\n\t\t\t// if either point is completely in the box, then fast-out\n\t\t\tif (wx1 >= vx1 && wx1 <= vx2 && wy1 >= vy1 && wy1 <= vy2) return true;\n\t\t\tif (wx2 >= vx1 && wx2 <= vx2 && wy2 >= vy1 && wy2 <= vy2) return true;\n\n\t\t\tif (GeomUtil.doLineSegsIntersect(wx1, wy1, wx2, wy2, vx1, vy1, vx2, vy1)) return true;\n\t\t\tif (GeomUtil.doLineSegsIntersect(wx1, wy1, wx2, wy2, vx1, vy2, vx2, vy2)) return true;\n\t\t\tif (GeomUtil.doLineSegsIntersect(wx1, wy1, wx2, wy2, vx1, vy1, vx1, vy2)) return true;\n\t\t\tif (GeomUtil.doLineSegsIntersect(wx1, wy1, wx2, wy2, vx2, vy1, vx2, vy2)) return true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t// given the predetermined fact that {bondHigher} crosses {bondLower} with the original coordinates, looks for\n\t// arranged lines matching these indices, so that they might be split up\n\tprivate resolveLineCrossings(bondHigher:number, bondLower:number):void\n\t{\n\t\twhile (true)\n\t\t{\n\t\t\tlet anything = false;\n\n\t\t\tfor (let i1 = 0; i1 < this.lines.length; i1++)\n\t\t\t{\n\t\t\t\tlet b1 = this.lines[i1];\n\t\t\t\tif (b1.bnum != bondHigher) continue;\n\t\t\t\tif (b1.type != BLineType.Normal && b1.type != BLineType.Dotted && b1.type != BLineType.DotDir) continue;\n\n\t\t\t\tfor (let i2 = 0; i2 < this.lines.length; i2++)\n\t\t\t\t{\n\t\t\t\t\tlet b2 = this.lines[i2];\n\t\t\t\t\t// note: b1 is on top, b2 is on bottom\n\n\t\t\t\t\tif (b2.bnum != bondLower) continue;\n\t\t\t\t\tif (b2.type == BLineType.DotDir) b2.type = BLineType.Dotted; // zap the directionality when splitting in two\n\t\t\t\t\tif (b2.type != BLineType.Normal && b2.type != BLineType.Dotted) continue;\n\n\t\t\t\t\t// make sure they don't share an atom\n\t\t\t\t\tif (b1.bfr == b2.bfr || b1.bfr == b2.bto || b1.bto == b2.bfr || b1.bto == b2.bto) continue;\n\n\t\t\t\t\tif (!GeomUtil.doLineSegsIntersect(b1.line.x1, b1.line.y1, b1.line.x2, b1.line.y2, b2.line.x1, b2.line.y1, b2.line.x2, b2.line.y2)) continue;\n\t\t\t\t\tlet xy = GeomUtil.lineIntersect(b1.line.x1, b1.line.y1, b1.line.x2, b1.line.y2, b2.line.x1, b2.line.y1, b2.line.x2, b2.line.y2);\n\n\t\t\t\t\tlet dx = b2.line.x2 - b2.line.x1, dy = b2.line.y2 - b2.line.y1;\n\t\t\t\t\tlet ext = Math.abs(dx) > Math.abs(dy) ? (xy[0] - b2.line.x1) / dx : (xy[1] - b2.line.y1) / dy;\n\n\t\t\t\t\tlet dist = norm_xy(dx, dy);\n\t\t\t\t\tlet delta = b2.size / dist * (b2.type == BLineType.Normal ? 2 : 4);\n\t\t\t\t\tif (ext > delta && ext < 1 - delta)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet b3:BLine =\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbnum: b2.bnum,\n\t\t\t\t\t\t\tbfr: b2.bfr,\n\t\t\t\t\t\t\tbto: b2.bto,\n\t\t\t\t\t\t\ttype: b2.type,\n\t\t\t\t\t\t\tline: b2.line.clone(),\n\t\t\t\t\t\t\tsize: b2.size,\n\t\t\t\t\t\t\thead: b2.head,\n\t\t\t\t\t\t\tcol: b2.col\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthis.lines.push(b3);\n\t\t\t\t\t\tb2.line.x2 = b2.line.x1 + dx * (ext - delta);\n\t\t\t\t\t\tb2.line.y2 = b2.line.y1 + dy * (ext - delta);\n\t\t\t\t\t\tb3.line.x1 = b3.line.x1 + dx * (ext + delta);\n\t\t\t\t\t\tb3.line.y1 = b3.line.y1 + dy * (ext + delta);\n\t\t\t\t\t\tanything = true;\n\t\t\t\t\t}\n\t\t\t\t\telse if (ext > delta)\n\t\t\t\t\t{\n\t\t\t\t\t\tb2.line.x2 = b2.line.x1 + dx * (ext - delta);\n\t\t\t\t\t\tb2.line.y2 = b2.line.y1 + dy * (ext - delta);\n\t\t\t\t\t\tanything = true;\n\t\t\t\t\t}\n\t\t\t\t\telse if (ext < 1 - delta)\n\t\t\t\t\t{\n\t\t\t\t\t\tb2.line.x1 = b2.line.x1 + dx * (ext + delta);\n\t\t\t\t\t\tb2.line.y1 = b2.line.y1 + dy * (ext + delta);\n\t\t\t\t\t\tanything = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!anything) break;\n\t\t}\n\t}\n\n\t// draw a circle at the interior of a group of atoms, as in, ring-style benzene\n\tprivate createCircularRing(atoms:number[]):void\n\t{\n\t\tlet px:number[] = new Array(atoms.length), py:number[] = new Array(atoms.length);\n\t\tfor (let n = 0; n < atoms.length; n++)\n\t\t{\n\t\t\tlet pt = this.points[atoms[n] - 1];\n\t\t\tpx[n] = pt.oval.cx;\n\t\t\tpy[n] = pt.oval.cy;\n\t\t}\n\t\tlet cx = Vec.sum(px) / atoms.length, cy = Vec.sum(py) / atoms.length;\n\n\t\tlet bx:number[] = [], by:number[] = [];\n\t\tlet isRegular = true;\n\t\tlet regDist = Number.NaN;\n\t\tconst FRACT = 0.7;\n\t\tfor (let a of atoms)\n\t\t{\n\t\t\tlet pt = this.points[a - 1];\n\t\t\tlet x0 = pt.oval.cx - cx, y0 = pt.oval.cy - cy, x1 = x0 - pt.oval.rw, x2 = x0 + pt.oval.rw, y1 = y0 - pt.oval.rh, y2 = y0 + pt.oval.rh;\n\t\t\tbx.push(x1); by.push(y0);\n\t\t\tbx.push(x1); by.push(y1);\n\t\t\tbx.push(x1); by.push(y2);\n\t\t\tbx.push(x0); by.push(y1);\n\t\t\tbx.push(x0); by.push(y2);\n\t\t\tbx.push(x2); by.push(y0);\n\t\t\tbx.push(x2); by.push(y1);\n\t\t\tbx.push(x2); by.push(y2);\n\t\t\tlet dist = norm_xy(x0, y0), theta = Math.atan2(y0, x0);\n\t\t\tbx.push(FRACT * dist * Math.cos(theta));\n\t\t\tby.push(FRACT * dist * Math.sin(theta));\n\n\t\t\tfor (let b of this.mol.atomAdjList(a)) if (atoms.indexOf(b) >= 0)\n\t\t\t{\n\t\t\t\tlet pb = this.points[b - 1];\n\t\t\t\tlet mx = 0.5 * (pt.oval.cx + pb.oval.cx) - cx, my = 0.5 * (pt.oval.cy + pb.oval.cy) - cy;\n\t\t\t\tlet mdist = norm_xy(mx, my), mtheta = Math.atan2(my, mx);\n\t\t\t\tbx.push(FRACT * mdist * Math.cos(mtheta));\n\t\t\t\tby.push(FRACT * mdist * Math.sin(mtheta));\n\t\t\t}\n\n\t\t\t// check if it's still considered regular\n\t\t\tif (!isRegular) {}\n\t\t\telse if (Number.isFinite(regDist)) {if (Math.abs(regDist - dist) > 1) isRegular = false;}\n\t\t\telse regDist = dist;\n\t\t}\n\n\t\tlet r:XRing = {atoms, cx, cy, rw: 0, rh: 0, theta: 0, size: 0};\n\t\tif (isRegular)\n\t\t{\n\t\t\tr.rw = r.rh = GeomUtil.fitCircle(bx, by);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t/*let lowX = Vec.min(bx) - 10 * Vec.range(bx), highX = Vec.max(bx) + 10 * Vec.range(bx);\n\t\t\tlet lowY = Vec.min(by) - 10 * Vec.range(by), highY = Vec.max(by) + 10 * Vec.range(by);\n\t\t\tlet minX = Number.POSITIVE_INFINITY, maxX = Number.NEGATIVE_INFINITY, minY = Number.POSITIVE_INFINITY, maxY = Number.NEGATIVE_INFINITY;\n\t\t\tfor (let n = 0; n < atoms.length; n++)\n\t\t\t{\n\t\t\t\tlet nn = n < atoms.length - 1 ? n + 1 : 0;\n\t\t\t\tlet p1 = this.points[atoms[n] - 1], p2 = this.points[atoms[nn] - 1];\n\t\t\t\tlet x1 = p1.oval.cx - cx - 0.1 * (p2.oval.cx - p1.oval.cx), y1 = p1.oval.cy - cy - 0.1 * (p2.oval.cy - p1.oval.cy);\n\t\t\t\tlet x2 = p2.oval.cx - cx + 0.1 * (p2.oval.cx - p1.oval.cx), y2 = p2.oval.cy - cy + 0.1 * (p2.oval.cy - p1.oval.cy);\n\t\t\t\tif (GeomUtil.doLineSegsIntersect(x1, y1, x2, y2, lowX, 0, highX, 0))\n\t\t\t\t{\n\t\t\t\t\tlet xy = GeomUtil.lineIntersect(x1, y1, x2, y2, lowX, 0, highX, 0);\n\t\t\t\t\tminX = Math.min(minX, xy[0]);\n\t\t\t\t\tmaxX = Math.max(maxX, xy[0]);\n\t\t\t\t}\n\t\t\t\tif (GeomUtil.doLineSegsIntersect(x1, y1, x2, y2, 0, lowY, 0, highY))\n\t\t\t\t{\n\t\t\t\t\tlet xy = GeomUtil.lineIntersect(x1, y1, x2, y2, 0, lowY, 0, highY);\n\t\t\t\t\tminY = Math.min(minY, xy[1]);\n\t\t\t\t\tmaxY = Math.max(maxY, xy[1]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet rwh = GeomUtil.fitEllipse(bx, by, minX, minY, maxX, maxY);\n\t\t\tr.rw = rwh[0];\n\t\t\tr.rh = rwh[1];*/\n\n\t\t\tlet mdist = 0;\n\t\t\tfor (let n = 0; n < atoms.length; n++) mdist += norm_xy(px[n] - cx, py[n] - cy);\n\t\t\tlet margin = mdist / atoms.length * (1 - FRACT);\n\t\t\tvar fit = new FitRotatedEllipse(px, py, margin);\n\t\t\tfit.calculate();\n\t\t\tr.cx = fit.cx;\n\t\t\tr.cy = fit.cy;\n\t\t\tr.rw = fit.rw;\n\t\t\tr.rh = fit.rh;\n\t\t\tr.theta = fit.theta;\n\t\t}\n\t\tr.size = this.lineSizePix;\n\t\tthis.rings.push(r);\n\t}\n\n\t// draw a continuous fractional bond for resonance-style paths\n\tprivate createCurvedPath(atoms:number[], fractional:boolean, extAtom:number):void\n\t{\n\t\tconst sz = atoms.length, szn = sz - 1;\n\t\tlet x:number[] = [], y:number[] = [], symbol:boolean[] = [];\n\t\tfor (let n = 0; n < sz; n++)\n\t\t{\n\t\t\tlet pt = this.points[atoms[n] - 1];\n\t\t\tx.push(pt.oval.cx);\n\t\t\ty.push(pt.oval.cy);\n\t\t\tsymbol.push(pt.text != null);\n\t\t}\n\n\t\t// calculate offsets that can be used (+/-) to put the fraction on one side of the path\n\t\tlet ox:number[] = [], oy:number[] = [];\n\t\tconst EXT = Molecule.IDEALBOND * 0.25 * this.scale;\n\t\tfor (let n = 0; n < sz - 1; n++)\n\t\t{\n\t\t\tlet dx = x[n + 1] - x[n], dy = y[n + 1] - y[n], invD = EXT * invZ(norm_xy(dx, dy));\n\t\t\tox.push(dy * invD);\n\t\t\toy.push(-dx * invD);\n\t\t}\n\n\t\t// create two paths with these offsets\n\t\tconst FAR = 1.2, CLOSE = 0.7;\n\t\tlet sx1 = Vec.numberArray(0, sz), sy1 = Vec.numberArray(0, sz), sx2 = Vec.numberArray(0, sz), sy2 = Vec.numberArray(0, sz);\n\t\tconst capA = symbol[0] ? FAR : CLOSE;\n\t\tif (!fractional)\n\t\t{\n\t\t\tsx1[0] = x[0] + ox[0] * capA; sy1[0] = y[0] + oy[0] * capA;\n\t\t\tsx2[0] = x[0] - ox[0] * capA; sy2[0] = y[0] - oy[0] * capA;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst dx = -oy[0], dy = ox[0];\n\t\t\tsx1[0] = x[0] + dx * capA; sy1[0] = y[0] + dy * capA;\n\t\t\tsx2[0] = x[0] + dx * capA; sy2[0] = y[0] + dy * capA;\n\t\t}\n\n\t\tlet ncross1 = 0, ncross2 = 0;\n\t\tfor (let n = 1; n < sz - 1; n++)\n\t\t{\n\t\t\tconst fr1 = symbol[n] ? FAR : CLOSE, fr2 = fr1;\n\t\t\tsx1[n] = x[n] + fr1 * (ox[n - 1] + ox[n]); sy1[n] = y[n] + fr1 * (oy[n - 1] + oy[n]);\n\t\t\tsx2[n] = x[n] - fr2 * (ox[n - 1] + ox[n]); sy2[n] = y[n] - fr2 * (oy[n - 1] + oy[n]);\n\n\t\t\t// every other bond \"crosses\" one side or the other\n\t\t\tfor (let a of this.mol.atomAdjList(atoms[n])) if (atoms.indexOf(a) < 0 && a != extAtom)\n\t\t\t{\n\t\t\t\tlet pt = this.points[a - 1];\n\t\t\t\tlet dx = pt.oval.cx - x[n], dy = pt.oval.cy - y[n];\n\t\t\t\tlet dot1 = dx * (sx1[n] - x[n]) + dy * (sy1[n] - x[n]);\n\t\t\t\tlet dot2 = dy * (sx2[n] - x[n]) + dy * (sy2[n] - x[n]);\n\t\t\t\tif (dot1 > dot2) ncross1++; else ncross2++; // higher means that the vectors align, hence this is the crosser\n\t\t\t}\n\t\t}\n\n\t\tlet nn = sz - 1;\n\t\tlet capB = symbol[nn] ? FAR : CLOSE;\n\t\tif (!fractional)\n\t\t{\n\t\t\tsx1[nn] = x[nn] + ox[nn - 1] * capB; sy1[nn] = y[nn] + oy[nn - 1] * capB;\n\t\t\tsx2[nn] = x[nn] - ox[nn - 1] * capB; sy2[nn] = y[nn] - oy[nn - 1] * capB;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet dx = -oy[nn - 1], dy = ox[nn - 1];\n\t\t\tsx1[nn] = x[nn] - dx * capB; sy1[nn] = y[nn] - dy * capB;\n\t\t\tsx2[nn] = x[nn] - dx * capB; sy2[nn] = y[nn] - dy * capB;\n\t\t}\n\n\t\t// come up with a score for each one, and pick the best (shortest with fewest bond crossings)\n\t\tlet score1 = 0, score2 = 0;\n\t\tfor (let n = 0; n < sz - 1; n++)\n\t\t{\n\t\t\tscore1 += norm_xy(sx1[n + 1] - sx1[n], sy1[n + 1] - sy1[n]);\n\t\t\tscore2 += norm_xy(sx2[n + 1] - sx2[n], sy2[n + 1] - sy2[n]);\n\t\t}\n\t\tscore1 *= ncross1 + 1;\n\t\tscore2 *= ncross2 + 1;\n\n\t\tlet sx = score1 < score2 ? sx1 : sx2;\n\t\tlet sy = score1 < score2 ? sy1 : sy2;\n\n\t\tlet p:XPath = {atoms, px: null, py: null, ctrl: null, size: this.lineSizePix};\n\t\tthis.splineInterpolate(p, sx, sy);\n\t\tthis.paths.push(p);\n\n\t\t// NOTE: no spacefiller; consider adding one\n\t}\n\n\t// create a bond emerging from an atom to a centroid of multiple atoms\n\tprivate createBondCentroid(from:number, to:number[]):void\n\t{\n\t\tlet pt = this.points[from - 1];\n\t\tlet x1 = pt.oval.cx, y1 = pt.oval.cy, x2 = 0, y2 = 0;\n\t\tfor (let a of to)\n\t\t{\n\t\t\tpt = this.points[a - 1];\n\t\t\tx2 += pt.oval.cx;\n\t\t\ty2 += pt.oval.cy;\n\t\t}\n\t\tx2 /= to.length; y2 /= to.length;\n\n\t\t// if the \"centroid\" is a point or line, don't want to hit the middle\n\t\tif (to.length <= 2)\n\t\t{\n\t\t\tx2 -= 0.1 * (x2 - x1);\n\t\t\ty2 -= 0.1 * (y2 - y1);\n\t\t}\n\n\t\tconst minDist = MINBOND_LINE * this.measure.scale();\n\t\tlet xy1 = this.shrinkBond(x1, y1, x2, y2, this.backOffAtom(from, x1, y1, x2, y2, minDist));\n\t\tthis.ensureMinimumBondLength(xy1, [x2, y2], x1, y1, x2, y2, minDist);\n\n\t\tlet b:BLine =\n\t\t{\n\t\t\tbnum: 0,\n\t\t\tbfr: from,\n\t\t\tbto: 0,\n\t\t\ttype: BLineType.Normal,\n\t\t\tline: new Line(xy1[0], xy1[1], x2, y2),\n\t\t\tsize: this.lineSizePix,\n\t\t\thead: 0,\n\t\t\tcol: this.policy.data.foreground\n\t\t};\n\t\tthis.lines.push(b);\n\t\tthis.space.push(this.computeSpaceLine(b));\n\t}\n\n\t// turns a series of points into a smooth spline\n\tprivate splineInterpolate(path:XPath, x:number[], y:number[]):void\n\t{\n\t\tconst sz = x.length;\n\t\tconst scale = 0.25; // empirical\n\t\tfor (let n = 0; n < sz; n++)\n\t\t{\n\t\t\tif (n == 0)\n\t\t\t{\n\t\t\t\tlet dx = x[n + 1] - x[n], dy = y[n + 1] - y[n];\n\t\t\t\tlet qx = x[n] + scale * dx, qy = y[n] + scale * dy;\n\t\t\t\tpath.px = Vec.append(path.px, x[n]); path.py = Vec.append(path.py, y[n]); path.ctrl = Vec.append(path.ctrl, false);\n\t\t\t\tpath.px = Vec.append(path.px, qx); path.py = Vec.append(path.py, qy); path.ctrl = Vec.append(path.ctrl, true);\n\t\t\t}\n\t\t\telse if (n == sz - 1)\n\t\t\t{\n\t\t\t\tlet dx = x[n] - x[n - 1], dy = y[n] - y[n - 1];\n\t\t\t\tlet qx = x[n] - scale * dx, qy = y[n] - scale * dy;\n\t\t\t\tpath.px = Vec.append(path.px, qx); path.py = Vec.append(path.py, qy); path.ctrl = Vec.append(path.ctrl, true);\n\t\t\t\tpath.px = Vec.append(path.px, x[n]); path.py = Vec.append(path.py, y[n]); path.ctrl = Vec.append(path.ctrl, false);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet dx = x[n + 1] - x[n - 1], dy = y[n + 1] - y[n - 1];\n\t\t\t\tlet invD = invZ(norm_xy(dx, dy));\n\t\t\t\tdx *= invD; dy *= invD;\n\n\t\t\t\tlet d1 = scale * norm_xy(x[n] - x[n - 1], y[n] - y[n - 1]), d2 = scale * norm_xy(x[n + 1] - x[n], y[n + 1] - y[n]);\n\t\t\t\tlet qx1 = x[n] - dx * d1, qy1 = y[n] - dy * d1;\n\t\t\t\tlet qx2 = x[n] + dx * d2, qy2 = y[n] + dy * d2;\n\n\t\t\t\tpath.px = Vec.append(path.px, qx1); path.py = Vec.append(path.py, qy1); path.ctrl = Vec.append(path.ctrl, true);\n\t\t\t\tpath.px = Vec.append(path.px, x[n]); path.py = Vec.append(path.py, y[n]); path.ctrl = Vec.append(path.ctrl, false);\n\t\t\t\tpath.px = Vec.append(path.px, qx2); path.py = Vec.append(path.py, qy2); path.ctrl = Vec.append(path.ctrl, true);\n\t\t\t}\n\t\t}\n\t}\n\n\t// create a \"delocalised\" charge or unpaired state, which hovers in between a sequence of atoms that are resonance related\n\tprivate delocalisedAnnotation(atoms:number[], charge:number, unpaired:number):void\n\t{\n\t\tconst mol = this.mol;\n\n\t\tlet str = '';\n\t\tif (charge == -1) str = '-';\n\t\telse if (charge == 1) str = '+';\n\t\telse if (charge < -1) str = Math.abs(charge) + '-';\n\t\telse if (charge > 1) str = charge + '+';\n\t\tif (unpaired > 0) for (let n = 0; n < unpaired; n++) str += '.';\n\t\tif (str.length == 0) return;\n\n\t\t// find the least congested point; overall average is first\n\t\tconst sz = atoms.length;\n\t\tlet bestX = 0, bestY = 0;\n\t\tfor (let a of atoms) {bestX += mol.atomX(a); bestY += mol.atomY(a);}\n\t\tbestX /= sz; bestY /= sz;\n\t\tlet bestScore = CoordUtil.congestionPoint(mol, bestX, bestY);\n\n\t\tfor (let n = 1; n < sz - 1; n++)\n\t\t{\n\t\t\tlet x = 0.5 * (mol.atomX(atoms[n - 1]) + mol.atomX(atoms[n + 1])), y = 0.5 * (mol.atomY(atoms[n - 1]) + mol.atomY(atoms[n + 1]));\n\t\t\tlet score = CoordUtil.congestionPoint(mol, x, y);\n\t\t\tif (score < bestScore) {bestScore = score; bestX = x; bestY = y;}\n\t\t}\n\n\t\tlet fsz = 0.8 * this.fontSizePix;\n\t\tlet wad = this.measure.measureText(str, fsz);\n\t\tlet rw = 0.55 * wad[0], rh = 0.55 * wad[1];\n\n\t\t// create a point for it\n\t\tlet a:APoint =\n\t\t{\n\t\t\tanum: 0,\n\t\t\ttext: str,\n\t\t\tfsz,\n\t\t\tcol: this.policy.data.foreground,\n\t\t\toval: new Oval(this.measure.angToX(bestX), this.measure.angToY(bestY), rw, rh)\n\t\t};\n\t\tthis.points.push(a);\n\n\t\t// create a square spacefiller\n\t\tlet spc:SpaceFiller =\n\t\t{\n\t\t\tanum: 0,\n\t\t\tbnum: 0,\n\t\t\tbox: new Box(a.oval.cx - rw, a.oval.cy - rh, 2 * rw, 2 * rh),\n\t\t\tpx: [a.oval.cx - rw, a.oval.cx + rw, a.oval.cx + rw, a.oval.cx - rw],\n\t\t\tpy: [a.oval.cy - rh, a.oval.cy - rh, a.oval.cy + rh, a.oval.cy + rh]\n\t\t};\n\t\tthis.space.push(spc);\n\t}\n\n\t// draw the brackets that are associated with a\n\tprivate processPolymerUnit(unit:PolymerBlockUnit, allUnits:PolymerBlockUnit[]):void\n\t{\n\t\tif (Vec.len(unit.bondConn) == 4)\n\t\t{\n\t\t\tthis.processPolymerUnitPair(unit);\n\t\t\treturn;\n\t\t}\n\n\t\tinterface Bracket\n\t\t{\n\t\t\ta1?:number; // in-block atom\n\t\t\ta2?:number; // out-block atom\n\t\t\tx1?:number;\n\t\t\ty1?:number;\n\t\t\tx2?:number;\n\t\t\ty2?:number;\n\t\t\tshared?:boolean; // bond is shared with a block coming from the other direction\n\t\t\tnestOrder?:number; // if bond is nested within more than one block, nest/count stored information\n\t\t\tnestCount?:number; // ... on how to render them non-overlapping\n\t\t}\n\t\tlet brackets:Bracket[] = [];\n\n\t\tconst {mol, measure} = this;\n\n\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t{\n\t\t\tlet a1 = mol.bondFrom(n), a2 = mol.bondTo(n);\n\t\t\tlet in1 = unit.atoms.indexOf(a1) >= 0, in2 = unit.atoms.indexOf(a2) >= 0;\n\t\t\tlet bracket:Bracket = null;\n\t\t\tif (in1 && !in2) bracket = {a1, a2};\n\t\t\telse if (in2 && !in1) bracket = {a1: a2, a2: a1};\n\t\t\telse continue;\n\n\t\t\tbracket.x1 = mol.atomX(bracket.a1);\n\t\t\tbracket.y1 = mol.atomY(bracket.a1);\n\t\t\tbracket.x2 = mol.atomX(bracket.a2);\n\t\t\tbracket.y2 = mol.atomY(bracket.a2);\n\n\t\t\tbracket.shared = false;\n\t\t\tfor (let other of allUnits) if (unit !== other && other.atoms.includes(bracket.a2))\n\t\t\t{\n\t\t\t\tbracket.shared = true;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tlet nestings = allUnits.filter((look) => look === unit || (look.atoms.includes(bracket.a1) && !look.atoms.includes(bracket.a2)));\n\t\t\tif (nestings.length > 1)\n\t\t\t{\n\t\t\t\tnestings.sort((u1, u2) => u1.atoms.length - u2.atoms.length);\n\t\t\t\tfor (let i = 0; i < nestings.length; i++) if (nestings[i] === unit) bracket.nestOrder = i;\n\t\t\t\tbracket.nestCount = nestings.length;\n\t\t\t}\n\n\t\t\tbrackets.push(bracket);\n\t\t}\n\n\t\tlet tagidx = 0;\n\t\tlet atomX = unit.atoms.map((a) => mol.atomX(a)), atomY = unit.atoms.map((a) => mol.atomY(a));\n\t\tlet minX = Vec.min(atomX), minY = Vec.min(atomY);\n\t\tlet maxX = Vec.max(atomX), maxY = Vec.max(atomY);\n\t\tfor (let n = 1; n < brackets.length; n++)\n\t\t{\n\t\t\tlet b1 = brackets[tagidx], b2 = brackets[n];\n\t\t\tlet score1 = b1.x2 - minX - b1.y2 + minY;\n\t\t\tlet score2 = b2.x2 - minX - b2.y2 + minY;\n\t\t\tif (score2 > score1) tagidx = n;\n\t\t}\n\n\t\tlet isLinear = false, isOuter = false;\n\t\tif (brackets.length == 2)\n\t\t{\n\t\t\tlet left = brackets[tagidx == 0 ? 1 : 0], right = brackets[tagidx];\n\t\t\tlet theta1 = Math.atan2(left.y2 - left.y1, left.x2 - left.x1);\n\t\t\tlet theta2 = Math.atan2(right.y2 - right.y1, right.x2 - right.x1);\n\t\t\tisLinear = (theta1 > 145 * DEGRAD || theta1 < -145 * DEGRAD) && theta2 < 35 * DEGRAD && theta2 > -35 * DEGRAD;\n\t\t}\n\t\telse if (brackets.length == 0)\n\t\t{\n\t\t\tlet ym = 0.5 * (minY + maxY);\n\t\t\tbrackets.push({x1: minX, y1: ym, x2: minX - 1, y2: ym});\n\t\t\tbrackets.push({x1: maxX, y1: ym, x2: maxX + 1, y2: ym});\n\t\t\ttagidx = 1;\n\t\t\tisOuter = true;\n\t\t}\n\n\t\tlet bsz1 = (isOuter ? 0.5 * (maxY - minY + 1) : isLinear ? 1.0 : 0.5) * this.scale, bsz2 = 0.2 * this.scale;\n\n\t\tconst BASE_LINE = {bnum: 0, bfr: 0, bto: 0, type: BLineType.Normal, size: this.lineSizePix, head: 0, col: this.policy.data.foreground};\n\t\tconst BASE_TEXT = {anum: 0, fsz: 0.7 * this.fontSizePix, bold: false, col: this.policy.data.foreground};\n\n\t\tfor (let n = 0; n < brackets.length; n++)\n\t\t{\n\t\t\tlet bracket = brackets[n];\n\t\t\tlet x1 = measure.angToX(bracket.x1), y1 = measure.angToY(bracket.y1);\n\t\t\tlet x2 = measure.angToX(bracket.x2), y2 = measure.angToY(bracket.y2);\n\t\t\tif (bracket.shared)\n\t\t\t{\n\t\t\t\tx2 -= (x2 - x1) * 0.1;\n\t\t\t\ty2 -= (y2 - y1) * 0.1;\n\t\t\t}\n\t\t\tif (bracket.nestCount > 1)\n\t\t\t{\n\t\t\t\tlet dx = x2 - x1, dy = y2 - y1, fract = (bracket.nestOrder + 1) / bracket.nestCount;\n\t\t\t\tx2 = x1 + dx * fract;\n\t\t\t\ty2 = y1 + dy * fract;\n\t\t\t}\n\t\t\tlet mx = 0.5 * (x1 + x2), my = 0.5 * (y1 + y2);\n\t\t\tif (isLinear)\n\t\t\t{\n\t\t\t\tx1 = x2 = mx;\n\t\t\t\ty1 = y2 = my;\n\t\t\t\tif (n == tagidx)\n\t\t\t\t\t{x1--; x2++;}\n\t\t\t\telse\n\t\t\t\t\t{x1++; x2--;}\n\t\t\t}\n\t\t\tlet invDist = invZ(norm_xy(x2 - x1, y2 - y1));\n\t\t\tlet dx = (x2 - x1) * invDist, dy = (y2 - y1) * invDist;\n\t\t\tlet ox = dy, oy = -dx;\n\n\t\t\tlet px2 = mx - bsz1 * ox, py2 = my - bsz1 * oy;\n\t\t\tlet px3 = mx + bsz1 * ox, py3 = my + bsz1 * oy;\n\t\t\tlet px1 = px2 - bsz2 * dx, py1 = py2 - bsz2 * dy;\n\t\t\tlet px4 = px3 - bsz2 * dx, py4 = py3 - bsz2 * dy;\n\n\t\t\tlet line1 = {...BASE_LINE, 'line': new Line(px1, py1, px2, py2)};\n\t\t\tlet line2 = {...BASE_LINE, 'line': new Line(px2, py2, px3, py3)};\n\t\t\tlet line3 = {...BASE_LINE, 'line': new Line(px3, py3, px4, py4)};\n\t\t\tthis.lines.push(line1);\n\t\t\tthis.lines.push(line2);\n\t\t\tthis.lines.push(line3);\n\t\t\tthis.space.push(this.computeSpaceLine(line1));\n\t\t\tthis.space.push(this.computeSpaceLine(line2));\n\t\t\tthis.space.push(this.computeSpaceLine(line3));\n\n\t\t\tif (n == tagidx)\n\t\t\t{\n\t\t\t\tlet xx:number, yy:number;\n\t\t\t\tif (bracket.shared)\n\t\t\t\t\t[xx, yy] = [px2 - 0.5 * this.scale * ox, py2 - 0.5 * this.scale * oy];\n\t\t\t\telse\n\t\t\t\t\t[xx, yy] = [px2 + bsz2 * 2 * dx, py2 + bsz2 * 2 * dy];\n\n\t\t\t\tlet pt1 = {...BASE_TEXT, 'text': 'n', 'oval': new Oval(xx, yy, 0, 0)};\n\t\t\t\tthis.points.push(pt1);\n\t\t\t\tthis.space.push(this.computeSpacePoint(pt1));\n\n\t\t\t\tif (unit.connect != null)\n\t\t\t\t{\n\t\t\t\t\tlet text = '?';\n\t\t\t\t\tif (unit.connect == PolymerBlockConnectivity.HeadToTail) text = 'ht';\n\t\t\t\t\telse if (unit.connect == PolymerBlockConnectivity.HeadToHead) text = 'hh';\n\t\t\t\t\telse if (unit.connect == PolymerBlockConnectivity.Random) text = 'eu';\n\n\t\t\t\t\tif (bracket.shared)\n\t\t\t\t\t\t[xx, yy] = [px3 + 0.5 * this.scale * ox, py3 + 0.5 * this.scale * oy];\n\t\t\t\t\telse\n\t\t\t\t\t\t[xx, yy] = [px3 + bsz2 * 2.5 * dx, py3 + bsz2 * 2.5 * dy];\n\n\t\t\t\t\tlet pt2 = {...BASE_TEXT, 'text': text, 'oval': new Oval(xx, yy, 0, 0)};\n\t\t\t\t\tthis.points.push(pt2);\n\t\t\t\t\tthis.space.push(this.computeSpacePoint(pt2));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// special case: 2x2, double-up the brackets\n\tprivate processPolymerUnitPair(unit:PolymerBlockUnit):void\n\t{\n\t\tconst {mol, measure} = this;\n\n\t\tlet xpos:number[] = [], ypos:number[] = [];\n\t\tfor (let b of unit.bondConn)\n\t\t{\n\t\t\tlet bfr = mol.bondFrom(b), bto = mol.bondTo(b);\n\t\t\txpos.push(measure.angToX(0.5 * (mol.atomX(bfr) + mol.atomX(bto))));\n\t\t\typos.push(measure.angToY(0.5 * (mol.atomY(bfr) + mol.atomY(bto))));\n\t\t}\n\n\t\tlet cx = Vec.sum(xpos) * 0.25, cy = Vec.sum(ypos) * 0.25;\n\t\tlet bsz = 0.5 * this.scale;\n\t\tlet rx:number[] = [], ry:number[] = [];\n\n\t\tfor (let [i1, i2] of [[0, 1], [2, 3]])\n\t\t{\n\t\t\tlet dx = xpos[i2] - xpos[i1], dy = ypos[i2] - ypos[i1], inv = bsz * invZ(norm_xy(dx, dy) + 0.001);\n\t\t\t[dx, dy] = [dx * inv, dy * inv];\n\t\t\txpos[i1] -= 2 * dx;\n\t\t\typos[i1] -= 2 * dy;\n\t\t\txpos[i2] += 2 * dx;\n\t\t\typos[i2] += 2 * dy;\n\t\t\tlet ox = dy, oy = -dx;\n\t\t\tlet dsq1 = norm2_xy(0.5 * (xpos[i1] + xpos[i2]) + ox - cx, 0.5 * (ypos[i1] + ypos[i2]) + oy - cy);\n\t\t\tlet dsq2 = norm2_xy(0.5 * (xpos[i1] + xpos[i2]) - ox - cx, 0.5 * (ypos[i1] + ypos[i2]) - oy - cy);\n\t\t\tif (dsq2 < dsq1) [ox, oy] = [-ox, -oy];\n\t\t\trx.push(...[ox, ox]);\n\t\t\try.push(...[oy, oy]);\n\t\t}\n\n\t\tconst BASE_LINE = {bnum: 0, bfr: 0, bto: 0, type: BLineType.Normal, size: this.lineSizePix, head: 0, col: this.policy.data.foreground};\n\t\tconst BASE_TEXT = {anum: 0, fsz: 0.7 * this.fontSizePix, bold: false, col: this.policy.data.foreground};\n\n\t\tlet drawLine = (x1:number, y1:number, x2:number, y2:number):void =>\n\t\t{\n\t\t\tlet line = {...BASE_LINE, 'line': new Line(x1, y1, x2, y2)};\n\t\t\tthis.lines.push(line);\n\t\t\tthis.space.push(this.computeSpaceLine(line));\n\t\t};\n\t\tlet drawText = (x:number, y:number, txt:string):void =>\n\t\t{\n\t\t\tlet pt = {...BASE_TEXT, 'text': txt, 'oval': new Oval(x, y, 0, 0)};\n\t\t\tthis.points.push(pt);\n\t\t\tthis.space.push(this.computeSpacePoint(pt));\n\t\t};\n\n\t\tdrawLine(xpos[0], ypos[0], xpos[1], ypos[1]);\n\t\tdrawLine(xpos[0], ypos[0], xpos[0] + rx[0], ypos[0] + ry[0]);\n\t\tdrawLine(xpos[1], ypos[1], xpos[1] + rx[1], ypos[1] + ry[1]);\n\n\t\tdrawLine(xpos[2], ypos[2], xpos[3], ypos[3]);\n\t\tdrawLine(xpos[2], ypos[2], xpos[2] + rx[2], ypos[2] + ry[2]);\n\t\tdrawLine(xpos[3], ypos[3], xpos[3] + rx[3], ypos[3] + ry[3]);\n\n\t\tlet xmin = Vec.min(xpos), ymin = Vec.min(ypos);\n\t\tlet dist:number[] = [];\n\t\tfor (let n = 0; n < 4; n++) dist.push(xpos[n] - xmin + ypos[n] - ymin);\n\t\tlet idxN = Vec.idxMax(dist); // \"bottom right\" or equivalent\n\t\tdrawText(xpos[idxN] - rx[idxN], ypos[idxN] - ry[idxN], 'n');\n\n\t\tlet idxD2 = idxN + (idxN % 2 == 1 ? -1 : 1), idxD1 = (idxD2 + 2) % 4;\n\t\tdrawText(xpos[idxD1] - 0.5 * rx[idxD1], ypos[idxD1] - 0.5 * ry[idxD1], '*');\n\t\tdrawText(xpos[idxD2] - 0.5 * rx[idxD2], ypos[idxD2] - 0.5 * ry[idxD2], '*');\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {ExperimentComponent, ExperimentComponentType, ExperimentEntry} from '../aspect/Experiment';\nimport {ExperimentMeta, ExperimentMetaApplic} from '../data/ExperimentMeta';\nimport {Molecule} from '../data/Molecule';\nimport {MolUtil} from '../data/MolUtil';\nimport {QuantityCalc} from '../data/QuantityCalc';\nimport {Box, Pos, Size} from '../util/Geom';\nimport {realEqual} from '../util/util';\nimport {Vec} from '../util/Vec';\nimport {ArrangeMeasurement} from './ArrangeMeasurement';\nimport {ArrangeMolecule} from './ArrangeMolecule';\nimport {FontData} from './FontData';\nimport {RenderPolicy} from './Rendering';\n\n/*\n\tPerforms the layout of an experiment, which is a reaction that may be multistep, and contains a variety of\n\toptional annotations. The flow may be arranged from left-to-right or some combination of horizontal and vertical.\n\n\tThere are various tweaks for things that can be included or left out. The default settings reflect the default chemistry\n\trendering style, i.e. annotations and editing artifacts are not included.\n\n\tComponent characteristics such as quantities, and derived properties such as green metrics, are not a part of\n\tthe layout.\n*/\n\nexport enum ArrangeComponentType\n{\n\tArrow = 1, // side separator (horizontal or vertical)\n\tPlus = 2, // component separator\n\tReactant = 3, // primary reactant: molecule or name\n\tReagent = 4, // primary reagent: molecule or name\n\tProduct = 5, // primary product: molecule or name\n\tStepNote = 6, // additional information about the step (e.g. rxn conditions)\n}\n\nexport enum ArrangeComponentAnnot\n{\n\tNone = 0,\n\tPrimary = 1,\n\tWaste = 2,\n\tImplied = 3,\n}\n\nexport class ArrangeComponent\n{\n\tpublic type:ArrangeComponentType;\n\tpublic srcIdx:number; // index in underlying reactionsheet (i.e. reactants/reagents/products[srcIdx])\n\tpublic step:number;\t// which step it belongs to\n\tpublic side:number; // which side of the reaction (-1=left, 1=right, 0=middle)\n\tpublic mol:Molecule; // molecule content, if applicable\n\tpublic text:string[] = []; // text content, if applicable\n\tpublic leftNumer:string; // // to the left of the structure: may be {n}/{d} form\n\tpublic leftDenom:string;\n\tpublic fszText:number; // text font sizes, if applicable\n\tpublic fszLeft:number;\n\tpublic annot = ArrangeComponentAnnot.None; // annotation glyph on the right\n\tpublic monochromeColour:number = null; // cause the rendering to be done in a specific colour\n\tpublic metaInfo:Record<string, any> = null; // user-controlled\n\tpublic box = new Box(); // bounding box\n\tpublic padding:number; // how much padding around the outer boundary\n\n\tpublic clone():ArrangeComponent\n\t{\n\t\tlet dup = new ArrangeComponent();\n\t\tdup.type = this.type;\n\t\tdup.srcIdx = this.srcIdx;\n\t\tdup.step = this.step;\n\t\tdup.side = this.side;\n\t\tdup.mol = this.mol;\n\t\tdup.text = this.text;\n\t\tdup.leftNumer = this.leftNumer;\n\t\tdup.leftDenom = this.leftDenom;\n\t\tdup.fszText = this.fszText;\n\t\tdup.fszLeft = this.fszLeft;\n\t\tdup.annot = this.annot;\n\t\tdup.monochromeColour = this.monochromeColour;\n\t\tdup.metaInfo = this.metaInfo;\n\t\tdup.box = this.box.clone();\n\t\tdup.padding = this.padding;\n\t\treturn dup;\n\t}\n}\n\nconst PADDING = 0.25;\nconst PLUSSZ = 0.5;\nconst ARROW_W = 2;\nconst ARROW_H = 0.5;\nconst REAGENT_SCALE = 0.7;\nconst PLACEHOLDER_W = 2;\nconst PLACEHOLDER_H = 2;\n\nexport interface ArrangeExperimentFauxComponent\n{\n\tstep:number;\n\ttype:ArrangeComponentType;\n\tmol:Molecule;\n\tname?:string;\n\tannot?:ArrangeComponentAnnot;\n\tcolour?:number;\n\tmetaInfo?:any;\n}\n\nexport class ArrangeExperiment\n{\n\tpublic scale:number;\n\tpublic width = 0;\n\tpublic height = 0;\n\n\tpublic components:ArrangeComponent[] = [];\n\n\t// parameters to influence the drawing\n\tpublic limitTotalW = 1000;\n\tpublic limitTotalH = 1000;\n\tpublic limitStructW = 0;\n\tpublic limitStructH = 0;\n\tpublic includeReagents = true; // drawing of reagents alongside the arrow\n\tpublic includeNames = false; // including names of components alongside structures\n\tpublic includeStoich = true; // whether to include non-unity stoichiometry labels\n\tpublic includeAnnot = false; // whether to add annotations like primary/waste\n\tpublic includeBlank = false; // any section with no components gets a blank placeholder\n\tpublic includeDetails = false; // include information like yield, amount, metadata in the layout\n\tpublic includeAtomMap = false; // display atom mapping numbers\n\tpublic colourAtomMap = 0x9D1A76; // if above, use this colour\n\tpublic allowVertical = true; // permit vertical or bent arrangements\n\tpublic padding = 0;\n\tpublic fauxComponents:ArrangeExperimentFauxComponent[] = []; // extra components to add in by request\n\n\tpublic static COMP_GAP_LEFT = 0.5;\n\tpublic static COMP_ANNOT_SIZE = 1;\n\n\tprivate extraText:Record<string, string[]> = {}; // key {step:type:idx}\n\n\t// --------------------- public methods ---------------------\n\n\t// sets up the object with the mandatory information\n\tconstructor(public entry:ExperimentEntry, public measure:ArrangeMeasurement, public policy:RenderPolicy)\n\t{\n\t\tthis.scale = policy.data.pointScale;\n\t\tthis.limitStructW = this.limitStructH = this.scale * 10;\n\t\tthis.padding = PADDING * this.scale;\n\t}\n\n\t// optional text decoration to add to a particular component\n\tpublic includeExtraText(step:number, type:ExperimentComponentType, idx:number, txt:string):void\n\t{\n\t\tif (!txt) return;\n\t\tlet key = `${step}:${type}:${idx}`;\n\t\tthis.extraText[key] = Vec.append(this.extraText[key], txt);\n\t}\n\n\t// carries out the arrangement\n\tpublic arrange():void\n\t{\n\t\tthis.createComponents();\n\n\t\tlet fszText = this.scale * this.policy.data.fontSize, fszLeft = this.scale * this.policy.data.fontSize * 1.5;\n\n\t\t// do an initial sizing of most of the components\n\t\tfor (let xc of this.components)\n\t\t{\n\t\t\tif (xc.type == ArrangeComponentType.Plus) xc.box = new Box(0, 0, this.scale * PLUSSZ, this.scale * PLUSSZ);\n\t\t\telse if (xc.type == ArrangeComponentType.Arrow) {} // directional\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet w = 0, h = 0;\n\t\t\t\tif (MolUtil.notBlank(xc.mol))\n\t\t\t\t{\n\t\t\t\t\tlet sz = Size.fromArray(ArrangeMolecule.guestimateSize(xc.mol, this.policy));\n\t\t\t\t\tif (xc.type == ArrangeComponentType.Reagent) sz.scaleBy(REAGENT_SCALE);\n\t\t\t\t\tif (xc.leftNumer)\n\t\t\t\t\t{\n\t\t\t\t\t\txc.fszLeft = fszLeft;\n\t\t\t\t\t\tlet wad = this.measure.measureText(xc.leftNumer, fszLeft);\n\t\t\t\t\t\tlet lw = wad[0], lh = wad[1] + wad[2];\n\t\t\t\t\t\tif (xc.leftDenom) lw = Math.max(lw, this.measure.measureText(xc.leftDenom, fszLeft)[0]);\n\t\t\t\t\t\tsz.w += lw + ArrangeExperiment.COMP_GAP_LEFT * lh; // lineHeight=some extra spacing\n\t\t\t\t\t\tsz.h = Math.max(sz.h, lh * (xc.leftDenom ? 2 : 1));\n\t\t\t\t\t}\n\t\t\t\t\tsz.fitInto(this.limitStructW, this.limitStructH);\n\t\t\t\t\tw = sz.w;\n\t\t\t\t\th = sz.h;\n\t\t\t\t}\n\t\t\t\tif (Vec.notBlank(xc.text))\n\t\t\t\t{\n\t\t\t\t\tif (MolUtil.notBlank(xc.mol)) h += 0.5 * fszText;\n\t\t\t\t\tfor (let line of xc.text)\n\t\t\t\t\t{\n\t\t\t\t\t\txc.fszText = fszText;\n\t\t\t\t\t\tlet wad = this.measure.measureText(line, fszText);\n\t\t\t\t\t\tw = Math.max(w, wad[0]);\n\t\t\t\t\t\th += wad[1] + wad[2];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (xc.annot != 0) w += ArrangeExperiment.COMP_ANNOT_SIZE * this.scale;\n\t\t\t\tif ((MolUtil.isBlank(xc.mol) && !xc.text && this.includeBlank) || w == 0 || h == 0)\n\t\t\t\t{\n\t\t\t\t\tw = Math.max(w, PLACEHOLDER_W * this.scale);\n\t\t\t\t\th = Math.max(h, PLACEHOLDER_H * this.scale);\n\t\t\t\t}\n\t\t\t\txc.box = new Box(0, 0, w, h);\n\t\t\t}\n\n\t\t\t// give it breathing room\n\t\t\txc.padding = this.padding;\n\t\t\txc.box = new Box(0, 0, xc.box.w + 2 * this.padding, xc.box.h + 2 * this.padding);\n\t\t}\n\n\t\t// build several permutations; take the best one\n\t\t// note: bend=1 for completely vertical, bend=2 for switch after first step, bend=#steps+1 for linear\n\t\tif (this.allowVertical)\n\t\t{\n\t\t\tlet best:ArrangeComponent[] = null;\n\t\t\tlet bestScore = 0;\n\t\t\tfor (let bend = this.entry.steps.length + 1; bend >= 1; bend--) for (let vert = 0; vert <= 1; vert++)\n\t\t\t{\n\t\t\t\tlet trial:ArrangeComponent[] = [];\n\t\t\t\tfor (let xc of this.components) trial.push(xc.clone());\n\t\t\t\tthis.arrangeComponents(trial, bend, vert > 0);\n\n\t\t\t\tlet score = this.scoreArrangement(trial);\n\t\t\t\tif (best == null || score > bestScore)\n\t\t\t\t{\n\t\t\t\t\tbest = trial;\n\t\t\t\t\tbestScore = score;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.components = best;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.arrangeComponents(this.components, this.entry.steps.length + 1, false);\n\t\t}\n\n\t\t// ascertain the limits\n\t\tthis.width = this.height = 0;\n\t\tfor (let xc of this.components)\n\t\t{\n\t\t\tthis.width = Math.max(this.width, xc.box.maxX());\n\t\t\tthis.height = Math.max(this.height, xc.box.maxY());\n\t\t}\n\t}\n\n\t// access to content\n\tpublic get numComponents():number {return this.components.length;}\n\tpublic getComponent(idx:number):ArrangeComponent {return this.components[idx];}\n\tpublic getComponents():ArrangeComponent[] {return this.components;}\n\n\t// resize the whole thing\n\tpublic scaleComponents(modScale:number):void\n\t{\n\t\tif (modScale == 1) return;\n\n\t\tthis.scale *= modScale;\n\t\tthis.width *= modScale;\n\t\tthis.height *= modScale;\n\t\tfor (let xc of this.components)\n\t\t{\n\t\t\txc.box.scaleBy(modScale);\n\t\t\txc.fszText *= modScale;\n\t\t\txc.fszLeft *= modScale;\n\t\t\txc.padding *= modScale;\n\t\t}\n\t}\n\n\t// convenience: convert arrangment type to its experiment counterpart, if applicable\n\tpublic static toExpType(compType:ArrangeComponentType):ExperimentComponentType\n\t{\n\t\tif (compType == ArrangeComponentType.Reactant) return ExperimentComponentType.Reactant;\n\t\tif (compType == ArrangeComponentType.Reagent) return ExperimentComponentType.Reagent;\n\t\tif (compType == ArrangeComponentType.Product) return ExperimentComponentType.Product;\n\t\treturn null;\n\t}\n\n\t// --------------------- private methods ---------------------\n\n\t// instantiate each component in the diagram (which includes pluses and arrows)\n\tprivate createComponents():void\n\t{\n\t\t// step 0: the only place where reactants come from\n\t\tfor (let n = 0; n < this.entry.steps[0].reactants.length; n++)\n\t\t{\n\t\t\tif (n > 0) this.createSegregator(ArrangeComponentType.Plus, 0, -1);\n\t\t\tthis.createReactant(n, 0);\n\t\t}\n\t\tif (this.components.length == 0 && this.includeBlank) this.createBlank(ArrangeComponentType.Reactant, 0);\n\n\t\t// reagents & products for each step\n\t\tfor (let s = 0; s < this.entry.steps.length; s++)\n\t\t{\n\t\t\tthis.createSegregator(ArrangeComponentType.Arrow, s, 0);\n\t\t\tif (this.includeReagents)\n\t\t\t{\n\t\t\t\tlet any = false;\n\t\t\t\tfor (let n = 0; n < this.entry.steps[s].reagents.length; n++)\n\t\t\t\t{\n\t\t\t\t\tthis.createReagent(n, s);\n\t\t\t\t\tany = true;\n\t\t\t\t}\n\t\t\t\tif (!any && this.includeBlank) this.createBlank(ArrangeComponentType.Reagent, s);\n\t\t\t}\n\t\t\tif (this.includeDetails) this.createStepMeta(s);\n\n\t\t\tlet any = false;\n\t\t\tfor (let n = 0; n < this.entry.steps[s].products.length; n++)\n\t\t\t{\n\t\t\t\tif (n > 0) this.createSegregator(ArrangeComponentType.Plus, s, 1);\n\t\t\t\tthis.createProduct(n, s);\n\t\t\t\tany = true;\n\t\t\t}\n\t\t\tif (!any && this.includeBlank) this.createBlank(ArrangeComponentType.Product, s);\n\t\t}\n\n\t\t// faux-components\n\t\tfor (let fc of this.fauxComponents)\n\t\t{\n\t\t\tif (fc.type == ArrangeComponentType.Reactant) this.createSegregator(ArrangeComponentType.Plus, fc.step, -1);\n\t\t\telse if (fc.type == ArrangeComponentType.Product) this.createSegregator(ArrangeComponentType.Plus, fc.step, 1);\n\t\t\tthis.createFauxComponent(fc);\n\t\t}\n\t}\n\n\tprivate createReactant(idx:number, step:number):void\n\t{\n\t\tlet comp = this.entry.steps[step].reactants[idx];\n\n\t\tlet xc = new ArrangeComponent();\n\t\txc.type = ArrangeComponentType.Reactant;\n\t\txc.srcIdx = idx;\n\t\txc.step = step;\n\t\txc.side = -1;\n\t\tif (MolUtil.notBlank(comp.mol)) xc.mol = comp.mol;\n\t\tif (comp.name && (this.includeNames || MolUtil.isBlank(comp.mol))) xc.text = this.wordWrapName(comp.name, xc.mol);\n\t\tif (this.includeDetails) this.supplementText(xc, comp);\n\n\t\tif (MolUtil.notBlank(comp.mol) && this.includeStoich && !QuantityCalc.isStoichZero(comp.stoich) && !QuantityCalc.isStoichUnity(comp.stoich))\n\t\t{\n\t\t\tlet slash = comp.stoich.indexOf('/');\n\t\t\tif (slash >= 0)\n\t\t\t{\n\t\t\t\txc.leftNumer = comp.stoich.substring(0, slash);\n\t\t\t\txc.leftDenom = comp.stoich.substring(slash + 1);\n\t\t\t}\n\t\t\telse xc.leftNumer = comp.stoich;\n\t\t}\n\t\tif (this.includeAnnot && MolUtil.notBlank(comp.mol) && comp.primary) xc.annot = ArrangeComponentAnnot.Primary;\n\n\t\tlet key = `${step}:${ExperimentComponentType.Reactant}:${idx}`;\n\t\txc.text.push(...(this.extraText[key] ?? []));\n\n\t\tthis.components.push(xc);\n\t}\n\tprivate createReagent(idx:number, step:number):void\n\t{\n\t\tlet comp = this.entry.steps[step].reagents[idx];\n\n\t\tlet xc = new ArrangeComponent();\n\t\txc.type = ArrangeComponentType.Reagent;\n\t\txc.srcIdx = idx;\n\t\txc.step = step;\n\t\txc.side = 0;\n\t\tif (MolUtil.notBlank(comp.mol)) xc.mol = comp.mol;\n\t\tif (comp.name && (this.includeNames || MolUtil.isBlank(comp.mol))) xc.text = this.wordWrapName(comp.name, xc.mol);\n\t\tif (this.includeDetails) this.supplementText(xc, comp);\n\n\t\tif (this.includeAnnot)\n\t\t{\n\t\t\tlet stoich = QuantityCalc.impliedReagentStoich(comp, this.entry.steps[step].products);\n\t\t\tif (stoich > 0) xc.annot = ArrangeComponentAnnot.Implied;\n\t\t\tif (stoich > 0 && stoich != 1)\n\t\t\t{\n\t\t\t\tif (realEqual(stoich, Math.round(stoich)))\n\t\t\t\t\txc.leftNumer = Math.round(stoich).toString();\n\t\t\t\telse\n\t\t\t\t\txc.leftNumer = stoich.toString(); // TODO: use ratio instead, this can be ugly\n\t\t\t}\n\t\t}\n\n\t\tlet key = `${step}:${ExperimentComponentType.Reagent}:${idx}`;\n\t\txc.text.push(...(this.extraText[key] ?? []));\n\n\t\tthis.components.push(xc);\n\t}\n\tprivate createProduct(idx:number, step:number):void\n\t{\n\t\tlet comp = this.entry.steps[step].products[idx];\n\n\t\tlet xc = new ArrangeComponent();\n\t\txc.type = ArrangeComponentType.Product;\n\t\txc.srcIdx = idx;\n\t\txc.step = step;\n\t\txc.side = 1;\n\t\tif (MolUtil.notBlank(comp.mol)) xc.mol = comp.mol;\n\t\tif (comp.name && (this.includeNames || MolUtil.isBlank(comp.mol))) xc.text = this.wordWrapName(comp.name, xc.mol);\n\t\tif (this.includeDetails) this.supplementText(xc, comp);\n\n\t\tif (this.includeStoich && !QuantityCalc.isStoichZero(comp.stoich) && !QuantityCalc.isStoichUnity(comp.stoich))\n\t\t{\n\t\t\tlet slash = comp.stoich.indexOf('/');\n\t\t\tif (slash >= 0)\n\t\t\t{\n\t\t\t\txc.leftNumer = comp.stoich.substring(0, slash);\n\t\t\t\txc.leftDenom = comp.stoich.substring(slash + 1);\n\t\t\t}\n\t\t\telse xc.leftNumer = comp.stoich;\n\t\t}\n\t\tif (this.includeAnnot && MolUtil.notBlank(comp.mol) && comp.waste) xc.annot = ArrangeComponentAnnot.Waste;\n\n\t\tlet key = `${step}:${ExperimentComponentType.Product}:${idx}`;\n\t\txc.text.push(...(this.extraText[key] ?? []));\n\n\t\tthis.components.push(xc);\n\t}\n\tprivate createSegregator(type:ArrangeComponentType, step:number, side:number):void\n\t{\n\t\tlet xc = new ArrangeComponent();\n\t\txc.type = type;\n\t\txc.step = step;\n\t\txc.side = side;\n\t\tthis.components.push(xc);\n\t}\n\tprivate createStepMeta(step:number):void\n\t{\n\t\tlet lines:string[] = [];\n\t\tfor (let [type, value] of ExperimentMeta.unpackMeta(this.entry.steps[step].meta))\n\t\t{\n\t\t\tif (!Vec.safeArray(ExperimentMeta.APPLICABILITY[type]).includes(ExperimentMetaApplic.Step)) continue;\n\t\t\tlet descr = ExperimentMeta.describeMeta(type, value);\n\t\t\tif (descr != null) lines.push(descr);\n\t\t}\n\t\tif (lines.length == 0) return;\n\n\t\tlet xc = new ArrangeComponent();\n\t\txc.type = ArrangeComponentType.StepNote;\n\t\txc.step = step;\n\t\txc.side = 0;\n\t\txc.text = lines;\n\t\tthis.components.push(xc);\n\t}\n\tprivate createBlank(type:number, step:number):void\n\t{\n\t\tlet xc = new ArrangeComponent();\n\t\txc.type = type;\n\t\txc.step = step;\n\t\txc.side = type == ArrangeComponentType.Reactant ? -1 : type == ArrangeComponentType.Product ? 1 : 0;\n\t\txc.srcIdx = -1;\n\t\tthis.components.push(xc);\n\t}\n\tprivate createFauxComponent(fc:ArrangeExperimentFauxComponent):void\n\t{\n\t\tlet xc = new ArrangeComponent();\n\t\txc.type = fc.type;\n\t\txc.srcIdx = -1;\n\t\txc.step = fc.step;\n\t\txc.side = fc.type == ArrangeComponentType.Reactant ? -1 : fc.type == ArrangeComponentType.Product ? 1 : 0;\n\t\txc.mol = fc.mol;\n\t\tif (fc.name) xc.text = [fc.name];\n\t\tif (fc.annot) xc.annot = fc.annot;\n\t\txc.monochromeColour = fc.colour;\n\t\txc.metaInfo = fc.metaInfo;\n\t\tthis.components.push(xc);\n\t}\n\n\tprivate arrangeComponents(comps:ArrangeComponent[], bendStep:number, vertComp:boolean):void\n\t{\n\t\tlet blkMain:ArrangeComponent[][] = [];\n\t\tlet blkArrow:ArrangeComponent[][] = [];\n\t\tlet szMain:Size[] = [], szArrow:Size[] = [];\n\t\tlet midMain:Pos[] = [], midArrow:Pos[] = [];\n\n\t\tblkMain.push(this.gatherBlock(comps, 0, -1));\n\t\tszMain.push(this.arrangeMainBlock(blkMain[0], vertComp));\n\t\tmidMain.push(this.findMidBlock(blkMain[0], szMain[0]));\n\n\t\tfor (let n = 0; n < this.entry.steps.length; n++)\n\t\t{\n\t\t\tlet bent = n + 1 >= bendStep;\n\n\t\t\tblkMain.push(this.gatherBlock(comps, n, 1));\n\t\t\tszMain.push(this.arrangeMainBlock(blkMain[n + 1], vertComp && !bent));\n\t\t\tmidMain.push(this.findMidBlock(blkMain[n + 1], szMain[n + 1]));\n\n\t\t\tblkArrow.push(this.gatherBlock(comps, n, 0));\n\t\t\tif (!bent)\n\t\t\t\tszArrow.push(this.arrangeHorizontalArrowBlock(blkArrow[n]));\n\t\t\telse\n\t\t\t\tszArrow.push(this.arrangeVerticalArrowBlock(blkArrow[n]));\n\t\t\tmidArrow.push(this.findMidBlock(blkArrow[n], szArrow[n]));\n\t\t}\n\n\t\t// part 1: arrange the first step(s) left-to-right\n\n\t\tlet midH = 0;\n\t\tfor (let n = 0; n < bendStep; n++)\n\t\t{\n\t\t\tmidH = Math.max(midH, midMain[n].y);\n\t\t\tif (n > 0) midH = Math.max(midH, midArrow[n - 1].y);\n\t\t}\n\t\tlet sz = Size.zero();\n\t\tfor (let n = 0; n < bendStep; n++)\n\t\t{\n\t\t\tsz.w += szMain[n].w;\n\t\t\tsz.h = Math.max(sz.h, midH + (szMain[n].h - midMain[n].y));\n\t\t\tif (n > 0)\n\t\t\t{\n\t\t\t\tsz.w += szArrow[n - 1].w;\n\t\t\t\tsz.h = Math.max(sz.h, midH + (szArrow[n - 1].h - midArrow[n - 1].y));\n\t\t\t}\n\t\t}\n\n\t\tlet x = 0, arrowX = 0;\n\t\tfor (let n = 0; n < bendStep; n++)\n\t\t{\n\t\t\tif (n > 0)\n\t\t\t{\n\t\t\t\tthis.originateBlock(blkArrow[n - 1], x, midH - midArrow[n - 1].y);\n\t\t\t\tx += szArrow[n - 1].w;\n\t\t\t}\n\n\t\t\tthis.originateBlock(blkMain[n], x, midH - midMain[n].y);\n\t\t\tarrowX = x + midMain[n].x;\n\t\t\tx += szMain[n].w;\n\t\t}\n\n\t\t// part 2: arrange the remaining steps top-down\n\n\t\tlet y = sz.h, lowX = 0;\n\t\tfor (let n = bendStep; n <= this.entry.steps.length; n++)\n\t\t{\n\t\t\tx = arrowX - midArrow[n - 1].x;\n\t\t\tlowX = Math.min(lowX, x);\n\t\t\tthis.originateBlock(blkArrow[n - 1], x, y);\n\t\t\ty += szArrow[n - 1].h;\n\t\t\tsz.w = Math.max(sz.w, x + szArrow[n - 1].w);\n\n\t\t\tx = arrowX - midMain[n].x;\n\t\t\tlowX = Math.min(lowX, x);\n\t\t\tthis.originateBlock(blkMain[n], x, y);\n\t\t\ty += szMain[n].h;\n\t\t\tsz.w = Math.max(sz.w, x + szMain[n].w);\n\t\t}\n\n\t\t// need to post-correct sometimes with wide products\n\t\tif (lowX < 0)\n\t\t{\n\t\t\tfor (let xc of comps) xc.box.x -= lowX;\n\t\t}\n\t}\n\n\t// enumerate blocks of specific type\n\tprivate gatherBlock(comps:ArrangeComponent[], step:number, side:number):ArrangeComponent[]\n\t{\n\t\tlet block:ArrangeComponent[] = [];\n\t\tfor (let xc of comps) if (xc.side == side && xc.step == step) block.push(xc);\n\t\treturn block;\n\t}\n\n\t// fit out all individual components, horizontally or vertically\n\tprivate arrangeMainBlock(block:ArrangeComponent[], vertComp:boolean):Size\n\t{\n\t\tlet sz = Size.zero();\n\t\tif (!vertComp)\n\t\t{\n\t\t\tfor (let xc of block)\n\t\t\t{\n\t\t\t\tsz.w += xc.box.w;\n\t\t\t\tsz.h = Math.max(sz.h, xc.box.h);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (let xc of block)\n\t\t\t{\n\t\t\t\tsz.w = Math.max(sz.w, xc.box.w);\n\t\t\t\tsz.h += xc.box.h;\n\t\t\t}\n\t\t}\n\n\t\tsz.w = Math.max(sz.w, this.scale * 2.0);\n\t\tsz.h = Math.max(sz.h, this.scale * 2.0);\n\n\t\tif (!vertComp)\n\t\t{\n\t\t\tlet x = 0;\n\t\t\tfor (let xc of block)\n\t\t\t{\n\t\t\t\txc.box.x = x;\n\t\t\t\txc.box.y = 0.5 * (sz.h - xc.box.h);\n\t\t\t\tx += xc.box.w;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet y = 0;\n\t\t\tfor (let xc of block)\n\t\t\t{\n\t\t\t\txc.box.x = 0.5 * (sz.w - xc.box.w);\n\t\t\t\txc.box.y = y;\n\t\t\t\ty += xc.box.h;\n\t\t\t}\n\t\t}\n\n\t\treturn sz;\n\t}\n\n\t// arrange an arrow, and the associated reagents\n\tprivate arrangeHorizontalArrowBlock(block:ArrangeComponent[]):Size\n\t{\n\t\tlet arrow:ArrangeComponent = null;\n\t\tfor (let xc of block) if (xc.type == ArrangeComponentType.Arrow)\n\t\t{\n\t\t\tarrow = xc;\n\t\t\txc.box.w = ARROW_W * this.scale + 2 * xc.padding;\n\t\t\txc.box.h = ARROW_H * this.scale + 2 * xc.padding;\n\t\t}\n\n\t\tlet mid = block.length >> 1; // (could vote by height?)\n\n\t\tfor (let xc of block) arrow.box.w = Math.max(xc.box.w, arrow.box.w);\n\n\t\tlet sz = Size.zero();\n\n\t\tlet n = 0;\n\t\tlet y = 0;\n\t\tlet arrowPlaced = false;\n\t\tfor (let xc of block) if (xc.type != ArrangeComponentType.Arrow)\n\t\t{\n\t\t\txc.box.x = 0.5 * (arrow.box.w - xc.box.w);\n\t\t\txc.box.y = y;\n\t\t\ty += xc.box.h;\n\n\t\t\tn++;\n\t\t\tif (n == mid)\n\t\t\t{\n\t\t\t\tarrow.box.x = 0;\n\t\t\t\tarrow.box.y = y;\n\t\t\t\ty += arrow.box.h;\n\t\t\t\tarrowPlaced = true;\n\t\t\t}\n\t\t}\n\t\tif (!arrowPlaced)\n\t\t{\n\t\t\tarrow.box.x = 0;\n\t\t\tarrow.box.y = y;\n\t\t\ty += arrow.box.h;\n\t\t}\n\t\tsz.w = arrow.box.w;\n\t\tsz.h = y;\n\n\t\treturn sz;\n\t}\n\n\tprivate arrangeVerticalArrowBlock(block:ArrangeComponent[]):Size\n\t{\n\t\tlet arrow:ArrangeComponent = null;\n\t\tfor (let xc of block) if (xc.type == ArrangeComponentType.Arrow)\n\t\t{\n\t\t\tarrow = xc;\n\t\t\txc.box.w = ARROW_H * this.scale + 2 * xc.padding;\n\t\t\txc.box.h = ARROW_W * this.scale + 2 * xc.padding;\n\t\t}\n\n\t\tlet mid = block.length >> 1; // (could vote by height?)\n\n\t\tlet sz1 = Size.zero(), sz2 = Size.zero();\n\t\tlet n = 0;\n\t\tfor (let xc of block) if (xc.type != ArrangeComponentType.Arrow)\n\t\t{\n\t\t\tif (n < mid)\n\t\t\t{\n\t\t\t\tsz1.w = Math.max(sz1.w, xc.box.w);\n\t\t\t\tsz1.h += xc.box.h;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsz2.w = Math.max(sz2.w, xc.box.w);\n\t\t\t\tsz2.h += xc.box.h;\n\t\t\t}\n\t\t\tn++;\n\t\t}\n\n\t\tlet sz = new Size(sz1.w + sz2.w + arrow.box.w, Math.max(arrow.box.h, Math.max(sz1.h, sz2.h)));\n\t\tarrow.box = new Box(sz1.w, 0, arrow.box.w, sz.h);\n\n\t\tlet y1 = 0.5 * (sz.h - sz1.h), y2 = 0.5 * (sz.h - sz2.h);\n\t\tn = 0;\n\t\tfor (let xc of block) if (xc.type != ArrangeComponentType.Arrow)\n\t\t{\n\t\t\tif (n < mid)\n\t\t\t{\n\t\t\t\txc.box.x = sz1.w - xc.box.w;\n\t\t\t\txc.box.y = y1;\n\t\t\t\ty1 += xc.box.h;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\txc.box.x = sz.w - sz2.w;\n\t\t\t\txc.box.y = y2;\n\t\t\t\ty2 += xc.box.h;\n\t\t\t}\n\t\t\tn++;\n\t\t}\n\n\t\treturn sz;\n\t}\n\n\t// find the \"reference middle\" of a block, which is based on pluses and arrows\n\tprivate findMidBlock(block:ArrangeComponent[], sz:Size):Pos\n\t{\n\t\tlet count = 0;\n\t\tlet mid = Pos.zero();\n\t\tfor (let xc of block) if (xc.type == ArrangeComponentType.Plus || xc.type == ArrangeComponentType.Arrow)\n\t\t{\n\t\t\tmid.x += xc.box.midX();\n\t\t\tmid.y += xc.box.midY();\n\t\t\tcount++;\n\t\t}\n\t\tif (count == 0)\n\t\t{\n\t\t\tmid.x = 0.5 * sz.w;\n\t\t\tmid.y = 0.5 * sz.h;\n\t\t}\n\t\telse if (count > 1)\n\t\t{\n\t\t\tlet inv = 1.0 / count;\n\t\t\tmid.x *= inv;\n\t\t\tmid.y *= inv;\n\t\t}\n\t\treturn mid;\n\t}\n\n\t// determine how good a particular arrangement is\n\tprivate scoreArrangement(comps:ArrangeComponent[]):number\n\t{\n\t\tlet w = 0, h = 0;\n\t\tfor (let xc of comps)\n\t\t{\n\t\t\tw = Math.max(w, xc.box.maxX());\n\t\t\th = Math.max(h, xc.box.maxY());\n\t\t}\n\n\t\tlet score = 0;\n\n\t\t// want the width to be as close as possible to the limiting width\n\t\tscore -= Math.max(0, Math.abs(w - this.limitTotalW));\n\n\t\t// .. and height?\n\t\t//score -= Math.max(0, Math.abs(h - this.limitTotalH));\n\n\t\t// (anything else that matters?)\n\n\t\treturn score;\n\t}\n\n\t// moves all components in a block\n\tprivate originateBlock(block:ArrangeComponent[], x:number, y:number):void\n\t{\n\t\tfor (let xc of block)\n\t\t{\n\t\t\txc.box.x += x;\n\t\t\txc.box.y += y;\n\t\t}\n\t}\n\n\t// add in other text information about the comment, if desired\n\tprivate supplementText(xc:ArrangeComponent, comp:ExperimentComponent):void\n\t{\n\t\tif (comp.mass > 0) xc.text.push(QuantityCalc.formatMass(comp.mass));\n\t\tif (comp.volume > 0) xc.text.push(QuantityCalc.formatVolume(comp.volume));\n\t\tif (comp.moles > 0) xc.text.push(QuantityCalc.formatMoles(comp.moles));\n\t\t//if (comp.density > 0) xc.text.push(QuantityCalc.formatDensity(comp.density));\n\t\tif (comp.conc > 0) xc.text.push(QuantityCalc.formatConc(comp.conc));\n\t\tif (comp.yield != null && comp.yield >= 0) xc.text.push(QuantityCalc.formatPercent(comp.yield));\n\t\tif (comp.equiv > 0) xc.text.push(QuantityCalc.formatEquiv(comp.equiv));\n\n\t\tfor (let [type, value] of ExperimentMeta.unpackMeta(comp.meta))\n\t\t{\n\t\t\tlet descr = ExperimentMeta.describeMeta(type, value);\n\t\t\tif (descr) xc.text.push(descr);\n\t\t}\n\t}\n\n\tprivate wordWrapName(name:string, mol:Molecule):string[]\n\t{\n\t\tlet minLimW = 0;\n\t\tif (MolUtil.notBlank(mol)) minLimW = (mol.boundary().w + 2) * this.scale;\n\t\tlet limW = Math.max(minLimW, 10 * this.scale);\n\t\tlet fsz = this.scale * this.policy.data.fontSize;\n\n\t\tlet w = this.measure.measureText(name, fsz)[0];\n\t\tif (w < limW) return [name];\n\n\t\tlet wrap = ():[string[], number] =>\n\t\t{\n\t\t\tlet lines:string[] = [], residual = name, nclean = 0;\n\t\t\twhile (residual.length > 0)\n\t\t\t{\n\t\t\t\tlet wsz = FontData.measureWidths(residual, fsz);\n\t\t\t\tlet pos = 0;\n\t\t\t\twhile (pos < wsz.length && wsz[pos] < limW) pos++;\n\t\t\t\tfor (let n = pos; n > 5; n--)\n\t\t\t\t{\n\t\t\t\t\tif (residual[n] == ' ') {pos = n; nclean++; break;}\n\t\t\t\t\tif (wsz[n] < limW * 0.8) break;\n\t\t\t\t}\n\t\t\t\tlines.push(residual.substring(0, pos));\n\t\t\t\tresidual = residual.substring(pos).trimLeft();\n\t\t\t}\n\t\t\treturn [lines, nclean];\n\t\t};\n\n\t\tlet [lines, nclean] = wrap();\n\t\tfor (; limW > 50; limW -= fsz)\n\t\t{\n\t\t\tlet [tryLines, tryClean] = wrap();\n\t\t\tif (tryLines.length > lines.length) break;\n\t\t\tif (tryClean >= nclean) [lines, nclean] = [tryLines, tryClean];\n\t\t}\n\t\treturn lines;\n\t}\n}\n\n","/*\n\tWebMolKit\n\n\t(c) 2010-2018 Molecular Materials Informatics, Inc.\n\n\tAll rights reserved\n\n\thttp://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Box} from '../util/Geom';\nimport {colourAlpha, colourCanvas, colourCode, DEGRAD, newElement, pixelDensity} from '../util/util';\nimport {Vec} from '../util/Vec';\nimport {FontData, FontDataNativeOpt} from './FontData';\n\n/*\n\tMetaVector: allows the construction of a set of drawing primitives of the most basic variety. These are collected together so that they can be analyzed,\n\te.g. finding the precise boundary, and optionally transformed or spooled into other such instances.\n\n\tRendering can be done by creating an SVG instance reflecting the content, or writing onto an HTML canvas using drawing primitives.\n\n\tSeparation of type & object is done in order to optimise SVG creation: when a lot of objects with the same characteristics (e.g. fill/outline) are consecutive,\n\tthis allows them to be grouped together without repeating unnecessary information.\n\n\tLine, Rect & Oval objects are fairly self-explanatory.\n\n\tText objects are handled unusually: they correspond to internally-defined paths, so they can be measured *precisely* without knowing the rendering context\n\tahead of time. This means that the font options are limited, but for most chemistry rendering tasks, this is not a dealbreaker.\n\n\tTextNative is to be used in cases where the font should match other renderings on the device, e.g. HTML text & MetaVector text should be drawn in the same\n\tway. The font is specified using the CSS style, which is the same for SVG & canvas. Measurement of the native text is done by making a fake invisible background\n\tcanvas which is specific to the current HTML environment. Rendering on another device does not guarantee the same metrics, so caution must be exercised.\n*/\n\nexport enum TextAlign\n{\n\tCentre = 0,\n\tLeft = 1,\n\tRight = 2,\n\tBaseline = 0,\n\tMiddle = 4,\n\tTop = 8,\n\tBottom = 16\n}\n\nenum PrimClass\n{\n\tLine = 1,\n\tRect = 2,\n\tOval = 3,\n\tPath = 4,\n\tText = 5,\n\tTextNative = 6,\n}\n\ninterface PrimBase\n{\n\tprimClass:PrimClass;\n\ttypeidx:number;\n}\ninterface TypeBase\n{\n\tprimClass:PrimClass;\n}\n\ninterface LinePrim extends PrimBase\n{\n\tx1:number;\n\ty1:number;\n\tx2:number;\n\ty2:number;\n}\ninterface LineType extends TypeBase\n{\n\tthickness:number;\n\tcolour:number;\n}\n\ninterface RectPrim extends PrimBase\n{\n\tx:number;\n\ty:number;\n\tw:number;\n\th:number;\n}\ninterface RectType extends TypeBase\n{\n\tedgeCol:number;\n\tfillCol:number;\n\tthickness:number;\n}\n\ninterface OvalPrim extends PrimBase\n{\n\tcx:number;\n\tcy:number;\n\trw:number;\n\trh:number;\n}\ninterface OvalType extends TypeBase\n{\n\tedgeCol:number;\n\tfillCol:number;\n\tthickness:number;\n}\n\ninterface PathPrim extends PrimBase\n{\n\tcount:number;\n\tx:number[];\n\ty:number[];\n\tctrl:boolean[];\n\tclosed:boolean;\n}\ninterface PathType extends TypeBase\n{\n\tedgeCol:number;\n\tfillCol:number;\n\tthickness:number;\n\thardEdge:boolean;\n}\n\ninterface TextPrim extends PrimBase\n{\n\tx:number;\n\ty:number;\n\ttxt:string;\n\tdirection:number;\n}\ninterface TextType extends TypeBase\n{\n\tsize:number;\n\tcolour:number;\n}\n\ninterface TextNativePrim extends PrimBase\n{\n\tx:number;\n\ty:number;\n\ttxt:string;\n}\ninterface TextNativeType extends TypeBase\n{\n\tfamily:string;\n\tsize:number;\n\tcolour:number;\n\topt:FontDataNativeOpt;\n}\n\nclass SpoolSVG\n{\n\tprivate lines:string[] = [];\n\tprivate depth = 0;\n\n\tconstructor(private prettyPrint:boolean) {}\n\tpublic spool(str:string) {if (str?.length > 0) this.lines.push(str);}\n\tpublic start(str:string):void\n\t{\n\t\tif (this.prettyPrint && this.depth > 0) this.lines.push('  '.repeat(this.depth));\n\t\tthis.spool(str);\n\t}\n\tpublic stop(str:string):void\n\t{\n\t\tthis.spool(str);\n\t\tif (this.prettyPrint) this.lines.push('\\n');\n\t}\n\tpublic whole(str:string):void\n\t{\n\t\tif (this.prettyPrint && this.depth > 0) this.lines.push('  '.repeat(this.depth));\n\t\tthis.spool(str);\n\t\tif (this.prettyPrint) this.lines.push('\\n');\n\n\t}\n\tpublic attr(key:string, val:string | number):void\n\t{\n\t\tif (typeof val == 'number')\n\t\t{\n\t\t\tval = val.toFixed(4);\n\t\t\tlet match = /^(.*\\.\\d*?[1-9]+)0+$/.exec(val) ?? /^(.*)\\.0+$/.exec(val);\n\t\t\tif (match) val = match[1];\n\t\t}\n\t\tthis.spool(` ${key}=\"${val}\"`);\n\t}\n\tpublic inc():void {this.depth++;}\n\tpublic dec():void {this.depth--;}\n\tpublic toString():string {return this.lines.join('');}\n}\n\nexport class MetaVector\n{\n\t//private ONE_THIRD = 1.0 / 3;\n\n\tpublic static NOCOLOUR = -1;\n\n\tprivate types:TypeBase[] = [];\n\tprivate prims:PrimBase[] = [];\n\tprivate typeObj:TypeBase[];\n\tpublic width:number = 0;\n\tpublic height:number = 0;\n\tpublic offsetX = 0;\n\tpublic offsetY = 0;\n\tpublic scale = 1;\n\tpublic density = 1;\n\n\tprivate charMask:boolean[];\n\tprivate charMissing = false;\n\tprivate lowX:number = null;\n\tprivate lowY:number = null;\n\tprivate highX:number = null;\n\tprivate highY:number = null;\n\n\t// ------------ public methods ------------\n\n\tconstructor(vec?:any)\n\t{\n\t\tconst font = FontData.main;\n\n\t\tthis.charMask = Vec.booleanArray(false, font.UNICODE.length);\n\n\t\tif (vec != null)\n\t\t{\n\t\t\tif (vec.size != null)\n\t\t\t{\n\t\t\t\tthis.width = vec.size[0];\n\t\t\t\tthis.height = vec.size[1];\n\t\t\t}\n\t\t\tif (vec.types != null) this.types = vec.types;\n\t\t\tif (vec.prims != null) this.prims = vec.prims;\n\n\t\t\t// extract char-mask\n\t\t\tfor (let p of this.prims) if (p.primClass == PrimClass.Text)\n\t\t\t{\n\t\t\t\tlet {txt} = (p as TextPrim);\n\t\t\t\tfor (let n = 0; n < txt.length; n++)\n\t\t\t\t{\n\t\t\t\t\tlet i = font.getIndex(txt.charAt(n));\n\t\t\t\t\tif (i >= 0) this.charMask[i] = true; else this.charMissing = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// methods for adding a primitive (and possibly a type to go with it)\n\tpublic drawLine(x1:number, y1:number, x2:number, y2:number, colour:number, thickness:number):void\n\t{\n\t\tif (thickness == null) thickness = 1;\n\t\tlet typeidx = this.findOrCreateType({primClass: PrimClass.Line, thickness, colour} as LineType);\n\n\t\tconst bump = 0.5 * thickness;\n\t\tthis.updateBounds(Math.min(x1, x2) - bump, Math.min(y1, y2) - bump);\n\t\tthis.updateBounds(Math.max(x1, x2) + bump, Math.max(y1, y2) + bump);\n\n\t\tthis.prims.push({primClass: PrimClass.Line, typeidx, x1, y1, x2, y2} as LinePrim);\n\t}\n\tpublic drawRect(x:number, y:number, w:number, h:number, edgeCol:number, thickness:number, fillCol:number):void\n\t{\n\t\tif (edgeCol == null) edgeCol = MetaVector.NOCOLOUR;\n\t\tif (fillCol == null) fillCol = MetaVector.NOCOLOUR;\n\t\tif (thickness == null) thickness = 1;\n\t\tlet typeidx = this.findOrCreateType({primClass: PrimClass.Rect, edgeCol, fillCol, thickness} as RectType);\n\n\t\tconst bump = 0.5 * thickness;\n\t\tthis.updateBounds(x - bump, y - bump);\n\t\tthis.updateBounds(x + w + bump, y + h + bump);\n\n\t\tthis.prims.push({primClass: PrimClass.Rect, typeidx, x, y, w, h} as RectPrim);\n\t}\n\tpublic drawOval(cx:number, cy:number, rw:number, rh:number, edgeCol:number, thickness:number, fillCol:number):void\n\t{\n\t\tif (edgeCol == null) edgeCol = MetaVector.NOCOLOUR;\n\t\tif (fillCol == null) fillCol = MetaVector.NOCOLOUR;\n\t\tif (thickness == null) thickness = 1;\n\n\t\tconst bump = 0.5 * thickness;\n\t\tthis.updateBounds(cx - rw - bump, cy - rh - bump);\n\t\tthis.updateBounds(cx + rw + bump, cy + rh + bump);\n\n\t\tlet typeidx = this.findOrCreateType({primClass: PrimClass.Oval, edgeCol, fillCol, thickness} as OvalType);\n\t\tthis.prims.push({primClass: PrimClass.Oval, typeidx, cx, cy, rw, rh} as OvalPrim);\n\t}\n\tpublic drawPath(xpoints:number[], ypoints:number[], ctrlFlags:boolean[], isClosed:boolean,\n\t\t\t\t\tedgeCol:number, thickness:number, fillCol:number, hardEdge:boolean):void\n\t{\n\t\tif (edgeCol == null) edgeCol = MetaVector.NOCOLOUR;\n\t\tif (fillCol == null) fillCol = MetaVector.NOCOLOUR;\n\t\tif (thickness == null) thickness = 1;\n\t\tif (hardEdge == null) hardEdge = false;\n\n\t\tconst bump = 0.5 * thickness;\n\t\tfor (let n = 0; n < xpoints.length; n++)\n\t\t{\n\t\t\t// NOTE: treats control points as literals; this could cause glitches, but hasn't yet\n\t\t\tthis.updateBounds(xpoints[n] - bump, ypoints[n] - bump);\n\t\t\tif (bump != 0) this.updateBounds(xpoints[n] + bump, ypoints[n] + bump);\n\t\t}\n\n\t\tlet typeidx = this.findOrCreateType({primClass: PrimClass.Path, edgeCol, fillCol, thickness, hardEdge} as PathType);\n\t\tthis.prims.push({primClass: PrimClass.Path, typeidx, count: xpoints.length,\n\t\t\t\t\t\t x: Vec.duplicate(xpoints), y: Vec.duplicate(ypoints), ctrl: ctrlFlags && [...ctrlFlags], closed: isClosed} as PathPrim);\n\t}\n\tpublic drawPoly(xpoints:number[], ypoints:number[], edgeCol:number, thickness:number, fillCol:number, hardEdge:boolean):void\n\t{\n\t\tthis.drawPath(xpoints, ypoints, null, true, edgeCol, thickness, fillCol, hardEdge);\n\t}\n\tpublic drawText(x:number, y:number, txt:string, size:number, colour:number, align?:number, direction?:number):void\n\t{\n\t\tif (align == null) align = TextAlign.Left | TextAlign.Baseline;\n\t\tif (direction == null) direction = 0;\n\n\t\tlet cosTheta = 1, sinTheta = 0;\n\t\tif (direction != 0) [cosTheta, sinTheta] = [Math.cos(direction * DEGRAD), Math.sin(direction * DEGRAD)];\n\n\t\tconst font = FontData.main;\n\t\tfor (let n = 0; n < txt.length; n++)\n\t\t{\n\t\t\tlet i = font.getIndex(txt.charAt(n));\n\t\t\tif (i >= 0) this.charMask[i] = true; else this.charMissing = true;\n\t\t}\n\n\t\tlet metrics = font.measureText(txt, size);\n\t\tlet bx = 0, by = 0;\n\n\t\tlet dx = 0;\n\t\tif ((align & TextAlign.Left) != 0) {}\n\t\telse if ((align & TextAlign.Right) != 0) dx = -metrics[0];\n\t\telse /* centre */ dx = -0.5 * metrics[0];\n\t\tif (dx != 0)\n\t\t{\n\t\t\tbx += dx * cosTheta;\n\t\t\tby += dx * sinTheta;\n\t\t}\n\n\t\tlet dy = 0;\n\t\tif ((align & TextAlign.Middle) != 0) dy = 0.5 * metrics[1];\n\t\telse if ((align & TextAlign.Top) != 0) dy = metrics[1];\n\t\telse if ((align & TextAlign.Bottom) != 0) dy = -metrics[2];\n\t\t// else: baseline\n\t\tif (dy != 0)\n\t\t{\n\t\t\tbx -= dy * sinTheta;\n\t\t\tby += dy * cosTheta;\n\t\t}\n\n\t\t// mainstaking measurement of the boundaries (looks like overkill, but it really isn't)\n\t\tlet x1 = 0, y1 = 0, x2 = 0, y2 = 0;\n\t\tlet tx = 0;\n\t\tfor (let n = 0; n < txt.length; n++)\n\t\t{\n\t\t\tlet ch = txt.charAt(n);\n\t\t\tlet i = font.getIndex(ch);\n\t\t\tif (i >= 0)\n\t\t\t{\n\t\t\t\tlet outlineX = font.getOutlineX(i), outlineY = font.getOutlineY(i);\n\t\t\t\tx1 = Math.min(x1, tx + Vec.min(outlineX));\n\t\t\t\tx2 = Math.max(x2, tx + Vec.max(outlineX));\n\t\t\t\ty1 = Math.min(y1, -Vec.max(outlineY));\n\t\t\t\ty2 = Math.max(y2, -Vec.min(outlineY));\n\n\t\t\t\ttx += font.HORIZ_ADV_X[i];\n\t\t\t\tif (n < txt.length - 1) tx += font.getKerning(ch, txt.charAt(n + 1));\n\n\t\t\t\t// !! TODO: compensate for direction if !0 and !baseline/left\n\t\t\t}\n\t\t\telse tx += font.MISSING_HORZ;\n\t\t}\n\t\tconst mscale = size * font.INV_UNITS_PER_EM;\n\t\tif (direction == 0)\n\t\t{\n\t\t\tthis.updateBounds(x + bx + x1 * mscale, y + by + y1 * mscale);\n\t\t\tthis.updateBounds(x + bx + x2 * mscale, y + by + y2 * mscale);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet rx1 = x1 * mscale, ry1 = y1 * mscale;\n\t\t\tlet rx2 = x2 * mscale, ry2 = y2 * mscale;\n\t\t\tthis.updateBounds(x + bx + rx1 * cosTheta - ry1 * sinTheta, y + by + rx1 * sinTheta + ry1 * cosTheta);\n\t\t\tthis.updateBounds(x + bx + rx2 * cosTheta - ry1 * sinTheta, y + by + rx2 * sinTheta + ry1 * cosTheta);\n\t\t\tthis.updateBounds(x + bx + rx2 * cosTheta - ry2 * sinTheta, y + by + rx2 * sinTheta + ry2 * cosTheta);\n\t\t\tthis.updateBounds(x + bx + rx1 * cosTheta - ry2 * sinTheta, y + by + rx1 * sinTheta + ry2 * cosTheta);\n\t\t}\n\n\t\tlet typeidx = this.findOrCreateType({primClass: PrimClass.Text, size, colour} as TextType);\n\t\tthis.prims.push({primClass: PrimClass.Text, typeidx, x: x + bx, y: y + by, txt, direction} as TextPrim);\n\t}\n\n\t// render *native* text, which is defined by an HTML/CSS font specifier; this is different from the built-in text in that it presumes that the device\n\t// can locate the font at render-time, and that whatever methods were used to measure the font at draw-time are synced; this is a fair assumption when\n\t// creating graphics for immediate output to a canvas or inline-rendered SVG object, but anything else has to be taken on a case by case basis\n\tpublic drawTextNative(x:number, y:number, txt:string, fontFamily:string, fontSize:number, colour:number, align?:number, opt?:FontDataNativeOpt):void\n\t{\n\t\tif (!opt) opt = {};\n\n\t\tif (align == null) align = TextAlign.Left | TextAlign.Baseline;\n\t\tconst font = FontData.main;\n\n\t\tlet metrics = font.measureTextNative(txt, fontFamily, fontSize, opt);\n\n\t\tif ((align & TextAlign.Left) != 0) {}\n\t\telse if ((align & TextAlign.Right) != 0) x -= metrics[0];\n\t\telse /* centre */ x -= 0.5 * metrics[0];\n\n\t\tif ((align & TextAlign.Middle) != 0) y += 0.5 * metrics[1];\n\t\telse if ((align & TextAlign.Top) != 0) y += metrics[1];\n\t\telse if ((align & TextAlign.Bottom) != 0) y -= metrics[2];\n\t\t// else: baseline\n\n\t\tthis.updateBounds(x, y - metrics[1]);\n\t\tthis.updateBounds(x + metrics[0], y + metrics[2]);\n\n\t\tlet typeidx = this.findOrCreateType({primClass: PrimClass.TextNative, family: fontFamily, size: fontSize, colour, opt} as TextNativeType);\n\t\tthis.prims.push({primClass: PrimClass.TextNative, typeidx, x, y, txt} as TextNativePrim);\n\t}\n\n\t// query the boundaries of the drawing, post factum\n\tpublic boundLowX():number {return this.lowX;}\n\tpublic boundLowY():number {return this.lowY;}\n\tpublic boundHighX():number {return this.highX;}\n\tpublic boundHighY():number {return this.highY;}\n\tpublic getBounds():Box {return new Box(this.lowX, this.lowY, this.highX - this.lowX, this.highY - this.lowY);}\n\n\t// update width/height (this isn't done automatically, as it can be considered a parameter)\n\tpublic measure():void\n\t{\n\t\tthis.width = Math.ceil(this.highX - this.lowX);\n\t\tthis.height = Math.ceil(this.highY - this.lowY);\n\t}\n\n\t// for a metavector that has been drawn programmatically, makes sure that origin is (0,0) and that the size is set\n\tpublic normalise():void\n\t{\n\t\tif (this.lowX != 0 || this.lowY != 0) this.transformPrimitives(-this.lowX, -this.lowY, 1, 1);\n\t\tthis.width = Math.ceil(this.highX - this.lowX);\n\t\tthis.height = Math.ceil(this.highY - this.lowY);\n\t}\n\n\t// convenience\n\tpublic setSize(width:number, height:number) {this.width = width; this.height = height;}\n\n\t// makes sure everything fits into the indicated box, scaling down if necessary (but not up)\n\tpublic transformIntoBox(box:Box):void\n\t{\n\t\tthis.transformPrimitives(-this.lowX, -this.lowY, 1, 1);\n\t\tlet nw = Math.ceil(this.highX - this.lowX), nh = Math.ceil(this.highY - this.lowY);\n\t\tlet scale = 1;\n\t\tif (nw > box.w)\n\t\t{\n\t\t\tlet mod = box.w / nw;\n\t\t\tnw = box.w;\n\t\t\tnh *= mod;\n\t\t\tscale *= mod;\n\t\t}\n\t\tif (nh > box.h)\n\t\t{\n\t\t\tlet mod = box.h / nh;\n\t\t\tnh = box.h;\n\t\t\tnw *= mod;\n\t\t\tscale *= mod;\n\t\t}\n\t\tlet ox = 0.5 * (box.w - nw), oy = 0.5 * (box.h - nh);\n\t\tthis.transformPrimitives(box.x + ox, box.y + oy, scale, scale);\n\t}\n\n\t// if the width/height of the content exceeds either of the indicated maximum dimensions, it is scaled down accordingly;\n\t// does not correct for the origin\n\tpublic scaleExtent(maxWidth:number, maxHeight:number):void\n\t{\n\t\tlet w = this.highX - this.lowX, h = this.highY - this.lowY;\n\t\tif (w <= maxWidth && h <= maxHeight) return; // already in bounds\n\t\tlet scale = Math.min(maxWidth / w, maxHeight / h);\n\t\tthis.transformPrimitives(0, 0, scale, scale);\n\t}\n\n\t// transforms the sizes and positions of the primitives; a transform of [0,0,1,1] is the identity; the position of each coordinate\n\t// is rescaled based on: p' = p*scale + offset\n\tpublic transformPrimitives(ox:number, oy:number, sw:number, sh:number):void\n\t{\n\t\tif (ox == 0 && oy == 0 && sw == 1 && sh == 1) return;\n\n\t\tfor (let a of this.prims)\n\t\t{\n\t\t\tconst type = a.primClass;\n\t\t\tif (type == PrimClass.Line)\n\t\t\t{\n\t\t\t\tlet line = a as LinePrim;\n\t\t\t\tline.x1 = ox + line.x1 * sw;\n\t\t\t\tline.y1 = oy + line.y1 * sh;\n\t\t\t\tline.x2 = ox + line.x2 * sw;\n\t\t\t\tline.y2 = oy + line.y2 * sh;\n\t\t\t}\n\t\t\telse if (type == PrimClass.Rect)\n\t\t\t{\n\t\t\t\tlet rect = a as RectPrim;\n\t\t\t\trect.x = ox + rect.x * sw;\n\t\t\t\trect.y = oy + rect.y * sh;\n\t\t\t\trect.w = rect.w * sw;\n\t\t\t\trect.h = rect.h * sh;\n\t\t\t}\n\t\t\telse if (type == PrimClass.Oval)\n\t\t\t{\n\t\t\t\tlet oval = a as OvalPrim;\n\t\t\t\toval.cx = ox + oval.cx * sw;\n\t\t\t\toval.cy = oy + oval.cy * sh;\n\t\t\t\toval.rw *= sw;\n\t\t\t\toval.rh *= sh;\n\t\t\t}\n\t\t\telse if (type == PrimClass.Path)\n\t\t\t{\n\t\t\t\tlet path = a as PathPrim;\n\t\t\t\tlet sz = path.count, px = path.x, py = path.y;\n\t\t\t\tfor (let n = 0; n < sz; n++)\n\t\t\t\t{\n\t\t\t\t\tpx[n] = ox + px[n] * sw;\n\t\t\t\t\tpy[n] = oy + py[n] * sh;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (type == PrimClass.Text || type == PrimClass.TextNative)\n\t\t\t{\n\t\t\t\tlet text = a as TextPrim | TextNativePrim;\n\t\t\t\ttext.x = ox + text.x * sw;\n\t\t\t\ttext.y = oy + text.y * sh;\n\t\t\t}\n\t\t}\n\t\tlet swsh = 0.5 * (sw + sh);\n\t\tif (swsh != 1) for (let t of this.types)\n\t\t{\n\t\t\tconst type = t.primClass;\n\t\t\tif (type == PrimClass.Line) (t as LineType).thickness *= swsh;\n\t\t\telse if (type == PrimClass.Rect) (t as RectType).thickness *= swsh;\n\t\t\telse if (type == PrimClass.Oval) (t as OvalType).thickness *= swsh;\n\t\t\telse if (type == PrimClass.Path) (t as PathType).thickness *= swsh;\n\t\t\telse if (type == PrimClass.Text) (t as TextType).size *= swsh;\n\t\t\telse if (type == PrimClass.TextNative) (t as TextNativeType).size *= swsh;\n\t\t}\n\n\t\tthis.lowX = ox + this.lowX * sw;\n\t\tthis.lowY = oy + this.lowY * sh;\n\t\tthis.highX = ox + this.highX * sw;\n\t\tthis.highY = oy + this.highY * sh;\n\t}\n\n\t// renders the meta vector by creating a new canvas\n\tpublic renderInto(parent:any)\n\t{\n\t\tlet canvas = newElement(parent, 'canvas', {'width': this.width, 'height': this.height}) as HTMLCanvasElement;\n\t\tthis.renderCanvas(canvas);\n\t\treturn canvas;\n\t}\n\n\t// renders the meta vector into an existing canvas\n\tpublic renderCanvas(canvas:HTMLCanvasElement, clearFirst?:boolean)\n\t{\n\t\tlet ctx = canvas.getContext('2d');\n\t\tif (clearFirst) ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n\t\tlet w = this.width, h = this.height;\n\n\t\tthis.density = pixelDensity();\n\n\t\tcanvas.style.width = w + 'px';\n\t\tcanvas.style.height = h + 'px';\n\t\tcanvas.width = w * this.density;\n\t\tcanvas.height = h * this.density;\n\n\t\tthis.renderContext(ctx);\n\t}\n\n\t// renders the meta vector into a context (this is useful when there's stuff to draw above or below)\n\tpublic renderContext(ctx:CanvasRenderingContext2D)\n\t{\n\t\tctx.save();\n\t\tctx.scale(this.density, this.density);\n\n\t\tthis.typeObj = [];\n\t\tfor (let n = 0; n < this.types.length; n++)\n\t\t{\n\t\t\tlet t = this.types[n];\n\t\t\tif (t.primClass == PrimClass.Line) this.typeObj[n] = this.setupTypeLine(t as LineType);\n\t\t\telse if (t.primClass == PrimClass.Rect) this.typeObj[n] = this.setupTypeRect(t as RectType);\n\t\t\telse if (t.primClass == PrimClass.Oval) this.typeObj[n] = this.setupTypeOval(t as OvalType);\n\t\t\telse if (t.primClass == PrimClass.Path) this.typeObj[n] = this.setupTypePath(t as PathType);\n\t\t\telse if (t.primClass == PrimClass.Text) this.typeObj[n] = this.setupTypeText(t as TextType);\n\t\t\telse if (t.primClass == PrimClass.TextNative) this.typeObj[n] = this.setupTypeTextNative(t as TextNativeType);\n\t\t}\n\t\tfor (let n = 0; n < this.prims.length; n++)\n\t\t{\n\t\t\tlet p = this.prims[n];\n\t\t\tif (p.primClass == PrimClass.Line) this.renderLine(ctx, p as LinePrim);\n\t\t\telse if (p.primClass == PrimClass.Rect) this.renderRect(ctx, p as RectPrim);\n\t\t\telse if (p.primClass == PrimClass.Oval) this.renderOval(ctx, p as OvalPrim);\n\t\t\telse if (p.primClass == PrimClass.Path) this.renderPath(ctx, p as PathPrim);\n\t\t\telse if (p.primClass == PrimClass.Text) this.renderText(ctx, p as TextPrim);\n\t\t\telse if (p.primClass == PrimClass.TextNative) this.renderTextNative(ctx, p as TextNativePrim);\n\t\t}\n\n\t\tctx.restore();\n\t}\n\n\t// builds a new DOM containing an <svg> element, and everything underneath it is a representation of the graphic; the most common UI use case for this method is:\n\t//\t\t\tlet domSVG = dom(gfx.createSVG()).appendTo(div);\n\t//\t\t\tdomSVG.css({'display': 'block', 'pointer-events': 'none'});\n\t// note that setting the display style to 'block' prevents the layout from adding descender padding for baseline alignment, which is never useful; and disabling\n\t// pointer events for individual SVG elements is generally a good idea\n\tpublic createSVG(prettyPrint = false, withXlink = false):string\n\t{\n\t\tlet svg = new SpoolSVG(prettyPrint);\n\t\tsvg.start('<svg xmlns=\"http://www.w3.org/2000/svg\"');\n\t\tif (withXlink) svg.attr('xmlns:xlink', 'http://www.w3.org/1999/xlink');\n\t\tsvg.attr('width', this.width);\n\t\tsvg.attr('height', this.height);\n\t\tsvg.attr('viewBox', `0 0 ${this.width} ${this.height}`);\n\t\tsvg.stop('>');\n\t\tsvg.inc();\n\n\t\tthis.renderSVG(svg, withXlink);\n\n\t\tsvg.dec();\n\t\tsvg.whole('</svg>');\n\t\treturn svg.toString();\n\t}\n\n\t// given a DOM that represents an <svg> element, or some sub-container (such as <g>), populates it with all of the\n\t// content from the graphic\n\tpublic renderSVG(svg:SpoolSVG, withXlink = false):void\n\t{\n\t\tthis.typeObj = [];\n\n\t\tconst font = FontData.main;\n\t\tsvg.whole('<defs>');\n\t\tsvg.inc();\n\t\tif (this.charMissing)\n\t\t{\n\t\t\tsvg.start('<path');\n\t\t\tsvg.attr('id', 'missing');\n\t\t\tsvg.attr('d', font.MISSING_DATA);\n\t\t\tsvg.attr('edge', 'none');\n\t\t\tsvg.stop('/>');\n\t\t}\n\t\tfor (let n = 0; n < font.UNICODE.length; n++) if (this.charMask[n])\n\t\t{\n\t\t\tsvg.start('<path');\n\t\t\tsvg.attr('id', 'char' + n);\n\t\t\tsvg.attr('d', font.GLYPH_DATA[n]);\n\t\t\tsvg.attr('edge', 'none');\n\t\t\tsvg.stop('/>');\n\t\t}\n\t\tsvg.dec();\n\t\tsvg.whole('</defs>');\n\n\t\tfor (let n = 0; n < this.types.length; n++)\n\t\t{\n\t\t\tlet t = this.types[n];\n\t\t\tif (t.primClass == PrimClass.Line) this.typeObj[n] = this.setupTypeLine(t as LineType);\n\t\t\telse if (t.primClass == PrimClass.Rect) this.typeObj[n] = this.setupTypeRect(t as RectType);\n\t\t\telse if (t.primClass == PrimClass.Oval) this.typeObj[n] = this.setupTypeOval(t as OvalType);\n\t\t\telse if (t.primClass == PrimClass.Path) this.typeObj[n] = this.setupTypePath(t as PathType);\n\t\t\telse if (t.primClass == PrimClass.Text) this.typeObj[n] = this.setupTypeText(t as TextType);\n\t\t\telse if (t.primClass == PrimClass.TextNative) this.typeObj[n] = this.setupTypeTextNative(t as TextNativeType);\n\t\t}\n\t\tfor (let n = 0; n < this.prims.length;)\n\t\t{\n\t\t\tlet p = this.prims[n], num = 1;\n\t\t\tif (p.primClass != PrimClass.Path && p.primClass != PrimClass.Text && p.primClass != PrimClass.TextNative)\n\t\t\t{\n\t\t\t\tfor (; n + num < this.prims.length; num++) if (this.prims[n + num].primClass != p.primClass || this.prims[n + num].typeidx != p.typeidx) break;\n\t\t\t}\n\t\t\tif (p.primClass == PrimClass.Line)\n\t\t\t{\n\t\t\t\tif (num == 1)\n\t\t\t\t\tthis.svgLine1(svg, p as LinePrim);\n\t\t\t\telse\n\t\t\t\t\tthis.svgLineN(svg, this.prims.slice(n, n + num) as LinePrim[]);\n\t\t\t}\n\t\t\telse if (p.primClass == PrimClass.Rect)\n\t\t\t{\n\t\t\t\tif (num == 1)\n\t\t\t\t\tthis.svgRect1(svg, p as RectPrim);\n\t\t\t\telse\n\t\t\t\t\tthis.svgRectN(svg, this.prims.slice(n, n + num) as RectPrim[]);\n\t\t\t}\n\t\t\telse if (p.primClass == PrimClass.Oval)\n\t\t\t{\n\t\t\t\tif (num == 1)\n\t\t\t\t\tthis.svgOval1(svg, p as OvalPrim);\n\t\t\t\telse\n\t\t\t\t\tthis.svgOvalN(svg, this.prims.slice(n, n + num) as OvalPrim[]);\n\t\t\t}\n\t\t\telse if (p.primClass == PrimClass.Path) this.svgPath(svg, p as PathPrim);\n\t\t\telse if (p.primClass == PrimClass.Text) this.svgText(svg, p as TextPrim, withXlink);\n\t\t\telse if (p.primClass == PrimClass.TextNative) this.svgTextNative(svg, p as TextNativePrim);\n\n\t\t\tn += num;\n\t\t}\n\t}\n\n\t// for duplication purposes: emits all the primitives into another builder instance\n\tpublic spool(into:MetaVector):void\n\t{\n\t\tfor (let p of this.prims)\n\t\t{\n\t\t\tif (p.primClass == PrimClass.Line)\n\t\t\t{\n\t\t\t\tlet {typeidx, x1, y1, x2, y2} = p as LinePrim;\n\t\t\t\tlet {thickness, colour} = this.types[typeidx] as LineType;\n\t\t\t\tinto.drawLine(x1, y1, x2, y2, colour, thickness);\n\t\t\t}\n\t\t\telse if (p.primClass == PrimClass.Rect)\n\t\t\t{\n\t\t\t\tlet {typeidx, x, y, w, h} = p as RectPrim;\n\t\t\t\tlet {edgeCol, fillCol, thickness} = this.types[typeidx] as RectType;\n\t\t\t\tinto.drawRect(x, y, w, h, edgeCol, thickness, fillCol);\n\t\t\t}\n\t\t\telse if (p.primClass == PrimClass.Oval)\n\t\t\t{\n\t\t\t\tlet {typeidx, cx, cy, rw, rh} = p as OvalPrim;\n\t\t\t\tlet {edgeCol, fillCol, thickness} = this.types[typeidx] as OvalType;\n\t\t\t\tinto.drawOval(cx, cy, rw, rh, edgeCol, thickness, fillCol);\n\t\t\t}\n\t\t\telse if (p.primClass == PrimClass.Path)\n\t\t\t{\n\t\t\t\tlet {typeidx, count, x, y, ctrl, closed} = p as PathPrim;\n\t\t\t\tlet {edgeCol, fillCol, thickness, hardEdge} = this.types[typeidx] as PathType;\n\t\t\t\tinto.drawPath(x, y, ctrl, closed, edgeCol, thickness, fillCol, hardEdge);\n\t\t\t}\n\t\t\telse if (p.primClass == PrimClass.Text)\n\t\t\t{\n\t\t\t\tlet {typeidx, x, y, txt, direction} = p as TextPrim;\n\t\t\t\tlet {size, colour} = this.types[typeidx] as TextType;\n\t\t\t\tinto.drawText(x, y, txt, size, colour, null, direction);\n\t\t\t}\n\t\t\telse if (p.primClass == PrimClass.TextNative)\n\t\t\t{\n\t\t\t\tlet {typeidx, x, y, txt} = p as TextNativePrim;\n\t\t\t\tlet {family, size, colour} = this.types[typeidx] as TextNativeType;\n\t\t\t\tinto.drawTextNative(x, y, txt, family, size, colour);\n\t\t\t}\n\t\t}\n\t}\n\n\t// ------------ private methods ------------\n\n\t// transform stored types into renderables\n\tpublic setupTypeLine(t:LineType):LineType\n\t{\n\t\tlet thickness = t.thickness * this.scale;\n\t\tlet colour = t.colour;\n\t\treturn {primClass: t.primClass, thickness, colour};\n\t}\n\tpublic setupTypeRect(t:RectType):RectType\n\t{\n\t\tlet edgeCol = t.edgeCol;\n\t\tlet fillCol = t.fillCol;\n\t\tlet thickness = t.thickness * this.scale;\n\t\treturn {primClass: t.primClass, edgeCol, fillCol, thickness};\n\t}\n\tpublic setupTypeOval(t:OvalType):OvalType\n\t{\n\t\tlet edgeCol = t.edgeCol;\n\t\tlet fillCol = t.fillCol;\n\t\tlet thickness = t.thickness * this.scale;\n\t\treturn {primClass: t.primClass, edgeCol, fillCol, thickness};\n\t}\n\tpublic setupTypePath(t:PathType):PathType\n\t{\n\t\tlet edgeCol = t.edgeCol;\n\t\tlet fillCol = t.fillCol;\n\t\tlet thickness = t.thickness * this.scale;\n\t\tlet hardEdge = t.hardEdge;\n\t\treturn {primClass: t.primClass, edgeCol, fillCol, thickness, hardEdge};\n\t}\n\tpublic setupTypeText(t:TextType):TextType\n\t{\n\t\tlet size = t.size * this.scale;\n\t\tlet colour = t.colour;\n\t\treturn {primClass: t.primClass, colour, size};\n\t}\n\tpublic setupTypeTextNative(t:TextNativeType):TextNativeType\n\t{\n\t\tlet family = t.family;\n\t\tlet size = t.size * this.scale;\n\t\tlet colour = t.colour;\n\t\tlet opt = t.opt;\n\t\treturn {primClass: t.primClass, colour, family, size, opt};\n\t}\n\n\t// perform actual rendering for the primitives\n\tpublic renderLine(ctx:CanvasRenderingContext2D, line:LinePrim):void\n\t{\n\t\tlet {x1, y1, x2, y2} = line;\n\t\tlet {colour, thickness} = this.typeObj[line.typeidx] as LineType;\n\n\t\tx1 = this.offsetX + this.scale * x1;\n\t\ty1 = this.offsetY + this.scale * y1;\n\t\tx2 = this.offsetX + this.scale * x2;\n\t\ty2 = this.offsetY + this.scale * y2;\n\t\tif (colour != null)\n\t\t{\n\t\t\tctx.beginPath();\n\t\t\tctx.moveTo(x1, y1);\n\t\t\tctx.lineTo(x2, y2);\n\t\t\tctx.strokeStyle = colourCanvas(colour);\n\t\t\tctx.lineWidth = thickness;\n\t\t\tctx.lineCap = 'round';\n\t\t\tctx.stroke();\n\t\t}\n\t}\n\tpublic renderRect(ctx:CanvasRenderingContext2D, rect:RectPrim):void\n\t{\n\t\tlet {x, y, w, h} = rect;\n\t\tlet {edgeCol, fillCol, thickness} = this.typeObj[rect.typeidx] as RectType;\n\n\t\tx = this.offsetX + this.scale * x;\n\t\ty = this.offsetY + this.scale * y;\n\t\tw *= this.scale;\n\t\th *= this.scale;\n\n\t\tif (fillCol != MetaVector.NOCOLOUR)\n\t\t{\n\t\t\tctx.fillStyle = colourCanvas(fillCol);\n\t\t\tctx.fillRect(x, y, w, h);\n\t\t}\n\t\tif (edgeCol != MetaVector.NOCOLOUR)\n\t\t{\n\t\t\tctx.strokeStyle = colourCanvas(edgeCol);\n\t\t\tctx.lineWidth = thickness;\n\t\t\tctx.lineCap = 'square';\n\t\t\tctx.strokeRect(x, y, w, h);\n\t\t}\n\t}\n\tpublic renderOval(ctx:CanvasRenderingContext2D, oval:OvalPrim):void\n\t{\n\t\tlet {cx, cy, rw, rh} = oval;\n\t\tlet {edgeCol, fillCol, thickness} = this.typeObj[oval.typeidx] as OvalType;\n\n\t\tcx = this.offsetX + this.scale * cx;\n\t\tcy = this.offsetY + this.scale * cy;\n\t\trw *= this.scale;\n\t\trh *= this.scale;\n\n\t\tif (fillCol != MetaVector.NOCOLOUR)\n\t\t{\n\t\t\tctx.fillStyle = colourCanvas(fillCol);\n\t\t\tctx.beginPath();\n\t\t\tctx.ellipse(cx, cy, rw, rh, 0, 0, 2 * Math.PI, true);\n\t\t\tctx.fill();\n\t\t}\n\t\tif (edgeCol != MetaVector.NOCOLOUR)\n\t\t{\n\t\t\tctx.strokeStyle = colourCanvas(edgeCol);\n\t\t\tctx.lineWidth = thickness;\n\t\t\tctx.beginPath();\n\t\t\tctx.ellipse(cx, cy, rw, rh, 0, 0, 2 * Math.PI, true);\n\t\t\tctx.stroke();\n\t\t}\n\t}\n\tpublic renderPath(ctx:CanvasRenderingContext2D, path:PathPrim):void\n\t{\n\t\tlet {count, x, y, ctrl, closed} = path;\n\t\tlet {edgeCol, fillCol, thickness, hardEdge} = this.typeObj[path.typeidx] as PathType;\n\n\t\tx = [...x];\n\t\ty = [...y];\n\t\tfor (let n = 0; n < count; n++)\n\t\t{\n\t\t\tx[n] = this.offsetX + this.scale * x[n];\n\t\t\ty[n] = this.offsetY + this.scale * y[n];\n\t\t}\n\n\t\tfor (let layer = 1; layer <= 2; layer++)\n\t\t{\n\t\t\tif (layer == 1 && fillCol == MetaVector.NOCOLOUR) continue;\n\t\t\tif (layer == 2 && edgeCol == MetaVector.NOCOLOUR) continue;\n\n\t\t\tctx.beginPath();\n\t\t\tctx.moveTo(x[0], y[0]);\n\t\t\tfor (let i = 1; i < count; i++)\n\t\t\t{\n\t\t\t\tif (!ctrl || !ctrl[i])\n\t\t\t\t{\n\t\t\t\t\tctx.lineTo(x[i], y[i]);\n\t\t\t\t}\n\t\t\t\telse if (i < count - 1 && !ctrl[i + 1])\n\t\t\t\t{\n\t\t\t\t\tctx.quadraticCurveTo(x[i], y[i], x[i + 1], y[i + 1]);\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t\telse if (i < count - 1 && !ctrl[i + 2])\n\t\t\t\t{\n\t\t\t\t\tctx.bezierCurveTo(x[i], y[i], x[i + 1], y[i + 1], x[i + 2], y[i + 2]);\n\t\t\t\t\ti += 2;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (closed) ctx.closePath();\n\n\t\t\tif (layer == 1)\n\t\t\t{\n\t\t\t\tctx.fillStyle = colourCanvas(fillCol);\n\t\t\t\tctx.fill();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tctx.strokeStyle = colourCanvas(edgeCol);\n\t\t\t\tctx.lineWidth = thickness;\n\t\t\t\tctx.lineCap = hardEdge ? 'square' : 'round';\n\t\t\t\tctx.lineJoin = hardEdge ? 'miter' : 'round';\n\t\t\t\tctx.stroke();\n\t\t\t}\n\t\t}\n\t}\n\tprivate renderText(ctx:CanvasRenderingContext2D, text:TextPrim):void\n\t{\n\t\tlet {x, y, txt, direction} = text;\n\t\tlet {size, colour} = this.typeObj[text.typeidx] as TextType;\n\n\t\tlet fill = colourCanvas(colour);\n\n\t\tx = this.offsetX + this.scale * x;\n\t\ty = this.offsetY + this.scale * y;\n\n\t\tlet font = FontData.main;\n\n\t\tlet scale = size * this.scale / font.UNITS_PER_EM;\n\t\tlet dx = 0;\n\t\tfor (let n = 0; n < txt.length; n++)\n\t\t{\n\t\t\tlet ch = txt.charAt(n);\n\t\t\tlet i = font.getIndex(ch);\n\t\t\tlet path:Path2D = null;\n\t\t\tif (i < 0)\n\t\t\t{\n\t\t\t\tdx += font.MISSING_HORZ;\n\t\t\t\tpath = font.getMissingPath();\n\t\t\t}\n\t\t\telse path = font.getGlyphPath(i);\n\n\t\t\tif (path)\n\t\t\t{\n\t\t\t\tctx.save();\n\t\t\t\tlet theta = direction != 0 ? direction * DEGRAD : 0;\n\t\t\t\tif (theta == 0)\n\t\t\t\t\tctx.translate(x + dx * scale, y);\n\t\t\t\telse\n\t\t\t\t\tctx.translate(x + Math.cos(theta) * dx * scale, y + Math.sin(theta) * dx * scale);\n\t\t\t\tctx.scale(scale, -scale);\n\t\t\t\tif (theta != 0) ctx.rotate(-theta);\n\t\t\t\tctx.fillStyle = fill;\n\t\t\t\tctx.fill(path);\n\t\t\t\tctx.restore();\n\t\t\t}\n\n\t\t\tdx += font.HORIZ_ADV_X[i];\n\t\t\tif (n < txt.length - 1) dx += font.getKerning(ch, txt.charAt(n + 1));\n\t\t}\n\t}\n\tprivate renderTextNative(ctx:CanvasRenderingContext2D, text:TextNativePrim):void\n\t{\n\t\tlet {x, y, txt} = text;\n\t\tlet {size, colour, family, opt} = this.typeObj[text.typeidx] as TextNativeType;\n\n\t\tlet fill = colourCanvas(colour);\n\n\t\tx = this.offsetX + this.scale * x;\n\t\ty = this.offsetY + this.scale * y;\n\n\t\tctx.save();\n\n\t\tlet pfx = '';\n\t\tif (opt.bold) pfx += 'bold ';\n\t\tif (opt.italic) pfx += 'italic ';\n\t\tctx.font = pfx + (size * this.scale) + 'px ' + family;\n\t\tctx.fillStyle = fill;\n\t\tctx.fillText(txt, x, y);\n\t\tctx.restore();\n\t}\n\n\t// create SVG object for each primitive\n\t// perform actual rendering for the primitives\n\tpublic svgLine1(svg:SpoolSVG, line:LinePrim):void\n\t{\n\t\tlet {x1, y1, x2, y2} = line;\n\t\tlet {colour, thickness} = this.typeObj[line.typeidx] as LineType;\n\n\t\tx1 = this.offsetX + this.scale * x1;\n\t\ty1 = this.offsetY + this.scale * y1;\n\t\tx2 = this.offsetX + this.scale * x2;\n\t\ty2 = this.offsetY + this.scale * y2;\n\n\t\tif (colour != MetaVector.NOCOLOUR)\n\t\t{\n\t\t\tsvg.start('<line');\n\t\t\tsvg.attr('x1', x1);\n\t\t\tsvg.attr('y1', y1);\n\t\t\tsvg.attr('x2', x2);\n\t\t\tsvg.attr('y2', y2);\n\t\t\tthis.defineSVGStroke(svg, colour);\n\t\t\tsvg.attr('stroke-width', thickness);\n\t\t\tsvg.attr('stroke-linecap', 'round');\n\t\t\tsvg.stop('/>');\n\t\t}\n\t}\n\tpublic svgLineN(svg:SpoolSVG, lines:LinePrim[]):void\n\t{\n\t\tlet {colour, thickness} = this.typeObj[lines[0].typeidx] as LineType;\n\n\t\tsvg.start('<g');\n\t\tthis.defineSVGStroke(svg, colour);\n\t\tsvg.attr('stroke-width', thickness);\n\t\tsvg.attr('stroke-linecap', 'round');\n\t\tsvg.stop('>');\n\t\tsvg.inc();\n\n\t\tfor (let line of lines)\n\t\t{\n\t\t\tlet {x1, y1, x2, y2} = line;\n\n\t\t\tx1 = this.offsetX + this.scale * x1;\n\t\t\ty1 = this.offsetY + this.scale * y1;\n\t\t\tx2 = this.offsetX + this.scale * x2;\n\t\t\ty2 = this.offsetY + this.scale * y2;\n\n\t\t\tsvg.start('<line');\n\t\t\tsvg.attr('x1', x1);\n\t\t\tsvg.attr('y1', y1);\n\t\t\tsvg.attr('x2', x2);\n\t\t\tsvg.attr('y2', y2);\n\t\t\tsvg.stop('/>');\n\t\t}\n\n\t\tsvg.dec();\n\t\tsvg.whole('</g>');\n\t}\n\tpublic svgRect1(svg:SpoolSVG, rect:RectPrim):void\n\t{\n\t\tlet {x, y, w, h} = rect;\n\t\tlet {edgeCol, fillCol, thickness} = this.typeObj[rect.typeidx] as RectType;\n\n\t\tx = this.offsetX + this.scale * x;\n\t\ty = this.offsetY + this.scale * y;\n\t\tw *= this.scale;\n\t\th *= this.scale;\n\n\t\tsvg.start('<rect');\n\t\tsvg.attr('x', x);\n\t\tsvg.attr('y', y);\n\t\tsvg.attr('width', w);\n\t\tsvg.attr('height', h);\n\n\t\tthis.defineSVGStroke(svg, edgeCol);\n\t\tif (edgeCol != MetaVector.NOCOLOUR)\n\t\t{\n\t\t\tsvg.attr('stroke-width', thickness);\n\t\t\tsvg.attr('stroke-linecap', 'square');\n\t\t}\n\t\tthis.defineSVGFill(svg, fillCol);\n\t\tsvg.stop('/>');\n\t}\n\tpublic svgRectN(svg:SpoolSVG, rects:RectPrim[]):void\n\t{\n\t\tlet {edgeCol, fillCol, thickness} = this.typeObj[rects[0].typeidx] as RectType;\n\n\t\tsvg.start('<g');\n\t\tthis.defineSVGStroke(svg, edgeCol);\n\t\tif (edgeCol != MetaVector.NOCOLOUR)\n\t\t{\n\t\t\tsvg.attr('stroke-width', thickness);\n\t\t\tsvg.attr('stroke-linecap', 'square');\n\t\t}\n\t\tthis.defineSVGFill(svg, fillCol);\n\t\tsvg.stop('>');\n\t\tsvg.inc();\n\n\t\tfor (let rect of rects)\n\t\t{\n\t\t\tlet {x, y, w, h} = rect;\n\n\t\t\tx = this.offsetX + this.scale * x;\n\t\t\ty = this.offsetY + this.scale * y;\n\t\t\tw *= this.scale;\n\t\t\th *= this.scale;\n\n\t\t\tsvg.start('<rect');\n\t\t\tsvg.attr('x', x);\n\t\t\tsvg.attr('y', y);\n\t\t\tsvg.attr('width', w);\n\t\t\tsvg.attr('height', h);\n\t\t\tsvg.stop('/>');\n\t\t}\n\n\t\tsvg.dec();\n\t\tsvg.whole('</g>');\n\t}\n\tpublic svgOval1(svg:SpoolSVG, oval:OvalPrim):void\n\t{\n\t\tlet {cx, cy, rw, rh} = oval;\n\t\tlet {edgeCol, fillCol, thickness} = this.typeObj[oval.typeidx] as OvalType;\n\n\t\tcx = this.offsetX + this.scale * cx;\n\t\tcy = this.offsetY + this.scale * cy;\n\t\trw *= this.scale;\n\t\trh *= this.scale;\n\n\t\tsvg.start('<ellipse');\n\t\tsvg.attr('cx', cx);\n\t\tsvg.attr('cy', cy);\n\t\tsvg.attr('rx', rw);\n\t\tsvg.attr('ry', rh);\n\n\t\tthis.defineSVGStroke(svg, edgeCol);\n\t\tif (edgeCol != MetaVector.NOCOLOUR)\n\t\t{\n\t\t\tsvg.attr('stroke-width', thickness);\n\t\t}\n\t\tthis.defineSVGFill(svg, fillCol);\n\t\tsvg.stop('/>');\n\t}\n\tpublic svgOvalN(svg:SpoolSVG, ovals:OvalPrim[]):void\n\t{\n\t\tlet {edgeCol, fillCol, thickness} = this.typeObj[ovals[0].typeidx] as OvalType;\n\n\t\tsvg.start('<g');\n\t\tthis.defineSVGStroke(svg, edgeCol);\n\t\tif (edgeCol != MetaVector.NOCOLOUR)\n\t\t{\n\t\t\tsvg.attr('stroke-width', thickness);\n\t\t}\n\t\tthis.defineSVGFill(svg, fillCol);\n\t\tsvg.stop('>');\n\t\tsvg.inc();\n\n\t\tfor (let oval of ovals)\n\t\t{\n\t\t\tlet {cx, cy, rw, rh} = oval;\n\n\t\t\tcx = this.offsetX + this.scale * cx;\n\t\t\tcy = this.offsetY + this.scale * cy;\n\t\t\trw *= this.scale;\n\t\t\trh *= this.scale;\n\n\t\t\tsvg.start('<ellipse');\n\t\t\tsvg.attr('cx', cx);\n\t\t\tsvg.attr('cy', cy);\n\t\t\tsvg.attr('rx', rw);\n\t\t\tsvg.attr('ry', rh);\n\t\t\tsvg.stop('/>');\n\t\t}\n\n\t\tsvg.dec();\n\t\tsvg.whole('</g>');\n\t}\n\tpublic svgPath(svg:SpoolSVG, path:PathPrim):void\n\t{\n\t\tlet {count, x, y, ctrl, closed} = path;\n\t\tlet {edgeCol, fillCol, thickness, hardEdge} = this.typeObj[path.typeidx] as PathType;\n\n\t\tx = [...x];\n\t\ty = [...y];\n\t\tfor (let n = 0; n < count; n++)\n\t\t{\n\t\t\tx[n] = this.offsetX + this.scale * x[n];\n\t\t\ty[n] = this.offsetY + this.scale * y[n];\n\t\t}\n\n\t\tlet shape = 'M ' + x[0] + ' ' + y[0];\n\t\tlet n = 1;\n\t\twhile (n < count)\n\t\t{\n\t\t\tif (!ctrl || !ctrl[n])\n\t\t\t{\n\t\t\t\tshape += ' L ' + x[n] + ' ' + y[n];\n\t\t\t\tn++;\n\t\t\t}\n\t\t\telse if (ctrl[n] && n < count - 1 && !ctrl[n + 1])\n\t\t\t{\n\t\t\t\tshape += ' Q ' + x[n] + ' ' + y[n] + ' ' + x[n + 1] + ' ' + y[n + 1];\n\t\t\t\tn += 2;\n\t\t\t}\n\t\t\telse if (ctrl[n] && n < count - 2 && ctrl[n + 1] && !ctrl[n + 2])\n\t\t\t{\n\t\t\t\tshape += ' C ' + x[n] + ' ' + y[n] + ' ' + x[n + 1] + ' ' + y[n + 1] + ' ' + x[n + 2] + ' ' + y[n + 2];\n\t\t\t\tn += 3;\n\t\t\t}\n\t\t\telse n++; // (dunno, so skip)\n\t\t}\n\t\tif (closed) shape += ' Z';\n\n\t\tsvg.start('<path');\n\t\tsvg.attr('d', shape);\n\n\t\tthis.defineSVGStroke(svg, edgeCol);\n\t\tif (edgeCol != MetaVector.NOCOLOUR)\n\t\t{\n\t\t\tsvg.attr('stroke-width', thickness);\n\t\t\tsvg.attr('stroke-linejoin', hardEdge ? 'miter' : 'round');\n\t\t\tsvg.attr('stroke-linecap', hardEdge ? 'square' : 'round');\n\t\t}\n\t\tthis.defineSVGFill(svg, fillCol);\n\t\tsvg.stop('/>');\n\t}\n\tprivate svgText(svg:SpoolSVG, text:TextPrim, withXlink = true):void\n\t{\n\t\tlet {x, y, txt, direction} = text;\n\t\tlet {size, colour} = this.typeObj[text.typeidx] as TextType;\n\n\t\tx = this.offsetX + this.scale * x;\n\t\ty = this.offsetY + this.scale * y;\n\n\t\tlet font = FontData.main;\n\n\t\tlet scale = size * this.scale / font.UNITS_PER_EM;\n\n\t\tif (direction != 0)\n\t\t{\n\t\t\tsvg.start('<g');\n\t\t\tsvg.attr('transform', `rotate(${direction},${x},${y})`);\n\t\t\tsvg.stop('>');\n\t\t\tsvg.inc();\n\t\t}\n\n\t\tsvg.start('<g');\n\t\tsvg.attr('transform', 'translate(' + x + ',' + y + ')');\n\t\tthis.defineSVGFill(svg, colour);\n\t\tsvg.stop('>');\n\t\tsvg.inc();\n\n\t\tsvg.start('<g');\n\t\tsvg.attr('transform', 'scale(' + scale + ',' + (-scale) + ')');\n\t\tsvg.stop('>');\n\t\tsvg.inc();\n\n\t\tlet dx = 0;\n\t\tfor (let n = 0; n < txt.length; n++)\n\t\t{\n\t\t\tlet ch = txt.charAt(n);\n\t\t\tlet i = font.getIndex(ch);\n\n\t\t\tsvg.start('<use');\n\t\t\tlet ref = i < 0 ? '#missing' : '#char' + i;\n\t\t\tif (withXlink) svg.attr('xlink:href', ref); else svg.attr('href', ref);\n\t\t\tsvg.attr('x', dx);\n\t\t\tsvg.stop('/>');\n\n\t\t\tif (i >= 0)\n\t\t\t{\n\t\t\t\tdx += font.HORIZ_ADV_X[i];\n\t\t\t\tif (n < txt.length - 1) dx += font.getKerning(ch, txt.charAt(n + 1));\n\t\t\t}\n\t\t\telse dx += font.MISSING_HORZ;\n\t\t}\n\n\t\tsvg.dec();\n\t\tsvg.whole('</g>');\n\n\t\tsvg.dec();\n\t\tsvg.whole('</g>');\n\n\t\tif (direction != 0)\n\t\t{\n\t\t\tsvg.dec();\n\t\t\tsvg.whole('</g>');\n\t\t}\n\t}\n\tprivate svgTextNative(svg:SpoolSVG, text:TextNativePrim):void\n\t{\n\t\tlet {x, y, txt} = text;\n\t\tlet {size, colour, family, opt} = this.typeObj[text.typeidx] as TextNativeType;\n\n\t\tx = this.offsetX + this.scale * x;\n\t\ty = this.offsetY + this.scale * y;\n\n\t\tlet fill = colourCanvas(colour);\n\t\tlet style = `fill: ${fill}; font-family: ${family}; font-size: ${size * this.scale};`;\n\t\tif (opt.bold) style += ' font-weight: bold;';\n\t\tif (opt.italic) style += ' font-style: italic;';\n\n\t\tconst escapeXML = (str:string):string =>\n\t\t{\n\t\t\treturn str.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\").replace(/\"/g, \"&quot;\").replace(/'/g, \"&#039;\");\n\t\t};\n\n\t\tsvg.start('<text');\n\t\tsvg.attr('xml:space', 'preserve');\n\t\tsvg.attr('x', x);\n\t\tsvg.attr('y', y);\n\t\tsvg.attr('style', style);\n\t\tsvg.stop('>' + escapeXML(txt) + '</text>');\n\t}\n\n\t// utility for SVG\n\tprivate defineSVGStroke(svg:SpoolSVG, col:number):void\n\t{\n\t\tif (col == MetaVector.NOCOLOUR)\n\t\t{\n\t\t\tsvg.attr('stroke-opacity', '0');\n\t\t\treturn;\n\t\t}\n\t\tsvg.attr('stroke', colourCode(col));\n\t\tlet alpha = colourAlpha(col);\n\t\tif (alpha != 1) svg.attr('stroke-opacity', alpha);\n\t}\n\tprivate defineSVGFill(svg:SpoolSVG, col:number):void\n\t{\n\t\tif (col == MetaVector.NOCOLOUR)\n\t\t{\n\t\t\tsvg.attr('fill-opacity', '0');\n\t\t\treturn;\n\t\t}\n\t\tsvg.attr('fill', colourCode(col));\n\t\tlet alpha = colourAlpha(col);\n\t\tif (alpha != 1) svg.attr('fill-opacity', alpha);\n\t}\n\n\t// for a type definition array, see if it exists in the list, and return that index - or if not, push it on\n\tprivate findOrCreateType(typeDef:TypeBase)\n\t{\n\t\tfor (let n = 0; n < this.types.length; n++)\n\t\t{\n\t\t\tif (this.types[n].primClass != typeDef.primClass) continue;\n\t\t\tlet keys = Object.keys(typeDef);\n\t\t\tlet match = keys.every((k) => (typeDef as any)[k] == (this.types[n] as any)[k]);\n\t\t\tif (match) return n;\n\t\t}\n\t\tthis.types.push(typeDef);\n\t\treturn this.types.length - 1;\n\t}\n\n\t// ensures boundaries move whenever something out of range is added\n\tprivate updateBounds(x:number, y:number):void\n\t{\n\t\tif (this.lowX == null)\n\t\t{\n\t\t\tthis.lowX = x;\n\t\t\tthis.lowY = y;\n\t\t\tthis.highX = x;\n\t\t\tthis.highY = y;\n\t\t\treturn;\n\t\t}\n\t\tthis.lowX = Math.min(this.lowX, x);\n\t\tthis.lowY = Math.min(this.lowY, y);\n\t\tthis.highX = Math.max(this.highX, x);\n\t\tthis.highY = Math.max(this.highY, y);\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\n///<reference path='Aspect.ts'/>\n\nimport {DataSheet, DataSheetColumn} from '../data/DataSheet';\nimport {Molecule} from '../data/Molecule';\nimport {MolUtil} from '../data/MolUtil';\nimport {ArrangeExperiment} from '../gfx/ArrangeExperiment';\nimport {OutlineMeasurement} from '../gfx/ArrangeMeasurement';\nimport {DrawExperiment} from '../gfx/DrawExperiment';\nimport {MetaVector} from '../gfx/MetaVector';\nimport {RenderPolicy} from '../gfx/Rendering';\nimport {Vec} from '../util/Vec';\nimport {Aspect, AspectGraphicRendering} from './Aspect';\nimport {registerAspect} from './AspectList';\n\n/*\n\tExperiment aspect: transforms groups of rows from a datasheet into a collection of structures that make up a\n\tmultistep reaction, along with accompanying quantities and other miscellaneous information.\n*/\n\nexport enum ExperimentComponentType\n{\n\tReactant,\n\tReagent,\n\tProduct,\n}\n\nexport class ExperimentComponent\n{\n\tpublic mol:Molecule = null;\n\tpublic name = '';\n\tpublic stoich = '';\n\tpublic mass:number = null; // units: g\n\tpublic volume:number = null; // units: mL\n\tpublic moles:number = null; // units: mol\n\tpublic density:number = null; // units: g/mL\n\tpublic conc:number = null; // units: mol/L\n\tpublic yield:number = null; // products only; unit: %\n\tpublic primary = false; // reactants only\n\tpublic waste = false; // products only\n\tpublic equiv:number = null; // reagents only\n\tpublic meta = '';\n\n\tconstructor(mol?:Molecule, name?:string)\n\t{\n\t\tthis.mol = mol;\n\t\tif (name) this.name = name;\n\t}\n\n\t// makes a deep copy (assuming that molecules are treated as immutable)\n\tpublic clone():ExperimentComponent\n\t{\n\t\tlet dup = new ExperimentComponent(this.mol, this.name);\n\t\tdup.stoich = this.stoich;\n\t\tdup.mass = this.mass;\n\t\tdup.volume = this.volume;\n\t\tdup.moles = this.moles;\n\t\tdup.density = this.density;\n\t\tdup.conc = this.conc;\n\t\tdup.yield = this.yield;\n\t\tdup.primary = this.primary;\n\t\tdup.waste = this.waste;\n\t\tdup.equiv = this.equiv;\n\t\tdup.meta = this.meta;\n\t\treturn dup;\n\t}\n\n\tpublic equals(other:ExperimentComponent):boolean\n\t{\n\t\tif (this.name != other.name) return false;\n\t\tif (this.stoich != other.stoich || this.mass != other.mass || this.volume != other.volume || this.moles != other.moles ||\n\t\t\tthis.density != other.density || this.conc != other.conc || this.yield != other.yield || this.primary != other.primary ||\n\t\t\tthis.waste != other.waste || this.equiv != other.equiv || this.meta != other.meta) return false;\n\t\tif (this.mol === other.mol) return true; // if literally the same\n\t\tif (this.mol == null || other.mol == null) return false;\n\t\treturn this.mol.compareTo(other.mol) == 0;\n\t}\n\n\tpublic isBlank():boolean\n\t{\n\t\treturn MolUtil.isBlank(this.mol) && !this.name;\n\t}\n}\n\nexport class ExperimentStep\n{\n\tpublic reactants:ExperimentComponent[] = []; // non-blank only for the first step\n\tpublic reagents:ExperimentComponent[] = [];\n\tpublic products:ExperimentComponent[] = [];\n\tpublic meta = '';\n\n\tconstructor() {}\n\n\t// makes a deep copy (assuming that molecules are treated as immutable)\n\tpublic clone():ExperimentStep\n\t{\n\t\tlet dup = new ExperimentStep();\n\t\tfor (let c of this.reactants) dup.reactants.push(c.clone());\n\t\tfor (let c of this.reagents) dup.reagents.push(c.clone());\n\t\tfor (let c of this.products) dup.products.push(c.clone());\n\t\tdup.meta = this.meta;\n\t\treturn dup;\n\t}\n\n\tpublic equals(other:ExperimentStep):boolean\n\t{\n\t\tif (this.reactants.length != other.reactants.length) return false;\n\t\tif (this.reagents.length != other.reagents.length) return false;\n\t\tif (this.products.length != other.products.length) return false;\n\t\tif (this.meta != other.meta) return false;\n\t\tfor (let n = 0; n < this.reactants.length; n++) if (!this.reactants[n].equals(other.reactants[n])) return false;\n\t\tfor (let n = 0; n < this.reagents.length; n++) if (!this.reagents[n].equals(other.reagents[n])) return false;\n\t\tfor (let n = 0; n < this.products.length; n++) if (!this.products[n].equals(other.products[n])) return false;\n\t\treturn true;\n\t}\n}\n\nexport class ExperimentEntry\n{\n\tpublic title = '';\n\tpublic createDate:Date = null;\n\tpublic modifyDate:Date = null;\n\tpublic doi = '';\n\tpublic meta = '';\n\n\tpublic steps:ExperimentStep[] = [];\n\n\tconstructor() {}\n\n\t// makes a deep copy (assuming that molecules are treated as immutable)\n\tpublic clone():ExperimentEntry\n\t{\n\t\tlet dup = new ExperimentEntry();\n\t\tdup.title = this.title;\n\t\tdup.createDate = this.createDate;\n\t\tdup.modifyDate = this.modifyDate;\n\t\tdup.doi = this.doi;\n\t\tdup.meta = this.meta;\n\t\tfor (let s of this.steps) dup.steps.push(s.clone());\n\t\treturn dup;\n\t}\n\n\t// as above, but clones all the molecules too so they can be modified safely\n\tpublic deepClone():ExperimentEntry\n\t{\n\t\tlet dup = this.clone();\n\t\tfor (let step of dup.steps)\n\t\t{\n\t\t\tfor (let comp of step.reactants) if (comp.mol != null) comp.mol = comp.mol.clone();\n\t\t\tfor (let comp of step.reagents) if (comp.mol != null) comp.mol = comp.mol.clone();\n\t\t\tfor (let comp of step.products) if (comp.mol != null) comp.mol = comp.mol.clone();\n\t\t}\n\t\treturn dup;\n\t}\n\n\tpublic equals(other:ExperimentEntry):boolean\n\t{\n\t\tif (this.title != other.title) return false;\n\t\tlet d1 = this.createDate == null ? 0 : this.createDate.getTime(), d2 = other.createDate == null ? 0 : other.createDate.getTime();\n\t\tif (d1 != d2) return false;\n\t\tlet d3 = this.modifyDate == null ? 0 : this.modifyDate.getTime(), d4 = other.modifyDate == null ? 0 : other.modifyDate.getTime();\n\t\tif (d3 != d4) return false;\n\t\tif (this.doi != other.doi || this.meta != other.meta) return false;\n\t\tif (this.steps.length != other.steps.length) return false;\n\t\tfor (let n = 0; n < this.steps.length; n++) if (!this.steps[n].equals(other.steps[n])) return false;\n\t\treturn true;\n\t}\n\n\t// convenience: saves a switch\n\tpublic getComponent(step:number, type:ExperimentComponentType, idx:number):ExperimentComponent\n\t{\n\t\tif (type == ExperimentComponentType.Reactant) return this.steps[step].reactants[idx];\n\t\tif (type == ExperimentComponentType.Reagent) return this.steps[step].reagents[idx];\n\t\tif (type == ExperimentComponentType.Product) return this.steps[step].products[idx];\n\t\treturn new ExperimentComponent();\n\t}\n}\n\nexport class Experiment extends Aspect\n{\n\tpublic static CODE = 'org.mmi.aspect.Experiment';\n\tpublic static CODE_RXN = 'org.mmi.aspect.Reaction';\n\tpublic static CODE_YLD = 'org.mmi.aspect.Yield';\n\tpublic static NAME = 'Experiment';\n\tpublic static NAME_RXN = 'Reaction';\n\tpublic static NAME_YLD = 'Yield';\n\n\tpublic static COLNAME_EXPERIMENT_TITLE = 'ExperimentTitle';\n\tpublic static COLNAME_EXPERIMENT_CREATEDATE = 'ExperimentCreateDate';\n\tpublic static COLNAME_EXPERIMENT_MODIFYDATE = 'ExperimentModifyDate';\n\tpublic static COLNAME_EXPERIMENT_DOI = 'ExperimentDOI';\n\tpublic static COLNAME_EXPERIMENT_META = 'ExperimentMeta';\n\n\t// prefixes for Steps\n\tpublic static COLNAME_STEP_META = 'ExperimentStepMeta';\n\n\t// prefixes for Reactants\n\tpublic static COLNAME_REACTANT_MOL = 'ReactantMol';\n\tpublic static COLNAME_REACTANT_NAME = 'ReactantName';\n\tpublic static COLNAME_REACTANT_STOICH = 'ReactantStoich';\n\tpublic static COLNAME_REACTANT_MASS = 'ReactantMass';\n\tpublic static COLNAME_REACTANT_VOLUME = 'ReactantVolume';\n\tpublic static COLNAME_REACTANT_MOLES = 'ReactantMoles';\n\tpublic static COLNAME_REACTANT_DENSITY = 'ReactantDensity';\n\tpublic static COLNAME_REACTANT_CONC = 'ReactantConc';\n\tpublic static COLNAME_REACTANT_PRIMARY = 'ReactantPrimary';\n\tpublic static COLNAME_REACTANT_META = 'ReactantMeta';\n\n\t// prefixes for Reagents\n\tpublic static COLNAME_REAGENT_MOL = 'ReagentMol';\n\tpublic static COLNAME_REAGENT_NAME = 'ReagentName';\n\tpublic static COLNAME_REAGENT_EQUIV = 'ReagentEquiv';\n\tpublic static COLNAME_REAGENT_MASS = 'ReagentMass';\n\tpublic static COLNAME_REAGENT_VOLUME = 'ReagentVolume';\n\tpublic static COLNAME_REAGENT_MOLES = 'ReagentMoles';\n\tpublic static COLNAME_REAGENT_DENSITY = 'ReagentDensity';\n\tpublic static COLNAME_REAGENT_CONC = 'ReagentConc';\n\tpublic static COLNAME_REAGENT_META = 'ReagentMeta';\n\n\t// prefixes for Products\n\tpublic static COLNAME_PRODUCT_MOL = 'ProductMol';\n\tpublic static COLNAME_PRODUCT_NAME = 'ProductName';\n\tpublic static COLNAME_PRODUCT_STOICH = 'ProductStoich';\n\tpublic static COLNAME_PRODUCT_MASS = 'ProductMass';\n\tpublic static COLNAME_PRODUCT_VOLUME = 'ProductVolume';\n\tpublic static COLNAME_PRODUCT_MOLES = 'ProductMoles';\n\tpublic static COLNAME_PRODUCT_DENSITY = 'ProductDensity';\n\tpublic static COLNAME_PRODUCT_CONC = 'ProductConc';\n\tpublic static COLNAME_PRODUCT_YIELD = 'ProductYield';\n\tpublic static COLNAME_PRODUCT_WASTE = 'ProductWaste';\n\tpublic static COLNAME_PRODUCT_META = 'ProductMeta';\n\n\tpublic static COLUMN_DESCRIPTIONS:Record<string, string> = {};\n\n\tpublic static ALL_COLUMN_LITERALS =\n\t[\n\t\tExperiment.COLNAME_EXPERIMENT_TITLE,\n\t\tExperiment.COLNAME_EXPERIMENT_CREATEDATE,\n\t\tExperiment.COLNAME_EXPERIMENT_MODIFYDATE,\n\t\tExperiment.COLNAME_EXPERIMENT_DOI,\n\t\tExperiment.COLNAME_EXPERIMENT_META,\n\t\tExperiment.COLNAME_STEP_META,\n\t];\n\tpublic static ALL_COLUMN_PREFIXES =\n\t[\n\t\tExperiment.COLNAME_REACTANT_MOL,\n\t\tExperiment.COLNAME_REACTANT_NAME,\n\t\tExperiment.COLNAME_REACTANT_STOICH,\n\t\tExperiment.COLNAME_REACTANT_MASS,\n\t\tExperiment.COLNAME_REACTANT_VOLUME,\n\t\tExperiment.COLNAME_REACTANT_MOLES,\n\t\tExperiment.COLNAME_REACTANT_DENSITY,\n\t\tExperiment.COLNAME_REACTANT_CONC,\n\t\tExperiment.COLNAME_REACTANT_PRIMARY,\n\t\tExperiment.COLNAME_REACTANT_META,\n\t\tExperiment.COLNAME_REAGENT_MOL,\n\t\tExperiment.COLNAME_REAGENT_NAME,\n\t\tExperiment.COLNAME_REAGENT_EQUIV,\n\t\tExperiment.COLNAME_REAGENT_MASS,\n\t\tExperiment.COLNAME_REAGENT_VOLUME,\n\t\tExperiment.COLNAME_REAGENT_MOLES,\n\t\tExperiment.COLNAME_REAGENT_DENSITY,\n\t\tExperiment.COLNAME_REAGENT_CONC,\n\t\tExperiment.COLNAME_REAGENT_META,\n\t\tExperiment.COLNAME_PRODUCT_MOL,\n\t\tExperiment.COLNAME_PRODUCT_NAME,\n\t\tExperiment.COLNAME_PRODUCT_STOICH,\n\t\tExperiment.COLNAME_PRODUCT_MASS,\n\t\tExperiment.COLNAME_PRODUCT_VOLUME,\n\t\tExperiment.COLNAME_PRODUCT_MOLES,\n\t\tExperiment.COLNAME_PRODUCT_DENSITY,\n\t\tExperiment.COLNAME_PRODUCT_CONC,\n\t\tExperiment.COLNAME_PRODUCT_YIELD,\n\t\tExperiment.COLNAME_PRODUCT_WASTE,\n\t\tExperiment.COLNAME_PRODUCT_META,\n\t];\n\n\t// ----------------- public methods -----------------\n\n\t// used to test if a datasheet has the appropriate metadata flagging it as a feedstock-containing datasheet\n\tpublic static isExperiment(ds:DataSheet):boolean\n\t{\n\t\tfor (let n = 0; n < ds.numExtensions; n++) if (ds.getExtType(n) == Experiment.CODE) return true;\n\t\treturn false;\n\t}\n\n\tconstructor(ds?:DataSheet, allowModify?:boolean)\n\t{\n\t\tsuper(Experiment.CODE, ds, allowModify);\n\n\t\tif (Object.keys(Experiment.COLUMN_DESCRIPTIONS).length == 0)\n\t\t{\n\t\t\tlet v = Experiment.COLUMN_DESCRIPTIONS;\n\t\t\tv[Experiment.COLNAME_EXPERIMENT_TITLE] = 'Title description for the experiment';\n\t\t\tv[Experiment.COLNAME_EXPERIMENT_CREATEDATE] = 'Date the experiment was created (seconds since 1970)';\n\t\t\tv[Experiment.COLNAME_EXPERIMENT_MODIFYDATE] = 'Date the experiment was last modified (seconds since 1970)';\n\t\t\tv[Experiment.COLNAME_EXPERIMENT_DOI] = 'Digital object identifiers (DOI) for the experiment (whitespace separated)';\n\t\t\tv[Experiment.COLNAME_EXPERIMENT_META] = 'Additional experiment metadata';\n\t\t\tv[Experiment.COLNAME_STEP_META] = 'Additional step metadata';\n\t\t\tv[Experiment.COLNAME_REACTANT_MOL] = 'Molecular structure of reactant';\n\t\t\tv[Experiment.COLNAME_REACTANT_NAME] = 'Name of reactant';\n\t\t\tv[Experiment.COLNAME_REACTANT_STOICH] = 'Stoichiometry of reactant';\n\t\t\tv[Experiment.COLNAME_REACTANT_MASS] = 'Mass quantity of reactant (g)';\n\t\t\tv[Experiment.COLNAME_REACTANT_VOLUME] = 'Volume quantity of reactant (mL)';\n\t\t\tv[Experiment.COLNAME_REACTANT_MOLES] = 'Molar quantity of reactant (mol)';\n\t\t\tv[Experiment.COLNAME_REACTANT_DENSITY] = 'Density of reactant (g/mL)';\n\t\t\tv[Experiment.COLNAME_REACTANT_CONC] = 'Concentration of reactant (mol/L)';\n\t\t\tv[Experiment.COLNAME_REACTANT_PRIMARY] = 'Whether the reactant is used for yield calculation';\n\t\t\tv[Experiment.COLNAME_REACTANT_META] = 'Additional reactant metadata';\n\t\t\tv[Experiment.COLNAME_REAGENT_MOL] = 'Molecular structure of reagent';\n\t\t\tv[Experiment.COLNAME_REAGENT_NAME] = 'Name of reagent';\n\t\t\tv[Experiment.COLNAME_REAGENT_EQUIV] = 'Molar equivalents of reagent';\n\t\t\tv[Experiment.COLNAME_REAGENT_MASS] = 'Mass quantity of reagent (g)';\n\t\t\tv[Experiment.COLNAME_REAGENT_VOLUME] = 'Volume quantity of reagent (mL)';\n\t\t\tv[Experiment.COLNAME_REAGENT_MOLES] = 'Molar quantity of reagent (mol)';\n\t\t\tv[Experiment.COLNAME_REAGENT_DENSITY] = 'Density of reagent (g/mL)';\n\t\t\tv[Experiment.COLNAME_REAGENT_CONC] = 'Concentration of reagent (mol/L)';\n\t\t\tv[Experiment.COLNAME_REAGENT_META] = 'Additional reagent metadata';\n\t\t\tv[Experiment.COLNAME_PRODUCT_MOL] = 'Molecular structure of product';\n\t\t\tv[Experiment.COLNAME_PRODUCT_NAME] = 'Name of product';\n\t\t\tv[Experiment.COLNAME_PRODUCT_STOICH] = 'Stoichiometry of product';\n\t\t\tv[Experiment.COLNAME_PRODUCT_MASS] = 'Mass quantity of reactant (g)';\n\t\t\tv[Experiment.COLNAME_PRODUCT_VOLUME] = 'Volume quantity of reactant (mL)';\n\t\t\tv[Experiment.COLNAME_PRODUCT_MOLES] = 'Molar quantity of reactant (mol)';\n\t\t\tv[Experiment.COLNAME_PRODUCT_DENSITY] = 'Density of reactant (g/mL)';\n\t\t\tv[Experiment.COLNAME_PRODUCT_CONC] = 'Concentration of reactant (mol/L)';\n\t\t\tv[Experiment.COLNAME_PRODUCT_YIELD] = 'Yield of product (%)';\n\t\t\tv[Experiment.COLNAME_PRODUCT_WASTE] = 'Whether the product is an unwanted byproduct';\n\t\t\tv[Experiment.COLNAME_PRODUCT_META] = 'Additional product metadata';\n\t\t}\n\n\t\tthis.setup();\n\t}\n\n\t// returns true if the row is at the beginning of an experiment\n\tpublic isFirstStep(row:number):boolean\n\t{\n\t\tif (this.ds.notNull(row, Experiment.COLNAME_EXPERIMENT_CREATEDATE)) return true;\n\t\tlet mol = this.ds.getMolecule(row, Experiment.COLNAME_REACTANT_MOL + '1');\n\t\tif (MolUtil.notBlank(mol)) return true;\n\t\tlet name = this.ds.getString(row, Experiment.COLNAME_REACTANT_NAME + '1');\n\t\tif (name) return true;\n\t\treturn false;\n\t}\n\n\t// starting at the given row, figure out how many rows (\"steps\") the reaction spans; always 1-or-more\n\tpublic numberOfSteps(row:number):number\n\t{\n\t\tif (row >= this.ds.numRows) return 0;\n\t\tlet steps = 1;\n\t\twhile (row + steps < this.ds.numRows)\n\t\t{\n\t\t\tif (this.isFirstStep(row + steps)) break;\n\t\t\tsteps++;\n\t\t}\n\t\treturn steps;\n\t}\n\n\t// data access\n\tpublic getEntry(row:number):ExperimentEntry\n\t{\n\t\tlet entry = new ExperimentEntry();\n\n\t\tlet title = this.ds.getString(row, Experiment.COLNAME_EXPERIMENT_TITLE);\n\t\tif (title) entry.title = title;\n\t\tlet createDate = this.ds.getReal(row, Experiment.COLNAME_EXPERIMENT_CREATEDATE);\n\t\tif (createDate) entry.createDate = new Date(createDate * 1000);\n\t\tlet modifyDate = this.ds.getReal(row, Experiment.COLNAME_EXPERIMENT_MODIFYDATE);\n\t\tif (modifyDate) entry.modifyDate = new Date(modifyDate * 1000);\n\t\tlet doi = this.ds.getString(row, Experiment.COLNAME_EXPERIMENT_DOI);\n\t\tif (doi) entry.doi = doi;\n\t\tlet meta = this.ds.getString(row, Experiment.COLNAME_EXPERIMENT_META);\n\t\tif (meta) entry.meta = meta;\n\n\t\tlet [nreactants, nproducts, nreagents] = this.countComponents();\n\n\t\tfor (let pos = row; pos < this.ds.numRows; pos++)\n\t\t{\n\t\t\tif (pos > row && this.isFirstStep(pos)) break;\n\n\t\t\tlet step = new ExperimentStep();\n\t\t\tif (pos == row) for (let n = 1; n <= nreactants; n++)\n\t\t\t{\n\t\t\t\tlet comp = this.fetchReactant(pos, n);\n\t\t\t\tif (comp != null) step.reactants.push(comp); else break;\n\t\t\t}\n\t\t\tfor (let n = 1; n <= nproducts; n++)\n\t\t\t{\n\t\t\t\tlet comp = this.fetchProduct(pos, n);\n\t\t\t\tif (comp != null) step.products.push(comp); else break;\n\t\t\t}\n\t\t\tfor (let n = 1; n <= nreagents; n++)\n\t\t\t{\n\t\t\t\tlet comp = this.fetchReagent(pos, n);\n\t\t\t\tif (comp != null) step.reagents.push(comp); else break;\n\t\t\t}\n\t\t\tstep.meta = this.ds.getString(pos, Experiment.COLNAME_STEP_META);\n\n\t\t\tentry.steps.push(step);\n\t\t}\n\n\t\treturn entry;\n\t}\n\tpublic setEntry(row:number, entry:ExperimentEntry):void\n\t{\n\t\tthis.putEntry(row, entry, true);\n\t}\n\tpublic addEntry(entry:ExperimentEntry):void\n\t{\n\t\tthis.putEntry(this.ds.numRows, entry, false);\n\t}\n\tpublic insertEntry(row:number, entry:ExperimentEntry):void\n\t{\n\t\tthis.putEntry(row, entry, false);\n\t}\n\tpublic deleteEntry(row:number):void\n\t{\n\t\tlet nsteps = this.numberOfSteps(row);\n\t\tfor (let n = row + nsteps - 1; n >= row; n--) this.ds.deleteRow(n);\n\t}\n\n\t// ----------------- private methods -----------------\n\n\t// workhorse for the constructor\n\tprivate setup():void\n\t{\n\t\tthis.parseAndCorrect();\n\t}\n\n\t// assuming that the underlying datasheet definitely is a datasheet, makes any necessary corrections to force it into compliance\n\tprivate parseAndCorrect():void\n\t{\n\t\tlet ds = this.ds;\n\t\tlet idxRxn = -1, idxYld = -1, idxExp = -1;\n\t\tlet extRxn = '', extYld = '', extExp = '';\n\t\tfor (let n = 0; n < ds.numExtensions; n++)\n\t\t{\n\t\t\tif (ds.getExtType(n) == Experiment.CODE_RXN) {idxRxn = n; extRxn = ds.getExtData(n);}\n\t\t\telse if (ds.getExtType(n) == Experiment.CODE_YLD) {idxYld = n; extYld = ds.getExtData(n);}\n\t\t\telse if (ds.getExtType(n) == Experiment.CODE) {idxExp = n; extExp = ds.getExtData(n);}\n\t\t}\n\n\t\t// note: the implied Reaction aspect is the only metadata field that actually holds content\n\t\tlet [nreactants, nproducts, nreagents] = this.parseReactionMetaData(extRxn);\n\t\tlet meta = `nreactants=${nreactants}\\nnproducts=${nproducts}\\nnreagents=${nreagents}\\n`;\n\t\tif (idxRxn >= 0) ds.setExtData(idxRxn, meta); else ds.appendExtension(Experiment.NAME_RXN, Experiment.CODE_RXN, meta);\n\t\tif (idxYld >= 0) ds.setExtData(idxYld, ''); else ds.appendExtension(Experiment.NAME_YLD, Experiment.CODE_YLD, '');\n\t\tif (idxExp >= 0) ds.setExtData(idxExp, ''); else ds.appendExtension(Experiment.NAME, Experiment.CODE, '');\n\n\t\tthis.forceColumn(Experiment.COLNAME_EXPERIMENT_TITLE, DataSheetColumn.String);\n\t\tthis.forceColumn(Experiment.COLNAME_EXPERIMENT_CREATEDATE, DataSheetColumn.Real);\n\t\tthis.forceColumn(Experiment.COLNAME_EXPERIMENT_MODIFYDATE, DataSheetColumn.Real);\n\t\tthis.forceColumn(Experiment.COLNAME_EXPERIMENT_DOI, DataSheetColumn.String);\n\t\tthis.forceColumn(Experiment.COLNAME_EXPERIMENT_META, DataSheetColumn.String);\n\n\t\tthis.forceColumn(Experiment.COLNAME_STEP_META, DataSheetColumn.String);\n\n\t\tfor (let n = 1; n <= nreactants; n++) this.forceReactantColumns(n);\n\t\tfor (let n = 1; n <= nreagents; n++) this.forceReagentColumns(n);\n\t\tfor (let n = 1; n <= nproducts; n++) this.forceProductColumns(n);\n\t}\n\n\t// force-adds respective groups of columns as necessary\n\tprivate forceColumn(colName:string, type:DataSheetColumn, suffix?:number):void\n\t{\n\t\tlet useName = colName + (suffix == null ? '' : suffix);\n\t\tthis.ds.ensureColumn(useName, type, Experiment.COLUMN_DESCRIPTIONS[colName]);\n\t}\n\tprivate forceReactantColumns(suffix:number):void\n\t{\n\t\tthis.forceColumn(Experiment.COLNAME_REACTANT_MOL, DataSheetColumn.Molecule, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_REACTANT_NAME, DataSheetColumn.String, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_REACTANT_STOICH, DataSheetColumn.String, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_REACTANT_MASS, DataSheetColumn.Real, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_REACTANT_VOLUME, DataSheetColumn.Real, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_REACTANT_MOLES, DataSheetColumn.Real, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_REACTANT_DENSITY, DataSheetColumn.Real, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_REACTANT_CONC, DataSheetColumn.Real, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_REACTANT_PRIMARY, DataSheetColumn.Boolean, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_REACTANT_META, DataSheetColumn.String, suffix);\n\t}\n\tprivate forceReagentColumns(suffix:number):void\n\t{\n\t\tthis.forceColumn(Experiment.COLNAME_REAGENT_MOL, DataSheetColumn.Molecule, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_REAGENT_NAME, DataSheetColumn.String, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_REAGENT_EQUIV, DataSheetColumn.Real, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_REAGENT_MASS, DataSheetColumn.Real, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_REAGENT_VOLUME, DataSheetColumn.Real, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_REAGENT_MOLES, DataSheetColumn.Real, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_REAGENT_DENSITY, DataSheetColumn.Real, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_REAGENT_CONC, DataSheetColumn.Real, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_REAGENT_META, DataSheetColumn.String, suffix);\n\t}\n\tprivate forceProductColumns(suffix:number):void\n\t{\n\t\tthis.forceColumn(Experiment.COLNAME_PRODUCT_MOL, DataSheetColumn.Molecule, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_PRODUCT_NAME, DataSheetColumn.String, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_PRODUCT_STOICH, DataSheetColumn.String, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_PRODUCT_MASS, DataSheetColumn.Real, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_PRODUCT_VOLUME, DataSheetColumn.Real, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_PRODUCT_MOLES, DataSheetColumn.Real, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_PRODUCT_DENSITY, DataSheetColumn.Real, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_PRODUCT_CONC, DataSheetColumn.Real, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_PRODUCT_YIELD, DataSheetColumn.Real, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_PRODUCT_WASTE, DataSheetColumn.Boolean, suffix);\n\t\tthis.forceColumn(Experiment.COLNAME_PRODUCT_META, DataSheetColumn.String, suffix);\n\t}\n\n\tprivate parseReactionMetaData(content:string):[number, number, number]\n\t{\n\t\tlet nreactants = 1, nproducts = 1, nreagents = 0;\n\n\t\tfor (let line of content.split(/\\r?\\n/))\n\t\t{\n\t\t\tif (line.startsWith('nreactants=')) nreactants = Math.max(nreactants, Math.min(100, parseInt(line.substring(11))));\n\t\t\telse if (line.startsWith('nproducts=')) nproducts = Math.max(nproducts, Math.min(100, parseInt(line.substring(10))));\n\t\t\telse if (line.startsWith('nreagents=')) nreagents = Math.max(nreagents, Math.min(100, parseInt(line.substring(10))));\n\t\t}\n\n\t\treturn [nreactants, nproducts, nreagents];\n\t}\n\n\t// more convenient version of above which scans the header; for routine use, post-setup\n\tprivate countComponents():[number, number, number]\n\t{\n\t\tlet nreactants = 0, nproducts = 0, nreagents = 0;\n\t\tfor (let n = 0; n < this.ds.numExtensions; n++) if (this.ds.getExtType(n) == Experiment.CODE_RXN)\n\t\t{\n\t\t\t[nreactants, nproducts, nreagents] = this.parseReactionMetaData(this.ds.getExtData(n));\n\t\t\tbreak;\n\t\t}\n\t\treturn [nreactants, nproducts, nreagents];\n\t}\n\n\t// pulls out the respective component types from the underlying fields\n\tprivate fetchReactant(row:number, idx:number):ExperimentComponent\n\t{\n\t\tlet mol = this.ds.getMoleculeClone(row, `${Experiment.COLNAME_REACTANT_MOL}${idx}`);\n\t\tlet name = this.ds.getString(row, `${Experiment.COLNAME_REACTANT_NAME}${idx}`);\n\t\tif (MolUtil.isBlank(mol) && !name) return null;\n\n\t\tlet comp = new ExperimentComponent(mol, name);\n\t\tlet stoich = this.ds.getString(row, `${Experiment.COLNAME_REACTANT_STOICH}${idx}`);\n\t\tif (stoich) comp.stoich = stoich;\n\t\tcomp.mass = this.ds.getReal(row, `${Experiment.COLNAME_REACTANT_MASS}${idx}`);\n\t\tcomp.volume = this.ds.getReal(row, `${Experiment.COLNAME_REACTANT_VOLUME}${idx}`);\n\t\tcomp.moles = this.ds.getReal(row, `${Experiment.COLNAME_REACTANT_MOLES}${idx}`);\n\t\tcomp.density = this.ds.getReal(row, `${Experiment.COLNAME_REACTANT_DENSITY}${idx}`);\n\t\tcomp.conc = this.ds.getReal(row, `${Experiment.COLNAME_REACTANT_CONC}${idx}`);\n\t\tlet primary = this.ds.getBoolean(row, `${Experiment.COLNAME_REACTANT_PRIMARY}${idx}`);\n\t\tif (primary != null) comp.primary = primary;\n\t\tcomp.meta = this.ds.getString(row, `${Experiment.COLNAME_REACTANT_META}${idx}`);\n\t\treturn comp;\n\t}\n\tprivate fetchProduct(row:number, idx:number):ExperimentComponent\n\t{\n\t\tlet mol = this.ds.getMoleculeClone(row, `${Experiment.COLNAME_PRODUCT_MOL}${idx}`);\n\t\tlet name = this.ds.getString(row, `${Experiment.COLNAME_PRODUCT_NAME}${idx}`);\n\t\tif (MolUtil.isBlank(mol) && !name) return null;\n\n\t\tlet comp = new ExperimentComponent(mol, name);\n\t\tlet stoich = this.ds.getString(row, `${Experiment.COLNAME_PRODUCT_STOICH}${idx}`);\n\t\tif (stoich) comp.stoich = stoich;\n\t\tcomp.mass = this.ds.getReal(row, `${Experiment.COLNAME_PRODUCT_MASS}${idx}`);\n\t\tcomp.volume = this.ds.getReal(row, `${Experiment.COLNAME_PRODUCT_VOLUME}${idx}`);\n\t\tcomp.moles = this.ds.getReal(row, `${Experiment.COLNAME_PRODUCT_MOLES}${idx}`);\n\t\tcomp.density = this.ds.getReal(row, `${Experiment.COLNAME_PRODUCT_DENSITY}${idx}`);\n\t\tcomp.conc = this.ds.getReal(row, `${Experiment.COLNAME_PRODUCT_CONC}${idx}`);\n\t\tcomp.yield = this.ds.getReal(row, `${Experiment.COLNAME_PRODUCT_YIELD}${idx}`);\n\t\tlet waste = this.ds.getBoolean(row, `${Experiment.COLNAME_PRODUCT_WASTE}${idx}`);\n\t\tif (waste != null) comp.waste = waste;\n\t\tcomp.meta = this.ds.getString(row, `${Experiment.COLNAME_PRODUCT_META}${idx}`);\n\t\treturn comp;\n\t}\n\tprivate fetchReagent(row:number, idx:number):ExperimentComponent\n\t{\n\t\tlet mol = this.ds.getMoleculeClone(row, `${Experiment.COLNAME_REAGENT_MOL}${idx}`);\n\t\tlet name = this.ds.getString(row, `${Experiment.COLNAME_REAGENT_NAME}${idx}`);\n\t\tif (MolUtil.isBlank(mol) && !name) return null;\n\n\t\tlet comp = new ExperimentComponent(mol, name);\n\t\tcomp.mass = this.ds.getReal(row, `${Experiment.COLNAME_REAGENT_MASS}${idx}`);\n\t\tcomp.volume = this.ds.getReal(row, `${Experiment.COLNAME_REAGENT_VOLUME}${idx}`);\n\t\tcomp.moles = this.ds.getReal(row, `${Experiment.COLNAME_REAGENT_MOLES}${idx}`);\n\t\tcomp.density = this.ds.getReal(row, `${Experiment.COLNAME_REAGENT_DENSITY}${idx}`);\n\t\tcomp.conc = this.ds.getReal(row, `${Experiment.COLNAME_REAGENT_CONC}${idx}`);\n\t\tcomp.equiv = this.ds.getReal(row, `${Experiment.COLNAME_REAGENT_EQUIV}${idx}`);\n\t\tcomp.meta = this.ds.getString(row, `${Experiment.COLNAME_REAGENT_META}${idx}`);\n\t\treturn comp;\n\t}\n\n\t// returns the list of operations needed to \"set\" an entry: this may involve adjusting columns, modifying extensions,\n\t// and deleting/inserting rows... as well as replacing cell content\n\tprivate putEntry(row:number, entry:ExperimentEntry, replace:boolean):void\n\t{\n\t\t// make sure the metadata is in place\n\t\tlet [preactants, pproducts, preagents] = this.countComponents();\n\t\tlet [nreactants, nproducts, nreagents] = [preactants, pproducts, preagents];\n\t\tfor (let step of entry.steps)\n\t\t{\n\t\t\tnreactants = Math.max(nreactants, step.reactants.length);\n\t\t\tnproducts = Math.max(nproducts, step.products.length);\n\t\t\tnreagents = Math.max(nreagents, step.reagents.length);\n\t\t}\n\t\tif (nreactants != preactants || nproducts != pproducts || nreagents != preagents)\n\t\t{\n\t\t\tlet meta = `nreactants=${nreactants}\\nnproducts=${nproducts}\\nnreagents=${nreagents}`;\n\t\t\tlet got = false;\n\t\t\tfor (let n = 0; n < this.ds.numExtensions; n++) if (this.ds.getExtType(n) == Experiment.CODE_RXN)\n\t\t\t{\n\t\t\t\tthis.ds.setExtData(n, meta);\n\t\t\t\tgot = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (!got) this.ds.appendExtension(Experiment.NAME_RXN, Experiment.CODE_RXN, meta);\n\t\t}\n\n\t\t// make sure all columns are present and of the right type\n\t\tfor (let n = 1; n <= nreactants; n++) this.forceReactantColumns(n);\n\t\tfor (let n = 1; n <= nreagents; n++) this.forceReagentColumns(n);\n\t\tfor (let n = 1; n <= nproducts; n++) this.forceProductColumns(n);\n\n\t\t// sync up the number of steps, if necessary\n\t\tlet oldSteps = replace ? this.numberOfSteps(row) : 0, newSteps = entry.steps.length;\n\t\tif (oldSteps > newSteps)\n\t\t{\n\t\t\tfor (let n = newSteps; n < oldSteps; n++) this.ds.deleteRow(row + newSteps - 1);\n\t\t}\n\t\telse if (newSteps > oldSteps)\n\t\t{\n\t\t\tfor (let n = oldSteps; n < newSteps; n++) this.ds.insertRow(row + oldSteps);\n\t\t}\n\n\t\t// emit the header\n\t\tthis.ds.setString(row, Experiment.COLNAME_EXPERIMENT_TITLE, entry.title);\n\t\tthis.ds.setReal(row, Experiment.COLNAME_EXPERIMENT_CREATEDATE, entry.createDate == null ? null : entry.createDate.getTime() * 1E-3);\n\t\tthis.ds.setReal(row, Experiment.COLNAME_EXPERIMENT_MODIFYDATE, entry.modifyDate == null ? null : entry.modifyDate.getTime() * 1E-3);\n\t\tthis.ds.setString(row, Experiment.COLNAME_EXPERIMENT_DOI, entry.doi);\n\t\tthis.ds.setString(row, Experiment.COLNAME_EXPERIMENT_META, entry.meta);\n\n\t\t// emit the steps and components\n\t\tfor (let s = 0; s < entry.steps.length; s++)\n\t\t{\n\t\t\tlet r = row + s, step = entry.steps[s];\n\t\t\tif (s == 0) for (let n = 0; n < step.reactants.length; n++)\n\t\t\t{\n\t\t\t\tlet comp = step.reactants[n], i = n + 1;\n\t\t\t\tthis.ds.setMolecule(r, `${Experiment.COLNAME_REACTANT_MOL}${i}`, comp.mol);\n\t\t\t\tthis.ds.setString(r, `${Experiment.COLNAME_REACTANT_NAME}${i}`, comp.name);\n\t\t\t\tthis.ds.setString(r, `${Experiment.COLNAME_REACTANT_STOICH}${i}`, comp.stoich);\n\t\t\t\tthis.ds.setReal(r, `${Experiment.COLNAME_REACTANT_MASS}${i}`, comp.mass);\n\t\t\t\tthis.ds.setReal(r, `${Experiment.COLNAME_REACTANT_VOLUME}${i}`, comp.volume);\n\t\t\t\tthis.ds.setReal(r, `${Experiment.COLNAME_REACTANT_MOLES}${i}`, comp.moles);\n\t\t\t\tthis.ds.setReal(r, `${Experiment.COLNAME_REACTANT_DENSITY}${i}`, comp.density);\n\t\t\t\tthis.ds.setReal(r, `${Experiment.COLNAME_REACTANT_CONC}${i}`, comp.conc);\n\t\t\t\tthis.ds.setBoolean(r, `${Experiment.COLNAME_REACTANT_PRIMARY}${i}`, comp.primary);\n\t\t\t\tthis.ds.setString(r, `${Experiment.COLNAME_REACTANT_META}${i}`, comp.meta);\n\t\t\t}\n\t\t\tfor (let n = 0; n < step.reagents.length; n++)\n\t\t\t{\n\t\t\t\tlet comp = step.reagents[n], i = n + 1;\n\t\t\t\tthis.ds.setMolecule(r, `${Experiment.COLNAME_REAGENT_MOL}${i}`, comp.mol);\n\t\t\t\tthis.ds.setString(r, `${Experiment.COLNAME_REAGENT_NAME}${i}`, comp.name);\n\t\t\t\tthis.ds.setReal(r, `${Experiment.COLNAME_REAGENT_EQUIV}${i}`, comp.equiv);\n\t\t\t\tthis.ds.setReal(r, `${Experiment.COLNAME_REAGENT_MASS}${i}`, comp.mass);\n\t\t\t\tthis.ds.setReal(r, `${Experiment.COLNAME_REAGENT_VOLUME}${i}`, comp.volume);\n\t\t\t\tthis.ds.setReal(r, `${Experiment.COLNAME_REAGENT_MOLES}${i}`, comp.moles);\n\t\t\t\tthis.ds.setReal(r, `${Experiment.COLNAME_REAGENT_DENSITY}${i}`, comp.density);\n\t\t\t\tthis.ds.setReal(r, `${Experiment.COLNAME_REAGENT_CONC}${i}`, comp.conc);\n\t\t\t\tthis.ds.setString(r, `${Experiment.COLNAME_REAGENT_META}${i}`, comp.meta);\n\t\t\t}\n\t\t\tfor (let n = 0; n < step.products.length; n++)\n\t\t\t{\n\t\t\t\tlet comp = step.products[n], i = n + 1;\n\t\t\t\tthis.ds.setMolecule(r, `${Experiment.COLNAME_PRODUCT_MOL}${i}`, comp.mol);\n\t\t\t\tthis.ds.setString(r, `${Experiment.COLNAME_PRODUCT_NAME}${i}`, comp.name);\n\t\t\t\tthis.ds.setString(r, `${Experiment.COLNAME_PRODUCT_STOICH}${i}`, comp.stoich);\n\t\t\t\tthis.ds.setReal(r, `${Experiment.COLNAME_PRODUCT_MASS}${i}`, comp.mass);\n\t\t\t\tthis.ds.setReal(r, `${Experiment.COLNAME_PRODUCT_VOLUME}${i}`, comp.volume);\n\t\t\t\tthis.ds.setReal(r, `${Experiment.COLNAME_PRODUCT_MOLES}${i}`, comp.moles);\n\t\t\t\tthis.ds.setReal(r, `${Experiment.COLNAME_PRODUCT_DENSITY}${i}`, comp.density);\n\t\t\t\tthis.ds.setReal(r, `${Experiment.COLNAME_PRODUCT_CONC}${i}`, comp.conc);\n\t\t\t\tthis.ds.setReal(r, `${Experiment.COLNAME_PRODUCT_YIELD}${i}`, comp.yield);\n\t\t\t\tthis.ds.setBoolean(r, `${Experiment.COLNAME_PRODUCT_WASTE}${i}`, comp.waste);\n\t\t\t\tthis.ds.setString(r, `${Experiment.COLNAME_PRODUCT_META}${i}`, comp.meta);\n\t\t\t}\n\t\t\tthis.ds.setString(r, Experiment.COLNAME_STEP_META, step.meta);\n\t\t}\n\n\t\t// trash anything beyond the incoming limits\n\t\tfor (let s = 0; s < entry.steps.length; s++)\n\t\t{\n\t\t\tlet r = row + s;\n\t\t\tlet start = s > 0 ? 0 : entry.steps[s].reactants.length;\n\t\t\tfor (let n = start; n < nreactants; n++)\n\t\t\t{\n\t\t\t\tlet i = n + 1;\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_REACTANT_MOL}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_REACTANT_NAME}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_REACTANT_STOICH}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_REACTANT_MASS}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_REACTANT_VOLUME}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_REACTANT_MOLES}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_REACTANT_DENSITY}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_REACTANT_CONC}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_REACTANT_PRIMARY}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_REACTANT_META}${i}`);\n\t\t\t}\n\t\t\tfor (let n = entry.steps[s].reagents.length; n < nreagents; n++)\n\t\t\t{\n\t\t\t\tlet i = n + 1;\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_REAGENT_MOL}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_REAGENT_NAME}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_REAGENT_EQUIV}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_REAGENT_MASS}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_REAGENT_VOLUME}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_REAGENT_MOLES}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_REAGENT_DENSITY}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_REAGENT_CONC}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_REAGENT_META}${i}`);\n\t\t\t}\n\t\t\tfor (let n = entry.steps[s].products.length; n < nproducts; n++)\n\t\t\t{\n\t\t\t\tlet i = n + 1;\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_PRODUCT_MOL}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_PRODUCT_NAME}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_PRODUCT_STOICH}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_PRODUCT_MASS}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_PRODUCT_VOLUME}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_PRODUCT_MOLES}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_PRODUCT_DENSITY}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_PRODUCT_CONC}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_PRODUCT_WASTE}${i}`);\n\t\t\t\tthis.ds.setToNull(r, `${Experiment.COLNAME_PRODUCT_META}${i}`);\n\t\t\t}\n\t\t}\n\t}\n\n\t// ------------------ aspect implementation --------------------\n\n\tpublic plainHeading():string {return Experiment.NAME;}\n\n\tpublic rowFirstBlock(row:number):boolean {return this.isFirstStep(row);}\n\tpublic rowBlockCount(row:number):number {return this.numberOfSteps(row);}\n\n\tpublic initiateNewRow(row:number):void\n\t{\n\t\tlet curTime = new Date().getTime() * 1E-3;\n\t\tthis.ds.setReal(row, Experiment.COLNAME_EXPERIMENT_CREATEDATE, curTime);\n\t}\n\n\tpublic columnEffectivelyBlank(row:number):string[]\n\t{\n\t\treturn [Experiment.COLNAME_EXPERIMENT_CREATEDATE];\n\t}\n\n\tpublic isColumnReserved(colName:string):boolean\n\t{\n\t\treturn this.areColumnsReserved([colName])[0];\n\t}\n\n\tpublic areColumnsReserved(colNames:string[]):boolean[]\n\t{\n\t\tlet resv = Vec.booleanArray(false, colNames.length);\n\t\tfor (let n = 0; n < colNames.length; n++)\n\t\t{\n\t\t\tlet name = colNames[n];\n\t\t\tif (Experiment.ALL_COLUMN_LITERALS.indexOf(name) >= 0)\n\t\t\t{\n\t\t\t\tresv[n] = true;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfor (let pfx of Experiment.ALL_COLUMN_PREFIXES) if (name.startsWith(pfx))\n\t\t\t{\n\t\t\t\tresv[n] = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn resv;\n\t}\n\n\t// render the experiment in scheme form\n\t// TODO: other forms can be rendered (summary, metrics, quantity)\n\tpublic numGraphicRenderings(row:number):number {return 1;}\n\tpublic produceGraphicRendering(row:number, idx:number, policy:RenderPolicy):AspectGraphicRendering\n\t{\n\t\tlet measure = new OutlineMeasurement(0, 0, policy.data.pointScale);\n\t\tlet layout = new ArrangeExperiment(this.getEntry(row), measure, policy);\n\t\tlayout.limitTotalW = 50 * policy.data.pointScale;\n\t\tlayout.limitTotalH = 50 * policy.data.pointScale;\n\t\tlayout.includeStoich = true;\n\t\tlayout.includeAnnot = false;\n\n\t\tlayout.arrange();\n\n\t\tlet metavec = new MetaVector();\n\t\tnew DrawExperiment(layout, metavec).draw();\n\t\tmetavec.normalise();\n\n\t\treturn {name: 'Scheme', metavec: metavec};\n\t}\n\n/*\topen override func numTextRenderings(row:Int) -> Int {return 1}\n\topen override func produceTextRendering(row:Int, idx:Int) -> (name:String, descr:String, text:String)\n\t{\n\t\tvar retName = \"\", retDescr = \"\", retText = \"\"\n\t\tdata.observe() {(ds:DataSheet) in (retName, retDescr, retText) = self.produceTextRendering(row:row, idx:idx, ds:ds)}\n\t\treturn (name:retName, descr:retDescr, text:retText)\n\t}\n\topen override func produceTextRendering(row:Int, idx:Int, ds:DataSheet) -> (name:String, descr:String, text:String)\n\t{\n\t\tassert(idx == 0, \"Invalid index to Experiment.produceTextRendering\")\n\n\t\tlet entry = getEntry(row, ds:ds)\n\t\tvar lines:[String] = []\n\n\t\tif !entry.title.isEmpty {lines.append(\"Title: \\(entry.title)\")}\n\n\t\tlet datefmt = DateFormatter()\n\t\tdatefmt.dateStyle = .medium\n\t\tdatefmt.timeStyle = .medium\n\n\t\tif let createDate = entry.createDate {lines.append(\"Created: \\(datefmt.string(from:createDate))\")}\n\t\tif let modifyDate = entry.modifyDate {lines.append(\"Modified: \\(datefmt.string(from:modifyDate))\")}\n\n\t\tif !entry.doi.isEmpty {lines.append(\"DOI: \\(entry.doi)\")}\n\n\t\tlet txt = lines.joined(separator:\"\\n\")\n\n\t\treturn (name:\"Header\", descr:\"Experiment description and metadata\", text:txt)\n\t}\n\n\topen override func numGraphicRenderings(row:Int) -> Int {return 3}\n\topen override func produceGraphicRendering(row:Int, idx:Int, policy:RenderPolicy, vg:VectorGfxBuilder) -> (name:String, vg:VectorGfxBuilder)\n\t{\n\t\tvar retName = \"\", retVG = vg\n\t\tdata.observe() {(ds:DataSheet) in (retName, retVG) = self.produceGraphicRendering(row:row, idx:idx, policy:policy, vg:vg, ds:ds)}\n\t\treturn (name:retName, vg:retVG)\n\t}\n\topen override func produceGraphicRendering(row:Int, idx:Int, policy:RenderPolicy, vg:VectorGfxBuilder, ds:DataSheet) -> (name:String, vg:VectorGfxBuilder)\n\t{\n\t\tif idx == Render.Scheme\n\t\t{\n\t\t\tlet entry = getEntry(row, ds:ds)\n\t\t\tlet layout = ArrangeExperiment(entry:entry, measure:OutlineMeasurement(scale:policy.pointScale, yUp:false), policy:policy)\n\n\t\t\tlayout.limitTotalW = 50 * policy.pointScale\n\t\t\tlayout.limitTotalH = 50 * policy.pointScale\n\t\t\tlayout.arrange()\n\n\t\t\t//vg.drawLine(x1:0, y1:0, x2:layout.width, y2:layout.height, colour:0xFF0000, thickness:1)\n\t\t\tlet vgexp = DrawExperiment(layout:layout, vg:vg)\n\t\t\tvgexp.draw()\n\n\t\t\treturn (name:\"Scheme\", vg:vg)\n\t\t}\n\t\telse if idx == Render.Quantity\n\t\t{\n\t\t\tlet entry = getEntry(row, ds:ds)\n\t\t\tlet layout = ArrangeExpQuant(entry:entry, measure:OutlineMeasurement(scale:policy.pointScale, yUp:false), policy:policy)\n\t\t\tlayout.idealAspect = 1.4\n\t\t\tlayout.arrange()\n\t\t\tlayout.render(vg)\n\t\t}\n\t\telse if idx == Render.Metrics\n\t\t{\n\t\t\tlet entry = getEntry(row, ds:ds)\n\t\t\tlet layout = ArrangeExpMetrics(entry:entry, measure:OutlineMeasurement(scale:policy.pointScale, yUp:false), policy:policy)\n\t\t\tlayout.idealAspect = 1.4\n\t\t\tlayout.arrange()\n\t\t\tlayout.render(vg)\n\t\t}\n\t\treturn (name:\"\", vg:vg)\n\t}*/\n}\n\nregisterAspect(Experiment);\n\n","/*\n    WebMolKit\n\n    (c) 2010-2021 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n    [PKG=webmolkit]\n*/\n\nimport {DataSheet} from '../data/DataSheet';\nimport {MoleculeStream} from '../data/MoleculeStream';\nimport {Vec} from '../util/Vec';\nimport {Aspect} from './Aspect';\nimport {registerAspect} from './AspectList';\nimport {MeasurementData} from './MeasurementData';\n\n/*\n\tMixture: stores metadata about various columns such that they can be corralled into a hierarchical form that represents\n\ta mixed group of chemical substances, where individual components and branches have structure, name, quantity and various\n\tother properties when available. Designed to be compatible with the Mixfile format (https://github.com/cdd/mixtures) and\n\tIUPAC Mixtures InChI (MInChI) notation.\n*/\n\nexport enum MixtureAttributeType\n{\n\tStructure = 'structure',\n\tName = 'name',\n\tQuantity = 'quantity',\n\tBound = 'bound',\n\tError = 'error',\n\tRatio = 'ratio',\n\tUnits = 'units',\n\tRelation = 'relation',\n\tIdentifier = 'identifier',\n\tLink = 'link',\n\tProperty = 'property',\n}\n\nexport interface MixtureAttribute\n{\n\tcolumn:string;\n\tposition:number[];\n\ttype:MixtureAttributeType;\n\tinfo?:string[];\n}\n\nexport interface MixtureHeader\n{\n\tattributes:MixtureAttribute[];\n}\n\nexport class Mixture extends Aspect\n{\n\tpublic static CODE = 'org.mmi.aspect.Mixture';\n\tpublic static NAME = 'Mixture';\n\n\tpublic static SUFFIX_VALUE = '';\n\tprivate header:MixtureHeader = {attributes: []};\n\n\t// ----------------- public methods -----------------\n\n\t// used to test if a datasheet has the appropriate metadata\n\tpublic static isMixture(ds:DataSheet):boolean\n\t{\n\t\tfor (let n = 0; n < ds.numExtensions; n++) if (ds.getExtType(n) == Mixture.CODE) return true;\n\t\treturn false;\n\t}\n\n\tconstructor(ds?:DataSheet, allowModify?:boolean)\n\t{\n\t\tsuper(Mixture.CODE, ds, allowModify);\n\t\tthis.setup();\n\t}\n\n\t// data access\n\tpublic getHeader():MixtureHeader\n\t{\n\t\treturn this.header;\n\t}\n\tpublic setHeader(header:MixtureHeader):void\n\t{\n\t\tthis.header = header;\n\t\tlet content = this.formatMetaData(header);\n\t\tfor (let n = 0; n < this.ds.numExtensions; n++) if (this.ds.getExtType(n) == Mixture.CODE)\n\t\t{\n\t\t\tthis.ds.setExtData(n, content);\n\t\t\treturn;\n\t\t}\n\t\tthis.ds.appendExtension(Mixture.NAME, Mixture.CODE, content);\n\t}\n\n\t// ----------------- private methods -----------------\n\n\t// workhorse for the constructor\n\tprivate setup():void\n\t{\n\t\tthis.parseAndCorrect();\n\t}\n\n\t// assuming that the underlying datasheet definitely is a datasheet, makes any necessary corrections to force it into compliance\n\tprivate parseAndCorrect():void\n\t{\n\t\tthis.header = {attributes: []};\n\n\t\tlet got = false;\n\t\tfor (let n = 0; n < this.ds.numExtensions; n++) if (this.ds.getExtType(n) == Mixture.CODE)\n\t\t{\n\t\t\tthis.header = this.parseMetaData(this.ds.getExtData(n));\n\t\t\tgot = true;\n\t\t\tbreak;\n\t\t}\n\n\t\tif (!got && this.allowModify)\n\t\t{\n\t\t\tlet content = this.formatMetaData(this.header);\n\t\t\tthis.ds.appendExtension(Mixture.NAME, Mixture.CODE, content);\n\t\t}\n\t}\n\n\t// interprets the string metadata from the extensions\n\tprivate parseMetaData(content:string):MixtureHeader\n\t{\n\t\tlet header:MixtureHeader = {attributes: []};\n\n\t\tfor (let line of content.split(/\\r?\\n/))\n\t\t{\n\t\t\tlet eq = line.indexOf('=');\n\t\t\tif (eq < 0) continue;\n\t\t\tif (line.startsWith('attr='))\n\t\t\t{\n\t\t\t\tlet bits = line.substring(eq + 1).split(',');\n\t\t\t\tif (bits.length < 3) continue;\n\t\t\t\tlet column = MoleculeStream.skUnescape(bits[0]);\n\t\t\t\tlet position:number[] = [];\n\t\t\t\tif (bits[1] != '0') position = bits[1].split('.').map((str) => parseInt(str));\n\t\t\t\tlet type = bits[2] as MixtureAttributeType;\n\t\t\t\tlet info:string[] = [];\n\t\t\t\tfor (let n = 3; n < bits.length; n++) info.push(MoleculeStream.skUnescape(bits[n]));\n\n\t\t\t\theader.attributes.push({column, position, type, info});\n\t\t\t}\n\t\t}\n\t\treturn header;\n\t}\n\n\t// deserialises the header metadata\n\tprivate formatMetaData(header:MixtureHeader):string\n\t{\n\t\tlet lines:string[] = [];\n\n\t\tfor (let a of header.attributes)\n\t\t{\n\t\t\tlet bits:string[] = [MoleculeStream.skEscape(a.column)];\n\t\t\tif (Vec.isBlank(a.position)) bits.push('0'); else bits.push(a.position.join('.'));\n\t\t\tbits.push(a.type);\n\t\t\tif (a.info) for (let str of a.info) bits.push(MoleculeStream.skEscape(str));\n\t\t\tlines.push('attr=' + bits.join(','));\n\t\t}\n\n\t\treturn lines.join('\\n');\n\t}\n\n\t// ------------------ aspect implementation --------------------\n\n\tpublic plainHeading():string {return MeasurementData.NAME;}\n\n\tpublic isColumnReserved(colName:string):boolean\n\t{\n\t\treturn this.areColumnsReserved([colName])[0];\n\t}\n\tpublic areColumnsReserved(colNames:string[]):boolean[]\n\t{\n\t\tlet names = new Set<string>();\n\t\tfor (let a of this.header.attributes) names.add(a.column);\n\t\tlet resv:boolean[] = [];\n\t\tfor (let col of colNames) resv.push(names.has(col));\n\t\treturn resv;\n\t}\n}\n\nregisterAspect(Mixture);\n\n","/*\n\tWebMolKit\n\n\t(c) 2010-2019 Molecular Materials Informatics, Inc.\n\n\tAll rights reserved\n\n\thttp://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {fltEqual} from '../util/util';\nimport {Vec} from '../util/Vec';\nimport {Chemistry} from './Chemistry';\nimport {ForeignMoleculeTransient} from './ForeignMolecule';\nimport {Graph} from './Graph';\nimport {Molecule} from './Molecule';\n\n/* eslint-disable no-multi-spaces */\n\n/*\n\tA meta-description of a molecule that divides the molecular graph up into chunks based on their\n\tability to provide pi-like resonance electrons. Atoms that are deemed to be invariant to the passage\n\tof resonance electrons (most notably sp3 carbons) are considered to break up these pathways. The\n\tremaining components-of-resonance are assigned bond orders based on the ratio of electrons to # bonds.\n*/\n\nexport interface DotPathBlock\n{\n\tatoms:number[];\n\tbonds:number[];\n\t// (average bond order = numer/denom)\n\tnumer:number; // # of electrons contributed to the block\n\tdenom:number; // 2 * number of bonds\n}\n\n// discrete bond type categories (these collapse the fractional bond orders)\nexport const enum DotPathBond\n{\n\tO0 = 0, // exactly zero\n\tO01 = 1, // from 0..1 (exclusive)\n\tO1 = 2, // exactly one\n\tO12 = 3, // from 1..2 (exclusive)\n\tO2 = 4, // exactly two\n\tO23 = 5, // from 2..3 (exclusive)\n\tO3 = 6, // exactly three\n\tO3X = 7, // more than three\n}\n\n// discrete charge type categories (these collapse fractional charges)\nexport const enum DotPathCharge\n{\n\tN1X = -3, // less than -1\n\tN1 = -2, // exactly -1\n\tN01 = -1, // a bit less than zero\n\tZ0 = 0, // exactly zero\n\tP01 = 1, // a bit more than zero\n\tP1 = 2, // exactly +1\n\tP1X = 3, // more than +1\n}\n\nexport class DotPath\n{\n\tpublic maskBlock:boolean[]; // atoms that are considered blocking; generally not important for interpretation\n\tpublic paths:DotPathBlock[] = []; // the blocks of dots: note that only bonds that have a different bond order under the dot-scheme are listed\n\n\t// ------------------ public methods --------------------\n\n\t// instantiates the DotPath content right away, unless the molecule argument is null\n\tconstructor(public mol:Molecule)\n\t{\n\t\tif (mol) this.calculate();\n\t}\n\n\t// shallow clone\n\tpublic clone():DotPath\n\t{\n\t\tlet dup = new DotPath(null);\n\t\tdup.mol = this.mol;\n\t\tdup.maskBlock = this.maskBlock;\n\t\tdup.paths = this.paths.slice(0);\n\t\treturn dup;\n\t}\n\n\t// returns recomputed bond orders: any atom that's part of a dot-path gets assigned with a fractional bond order based on\n\t// the path characteristics, while the rest of them get their original integral bond order\n\tpublic getBondOrders():number[]\n\t{\n\t\tconst mol = this.mol;\n\t\tlet orders:number[] = [];\n\t\tfor (let n = 1; n <= mol.numBonds; n++) orders.push(mol.bondOrder(n));\n\t\tfor (let path of this.paths)\n\t\t{\n\t\t\t// compute fractional bond order, and guard against rounding errors (i.e. want literal whole numbers when appropriate)\n\t\t\tlet fract = path.numer / path.denom;\n\t\t\tfor (let n = 1; n <= 5; n++) if (fltEqual(fract, n)) fract = n;\n\t\t\tfor (let b of path.bonds) orders[b - 1] = fract;\n\t\t}\n\t\treturn orders;\n\t}\n\n\t// as above, except returns the bond orders as predetermined bins, corresponding to ordinals and intermediates\n\tpublic getBondClasses():DotPathBond[]\n\t{\n\t\tconst mol = this.mol;\n\t\tlet classes:DotPathBond[] = [];\n\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t{\n\t\t\tlet bo = mol.bondOrder(n);\n\t\t\tclasses.push(bo == 0 ? DotPathBond.O0 :\n\t\t\t\t\t\t bo == 1 ? DotPathBond.O1 :\n\t\t\t\t\t\t bo == 2 ? DotPathBond.O2 :\n\t\t\t\t\t\t bo == 3 ? DotPathBond.O3 : DotPathBond.O3X);\n\t\t}\n\t\tfor (let path of this.paths)\n\t\t{\n\t\t\t// compute fractional bond order, and guard against rounding errors (i.e. want literal whole numbers when appropriate)\n\t\t\tlet fract = path.numer / path.denom;\n\t\t\tlet bcls = fltEqual(fract, 0) ? DotPathBond.O0 :\n\t\t\t\t\t   fltEqual(fract, 1) ? DotPathBond.O1 :\n\t\t\t\t\t   fltEqual(fract, 2) ? DotPathBond.O2 :\n\t\t\t\t\t   fltEqual(fract, 3) ? DotPathBond.O3 :\n\t\t\t\t\t   fract < 1 ? DotPathBond.O01 :\n\t\t\t\t\t   fract < 2 ? DotPathBond.O12 :\n\t\t\t\t\t   fract < 3 ? DotPathBond.O23 : DotPathBond.O3X;\n\t\t\tfor (let b of path.bonds) classes[b - 1] = bcls;\n\t\t}\n\t\treturn classes;\n\t}\n\n\t// return one of the categories of fractional charges\n\tpublic getChargeClasses():DotPathCharge[]\n\t{\n\t\tconst mol = this.mol;\n\t\tlet classes:DotPathCharge[] = [];\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t{\n\t\t\tlet chg = mol.atomCharge(n);\n\t\t\tclasses.push(chg == 0 ? DotPathCharge.Z0 :\n\t\t\t\t\t\t chg == -1 ? DotPathCharge.N1 :\n\t\t\t\t\t\t chg == 1 ? DotPathCharge.P1 :\n\t\t\t\t\t\t chg < -1 ? DotPathCharge.N1X : DotPathCharge.P1X);\n\t\t}\n\t\tfor (let path of this.paths)\n\t\t{\n\t\t\tlet chg = 0;\n\t\t\tfor (let a of path.atoms) chg += mol.atomCharge(a);\n\t\t\tchg /= path.atoms.length;\n\t\t\tlet ccls = fltEqual(chg, 0) ? DotPathCharge.Z0 :\n\t\t\t\t\t   fltEqual(chg, -1) ? DotPathCharge.N1 :\n\t\t\t\t\t   fltEqual(chg, 1) ? DotPathCharge.P1 :\n\t\t\t\t\t   chg > -1 && chg < 0 ? DotPathCharge.N01 :\n\t\t\t\t\t   chg > 0 && chg < 1 ? DotPathCharge.P01 :\n\t\t\t\t\t   chg < -1 ? DotPathCharge.N1X : DotPathCharge.P1X;\n\t\t\tfor (let a of path.atoms) classes[a - 1] = ccls;\n\t\t}\n\t\treturn classes;\n\t}\n\n\t// return for each atom the total charge of the path to which it belongs (which is related to above, but isn't binned)\n\tpublic getAggregateCharges():number[]\n\t{\n\t\tconst mol = this.mol;\n\t\tlet chg:number[] = [];\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) chg[n - 1] = mol.atomCharge(n);\n\t\tfor (let path of this.paths)\n\t\t{\n\t\t\tlet total = 0;\n\t\t\tfor (let a of path.atoms) total += chg[a - 1];\n\t\t\tfor (let a of path.atoms) chg[a - 1] = total;\n\t\t}\n\t\treturn chg;\n\t}\n\n\t// for debugging purposes\n\tpublic toString():string\n\t{\n\t\tlet str = 'blocking=' + JSON.stringify(this.maskBlock) + '; paths=' + this.paths.length;\n\t\tfor (let p of this.paths) str += ' [' + p.numer + '/' + p.denom + ';a=' + JSON.stringify(p.atoms) + ';b=' + JSON.stringify(p.bonds) + ']';\n\t\treturn str;\n\t}\n\n\t// ------------------ private methods --------------------\n\n\tprivate calculate():void\n\t{\n\t\tconst mol = this.mol, na = mol.numAtoms, nb = mol.numBonds;\n\n\t\t// gather metrics\n\t\tlet nonsingle = Vec.booleanArray(false, na), pibonded = Vec.booleanArray(false, na), metalbonded = Vec.booleanArray(false, na);\n\t\tlet bondsum = Vec.numberArray(0, na); // explicit bond orders + virtual hydrogens\n\t\tfor (let n = 0; n < na; n++) bondsum[n] = mol.atomHydrogens(n + 1);\n\t\tfor (let n = 1; n <= nb; n++)\n\t\t{\n\t\t\tlet bo = mol.bondOrder(n), bfr = mol.bondFrom(n), bto = mol.bondTo(n);\n\t\t\tif (bo != 1)\n\t\t\t{\n\t\t\t\tnonsingle[bfr - 1] = true;\n\t\t\t\tnonsingle[bto - 1] = true;\n\t\t\t}\n\t\t\tif (bo >= 2)\n\t\t\t{\n\t\t\t\tpibonded[bfr - 1] = true;\n\t\t\t\tpibonded[bto - 1] = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet blk1 = Chemistry.ELEMENT_BLOCKS[mol.atomicNumber(bfr)], blk2 = Chemistry.ELEMENT_BLOCKS[mol.atomicNumber(bto)];\n\t\t\t\tif (blk1 >= 3 || blk2 >= 3)\n\t\t\t\t{\n\t\t\t\t\tmetalbonded[bfr - 1] = true;\n\t\t\t\t\tmetalbonded[bto - 1] = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbondsum[bfr - 1] += bo;\n\t\t\tbondsum[bto - 1] += bo;\n\n\t\t\t// respect externally indicated aromaticity\n\t\t\tif (mol.bondTransient(n).indexOf(ForeignMoleculeTransient.BondAromatic) >= 0)\n\t\t\t{\n\t\t\t\tpibonded[bfr - 1] = true;\n\t\t\t\tpibonded[bto - 1] = true;\n\t\t\t}\n\t\t}\n\n\t\t// \"implied pi\" atoms are those which are wedged between two or more pi atoms; this is extended out just one iteration\n\t\tlet impliedPi = Vec.booleanArray(false, na);\n\t\tfor (let n = 1; n <= na; n++) if (!pibonded[n - 1])\n\t\t{\n\t\t\tlet adjpi = 0;\n\t\t\tfor (let adj of mol.atomAdjList(n)) if (pibonded[adj - 1] || metalbonded[adj - 1]) adjpi++;\n\t\t\tif (adjpi >= 2) impliedPi[n - 1] = true;\n\t\t}\n\t\tfor (let n = 0; n < na; n++) if (impliedPi[n]) pibonded[n] = true;\n\n\t\t// first pass: find things that are definitely blocking, or maybe blocking\n\t\tthis.maskBlock = Vec.booleanArray(false, na);\n\t\tlet maskMaybe = Vec.booleanArray(false, na); // might be blocking, as long as neighbours also maybe\n\n\t\t// main groups which could potentially be blocking if they are neutral and have just sigma bonds that add up to the regular octet valence\n\t\tconst COULD_BLOCK =\n\t\t[\n\t\t\tChemistry.ELEMENT_H,\n\t\t\tChemistry.ELEMENT_B,  Chemistry.ELEMENT_C,  Chemistry.ELEMENT_N,  Chemistry.ELEMENT_O,  Chemistry.ELEMENT_F,\n\t\t\tChemistry.ELEMENT_Al, Chemistry.ELEMENT_Si, Chemistry.ELEMENT_P,  Chemistry.ELEMENT_S,  Chemistry.ELEMENT_Cl,\n\t\t\tChemistry.ELEMENT_Ga, Chemistry.ELEMENT_Ge, Chemistry.ELEMENT_As, Chemistry.ELEMENT_Se, Chemistry.ELEMENT_Br,\n\t\t\tChemistry.ELEMENT_In, Chemistry.ELEMENT_Sn, Chemistry.ELEMENT_Sb, Chemistry.ELEMENT_Te, Chemistry.ELEMENT_I,\n\t\t\tChemistry.ELEMENT_Tl, Chemistry.ELEMENT_Pb, Chemistry.ELEMENT_Bi, Chemistry.ELEMENT_Po, Chemistry.ELEMENT_At,\n\t\t];\n\n\t\t// acids/bases: whenever one is paired with the other, it's not a blocking possibility\n\t\tconst ACIDS =\n\t\t[\n\t\t\tChemistry.ELEMENT_B,\n\t\t\tChemistry.ELEMENT_Al, Chemistry.ELEMENT_Si,\n\t\t\tChemistry.ELEMENT_Ga, Chemistry.ELEMENT_Ge,\n\t\t\tChemistry.ELEMENT_In, Chemistry.ELEMENT_Sn,\n\t\t\tChemistry.ELEMENT_Tl, Chemistry.ELEMENT_Pb,\n\t\t];\n\t\tconst BASES =\n\t\t[\n\t\t\tChemistry.ELEMENT_N,  Chemistry.ELEMENT_O,  Chemistry.ELEMENT_F,\n\t\t\tChemistry.ELEMENT_P,  Chemistry.ELEMENT_S,  Chemistry.ELEMENT_Cl,\n\t\t\tChemistry.ELEMENT_As, Chemistry.ELEMENT_Se, Chemistry.ELEMENT_Br,\n\t\t\tChemistry.ELEMENT_Sb, Chemistry.ELEMENT_Te, Chemistry.ELEMENT_I,\n\t\t\tChemistry.ELEMENT_Bi, Chemistry.ELEMENT_Po, Chemistry.ELEMENT_At,\n\t\t];\n\n\t\tskip: for (let n = 0; n < na; n++)\n\t\t{\n\t\t\tconst a = n + 1;\n\n\t\t\t// must be all single bonds, uncharged, non-radical, in the list of potentially block elements, and have a bonding sum equal\n\t\t\t// to the valence\n\t\t\tif (nonsingle[n] || pibonded[n]) continue;\n\t\t\tif (mol.atomCharge(a) != 0 || mol.atomUnpaired(a) != 0) continue;\n\t\t\tconst atno = mol.atomicNumber(a);\n\t\t\tif (atno == 0)\n\t\t\t{\n\t\t\t\tthis.maskBlock[n] = true;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (COULD_BLOCK.indexOf(atno) < 0) continue;\n\t\t\tif (bondsum[n] != Chemistry.ELEMENT_BONDING[atno]) continue;\n\n\t\t\tif (ACIDS.indexOf(atno) >= 0)\n\t\t\t{\n\t\t\t\tfor (let adj of mol.atomAdjList(a)) if (BASES.indexOf(mol.atomicNumber(adj)) >= 0) continue skip;\n\t\t\t}\n\t\t\tif (BASES.indexOf(atno) >= 0)\n\t\t\t{\n\t\t\t\tfor (let adj of mol.atomAdjList(a)) if (ACIDS.indexOf(mol.atomicNumber(adj)) >= 0) continue skip;\n\t\t\t}\n\n\t\t\tmaskMaybe[n] = true;\n\n\t\t\t// if carbon and has no metal neighbours, it's sp3 and definitely blocking\n\t\t\tif (atno == Chemistry.ELEMENT_C)\n\t\t\t{\n\t\t\t\tlet hasMetal = false;\n\t\t\t\tfor (let adj of mol.atomAdjList(a)) if (COULD_BLOCK.indexOf(mol.atomicNumber(adj)) < 0) hasMetal = true;\n\t\t\t\tif (!hasMetal) this.maskBlock[n] = true;\n\t\t\t}\n\t\t\t// ... or if hydrogen, have already established that there's no interesting valence, so it's blocking\n\t\t\telse if (atno == Chemistry.ELEMENT_H)\n\t\t\t{\n\t\t\t\tthis.maskBlock[n] = true;\n\t\t\t}\n\t\t}\n\n\t\t// any \"maybe\" atom that is surrounded by other maybe atoms gets approved as a blocking atom\n\t\t// note: this is non-chaining; might need to reconsider this, i.e. make maybe-to-not propagate\n\t\tskip: for (let n = 0; n < na; n++) if (maskMaybe[n] && !this.maskBlock[n])\n\t\t{\n\t\t\tfor (let a of mol.atomAdjList(n + 1)) if (!maskMaybe[a - 1]) continue skip;\n\t\t\tthis.maskBlock[n] = true;\n\t\t}\n\n\t\t// now build the graph, and pick apart the blocked units\n\t\tlet g = Graph.fromMolecule(mol);\n\t\tfor (let n = 0; n < na; n++) if (this.maskBlock[n]) g.isolateNode(n);\n\t\tfor (let cc of g.calculateComponentGroups())\n\t\t{\n\t\t\tif (cc.length == 1) continue;\n\t\t\tlet amask = Vec.idxMask(cc, na);\n\t\t\tVec.addTo(cc, 1);\n\n\t\t\tlet p:DotPathBlock =\n\t\t\t{\n\t\t\t\tatoms: cc,\n\t\t\t\tbonds: [],\n\t\t\t\tnumer: 0,\n\t\t\t\tdenom: 0\n\t\t\t};\n\t\t\tfor (let n = 1; n <= nb; n++) if (amask[mol.bondFrom(n) - 1] && amask[mol.bondTo(n) - 1]) p.bonds.push(n);\n\n\t\t\tlet totalHave = 0, totalWant = 0;\n\t\t\tfor (let a of p.atoms)\n\t\t\t{\n\t\t\t\tlet others = mol.atomHydrogens(a); // bonds to atoms not in path; these are single bonds, by definition\n\t\t\t\tfor (let o of mol.atomAdjList(a)) if (!amask[o - 1]) others++;\n\n\t\t\t\tlet atno = mol.atomicNumber(a);\n\t\t\t\tlet have = Chemistry.ELEMENT_VALENCE[atno] - mol.atomCharge(a) - others;\n\t\t\t\tlet want = Chemistry.ELEMENT_SHELL[atno] - Chemistry.ELEMENT_VALENCE[atno] - others;\n\t\t\t\ttotalHave += have;\n\t\t\t\ttotalWant += want;\n\t\t\t}\n\n\t\t\tlet electrons = Math.min(totalHave, totalWant);\n\n\t\t\tp.numer = electrons;\n\t\t\tp.denom = 2 * p.bonds.length;\n\t\t\tthis.paths.push(p);\n\t\t}\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2024 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {GeomUtil, Spline} from './Geom';\nimport {DEGRAD, fltEqual, norm2_xy, norm_xy, sqr, TWOPI} from './util';\nimport {Vec} from './Vec';\n\n/*\n\tGiven a collection of points that is shaped somewhat like an oval-esque outline (i.e. a molecule ring that might be squished and rotated\n\tsomewhat) finds a rotated ellipse that fills it out, up to a certain margin distance.\n\n\tThere is no straightforward mathematical formula for this, and so the algorithm is done by way of a crude optimisation. It is intended\n\tto be more fast than correct, since it needs to run on an interactive timescale. Edge cases may fail in ugly ways.\n\n\tThe bezier is parametrised as (cx,cy,rw,rh,theta).\n\n\tNote that the algorithm is reasonably fast, but it can add up when being used in real time. There's a caching system to help with this.\n*/\n\nconst CACHE_SIZE = 1000;\n\nexport class FitRotatedEllipse\n{\n\tprivate static cacheVal:FitRotatedEllipse[] = [];\n\tprivate static cacheMap = new Map<string, FitRotatedEllipse>();\n\n\t// these are the results\n\tpublic cx:number;\n\tpublic cy:number;\n\tpublic rw:number;\n\tpublic rh:number;\n\tpublic theta = 0;\n\n\t// working variables\n\tprivate psz:number;\n\tprivate invpsz:number;\n\tprivate stop = false;\n\tprivate currentScore:number;\n\tprivate hashKey:string;\n\n\t// ------------ public methods ------------\n\n\tconstructor(public px:number[], public py:number[], public margin:number)\n\t{\n\t\tthis.hashKey = JSON.stringify([this.px, this.py]);\n\t}\n\n\tpublic calculate():void\n\t{\n\t\tif (this.lookupCache()) return;\n\n\t\tthis.setupParameters();\n\t\tif (this.stop) return;\n\n\t\tthis.currentScore = this.calculateScore(this.cx, this.cy, this.rw, this.rh);\n\n\t\tthis.coarseDiscovery();\n\t\tthis.fineImprovement();\n\n\t\tthis.theta = -this.theta;\n\n\t\tthis.saveCache();\n\t}\n\n\t// converts the calculated result into a Bezier spline for convenient rendering\n\tpublic getSpline():Spline\n\t{\n\t\treturn GeomUtil.createBezierEllipse(this.cx, this.cy, this.rw, this.rh, this.theta);\n\t}\n\n\t// ------------ private methods ------------\n\n\tprivate lookupCache():boolean\n\t{\n\t\tlet hashKey = this.hashKey;\n\t\tlet look = FitRotatedEllipse.cacheMap.get(hashKey);\n\t\tif (look)\n\t\t{\n\t\t\tthis.cx = look.cx;\n\t\t\tthis.cy = look.cy;\n\t\t\tthis.rw = look.rw;\n\t\t\tthis.rh = look.rh;\n\t\t\tthis.theta = look.theta;\n\n\t\t\t// rotate the hit to the tip of the cache\n\t\t\tconst {cacheVal} = FitRotatedEllipse;\n\t\t\tfor (let n = cacheVal.length - 1; n >= 0; n--) if (cacheVal[n].hashKey == hashKey)\n\t\t\t{\n\t\t\t\tif (n < cacheVal.length - 1)\n\t\t\t\t{\n\t\t\t\t\tcacheVal.push(cacheVal[n]);\n\t\t\t\t\tcacheVal.splice(n, 1);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate saveCache():void\n\t{\n\t\tlet hashKey = this.hashKey;\n\t\tconst {cacheVal, cacheMap} = FitRotatedEllipse;\n\n\t\tcacheVal.push(this);\n\t\tcacheMap.set(hashKey, this);\n\n\t\twhile (cacheVal.length > CACHE_SIZE)\n\t\t{\n\t\t\tcacheMap.delete(cacheVal[0].hashKey);\n\t\t\tcacheVal.splice(0);\n\t\t}\n\t}\n\n\tprivate setupParameters():void\n\t{\n\t\tconst psz = this.psz = this.px.length;\n\t\tconst invpsz = this.invpsz = 1.0 / psz;\n\t\tthis.cx = Vec.sum(this.px) * invpsz;\n\t\tthis.cy = Vec.sum(this.py) * invpsz;\n\t\tlet ptheta:number[] = new Array(psz), pdist:number[] = new Array(psz);\n\t\tfor (let n = 0; n < psz; n++)\n\t\t{\n\t\t\tptheta[n] = Math.atan2(this.py[n] - this.cy, this.px[n] - this.cx);\n\t\t\tpdist[n] = norm_xy(this.px[n] - this.cx, this.py[n] - this.cy);\n\t\t}\n\t\tlet order = Vec.idxSort(ptheta);\n\t\tthis.px = Vec.idxGet(this.px, order);\n\t\tthis.py = Vec.idxGet(this.py, order);\n\t\tptheta = Vec.idxGet(ptheta, order);\n\t\tpdist = Vec.idxGet(pdist, order);\n\n\t\tlet buffX:number[] = new Array(psz), buffY:number[] = new Array(psz);\n\t\tconst rotatedScore = (ptheta:number[], pdist:number[], rtheta:number):number =>\n\t\t{\n\t\t\tfor (let n = 0; n < psz; n++)\n\t\t\t{\n\t\t\t\tbuffX[n] = pdist[n] * Math.cos(ptheta[n] + rtheta);\n\t\t\t\tbuffY[n] = pdist[n] * Math.sin(ptheta[n] + rtheta);\n\t\t\t}\n\t\t\tlet scx = Vec.sum(buffX) * invpsz, scy = Vec.sum(buffY) * invpsz;\n\t\t\tlet devx = 0, devy = 0;\n\t\t\tfor (let n = 0; n < psz; n++)\n\t\t\t{\n\t\t\t\tdevx += sqr(buffX[n] - scx);\n\t\t\t\tdevy += Math.abs(buffY[n] - scy);\n\t\t\t}\n\t\t\treturn devy / (1 + devx);\n\t\t};\n\n\t\tlet bestScore = Number.POSITIVE_INFINITY;\n\t\tfor (let n = 0; n < 360; n++)\n\t\t{\n\t\t\tlet th = n * DEGRAD;\n\t\t\tlet score = rotatedScore(ptheta, pdist, th);\n\t\t\tif (score < bestScore) {this.theta = th; bestScore = score;}\n\t\t}\n\t\tfor (let dth = -1; dth <= 1; dth += 0.05)\n\t\t{\n\t\t\tlet th = this.theta + dth * DEGRAD;\n\t\t\tlet score = rotatedScore(ptheta, pdist, th);\n\t\t\tif (score < bestScore) {this.theta = th; bestScore = score;}\n\t\t}\n\t\tfor (let n = 0; n < psz; n++)\n\t\t{\n\t\t\tthis.px[n] = this.cx + pdist[n] * Math.cos(ptheta[n] + this.theta);\n\t\t\tthis.py[n] = this.cy + pdist[n] * Math.sin(ptheta[n] + this.theta);\n\t\t}\n\t\tthis.cx = Vec.sum(this.px) * invpsz;\n\t\tthis.cy = Vec.sum(this.py) * invpsz;\n\n\t\tthis.rw = this.rh = 1;\n\t}\n\n\tprivate coarseDiscovery():void\n\t{\n\t\tconst {margin} = this;\n\n\t\tlet deltaD = 0.1 * margin, deltaR = 0.5 * deltaD;\n\t\tconst DELTA_OPTIONS:{dx:number, dy:number, dw:number, dh:number}[] =\n\t\t[\n\t\t\t{dx: -1, dy: 0, dw: 0, dh: 0},\n\t\t\t{dx: 1, dy: 0, dw: 0, dh: 0},\n\t\t\t{dx: 0, dy: -1, dw: 0, dh: 0},\n\t\t\t{dx: 0, dy: 1, dw: 0, dh: 0},\n\t\t\t{dx: 0, dy: 0, dw: -1, dh: 0},\n\t\t\t{dx: 0, dy: 0, dw: 1, dh: 0},\n\t\t\t{dx: 0, dy: 0, dw: 0, dh: -1},\n\t\t\t{dx: 0, dy: 0, dw: 0, dh: 1},\n\t\t];\n\n\t\tfor (let sanity = 0; sanity < 1000; sanity++)\n\t\t{\n\t\t\tlet anything = false;\n\t\t\tlet bestScore = this.currentScore;\n\t\t\tlet bestCX = this.cx, bestCY = this.cy, bestRW = this.rw, bestRH = this.rh;\n\n\t\t\tfor (let delta of DELTA_OPTIONS)\n\t\t\t{\n\t\t\t\tlet newCX = this.cx + delta.dx * deltaD;\n\t\t\t\tlet newCY = this.cy + delta.dy * deltaD;\n\t\t\t\tlet newRW = this.rw + delta.dw * deltaR;\n\t\t\t\tlet newRH = this.rh + delta.dh * deltaR;\n\n\t\t\t\tlet newScore = this.calculateScore(newCX, newCY, newRW, newRH);\n\t\t\t\tif (newScore > bestScore && !fltEqual(newScore, bestScore))\n\t\t\t\t{\n\t\t\t\t\tanything = true;\n\t\t\t\t\tbestScore = newScore;\n\t\t\t\t\tbestCX = newCX;\n\t\t\t\t\tbestCY = newCY;\n\t\t\t\t\tbestRW = newRW;\n\t\t\t\t\tbestRH = newRH;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!anything) break;\n\n\t\t\tthis.currentScore = bestScore;\n\t\t\tthis.cx = bestCX;\n\t\t\tthis.cy = bestCY;\n\t\t\tthis.rw = bestRW;\n\t\t\tthis.rh = bestRH;\n\t\t}\n\t}\n\n\tprivate fineImprovement():void\n\t{\n\t\tconst {margin} = this;\n\n\t\tlet deltaD = 0.1 * margin, deltaR = 0.5 * deltaD;\n\t\tconst REDUCTION = 2.0 / 3;\n\t\tconst MAX_REDUCTIONS = 20;\n\t\tfor (let reduc = 0; reduc < MAX_REDUCTIONS; reduc++)\n\t\t{\n\t\t\tlet anything = false;\n\t\t\tlet bestScore = this.currentScore;\n\t\t\tlet bestCX = this.cx, bestCY = this.cy, bestRW = this.rw, bestRH = this.rh;\n\n\t\t\tfor (let dCX = -1; dCX <= 1; dCX++)\n\t\t\t{\n\t\t\t\tlet newCX = this.cx + dCX * deltaD;\n\t\t\t\tfor (let dCY = -1; dCY <= 1; dCY++)\n\t\t\t\t{\n\t\t\t\t\tlet newCY = this.cy + dCY * deltaD;\n\t\t\t\t\tfor (let dRW = -1; dRW <= 1; dRW++)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet newRW = this.rw + dRW * deltaR;\n\t\t\t\t\t\tfor (let dRH = -1; dRH <= 1; dRH++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet newRH = this.rh + dRH * deltaR;\n\t\t\t\t\t\t\tif (dCX == 0 && dCY == 0 && dRW == 0 && dRH == 0) continue;\n\t\t\t\t\t\t\tlet newScore = this.calculateScore(newCX, newCY, newRW, newRH);\n\t\t\t\t\t\t\tif (newScore > bestScore && !fltEqual(newScore, bestScore))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tanything = true;\n\t\t\t\t\t\t\t\tbestScore = newScore;\n\t\t\t\t\t\t\t\tbestCX = newCX;\n\t\t\t\t\t\t\t\tbestCY = newCY;\n\t\t\t\t\t\t\t\tbestRW = newRW;\n\t\t\t\t\t\t\t\tbestRH = newRH;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (anything)\n\t\t\t{\n\t\t\t\tthis.currentScore = bestScore;\n\t\t\t\tthis.cx = bestCX;\n\t\t\t\tthis.cy = bestCY;\n\t\t\t\tthis.rw = bestRW;\n\t\t\t\tthis.rh = bestRH;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treduc++;\n\t\t\t\tdeltaD *= REDUCTION;\n\t\t\t\tdeltaR *= REDUCTION;\n\t\t\t}\n\t\t}\n\t}\n\n\t// calculate a score for a given state; higher is better, zero is unacceptable\n\tprivate calculateScore(cx:number, cy:number, rw:number, rh:number,):number\n\t{\n\t\tconst {px, py, margin} = this, psz = px.length;\n\n\t\t// radiate out a series of \"spokes\" that make up points of the rotated ellipse; if any of these crosses an outline segment\n\t\tconst nseg = 24;\n\t\tlet cosTheta = 1, sinTheta = 0;\n\t\tlet incrAlpha = TWOPI / nseg;\n\n\t\tlet closestDSQ = Vec.numberArray(Number.POSITIVE_INFINITY, psz);\n\n\t\tfor (let n = 0; n < nseg; n++)\n\t\t{\n\t\t\tlet alpha = n * incrAlpha;\n\t\t\tlet cosAlpha = Math.cos(alpha), sinAlpha = Math.sin(alpha);\n\t\t\tlet dx = rw * cosAlpha * cosTheta - rh * sinAlpha * sinTheta;\n\t\t\tlet dy = rw * cosAlpha * sinTheta + rh * sinAlpha * cosTheta;\n\n\t\t\tlet d = norm_xy(dx, dy) + margin, eth = Math.atan2(dy, dx);\n\t\t\tlet x = cx + d * Math.cos(eth);\n\t\t\tlet y = cy + d * Math.sin(eth);\n\n\t\t\tfor (let i = 0; i < psz; i++)\n\t\t\t{\n\t\t\t\tlet ii = i == psz - 1 ? 0 : i + 1;\n\t\t\t\tif (GeomUtil.doLineSegsIntersect(cx, cy, x, y, px[i], py[i], px[ii], py[ii])) return 0;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < psz; i++) closestDSQ[i] = Math.min(closestDSQ[i], norm2_xy(x - px[i], y - py[i]));\n\t\t}\n\n\t\tlet proxSum = 0;\n\t\tfor (let dsq of closestDSQ) proxSum += 1.0 / (1 + Math.sqrt(dsq));\n\n\t\t// it isn't violated, so bigger is better\n\t\treturn rw * rh + proxSum;\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2019 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\n/* eslint-disable comma-spacing */\n\n/*\n\tFontData: stores information about the general font, sufficient to recreate and layout every glyph.\n*/\n\nexport interface FontDataNativeOpt\n{\n\tbold?:boolean;\n\titalic?:boolean;\n}\n\nexport class FontData\n{\n\tpublic static main = new FontData();\n\n\tpublic UNITS_PER_EM = 2048;\n\tpublic INV_UNITS_PER_EM = 1.0 / this.UNITS_PER_EM;\n\tpublic PANOSE_1 = '2 11 6 4 3 5 4 4 2 4';\n\tpublic ASCENT = 1638;\n\tpublic DESCENT = -410;\n\tpublic MISSING_HORZ = 2048;\n\tpublic MISSING_DATA = 'M256 0v1536h1536v-1536h-1536zM384 128h1280v1280h-1280v-1280z';\n\tpublic ASCENT_FUDGE = 0.9;\n\tpublic UNICODE =\n\t[\n\t\t' ', '!', '\"', '#', '$', '%', '&', '\\'', '(', ')', '*', '+', ',', '-', '.', '/', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', ':', ';', '<',\n\t\t'=', '>', '?', '@', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z',\n\t\t'[', '\\\\', ']', '^', '_', '`', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w',\n\t\t'x', 'y', 'z', '{', '|', '}', '~', '\\u00A0', '\\u00A1', '\\u00A2', '\\u00A3', '\\u00A4', '\\u00A5', '\\u00A6', '\\u00A7', '\\u00A8', '\\u00A9', '\\u00AA',\n\t\t'\\u00AB', '\\u00AC', '\\u00AD', '\\u00AE', '\\u00AF', '\\u00B0', '\\u00B1', '\\u00B2', '\\u00B3', '\\u00B4', '\\u00B5', '\\u00B6', '\\u00B7', '\\u00B8', '\\u00B9',\n\t\t'\\u00BA', '\\u00BB', '\\u00BC', '\\u00BD', '\\u00BE', '\\u00BF', '\\u00C0', '\\u00C1', '\\u00C2', '\\u00C3', '\\u00C4', '\\u00C5', '\\u00C6', '\\u00C7', '\\u00C8',\n\t\t'\\u00C9', '\\u00CA', '\\u00CB', '\\u00CC', '\\u00CD', '\\u00CE', '\\u00CF', '\\u00D0', '\\u00D1', '\\u00D2', '\\u00D3', '\\u00D4', '\\u00D5', '\\u00D6', '\\u00D7',\n\t\t'\\u00D8', '\\u00D9', '\\u00DA', '\\u00DB', '\\u00DC', '\\u00DD', '\\u00DE', '\\u00DF', '\\u00E0', '\\u00E1', '\\u00E2', '\\u00E3', '\\u00E4', '\\u00E5', '\\u00E6',\n\t\t'\\u00E7', '\\u00E8', '\\u00E9', '\\u00EA', '\\u00EB', '\\u00EC', '\\u00ED', '\\u00EE', '\\u00EF', '\\u00F0', '\\u00F1', '\\u00F2', '\\u00F3', '\\u00F4', '\\u00F5',\n\t\t'\\u00F6', '\\u00F7', '\\u00F8', '\\u00F9', '\\u00FA', '\\u00FB', '\\u00FC', '\\u00FD', '\\u00FE', '\\u037E', '\\u0384', '\\u0385', '\\u0386', '\\u0387', '\\u0388',\n\t\t'\\u0389', '\\u038A', '\\u038C', '\\u038E', '\\u038F', '\\u0390', '\\u0391', '\\u0392', '\\u0393', '\\u0394', '\\u0395', '\\u0396', '\\u0397', '\\u0398', '\\u0399',\n\t\t'\\u039A', '\\u039B', '\\u039C', '\\u039D', '\\u039E', '\\u039F', '\\u03A0', '\\u03A1', '\\u03A3', '\\u03A4', '\\u03A5', '\\u03A6', '\\u03A7', '\\u03A8', '\\u03A9',\n\t\t'\\u03AA', '\\u03AB', '\\u03AC', '\\u03AD', '\\u03AE', '\\u03AF', '\\u03B0', '\\u03B1', '\\u03B2', '\\u03B3', '\\u03B4', '\\u03B5', '\\u03B6', '\\u03B7', '\\u03B8',\n\t\t'\\u03B9', '\\u03BA', '\\u03BB', '\\u03BC', '\\u03BD', '\\u03BE', '\\u03BF', '\\u03C0', '\\u03C1', '\\u03C2', '\\u03C3', '\\u03C4', '\\u03C5', '\\u03C6', '\\u03C7',\n\t\t'\\u03C8', '\\u03C9', '\\u03CA', '\\u03CB', '\\u03CC', '\\u03CD', '\\u03CE', '\\u2202', '\\u2206', '\\u220F', '\\u2211', '\\u2212', '\\u2215', '\\u2219', '\\u221A',\n\t\t'\\u221E', '\\u222B', '\\u2248', '\\u2260', '\\u2264', '\\u2265'\n\t];\n\tpublic HORIZ_ADV_X =\n\t[\n\t\t720, 806, 940, 1676, 1302, 2204, 1488, 550, 930, 930, 1302, 1676, 745, 930, 745, 930, 1302, 1302, 1302, 1302, 1302, 1302, 1302, 1302, 1302, 1302,\n\t\t930, 930, 1676, 1676, 1676, 1117, 2048, 1400, 1404, 1430, 1578, 1295, 1177, 1588, 1539, 862, 931, 1419, 1140, 1726, 1532, 1612, 1235, 1612, 1424,\n\t\t1400, 1262, 1499, 1400, 2025, 1403, 1260, 1403, 930, 930, 930, 1676, 1302, 1302, 1230, 1276, 1067, 1276, 1220, 720, 1276, 1296, 562, 705, 1212, 562,\n\t\t1992, 1296, 1243, 1276, 1276, 874, 1067, 807, 1296, 1212, 1676, 1212, 1212, 1076, 1300, 930, 1300, 1676, 720, 806, 1302, 1302, 1302, 1302, 930, 1302,\n\t\t1302, 2048, 1117, 1320, 1676, 930, 2048, 1302, 1110, 1676, 1110, 1110, 1302, 1314, 1302, 745, 1302, 1110, 1117, 1320, 2048, 2048, 2048, 1117, 1400,\n\t\t1400, 1400, 1400, 1400, 1400, 2016, 1430, 1295, 1295, 1295, 1295, 862, 862, 862, 862, 1588, 1532, 1612, 1612, 1612, 1612, 1612, 1676, 1612, 1499,\n\t\t1499, 1499, 1499, 1260, 1240, 1270, 1230, 1230, 1230, 1230, 1230, 1230, 1956, 1067, 1220, 1220, 1220, 1220, 562, 562, 562, 562, 1253, 1296, 1243,\n\t\t1243, 1243, 1243, 1243, 1676, 1243, 1296, 1296, 1296, 1296, 1212, 1276, 930, 1302, 1302, 1400, 930, 1538, 1782, 1105, 1804, 1543, 1859, 562, 1400,\n\t\t1404, 1160, 1440, 1295, 1403, 1539, 1612, 862, 1419, 1404, 1726, 1532, 1329, 1612, 1539, 1235, 1377, 1262, 1260, 1677, 1403, 1783, 1676, 862, 1260,\n\t\t1276, 1050, 1296, 562, 1293, 1276, 1270, 1212, 1245, 1050, 937, 1296, 1278, 562, 1212, 1212, 1310, 1212, 1030, 1243, 1305, 1280, 1040, 1291, 1016,\n\t\t1293, 1618, 1208, 1683, 1666, 562, 1293, 1243, 1293, 1666, 1302, 1489, 1676, 1489, 1676, 740, 745, 1676, 2048, 1302, 1676, 1676, 1676, 1676\n\t];\n\tpublic GLYPH_DATA =\n\t[\n\t\t'',\n\t\t'M515 1489l-26 -1079h-170l-28 1079h224zM505 0h-204v211h204v-211z',\n\t\t'M772 1556l-43 -579h-132l-43 579h218zM386 1556l-43 -579h-132l-43 579h218z',\n\t\t'M1481 932h-333l-92 -376h308v-135h-343l-104 -421h-129l104 421h-270l-104 -421h-129l104 421h-298v135h333l92 376h-308v135h343l105 422h129l-105 -422h270l105 422h129l-105 -422h298v-135zM1022 934h-274l-94 -380h274z',\n\t\t'M1160 380q0 -155 -121 -257.5t-317 -121.5v-362h-118v357q-132 1 -248 25.5t-201 63.5v198h16q19 -14 68 -40.5t95 -43.5q52 -19 121.5 -35.5t148.5 -19.5v433q-40 8 -74 15.5t-63 15.5q-163 41 -234 123.5t-71 203.5q0 148 116.5 250t325.5 119v272h118v-270 q101 -2 207 -24t178 -51v-196h-14q-75 46 -156.5 81.5t-214.5 44.5v-431q30 -5 65 -13.5t61 -13.5q149 -32 230.5 -110t81.5 -213zM604 747v413q-107 -8 -180 -58.5t-73 -140.5q0 -91 54 -137t199 -77zM971 354q0 94 -58.5 137.5t-190.5 68.5v-414q120 12 184.5 61t64.5 147 z',\n\t\t'M884 1076q0 -224 -94.5 -333t-272.5 -109q-182 0 -275 109t-93 332q0 224 95 333t273 109q181 0 274 -110t93 -331zM1575 1489l-780 -1489h-165l780 1489h165zM2055 413q0 -224 -95 -333t-273 -109q-181 0 -274 110t-93 331q0 224 94.5 333t272.5 109q182 0 275 -109 t93 -332zM706 1076q0 172 -44.5 240t-144.5 68q-102 0 -146 -68t-44 -241t44 -240.5t146 -67.5q100 0 144.5 67.5t44.5 241.5zM1877 413q0 172 -44.5 240t-144.5 68q-102 0 -146 -68t-44 -241t44 -240.5t146 -67.5q100 0 144.5 67.5t44.5 241.5z',\n\t\t'M792 1191q0 95 -56.5 149.5t-144.5 54.5q-92 0 -150 -61.5t-58 -150.5q0 -75 39.5 -133t170.5 -137q98 35 148.5 102.5t50.5 175.5zM986 315l-478 466q-31 -15 -62 -39.5t-62 -66.5q-28 -39 -46 -94t-18 -124q0 -146 85.5 -235.5t242.5 -89.5q93 0 184.5 45.5 t153.5 137.5zM1287 909v-96q0 -96 -25 -216t-85 -229l378 -368h-246l-229 224q-115 -142 -235 -198.5t-247 -56.5q-208 0 -345.5 121.5t-137.5 318.5q0 92 26 159t61 116q35 47 87 88.5t105 72.5q-110 72 -158.5 145t-48.5 184q0 67 26.5 127.5t79.5 110.5q50 48 130.5 78 t177.5 30q173 0 280 -87.5t107 -221.5q0 -44 -12 -99.5t-41 -99.5q-32 -49 -91 -94t-153 -77l371 -362q14 40 21 88t8 100q2 56 1.5 125t-0.5 117h195z',\n\t\t'M386 1556l-43 -579h-136l-43 579h222z',\n\t\t'M783 -412h-229q-177 203 -275 443t-98 541t98 541t275 443h229v-10q-81 -73 -154.5 -168.5t-136.5 -222.5q-60 -123 -97.5 -271t-37.5 -312q0 -171 36.5 -313t98.5 -270q60 -123 137 -222.5t154 -168.5v-10z',\n\t\t'M749 572q0 -301 -98 -541t-275 -443h-229v10q77 69 154.5 168.5t136.5 222.5q62 128 98.5 270t36.5 313q0 164 -37 312t-98 271q-63 127 -136.5 222.5t-154.5 168.5v10h229q177 -203 275 -443t98 -541z',\n\t\t'M1137 887l-64 -110l-362 213l6 -360h-129l5 360l-361 -214l-65 110l381 207l-381 207l65 110l362 -213l-6 359h129l-7 -359l363 212l64 -110l-380 -205z',\n\t\t'M1466 572h-545v-545h-166v545h-545v160h545v545h166v-545h545v-160z',\n\t\t'M575 285l-282 -655h-146l174 655h254z',\n\t\t'M777 561h-624v181h624v-181z',\n\t\t'M492 0h-239v285h239v-285z',\n\t\t'M860 1556l-717 -1860h-173l714 1860h176z',\n\t\t'M1167 745q0 -401 -125.5 -588.5t-389.5 -187.5q-268 0 -391.5 190t-123.5 584q0 397 125 586.5t390 189.5q268 0 391.5 -192.5t123.5 -581.5zM904 291q35 81 47.5 190.5t12.5 263.5q0 152 -12.5 264t-48.5 190q-35 77 -95.5 116t-155.5 39q-94 0 -155.5 -39t-97.5 -118 q-34 -74 -46.5 -193t-12.5 -261q0 -156 11 -261t47 -188q33 -78 93.5 -119t160.5 -41q94 0 156 39t96 118z',\n\t\t'M1084 0h-806v152h310v998h-310v136q63 0 135 10.5t109 30.5q46 25 72.5 63.5t30.5 103.5h155v-1342h304v-152z',\n\t\t'M1169 0h-1008v209q105 90 210.5 180t196.5 179q192 186 263 295.5t71 236.5q0 116 -76.5 181.5t-213.5 65.5q-91 0 -197 -32t-207 -98h-10v210q71 35 189.5 64t229.5 29q229 0 359 -110.5t130 -299.5q0 -85 -21.5 -158.5t-63.5 -139.5q-39 -62 -91.5 -122t-127.5 -133 q-107 -105 -221 -203.5t-213 -182.5h801v-171z',\n\t\t'M1038 717q48 -43 79 -108t31 -168q0 -102 -37 -187t-104 -148q-75 -70 -176.5 -103.5t-222.5 -33.5q-124 0 -244 29.5t-197 64.5v209h15q85 -56 200 -93t222 -37q63 0 134 21t115 62q46 44 68.5 97t22.5 134q0 80 -25.5 132.5t-70.5 82.5q-45 31 -109 42.5t-138 11.5h-90 v166h70q152 0 242.5 63.5t90.5 185.5q0 54 -23 94.5t-64 66.5q-43 26 -92 36t-111 10q-95 0 -202 -34t-202 -96h-10v209q71 35 189.5 64.5t229.5 29.5q109 0 192 -20t150 -64q72 -48 109 -116t37 -159q0 -124 -87.5 -216.5t-206.5 -116.5v-14q48 -8 110 -33.5t105 -63.5z ',\n\t\t'M1203 419h-221v-419h-192v419h-713v230l721 840h184v-910h221v-160zM790 579v672l-577 -672h577z',\n\t\t'M1157 473q0 -104 -38 -199t-104 -160q-72 -70 -171.5 -107.5t-230.5 -37.5q-122 0 -235 25.5t-191 61.5v211h14q82 -52 192 -88.5t216 -36.5q71 0 137.5 20t118.5 70q44 43 66.5 103t22.5 139q0 77 -26.5 130t-73.5 85q-52 38 -126.5 53.5t-166.5 15.5q-88 0 -169.5 -12 t-140.5 -24v767h896v-175h-703v-396q43 4 88 6t78 2q121 0 212 -20.5t167 -72.5q80 -55 124 -142t44 -218z',\n\t\t'M1191 483q0 -227 -149.5 -370.5t-366.5 -143.5q-110 0 -200 34t-159 101q-86 83 -132.5 220t-46.5 330q0 198 42.5 351t135.5 272q88 113 227 176.5t324 63.5q59 0 99 -5t81 -18v-191h-10q-28 15 -84.5 28.5t-115.5 13.5q-215 0 -343 -134.5t-149 -363.5 q84 51 165.5 77.5t188.5 26.5q95 0 167.5 -17.5t148.5 -70.5q88 -61 132.5 -154t44.5 -226zM988 475q0 93 -27.5 154t-90.5 106q-46 32 -102 42t-117 10q-85 0 -158 -20t-150 -62q-2 -22 -3 -42.5t-1 -51.5q0 -158 32.5 -249.5t89.5 -144.5q46 -44 99.5 -64.5t116.5 -20.5 q145 0 228 88.5t83 254.5z',\n\t\t'M1173 1266l-674 -1266h-214l717 1314h-848v175h1019v-223z',\n\t\t'M1180 415q0 -193 -150.5 -321t-378.5 -128q-242 0 -385.5 125t-143.5 320q0 124 72 224.5t203 159.5v6q-120 64 -177.5 140t-57.5 190q0 168 138 280t351 112q223 0 356 -107t133 -272q0 -101 -63 -198.5t-185 -152.5v-6q140 -60 214 -148t74 -224zM943 1142 q0 107 -82.5 170.5t-210.5 63.5q-126 0 -206.5 -60t-80.5 -162q0 -72 40.5 -124.5t122.5 -93.5q37 -18 106.5 -47t135.5 -48q99 66 137 137t38 164zM974 396q0 92 -40.5 147.5t-158.5 111.5q-47 22 -103 41t-149 53q-90 -49 -144.5 -133t-54.5 -190q0 -135 93 -223t236 -88 q146 0 233.5 75t87.5 206z',\n\t\t'M1167 834q0 -195 -44.5 -354t-134.5 -271q-91 -114 -228 -176t-322 -62q-52 0 -98 5.5t-82 17.5v191h10q29 -15 82 -28.5t118 -13.5q221 0 346.5 132.5t145.5 365.5q-93 -56 -175 -80t-179 -24q-92 0 -166.5 18t-149.5 70q-88 61 -132.5 155t-44.5 225q0 228 150 371 t366 143q108 0 200 -33.5t161 -100.5q85 -83 131 -213.5t46 -337.5zM965 877q0 155 -32 249t-88 146q-47 45 -101 64.5t-117 19.5q-144 0 -227.5 -90t-83.5 -253q0 -95 27 -155t91 -105q45 -31 99 -41.5t120 -10.5q78 0 158 21t150 61q1 21 2.5 41.5t1.5 52.5z',\n\t\t'M585 832h-239v285h239v-285zM585 0h-239v285h239v-285z',\n\t\t'M585 832h-239v285h239v-285zM658 285l-282 -655h-146l174 655h254z',\n\t\t'M1408 77l-1154 513v124l1154 513v-180l-910 -395l910 -395v-180z',\n\t\t'M1431 782h-1186v160h1186v-160zM1431 362h-1186v160h1186v-160z',\n\t\t'M1422 590l-1154 -513v180l910 395l-910 395v180l1154 -513v-124z',\n\t\t'M1005 1139q0 -98 -35 -174.5t-92 -135.5q-56 -57 -129 -107t-155 -97v-225h-179v305q65 37 140.5 81t123.5 89q58 52 90 107.5t32 141.5q0 113 -76.5 168.5t-197.5 55.5q-108 0 -204.5 -34t-152.5 -69h-10v204q70 27 177.5 48.5t203.5 21.5q215 0 339.5 -104.5 t124.5 -275.5zM610 0h-204v211h204v-211z',\n\t\t'M1870 663q0 -139 -40.5 -269t-115.5 -237h-440l-27 116q-74 -60 -142 -92t-156 -32q-168 0 -268.5 127t-100.5 355q0 227 123 362t294 135q73 0 129 -16.5t121 -49.5v48h159v-842h243q42 75 63.5 187.5t21.5 201.5q0 164 -45.5 298t-133.5 230t-218 147.5t-295 51.5 q-160 0 -292.5 -58t-227.5 -156q-96 -98 -150.5 -234.5t-54.5 -290.5q0 -165 52 -301.5t147 -233.5q99 -101 232 -152.5t290 -51.5q86 0 177.5 11t175.5 35v-142q-97 -21 -181 -28.5t-173 -7.5q-186 0 -345 63.5t-273 177.5q-115 115 -179 276t-64 356q0 185 67 344.5 t183 276.5t275 184t340 67q196 0 350 -62t260 -174t162.5 -269.5t56.5 -350.5zM1245 408v518q-63 29 -113 41.5t-107 12.5q-129 0 -202 -90t-73 -256q0 -163 58 -246.5t181 -83.5q67 0 134 31t122 73z',\n\t\t'M1374 0h-211l-146 415h-644l-146 -415h-201l542 1489h264zM956 585l-261 731l-262 -731h523z',\n\t\t'M1323 458q0 -111 -42 -196t-113 -140q-84 -66 -184.5 -94t-255.5 -28h-528v1489h441q163 0 244 -12t155 -50q82 -43 119 -110.5t37 -161.5q0 -106 -54 -180.5t-144 -119.5v-8q151 -31 238 -132.5t87 -256.5zM990 1129q0 54 -18 91t-58 60q-47 27 -114 33.5t-166 6.5h-236 v-430h256q93 0 148 9.5t102 39.5t66.5 77.5t19.5 112.5zM1117 450q0 90 -27 143t-98 90q-48 25 -116.5 32.5t-166.5 7.5h-311v-554h262q130 0 213 13.5t136 49.5q56 39 82 89t26 129z',\n\t\t'M1350 108q-55 -24 -99.5 -45t-116.5 -44q-61 -19 -132.5 -32.5t-157.5 -13.5q-162 0 -294.5 45.5t-230.5 142.5q-96 95 -150 241.5t-54 340.5q0 184 52 329t150 245q95 97 229.5 148t298.5 51q120 0 239.5 -29t265.5 -102v-235h-15q-123 103 -244 150t-259 47 q-113 0 -203.5 -36.5t-161.5 -113.5q-69 -75 -107.5 -189.5t-38.5 -264.5q0 -157 42.5 -270t109.5 -184q70 -74 163.5 -109.5t197.5 -35.5q143 0 268 49t234 147h14v-232z',\n\t\t'M1458 743q0 -203 -88.5 -368t-235.5 -256q-102 -63 -227.5 -91t-330.5 -28h-376v1489h372q218 0 346.5 -31.5t217.5 -86.5q152 -95 237 -253t85 -375zM1251 746q0 175 -61 295t-182 189q-88 50 -187 69.5t-237 19.5h-186v-1149h186q143 0 249.5 21t195.5 78 q111 71 166.5 187t55.5 290z',\n\t\t'M1181 0h-981v1489h981v-176h-783v-408h783v-176h-783v-553h783v-176z',\n\t\t'M1151 1313h-753v-420h647v-176h-647v-717h-198v1489h951v-176z',\n\t\t'M1442 110q-122 -56 -266.5 -97.5t-279.5 -41.5q-174 0 -319 48t-247 144q-103 97 -159 242.5t-56 340.5q0 357 208.5 563.5t572.5 206.5q127 0 259.5 -30.5t285.5 -103.5v-235h-18q-31 24 -90 63t-116 65q-69 31 -156.5 51.5t-198.5 20.5q-250 0 -395.5 -160.5 t-145.5 -434.5q0 -289 152 -449.5t414 -160.5q96 0 191.5 19t167.5 49v365h-399v174h595v-639z',\n\t\t'M1339 0h-198v729h-743v-729h-198v1489h198v-584h743v584h198v-1489z',\n\t\t'M725 0h-588v152h195v1185h-195v152h588v-152h-195v-1185h195v-152z',\n\t\t'M746 387q0 -196 -119.5 -302t-320.5 -106q-48 0 -128 8.5t-134 20.5v185h11q41 -14 101 -29t123 -15q92 0 146.5 21t80.5 60q27 40 34.5 98t7.5 134v869h-315v158h513v-1102z',\n\t\t'M1397 0h-257l-589 663l-148 -158v-505h-198v1489h198v-777l723 777h240l-665 -700z',\n\t\t'M1142 0h-942v1489h198v-1313h744v-176z',\n\t\t'M1526 0h-198v1283l-414 -873h-118l-411 873v-1283h-185v1489h270l397 -829l384 829h275v-1489z',\n\t\t'M1336 0h-245l-706 1332v-1332h-185v1489h307l644 -1216v1216h185v-1489z',\n\t\t'M1310 1318q91 -100 139.5 -245t48.5 -329t-49.5 -329.5t-138.5 -242.5q-92 -101 -217.5 -152t-286.5 -51q-157 0 -285.5 52t-218.5 151t-138.5 243t-48.5 329q0 182 48 326.5t140 247.5q88 98 218.5 150t284.5 52q160 0 287.5 -52.5t216.5 -149.5zM1292 744 q0 290 -130 447.5t-355 157.5q-227 0 -356.5 -157.5t-129.5 -447.5q0 -293 132 -448.5t354 -155.5t353.5 155.5t131.5 448.5z',\n\t\t'M1174 1039q0 -99 -34.5 -183.5t-96.5 -146.5q-77 -77 -182 -115.5t-265 -38.5h-198v-555h-198v1489h404q134 0 227 -22.5t165 -70.5q85 -57 131.5 -142t46.5 -215zM968 1034q0 77 -27 134t-82 93q-48 31 -109.5 44.5t-155.5 13.5h-196v-595h167q120 0 195 21.5t122 68.5 q47 48 66.5 101t19.5 119z',\n\t\t'M1528 -365q-60 -15 -118.5 -21.5t-119.5 -6.5q-174 0 -279.5 95.5t-114.5 273.5q-24 -4 -46.5 -5.5t-43.5 -1.5q-157 0 -285.5 52t-218.5 151t-138.5 243t-48.5 329q0 182 48 326.5t140 247.5q88 98 218.5 150t284.5 52q160 0 287.5 -52.5t216.5 -149.5 q91 -100 139.5 -245t48.5 -329q0 -273 -111.5 -460t-299.5 -262q4 -114 54 -177t182 -63q41 0 97.5 12.5t80.5 22.5h27v-182zM1292 744q0 290 -130 447.5t-355 157.5q-227 0 -356.5 -157.5t-129.5 -447.5q0 -293 132 -448.5t354 -155.5t353.5 155.5t131.5 448.5z',\n\t\t'M1432 0h-257l-498 592h-279v-592h-198v1489h417q135 0 225 -17.5t162 -62.5q81 -51 126.5 -128.5t45.5 -196.5q0 -161 -81 -269.5t-223 -163.5zM969 1070q0 64 -22.5 113.5t-74.5 83.5q-43 29 -102 40.5t-139 11.5h-233v-562h200q94 0 164 16.5t119 61.5q45 42 66.5 96.5 t21.5 138.5z',\n\t\t'M1282 425q0 -87 -40.5 -172t-113.5 -144q-80 -64 -186.5 -100t-256.5 -36q-161 0 -289.5 30t-261.5 89v248h14q113 -94 261 -145t278 -51q184 0 286.5 69t102.5 184q0 99 -48.5 146t-147.5 73q-75 20 -162.5 33t-185.5 33q-198 42 -293.5 143.5t-95.5 264.5 q0 187 158 306.5t401 119.5q157 0 288 -30t232 -74v-234h-14q-85 72 -223.5 119.5t-283.5 47.5q-159 0 -255.5 -66t-96.5 -170q0 -93 48 -146t169 -81q64 -14 182 -34t200 -41q166 -44 250 -133t84 -249z',\n\t\t'M1262 1313h-532v-1313h-198v1313h-532v176h1262v-176z',\n\t\t'M1321 598q0 -162 -35.5 -282.5t-116.5 -200.5q-77 -76 -180 -111t-240 -35q-140 0 -244 37t-175 109q-81 82 -116.5 198t-35.5 285v891h198v-901q0 -121 16.5 -191t55.5 -127q44 -65 119.5 -98t181.5 -33q107 0 182 32.5t120 98.5q39 57 55.5 130.5t16.5 182.5v906h198 v-891z',\n\t\t'M1374 1489l-542 -1489h-264l-542 1489h212l467 -1310l467 1310h202z',\n\t\t'M1933 1489l-387 -1489h-223l-313 1236l-306 -1236h-218l-394 1489h203l313 -1238l308 1238h201l311 -1250l311 1250h194z',\n\t\t'M1336 1489l-514 -736l513 -753h-229l-406 613l-416 -613h-216l519 744l-507 745h228l401 -605l410 605h217z',\n\t\t'M1254 1489l-524 -836v-653h-198v632l-526 857h219l407 -666l411 666h211z',\n\t\t'M1288 0h-1162v184l913 1129h-879v176h1106v-179l-922 -1134h944v-176z',\n\t\t'M759 -392h-520v1948h520v-143h-346v-1662h346v-143z',\n\t\t'M960 -304h-173l-717 1860h176z',\n\t\t'M691 -392h-520v143h346v1662h-346v143h520v-1948z',\n\t\t'M1490 684h-198l-455 627l-454 -629h-197l589 807h126z',\n\t\t'M1306 -300h-1310v120h1310v-120z',\n\t\t'M762 1302h-149l-273 374h243z',\n\t\t'M1053 0h-187v119q-25 -17 -67.5 -47.5t-82.5 -48.5q-47 -23 -108 -38.5t-143 -15.5q-151 0 -256 100t-105 255q0 127 54.5 205.5t155.5 123.5q102 45 245 61t307 24v29q0 64 -22.5 106t-64.5 66q-40 23 -96 31t-117 8q-74 0 -165 -19.5t-188 -56.5h-10v191q55 15 159 33 t205 18q118 0 205.5 -19.5t151.5 -66.5q63 -46 96 -119t33 -181v-758zM866 275v311q-86 -5 -202.5 -15t-184.5 -29q-81 -23 -131 -71.5t-50 -133.5q0 -96 58 -144.5t177 -48.5q99 0 181 38.5t152 92.5z',\n\t\t'M1168 567q0 -140 -39.5 -252t-106.5 -188q-71 -79 -156 -118.5t-187 -39.5q-95 0 -166 22.5t-140 60.5l-12 -52h-176v1556h188v-556q79 65 168 106.5t200 41.5q198 0 312.5 -152t114.5 -429zM974 562q0 200 -66 303.5t-213 103.5q-82 0 -166 -35.5t-156 -91.5v-640 q80 -36 137.5 -50t130.5 -14q156 0 244.5 102.5t88.5 321.5z',\n\t\t'M1011 70q-94 -45 -178.5 -70t-179.5 -25q-121 0 -222 35.5t-173 107.5q-73 72 -113 182t-40 257q0 274 150.5 430t397.5 156q96 0 188.5 -27t169.5 -66v-209h-10q-86 67 -177.5 103t-178.5 36q-160 0 -252.5 -107.5t-92.5 -315.5q0 -202 90.5 -310.5t254.5 -108.5 q57 0 116 15t106 39q41 21 77 44.5t57 40.5h10v-207z',\n\t\t'M1091 0h-188v117q-81 -70 -169 -109t-191 -39q-200 0 -317.5 154t-117.5 427q0 142 40.5 253t109.5 189q68 76 158.5 116t187.5 40q88 0 156 -18.5t143 -57.5v484h188v-1556zM903 275v641q-76 34 -136 47t-131 13q-158 0 -246 -110t-88 -312q0 -199 68 -302.5t218 -103.5 q80 0 162 35.5t153 91.5z',\n\t\t'M1120 539h-823q0 -103 31 -179.5t85 -125.5q52 -48 123.5 -72t157.5 -24q114 0 229.5 45.5t164.5 89.5h10v-205q-95 -40 -194 -67t-208 -27q-278 0 -434 150.5t-156 427.5q0 274 149.5 435t393.5 161q226 0 348.5 -132t122.5 -375v-102zM937 683q-1 148 -74.5 229 t-223.5 81q-151 0 -240.5 -89t-101.5 -221h640z',\n\t\t'M786 1374h-10q-31 9 -81 18.5t-88 9.5q-121 0 -175.5 -53.5t-54.5 -193.5v-38h339v-158h-333v-959h-188v959h-127v158h127v37q0 199 99 305.5t286 106.5q63 0 113.5 -6t92.5 -14v-172z',\n\t\t'M1091 127q0 -284 -129 -417t-397 -133q-89 0 -173.5 12.5t-166.5 35.5v192h10q46 -18 146 -44.5t200 -26.5q96 0 159 23t98 64q35 39 50 94t15 123v102q-85 -68 -162.5 -101.5t-197.5 -33.5q-200 0 -317.5 144.5t-117.5 407.5q0 144 40.5 248.5t110.5 180.5 q65 71 158 110.5t185 39.5q97 0 162.5 -19.5t138.5 -59.5l12 48h176v-990zM903 307v609q-75 34 -139.5 48.5t-128.5 14.5q-155 0 -244 -104t-89 -302q0 -188 66 -285t219 -97q82 0 164.5 31.5t151.5 84.5z',\n\t\t'M1119 0h-188v636q0 77 -9 144.5t-33 105.5q-25 42 -72 62.5t-122 20.5q-77 0 -161 -38t-161 -97v-834h-188v1556h188v-563q88 73 182 114t193 41q181 0 276 -109t95 -314v-725z',\n\t\t'M387 1304h-212v195h212v-195zM375 0h-188v1117h188v-1117z',\n\t\t'M533 1304h-212v195h212v-195zM521 -27q0 -196 -100 -296t-268 -100q-40 0 -105.5 8t-109.5 20v179h10q28 -11 75.5 -25t92.5 -14q72 0 116 20t66 60t28.5 96.5t6.5 137.5v900h-233v158h421v-1144z',\n\t\t'M1199 0h-248l-448 489l-122 -116v-373h-188v1556h188v-998l543 559h237l-519 -516z',\n\t\t'M375 0h-188v1556h188v-1556z',\n\t\t'M1815 0h-188v636q0 72 -6.5 139t-27.5 107q-23 43 -66 65t-124 22q-79 0 -158 -39.5t-158 -100.5q3 -23 5 -53.5t2 -60.5v-715h-188v636q0 74 -6.5 140.5t-27.5 106.5q-23 43 -66 64.5t-124 21.5q-77 0 -154.5 -38t-154.5 -97v-834h-188v1117h188v-124q88 73 175.5 114 t186.5 41q114 0 193.5 -48t118.5 -133q114 96 208 138.5t201 42.5q184 0 271.5 -111.5t87.5 -311.5v-725z',\n\t\t'M1119 0h-188v636q0 77 -9 144.5t-33 105.5q-25 42 -72 62.5t-122 20.5q-77 0 -161 -38t-161 -97v-834h-188v1117h188v-124q88 73 182 114t193 41q181 0 276 -109t95 -314v-725z',\n\t\t'M1137 558q0 -273 -140 -431t-375 -158q-237 0 -376.5 158t-139.5 431t139.5 431.5t376.5 158.5q235 0 375 -158.5t140 -431.5zM943 558q0 217 -85 322.5t-236 105.5q-153 0 -237.5 -105.5t-84.5 -322.5q0 -210 85 -318.5t237 -108.5q150 0 235.5 107.5t85.5 319.5z',\n\t\t'M1168 572q0 -136 -39 -248.5t-110 -190.5q-66 -74 -155.5 -114.5t-189.5 -40.5q-87 0 -157.5 19t-143.5 59v-468h-188v1529h188v-117q75 63 168.5 105.5t199.5 42.5q202 0 314.5 -152.5t112.5 -423.5zM974 567q0 202 -69 302t-212 100q-81 0 -163 -35t-157 -92v-633 q80 -36 137.5 -49t130.5 -13q157 0 245 106t88 314z',\n\t\t'M1091 -412h-188v538q-87 -75 -173 -111.5t-186 -36.5q-199 0 -317.5 153.5t-118.5 423.5q0 144 41.5 254.5t109.5 185.5q66 73 155 113t188 40q90 0 159.5 -20t141.5 -59l12 48h176v-1529zM903 284v632q-78 35 -138 49t-130 14q-163 0 -248 -110.5t-85 -304.5 q0 -196 68.5 -301.5t215.5 -105.5q82 0 164 35.5t153 91.5z',\n\t\t'M882 912h-10q-42 10 -81.5 14.5t-93.5 4.5q-87 0 -168 -38.5t-156 -99.5v-793h-188v1117h188v-165q112 90 197.5 127.5t174.5 37.5q49 0 71 -2.5t66 -9.5v-193z',\n\t\t'M983 322q0 -153 -126.5 -251t-345.5 -98q-124 0 -227.5 29.5t-173.5 64.5v211h10q89 -67 198 -106.5t209 -39.5q124 0 194 40t70 126q0 66 -38 100t-146 58q-40 9 -104.5 21t-117.5 26q-147 39 -208.5 114.5t-61.5 185.5q0 69 28.5 130t86.5 109q56 47 142.5 74.5 t193.5 27.5q100 0 202.5 -24.5t170.5 -59.5v-201h-10q-72 53 -175 89.5t-202 36.5q-103 0 -174 -39.5t-71 -117.5q0 -69 43 -104q42 -35 136 -57q52 -12 116.5 -24t107.5 -22q131 -30 202 -103q71 -74 71 -196z',\n\t\t'M765 10q-53 -14 -115.5 -23t-111.5 -9q-171 0 -260 92t-89 295v594h-127v158h127v321h188v-321h388v-158h-388v-509q0 -88 4 -137.5t28 -92.5q22 -40 60.5 -58.5t117.5 -18.5q46 0 96 13.5t72 22.5h10v-169z',\n\t\t'M1111 0h-188v124q-95 -75 -182 -115t-192 -40q-176 0 -274 107.5t-98 315.5v725h188v-636q0 -85 8 -145.5t34 -103.5q27 -44 70 -64t125 -20q73 0 159.5 38t161.5 97v834h188v-1117z',\n\t\t'M1151 1117l-452 -1117h-189l-449 1117h204l346 -889l343 889h197z',\n\t\t'M1590 1117l-291 -1117h-174l-287 861l-285 -861h-173l-294 1117h196l205 -865l279 865h155l286 -865l194 865h189z',\n\t\t'M1152 0h-237l-317 429l-319 -429h-219l436 557l-432 560h237l315 -422l316 422h220l-439 -550z',\n\t\t'M1151 1117l-652 -1529h-201l208 466l-445 1063h204l343 -828l346 828h197z',\n\t\t'M995 0h-902v139l651 821h-637v157h871v-134l-654 -824h671v-159z',\n\t\t'M1113 -392h-150q-179 0 -290.5 99.5t-111.5 287.5v149q0 169 -83 264.5t-254 95.5h-51v156h51q171 0 254 95.5t83 264.5v149q0 188 111.5 287.5t290.5 99.5h150v-138h-114q-136 0 -197.5 -63t-61.5 -203v-175q0 -139 -77 -233.5t-214 -149.5v-24q137 -55 214 -149.5 t77 -233.5v-175q0 -140 61.5 -203t197.5 -63h114v-138z',\n\t\t'M552 -392h-174v1948h174v-1948z',\n\t\t'M1127 504h-51q-171 0 -254 -95.5t-83 -264.5v-149q0 -188 -111.5 -287.5t-290.5 -99.5h-150v138h114q136 0 197.5 63t61.5 203v175q0 139 77 233.5t214 149.5v24q-137 55 -214 149.5t-77 233.5v175q0 140 -61.5 203t-197.5 63h-114v138h150q179 0 290.5 -99.5 t111.5 -287.5v-149q0 -169 83 -264.5t254 -95.5h51v-156z',\n\t\t'M1489 927q-2 -99 -22.5 -195t-65.5 -171q-46 -77 -111 -121t-165 -44q-94 0 -167 39.5t-157 141.5q-102 125 -148 157t-96 32q-94 0 -144 -87.5t-59 -283.5h-167q2 100 22.5 194.5t64.5 171.5q43 74 112 119.5t165 45.5q93 0 166.5 -38.5t158.5 -142.5q80 -98 131 -143.5 t112 -45.5q103 0 151.5 101t51.5 270h167z',\n\t\t'',\n\t\t'M505 1278h-204v211h204v-211zM515 0h-224l26 1079h170z',\n\t\t'M1120 74q-71 -30 -161 -53.5t-194 -26.5v-355h-118v359q-227 21 -357.5 165t-130.5 394q0 242 133.5 391.5t354.5 171.5v355h118v-351q104 -3 197 -25t158 -53v-203h-11q-55 44 -142 85t-202 50v-839q120 10 206.5 52.5t137.5 83.5h11v-201zM647 142v834 q-135 -20 -216 -125t-81 -294q0 -181 76 -286t221 -129z',\n\t\t'M1163 0h-1026v207q118 32 169.5 126.5t51.5 279.5h-176v138h176v310q0 200 126.5 328.5t331.5 128.5q105 0 181 -17t140 -34v-206h-10q-62 42 -138 66t-162 24q-140 0 -209.5 -82.5t-69.5 -226.5v-291h415v-138h-415v-61q0 -126 -62 -219.5t-160 -150.5v-11h837v-171z ',\n\t\t'M1168 257l-110 -110l-236 234q-44 -26 -81 -37t-89 -11q-46 0 -89.5 12.5t-79.5 35.5l-236 -236l-109 113l233 234q-23 37 -35 81.5t-12 87.5q0 52 11 88.5t37 79.5l-234 237l111 110l235 -235q36 23 79.5 35.5t88.5 12.5q44 0 88 -12t81 -35l234 234l113 -109l-235 -237 q24 -38 36 -79.5t12 -89.5q0 -45 -12.5 -89t-35.5 -80zM832 661q0 73 -52.5 129t-127.5 56q-73 0 -126.5 -55t-53.5 -130q0 -74 52.5 -129.5t127.5 -55.5q73 0 126.5 54.5t53.5 130.5z',\n\t\t'M1191 1489l-448 -831v-94h372v-138h-370v-426h-188v426h-370v138h372v73l-451 852h212l332 -659l336 659h203z',\n\t\t'M552 758h-174v798h174v-798zM552 -392h-174v798h174v-798z',\n\t\t'M1128 601q0 -106 -59 -187t-158 -136v-7q97 -46 141 -118.5t44 -162.5q0 -77 -33 -146t-98 -119q-72 -56 -169 -83t-221 -27q-87 0 -170.5 13.5t-175.5 44.5v194h10q79 -37 169 -62t198 -25q134 0 215 48.5t81 135.5q0 56 -19.5 88.5t-64.5 57.5q-41 23 -113 41.5 t-154 38.5q-214 52 -296 133q-83 81 -83 210q0 98 57 182.5t159 141.5v7q-101 48 -143 121t-42 162q0 81 32 146.5t99 117.5q64 50 163.5 79t227.5 29q87 0 171 -14t175 -43v-194h-10q-58 27 -152.5 57t-215.5 30q-127 0 -211.5 -46t-84.5 -133q0 -57 21.5 -92.5t64.5 -58.5 t109 -41.5t157 -39.5q200 -46 290 -125q89 -79 89 -218zM881 399q28 33 43 65.5t15 90.5q0 51 -16.5 86t-45.5 58q-28 24 -67 39.5t-83 27.5q-39 11 -85.5 21.5t-116.5 30.5q-18 -9 -49 -31.5t-53 -46.5q-24 -26 -43 -69t-19 -92q0 -50 15.5 -85t44.5 -59q27 -23 67.5 -39 t84.5 -27q38 -10 86 -22t115 -31q20 11 53 34.5t54 48.5z',\n\t\t'M958 1304h-199v195h199v-195zM545 1304h-199v195h199v-195z',\n\t\t'M1889 655q0 -358 -253.5 -611.5t-611.5 -253.5t-611.5 253.5t-253.5 611.5t253.5 611.5t611.5 253.5t611.5 -253.5t253.5 -611.5zM1773 655q0 310 -219.5 532t-529.5 222t-529.5 -222t-219.5 -532t219.5 -532t529.5 -222t529.5 222t219.5 532zM1375 258 q-86 -39 -165.5 -58.5t-157.5 -19.5q-227 0 -359 123t-132 357q0 225 134.5 354t356.5 129q89 0 175 -24t148 -52v-181h-16q-54 40 -138.5 75t-173.5 35q-142 0 -221.5 -85.5t-79.5 -250.5q0 -159 76.5 -246t224.5 -87q83 0 161.5 29t150.5 81h16v-179z',\n\t\t'M944 554h-170v94q-28 -20 -52.5 -38.5t-68.5 -37.5q-45 -20 -85.5 -30.5t-113.5 -10.5q-128 0 -215.5 85t-87.5 217q0 106 46.5 173.5t123.5 103.5q78 36 197.5 51.5t255.5 21.5v18q0 53 -18 85t-51 51q-34 18 -77.5 23t-91.5 5q-84 0 -168 -24t-123 -38h-14v172 q45 13 137 29t169 16q217 0 312 -84.5t95 -243.5v-638zM774 796v245q-69 -4 -160.5 -12t-145.5 -23q-64 -18 -103 -56.5t-39 -106.5q0 -76 45.5 -114t139.5 -38q82 0 147.5 33.5t115.5 71.5z',\n\t\t'M1146 191l-528 419v85l528 418v-188l-357 -273l357 -273v-188zM716 162l-550 446v89l550 445v-196l-371 -294l371 -294v-196z',\n\t\t'M1456 57h-171v545h-1075v160h1246v-705z',\n\t\t'M777 561h-624v181h624v-181z',\n\t\t'M1889 655q0 -358 -253.5 -611.5t-611.5 -253.5t-611.5 253.5t-253.5 611.5t253.5 611.5t611.5 253.5t611.5 -253.5t253.5 -611.5zM1773 655q0 310 -219.5 532t-529.5 222t-529.5 -222t-219.5 -532t219.5 -532t529.5 -222t529.5 222t219.5 532zM1581 215h-223l-331 355 h-162v-355h-165v915h312q94 0 155 -8t120 -39q63 -34 92.5 -82.5t29.5 -121.5q0 -97 -56.5 -161.5t-155.5 -102.5zM1229 868q0 36 -14 64t-47 46q-31 17 -66 22t-88 5h-149v-309h127q62 0 107 9.5t74 32.5q31 25 43.5 55t12.5 75z',\n\t\t'M1306 1668h-1305l-5 120h1310v-120z',\n\t\t'M956 1116q0 -168 -116 -284t-285 -116t-285 115.5t-116 284.5q0 168 116 284t285 116q170 0 285.5 -116t115.5 -284zM791 1116q0 102 -67 171.5t-169 69.5t-169 -69.5t-67 -171.5q0 -104 68.5 -172.5t167.5 -68.5q102 0 169 70t67 171z',\n\t\t'M1461 179h-1246v158h540v422h-540v158h540v545h166v-545h540v-158h-540v-422h540v-158z',\n\t\t'M967 566h-760v156q100 62 183.5 117t134.5 96q131 103 168 154.5t37 135.5q0 69 -53.5 107t-143.5 38q-89 0 -175 -30.5t-134 -61.5h-13v180q71 26 158.5 43.5t174.5 17.5q180 0 273.5 -78.5t93.5 -203.5q0 -99 -48.5 -174.5t-163.5 -165.5q-55 -43 -132.5 -94 t-143.5 -92h544v-145z',\n\t\t'M956 817q0 -75 -33 -131.5t-89 -90.5q-57 -35 -131 -51.5t-163 -16.5q-94 0 -176.5 15t-156.5 43v179h14q41 -36 138.5 -65.5t190.5 -29.5q100 0 166.5 35.5t66.5 110.5q0 85 -59 115t-171 30h-143v141h128q112 0 165.5 38.5t53.5 106.5q0 61 -49.5 96.5t-153.5 35.5 q-77 0 -174.5 -31t-141.5 -67h-14v178q74 27 160.5 44.5t176.5 17.5q175 0 271.5 -68t96.5 -174q0 -89 -55 -146t-144 -83v-8q95 -17 160.5 -72.5t65.5 -151.5z',\n\t\t'M963 1676l-273 -374h-149l179 374h243z',\n\t\t'M1124 0h-178l-10 118q-59 -65 -123.5 -102t-155.5 -37q-86 0 -149.5 35t-129.5 99v-525h-188v1529h188v-838q32 -39 109.5 -80t168.5 -41q93 0 159.5 33.5t120.5 93.5v832h188v-1117z',\n\t\t'M1106 -363h-148v1722h-214v-1722h-149v956q-206 5 -332 129t-126 328q0 207 130 323t373 116h466v-1852z',\n\t\t'M492 511h-239v283h239v-283z',\n\t\t'M880 -89q0 -162 -91.5 -248t-237.5 -86q-37 0 -95 7t-103 19v160h9q26 -10 70 -23t94 -13q104 0 153 39t49 127q0 29 -3 65.5t-6 61.5h153q2 -19 5 -45t3 -64z',\n\t\t'M914 566h-615v122h234v568h-242v112q45 0 99 6.5t84 18.5q37 16 59 38t25 62h135v-805h221v-122z',\n\t\t'M996 1025q0 -235 -122 -364.5t-315 -129.5q-201 0 -319.5 132.5t-118.5 361.5t118.5 362t319.5 133q193 0 315 -130t122 -365zM814 1025q0 172 -67.5 258t-187.5 86q-122 0 -189 -87t-67 -257t67 -256.5t189 -86.5q120 0 187.5 85.5t67.5 257.5z',\n\t\t'M1154 608l-550 -446v196l371 294l-371 294v196l550 -445v-89zM702 610l-528 -419v188l357 273l-357 273v188l528 -418v-85z',\n\t\t'M545 565h-165v681h-209v117q102 0 165 22t72 108h137v-928zM1410 1489l-780 -1489h-165l780 1489h165zM1857 220h-163v-220h-150v220h-465v185l466 539h149v-591h163v-133zM1548 353v400l-353 -400h353z',\n\t\t'M545 565h-165v681h-209v117q102 0 165 22t72 108h137v-928zM1410 1489l-780 -1489h-165l780 1489h165zM1955 0h-688v148q91 69 158 121t106 89q109 103 141 157.5t32 136.5q0 70 -44 107t-120 37q-70 0 -141.5 -30t-112.5 -62h-15v179q65 27 140.5 44t152.5 17 q157 0 241.5 -79t84.5 -201q0 -93 -41 -167t-147 -168q-49 -43 -119.5 -96t-125.5 -94h498v-139z',\n\t\t'M793 826q0 -71 -30 -127t-78 -90q-53 -37 -114.5 -53t-140.5 -16q-82 0 -153.5 15t-136.5 43v175h17q37 -35 114 -64.5t156 -29.5q84 0 139 36.5t55 108.5q0 83 -50 112.5t-141 29.5h-140v139h125q87 0 134.5 38t47.5 104q0 60 -41 95.5t-128 35.5q-66 0 -142.5 -31 t-113.5 -66h-17v175q64 27 139 44t154 17q152 0 237 -70t85 -168q0 -87 -48.5 -143.5t-125.5 -82.5v-8q80 -16 138.5 -70.5t58.5 -148.5zM1500 1489l-780 -1489h-165l780 1489h165zM1913 220h-163v-220h-150v220h-465v185l466 539h149v-591h163v-133zM1604 353v400 l-353 -400h353z',\n\t\t'M712 1278h-204v211h204v-211zM958 40q-83 -30 -176 -50t-205 -20q-215 0 -339.5 104.5t-124.5 275.5q0 98 34.5 173t93.5 137q58 62 136.5 112.5t146.5 91.5v225h179v-305q-60 -33 -139 -81.5t-125 -88.5q-54 -47 -88 -109t-34 -140q0 -113 76.5 -168.5t197.5 -55.5 q103 0 201.5 33t155.5 70h10v-204z',\n\t\t'M1374 0h-211l-146 415h-644l-146 -415h-201l542 1489h264zM956 585l-261 731l-262 -731h523zM862 1675h-149l-273 374h243z',\n\t\t'M1374 0h-211l-146 415h-644l-146 -415h-201l542 1489h264zM956 585l-261 731l-262 -731h523zM955 2049l-273 -374h-149l179 374h243z',\n\t\t'M1374 0h-211l-146 415h-644l-146 -415h-201l542 1489h264zM956 585l-261 731l-262 -731h523zM1033 1670h-159l-185 256l-184 -256h-155l228 379h227z',\n\t\t'M1374 0h-211l-146 415h-644l-146 -415h-201l542 1489h264zM956 585l-261 731l-262 -731h523zM1119 1992q-11 -152 -77 -229t-177 -77q-54 0 -100 19.5t-87 56.5q-47 43 -79.5 64.5t-71.5 21.5q-52 0 -78 -45t-30 -121h-131q8 151 79 228t174 77q50 0 96.5 -19.5 t88.5 -55.5q47 -41 83.5 -61.5t69.5 -20.5q51 0 79.5 46t31.5 116h129z',\n\t\t'M1374 0h-211l-146 415h-644l-146 -415h-201l542 1489h264zM956 585l-261 731l-262 -731h523zM1005 1677h-199v195h199v-195zM592 1677h-199v195h199v-195z',\n\t\t'M1374 0h-211l-148 415h-640l-148 -415h-201l519 1407q-89 44 -142.5 123.5t-53.5 181.5q0 143 102 240t248 97q147 0 248.5 -97t101.5 -240q0 -100 -52.5 -181.5t-141.5 -123.5zM899 1710q0 86 -57 143.5t-143 57.5t-143 -58t-57 -143q0 -86 57.5 -143.5t142.5 -57.5 q86 0 143 57.5t57 143.5zM953 585l-258 715l-259 -715h517z',\n\t\t'M1901 0h-944v556h-524l-212 -556h-207l594 1489h1293v-176h-749v-408h749v-176h-749v-553h749v-176zM957 723v601h-219l-239 -601h458z',\n\t\t'M1350 108q-55 -24 -99.5 -45t-116.5 -44q-11 -3 -24 -7.5t-31 -7.5q2 -19 3.5 -44.5t1.5 -48.5q0 -162 -93.5 -248t-240.5 -86q-38 0 -97.5 7t-104.5 19v162h9q26 -10 71.5 -24t95.5 -14q106 0 155 40t49 126q0 19 -1 41.5t-3 42.5q-19 -2 -40.5 -3t-39.5 -1 q-162 0 -294.5 45.5t-230.5 142.5q-96 95 -150 241.5t-54 340.5q0 184 52 329t150 245q95 97 229.5 148t298.5 51q120 0 239.5 -29t265.5 -102v-235h-15q-123 103 -244 150t-259 47q-113 0 -203.5 -36.5t-161.5 -113.5q-69 -75 -107.5 -189.5t-38.5 -264.5q0 -157 42.5 -270 t109.5 -184q70 -74 163.5 -109.5t197.5 -35.5q143 0 268 49t234 147h14v-232z',\n\t\t'M1181 0h-981v1489h981v-176h-783v-408h783v-176h-783v-553h783v-176zM822 1675h-149l-273 374h243z',\n\t\t'M1181 0h-981v1489h981v-176h-783v-408h783v-176h-783v-553h783v-176zM993 2049l-273 -374h-149l179 374h243z',\n\t\t'M1181 0h-981v1489h981v-176h-783v-408h783v-176h-783v-553h783v-176zM1031 1670h-159l-185 256l-184 -256h-155l228 379h227z',\n\t\t'M1181 0h-981v1489h981v-176h-783v-408h783v-176h-783v-553h783v-176zM1038 1677h-199v195h199v-195zM625 1677h-199v195h199v-195z',\n\t\t'M725 0h-588v152h195v1185h-195v152h588v-152h-195v-1185h195v-152zM568 1675h-149l-273 374h243z',\n\t\t'M725 0h-588v152h195v1185h-195v152h588v-152h-195v-1185h195v-152zM725 2049l-273 -374h-149l179 374h243z',\n\t\t'M725 0h-588v152h195v1185h-195v152h588v-152h-195v-1185h195v-152zM776 1670h-159l-185 256l-184 -256h-155l228 379h227z',\n\t\t'M725 0h-588v152h195v1185h-195v152h588v-152h-195v-1185h195v-152zM738 1677h-199v195h199v-195zM325 1677h-199v195h199v-195z',\n\t\t'M1468 743q0 -203 -88.5 -368t-235.5 -256q-102 -63 -227.5 -91t-330.5 -28h-376v740h-196v143h196v606h372q218 0 347 -31.5t217 -86.5q152 -95 237 -253t85 -375zM1261 746q0 175 -61 295t-182 189q-88 50 -187 69.5t-237 19.5h-188v-436h361v-143h-361v-570h188 q143 0 249.5 21t195.5 78q111 71 166.5 187t55.5 290z',\n\t\t'M1336 0h-245l-706 1332v-1332h-185v1489h307l644 -1216v1216h185v-1489zM1208 1992q-11 -152 -77 -229t-177 -77q-54 0 -100 19.5t-87 56.5q-47 43 -79.5 64.5t-71.5 21.5q-52 0 -78 -45t-30 -121h-131q8 151 79 228t174 77q50 0 96.5 -19.5t88.5 -55.5 q47 -41 83.5 -61.5t69.5 -20.5q51 0 79.5 46t31.5 116h129z',\n\t\t'M1310 1318q91 -100 139.5 -245t48.5 -329t-49.5 -329.5t-138.5 -242.5q-92 -101 -217.5 -152t-286.5 -51q-157 0 -285.5 52t-218.5 151t-138.5 243t-48.5 329q0 182 48 326.5t140 247.5q88 98 218.5 150t284.5 52q160 0 287.5 -52.5t216.5 -149.5zM1292 744 q0 290 -130 447.5t-355 157.5q-227 0 -356.5 -157.5t-129.5 -447.5q0 -293 132 -448.5t354 -155.5t353.5 155.5t131.5 448.5zM932 1675h-149l-273 374h243z',\n\t\t'M1310 1318q91 -100 139.5 -245t48.5 -329t-49.5 -329.5t-138.5 -242.5q-92 -101 -217.5 -152t-286.5 -51q-157 0 -285.5 52t-218.5 151t-138.5 243t-48.5 329q0 182 48 326.5t140 247.5q88 98 218.5 150t284.5 52q160 0 287.5 -52.5t216.5 -149.5zM1292 744 q0 290 -130 447.5t-355 157.5q-227 0 -356.5 -157.5t-129.5 -447.5q0 -293 132 -448.5t354 -155.5t353.5 155.5t131.5 448.5zM1083 2049l-273 -374h-149l179 374h243z',\n\t\t'M1310 1318q91 -100 139.5 -245t48.5 -329t-49.5 -329.5t-138.5 -242.5q-92 -101 -217.5 -152t-286.5 -51q-157 0 -285.5 52t-218.5 151t-138.5 243t-48.5 329q0 182 48 326.5t140 247.5q88 98 218.5 150t284.5 52q160 0 287.5 -52.5t216.5 -149.5zM1292 744 q0 290 -130 447.5t-355 157.5q-227 0 -356.5 -157.5t-129.5 -447.5q0 -293 132 -448.5t354 -155.5t353.5 155.5t131.5 448.5zM1136 1670h-159l-185 256l-184 -256h-155l228 379h227z',\n\t\t'M1310 1318q91 -100 139.5 -245t48.5 -329t-49.5 -329.5t-138.5 -242.5q-92 -101 -217.5 -152t-286.5 -51q-157 0 -285.5 52t-218.5 151t-138.5 243t-48.5 329q0 182 48 326.5t140 247.5q88 98 218.5 150t284.5 52q160 0 287.5 -52.5t216.5 -149.5zM1292 744 q0 290 -130 447.5t-355 157.5q-227 0 -356.5 -157.5t-129.5 -447.5q0 -293 132 -448.5t354 -155.5t353.5 155.5t131.5 448.5zM1207 1992q-11 -152 -77 -229t-177 -77q-54 0 -100 19.5t-87 56.5q-47 43 -79.5 64.5t-71.5 21.5q-52 0 -78 -45t-30 -121h-131q8 151 79 228 t174 77q50 0 96.5 -19.5t88.5 -55.5q47 -41 83.5 -61.5t69.5 -20.5q51 0 79.5 46t31.5 116h129z',\n\t\t'M1307 1318q91 -100 139.5 -245t48.5 -329t-49.5 -329.5t-138.5 -242.5q-92 -101 -217.5 -152t-286.5 -51q-157 0 -285.5 52t-218.5 151t-138.5 243t-48.5 329q0 182 48 326.5t140 247.5q88 98 218.5 150t284.5 52q160 0 287.5 -52.5t216.5 -149.5zM1289 744 q0 290 -130 447.5t-355 157.5q-227 0 -356.5 -157.5t-129.5 -447.5q0 -293 132 -448.5t354 -155.5t353.5 155.5t131.5 448.5zM1108 1677h-199v195h199v-195zM695 1677h-199v195h199v-195z',\n\t\t'M1385 216l-111 -111l-436 440l-436 -440l-111 111l440 436l-440 436l111 111l436 -440l436 440l111 -111l-440 -436z',\n\t\t'M1498 744q0 -184 -49.5 -329.5t-138.5 -242.5q-92 -101 -217.5 -152t-286.5 -51q-115 0 -215.5 29t-179.5 84l-159 -228h-132l205 294q-101 100 -155.5 250t-54.5 346q0 182 48 326.5t140 247.5q88 98 218.5 150t284.5 52q118 0 215 -27.5t179 -82.5l142 201h132 l-188 -268q101 -100 156.5 -248.5t55.5 -350.5zM1097 1260q-57 46 -129 68.5t-161 22.5q-110 0 -200 -38.5t-156 -116.5q-64 -76 -98.5 -190.5t-34.5 -261.5q0 -140 29.5 -252t87.5 -188zM1295 744q0 139 -30 253t-88 189l-664 -957q60 -45 132.5 -68t161.5 -23 q110 0 201.5 40t153.5 116q67 82 100 194.5t33 255.5z',\n\t\t'M1321 598q0 -162 -35.5 -282.5t-116.5 -200.5q-77 -76 -180 -111t-240 -35q-140 0 -244 37t-175 109q-81 82 -116.5 198t-35.5 285v891h198v-901q0 -121 16.5 -191t55.5 -127q44 -65 119.5 -98t181.5 -33q107 0 182 32.5t120 98.5q39 57 55.5 130.5t16.5 182.5v906h198 v-891zM932 1675h-149l-273 374h243z',\n\t\t'M1321 598q0 -162 -35.5 -282.5t-116.5 -200.5q-77 -76 -180 -111t-240 -35q-140 0 -244 37t-175 109q-81 82 -116.5 198t-35.5 285v891h198v-901q0 -121 16.5 -191t55.5 -127q44 -65 119.5 -98t181.5 -33q107 0 182 32.5t120 98.5q39 57 55.5 130.5t16.5 182.5v906h198 v-891zM1073 2049l-273 -374h-149l179 374h243z',\n\t\t'M1321 598q0 -162 -35.5 -282.5t-116.5 -200.5q-77 -76 -180 -111t-240 -35q-140 0 -244 37t-175 109q-81 82 -116.5 198t-35.5 285v891h198v-901q0 -121 16.5 -191t55.5 -127q44 -65 119.5 -98t181.5 -33q107 0 182 32.5t120 98.5q39 57 55.5 130.5t16.5 182.5v906h198 v-891zM1084 1670h-159l-185 256l-184 -256h-155l228 379h227z',\n\t\t'M1321 598q0 -162 -35.5 -282.5t-116.5 -200.5q-77 -76 -180 -111t-240 -35q-140 0 -244 37t-175 109q-81 82 -116.5 198t-35.5 285v891h198v-901q0 -121 16.5 -191t55.5 -127q44 -65 119.5 -98t181.5 -33q107 0 182 32.5t120 98.5q39 57 55.5 130.5t16.5 182.5v906h198 v-891zM1056 1677h-199v195h199v-195zM643 1677h-199v195h199v-195z',\n\t\t'M1254 1489l-524 -836v-653h-198v632l-526 857h219l407 -666l411 666h211zM935 2049l-273 -374h-149l179 374h243z',\n\t\t'M1174 787q0 -92 -35 -176.5t-95 -141.5q-78 -75 -187.5 -111t-260.5 -36h-198v-322h-198v1489h198v-270h205q133 0 230 -22.5t164 -66.5q83 -53 130 -138t47 -205zM968 782q0 72 -26 125.5t-82 88.5q-48 30 -112 42.5t-154 12.5h-196v-563h167q119 0 195 20.5t123 65.5 q44 41 64.5 92t20.5 116z',\n\t\t'M1165 481q0 -214 -135.5 -359.5t-354.5 -145.5q-44 0 -101.5 7.5t-93.5 20.5v165h10q42 -24 91.5 -33t105.5 -9q74 0 129 29t88 78q35 52 50.5 115.5t15.5 139.5q0 166 -105.5 250.5t-303.5 84.5v150q157 0 234 59.5t77 188.5q0 35 -11 68t-41 64q-27 29 -71 46.5 t-105 17.5q-57 0 -103 -14.5t-86 -53.5q-37 -36 -59.5 -102t-22.5 -161v-1087h-188v1080q0 124 36 215.5t100 153.5q60 58 149.5 87.5t183.5 29.5q183 0 297.5 -87t114.5 -238q0 -112 -71 -201t-184 -121v-9q164 -37 259 -148.5t95 -280.5z',\n\t\t'M1053 0h-187v119q-25 -17 -67.5 -47.5t-82.5 -48.5q-47 -23 -108 -38.5t-143 -15.5q-151 0 -256 100t-105 255q0 127 54.5 205.5t155.5 123.5q102 45 245 61t307 24v29q0 64 -22.5 106t-64.5 66q-40 23 -96 31t-117 8q-74 0 -165 -19.5t-188 -56.5h-10v191q55 15 159 33 t205 18q118 0 205.5 -19.5t151.5 -66.5q63 -46 96 -119t33 -181v-758zM866 275v311q-86 -5 -202.5 -15t-184.5 -29q-81 -23 -131 -71.5t-50 -133.5q0 -96 58 -144.5t177 -48.5q99 0 181 38.5t152 92.5zM738 1302h-149l-273 374h243z',\n\t\t'M1053 0h-187v119q-25 -17 -67.5 -47.5t-82.5 -48.5q-47 -23 -108 -38.5t-143 -15.5q-151 0 -256 100t-105 255q0 127 54.5 205.5t155.5 123.5q102 45 245 61t307 24v29q0 64 -22.5 106t-64.5 66q-40 23 -96 31t-117 8q-74 0 -165 -19.5t-188 -56.5h-10v191q55 15 159 33 t205 18q118 0 205.5 -19.5t151.5 -66.5q63 -46 96 -119t33 -181v-758zM866 275v311q-86 -5 -202.5 -15t-184.5 -29q-81 -23 -131 -71.5t-50 -133.5q0 -96 58 -144.5t177 -48.5q99 0 181 38.5t152 92.5zM934 1676l-273 -374h-149l179 374h243z',\n\t\t'M1053 0h-187v119q-25 -17 -67.5 -47.5t-82.5 -48.5q-47 -23 -108 -38.5t-143 -15.5q-151 0 -256 100t-105 255q0 127 54.5 205.5t155.5 123.5q102 45 245 61t307 24v29q0 64 -22.5 106t-64.5 66q-40 23 -96 31t-117 8q-74 0 -165 -19.5t-188 -56.5h-10v191q55 15 159 33 t205 18q118 0 205.5 -19.5t151.5 -66.5q63 -46 96 -119t33 -181v-758zM866 275v311q-86 -5 -202.5 -15t-184.5 -29q-81 -23 -131 -71.5t-50 -133.5q0 -96 58 -144.5t177 -48.5q99 0 181 38.5t152 92.5zM961 1297h-159l-185 256l-184 -256h-155l228 379h227z',\n\t\t'M1053 0h-187v119q-25 -17 -67.5 -47.5t-82.5 -48.5q-47 -23 -108 -38.5t-143 -15.5q-151 0 -256 100t-105 255q0 127 54.5 205.5t155.5 123.5q102 45 245 61t307 24v29q0 64 -22.5 106t-64.5 66q-40 23 -96 31t-117 8q-74 0 -165 -19.5t-188 -56.5h-10v191q55 15 159 33 t205 18q118 0 205.5 -19.5t151.5 -66.5q63 -46 96 -119t33 -181v-758zM866 275v311q-86 -5 -202.5 -15t-184.5 -29q-81 -23 -131 -71.5t-50 -133.5q0 -96 58 -144.5t177 -48.5q99 0 181 38.5t152 92.5zM1038 1619q-11 -152 -77 -229t-177 -77q-54 0 -100 19.5t-87 56.5 q-47 43 -79.5 64.5t-71.5 21.5q-52 0 -78 -45t-30 -121h-131q8 151 79 228t174 77q50 0 96.5 -19.5t88.5 -55.5q47 -41 83.5 -61.5t69.5 -20.5q51 0 79.5 46t31.5 116h129z',\n\t\t'M1053 0h-187v119q-25 -17 -67.5 -47.5t-82.5 -48.5q-47 -23 -108 -38.5t-143 -15.5q-151 0 -256 100t-105 255q0 127 54.5 205.5t155.5 123.5q102 45 245 61t307 24v29q0 64 -22.5 106t-64.5 66q-40 23 -96 31t-117 8q-74 0 -165 -19.5t-188 -56.5h-10v191q55 15 159 33 t205 18q118 0 205.5 -19.5t151.5 -66.5q63 -46 96 -119t33 -181v-758zM866 275v311q-86 -5 -202.5 -15t-184.5 -29q-81 -23 -131 -71.5t-50 -133.5q0 -96 58 -144.5t177 -48.5q99 0 181 38.5t152 92.5zM926 1304h-199v195h199v-195zM513 1304h-199v195h199v-195z',\n\t\t'M1053 0h-187v119q-25 -17 -67.5 -47.5t-82.5 -48.5q-47 -23 -108 -38.5t-143 -15.5q-151 0 -256 100t-105 255q0 127 54.5 205.5t155.5 123.5q102 45 245 61t307 24v29q0 64 -22.5 106t-64.5 66q-40 23 -96 31t-117 8q-74 0 -165 -19.5t-188 -56.5h-10v191q55 15 159 33 t205 18q118 0 205.5 -19.5t151.5 -66.5q63 -46 96 -119t33 -181v-758zM866 275v311q-86 -5 -202.5 -15t-184.5 -29q-81 -23 -131 -71.5t-50 -133.5q0 -96 58 -144.5t177 -48.5q99 0 181 38.5t152 92.5zM956 1630q0 -143 -102 -242t-248 -99q-144 0 -247 98.5t-103 242.5 q0 143 102 241t248 98q147 0 248.5 -98t101.5 -241zM811 1630q0 86 -58.5 145.5t-146.5 59.5t-146.5 -59t-58.5 -146t59 -146t146 -59q88 0 146.5 59t58.5 146z',\n\t\t'M1855 559h-819q0 -114 30 -195t85 -133q52 -48 123 -70.5t157 -22.5q111 0 217.5 41.5t172.5 93.5h12v-205q-78 -35 -184.5 -64.5t-215.5 -29.5q-166 0 -284.5 52t-194.5 155q-21 -19 -67 -59t-96 -68q-63 -36 -137 -59.5t-189 -23.5q-150 0 -255.5 97t-105.5 249 q0 124 54 200.5t155 118.5q95 39 241 53t308 17v61q0 65 -23 107.5t-64 65.5q-40 23 -96 31.5t-116 8.5q-79 0 -168.5 -21t-179.5 -57h-13v191q55 15 158 34t204 19q159 0 264.5 -46.5t162.5 -137.5q69 82 170 134t226 52q217 0 342.5 -128t125.5 -379v-82zM1673 703 q-5 68 -23.5 119t-50.5 88q-34 39 -88.5 61t-133.5 22q-133 0 -223 -75t-115 -215h634zM894 298q-20 53 -30.5 119t-10.5 141q-105 -3 -201 -7.5t-178 -25.5q-79 -20 -127.5 -65.5t-48.5 -128.5q0 -95 58 -141t176 -46q99 0 195.5 43t166.5 111z',\n\t\t'M1011 70q-33 -15 -71.5 -30.5t-67.5 -24.5q3 -19 5.5 -47.5t2.5 -56.5q0 -162 -91.5 -248t-237.5 -86q-37 0 -95 7t-103 19v160h9q26 -10 70 -23t94 -13q104 0 153 39t49 127q0 22 -1.5 45t-3.5 43q-16 -2 -30.5 -4t-39.5 -2q-121 0 -222 35.5t-173 107.5 q-73 72 -113 182t-40 257q0 274 150.5 430t397.5 156q96 0 188.5 -27t169.5 -66v-209h-10q-86 67 -177.5 103t-178.5 36q-160 0 -252.5 -107.5t-92.5 -315.5q0 -202 90.5 -310.5t254.5 -108.5q57 0 116 15t106 39q41 21 77 44.5t57 40.5h10v-207z',\n\t\t'M1120 539h-823q0 -103 31 -179.5t85 -125.5q52 -48 123.5 -72t157.5 -24q114 0 229.5 45.5t164.5 89.5h10v-205q-95 -40 -194 -67t-208 -27q-278 0 -434 150.5t-156 427.5q0 274 149.5 435t393.5 161q226 0 348.5 -132t122.5 -375v-102zM937 683q-1 148 -74.5 229 t-223.5 81q-151 0 -240.5 -89t-101.5 -221h640zM759 1302h-149l-273 374h243z',\n\t\t'M1120 539h-823q0 -103 31 -179.5t85 -125.5q52 -48 123.5 -72t157.5 -24q114 0 229.5 45.5t164.5 89.5h10v-205q-95 -40 -194 -67t-208 -27q-278 0 -434 150.5t-156 427.5q0 274 149.5 435t393.5 161q226 0 348.5 -132t122.5 -375v-102zM937 683q-1 148 -74.5 229 t-223.5 81q-151 0 -240.5 -89t-101.5 -221h640zM960 1676l-273 -374h-149l179 374h243z',\n\t\t'M1120 539h-823q0 -103 31 -179.5t85 -125.5q52 -48 123.5 -72t157.5 -24q114 0 229.5 45.5t164.5 89.5h10v-205q-95 -40 -194 -67t-208 -27q-278 0 -434 150.5t-156 427.5q0 274 149.5 435t393.5 161q226 0 348.5 -132t122.5 -375v-102zM937 683q-1 148 -74.5 229 t-223.5 81q-151 0 -240.5 -89t-101.5 -221h640zM986 1297h-159l-185 256l-184 -256h-155l228 379h227z',\n\t\t'M1120 539h-823q0 -103 31 -179.5t85 -125.5q52 -48 123.5 -72t157.5 -24q114 0 229.5 45.5t164.5 89.5h10v-205q-95 -40 -194 -67t-208 -27q-278 0 -434 150.5t-156 427.5q0 274 149.5 435t393.5 161q226 0 348.5 -132t122.5 -375v-102zM937 683q-1 148 -74.5 229 t-223.5 81q-151 0 -240.5 -89t-101.5 -221h640zM951 1304h-199v195h199v-195zM538 1304h-199v195h199v-195z',\n\t\t'M375 0h-188v1117h188v-1117zM401 1302h-149l-273 374h243z',\n\t\t'M375 0h-188v1117h188v-1117zM582 1676l-273 -374h-149l179 374h243z',\n\t\t'M572 1297h-151l-143 267l-142 -267h-147l178 379h227zM375 0h-188v1117h188v-1117z',\n\t\t'M557 1304h-189v195h189v-195zM194 1304h-189v195h189v-195zM375 0h-188v1117h188v-1117z',\n\t\t'M1137 637q0 -324 -142 -496t-383 -172q-229 0 -367.5 135t-138.5 380q0 226 137 358t339 132q108 0 185.5 -26.5t163.5 -79.5q-32 112 -99.5 219t-154.5 181l-264 -162l-66 97l237 142q-84 67 -156 107.5t-165 87.5v16h295q35 -25 84 -58.5t86 -59.5l210 128l66 -97 l-186 -109q153 -147 236 -325.5t83 -397.5zM847 226q49 59 75 143.5t26 234.5q0 32 -1.5 59.5t-3.5 57.5q-75 45 -157.5 66.5t-168.5 21.5q-147 0 -231.5 -87.5t-84.5 -239.5q0 -180 84.5 -267t227.5 -87q66 0 127.5 22t106.5 76z',\n\t\t'M1119 0h-188v636q0 77 -9 144.5t-33 105.5q-25 42 -72 62.5t-122 20.5q-77 0 -161 -38t-161 -97v-834h-188v1117h188v-124q88 73 182 114t193 41q181 0 276 -109t95 -314v-725zM1075 1619q-11 -152 -77 -229t-177 -77q-54 0 -100 19.5t-87 56.5q-47 43 -79.5 64.5 t-71.5 21.5q-52 0 -78 -45t-30 -121h-131q8 151 79 228t174 77q50 0 96.5 -19.5t88.5 -55.5q47 -41 83.5 -61.5t69.5 -20.5q51 0 79.5 46t31.5 116h129z',\n\t\t'M1137 558q0 -273 -140 -431t-375 -158q-237 0 -376.5 158t-139.5 431t139.5 431.5t376.5 158.5q235 0 375 -158.5t140 -431.5zM943 558q0 217 -85 322.5t-236 105.5q-153 0 -237.5 -105.5t-84.5 -322.5q0 -210 85 -318.5t237 -108.5q150 0 235.5 107.5t85.5 319.5z M732 1302h-149l-273 374h243z',\n\t\t'M1137 558q0 -273 -140 -431t-375 -158q-237 0 -376.5 158t-139.5 431t139.5 431.5t376.5 158.5q235 0 375 -158.5t140 -431.5zM943 558q0 217 -85 322.5t-236 105.5q-153 0 -237.5 -105.5t-84.5 -322.5q0 -210 85 -318.5t237 -108.5q150 0 235.5 107.5t85.5 319.5z M933 1676l-273 -374h-149l179 374h243z',\n\t\t'M1137 558q0 -273 -140 -431t-375 -158q-237 0 -376.5 158t-139.5 431t139.5 431.5t376.5 158.5q235 0 375 -158.5t140 -431.5zM943 558q0 217 -85 322.5t-236 105.5q-153 0 -237.5 -105.5t-84.5 -322.5q0 -210 85 -318.5t237 -108.5q150 0 235.5 107.5t85.5 319.5z M963 1297h-159l-185 256l-184 -256h-155l228 379h227z',\n\t\t'M1137 558q0 -273 -140 -431t-375 -158q-237 0 -376.5 158t-139.5 431t139.5 431.5t376.5 158.5q235 0 375 -158.5t140 -431.5zM943 558q0 217 -85 322.5t-236 105.5q-153 0 -237.5 -105.5t-84.5 -322.5q0 -210 85 -318.5t237 -108.5q150 0 235.5 107.5t85.5 319.5z M1038 1619q-11 -152 -77 -229t-177 -77q-54 0 -100 19.5t-87 56.5q-47 43 -79.5 64.5t-71.5 21.5q-52 0 -78 -45t-30 -121h-131q8 151 79 228t174 77q50 0 96.5 -19.5t88.5 -55.5q47 -41 83.5 -61.5t69.5 -20.5q51 0 79.5 46t31.5 116h129z',\n\t\t'M1137 558q0 -273 -140 -431t-375 -158q-237 0 -376.5 158t-139.5 431t139.5 431.5t376.5 158.5q235 0 375 -158.5t140 -431.5zM943 558q0 217 -85 322.5t-236 105.5q-153 0 -237.5 -105.5t-84.5 -322.5q0 -210 85 -318.5t237 -108.5q150 0 235.5 107.5t85.5 319.5z M928 1304h-199v195h199v-195zM515 1304h-199v195h199v-195z',\n\t\t'M957 1022h-238v275h238v-275zM1466 572h-1256v160h1256v-160zM957 7h-238v275h238v-275z',\n\t\t'M1137 558q0 -273 -140 -431t-375 -158q-84 0 -155.5 21t-130.5 60l-133 -198h-110l171 256q-75 77 -116.5 190t-41.5 260q0 273 139.5 431.5t376.5 158.5q87 0 158 -22t125 -57l116 172h111l-155 -231q76 -76 118 -188t42 -264zM813 930q-37 29 -86.5 43.5t-104.5 14.5 q-155 0 -240 -110t-85 -320q0 -97 17 -171t52 -128zM946 558q0 97 -17.5 173t-51.5 130l-448 -671q39 -31 86.5 -46t106.5 -15q150 0 237 108.5t87 320.5z',\n\t\t'M1111 0h-188v124q-95 -75 -182 -115t-192 -40q-176 0 -274 107.5t-98 315.5v725h188v-636q0 -85 8 -145.5t34 -103.5q27 -44 70 -64t125 -20q73 0 159.5 38t161.5 97v834h188v-1117zM764 1302h-149l-273 374h243z',\n\t\t'M1111 0h-188v124q-95 -75 -182 -115t-192 -40q-176 0 -274 107.5t-98 315.5v725h188v-636q0 -85 8 -145.5t34 -103.5q27 -44 70 -64t125 -20q73 0 159.5 38t161.5 97v834h188v-1117zM945 1676l-273 -374h-149l179 374h243z',\n\t\t'M1111 0h-188v124q-95 -75 -182 -115t-192 -40q-176 0 -274 107.5t-98 315.5v725h188v-636q0 -85 8 -145.5t34 -103.5q27 -44 70 -64t125 -20q73 0 159.5 38t161.5 97v834h188v-1117zM985 1297h-159l-185 256l-184 -256h-155l228 379h227z',\n\t\t'M1111 0h-188v124q-95 -75 -182 -115t-192 -40q-176 0 -274 107.5t-98 315.5v725h188v-636q0 -85 8 -145.5t34 -103.5q27 -44 70 -64t125 -20q73 0 159.5 38t161.5 97v834h188v-1117zM955 1304h-199v195h199v-195zM542 1304h-199v195h199v-195z',\n\t\t'M1151 1117l-652 -1529h-201l208 466l-445 1063h204l343 -828l346 828h197zM928 1676l-273 -374h-149l179 374h243z',\n\t\t'M1168 572q0 -136 -39 -248.5t-110 -190.5q-66 -74 -155.5 -114.5t-189.5 -40.5q-87 0 -157.5 19t-143.5 59v-468h-188v1968h188v-556q75 63 168.5 105.5t199.5 42.5q202 0 314.5 -152.5t112.5 -423.5zM974 567q0 202 -69 302t-212 100q-81 0 -163 -35t-157 -92v-633 q80 -36 137.5 -49t130.5 -13q157 0 245 106t88 314z',\n\t\t'M585 832h-239v285h239v-285zM658 285l-282 -655h-146l174 655h254z',\n\t\t'M773 1676l-49 -384h-145l-49 384h243z',\n\t\t'M765 1676l-49 -384h-128l-49 384h226zM1048 1304h-191v195h191v-195zM447 1304h-191v195h191v-195z',\n\t\t'M1374 0h-211l-146 415h-644l-146 -415h-201l542 1489h264zM956 585l-261 731l-262 -731h523zM250 1489l-49 -384h-145l-49 384h243z',\n\t\t'M585 832h-239v285h239v-285z',\n\t\t'M1424 0h-981v1489h981v-176h-783v-408h783v-176h-783v-553h783v-176zM243 1489l-49 -384h-145l-49 384h243z',\n\t\t'M1582 0h-198v729h-743v-729h-198v1489h198v-584h743v584h198v-1489zM243 1489l-49 -384h-145l-49 384h243z',\n\t\t'M968 0h-588v152h195v1185h-195v152h588v-152h-195v-1185h195v-152zM243 1489l-49 -384h-145l-49 384h243z',\n\t\t'M1501 1318q91 -100 139.5 -245t48.5 -329t-49.5 -329.5t-138.5 -242.5q-92 -101 -217.5 -152t-286.5 -51q-157 0 -285.5 52t-218.5 151t-138.5 243t-48.5 329q0 182 48 326.5t140 247.5q88 98 218.5 150t284.5 52q160 0 287.5 -52.5t216.5 -149.5zM1483 744 q0 290 -130 447.5t-355 157.5q-227 0 -356.5 -157.5t-129.5 -447.5q0 -293 132 -448.5t354 -155.5t353.5 155.5t131.5 448.5zM243 1489l-49 -384h-145l-49 384h243z',\n\t\t'M1537 1489l-524 -836v-653h-198v632l-526 857h219l407 -666l411 666h211zM243 1489l-49 -384h-145l-49 384h243z',\n\t\t'M1751 0h-576v387q60 38 119.5 82t103.5 101q45 59 71 138.5t26 185.5q0 206 -127 330.5t-347 124.5t-347 -124.5t-127 -330.5q0 -106 26 -185.5t71 -138.5q45 -57 104 -101t119 -82v-387h-576v174h410v124q-157 90 -258.5 246t-101.5 350q0 276 187.5 451t492.5 175 t492.5 -175t187.5 -451q0 -194 -101.5 -350t-258.5 -246v-124h410v-174zM243 1489l-49 -384h-145l-49 384h243z',\n\t\t'M375 0h-188v1117h188v-1117zM379 1676l-56 -384h-84l-56 384h196zM615 1304h-171v195h171v-195zM118 1304h-171v195h171v-195z',\n\t\t'M1374 0h-211l-146 415h-644l-146 -415h-201l542 1489h264zM956 585l-261 731l-262 -731h523z',\n\t\t'M1323 458q0 -111 -42 -196t-113 -140q-84 -66 -184.5 -94t-255.5 -28h-528v1489h441q163 0 244 -12t155 -50q82 -43 119 -110.5t37 -161.5q0 -106 -54 -180.5t-144 -119.5v-8q151 -31 238 -132.5t87 -256.5zM990 1129q0 54 -18 91t-58 60q-47 27 -114 33.5t-166 6.5h-236 v-430h256q93 0 148 9.5t102 39.5t66.5 77.5t19.5 112.5zM1117 450q0 90 -27 143t-98 90q-48 25 -116.5 32.5t-166.5 7.5h-311v-554h262q130 0 213 13.5t136 49.5q56 39 82 89t26 129z',\n\t\t'M1162 1313h-764v-1313h-198v1489h962v-176z',\n\t\t'M1414 0h-1388l562 1489h264zM1147 168l-432 1147l-431 -1147h863z',\n\t\t'M1181 0h-981v1489h981v-176h-783v-408h783v-176h-783v-553h783v-176z',\n\t\t'M1288 0h-1162v184l913 1129h-879v176h1106v-179l-922 -1134h944v-176z',\n\t\t'M1339 0h-198v729h-743v-729h-198v1489h198v-584h743v584h198v-1489z',\n\t\t'M1310 1318q91 -100 139.5 -245t48.5 -329t-49.5 -329.5t-138.5 -242.5q-92 -101 -217.5 -152t-286.5 -51q-157 0 -285.5 52t-218.5 151t-138.5 243t-48.5 329q0 182 48 326.5t140 247.5q88 98 218.5 150t284.5 52q160 0 287.5 -52.5t216.5 -149.5zM1292 744 q0 290 -130 447.5t-355 157.5q-227 0 -356.5 -157.5t-129.5 -447.5q0 -293 132 -448.5t354 -155.5t353.5 155.5t131.5 448.5zM1120 713h-627v179h627v-179z',\n\t\t'M725 0h-588v152h195v1185h-195v152h588v-152h-195v-1185h195v-152z',\n\t\t'M1397 0h-257l-589 663l-148 -158v-505h-198v1489h198v-777l723 777h240l-665 -700z',\n\t\t'M1378 0h-213l-468 1285l-468 -1285h-203l556 1489h240z',\n\t\t'M1526 0h-198v1283l-414 -873h-118l-411 873v-1283h-185v1489h270l397 -829l384 829h275v-1489z',\n\t\t'M1336 0h-245l-706 1332v-1332h-185v1489h307l644 -1216v1216h185v-1489z',\n\t\t'M1215 1313h-1101v176h1101v-176zM1163 729h-997v176h997v-176zM1215 0h-1101v176h1101v-176z',\n\t\t'M1310 1318q91 -100 139.5 -245t48.5 -329t-49.5 -329.5t-138.5 -242.5q-92 -101 -217.5 -152t-286.5 -51q-157 0 -285.5 52t-218.5 151t-138.5 243t-48.5 329q0 182 48 326.5t140 247.5q88 98 218.5 150t284.5 52q160 0 287.5 -52.5t216.5 -149.5zM1292 744 q0 290 -130 447.5t-355 157.5q-227 0 -356.5 -157.5t-129.5 -447.5q0 -293 132 -448.5t354 -155.5t353.5 155.5t131.5 448.5z',\n\t\t'M1339 0h-198v1313h-743v-1313h-198v1489h1139v-1489z',\n\t\t'M1174 1039q0 -99 -34.5 -183.5t-96.5 -146.5q-77 -77 -182 -115.5t-265 -38.5h-198v-555h-198v1489h404q134 0 227 -22.5t165 -70.5q85 -57 131.5 -142t46.5 -215zM968 1034q0 77 -27 134t-82 93q-48 31 -109.5 44.5t-155.5 13.5h-196v-595h167q120 0 195 21.5t122 68.5 q47 48 66.5 101t19.5 119z',\n\t\t'M1280 0h-1162v184l620 600l-600 526v179h1096v-176h-832l586 -506v-26l-630 -605h922v-176z',\n\t\t'M1262 1313h-532v-1313h-198v1313h-532v176h1262v-176z',\n\t\t'M1254 1489l-524 -836v-653h-198v632l-526 857h219l407 -666l411 666h211z',\n\t\t'M1572 755q0 -140 -44.5 -248.5t-123.5 -181.5q-85 -79 -207 -125.5t-260 -49.5v-166h-197v166q-134 3 -257 48t-210 127q-79 74 -123.5 182t-44.5 248q0 136 43 238t119 178q81 81 202.5 128t270.5 51v155h197v-155q148 -3 271 -52t202 -127q75 -73 118.5 -177t43.5 -239 zM1366 763q0 99 -32 182t-91 140q-58 56 -129 82t-177 28v-890q94 2 171 30.5t127 75.5q65 60 98 147t33 205zM740 305v890q-106 -1 -177 -28t-129 -82t-90.5 -140t-32.5 -182q0 -112 33.5 -203t97.5 -149q49 -45 126.5 -75t171.5 -31z',\n\t\t'M1336 1489l-514 -736l513 -753h-229l-406 613l-416 -613h-216l519 744l-507 745h228l401 -605l410 605h217z',\n\t\t'M1604 910q0 -157 -40.5 -264.5t-117.5 -174.5q-80 -69 -192.5 -104t-263.5 -45v-322h-197v322q-154 11 -267 47t-188 102q-78 69 -118.5 176t-40.5 263v579h198v-602q0 -109 29.5 -180t81.5 -115q53 -45 130 -68.5t175 -30.5v996h197v-996q97 8 175 30.5t131 68.5 q56 49 83 115.5t27 179.5v602h198v-579z',\n\t\t'M1568 0h-576v387q60 38 119.5 82t103.5 101q45 59 71 138.5t26 185.5q0 206 -127 330.5t-347 124.5t-347 -124.5t-127 -330.5q0 -106 26 -185.5t71 -138.5q45 -57 104 -101t119 -82v-387h-576v174h410v124q-157 90 -258.5 246t-101.5 350q0 276 187.5 451t492.5 175 t492.5 -175t187.5 -451q0 -194 -101.5 -350t-258.5 -246v-124h410v-174z',\n\t\t'M725 0h-588v152h195v1185h-195v152h588v-152h-195v-1185h195v-152zM738 1677h-199v195h199v-195zM325 1677h-199v195h199v-195z',\n\t\t'M1254 1489l-524 -836v-653h-198v632l-526 857h219l407 -666l411 666h211zM939 1677h-199v195h199v-195zM526 1677h-199v195h199v-195z',\n\t\t'M1091 0h-188v117q-81 -70 -169 -109t-191 -39q-200 0 -317.5 154t-117.5 427q0 142 40.5 253t109.5 189q68 76 158.5 116t187.5 40q88 0 156 -22t143 -61v52h188v-1117zM903 275v636q-76 34 -136 49.5t-131 15.5q-158 0 -246 -110t-88 -312q0 -199 68 -302.5t218 -103.5 q80 0 162 35.5t153 91.5zM743 1676l-49 -384h-145l-49 384h243z',\n\t\t'M1006 64q-107 -48 -210 -69t-218 -21q-79 0 -161 16t-152 56q-69 39 -112.5 102.5t-43.5 157.5q0 96 56.5 168t177.5 110v7q-91 24 -145 90t-54 158q0 89 47.5 147.5t112.5 92.5q64 33 145 49t160 16q98 0 180 -16.5t172 -44.5v-207h-13q-66 51 -163.5 79t-197.5 28 q-45 0 -84 -5.5t-81 -25.5q-35 -15 -60.5 -48.5t-25.5 -77.5q0 -61 28 -95t76 -49q45 -14 97 -15.5t105 -1.5h111v-166h-158q-62 0 -112 -4.5t-92 -21.5q-41 -17 -65.5 -54t-24.5 -96q0 -53 26 -90t67 -58q37 -19 87.5 -29t106.5 -10q102 0 218 36t187 98h13v-206zM721 1676 l-49 -384h-145l-49 384h243z',\n\t\t'M1119 -412h-188v1048q0 77 -9 144.5t-33 105.5q-25 42 -72 62.5t-122 20.5q-77 0 -161 -38t-161 -97v-834h-188v1117h188v-124q88 73 182 114t193 41q181 0 276 -109t95 -314v-1137zM802 1676l-49 -384h-145l-49 384h243z',\n\t\t'M375 0h-188v1117h188v-1117zM403 1676l-49 -384h-145l-49 384h243z',\n\t\t'M1116 407q0 -218 -122 -327.5t-348 -109.5q-223 0 -346 107.5t-123 329.5v710h188v-641q0 -93 10 -153t42 -106q31 -43 84.5 -64.5t145.5 -21.5q86 0 143.5 22t87.5 66q29 44 39.5 105.5t10.5 151.5v641h188v-710zM760 1676l-49 -384h-128l-49 384h226zM1043 1304h-191 v195h191v-195zM442 1304h-191v195h191v-195z',\n\t\t'M1091 0h-188v117q-81 -70 -169 -109t-191 -39q-200 0 -317.5 154t-117.5 427q0 142 40.5 253t109.5 189q68 76 158.5 116t187.5 40q88 0 156 -22t143 -61v52h188v-1117zM903 275v636q-76 34 -136 49.5t-131 15.5q-158 0 -246 -110t-88 -312q0 -199 68 -302.5t218 -103.5 q80 0 162 35.5t153 91.5z',\n\t\t'M1165 444q0 -202 -134.5 -334t-339.5 -132q-79 0 -167 22t-151 64v-476h-188v1490q0 224 126.5 351t349.5 127q90 0 164.5 -21.5t133.5 -67.5q57 -43 91 -112t34 -160q0 -127 -69.5 -221.5t-196.5 -131.5v-17q159 -26 253 -125.5t94 -255.5zM971 449q0 89 -34.5 144.5 t-92.5 86.5q-59 32 -132 43t-146 11h-36v160h36q66 0 131 14.5t104 44.5q46 34 68.5 83t22.5 134q0 112 -69 170t-178 58q-73 0 -125 -26.5t-85 -70.5q-32 -44 -47 -102.5t-15 -120.5v-862q66 -38 141 -53.5t147 -15.5q149 0 229.5 78.5t80.5 223.5z',\n\t\t'M1151 1117l-457 -1061v-468h-188v468l-445 1061h204l343 -828l346 828h197z',\n\t\t'M1139 551q0 -272 -138.5 -427t-376.5 -155q-241 0 -379.5 151.5t-138.5 413.5q0 141 43 239.5t107 162.5q69 72 159 113t182 58q-76 63 -166 130.5t-192 139.5v179h810v-158h-561v-10q68 -46 179 -124t204 -162q150 -136 209 -261.5t59 -289.5zM945 551q0 135 -55 249 t-165 200q-66 -8 -138.5 -32t-138.5 -77q-63 -50 -105.5 -137t-42.5 -214q0 -201 85 -305t241 -104q153 0 236 105.5t83 314.5z',\n\t\t'M1006 64q-107 -48 -210 -69t-218 -21q-79 0 -161 16t-152 56q-69 39 -112.5 102.5t-43.5 157.5q0 96 56.5 168t177.5 110v7q-91 24 -145 90t-54 158q0 89 47.5 147.5t112.5 92.5q64 33 145 49t160 16q98 0 180 -16.5t172 -44.5v-207h-13q-66 51 -163.5 79t-197.5 28 q-45 0 -84 -5.5t-81 -25.5q-35 -15 -60.5 -48.5t-25.5 -77.5q0 -61 28 -95t76 -49q45 -14 97 -15.5t105 -1.5h111v-166h-158q-62 0 -112 -4.5t-92 -21.5q-41 -17 -65.5 -54t-24.5 -96q0 -53 26 -90t67 -58q37 -19 87.5 -29t106.5 -10q102 0 218 36t187 98h13v-206z',\n\t\t'M922 75q32 -40 46 -85.5t14 -85.5q0 -84 -45 -168.5t-112 -147.5h-179v14q90 79 128 138.5t38 128.5q0 57 -30.5 95t-77.5 38h-145q-229 0 -340 116t-111 345q0 140 46 268t124 247q75 112 173.5 214.5t206.5 196.5v9h-460v158h744v-135q-117 -78 -231.5 -181 t-204.5 -223q-89 -117 -146 -257t-57 -283q0 -34 3 -70t15 -76q10 -38 34.5 -75.5t63.5 -61.5q36 -22 96.5 -24.5t116.5 -2.5h86q71 0 122 -26t82 -66z',\n\t\t'M1119 -412h-188v1048q0 77 -9 144.5t-33 105.5q-25 42 -72 62.5t-122 20.5q-77 0 -161 -38t-161 -97v-834h-188v1117h188v-124q88 73 182 114t193 41q181 0 276 -109t95 -314v-1137z',\n\t\t'M1141 768q0 -190 -23 -316.5t-59 -210.5q-58 -135 -163 -203.5t-257 -68.5t-257 68.5t-163 203.5q-37 84 -59.5 210.5t-22.5 316.5q0 174 22.5 305.5t60.5 214.5q57 130 162.5 199t256.5 69t256.5 -69t162.5 -199q37 -84 60 -215t23 -305zM952 858q-4 143 -28.5 250 t-56.5 161q-41 70 -95 98.5t-133 28.5t-133 -28.5t-95 -98.5q-34 -55 -57.5 -161.5t-27.5 -249.5h626zM952 697h-626q0 -142 23 -258.5t59 -178.5q40 -69 96 -100t135 -31t135 31t96 100q36 62 59 178.5t23 258.5z',\n\t\t'M375 0h-188v1117h188v-1117z',\n\t\t'M1192 0h-248l-451 489l-112 -109v-380h-188v1117h188v-550l384 417q72 79 135.5 107t126.5 28q28 0 58 -1t37 -1v-166h-11q-16 2 -39.5 3t-36.5 1q-47 0 -85.5 -23.5t-67.5 -56.5l-251 -271z',\n\t\t'M1151 0h-205l-328 829l-361 -829h-196l465 1056l-215 500h211z',\n\t\t'M1125 0h-186v118q-74 -78 -141.5 -108.5t-145.5 -30.5q-75 0 -135 27t-144 107v-525h-188v1529h188v-838q32 -39 111 -80t170 -41q93 0 161 33.5t122 93.5v832h188v-1117z',\n\t\t'M1151 1117l-452 -1117h-189l-449 1117h204l346 -889l343 889h197z',\n\t\t'M1041 -96q0 -85 -45.5 -169t-111.5 -147h-180v14q92 79 129.5 139t37.5 128q0 55 -29 94t-75 39h-140q-140 0 -232.5 27t-155.5 84q-66 60 -100.5 135.5t-34.5 163.5q0 78 25 144t73 119q44 49 112.5 83.5t144.5 53.5v11q-125 28 -200 110.5t-75 186.5q0 83 43.5 150.5 t133.5 125.5v6h-228v154h824v-158h-256q-68 0 -122.5 -14.5t-102.5 -48.5q-45 -32 -72 -83t-27 -118q0 -79 32.5 -128t83.5 -75q45 -23 104 -34t139 -11h170v-165h-295q-66 0 -118.5 -20t-99.5 -59q-43 -37 -68.5 -90t-25.5 -112q0 -102 37.5 -159t101.5 -82 q63 -25 139.5 -28.5t166.5 -3.5h28q68 0 119.5 -23.5t84.5 -60.5q31 -35 48 -82.5t17 -96.5z',\n\t\t'M1137 558q0 -273 -140 -431t-375 -158q-237 0 -376.5 158t-139.5 431t139.5 431.5t376.5 158.5q235 0 375 -158.5t140 -431.5zM943 558q0 217 -85 322.5t-236 105.5q-153 0 -237.5 -105.5t-84.5 -322.5q0 -210 85 -318.5t237 -108.5q150 0 235.5 107.5t85.5 319.5z',\n\t\t'M1120 0h-188v955h-559v-955h-188v1117h935v-1117z',\n\t\t'M1172 577q0 -258 -138.5 -428.5t-360.5 -170.5q-65 0 -146.5 18t-153.5 61v-469h-188v1058q0 123 35.5 215.5t101.5 158.5q62 62 155.5 95t195.5 33q243 0 371 -147t128 -424zM978 565q0 218 -80 320t-226 102q-158 0 -228.5 -96t-70.5 -278v-403q73 -34 132.5 -48.5 t134.5 -14.5q162 0 250 111t88 307z',\n\t\t'M1018 -96q0 -87 -47 -172t-109 -144h-177v14q86 75 124.5 135.5t38.5 131.5q0 54 -30 93.5t-75 39.5h-92q-117 0 -216 30t-174 97q-73 66 -114.5 170t-41.5 250q0 270 155.5 432t414.5 162q84 0 164 -18.5t147 -45.5v-211h-12q-94 62 -172.5 87t-146.5 25 q-166 0 -260.5 -119t-94.5 -312q0 -112 28.5 -183t78.5 -116q50 -44 114.5 -63.5t139.5 -19.5h100q115 0 186 -76.5t71 -186.5z',\n\t\t'M1137 558q0 -281 -140.5 -435t-373.5 -154q-241 0 -379 158t-138 431q0 275 141 432.5t378 157.5q55 0 108 -11t82 -20h480v-165h-288q62 -73 96 -170t34 -224zM943 558q0 215 -82 322t-236 107q-161 0 -243 -112t-82 -317q0 -209 83.5 -318t239.5 -109q152 0 236 107.5 t84 319.5z',\n\t\t'M1006 952h-404v-952h-188v952h-404v165h996v-165z',\n\t\t'M1116 407q0 -218 -122 -327.5t-348 -109.5q-223 0 -346 107.5t-123 329.5v710h188v-641q0 -93 10 -153t42 -106q31 -43 84.5 -64.5t145.5 -21.5q86 0 143.5 22t87.5 66q29 44 39.5 105.5t10.5 151.5v641h188v-710z',\n\t\t'M1514 576q0 -259 -171.5 -417t-440.5 -173v-398h-187v398q-130 6 -240.5 46.5t-191.5 109.5q-85 74 -132 172t-47 232q0 159 59 296t192 275h229v-17q-136 -99 -210 -232t-74 -300q0 -189 112.5 -304t301.5 -121v1000q33 2 70.5 2.5t76.5 0.5q304 0 478.5 -149.5 t174.5 -420.5zM1319 586q0 184 -112 293.5t-305 109.5v-846q206 10 311.5 126t105.5 317z',\n\t\t'M1160 -412h-213l-346 619l-350 -619h-203l444 770l-433 759h213l335 -600l339 600h203l-433 -751z',\n\t\t'M1507 446q0 -114 -48 -198t-127 -137q-82 -55 -182 -82.5t-215 -32.5v-408h-187v408q-115 6 -214.5 32t-182.5 83q-80 54 -127.5 137.5t-47.5 197.5v671h188v-612q0 -113 37.5 -180.5t89.5 -102.5q56 -38 123 -53t134 -19v967h187v-967q67 5 134 19t123 53 q59 40 93 101.5t34 181.5v612h188v-671z',\n\t\t'M1553 503q0 -96 -23.5 -192.5t-74.5 -171.5q-55 -80 -133.5 -124.5t-193.5 -44.5q-96 0 -177 49.5t-118 116.5h-6q-39 -68 -113 -117t-176 -49q-113 0 -194.5 46.5t-132.5 122.5t-74.5 171.5t-23.5 192.5q0 170 57 308.5t201 305.5h228v-17q-135 -108 -214.5 -262 t-79.5 -337q0 -66 8 -122.5t38 -119.5q26 -55 72.5 -91.5t117.5 -36.5q51 0 86.5 12.5t55.5 29.5q22 18 36.5 40t20.5 37v584h186v-584q9 -17 23 -39t35 -39q24 -19 52.5 -30t86.5 -11q70 0 117 35.5t74 92.5q25 55 36 116t11 126q0 182 -78.5 336t-215.5 263v17h228 q144 -167 201 -305.5t57 -308.5z',\n\t\t'M557 1304h-189v195h189v-195zM194 1304h-189v195h189v-195zM375 0h-188v1117h188v-1117z',\n\t\t'M1116 407q0 -218 -122 -327.5t-348 -109.5q-223 0 -346 107.5t-123 329.5v710h188v-641q0 -93 10 -153t42 -106q31 -43 84.5 -64.5t145.5 -21.5q86 0 143.5 22t87.5 66q29 44 39.5 105.5t10.5 151.5v641h188v-710zM953 1304h-199v195h199v-195zM540 1304h-199v195h199 v-195z',\n\t\t'M1137 558q0 -273 -140 -431t-375 -158q-237 0 -376.5 158t-139.5 431t139.5 431.5t376.5 158.5q235 0 375 -158.5t140 -431.5zM943 558q0 217 -85 322.5t-236 105.5q-153 0 -237.5 -105.5t-84.5 -322.5q0 -210 85 -318.5t237 -108.5q150 0 235.5 107.5t85.5 319.5z M743 1676l-49 -384h-145l-49 384h243z',\n\t\t'M1116 407q0 -218 -122 -327.5t-348 -109.5q-223 0 -346 107.5t-123 329.5v710h188v-641q0 -93 10 -153t42 -106q31 -43 84.5 -64.5t145.5 -21.5q86 0 143.5 22t87.5 66q29 44 39.5 105.5t10.5 151.5v641h188v-710zM768 1676l-49 -384h-145l-49 384h243z',\n\t\t'M1553 503q0 -96 -23.5 -192.5t-74.5 -171.5q-55 -80 -133.5 -124.5t-193.5 -44.5q-96 0 -177 49.5t-118 116.5h-6q-39 -68 -113 -117t-176 -49q-113 0 -194.5 46.5t-132.5 122.5t-74.5 171.5t-23.5 192.5q0 170 57 308.5t201 305.5h228v-17q-135 -108 -214.5 -262 t-79.5 -337q0 -66 8 -122.5t38 -119.5q26 -55 72.5 -91.5t117.5 -36.5q51 0 86.5 12.5t55.5 29.5q22 18 36.5 40t20.5 37v584h186v-584q9 -17 23 -39t35 -39q24 -19 52.5 -30t86.5 -11q70 0 117 35.5t74 92.5q25 55 36 116t11 126q0 182 -78.5 336t-215.5 263v17h228 q144 -167 201 -305.5t57 -308.5zM955 1676l-49 -384h-145l-49 384h243z',\n\t\t'M1145 837q0 -164 -39 -344t-121 -303q-85 -124 -186.5 -173t-214.5 -49q-192 0 -313.5 126.5t-121.5 329.5q0 228 134.5 372.5t336.5 144.5q90 0 169.5 -26t158.5 -91q2 26 3 55.5t1 55.5q0 217 -79 318t-231 101q-78 0 -169.5 -31.5t-169.5 -86.5h-11v194 q81 44 181.5 66.5t196.5 22.5q137 0 239.5 -54.5t164.5 -178.5q42 -86 56.5 -189t14.5 -260zM942 678q-60 47 -136 74t-148 27q-141 0 -225 -91t-84 -261q0 -145 67.5 -221.5t179.5 -76.5q128 0 209.5 97t115.5 287q6 33 11.5 73t9.5 92z',\n\t\t'M1438 0h-1388l562 1489h264zM1171 168l-432 1147l-431 -1147h863z',\n\t\t'M1532 1315h-200v-1508h-198v1508h-592v-1508h-198v1508h-200v174h1388v-174z',\n\t\t'M1369 -189h-1182v191l673 668l-663 631v188h1133v-176h-891l648 -601v-72l-666 -653h948v-176z',\n\t\t'M1456 572h-1236v160h1236v-160z',\n\t\t'M843 1489l-780 -1489h-165l780 1489h165z',\n\t\t'M492 511h-239v283h239v-283z',\n\t\t'M1737 1788l-880 -1939h-102l-384 993h-237v139h393l313 -821l730 1628h167z',\n\t\t'M1887 663q0 -239 -122.5 -372.5t-329.5 -133.5q-133 0 -244 76.5t-180 222.5q-79 -151 -184.5 -225t-248.5 -74q-191 0 -304 135.5t-113 349.5q0 238 125 372t327 134q134 0 245 -77t179 -222q79 150 185.5 224.5t247.5 74.5q191 0 304 -135.5t113 -349.5zM967 729 q-63 117 -155 175.5t-188 58.5q-138 0 -216 -83.5t-78 -237.5q0 -133 63.5 -216t182.5 -83q110 0 172 48.5t119 142.5q34 57 52.5 92.5t47.5 102.5zM1718 663q0 134 -64 216.5t-182 82.5q-88 0 -152.5 -35.5t-138.5 -155.5q-30 -48 -55.5 -99.5t-44.5 -95.5 q60 -115 153.5 -174.5t189.5 -59.5q138 0 216 83t78 238z',\n\t\t'M1168 1367h-10q-32 8 -89.5 18.5t-89.5 10.5q-129 0 -181 -61q-53 -61 -53 -210v-1123q0 -206 -104 -315q-105 -110 -293 -110q-52 0 -106.5 5.5t-103.5 15.5v178h10q33 -8 87 -18.5t88 -10.5q129 0 182 61q52 61 52 210v1123q0 204 104 315q104 110 293 110 q58 0 109 -5.5t105 -15.5v-178z',\n\t\t'M1431 1104q-20 -194 -111 -293t-249 -99q-77 0 -147 37.5t-126 82.5q-65 52 -117 79.5t-96 27.5q-75 0 -117 -48t-70 -172h-155q23 182 112.5 280t248.5 98q72 0 143 -37t130 -83q61 -48 114.5 -77.5t98.5 -29.5q76 0 120.5 54.5t63.5 179.5h157zM1432 588 q-25 -184 -112 -281.5t-250 -97.5q-72 0 -144 37.5t-129 82.5q-39 31 -103 69t-110 38q-78 0 -121 -55t-63 -179h-157q19 192 110.5 292t249.5 100q77 0 146 -37t127 -83q35 -28 97 -67.5t116 -39.5q75 0 117 49.5t69 171.5h157z',\n\t\t'M1431 362h-608l-104 -335h-153l104 335h-425v156h474l84 268h-558v156h606l105 335h153l-105 -335h427v-156h-476l-83 -268h559v-156z',\n\t\t'M1408 303l-1154 483v124l1154 483v-183l-889 -362l889 -362v-183zM1408 0h-1154v160h1154v-160z',\n\t\t'M1422 786l-1154 -483v183l889 362l-889 362v183l1154 -483v-124zM1422 0h-1154v160h1154v-160z'\n\t];\n\tpublic OUTLINE_X =\n\t[\n\t\t[], [291,301,505,515], [168,211,729,772,554], [195,389,917,1364,1481,1481,1288,760,312,195],\n\t\t[155,604,722,1129.8,1160,1107,722,604,278.5,191.1,162,155], [149,172.3,242,630,1687,1844.3,1960,2031.3,2055,2031.8,1962,1575,517,359.8,244,172.8],\n\t\t[115,149.4,252.5,407.6,598,1555,1287,961.3,881,757.5,601,423.5,293,213.5,187], [164,207,343,386], [181,205.5,279,554,783,783,554,279,205.5],\n\t\t[147,376,651,724.5,749,724.5,651,376,147], [167,232,588,717,1073,1137,1137,1073,717,588,232,167], [210,755,921,1466,1466,921,755,210],\n\t\t[147,293,575,321], [153,777,777,153], [253,492,492,253], [-30,143,860,684],\n\t\t[137,167.9,260.5,420.1,652,881.4,1041.5,1135.6,1167,1136.1,1043.5,883.9,652,422,262,168.3], [278,1084,1084,780,625,278],\n\t\t[161,1169,1169,1106,1073.5,976,821.3,617,387.5,198,161], [167,364,608,830.5,1007,1111,1148,1117,1080,971,821,629,399.5,210,167],\n\t\t[77,790,982,1203,1203,982,798,77], [187,378,613,843.5,1015,1119,1157,1147,251,187],\n\t\t[137,183.5,316,475,675,875.1,1041.5,1153.6,1191,1046,965,866,542,315,179.5], [154,285,499,1173,1173,154],\n\t\t[122,157.9,265.5,433.6,651,859.6,1029.5,1142.4,1180,1140,1106.8,1007,851.5,651,456.8,300,196.5,162],\n\t\t[113,258,340,438,760,988,1122.5,1167,1121,990,829,629,429.5,263,150.5], [346,585,585,346], [230,376,658,585,346], [254,1408,1408,254],\n\t\t[245,1431,1431,245], [268,1422,1422,268], [160,406,610,970,1005,973.9,880.5,733.4,541,337.5,160],\n\t\t[176,240,419,692,1037,1210,1391,1714,1829.5,1870,1813.5,1651,1391,1041,701,426,243], [26,1374,832,568],\n\t\t[200,728,983.5,1168,1281,1323,1196,1159,1040,885,641,200], [115,169,319,549.5,844,1001.5,1134,1250.5,1350,1350,1084.5,845,546.5,317,167],\n\t\t[200,576,906.5,1134,1369.5,1458,1373,1136,918.5,572,200], [200,1181,1181,200], [200,398,1045,1151,1151,200],\n\t\t[115,171,330,577,896,1175.5,1442,1442,1441,1155.5,896,570.9,323.5,167.1], [200,1339,1339,200], [137,725,725,137],\n\t\t[44,178,306,486.6,626.5,716.1,746,746,233,44], [205,1397,1366,205], [200,1142,1142,398,200], [200,1526,1526,200], [200,1336,1336,200],\n\t\t[115,163.5,302,520.5,806,1092.5,1310,1448.5,1498,1449.5,1310,1093.5,806,521.5,303,163], [200,398,1043,1139.5,1174,1127.5,996,831,604,200],\n\t\t[115,163.5,302,520.5,1010.5,1133.1,1290,1409.5,1528,1528,1498,1449.5,1310,1093.5,806,521.5,303,163], [200,1432,1130.5,1004,842,617,200],\n\t\t[134,395.5,685,941.5,1128,1241.5,1282,1222,990,702,480.3,301,182.5,143,134], [0,532,730,1262,1262,0],\n\t\t[178,213.5,330,505,749,989,1169,1285.5,1321,1321,178], [26,568,832,1374,238], [92,486,1546,1933,295], [68,1335,1336,80], [6,532,730,1254,225],\n\t\t[126,1288,1288,1266,160,126], [239,759,759,239], [70,787,960,246], [171,691,691,171], [186,383,1490,901,775], [-4,1306,1306,-4], [340,613,762,583],\n\t\t[104,130.3,209,325.5,465,1053,1053,1020,924,772.5,567,362,203], [185,679,866,1022,1128.5,1168,1139.4,1053.5,918.1,373,185],\n\t\t[105,145,258,431,653,832.5,1011,1011,841.5,653,430.1,255.5,142.6], [108,137.4,225.5,363.6,543,1091,1091,903,258,148.5],\n\t\t[106,145,262,448.5,696,904,1098,1120,1120,1089.4,997.5,849.1,649,428.6,255.5,143.4], [68,195,383,716,786,786,693.5,580,415,294,68],\n\t\t[108,225,391.5,565,798.3,962,1058.8,1091,1091,602,417,259,148.5], [185,1119,1119,1095.3,1024,373,185], [175,187,375,387,387,175],\n\t\t[-62,47.5,153,304,421,496,521,533,533,321,100,-62], [193,1199,1161,381,193], [187,375,375,187], [185,1815,1815,1793.1,1727.5,1615.9,1456,735,185],\n\t\t[185,1119,1119,1095.3,1024,907.5,748,185], [106,140.9,245.5,409.4,622,833.3,997,1102,1137,1102,997,833.3,622,409.4,245.5,140.9],\n\t\t[185,373,1019,1129,1168,1139.9,1055.5,920.6,741,185], [108,137.6,226.5,365.1,903,1091,1091,602,414,259,149.5], [185,373,882,882,816,745,185],\n\t\t[110,283.5,511,706.9,856.5,951.4,983,939,768.5,566,372.5,230,143.5,115,110], [62,211.3,278,387.5,538,649.5,765,765,377,189,62],\n\t\t[177,201.5,275,392.5,549,1111,1111,177], [61,510,699,1151,265], [86,380,1299,1590,766], [60,1152,1152,64], [61,298,499,1151,265],\n\t\t[93,995,995,978,107,93], [173,588.9,672.5,800.9,963,1113,1113,963,800.9,672.5,588.9,173], [378,552,552,378],\n\t\t[187,337,499.1,627.5,711.1,1127,1127,711.1,627.5,499.1,337,187], [187,354,1125,1290,1401,1466.5,1489,1322,551,386,274,209.5], [], [291,515,505,301],\n\t\t[159,191.6,289.5,647,765,1120,1120,765,647,292.5,192.4], [137,1163,1163,1137,997,816,630.6,484.5,389.6,182,137],\n\t\t[138,247,1058,1168,1168,1055,249,138], [108,187,557,745,1115,1191,320], [378,552,552,378],\n\t\t[172,229,404.5,575,796,965,1063,1096,1128,1071,896,725,497.5,334,235,203], [346,958,958,346],\n\t\t[159,222.4,412.5,692.1,1024,1355.9,1635.5,1825.6,1889,1825.6,1635.5,1355.9,1024,692.1,412.5,222.4],\n\t\t[151,238.5,454,944,944,920.3,849,723.5,537,368,231], [166,716,1146,1146,716,166], [210,1285,1456,1456,210], [153,777,777,153],\n\t\t[159,222.4,412.5,692.1,1024,1355.9,1635.5,1825.6,1889,1825.6,1635.5,1355.9,1024,692.1,412.5,222.4], [-4,1,1306,1306],\n\t\t[154,183,270,399.3,555,710.8,840,927,956,927.1,840.5,711.4,555,399.3,270,183], [215,1461,1461,921,755,215],\n\t\t[207,967,967,911,887.6,817.5,544,369.5,211,207], [207,363.5,540,703,834,923,956,929,904.9,832.5,561,384.5,224,207], [541,690,963,720],\n\t\t[190,378,1124,1124,190], [137,168.5,595,1106,1106,640,425.3,267,169.5], [253,492,492,253], [353,456,551,788.5,857.1,880,877,872,719,353],\n\t\t[291,299,914,914,693,558,291], [121,150.6,239.5,378.6,559,734.3,874,965.5,996,965.5,874,734.3,559,378.6,239.5,150.6], [174,604,1154,1154,604,174],\n\t\t[171,465,1694,1857,1857,1694,1410,545,408,171], [171,465,1955,1955,1890,1805.5,1410,545,408,171], [140,555,1750,1913,1913,1750,1500,448,294,155,140],\n\t\t[113,144.1,237.5,384.6,577,782,958,958,712,508,147.5], [26,1374,862,683,440], [26,1374,955,712,533], [26,1374,1033,805,578,350],\n\t\t[26,1374,1119,990,541,367,288], [26,1374,1005,806,393], [26,1374,1049,1023.6,947.5,834.6,699,564,451,374.5,349], [14,1901,1901,608],\n\t\t[115,169,548,652.5,750,990.5,1350,1350,1084.5,845,546.5,317,167], [200,1181,1181,643,400,200], [200,1181,1181,993,750,200],\n\t\t[200,1181,1181,803,576,200], [200,1181,1181,1038,426,200], [137,725,725,389,146,137], [137,725,725,482,137], [93,137,725,776,548,321],\n\t\t[126,137,725,738,738,126], [14,210,586,916.5,1144,1379.5,1468,1383,1146,929,582,210,14], [200,1336,1336,1208,1079,630,456,200],\n\t\t[115,163.5,302,520.5,806,1092.5,1310,1448.5,1498,1449.5,1310,753,510,163], [115,163.5,302,520.5,806,1092.5,1310,1448.5,1498,1449.5,1083,840,303,163],\n\t\t[115,163.5,302,520.5,806,1092.5,1310,1448.5,1498,1449.5,1136,908,681,453,163],\n\t\t[115,163.5,302,520.5,806,1092.5,1310,1448.5,1498,1449.5,1207,1078,629,455,163],\n\t\t[112,160.5,299,517.5,803,1089.5,1307,1445.5,1495,1446.5,1108,909,496,160], [291,402,1274,1385,1385,1274,402,291],\n\t\t[115,120,252,1092.5,1310,1448.5,1498,1474,1342,806,521.5,303,163], [178,213.5,330,505,749,989,1169,1285.5,1321,1321,753,510,178],\n\t\t[178,213.5,330,505,749,989,1169,1285.5,1321,1321,1073,830,178], [178,213.5,330,505,749,989,1169,1285.5,1321,1321,856,629,178],\n\t\t[178,213.5,330,505,749,989,1169,1285.5,1321,1321,1056,444,178], [6,532,730,1254,935,692], [200,398,1044,1139,1174,1127,997,398,200],\n\t\t[185,675,873.1,1029.5,1131.1,1165,1066,1037.4,951.5,819.9,654,470.5,321,221,185], [104,130.3,209,325.5,465,1053,1053,1020,559,316,203],\n\t\t[104,130.3,209,325.5,465,1053,1053,934,691,203], [104,130.3,209,325.5,465,1053,1053,961,733,506,278,203],\n\t\t[104,130.3,209,325.5,465,1053,1053,1038,909,460,286,207], [104,130.3,209,325.5,465,1053,1053,926,314,203],\n\t\t[104,130.3,209,325.5,465,1053,1053,956,930.6,854.5,741.6,606,471,358,281.5,256],\n\t\t[104,130.4,209.5,326.1,465,1433,1648.5,1833,1855,1855,1823.6,1729.5,1581.1,1387,564,360,202],\n\t\t[105,145,353,456,551,788.5,857.1,1011,1011,841.5,653,430.1,255.5,142.6], [106,145,262,448.5,696,904,1098,1120,1120,1089.4,997.5,580,337,143.4],\n\t\t[106,145,262,448.5,696,904,1098,1120,1120,1089.4,960,717,255.5,143.4], [106,145,262,448.5,696,904,1098,1120,1120,1089.4,986,758,531,303,143.4],\n\t\t[106,145,262,448.5,696,904,1098,1120,1120,1089.4,951,339,143.4], [-21,187,375,401,222], [160,187,375,582,339], [-11,187,375,572,394,167],\n\t\t[5,187,375,557,557,5], [106,140.6,244.5,405.6,612,828.3,995,1101.5,1137,1004,938,263], [185,1119,1119,1075,946,497,323,244,185],\n\t\t[106,140.9,245.5,409.4,622,833.3,997,1102,1137,1102,997,553,310,140.9], [106,140.9,245.5,409.4,622,833.3,997,1102,1137,1102,933,690,245.5,140.9],\n\t\t[106,140.9,245.5,409.4,622,833.3,997,1102,1137,1102,963,735,508,280,140.9], [106,140.9,245.5,409.4,622,833.3,997,1102,1137,1038,909,460,286,207],\n\t\t[106,140.9,245.5,409.4,622,833.3,997,1102,1137,1102,928,729,316,140.9], [210,719,957,1466,1466,957,719,210],\n\t\t[93,203,833.3,997,1102,1137,1132,1021,409.4,245.5,140.9,106], [177,201.5,275,392.5,549,1111,1111,585,342,177],\n\t\t[177,201.5,275,392.5,549,1111,1111,945,702,177], [177,201.5,275,392.5,549,1111,1111,757,530,177], [177,201.5,275,392.5,549,1111,1111,955,343,177],\n\t\t[61,298,499,1151,928,685], [185,373,1019,1129,1168,1139.9,1055.5,920.6,373,185], [230,376,658,585,346], [530,579,724,773],\n\t\t[256,588,716,1048,1048,765,539,256], [7,26,1374,832], [346,585,585,346], [0,49,443,1424,1424,443], [0,49,443,1582,1582,443], [0,49,380,968,968,380],\n\t\t[0,49,354.5,493,711.5,997,1283.5,1501,1639.5,1689,1640.5,1501,1284.5,997], [0,49,815,1013,1537,289],\n\t\t[0,49,291,1751,1751,1701,1654.1,1513.5,1296.6,1021], [-53,187,375,615,615,379,183,-53], [26,1374,832,568],\n\t\t[200,728,983.5,1168,1281,1323,1196,1159,1040,885,641,200], [200,398,1162,1162,200], [26,1414,852,588], [200,1181,1181,200],\n\t\t[126,1288,1288,1266,160,126], [200,1339,1339,200], [115,163.5,302,520.5,806,1092.5,1310,1448.5,1498,1449.5,1310,1093.5,806,521.5,303,163],\n\t\t[137,725,725,137], [205,1397,1366,205], [26,1378,822,582], [200,1526,1526,200], [200,1336,1336,200], [114,1215,1215,114],\n\t\t[115,163.5,302,520.5,806,1092.5,1310,1448.5,1498,1449.5,1310,1093.5,806,521.5,303,163], [200,1339,1339,200],\n\t\t[200,398,1043,1139.5,1174,1127.5,996,831,604,200], [118,1280,1280,1234,138,118], [0,532,730,1262,1262,0], [6,532,730,1254,225],\n\t\t[105,149.5,273,740,937,1404,1527.5,1572,1528.5,1410,937,740,267,148], [68,1335,1336,80], [179,219.5,338,793,990,1446,1563.5,1604,1604,179],\n\t\t[108,1568,1568,1518,1471.1,1330.5,1113.6,838,562.4,345.5,204.9,158,108], [126,137,725,738,738,126], [6,532,730,1254,939,740,327],\n\t\t[108,137.4,225.5,363.6,543,1091,1091,743,500,148.5], [109,152.5,265,417,578,796,1006,1006,961,721,478,191.5,144],\n\t\t[185,931,1119,1119,1095.3,802,559,185], [160,187,375,403], [177,207.8,300,448,646,846,994,1085.5,1116,1116,1043,760,534,251,177],\n\t\t[108,137.4,225.5,363.6,543,1091,1091,604,416.5,258,148.5], [185,373,1030.5,1131.4,1165,1084,1050,959,825.5,661,462.1,311.5,216.6,185],\n\t\t[61,506,694,1151,265], [106,140.6,244.5,408.6,624,837.1,1000.5,1104.4,1139,1049,239],\n\t\t[109,152.5,265,417,578,796,1006,1006,961,789,609,449,304,191.5,144], [108,135.8,219,646,825,937,982,942,198],\n\t\t[185,931,1119,1119,1095.3,1024,907.5,748,185], [137,159.5,219,382,639,896,1059,1118,1141,1118,1058,895.5,639,382.5,220,159.5], [187,375,375,187],\n\t\t[193,1192,1122,1085,1027,193], [61,1151,522,311], [185,373,1125,1125,185], [61,510,699,1151,265], [104,138.5,239,704,884,995.5,1041,957,133],\n\t\t[106,140.9,245.5,409.4,622,833.3,997,1102,1137,1102,997,833.3,622,409.4,245.5,140.9], [185,1120,1120,185],\n\t\t[185,373,1033.5,1137.4,1172,1140,1044,887.3,673,477.5,322,220.5,185], [105,146.5,261,685,862,971,1018,986,839,675,441.9,260.5,143.9],\n\t\t[106,140.5,244,407.8,623,832.9,996.5,1101.9,1295,1295,625,412,247,141.3], [10,414,602,1006,1006,10],\n\t\t[177,207.8,300,448,646,846,994,1085.5,1116,1116,177], [104,151,283,715,902,1342.5,1471.1,1514,1470.4,1339.5,1132.6,861,784.5,714,355,163],\n\t\t[48,1160,1149,59], [176,223.5,748,935,1459,1507,1507,176], [113,136.5,211,343.5,538,1128,1321.5,1455,1529.5,1553,1496,1295,371,170],\n\t\t[5,187,375,557,557,5], [177,207.8,300,448,646,846,994,1085.5,1116,1116,953,341,177],\n\t\t[106,140.9,245.5,409.4,622,833.3,997,1102,1137,1102,743,500,140.9], [177,207.8,300,448,646,846,994,1085.5,1116,1116,768,525,177],\n\t\t[113,136.5,211,343.5,538,1128,1321.5,1455,1529.5,1553,1496,955,712,170],\n\t\t[149,179.4,270.5,409.6,584,798.5,985,1106,1145,1130.5,1074,909.5,670,473.5,292], [50,1438,876,612], [144,344,1332,1532,1532,144],\n\t\t[187,1369,1369,1330,197,187], [220,1456,1456,220], [-102,63,843,678], [253,492,492,253], [134,755,857,1737,1570,134],\n\t\t[161,189.3,274,406.5,578,1435,1620.9,1764.5,1856.4,1887,1858.8,1774,1641.5,1470,613,430.3,286,192.3],\n\t\t[138,241.5,348,515.3,641,719,1168,1168,1063,954,786.3,661,583,138], [243,400,1070,1214,1320,1432,1431,1274,604,462.4,355.5,243],\n\t\t[245,566,719,1431,1431,1109,956,245], [254,1408,1408,254], [268,1422,1422,268]\n\t];\n\tpublic OUTLINE_Y =\n\t[\n\t\t[], [1489,0,0,1489], [1556,977,977,1556,1556], [421,0,0,421,932,1067,1489,1489,1067,556],\n\t\t[85,-361,-361,238.1,380,1231,1576,1576,1185,1071.5,935,283], [1075,880.5,743,0,-29,-1.8,80,217.8,413,607.5,745,1489,1517,1489.8,1408,1270.3],\n\t\t[409,230.9,90.5,-0.6,-31,0,909,1333.4,1432.5,1498.1,1520,1490,1412,1301.5,1174], [1556,977,977,1556], [572,286.3,31,-412,-412,1556,1556,1113,857.8],\n\t\t[-412,-412,31,286.3,572,857.8,1113,1556,1556], [886,776,630,630,777,887,1299,1409,1556,1556,1410,1300], [572,27,27,572,732,1277,1277,732],\n\t\t[-370,-370,285,285], [561,561,742,742], [0,0,285,285], [-304,-304,1556,1556],\n\t\t[743,400,159,16.5,-31,15.9,156.5,397.4,745,1084.9,1326.5,1470.9,1519,1471.6,1329.5,1088.1], [0,0,152,1494,1494,1286],\n\t\t[0,0,171,1110,1279.4,1409.5,1492.4,1520,1491,1427,209], [63,-1.5,-31,2.5,106,254,441,1161,1320,1436,1500,1520,1490.5,1426,272],\n\t\t[419,0,0,419,579,1489,1489,649], [56,-5.5,-31,6.5,114,274,473,1489,1489,267],\n\t\t[654,324,104,3,-31,4.9,112.5,276.9,483,1494,1512,1517,1453.5,1277,1005], [1314,0,0,1266,1489,1489],\n\t\t[411,233.5,91,-2.8,-34,-2,94,238.3,415,1144,1294.5,1416,1496.3,1523,1495,1411,1285,1131],\n\t\t[1005,-6,-23.5,-29,33,209,480,834,1171.5,1385,1485.5,1519,1483.3,1376,1211.8], [0,0,1117,1117], [-370,-370,285,1117,1117], [590,77,1227,714],\n\t\t[362,362,942,942], [77,590,714,1227], [1245,0,0,964.5,1139,1293.4,1414.5,1492.9,1519,1497.5,1449],\n\t\t[647,291,15,-162.5,-226,-218.5,-190,157,394,663,1013.5,1283,1457,1519,1452,1268,991.5], [0,0,1489,1489],\n\t\t[0,0,28,122,262,458,1155,1316.5,1427,1477,1489,1489], [743,402.5,161,18.5,-27,-13.5,19,63,108,1385,1487,1516,1465,1317,1072],\n\t\t[0,0,28,119,375,743,1118,1371,1457.5,1489,1489], [0,0,1489,1489], [0,0,717,1313,1489,1489],\n\t\t[746,405.5,163,19,-29,12.5,110,749,1382,1485.5,1516,1464.4,1309.5,1065.4], [0,0,1489,1489], [0,0,1489,1489],\n\t\t[8,-12.5,-21,5.5,85,213.5,387,1489,1489,193], [0,0,1489,1489], [0,0,176,1489,1489], [0,0,1489,1489], [0,0,1489,1489],\n\t\t[744,415,172,21,-31,20,172,414.5,744,1073,1318,1467.5,1520,1468,1318,1070.5], [0,0,709,855.5,1039,1254,1396,1466.5,1489,1489],\n\t\t[744,415,172,21,-297.5,-369.1,-393,-386.5,-365,-183,744,1073,1318,1467.5,1520,1468,1318,1070.5], [0,0,1280.5,1409,1471.5,1489,1489],\n\t\t[92,3,-27,9,109,253,425,1412,1486,1516,1486.1,1396.5,1260.1,1090,340], [1313,0,0,1313,1489,1489], [598,313,115,6,-31,4,115,315.5,598,1489,1489],\n\t\t[1489,0,0,1489,1489], [1489,0,0,1489,1489], [0,0,1489,1489], [1489,0,0,1489,1489], [0,0,176,1489,1489,184], [-392,-392,1556,1556],\n\t\t[1556,-304,-304,1556], [-392,-392,1556,1556], [682,682,684,1489,1489], [-300,-300,-180,-180], [1676,1302,1302,1676],\n\t\t[324,182.8,69,-6,-31,0,758,939,1058,1124.5,1144,1126,1093], [0,-31,8.5,127,315,567,812.8,996,1110,1556,1556],\n\t\t[557,300,118,10.5,-25,0,70,1050,1116,1143,1104,987,801.5], [550,306.8,123,7.5,-31,0,1556,1556,992,803],\n\t\t[552,306.6,124.5,11.6,-26,1,68,539,641,856.3,1016,1115,1148,1107.8,987,797.8], [959,0,0,959,1374,1546,1560,1566,1539.4,1459.5,1117],\n\t\t[569,-375,-410.5,-423,-389.8,-290,-119.3,127,1117,1148,1108.5,998,817.5], [0,0,725,906,1039,1556,1556], [1304,0,0,1304,1499,1499],\n\t\t[-395,-415,-423,-398,-323,-199,-27,1304,1499,1499,1117,-216], [0,0,1117,1556,1556], [0,0,1556,1556], [0,0,725,902.9,1036.5,1120.1,1148,1148,1117],\n\t\t[0,0,725,906,1039,1120.8,1148,1117], [558,313.8,127,8.5,-31,8.5,127,313.8,558,802.4,989.5,1108.4,1148,1108.4,989.5,802.4],\n\t\t[-412,-412,133,323.5,572,813.4,995.5,1109.9,1148,1117], [555,314.1,131.5,16.4,-412,-412,1117,1148,1108,995,809.5], [0,0,912,1105,1114.5,1117,1117],\n\t\t[67,2.5,-27,-2.5,71,182.8,322,1060,1119.5,1144,1116.5,1042,933,803,278], [959,189.8,70,1,-22,-13,10,1117,1438,1438,1117],\n\t\t[392,209.1,76.5,-4.1,-31,0,1117,1117], [1117,0,0,1117,1117], [1117,0,0,1117,1117], [0,0,1117,1117], [1117,-412,-412,1117,1117],\n\t\t[0,0,159,1117,1117,139], [504,-170.9,-292.5,-367.1,-392,-392,1556,1556,1531.1,1456.5,1334.9,660], [-392,-392,1556,1556],\n\t\t[-392,-392,-367.1,-292.5,-170.9,504,660,1334.9,1456.5,1531.1,1556,1556], [395,395,396,440,561,732,927,927,926,880.5,761,589.5], [], [0,0,1489,1489],\n\t\t[557,333.5,163,-361,-361,74,1046,1475,1475,948.5,775.9], [0,0,171,1467,1501,1518,1485.9,1389.5,1243.1,751,207],\n\t\t[258,145,147,257,1067,1176,1176,1066], [1489,426,0,0,426,1489,1489], [-392,-392,1556,1556],\n\t\t[533,-327,-371.5,-385,-358,-275,-156,-10,601,1462,1505,1519,1490,1411,1293.5,1147], [1304,1304,1499,1499],\n\t\t[655,323.1,43.5,-146.6,-210,-146.6,43.5,323.1,655,986.9,1266.5,1456.6,1520,1456.6,1266.5,986.9],\n\t\t[833,616,531,554,1192,1332.4,1435.5,1498.9,1520,1504,1475], [608,162,191,1113,1142,697], [602,57,57,762,762], [561,561,742,742],\n\t\t[655,323.1,43.5,-146.6,-210,-146.6,43.5,323.1,655,986.9,1266.5,1456.6,1520,1456.6,1266.5,986.9], [1788,1668,1668,1788],\n\t\t[1116,960.4,831.5,744.9,716,745,832,961,1116,1271,1400,1487,1516,1487,1400,1271], [179,179,917,1462,1462,917],\n\t\t[566,566,711,1237,1350.4,1440.5,1519,1501.5,1458,722], [585,542,527,543.5,595,685.5,817,1278,1374.5,1452,1520,1502.5,1458,764],\n\t\t[1302,1302,1676,1676], [-412,-412,0,1117,1117], [1050,866,-363,-363,1489,1489,1460,1373,1234.3], [511,511,794,794],\n\t\t[-397,-416,-423,-337,-232,-89,-25,20,20,-237], [1256,566,566,688,1493,1493,1368],\n\t\t[1025,820.1,663.5,564.1,531,563.4,660.5,816.4,1025,1233.8,1390,1487.5,1520,1486.8,1387,1230], [191,162,608,697,1142,1113],\n\t\t[1246,0,0,220,353,944,1489,1493,1493,1363], [1246,0,0,139,664,865,1489,1493,1493,1363], [598,0,0,220,353,944,1489,1517,1500,1456,773],\n\t\t[350,195.6,74.5,-3.9,-30,-10,40,244,1489,1489,523], [0,0,1675,2049,2049], [0,0,2049,2049,1675], [0,0,1670,2049,2049,1670],\n\t\t[0,0,1992,1992,1987,1910,1682], [0,0,1872,1872,1872], [0,0,1712,1843.5,1952,2024.8,2049,2024.8,1952,1843.5,1712], [0,0,1489,1489],\n\t\t[743,402.5,-397,-416,-423,-337,108,1385,1487,1516,1465,1317,1072], [0,0,1489,2049,2049,1489], [0,0,1489,2049,2049,1489], [0,0,1489,2049,2049,1489],\n\t\t[0,0,1489,1872,1872,1489], [0,0,1489,2049,2049,1489], [0,0,2049,2049,1489], [1670,0,0,1670,2049,2049], [1677,0,0,1677,1872,1872],\n\t\t[740,0,0,28,119,375,743,1118,1371,1457.5,1489,1489,883], [0,0,1489,1992,1992,1987,1910,1489],\n\t\t[744,415,172,21,-31,20,172,414.5,744,1073,1318,2049,2049,1070.5], [744,415,172,21,-31,20,172,414.5,744,1073,2049,2049,1318,1070.5],\n\t\t[744,415,172,21,-31,20,172,414.5,744,1073,1670,2049,2049,1670,1070.5], [744,415,172,21,-31,20,172,414.5,744,1073,1992,1992,1987,1910,1070.5],\n\t\t[744,415,172,21,-31,20,172,414.5,744,1073,1872,1872,1872,1070.5], [216,105,105,216,1088,1199,1199,1088],\n\t\t[744,-146,-146,20,172,414.5,744,1611,1611,1520,1468,1318,1070.5], [598,313,115,6,-31,4,115,315.5,598,1489,2049,2049,1489],\n\t\t[598,313,115,6,-31,4,115,315.5,598,1489,2049,2049,1489], [598,313,115,6,-31,4,115,315.5,598,1489,2049,2049,1489],\n\t\t[598,313,115,6,-31,4,115,315.5,598,1489,1872,1872,1489], [1489,0,0,1489,2049,2049], [0,0,469,610.5,787,992,1130,1489,1489],\n\t\t[0,-24,12.4,121.5,284.1,481,1241,1376,1479,1544.3,1566,1536.5,1449,1295.5,1080], [324,182.8,69,-6,-31,0,758,939,1676,1676,1093],\n\t\t[324,182.8,69,-6,-31,0,758,1676,1676,1093], [324,182.8,69,-6,-31,0,758,1297,1676,1676,1297,1093],\n\t\t[324,182.8,69,-6,-31,0,758,1619,1619,1614,1537,1309], [324,182.8,69,-6,-31,0,758,1499,1499,1093],\n\t\t[324,182.8,69,-6,-31,0,758,1630,1761.8,1871,1944.5,1969,1944.5,1871,1761.8,1630],\n\t\t[317,178.8,68,-4.8,-29,-26,3.5,68,559,641,861.3,1020,1116,1148,1146,1127,1093], [557,300,-397,-416,-423,-337,-232,70,1050,1116,1143,1104,987,801.5],\n\t\t[552,306.6,124.5,11.6,-26,1,68,539,641,856.3,1016,1676,1676,797.8], [552,306.6,124.5,11.6,-26,1,68,539,641,856.3,1676,1676,987,797.8],\n\t\t[552,306.6,124.5,11.6,-26,1,68,539,641,856.3,1297,1676,1676,1297,797.8], [552,306.6,124.5,11.6,-26,1,68,539,641,856.3,1499,1499,797.8],\n\t\t[1676,0,0,1302,1676], [1302,0,0,1676,1676], [1297,0,0,1297,1676,1676], [1304,0,0,1304,1499,1499],\n\t\t[484,266.5,104,2.8,-31,12,141,351,637,1469,1566,1556], [0,0,725,1619,1619,1614,1537,1309,1117],\n\t\t[558,313.8,127,8.5,-31,8.5,127,313.8,558,802.4,989.5,1676,1676,802.4], [558,313.8,127,8.5,-31,8.5,127,313.8,558,802.4,1676,1676,989.5,802.4],\n\t\t[558,313.8,127,8.5,-31,8.5,127,313.8,558,802.4,1297,1676,1676,1297,802.4], [558,313.8,127,8.5,-31,8.5,127,313.8,558,1619,1619,1614,1537,1309],\n\t\t[558,313.8,127,8.5,-31,8.5,127,313.8,558,802.4,1499,1499,1499,802.4], [572,7,7,572,732,1297,1297,732],\n\t\t[-148,-148,8.5,127,313.8,558,1241,1241,1108.4,989.5,802.4,558], [392,209.1,76.5,-4.1,-31,0,1117,1676,1676,1117],\n\t\t[392,209.1,76.5,-4.1,-31,0,1117,1676,1676,1117], [392,209.1,76.5,-4.1,-31,0,1117,1676,1676,1117], [392,209.1,76.5,-4.1,-31,0,1117,1499,1499,1117],\n\t\t[1117,-412,-412,1117,1676,1676], [-412,-412,133,323.5,572,813.4,995.5,1109.9,1556,1556], [-370,-370,285,1117,1117], [1676,1292,1292,1676],\n\t\t[1304,1292,1292,1304,1499,1676,1676,1499], [1489,0,0,1489], [832,832,1117,1117], [1489,1105,0,0,1489,1489], [1489,1105,0,0,1489,1489],\n\t\t[1489,1105,0,0,1489,1489], [1489,1105,415,172,21,-31,20,172,414.5,744,1073,1318,1467.5,1520], [1489,1105,0,0,1489,1489],\n\t\t[1489,1105,0,0,174,894,1144.8,1345,1476.3,1520], [1304,0,0,1304,1499,1676,1676,1499], [0,0,1489,1489],\n\t\t[0,0,28,122,262,458,1155,1316.5,1427,1477,1489,1489], [0,0,1313,1489,1489], [0,0,1489,1489], [0,0,1489,1489], [0,0,176,1489,1489,184],\n\t\t[0,0,1489,1489], [744,415,172,21,-31,20,172,414.5,744,1073,1318,1467.5,1520,1468,1318,1070.5], [0,0,1489,1489], [0,0,1489,1489], [0,0,1489,1489],\n\t\t[0,0,1489,1489], [0,0,1489,1489], [0,0,1489,1489], [744,415,172,21,-31,20,172,414.5,744,1073,1318,1467.5,1520,1468,1318,1070.5], [0,0,1489,1489],\n\t\t[0,0,709,855.5,1039,1254,1396,1466.5,1489,1489], [0,0,176,1489,1489,184], [1313,0,0,1313,1489,1489], [1489,0,0,1489,1489],\n\t\t[755,507,325,-16,-16,325,506.5,755,994,1171,1505,1505,1171,993], [0,0,1489,1489], [910,647,471,0,0,471,645.5,910,1489,1489],\n\t\t[0,0,174,894,1144.8,1345,1476.3,1520,1476.3,1345,1144.8,894,174], [1677,0,0,1677,1872,1872], [1489,0,0,1489,1872,1872,1872],\n\t\t[550,306.8,123,7.5,-31,0,1117,1676,1676,803], [306,148.5,46,-10,-26,-5,64,270,1083,1676,1676,986.5,839], [0,-412,-412,725,906,1676,1676,1117],\n\t\t[1676,0,0,1676], [407,213.6,77.5,-3.1,-30,-2.6,79.5,216.1,407,1117,1499,1676,1676,1499,1117], [550,306.8,123,7.5,-31,0,1117,1148,1108,992,803],\n\t\t[-412,-412,110,259.5,444,1195,1355,1467,1534.5,1556,1524.3,1429,1277.8,1078], [1117,-412,-412,1117,1117],\n\t\t[534,299.6,120.5,6.9,-31,7.8,124,308.3,551,1556,1556], [306,148.5,46,-10,-26,-5,64,270,1083,1127.5,1144,1128,1079,986.5,839],\n\t\t[463,262.3,118,-412,-412,-264.5,-96,1556,1556], [0,-412,-412,725,906,1039,1120.8,1148,1117],\n\t\t[768,451.5,241,37.5,-31,37.5,241,451.5,768,1073,1288,1487,1556,1487,1288,1073.5], [0,0,1117,1117], [0,0,1117,1118,1119,1117], [0,0,1556,1556],\n\t\t[-412,-412,0,1117,1117], [1117,0,0,1117,1117], [412,248.5,113,-412,-412,-265,-96,1556,1556],\n\t\t[558,313.8,127,8.5,-31,8.5,127,313.8,558,802.4,989.5,1108.4,1148,1108.4,989.5,802.4], [0,0,1117,1117],\n\t\t[-412,-412,148.5,340.9,577,821.5,1001,1111.3,1148,1115,1020,861.5,646], [549,299,129,-412,-412,-268,-96,1079,1124.5,1143,1102.5,981,792],\n\t\t[558,313.8,127,8.5,-31,7.5,123,308.8,952,1117,1148,1108.6,990.5,803.6], [952,0,0,952,1117,1117],\n\t\t[407,213.6,77.5,-3.1,-30,-2.6,79.5,216.1,407,1117,1117], [546,314,142,-412,-412,159,342.3,576,816.6,996.5,1108.6,1146,1145.5,1143,1117,842],\n\t\t[-412,-412,1117,1117], [446,248.5,-412,-412,248,446,1117,1117], [503,310.5,139,16.5,-30,-30,14.5,139,310.5,503,811.5,1117,1117,811.5],\n\t\t[1304,0,0,1304,1499,1499], [407,213.6,77.5,-3.1,-30,-2.6,79.5,216.1,407,1117,1499,1499,1117],\n\t\t[558,313.8,127,8.5,-31,8.5,127,313.8,558,802.4,1676,1676,802.4], [407,213.6,77.5,-3.1,-30,-2.6,79.5,216.1,407,1117,1676,1676,1117],\n\t\t[503,310.5,139,16.5,-30,-30,14.5,139,310.5,503,811.5,1676,1676,811.5], [424,240.1,94.5,-0.4,-32,17,190,493,837,1097,1286,1464.5,1519,1496.5,1430],\n\t\t[0,0,1489,1489], [1315,-193,-193,1315,1489,1489], [-189,-189,-13,1489,1489,2], [572,572,732,732], [0,0,1489,1489], [511,511,794,794],\n\t\t[842,-151,-151,1788,1788,981], [642,447.6,292.5,190.9,157,157,190.4,290.5,450.4,663,857.4,1012.5,1114.1,1148,1148,1114.5,1014,854],\n\t\t[-402,-417.5,-423,-395.5,-313,-179.8,1367,1545,1560.5,1566,1538.5,1456,1321.8,-224], [202,202,209,233.4,306.5,588,1104,1104,1097,1072.5,999,719],\n\t\t[362,27,27,362,942,1277,1277,942], [0,0,1393,910], [0,0,910,1393]\n\t];\n\tpublic KERN_C1 =\n\t[\n\t\t'\\'', '\\'', '-', '-', '-', '-', '-', '-', '-', '-', '-', '-', '-', '-', '-', '-', '-', '-', '-', '-', '.', '.', 'A', 'A', 'A', 'A', 'A', 'A', 'A',\n\t\t'A', 'A', 'A', 'A', 'A', 'B', 'B', 'B', 'B', 'C', 'D', 'D', 'D', 'D', 'D', 'D', 'D', 'F', 'F', 'F', 'F', 'F', 'F', 'F', 'F', 'F', 'F', 'F', 'F', 'F',\n\t\t'I', 'J', 'J', 'J', 'J', 'K', 'K', 'K', 'K', 'K', 'K', 'K', 'K', 'K', 'K', 'K', 'K', 'L', 'L', 'L', 'L', 'L', 'L', 'L', 'L', 'L', 'L', 'L', 'L', 'L',\n\t\t'L', 'O', 'O', 'O', 'O', 'O', 'O', 'P', 'P', 'P', 'P', 'P', 'P', 'P', 'P', 'P', 'P', 'Q', 'Q', 'R', 'R', 'R', 'R', 'R', 'R', 'R', 'R', 'R', 'R', 'S',\n\t\t'S', 'S', 'S', 'S', 'S', 'S', 'S', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T',\n\t\t'T', 'T', 'T', 'T', 'T', 'T', 'U', 'U', 'U', 'U', 'V', 'V', 'V', 'V', 'V', 'V', 'V', 'V', 'V', 'V', 'V', 'V', 'V', 'V', 'W', 'W', 'W', 'W', 'W', 'W',\n\t\t'W', 'W', 'W', 'W', 'W', 'W', 'W', 'W', 'W', 'X', 'X', 'X', 'X', 'X', 'X', 'X', 'X', 'X', 'X', 'X', 'X', 'X', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y',\n\t\t'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Z', 'Z', 'Z', 'Z', 'Z', 'Z', 'Z', 'Z', 'Z', 'Z', 'Z', 'Z', 'Z', 'Z',\n\t\t'a', 'a', 'a', 'b', 'b', 'b', 'c', 'c', 'e', 'f', 'f', 'f', 'f', 'f', 'f', 'f', 'f', 'f', 'f', 'f', 'f', 'h', 'h', 'h', 'k', 'k', 'k', 'k', 'm', 'm',\n\t\t'm', 'n', 'n', 'n', 'o', 'o', 'o', 'o', 'o', 'p', 'p', 'p', 'r', 'r', 'r', 'r', 'r', 't', 't', 'v', 'v', 'v', 'v', 'v', 'v', 'v', 'v', 'w', 'w', 'w',\n\t\t'w', 'w', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'y', 'y', 'y', 'y', 'y', 'y', 'y', 'y', 'y', 'y', 'y', 'y', 'y', 'z', 'z', 'z', 'z', 'z', 'z', 'z',\n\t\t'z', 'z', '\\u00C7', '\\u00E7', '\\u00D8', '\\u00D8', '\\u00D8', '\\u00D8', '\\u00D8', '\\u00D8', '\\u00F8', '\\u00F8', '\\u00F8', '\\u00F8', '\\u00F8'\n\t];\n\tpublic KERN_C2 =\n\t[\n\t\t'\\u00C6', 'A', '\\u00E6', '\\u00C6', 'z', 'y', 'x', 'w', 'v', 'a', 'Z', 'Y', 'X', 'W', 'V', 'T', 'S', 'J', 'I', 'A', '-', ',', 'y', 'w', 'v', 'u', 't',\n\t\t'Y', 'W', 'V', 'U', 'T', 'S', '-', 'T', '.', '-', ',', '-', 'Z', 'Y', 'X', 'W', 'T', '.', ',', '\\u00F8', '\\u00E6', '\\u00C6', 'o', 'e', 'a', 'T', 'A',\n\t\t'?', ';', ':', '.', ',', '-', '\\u00C6', 'A', '.', ',', '\\u00F8', '\\u00E6', '\\u00D8', 'y', 'w', 'v', 'u', 'o', 'e', 'a', 'O', '-', '\\u00D8', '\\u00C7',\n\t\t'y', 'v', 'Y', 'W', 'V', 'T', 'O', 'J', 'G', 'C', '-', '\\'', 'Z', 'Y', 'X', 'T', '.', ',', '\\u00F8', '\\u00E6', '\\u00C6', 'o', 'e', 'a', 'Y', 'A',\n\t\t'.', ',', '.', ',', '\\u00F8', '\\u00E6', 'y', 'u', 'o', 'e', 'a', 'Y', 'T', '-', '\\u00C6', 'y', 'w', 'v', 'S', 'A', '.', ',', '\\u00F8', '\\u00E6',\n\t\t'\\u00D8', '\\u00C6', '\\u00C7', 'z', 'y', 'w', 'v', 'u', 's', 'r', 'o', 'g', 'e', 'c', 'a', 'T', 'S', 'O', 'G', 'C', 'A', '?', ';', ':', '.', '-', ',',\n\t\t'\\u00C6', 'A', '.', ',', '\\u00F8', '\\u00E6', '\\u00C6', 'y', 'u', 'o', 'e', 'a', 'A', ';', ':', '.', '-', ',', '\\u00F8', '\\u00E6', '\\u00C6', 'y', 'u',\n\t\t'r', 'o', 'e', 'a', 'A', ';', ':', '.', '-', ',', '\\u00F8', '\\u00E6', '\\u00D8', '\\u00C7', 'y', 'u', 'o', 'e', 'a', 'O', 'G', 'C', '-', '\\u00F8',\n\t\t'\\u00E6', '\\u00D8', '\\u00C6', 'v', 'u', 's', 'r', 'q', 'p', 'o', 'n', 'm', 'g', 'e', 'd', 'a', 'O', 'A', ';', ':', '.', '-', ',', '\\u00F8', '\\u00E6',\n\t\t'\\u00D8', '\\u00C7', 'y', 'w', 'o', 'e', 'a', 'Z', 'O', 'G', 'C', '-', 'y', 'w', 'v', 'y', '.', ',', 'T', '-', 'T', '}', 'y', ']', '\\\\', '?', '.',\n\t\t'-', ',', '*', ')', '\\'', '\"', 'y', 'w', 'v', '\\u00F8', 'o', 'e', '-', 'y', 'w', 'v', 'y', 'w', 'v', 'y', 'x', 'v', '.', ',', 'y', '.', ',',\n\t\t'\\u00E6', 'a', '.', '-', ',', 'y', '-', '\\u00F8', '\\u00E6', 'o', 'e', 'a', '.', '-', ',', '\\u00E6', 'a', '.', '-', ',', '\\u00F8', '\\u00E7', 'o', 'g',\n\t\t'e', 'd', 'c', '-', '\\u00F8', '\\u00E6', '\\u00E7', 'q', 'o', 'g', 'e', 'd', 'c', 'a', '.', '-', ',', '\\u00F8', '\\u00E7', 'q', 'o', 'g', 'e', 'd', 'c',\n\t\t'-', '-', '-', 'Z', 'Y', 'X', 'T', '.', ',', 'y', 'x', 'v', '.', ','\n\t];\n\tpublic KERN_K =\n\t[\n\t\t100, 100, 20, 50, 40, 40, 50, 20, 40, 20, 30, 140, 80, 50, 50, 150, 20, 100, 30, 50, 160, 130, 50, 30, 50, 10, 20, 80, 50, 60, 10, 120, 10, 50, 60,\n\t\t20, -10, 20, 50, 20, 20, 10, 20, 50, 50, 50, 50, 100, 110, 50, 50, 100, -30, 100, -60, 60, 60, 300, 300, 30, 10, 10, 20, 20, 70, 60, 20, 80, 70, 80,\n\t\t50, 70, 70, 60, 20, 110, 20, 20, 110, 110, 160, 100, 110, 170, 20, -100, 20, 20, 160, 120, 20, 20, 10, 50, 30, 30, 50, 50, 70, 50, 50, 50, -20, 50,\n\t\t300, 300, 30, 30, 50, 50, 55, 20, 50, 50, 40, 20, 60, 100, 20, 30, 20, 30, 22, 20, 20, 20, 220, 240, 50, 130, 40, 170, 200, 200, 200, 200, 180, 200,\n\t\t220, 210, 220, 220, 240, 70, 12, 50, 40, 40, 120, -60, 200, 200, 290, 150, 290, 20, 10, 20, 20, 100, 100, 70, 65, 60, 100, 100, 100, 60, 80, 80, 290,\n\t\t50, 290, 100, 100, 60, 65, 60, 60, 100, 100, 100, 50, 80, 80, 220, 50, 290, 60, 50, 10, 10, 80, 30, 60, 60, 50, 10, 10, 10, 80, 130, 140, 20, 80,\n\t\t100, 110, 110, 100, 130, 100, 130, 100, 100, 130, 130, 120, 140, 20, 80, 200, 200, 290, 140, 290, 60, 50, 20, 20, 65, 40, 60, 60, 50, 10, 20, 20, 20,\n\t\t60, 16, 10, 16, 5, 20, 30, 60, 20, 140, -100, 10, -100, -100, -110, 120, 50, 130, -50, -100, -60, -60, 20, 10, 20, 20, 20, 20, 100, 20, 10, 20, 20,\n\t\t10, 20, 15, 20, 15, 20, 30, 5, 20, 30, 40, 36, 290, 20, 290, 10, 40, 18, 40, 18, 18, 40, 180, 40, 180, 20, 20, 70, 20, 70, 24, 20, 24, 10, 24, 10,\n\t\t20, 50, 18, 40, 18, 10, 18, 10, 18, 10, 18, 40, 190, 40, 190, 12, 10, 10, 12, 10, 12, 10, 10, 20, 50, 20, 20, 20, 10, 50, 30, 30, 15, 20, 15, 20, 30\n\t];\n\n\tconstructor()\n\t{\n\t\tfor (let n = this.GLYPH_DATA.length - 1; n >= 0; n--) this.pathCache[n] = null;\n\t}\n\n\t// returns the advance value between two glyphs, with kerning included\n\t/*public getKerning(g1:number, g2:number):number\n\t{\n\t\tfor (let n = 0; n < this.GLYPH_COUNT; n++) if (this.KERN_G1[n] == g1 && this.KERN_G2[n] == g2) return this.KERN_K[n];\n\t\treturn 0;\n\t}*/\n\tpublic getKerning(ch1:string, ch2:string):number\n\t{\n\t\tconst sz = this.KERN_K.length;\n\t\tfor (let n = 0; n < sz; n++) if (this.KERN_C1[n] == ch1 && this.KERN_C2[n] == ch2) return -this.KERN_K[n];\n\t\treturn 0;\n\t}\n\n\t// for text of a given size, returns [width,ascent,descent]; all of these numbers are positive; text drawing always uses\n\t// the left/baseline as the reference position\n\tpublic static measureText(txt:string, size:number):number[] {return this.main.measureText(txt, size);}\n\tpublic measureText(txt:string, size:number):number[]\n\t{\n\t\tlet font = FontData.main;\n\n\t\tlet scale = size / font.UNITS_PER_EM;\n\t\tlet dx = 0;\n\t\tfor (let n = 0; n < txt.length; n++)\n\t\t{\n\t\t\tlet ch = txt.charAt(n);\n\t\t\tlet i = this.getIndex(ch);\n\t\t\tif (i < 0)\n\t\t\t{\n\t\t\t\tdx += font.MISSING_HORZ;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tdx += font.HORIZ_ADV_X[i];\n\t\t\tif (n < txt.length - 1) dx += font.getKerning(ch, txt.charAt(n + 1));\n\t\t}\n\n\t\treturn [dx * scale, font.ASCENT * scale * font.ASCENT_FUDGE, -font.DESCENT * scale];\n\t}\n\n\t// measurement of individual characters: an array of x offsets is returned (0, sz1, sz1+sz2, ...) with kernings\n\t// factored in; this is particularly useful for wordwrapping, as it avoids repeated calls; the size is one greater\n\t// than the string length, to capture the final position of the whole string\n\tpublic static measureWidths(txt:string, size:number):number[] {return this.main.measureWidths(txt, size);}\n\tpublic measureWidths(txt:string, size:number):number[]\n\t{\n\t\tlet font = FontData.main;\n\n\t\tlet scale = size / font.UNITS_PER_EM;\n\t\tlet xpos = [0];\n\t\tlet dx = 0;\n\t\tfor (let n = 0; n < txt.length; n++)\n\t\t{\n\t\t\tlet ch = txt.charAt(n);\n\t\t\tlet i = this.getIndex(ch);\n\t\t\tif (i < 0)\n\t\t\t{\n\t\t\t\tdx += font.MISSING_HORZ;\n\t\t\t\txpos.push(dx * scale);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tdx += font.HORIZ_ADV_X[i];\n\t\t\tif (n < txt.length - 1) dx += font.getKerning(ch, txt.charAt(n + 1));\n\n\t\t\txpos.push(dx * scale);\n\t\t}\n\t\treturn xpos;\n\t}\n\n\tprivate pathCache:Path2D[] = [];\n\tprivate pathMissing:Path2D = null;\n\n\t// convert the character into a glyph index\n\t// NOTE: might be faster with a binary search? indexOf is fairly quick though\n\tpublic getIndex(ch:string):number\n\t{\n\t\treturn this.UNICODE.indexOf(ch);\n\t}\n\n\t// returns the raw SVG glyph directly\n\tpublic getRawGlyph(idx:number):string\n\t{\n\t\treturn this.GLYPH_DATA[idx];\n\t}\n\n\t// returns canvas path object for the glyph (cached in case the constructor is rate limiting)\n\tpublic getGlyphPath(idx:number):Path2D\n\t{\n\t\tlet path = this.pathCache[idx];\n\t\tif (path != null) return path;\n\t\tpath = new Path2D(this.GLYPH_DATA[idx]);\n\t\tthis.pathCache[idx] = path;\n\t\treturn path;\n\t}\n\n\t// returns the glyph for \"unknown\"\n\tpublic getMissingPath():Path2D\n\t{\n\t\tif (!this.pathMissing) this.pathMissing = new Path2D(this.MISSING_DATA);\n\t\treturn this.pathMissing;\n\t}\n\n\t// grab duplicates of the points that make up the convex outline for the glyph\n\tpublic getOutlineX(idx:number):number[] {return this.OUTLINE_X[idx].slice(0);}\n\tpublic getOutlineY(idx:number):number[] {return this.OUTLINE_Y[idx].slice(0);}\n\n\t// ------------ special native-font methods ------------\n\n\tprivate ctxReference:CanvasRenderingContext2D = null;\n\n\t// must call this function before accessing native font measuring, because the only way to get access to the functionality is to have\n\t// a canvas object; manufacturing a fake one is a hacky workaround\n\tpublic initNativeFont(ctx?:CanvasRenderingContext2D):void\n\t{\n\t\tif (ctx == null && this.ctxReference) return;\n\t\tif (ctx == null)\n\t\t{\n\t\t\t/*let canvas = dom('<canvas/>').appendTo(document.body);\n\t\t\tthis.ctxReference = (canvas.el as HTMLCanvasElement).getContext('2d');\n\t\t\tcanvas.remove();*/\n\t\t\tlet canvas = new OffscreenCanvas(256, 256);\n\t\t\tthis.ctxReference = canvas.getContext('2d') as unknown as CanvasRenderingContext2D;\n\t\t}\n\t\telse this.ctxReference = ctx;\n\t}\n\n\tpublic static measureTextNative(txt:string, family:string, size:number, opt:FontDataNativeOpt = {}):number[]\n\t{\n\t\treturn this.main.measureTextNative(txt, family, size, opt);\n\t}\n\tpublic measureTextNative(txt:string, family:string, size:number, opt:FontDataNativeOpt = {}):number[]\n\t{\n\t\tif (!this.ctxReference) throw 'Calling measureTextNative without having called initNativeFont first';\n\t\tthis.ctxReference.save();\n\t\tlet pfx = '';\n\t\tif (opt.bold) pfx += 'bold ';\n\t\tif (opt.italic) pfx += 'italic ';\n\t\tthis.ctxReference.font = pfx + size + 'px ' + family;\n\t\tlet metrics = this.ctxReference.measureText(txt);\n\t\tthis.ctxReference.restore();\n\n\t\t// unfortunately the font-bounding values aren't implemented yet, and will come out as null; default to the same fudge-factors as built in font\n\t\t//return [metrics.width, metrics.fontBoundingBoxAscent, metrics.fontBoundingBoxDescent];\n\t\tconst FUDGE = this.ASCENT_FUDGE * this.ASCENT / this.UNITS_PER_EM;\n\t\treturn [metrics.width, size * FUDGE, size * (-this.DESCENT / this.ASCENT) * FUDGE];\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {FontData} from './FontData';\n\n/*\n\tInterface for providing information about the device onto which a molecule is to be drawn, without it needing to\n\tknow what the device actually is.\n*/\n\nexport interface ArrangeMeasurement\n{\n\t// conversion between angstrom units of molecules, and device units\n\tscale():number;\n\tangToX(ax:number):number;\n\tangToY(ay:number):number;\n\txToAng(px:number):number;\n\tyToAng(py:number):number;\n\n\t// return true for math-style Y-axis, false for screen-style Y-axis\n\tyIsUp():boolean;\n\n\t// returns an array of 3 numbers: [ascent, descent, width]\n\tmeasureText(str:string, fontSize:number):number[];\n}\n\n// a suitable default which is useful for creating offline renderings\nexport class OutlineMeasurement implements ArrangeMeasurement\n{\n\tprivate invScale:number;\n\n\tconstructor(private offsetX:number, private offsetY:number, private pointScale:number)\n\t{\n\t\tthis.invScale = 1 / pointScale;\n\t}\n\n\tpublic scale():number {return this.pointScale;}\n\tpublic angToX(ax:number):number {return ax * this.pointScale + this.offsetX;}\n\tpublic angToY(ay:number):number {return ay * -this.pointScale + this.offsetY;}\n\tpublic xToAng(px:number):number {return (px - this.offsetX) * this.invScale;}\n\tpublic yToAng(py:number):number {return (py - this.offsetY) * -this.invScale;}\n\n\t// return true for math-style Y-axis, false for screen-style Y-axis\n\tpublic yIsUp():boolean {return false;}\n\n\t// returns an array of 3 numbers: [ascent, descent, width]\n\tpublic measureText(str:string, fontSize:number):number[] {return FontData.main.measureText(str, fontSize);}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2024 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n    [PKG=webmolkit]\n*/\n\nimport {Molecule} from '../data/Molecule';\nimport {GeomUtil} from '../util/Geom';\nimport {angleDiff, DEGRAD, invZ, norm2_xy, norm_xy} from '../util/util';\nimport {Vec} from '../util/Vec';\nimport {ArrangeMolecule, BLine, BLineType} from './ArrangeMolecule';\nimport {MetaVector, TextAlign} from './MetaVector';\nimport {RenderEffects, RenderMnemonics, RenderMnemonicType, RenderPolicy} from './Rendering';\n\n/*\n    Controlling class for drawing a molecule in a vector graphics format: this turns an \"arranged molecule\" instance into the series of primitives that\n    can be mapped directly to a rendering engine or output format, as encapsulated by the VectorGfxBuilder subclasses.\n\n    Note that in this implementation of rendering, only the molecule is drawn, without interactive effects. The constructor/draw/build sequence should be\n    called only once during the lifetime of this object.\n*/\n\nexport class DrawMolecule\n{\n\tpublic mnemonics:RenderMnemonics = null; // set this externally to request\n\n\tprivate mol:Molecule;\n\tprivate policy:RenderPolicy;\n\tprivate effects:RenderEffects;\n\n\tprivate scale:number;\n\tprivate invScale:number;\n\n\tconstructor(private layout:ArrangeMolecule, private vg:MetaVector)\n\t{\n\t\tthis.mol = layout.getMolecule();\n\t\tthis.policy = layout.getPolicy();\n\t\tthis.effects = layout.getEffects();\n\t\tthis.scale = layout.getScale();\n\t\tthis.invScale = 1.0 / this.scale;\n\t}\n\n\t// access to content\n\tpublic getMolecule():Molecule {return this.mol;}\n\tpublic getMetaVector():MetaVector {return this.vg;}\n\tpublic getLayout():ArrangeMolecule {return this.layout;}\n\tpublic getPolicy():RenderPolicy {return this.policy;}\n\tpublic getEffects():RenderEffects {return this.effects;}\n\n\t// renders the molecular structure\n\tpublic draw():void\n\t{\n\t\t// debugging: draw the \"space filling\" areas-to-avoid\n\t\tlet DRAW_SPACE = false;\n\t\tif (DRAW_SPACE)\n\t\t{\n\t\t\tlet bounds = this.layout.determineBoundary();\n\t\t\tthis.vg.drawRect(bounds[0], bounds[1], bounds[2] - bounds[0], bounds[3] - bounds[1], 0xFF0000, 1, MetaVector.NOCOLOUR);\n\t\t\tfor (let n = 0; n < this.layout.numSpace(); n++)\n\t\t\t{\n\t\t\t\tlet spc = this.layout.getSpace(n);\n\t\t\t\tthis.vg.drawRect(spc.box.x, spc.box.y, spc.box.w, spc.box.h, MetaVector.NOCOLOUR, 0, 0xE0E0E0);\n\t\t\t\tif (spc.px != null && spc.py != null && spc.px.length > 2) this.vg.drawPoly(spc.px, spc.py, 0x000000, 1, 0x808080FF, true);\n\t\t\t}\n\t\t}\n\n\t\tthis.drawUnderEffects();\n\n\t\t// emit the drawing elements as vector primitives\n\n\t\tlet {mol, layout, effects, policy, vg} = this;\n\n\t\t// special deal: bonds that are drawn together\n\t\tlet hideBonds = new Set<number>(effects.hideBonds);\n\t\tfor (let i = 1; i <= mol.numBonds; i++) if (mol.bondType(i) == Molecule.BONDTYPE_INCLINED && !hideBonds.has(i))\n\t\t{\n\t\t\tlet atom = mol.bondTo(i);\n\t\t\tif (layout.getPoint(atom - 1).text) continue; // invisible carbon only\n\t\t\tfor (let j of mol.atomAdjBonds(atom)) if (j != i && mol.bondType(j) == Molecule.BONDTYPE_INCLINED && mol.bondTo(j) == atom && !hideBonds.has(j))\n\t\t\t{\n\t\t\t\tlet b1 = layout.getLines().find((b) => b.bnum == i);\n\t\t\t\tlet b2 = layout.getLines().find((b) => b.bnum == j);\n\n\t\t\t\tlet th1 = Math.atan2(b1.line.y1 - b1.line.y2, b1.line.x1 - b1.line.x2);\n\t\t\t\tlet th2 = Math.atan2(b2.line.y1 - b2.line.y2, b2.line.x1 - b2.line.x2);\n\t\t\t\tif (Math.abs(angleDiff(th1, th2)) < 170 * DEGRAD)\n\t\t\t\t{\n\t\t\t\t\tthis.drawFusedWedge(b1, b2);\n\t\t\t\t\tthis.mnemonics?.append(RenderMnemonicType.Artifact, 'Fused', [b1.line.x1, b1.line.y1, b1.line.x2, b1.line.y2, b2.line.x1, b2.line.y1, b2.line.x2, b2.line.y2]);\n\t\t\t\t\thideBonds.add(i);\n\t\t\t\t\thideBonds.add(j);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (let n = 0; n < layout.numLines(); n++)\n\t\t{\n\t\t\tlet b = layout.getLine(n);\n\t\t\tif (hideBonds.has(b.bnum)) continue;\n\n\t\t\tif (b.type == BLineType.Normal)\n\t\t\t{\n\t\t\t\tvg.drawLine(b.line.x1, b.line.y1, b.line.x2, b.line.y2, b.col, b.size);\n\t\t\t\tthis.mnemonics?.append(RenderMnemonicType.Bond, 'L', [b.line.x1, b.line.y1, b.line.x2, b.line.y2]);\n\t\t\t}\n\t\t\telse if (b.type == BLineType.Inclined)\n\t\t\t{\n\t\t\t\tthis.drawBondInclined(b);\n\t\t\t\tthis.mnemonics?.append(RenderMnemonicType.Bond, 'I', [b.line.x1, b.line.y1, b.line.x2, b.line.y2]);\n\t\t\t}\n\t\t\telse if (b.type == BLineType.Declined)\n\t\t\t{\n\t\t\t\tthis.drawBondDeclined(b);\n\t\t\t\tthis.mnemonics?.append(RenderMnemonicType.Bond, 'D', [b.line.x1, b.line.y1, b.line.x2, b.line.y2]);\n\t\t\t}\n\t\t\telse if (b.type == BLineType.Unknown)\n\t\t\t{\n\t\t\t\tthis.drawBondUnknown(b);\n\t\t\t\tthis.mnemonics?.append(RenderMnemonicType.Bond, 'U', [b.line.x1, b.line.y1, b.line.x2, b.line.y2]);\n\t\t\t}\n\t\t\telse if (b.type == BLineType.Dotted || b.type == BLineType.DotDir)\n\t\t\t{\n\t\t\t\tthis.drawBondDotted(b);\n\t\t\t\tthis.mnemonics?.append(RenderMnemonicType.Bond, 'O', [b.line.x1, b.line.y1, b.line.x2, b.line.y2]);\n\t\t\t}\n\t\t\telse if (b.type == BLineType.IncDouble || b.type == BLineType.IncTriple || b.type == BLineType.IncQuadruple)\n\t\t\t{\n\t\t\t\tthis.drawBondIncMulti(b);\n\t\t\t\tthis.mnemonics?.append(RenderMnemonicType.Bond, 'M', [b.line.x1, b.line.y1, b.line.x2, b.line.y2]);\n\t\t\t}\n\t\t}\n\n\t\tlet fg = policy.data.foreground;\n\t\tfor (let r of layout.getRings())\n\t\t{\n\t\t\tif (r.theta != 0)\n\t\t\t{\n\t\t\t\tvar bez = GeomUtil.createBezierEllipse(r.cx, r.cy, r.rw, r.rh, r.theta);\n\t\t\t\tvg.drawPath(bez.px, bez.py, bez.ctrl, true, fg, r.size, MetaVector.NOCOLOUR, false);\n\t\t\t\tthis.mnemonics?.append(RenderMnemonicType.Artifact, 'Ring', [r.cx, r.cy, r.rw, r.rh, r.theta]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvg.drawOval(r.cx, r.cy, r.rw, r.rh, fg, r.size, MetaVector.NOCOLOUR);\n\t\t\t\tthis.mnemonics?.append(RenderMnemonicType.Artifact, 'Ring', [r.cx, r.cy, r.rw, r.rh]);\n\t\t\t}\n\t\t}\n\t\tfor (let p of layout.getPaths())\n\t\t{\n\t\t\tvg.drawPath(p.px, p.py, p.ctrl, false, fg, p.size, MetaVector.NOCOLOUR, false);\n\t\t\tthis.mnemonics?.append(RenderMnemonicType.Artifact, 'Path', [...p.px, ...p.py]);\n\t\t}\n\n\t\tfor (let n = 0; n < layout.numPoints(); n++)\n\t\t{\n\t\t\tlet p = layout.getPoint(n);\n\t\t\tif (effects.hideAtoms.has(p.anum)) continue;\n\n\t\t\tlet txt = p.text;\n\t\t\tlet cx = p.oval.cx, cy = p.oval.cy, rw = p.oval.rw;\n\t\t\tif (txt == null)\n\t\t\t{\n\t\t\t\tthis.mnemonics?.append(RenderMnemonicType.Atom, '.', [cx, cy]);\n\t\t\t\tcontinue; // is a point, so do not draw anything\n\t\t\t}\n\t\t\tlet fsz = p.fsz;\n\t\t\tlet col = p.col;\n\n\t\t\twhile (txt.endsWith('.'))\n\t\t\t{\n\t\t\t\tlet dw = rw / txt.length;\n\t\t\t\tlet r = fsz * 0.15;\n\t\t\t\tvg.drawOval(cx + rw - dw, cy, r, r, MetaVector.NOCOLOUR, 0, col);\n\n\t\t\t\tcx -= dw;\n\t\t\t\trw -= dw;\n\t\t\t\ttxt = txt.substring(0, txt.length - 1);\n\t\t\t}\n\t\t\twhile (txt.startsWith('+'))\n\t\t\t{\n\t\t\t\tlet dw = rw / txt.length;\n\t\t\t\tlet x = cx - rw + dw, y = cy, r = fsz * 0.18, lsz = fsz * 0.1;\n\t\t\t\tvg.drawLine(x - r, y, x + r, y, col, lsz);\n\t\t\t\tvg.drawLine(x, y - r, x, y + r, col, lsz);\n\n\t\t\t\tcx += dw;\n\t\t\t\trw -= dw;\n\t\t\t\ttxt = txt.substring(1, txt.length);\n\t\t\t}\n\t\t\twhile (txt.startsWith('-'))\n\t\t\t{\n\t\t\t\tlet dw = rw / txt.length;\n\t\t\t\tlet x = cx - rw + dw, y = cy, r = fsz * 0.18, lsz = fsz * 0.1;\n\t\t\t\tvg.drawLine(x - r, y, x + r, y, col, lsz);\n\n\t\t\t\tcx += dw;\n\t\t\t\trw -= dw;\n\t\t\t\ttxt = txt.substring(1, txt.length);\n\t\t\t}\n\t\t\tif (txt.length > 0)\n\t\t\t{\n\t\t\t\tvg.drawText(cx, cy, txt, fsz, col, TextAlign.Centre | TextAlign.Middle, p.rotation || 0);\n\t\t\t\tthis.mnemonics?.append(RenderMnemonicType.Atom, txt, [cx, cy]);\n\t\t\t}\n\t\t\telse this.mnemonics?.append(RenderMnemonicType.Atom, '.', [cx, cy]);\n\t\t}\n\n\t\tthis.drawOverEffects();\n\t}\n\n\t// ------------ private methods ------------\n\n\tprivate drawUnderEffects():void\n\t{\n\t\tlet mol = this.mol, policy = this.policy, effects = this.effects, layout = this.layout, scale = this.scale, vg = this.vg;\n\n\t\tfor (let n = 0, num = Math.min(effects.atomFrameDotSz.length, mol.numAtoms); n < num; n++)\n\t\t{\n\t\t\tif (effects.hideAtoms.has(n + 1)) continue;\n\n\t\t\tlet dw = effects.atomFrameDotSz[n] * scale, col = effects.atomFrameCol[n];\n\t\t\tlet a = layout.getPoint(n);\n\n\t\t\tlet rw = a.oval.rw + 0.1 * scale, rh = a.oval.rh + 0.1 * scale;\n\t\t\tlet wdots = Math.ceil(2 * rw / (3 * dw));\n\t\t\tlet hdots = Math.ceil(2 * rh / (3 * dw));\n\t\t\tlet wspc = 2 * rw / wdots, hspc = 2 * rh / hdots;\n\n\t\t\tfor (let i = 0; i <= wdots; i++)\n\t\t\t{\n\t\t\t\tlet x = a.oval.cx - rw + i * wspc;\n\t\t\t\tvg.drawOval(x, a.oval.cy - rh, dw, dw, MetaVector.NOCOLOUR, 0, col);\n\t\t\t\tvg.drawOval(x, a.oval.cy + rh, dw, dw, MetaVector.NOCOLOUR, 0, col);\n\t\t\t}\n\t\t\tfor (let i = 1; i < hdots; i++)\n\t\t\t{\n\t\t\t\tlet y = a.oval.cy - rh + i * hspc;\n\t\t\t\tvg.drawOval(a.oval.cx - rw, y, dw, dw, MetaVector.NOCOLOUR, 0, col);\n\t\t\t\tvg.drawOval(a.oval.cx + rw, y, dw, dw, MetaVector.NOCOLOUR, 0, col);\n\t\t\t}\n\n\t\t\tthis.mnemonics?.append(RenderMnemonicType.Effect, 'Dot', [a.oval.cx, a.oval.cy, a.oval.rw, a.oval.rh]);\n\t\t}\n\n\t\tfor (let key in effects.dottedRectOutline)\n\t\t{\n\t\t\tlet atom = parseInt(key), col = effects.dottedRectOutline[key];\n\t\t\tlet a = layout.getPoint(atom - 1);\n\t\t\tlet rw = Math.max(a.oval.rw, 0.2 * scale), rh = Math.max(a.oval.rh, 0.2 * scale);\n\t\t\tlet sz = 0.05 * scale;\n\t\t\tlet xdots = Math.max(1, Math.round(rw / (2 * sz)));\n\t\t\tlet ydots = Math.max(1, Math.round(rh / (2 * sz)));\n\t\t\tlet invX = (2 * rw) / xdots, invY = (2 * rh) / ydots;\n\t\t\tfor (let n = 0; n <= xdots; n++)\n\t\t\t{\n\t\t\t\tlet x = a.oval.cx - rw + n * invX;\n\t\t\t\tvg.drawOval(x, a.oval.cy - rh, sz, sz, MetaVector.NOCOLOUR, 0, col);\n\t\t\t\tvg.drawOval(x, a.oval.cy + rh, sz, sz, MetaVector.NOCOLOUR, 0, col);\n\t\t\t}\n\t\t\tfor (let n = 1; n < ydots; n++)\n\t\t\t{\n\t\t\t\tlet y = a.oval.cy - rh + n * invY;\n\t\t\t\tvg.drawOval(a.oval.cx - rw, y, sz, sz, MetaVector.NOCOLOUR, 0, col);\n\t\t\t\tvg.drawOval(a.oval.cx + rw, y, sz, sz, MetaVector.NOCOLOUR, 0, col);\n\t\t\t}\n\n\t\t\tthis.mnemonics?.append(RenderMnemonicType.Effect, 'Rect', [a.oval.cx, a.oval.cy, a.oval.rw, a.oval.rh]);\n\t\t}\n\n\t\tfor (let key in effects.dottedBondCross)\n\t\t{\n\t\t\tlet bond = parseInt(key), col = effects.dottedBondCross[key];\n\t\t\tlet x1 = 0, y1 = 0, x2 = 0, y2 = 0, bcount = 0;\n\t\t\tfor (let n = 0; n < layout.numLines(); n++)\n\t\t\t{\n\t\t\t\tlet b = layout.getLine(n);\n\t\t\t\tif (b.bnum == bond)\n\t\t\t\t{\n\t\t\t\t\tx1 += b.line.x1; y1 += b.line.y1;\n\t\t\t\t\tx2 += b.line.x2; y2 += b.line.y2;\n\t\t\t\t\tbcount += 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (bcount > 1)\n\t\t\t{\n\t\t\t\tlet inv = 1 / bcount;\n\t\t\t\t[x1, y1, x2, y2] = [x1 * inv, y1 * inv, x2 * inv, y2 * inv];\n\t\t\t}\n\n\t\t\tlet dx = x2 - x1, dy = y2 - y1;\n\t\t\tlet inv = 0.2 * scale * invZ(norm_xy(dx, dy)), ox = dy * inv, oy = -dx * inv;\n\t\t\tlet cx = 0.5 * (x1 + x2), cy = 0.5 * (y1 + y2), sz = 0.05 * scale;\n\t\t\tfor (let p of [-2, -1, 1, 2])\n\t\t\t{\n\t\t\t\tlet x = cx + p * ox, y = cy + p * oy;\n\t\t\t\tvg.drawOval(x, y, sz, sz, MetaVector.NOCOLOUR, 0, col);\n\t\t\t}\n\n\t\t\tthis.mnemonics?.append(RenderMnemonicType.Effect, 'Crossing', [x1, y1, x2, y2]);\n\t\t}\n\t}\n\n\tprivate drawOverEffects():void\n\t{\n\t\tlet mol = this.mol, policy = this.policy, effects = this.effects, layout = this.layout, scale = this.scale, vg = this.vg;\n\n\t\tfor (let a of effects.overlapAtoms)\n\t\t{\n\t\t\tlet p = layout.getPoint(a - 1);\n\t\t\tlet rad = scale * 0.2;\n\t\t\tvg.drawLine(p.oval.cx - rad, p.oval.cy - rad, p.oval.cx + rad, p.oval.cy + rad, 0xFF0000, 1);\n\t\t\tvg.drawLine(p.oval.cx + rad, p.oval.cy - rad, p.oval.cx - rad, p.oval.cy + rad, 0xFF0000, 1);\n\n\t\t\tthis.mnemonics?.append(RenderMnemonicType.Effect, 'Overlap', [p.oval.cx, p.oval.cy, p.oval.rw, p.oval.rh]);\n\t\t}\n\n\t\tfor (let n = 0, num = Math.min(effects.atomCircleSz.length, mol.numAtoms); n < num; n++) if (effects.atomCircleSz[n] > 0)\n\t\t{\n\t\t\tlet dw = effects.atomCircleSz[n] * scale, col = effects.atomCircleCol[n];\n\t\t\tlet p = layout.getPoint(n);\n\t\t\tvg.drawOval(p.oval.cx, p.oval.cy, dw, dw, MetaVector.NOCOLOUR, 0, col);\n\n\t\t\tthis.mnemonics?.append(RenderMnemonicType.Effect, 'Circle', [p.oval.cx, p.oval.cy, p.oval.rw, p.oval.rh]);\n\t\t}\n\t}\n\n\tprivate drawBondInclined(b:BLine):void\n\t{\n\t\tlet x1 = b.line.x1, y1 = b.line.y1, x2 = b.line.x2, y2 = b.line.y2;\n\t\tlet dx = x2 - x1, dy = y2 - y1;\n\t\tlet col = b.col;\n\t\tlet size = b.size, head = b.head;\n\n\t\tlet norm = head / Math.sqrt(dx * dx + dy * dy);\n\t\tlet ox = norm * dy, oy = -norm * dx;\n\t\tlet px = [x1, x2 - ox, x2 + ox], py = [y1, y2 - oy, y2 + oy];\n\n\t\t// if endpoint is divalent, consider modifying the polygon shape\n\t\tif (this.layout.getPoint(b.bto - 1).text == null && this.mol.atomAdjCount(b.bto) == 2)\n\t\t{\n\t\t\tlet other:BLine = null;\n\t\t\tfor (let n = 0; n < this.layout.numLines(); n++)\n\t\t\t{\n\t\t\t\tlet o = this.layout.getLine(n);\n\t\t\t\tif (o.type == BLineType.Normal && (o.bfr == b.bto || o.bto == b.bto))\n\t\t\t\t{\n\t\t\t\t\tif (other != null) {other = null; break;} // must be only one\n\t\t\t\t\tother = o;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (other != null)\n\t\t\t{\n\t\t\t\tlet th1 = Math.atan2(y1 - y2, x1 - x2);\n\t\t\t\tlet th2 = Math.atan2(other.line.y1 - other.line.y2, other.line.x1 - other.line.x2);\n\t\t\t\tif (b.bto == other.bfr) th2 += Math.PI;\n\t\t\t\tlet diff = Math.abs(angleDiff(th1, th2));\n\t\t\t\tif (diff > 105 * DEGRAD && diff < 135 * DEGRAD)\n\t\t\t\t{\n\t\t\t\t\tlet ixy1 = GeomUtil.lineIntersect(px[0], py[0], px[1], py[1], other.line.x1, other.line.y1, other.line.x2, other.line.y2);\n\t\t\t\t\tlet ixy2 = GeomUtil.lineIntersect(px[0], py[0], px[2], py[2], other.line.x1, other.line.y1, other.line.x2, other.line.y2);\n\t\t\t\t\tpx[1] = ixy1[0];\n\t\t\t\t\tpy[1] = ixy1[1];\n\t\t\t\t\tpx[2] = ixy2[0];\n\t\t\t\t\tpy[2] = ixy2[1];\n\n\t\t\t\t\t// extend slightly, to overlap the line\n\t\t\t\t\tlet dx1 = px[1] - px[0], dy1 = py[1] - py[0], inv1 = 0.5 * other.size / norm_xy(dx1, dy1);\n\t\t\t\t\tpx[1] += dx1 * inv1;\n\t\t\t\t\tpy[1] += dy1 * inv1;\n\t\t\t\t\tlet dx2 = px[2] - px[0], dy2 = py[2] - py[0], inv2 = 0.5 * other.size / norm_xy(dx2, dy2);\n\t\t\t\t\tpx[2] += dx2 * inv1;\n\t\t\t\t\tpy[2] += dy2 * inv1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// if endpoint is trivalent, another modification is considered\n\t\tif (this.layout.getPoint(b.bto - 1).text == null && this.mol.atomAdjCount(b.bto) == 3)\n\t\t{\n\t\t\tlet other1:BLine = null, other2:BLine = null;\n\t\t\tfor (let n = 0; n < this.layout.numLines(); n++)\n\t\t\t{\n\t\t\t\tlet o = this.layout.getLine(n);\n\t\t\t\tif (o.type == BLineType.Normal && (o.bfr == b.bto || o.bto == b.bto))\n\t\t\t\t{\n\t\t\t\t\tif (other1 == null) other1 = o;\n\t\t\t\t\telse if (other2 == null) other2 = o;\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tother1 = other2 = null;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (other1 != null && other2 != null)\n\t\t\t{\n\t\t\t\tlet th1 = Math.atan2(y1 - y2, x1 - x2);\n\t\t\t\tlet th2 = Math.atan2(other1.line.y1 - other1.line.y2, other1.line.x1 - other1.line.x2);\n\t\t\t\tlet th3 = Math.atan2(other2.line.y1 - other2.line.y2, other2.line.x1 - other2.line.x2);\n\t\t\t\tif (b.bto == other1.bfr) th2 += Math.PI;\n\t\t\t\tif (b.bto == other2.bfr) th3 += Math.PI;\n\t\t\t\tlet dth1 = angleDiff(th1, th2), diff1 = Math.abs(dth1);\n\t\t\t\tlet dth2 = angleDiff(th1, th3), diff2 = Math.abs(dth2);\n\t\t\t\tlet diff3 = Math.abs(angleDiff(th2, th3));\n\t\t\t\tif (diff1 > 105 * DEGRAD && diff1 < 135 * DEGRAD ||\n\t\t\t\t\tdiff2 > 105 * DEGRAD && diff2 < 135 * DEGRAD ||\n\t\t\t\t\tdiff3 > 105 * DEGRAD && diff3 < 135 * DEGRAD)\n\t\t\t\t{\n\t\t\t\t\tif (dth1 < 0) [other1, other2] = [other2, other1];\n\t\t\t\t\tlet ixy1 = GeomUtil.lineIntersect(px[0], py[0], px[1], py[1], other1.line.x1, other1.line.y1, other1.line.x2, other1.line.y2);\n\t\t\t\t\tlet ixy2 = GeomUtil.lineIntersect(px[0], py[0], px[2], py[2], other2.line.x1, other2.line.y1, other2.line.x2, other2.line.y2);\n\t\t\t\t\tpx = [x1, ixy1[0], x2, ixy2[0]];\n\t\t\t\t\tpy = [y1, ixy1[1], y2, ixy2[1]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.vg.drawPoly(px, py, MetaVector.NOCOLOUR, 0, col, true);\n\t}\n\tprivate drawFusedWedge(b1:BLine, b2:BLine):void\n\t{\n\t\tconst terminalPoints = (b:BLine, other:BLine):{outerX:number, outerY:number, innerX:number, innerY:number} =>\n\t\t{\n\t\t\tlet x1 = b.line.x1, y1 = b.line.y1, x2 = b.line.x2, y2 = b.line.y2;\n\t\t\tlet dx = x2 - x1, dy = y2 - y1;\n\t\t\tlet norm = b.head / Math.sqrt(dx * dx + dy * dy);\n\t\t\tlet ox = norm * dy, oy = -norm * dx;\n\n\t\t\tlet tx1 = x2 - ox, ty1 = y2 - oy, tx2 = x2 + ox, ty2 = y2 + oy;\n\t\t\tlet dsq1 = norm2_xy(tx1 - other.line.x1, ty1 - other.line.y1);\n\t\t\tlet dsq2 = norm2_xy(tx2 - other.line.x1, ty2 - other.line.y1);\n\t\t\tif (dsq1 > dsq2)\n\t\t\t\treturn {outerX: tx1, outerY: ty1, innerX: tx2, innerY: ty2};\n\t\t\telse\n\t\t\t\treturn {outerX: tx2, outerY: ty2, innerX: tx1, innerY: ty1};\n\t\t};\n\n\t\tlet u = terminalPoints(b1, b2), v = terminalPoints(b2, b1);\n\n\t\tlet [innerX, innerY] = GeomUtil.lineIntersect(b1.line.x1, b1.line.y1, u.innerX, u.innerY, b2.line.x1, b2.line.y1, v.innerX, v.innerY);\n\n\t\tlet px = [b1.line.x1, u.outerX, v.outerX, b2.line.x1, innerX];\n\t\tlet py = [b1.line.y1, u.outerY, v.outerY, b2.line.y1, innerY];\n\t\tthis.vg.drawPoly(px, py, MetaVector.NOCOLOUR, 0, b1.col, true);\n\t}\n\n\tprivate drawBondDeclined(b:BLine):void\n\t{\n\t\tlet x1 = b.line.x1, y1 = b.line.y1, x2 = b.line.x2, y2 = b.line.y2;\n\t\tlet dx = x2 - x1, dy = y2 - y1;\n\t\tlet col = b.col;\n\t\tlet size = b.size, head = b.head;\n\n\t\tlet ext = Math.sqrt(dx * dx + dy * dy);\n\t\tlet nsteps = Math.ceil(ext * 2.5 * this.invScale);\n\t\tlet norm = head / ext;\n\t\tlet ox = norm * dy, oy = -norm * dx, invSteps = 1.0 / (nsteps + 1);\n\t\tlet holdout = this.mol.atomAdjCount(b.bto) == 1 && this.layout.getPoint(b.bto - 1).text == null ? 1 : 1 - (0.15 * this.scale) / ext;\n\t\tfor (let i = 0; i <= nsteps + 1; i++)\n\t\t{\n\t\t\tlet cx = x1 + i * dx * invSteps * holdout, cy = y1 + i * dy * invSteps * holdout;\n\t\t\tlet ix = ox * i * invSteps, iy = oy * i * invSteps;\n\t\t\tthis.vg.drawLine(cx - ix, cy - iy, cx + ix, cy + iy, col, size);\n\t\t}\n\t}\n\tprivate drawBondUnknown(b:BLine):void\n\t{\n\t\tlet x1 = b.line.x1, y1 = b.line.y1, x2 = b.line.x2, y2 = b.line.y2;\n\t\tlet dx = x2 - x1, dy = y2 - y1;\n\t\tlet col = b.col;\n\t\tlet size = b.size, head = b.head;\n\n\t\tlet ext = Math.sqrt(dx * dx + dy * dy);\n\t\tlet nsteps = Math.ceil(ext * 3.5 * this.invScale);\n\t\tlet norm = head / ext;\n\t\tlet ox = norm * dy, oy = -norm * dx;\n\t\tlet sz = 1 + 3 * (nsteps + 1);\n\t\tlet x = Vec.numberArray(0, sz), y = Vec.numberArray(0, sz), ctrl = Vec.booleanArray(false, sz);\n\t\tx[0] = x1;\n\t\ty[0] = y1;\n\t\tctrl[0] = false;\n\n\t\tfor (let i = 0, j = 1; i <= nsteps; i++, j += 3)\n\t\t{\n\t\t\tlet ax = x1 + i * dx / (nsteps + 1), ay = y1 + i * dy / (nsteps + 1);\n\t\t\tlet cx = x1 + (i + 1) * dx / (nsteps + 1), cy = y1 + (i + 1) * dy / (nsteps + 1);\n\t\t\tlet bx = (ax + cx) / 2, by = (ay + cy) / 2;\n\t\t\tlet sign = i % 2 == 0 ? 1 : -1;\n\n\t\t\tx[j] = ax;\n\t\t\tx[j + 1] = bx + sign * ox;\n\t\t\tx[j + 2] = cx;\n\t\t\ty[j] = ay;\n\t\t\ty[j + 1] = by + sign * oy;\n\t\t\ty[j + 2] = cy;\n\t\t\tctrl[j] = true;\n\t\t\tctrl[j + 1] = true;\n\t\t\tctrl[j + 2] = false;\n\t\t}\n\t\tthis.vg.drawPath(x, y, ctrl, false, col, size, MetaVector.NOCOLOUR, false);\n\t}\n\tprivate drawBondDotted(b:BLine):void\n\t{\n\t\tlet x1 = b.line.x1, y1 = b.line.y1, x2 = b.line.x2, y2 = b.line.y2;\n\t\tlet dx = x2 - x1, dy = y2 - y1;\n\t\tlet col = b.col;\n\t\tlet size = b.size;\n\n\t\tlet radius = size, dist = norm_xy(dx, dy);\n\t\tif (dist < 0.01) return;\n\t\tlet nudge = 0.5 * size / dist;\n\t\tx1 += nudge * dx;\n\t\ty1 += nudge * dy;\n\t\tx2 -= nudge * dx;\n\t\ty2 -= nudge * dy;\n\t\tdx = x2 - x1;\n\t\tdy = y2 - y1;\n\n\t\tlet nsteps = Math.ceil(0.2 * dist / radius);\n\t\tlet invSteps = 1.0 / (nsteps + 1);\n\t\tfor (let i = 0; i <= nsteps + 1; i++)\n\t\t{\n\t\t\tlet r = radius;\n\t\t\tif (b.type == BLineType.DotDir) r *= 1 + (i * (1.0 / (nsteps + 2)) - 0.5);\n\t\t\tlet cx = x1 + i * dx * invSteps, cy = y1 + i * dy * invSteps;\n\t\t\tthis.vg.drawOval(cx, cy, r, r, MetaVector.NOCOLOUR, 0, col);\n\t\t}\n\t}\n\tprivate drawBondIncMulti(b:BLine):void\n\t{\n\t\tlet x1 = b.line.x1, y1 = b.line.y1, x2 = b.line.x2, y2 = b.line.y2;\n\t\tlet dx = x2 - x1, dy = y2 - y1;\n\t\tlet col = b.col;\n\t\tlet size = b.size, head = b.head;\n\n\t\tlet norm = head / Math.sqrt(dx * dx + dy * dy);\n\t\tlet ox = norm * dy, oy = -norm * dx;\n\t\tthis.vg.drawPoly([x1, x2 - ox, x2 + ox], [y1, y2 - oy, y2 + oy], col, this.scale * 0.05, MetaVector.NOCOLOUR, true);\n\n\t\tif (b.type == BLineType.IncDouble)\n\t\t{\n\t\t\tthis.vg.drawLine(x1, y1, x2, y2, col, this.scale * 0.03);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.vg.drawLine(x1, y1, x2 + 0.33 * ox, y2 + 0.33 * oy, col, this.scale * 0.03);\n\t\t\tthis.vg.drawLine(x1, y1, x2 - 0.33 * ox, y2 - 0.33 * oy, col, this.scale * 0.03);\n\t\t}\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {ExperimentEntry} from '../aspect/Experiment';\nimport {MolUtil} from '../data/MolUtil';\nimport {invZ, norm_xy} from '../util/util';\nimport {Vec} from '../util/Vec';\nimport {ArrangeComponent, ArrangeComponentAnnot, ArrangeComponentType, ArrangeExperiment} from './ArrangeExperiment';\nimport {ArrangeMeasurement} from './ArrangeMeasurement';\nimport {ArrangeMolecule} from './ArrangeMolecule';\nimport {DrawMolecule} from './DrawMolecule';\nimport {MetaVector, TextAlign} from './MetaVector';\nimport {RenderEffects, RenderPolicy} from './Rendering';\n\n/*\n\tControlling class for drawing a molecule in a vector graphics format: this turns an \"arranged molecule\" instance into the series of primitives that\n\tcan be mapped directly to a rendering engine or output format, as encapsulated by the VectorGfxBuilder subclasses.\n\n\tNote that in this implementation of rendering, only the molecule is drawn, without interactive effects. The constructor/draw/build sequence should be\n\tcalled only once during the lifetime of this object.\n*/\n\nexport class DrawExperiment\n{\n\tprivate entry:ExperimentEntry;\n\tprivate measure:ArrangeMeasurement;\n\tprivate policy:RenderPolicy;\n\n\tprivate scale:number;\n\tprivate invScale:number;\n\n\t// optional hooks to intercept rendering\n\tpublic preDrawComponent:(vg:MetaVector, idx:number, xc:ArrangeComponent) => void = null;\n\tpublic preDrawMolecule:(vg:MetaVector, idx:number, xc:ArrangeComponent, arrmol:ArrangeMolecule) => void = null;\n\tpublic postDrawMolecule:(vg:MetaVector, idx:number, xc:ArrangeComponent, arrmol:ArrangeMolecule) => void = null;\n\n\tpublic molDrawn:ArrangeMolecule[] = []; // useful to obtain later, sometimes\n\n\t// --------------------- public methods ---------------------\n\n\tconstructor(private layout:ArrangeExperiment, private vg:MetaVector)\n\t{\n\t\tthis.entry = layout.entry;\n\t\tthis.measure = layout.measure;\n\t\tthis.policy = layout.policy;\n\t\tthis.scale = layout.scale;\n\t\tthis.invScale = 1.0 / this.scale;\n\t}\n\n\t// renders the experiment, one component at a time\n\tpublic draw():void\n\t{\n\t\t// debug: draw outlines of components\n\t\t//for (let xc of this.layout.components) this.vg.drawRect(xc.box.x, xc.box.y, xc.box.w, xc.box.h, MetaVector.NOCOLOUR, 0, 0xF0000000);\n\n\t\tthis.molDrawn = Vec.anyArray(null, this.layout.components.length);\n\n\t\tfor (let n = 0; n < this.layout.components.length; n++)\n\t\t{\n\t\t\tlet xc = this.layout.components[n];\n\t\t\tif (xc.type == ArrangeComponentType.Arrow) this.drawSymbolArrow(xc);\n\t\t\telse if (xc.type == ArrangeComponentType.Plus) this.drawSymbolPlus(xc);\n\t\t\telse this.drawComponent(n, xc);\n\t\t}\n\t}\n\n\t// --------------------- private methods ---------------------\n\n\tprivate drawComponent(idx:number, xc:ArrangeComponent):void\n\t{\n\t\tlet vg = this.vg, policy = this.policy;\n\t\tlet bx = xc.box.x + xc.padding, by = xc.box.y + xc.padding;\n\t\tlet bw = xc.box.w - 2 * xc.padding, bh = xc.box.h - 2 * xc.padding;\n\n\t\tif (this.preDrawComponent) this.preDrawComponent(vg, idx, xc);\n\n\t\tif (xc.srcIdx < 0 && MolUtil.isBlank(xc.mol) && Vec.isBlank(xc.text))\n\t\t{\n\t\t\tlet fsz = 0.5 * bh;\n\t\t\tvg.drawText(bx + 0.5 * bw, by + 0.5 * bh, '?', fsz, policy.data.foreground, TextAlign.Centre | TextAlign.Middle);\n\t\t\treturn;\n\t\t}\n\n\t\t//vg.drawRect(bx, by, bw, bh, 0xFF0000, 2, null);\n\n\t\tif (Vec.notBlank(xc.text))\n\t\t{\n\t\t\tlet wad = this.measure.measureText('!', xc.fszText), th = wad[1] + wad[2];\n\t\t\tlet totalH = th * xc.text.length;\n\n\t\t\t//vg.drawRect(bx, by + bh - totalH, bw, totalH, 0x00FF00, 1, null);\n\n\t\t\tlet ty = by + bh - th * (xc.text.length - 1);\n\t\t\tfor (let line of xc.text)\n\t\t\t{\n\t\t\t\tlet wad = this.measure.measureText(line, xc.fszText);\n\t\t\t\t/* !! text has to be wrapped: need features for this, in some static module...\n\t\t\t\tif (tsz.width>limitBounds.width) tsz=textSizeWithin(xc.text,fontText,limitBounds,NSLineBreakByCharWrapping);\n\t\t\t\t... in DrawUtil\t*/\n\t\t\t\tvg.drawText(bx + 0.5 * bw, ty, line, xc.fszText, policy.data.foreground, TextAlign.Centre | TextAlign.Baseline);\n\t\t\t\tty += th;\n\t\t\t}\n\n\t\t\tbh -= totalH + 0.5 * xc.fszText;\n\t\t}\n\n\t\t//vg.drawRect(bx, by, bw, bh, 0x0000FF, 1, null);\n\n\t\tlet stoichPos:{tx?:number, th?:number, lx?:number, lw?:number} = {};\n\t\tif (xc.leftNumer)\n\t\t{\n\t\t\tlet wad1 = this.measure.measureText(xc.leftNumer, xc.fszLeft);\n\t\t\tif (!xc.leftDenom)\n\t\t\t{\n\t\t\t\tstoichPos.tx = bx;\n\t\t\t\tlet useW = wad1[0] + ArrangeExperiment.COMP_GAP_LEFT * (wad1[1] + wad1[2]);\n\t\t\t\tbx += useW;\n\t\t\t\tbw -= useW;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet wad2 = this.measure.measureText(xc.leftDenom, xc.fszLeft);\n\t\t\t\tlet tw = Math.max(wad1[0], wad2[0]);\n\t\t\t\tlet x = bx + 0.5 * tw, y = by + 0.5 * bh;\n\t\t\t\tstoichPos.tx = x;\n\t\t\t\tstoichPos.th = wad1[2];\n\t\t\t\tstoichPos.lx = bx;\n\t\t\t\tstoichPos.lw = tw;\n\t\t\t\tlet useW = tw + ArrangeExperiment.COMP_GAP_LEFT * (wad1[1] + wad1[2]);\n\t\t\t\tbx += useW;\n\t\t\t\tbw -= useW;\n\t\t\t}\n\t\t}\n\t\tif (xc.annot != 0)\n\t\t{\n\t\t\tlet aw = ArrangeExperiment.COMP_ANNOT_SIZE * this.scale;\n\t\t\tbw -= aw;\n\t\t\tthis.drawAnnotation(xc.annot, bx + bw, by, aw, bh);\n\t\t}\n\n\t\tlet baseY = by + 0.5 * bh;\n\t\tif (MolUtil.notBlank(xc.mol))\n\t\t{\n\t\t\tlet effects = new RenderEffects();\n\t\t\tif (this.layout.includeAtomMap)\n\t\t\t{\n\t\t\t\teffects.atomDecoText = Vec.stringArray('', xc.mol.numAtoms);\n\t\t\t\teffects.atomDecoCol = Vec.numberArray(this.layout.colourAtomMap, xc.mol.numAtoms);\n\t\t\t\teffects.atomDecoSize = Vec.numberArray(0.3, xc.mol.numAtoms);\n\t\t\t\tfor (let n = 1; n <= xc.mol.numAtoms; n++) if (xc.mol.atomMapNum(n) > 0) effects.atomDecoText[n - 1] = xc.mol.atomMapNum(n).toString();\n\t\t\t}\n\n\t\t\tlet usePolicy = policy;\n\t\t\tif (xc.monochromeColour != null)\n\t\t\t{\n\t\t\t\tusePolicy = usePolicy.clone();\n\t\t\t\tusePolicy.data.foreground = xc.monochromeColour;\n\t\t\t\tusePolicy.data.atomCols = Vec.numberArray(xc.monochromeColour, usePolicy.data.atomCols.length);\n\t\t\t}\n\n\t\t\tlet arrmol = new ArrangeMolecule(xc.mol, this.layout.measure, usePolicy, effects);\n\t\t\tarrmol.arrange();\n\t\t\tarrmol.squeezeInto(bx, by, bw, bh, 0);\n\t\t\tbaseY = this.calculateMoleculeBaseline(arrmol) ?? baseY;\n\n\t\t\tif (this.preDrawMolecule) this.preDrawMolecule(vg, idx, xc, arrmol);\n\n\t\t\tlet drawmol = new DrawMolecule(arrmol, vg);\n\t\t\tdrawmol.draw();\n\n\t\t\tif (this.postDrawMolecule) this.postDrawMolecule(vg, idx, xc, arrmol);\n\n\t\t\tthis.molDrawn[idx] = arrmol;\n\t\t}\n\n\t\tif (xc.leftNumer && !xc.leftDenom)\n\t\t{\n\t\t\tvg.drawText(stoichPos.tx, baseY, xc.leftNumer, xc.fszLeft, policy.data.foreground, TextAlign.Left | TextAlign.Middle);\n\t\t}\n\t\telse if (xc.leftNumer && xc.leftDenom)\n\t\t{\n\t\t\tvg.drawText(stoichPos.tx, baseY, xc.leftNumer, xc.fszLeft, policy.data.foreground, TextAlign.Centre | TextAlign.Bottom);\n\t\t\tvg.drawText(stoichPos.tx, baseY + stoichPos.th, xc.leftDenom, xc.fszLeft, policy.data.foreground, TextAlign.Centre | TextAlign.Top);\n\t\t\tvg.drawLine(stoichPos.lx, baseY, stoichPos.lx + stoichPos.lw, baseY, policy.data.foreground, this.scale * 0.03);\n\t\t}\n\t}\n\tprivate drawSymbolArrow(xc:ArrangeComponent):void\n\t{\n\t\tlet bx = xc.box.x + xc.padding, by = xc.box.y + xc.padding;\n\t\tlet bw = xc.box.w - 2 * xc.padding, bh = xc.box.h - 2 * xc.padding;\n\n\t\tif (bw > bh)\n\t\t\tthis.drawArrow(bx, by + 0.5 * bh, bx + bw, by + 0.5 * bh, bh, this.policy.data.foreground, this.scale * 0.05);\n\t\telse\n\t\t\tthis.drawArrow(bx + 0.5 * bw, by, bx + 0.5 * bw, by + bh, bw, this.policy.data.foreground, this.scale * 0.05);\n\t}\n\tprivate drawSymbolPlus(xc:ArrangeComponent):void\n\t{\n\t\tlet vg = this.vg, policy = this.policy;\n\t\tlet x1 = xc.box.x + xc.padding, y1 = xc.box.y + xc.padding;\n\t\tlet x3 = x1 + xc.box.w - 2 * xc.padding, y3 = y1 + xc.box.h - 2 * xc.padding;\n\t\tlet x2 = 0.5 * (x1 + x3), y2 = 0.5 * (y1 + y3);\n\t\tlet lw = 0.2 * 0.5 * (x3 - x1 + y3 - y1);\n\n\t\tvg.drawLine(x1, y2, x3, y2, policy.data.foreground, lw);\n\t\tvg.drawLine(x2, y1, x2, y3, policy.data.foreground, lw);\n\t}\n\tprivate drawAnnotation(annot:number, bx:number, by:number, bw:number, bh:number):void\n\t{\n\t\tlet vg = this.vg, policy = this.policy;\n\t\tlet sz = bw, x2 = bx + bw, y2 = by + bh, x1 = x2 - sz, y1 = by;\n\t\tif (annot == ArrangeComponentAnnot.Primary) y2 = y1 + sz;\n\t\telse if (annot == ArrangeComponentAnnot.Waste) y1 = y2 - sz;\n\n\t\t//vg.drawRect(x1,y1,x2-x1,y2-y1,0x000000,1,NOCOLOUR);\n\n\t\tif (annot == ArrangeComponentAnnot.Primary)\n\t\t{\n\t\t\tlet cx = 0.5 * (x1 + x2), cy = 0.5 * (y1 + y2), ext = 0.25 * sz;\n\t\t\tlet px = [cx, cx + 0.866 * ext, cx + 0.866 * ext, cx, cx - 0.866 * ext, cx - 0.866 * ext];\n\t\t\tlet py = [cy - ext, cy - 0.5 * ext, cy + 0.5 * ext, cy + ext, cy + 0.5 * ext, cy - 0.5 * ext];\n\t\t\tlet lw = 0.05 * this.scale;\n\t\t\tvg.drawLine(px[0], py[0], px[3], py[3], policy.data.foreground, lw);\n\t\t\tvg.drawLine(px[1], py[1], px[4], py[4], policy.data.foreground, lw);\n\t\t\tvg.drawLine(px[2], py[2], px[5], py[5], policy.data.foreground, lw);\n\t\t\tlet inset = 0.1 * sz;\n\t\t\tvg.drawOval(x1 + 0.5 * sz, y1 + 0.5 * sz, 0.5 * sz - inset, 0.5 * sz - inset, policy.data.foreground, lw, MetaVector.NOCOLOUR);\n\t\t}\n\t\telse if (annot == ArrangeComponentAnnot.Waste)\n\t\t{\n\t\t\tlet cx = x1 + 0.7 * sz, cy = 0.5 * (y1 + y2), quart = 0.25 * sz;\n\t\t\tlet lw = 0.05 * this.scale;\n\n\t\t\tlet px = [x1 + 0.1 * sz, cx - quart, cx, cx, cx];\n\t\t\tlet py = [y1, y1, y1, cy - quart, cy];\n\t\t\tlet ctrl = [false, false, true, false, false];\n\t\t\tvg.drawPath(px, py, ctrl, false, policy.data.foreground, lw, MetaVector.NOCOLOUR, false);\n\n\t\t\tfor (let n = 0; n < 4; n++)\n\t\t\t{\n\t\t\t\tlet y = cy + n * 0.45 * sz * (1.0 / 3), dw = (3.1 - n) * 0.1 * sz;\n\t\t\t\tvg.drawLine(cx - dw, y, cx + dw, y, policy.data.foreground, lw);\n\t\t\t}\n\t\t}\n\t\telse if (annot == ArrangeComponentAnnot.Implied)\n\t\t{\n\t\t\tlet tw = 0.5 * sz, th = 0.75 * sz;\n\t\t\tlet cx = x2 - 0.5 * tw, cy = y1 + 0.5 * th;\n\t\t\tlet ty = y1 + 0.25 * th, dsz = sz * 0.1, hsz = 0.5 * dsz;\n\t\t\tlet lw = 0.05 * this.scale, fg = policy.data.foreground;\n\n\t\t\tvg.drawLine(cx, y1, cx, y1 + th, fg, lw);\n\t\t\tvg.drawLine(x2 - tw, ty, x2, ty, fg, lw);\n\t\t\tvg.drawLine(x2 - tw, cy, x2, cy, fg, lw);\n\t\t\tvg.drawOval(x2 - tw + hsz, y1 + th - hsz, hsz, hsz, 0, 0, fg);\n\t\t\tvg.drawOval(x2 - hsz, y1 + th - hsz, hsz, hsz, 0, 0, fg);\n\t\t}\n\t}\n\n\tprivate drawArrow(x1:number, y1:number, x2:number, y2:number, headsz:number, colour:number, linesz:number):void\n\t{\n\t\tlet dx = x2 - x1, dy = y2 - y1, invD = invZ(norm_xy(dx, dy));\n\t\tdx *= invD;\n\t\tdy *= invD;\n\t\tlet ox = dy, oy = -dx;\n\t\tlet hx = x2 - dx * headsz, hy = y2 - dy * headsz;\n\t\tlet px =\n\t\t[\n\t\t\tx1 + ox * 0.5 * linesz,\n\t\t\thx + ox * 0.5 * linesz,\n\t\t\thx + ox * 0.5 * headsz,\n\t\t\tx2,\n\t\t\thx - ox * 0.5 * headsz,\n\t\t\thx - ox * 0.5 * linesz,\n\t\t\tx1 - ox * 0.5 * linesz\n\t\t];\n\t\tlet py =\n\t\t[\n\t\t\ty1 + oy * 0.5 * linesz,\n\t\t\thy + oy * 0.5 * linesz,\n\t\t\thy + oy * 0.5 * headsz,\n\t\t\ty2,\n\t\t\thy - oy * 0.5 * headsz,\n\t\t\thy - oy * 0.5 * linesz,\n\t\t\ty1 - oy * 0.5 * linesz\n\t\t];\n\t\tthis.vg.drawPoly(px, py, MetaVector.NOCOLOUR, 0, colour, true);\n\t}\n\n\t// finds a Y-position that runs through approximately the centre of the molecule, for purposes of sub-positioning; returns null if there's nothing\n\t// really meaningful\n\tprivate calculateMoleculeBaseline(arrmol:ArrangeMolecule):number\n\t{\n\t\tlet mol = arrmol.getMolecule();\n\t\tlet midY = mol.boundary().midY();\n\t\tlet ax = Number.POSITIVE_INFINITY, ay:number = null, baseY:number = null;\n\t\tconst TOLERANCE = 0.1;\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t{\n\t\t\tlet x = mol.atomX(n), y = mol.atomY(n);\n\t\t\tif (Math.abs(y - midY) < TOLERANCE && x < ax)\n\t\t\t{\n\t\t\t\t[ax, ay] = [x, y];\n\t\t\t\tbaseY = arrmol.getPoint(n - 1).oval.cy;\n\t\t\t}\n\t\t}\n\n\t\treturn baseY;\n\t}\n}\n\n","/*\n\tWebMolKit\n\n\t(c) 2010-2018 Molecular Materials Informatics, Inc.\n\n\tAll rights reserved\n\n\thttp://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {DataSheet, DataSheetColumn} from '../data/DataSheet';\nimport {Molecule} from '../data/Molecule';\nimport {MoleculeStream} from '../data/MoleculeStream';\nimport {MolUtil} from '../data/MolUtil';\nimport {OutlineMeasurement} from '../gfx/ArrangeMeasurement';\nimport {ArrangeMolecule} from '../gfx/ArrangeMolecule';\nimport {DrawMolecule} from '../gfx/DrawMolecule';\nimport {MetaVector} from '../gfx/MetaVector';\nimport {RenderEffects, RenderPolicy} from '../gfx/Rendering';\nimport {Vec} from '../util/Vec';\nimport {Aspect, AspectGraphicRendering} from './Aspect';\nimport {registerAspect} from './AspectList';\n\n/*\n\tSAR Table: provides scaffold/substituent/molecule equivalence based on fragment placeholders (R-groups).\n\n\tNote that the aspect also includes the concept of \"fields\", with predefined units and ranges and rendering information. This\n\twas put to good effect in the eponymous mobile app, but is now deprecated: these information are stored as a pass-through for\n\tcompatibility purposes.\n*/\n\n// description of the overall structure of the aspect\ninterface SARTableFields\n{\n\t// column names for underlying content\n\tconstruct:string; // molecule\n\tlocked:string; // boolean\n\tscaffold:string; // molecule\n\tsubstituents:string[]; // molecule\n\n\t// additional configuration lines from the header, implemented as a passthrough: stored for compatibility, but not used anymore\n\tmetadata:string[];\n}\n\n// a single entry, in a workable form\ninterface SARTableEntry\n{\n\tconstruct:Molecule;\n\tlocked:boolean;\n\tscaffold:Molecule;\n\tsubstNames:string[];\n\tsubstituents:Molecule[];\n}\n\nexport class SARTable extends Aspect\n{\n\tpublic static CODE = 'org.mmi.aspect.SARTable';\n\tpublic static NAME = 'SAR Table';\n\n\tprivate static DESCR_CONSTRUCT = 'Structure of constructed molecule';\n\tprivate static DESCR_LOCKED = 'Whether constructed molecule should be rebuilt';\n\tprivate static DESCR_SCAFFOLD = 'Decorated core scaffold of molecule';\n\tprivate static DESCR_SUBSTITUENT = 'Substituent fragment to be attached to scaffold';\n\n\t// indices that can be used to request specific graphics\n\tpublic static RENDER_CONSTRUCT = 0;\n\tpublic static RENDER_SCAFFOLD = 1;\n\tpublic static RENDER_SUBSTITUENT = 2; // (and beyond)\n\n\t// ----------------- public methods -----------------\n\n\t// used to test if a datasheet has the appropriate metadata flagging it as a feedstock-containing datasheet\n\tpublic static isSARTable(ds:DataSheet):boolean\n\t{\n\t\tfor (let n = 0; n < ds.numExtensions; n++) if (ds.getExtType(n) == SARTable.CODE) return true;\n\t\treturn false;\n\t}\n\n\tconstructor(ds?:DataSheet, allowModify?:boolean)\n\t{\n\t\tsuper(SARTable.CODE, ds, allowModify);\n\t\tthis.setup();\n\t}\n\n\t// data access\n\tpublic getFields():SARTableFields\n\t{\n\t\tfor (let n = 0; n < this.ds.numExtensions; n++) if (this.ds.getExtType(n) == SARTable.CODE) return this.parseMetaData(this.ds.getExtData(n));\n\t\treturn null;\n\t}\n\tpublic setFields(fields:SARTableFields):void\n\t{\n\t\tlet content = this.formatMetaData(fields);\n\t\tfor (let n = 0; n < this.ds.numExtensions; n++) if (this.ds.getExtType(n) == SARTable.CODE)\n\t\t{\n\t\t\tthis.ds.setExtData(n, content);\n\t\t\treturn;\n\t\t}\n\t\tthis.ds.appendExtension(SARTable.NAME, SARTable.CODE, content);\n\t}\n\tpublic getEntry(row:number):SARTableEntry\n\t{\n\t\tlet fields = this.getFields();\n\t\tlet entry:SARTableEntry =\n\t\t{\n\t\t\tconstruct: this.ds.getMolecule(row, fields.construct),\n\t\t\tlocked: !!this.ds.getBoolean(row, fields.locked),\n\t\t\tscaffold: this.ds.getMolecule(row, fields.scaffold),\n\t\t\tsubstNames: [],\n\t\t\tsubstituents: []\n\t\t};\n\t\tfor (let subst of fields.substituents)\n\t\t{\n\t\t\tentry.substNames.push(subst);\n\t\t\tentry.substituents.push(this.ds.getMolecule(row, subst));\n\t\t}\n\t\treturn entry;\n\t}\n\tpublic setEntry(row:number, entry:SARTableEntry):void\n\t{\n\t\tlet fields = this.getFields();\n\n\t\tlet colConstruct = this.ds.findColByName(fields.construct, DataSheetColumn.Molecule);\n\t\tif (colConstruct >= 0) this.ds.setMolecule(row, colConstruct, entry.construct);\n\n\t\tlet colLocked = this.ds.findColByName(fields.locked, DataSheetColumn.Boolean);\n\t\tif (colLocked >= 0) this.ds.setBoolean(row, colLocked, entry.locked);\n\n\t\tlet colScaffold = this.ds.findColByName(fields.scaffold, DataSheetColumn.Molecule);\n\t\tif (colScaffold >= 0) this.ds.setMolecule(row, colScaffold, entry.scaffold);\n\n\t\tfor (let n = 0; n < fields.substituents.length; n++)\n\t\t{\n\t\t\tlet colSubst = this.ds.findColByName(fields.substituents[n], DataSheetColumn.Molecule);\n\t\t\tif (colSubst >= 0) this.ds.setMolecule(row, colSubst, entry.substituents[n]);\n\t\t}\n\t}\n\n\t// goes through the list of substituent names, and makes sure that each of them is referred to in the extensions, and also that the\n\t// underlying column exists\n\tpublic createSubstituents(tobeAdded:string[]):void\n\t{\n\t\tif (tobeAdded.length == 0) return;\n\n\t\tlet fields = this.getFields();\n\t\tlet modified = false;\n\t\tfor (let name of tobeAdded) if (fields.substituents.indexOf(name) < 0)\n\t\t{\n\t\t\tfields.substituents.push(name);\n\t\t\tthis.ds.ensureColumn(name, DataSheetColumn.Molecule, SARTable.DESCR_SUBSTITUENT);\n\t\t\tmodified = true;\n\t\t}\n\t\tif (modified) this.setFields(fields);\n\t}\n\n\t// general purpose: returns true if an atom is considered to be an attachment placeholder\n\tpublic static isAttachment(mol:Molecule, atom:number):boolean\n\t{\n\t\treturn mol.atomicNumber(atom) == 0 && !MolUtil.hasAbbrev(mol, atom) && mol.atomAdjCount(atom) == 1;\n\t}\n\n\t// ----------------- private methods -----------------\n\n\t// workhorse for the constructor\n\tprivate setup():void\n\t{\n\t\tthis.parseAndCorrect();\n\t}\n\n\t// assuming that the underlying datasheet definitely is a datasheet, makes any necessary corrections to force it into compliance\n\tprivate parseAndCorrect():void\n\t{\n\t\tlet fields:SARTableFields =\n\t\t{\n\t\t\tconstruct: 'Molecule',\n\t\t\tlocked: 'Molecule_locked',\n\t\t\tscaffold: 'Scaffold',\n\t\t\tsubstituents: [],\n\t\t\tmetadata: []\n\t\t};\n\n\t\tlet got = false;\n\t\tfor (let n = 0; n < this.ds.numExtensions; n++) if (this.ds.getExtType(n) == SARTable.CODE)\n\t\t{\n\t\t\tfields = this.parseMetaData(this.ds.getExtData(n));\n\t\t\tgot = true;\n\t\t\tbreak;\n\t\t}\n\n\t\tthis.ds.ensureColumn(fields.construct, DataSheetColumn.Molecule, SARTable.DESCR_CONSTRUCT);\n\t\tthis.ds.ensureColumn(fields.locked, DataSheetColumn.Boolean, SARTable.DESCR_LOCKED);\n\t\tthis.ds.ensureColumn(fields.scaffold, DataSheetColumn.Molecule, SARTable.DESCR_SCAFFOLD);\n\t\tfor (let subst of fields.substituents) this.ds.ensureColumn(subst, DataSheetColumn.Molecule, SARTable.DESCR_SUBSTITUENT);\n\n\t\tif (!got)\n\t\t{\n\t\t\tlet content = this.formatMetaData(fields);\n\t\t\tthis.ds.appendExtension(SARTable.NAME, SARTable.CODE, content);\n\t\t}\n\t}\n\n\t// interprets the string metadata from the extensions\n\tprivate parseMetaData(content:string):SARTableFields\n\t{\n\t\tlet fields:SARTableFields = {construct: null, locked: null, scaffold: null, substituents: [], metadata: []};\n\n\t\tfor (let line of content.split(/\\r?\\n/))\n\t\t{\n\t\t\tlet pos = line.indexOf('=');\n\t\t\tif (pos < 0) continue;\n\t\t\tlet key = line.substring(0, pos), val = line.substring(pos + 1);\n\t\t\tif (key == 'field')\n\t\t\t{\n\t\t\t\tlet bits = val.split(',');\n\t\t\t\tif (bits.length >= 3)\n\t\t\t\t{\n\t\t\t\t\tlet type = bits[0], name = MoleculeStream.skUnescape(bits[1]);\n\t\t\t\t\tif (type == 'construct')\n\t\t\t\t\t{\n\t\t\t\t\t\tfields.construct = name;\n\t\t\t\t\t\tfields.locked = name + '_locked';\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\telse if (type == 'scaffold') {fields.scaffold = name; continue;}\n\t\t\t\t\telse if (type == 'substituent') {fields.substituents.push(name); continue;}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfields.metadata.push(line);\n\t\t}\n\n\t\treturn fields;\n\t}\n\n\t// deserialises the header metadata\n\tprivate formatMetaData(fields:SARTableFields):string\n\t{\n\t\tlet content = '';\n\t\tcontent += 'field=construct,' + MoleculeStream.skEscape(fields.construct) + ',\\n';\n\t\tcontent += 'field=scaffold,' + MoleculeStream.skEscape(fields.scaffold) + ',\\n';\n\t\tfor (let subst of fields.substituents) content += 'field=substituent,' + MoleculeStream.skEscape(subst) + ',\\n';\n\t\tfor (let meta of fields.metadata) content += meta + '\\n';\n\t\treturn content;\n\t}\n\n\t// ------------------ aspect implementation --------------------\n\n\tpublic plainHeading():string {return SARTable.NAME;}\n\n\tpublic isColumnReserved(colName:string):boolean\n\t{\n\t\treturn this.areColumnsReserved([colName])[0];\n\t}\n\n\tpublic areColumnsReserved(colNames:string[]):boolean[]\n\t{\n\t\tlet fields = this.getFields();\n\t\tlet used = new Set<string>();\n\t\tused.add(fields.construct);\n\t\tused.add(fields.locked);\n\t\tused.add(fields.scaffold);\n\t\tfor (let subst of fields.substituents) used.add(subst);\n\n\t\tlet reserved = Vec.booleanArray(false, colNames.length);\n\t\tfor (let n = 0; n < colNames.length; n++) reserved[n] = used.has(colNames[n]);\n\t\treturn reserved;\n\t}\n\n\tpublic numGraphicRenderings(row:number):number\n\t{\n\t\tlet fields = this.getFields();\n\t\treturn 2 + fields.substituents.length;\n\t}\n\tpublic produceGraphicRendering(row:number, idx:number, policy:RenderPolicy):AspectGraphicRendering\n\t{\n\t\tlet fields = this.getFields(), ds = this.ds;\n\n\t\tif (idx == SARTable.RENDER_CONSTRUCT)\n\t\t{\n\t\t\tlet mol = ds.getMolecule(row, fields.construct);\n\t\t\tlet metavec = new MetaVector();\n\n\t\t\tif (MolUtil.notBlank(mol))\n\t\t\t{\n\t\t\t\tlet effects = new RenderEffects();\n\n\t\t\t\t// recolour the core scaffold, and add boundary notation\n\t\t\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (mol.atomMapNum(n) > 0) effects.colAtom[n] = 0x096E6F;\n\t\t\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t\t\t{\n\t\t\t\t\tlet m1 = mol.atomMapNum(mol.bondFrom(n)), m2 = mol.atomMapNum(mol.bondTo(n));\n\t\t\t\t\tif (m1 > 0 && m2 > 0) effects.colBond[n] = 0x096E6F;\n\t\t\t\t\telse if (m1 > 0 || m2 > 0) effects.dottedBondCross[n] = 0x606060;\n\t\t\t\t}\n\n\t\t\t\tlet measure = new OutlineMeasurement(0, 0, policy.data.pointScale);\n\t\t\t\tlet layout = new ArrangeMolecule(mol, measure, policy, effects);\n\t\t\t\tlayout.arrange();\n\n\t\t\t\tnew DrawMolecule(layout, metavec).draw();\n\t\t\t}\n\t\t\telse metavec.drawText(0, 0, '?', 15, 0x000000);\n\n\t\t\tmetavec.normalise();\n\t\t\treturn {name: fields.construct, metavec: metavec};\n\t\t}\n\t\telse if (idx == SARTable.RENDER_SCAFFOLD)\n\t\t{\n\t\t\tlet mol = ds.getMolecule(row, fields.scaffold);\n\t\t\tlet metavec = new MetaVector();\n\n\t\t\tif (MolUtil.notBlank(mol))\n\t\t\t{\n\t\t\t\tlet effects = new RenderEffects();\n\n\t\t\t\t// decorate substituents: different display depending on whether matching substituents are available\n\t\t\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (SARTable.isAttachment(mol, n))\n\t\t\t\t{\n\t\t\t\t\tlet isDefined = false;\n\t\t\t\t\tlet el = mol.atomElement(n);\n\t\t\t\t\touter: for (let colName of fields.substituents)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet subst = ds.getMolecule(row, colName);\n\t\t\t\t\t\tif (subst != null) for (let i = 1; i <= subst.numAtoms; i++)\n\t\t\t\t\t\t\tif (subst.atomElement(i) == el || (subst.atomElement(i) == 'R' && el == colName))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tisDefined = true;\n\t\t\t\t\t\t\tbreak outer;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\teffects.colAtom[n] = isDefined ? 0x096E6F : 0xFF0000;\n\t\t\t\t\teffects.dottedRectOutline[n] = isDefined ? 0x808080 : 0xFF0000;\n\t\t\t\t}\n\n\t\t\t\tlet measure = new OutlineMeasurement(0, 0, policy.data.pointScale);\n\t\t\t\tlet layout = new ArrangeMolecule(mol, measure, policy, effects);\n\t\t\t\tlayout.arrange();\n\n\t\t\t\tnew DrawMolecule(layout, metavec).draw();\n\t\t\t}\n\t\t\telse metavec.drawText(0, 0, '?', 15, 0x000000);\n\n\t\t\tmetavec.normalise();\n\t\t\treturn {name: fields.scaffold, metavec: metavec};\n\t\t}\n\t\telse if (idx >= SARTable.RENDER_SUBSTITUENT && idx < SARTable.RENDER_SUBSTITUENT + fields.substituents.length)\n\t\t{\n\t\t\tlet sidx = idx - SARTable.RENDER_SUBSTITUENT, sname = fields.substituents[sidx];\n\t\t\tlet mol = ds.getMolecule(row, sname);\n\t\t\tlet metavec = new MetaVector();\n\n\t\t\tif (MolUtil.notBlank(mol))\n\t\t\t{\n\t\t\t\tlet effects = new RenderEffects();\n\n\t\t\t\t// decorated substituents\n\t\t\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (SARTable.isAttachment(mol, n))\n\t\t\t\t{\n\t\t\t\t\teffects.colAtom[n] = 0x096E6F;\n\t\t\t\t\teffects.dottedRectOutline[n] = 0x808080;\n\t\t\t\t\t// (different colours if the attachments don't line up? or just leave it?)\n\t\t\t\t}\n\n\t\t\t\tlet measure = new OutlineMeasurement(0, 0, policy.data.pointScale);\n\t\t\t\tlet layout = new ArrangeMolecule(mol, measure, policy, effects);\n\t\t\t\tlayout.arrange();\n\n\t\t\t\tnew DrawMolecule(layout, metavec).draw();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// empty substituents get decorated in some way, depending on whether absence is justified\n\t\t\t\tlet txt = '?';\n\t\t\t\tlet scaff = ds.getMolecule(row, fields.scaffold);\n\t\t\t\tif (MolUtil.notBlank(scaff))\n\t\t\t\t{\n\t\t\t\t\ttxt = 'n/a';\n\t\t\t\t\tfor (let n = 1; n <= scaff.numAtoms; n++) if (scaff.atomElement(n) == sname) {txt = '?'; break;}\n\t\t\t\t\tif (txt == '?') for (let n = 0; n < fields.substituents.length; n++) if (n != sidx)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet subst = ds.getMolecule(row, fields.substituents[n]);\n\t\t\t\t\t\tif (MolUtil.notBlank(subst))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfor (let i = 1; i <= subst.numAtoms; i++) if (subst.atomElement(i) == sname) {txt = 'n/a'; break;} // multidentate\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tmetavec.drawText(0, 0, txt, 15, 0x000000);\n\t\t\t}\n\n\t\t\tmetavec.normalise();\n\t\t\treturn {name: sname, metavec: metavec};\n\t\t}\n\n\t\treturn null;\n\t}\n}\n\nregisterAspect(SARTable);\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {GeomUtil} from '../util/Geom';\nimport {angleDiff, angleDiffPos, DEGRAD, norm2_xyz, norm_xyz} from '../util/util';\nimport {Permutation, Vec} from '../util/Vec';\nimport {Chemistry} from './Chemistry';\nimport {MetaMolecule} from './MetaMolecule';\nimport {Molecule} from './Molecule';\nimport {MolUtil} from './MolUtil';\n\n/*\n\tCalculation of the stereochemical properties of a molecule, such as R/S and E/Z isomer labels.\n*/\n\nexport class Stereochemistry\n{\n\tprivate mol:Molecule;\n\n\t// computed stereochemistry properties\n\tprivate priority:number[]; // CIP (per atom)\n\tprivate chiralTetra:number[]; // (per atom)\n\tprivate cistransBond:number[]; // (per bond)\n\tprivate squarePlanar:number[]; // (per atom)\n\t//private chiralOcta:number[]; // (per atom)\n\tprivate isH:boolean[]; // per atom\n\n\t// ------------------ constants --------------------\n\n\tpublic static STEREO_NONE = 0; // topology does not allow any stereoisomers\n\tpublic static STEREO_POS = 1; // R or Z, depending on type\n\tpublic static STEREO_NEG = 2; // S or E, depending on type\n\tpublic static STEREO_UNKNOWN = 3; // stereocentre with no specification\n\tpublic static STEREO_BROKEN = 4; // stereocentre with contradictory stereochemistry information\n\n\t// all equivalent tetrahedral permutations\n\tpublic static RUBRIC_EQUIV_TETRA =\n\t[\n\t\t[0, 1, 2, 3], [0, 2, 3, 1], [0, 3, 1, 2], [1, 0, 3, 2], [1, 2, 0, 3], [1, 3, 2, 0],\n\t\t[2, 0, 1, 3], [2, 1, 3, 0], [2, 3, 0, 1], [3, 0, 2, 1], [3, 1, 0, 2], [3, 2, 1, 0]\n\t];\n\n\tpublic static RUBRIC_EQUIV_SIDES =\n\t[\n\t\t[0, 1, 2, 3], [1, 0, 3, 2], [2, 3, 0, 1], [3, 2, 1, 0]\n\t];\n\n\tpublic static RUBRIC_EQUIV_SQUARE =\n\t[\n\t\t[0, 1, 2, 3], [0, 3, 2, 1], [1, 2, 3, 0], [1, 0, 3, 2],\n\t\t[2, 1, 0, 3], [2, 3, 0, 1], [3, 2, 1, 0], [3, 0, 1, 2]\n\t];\n\n\tpublic static RUBRIC_EQUIV_BIPY =\n\t[\n\t\t[0, 1, 2, 3, 4], [1, 2, 0, 3, 4], [2, 0, 1, 3, 4],\n\t\t[0, 2, 1, 4, 3], [1, 0, 2, 4, 3], [2, 1, 0, 4, 3],\n\t];\n\n\tpublic static RUBRIC_EQUIV_OCTA =\n\t[\n\t\t[0, 1, 2, 3, 4, 5], [0, 3, 2, 1, 5, 4], [0, 4, 2, 5, 3, 1], [0, 5, 2, 4, 1, 3],\n\t\t[1, 0, 3, 2, 5, 4], [1, 2, 3, 0, 4, 5], [1, 4, 3, 5, 0, 2], [1, 5, 3, 4, 2, 0],\n\t\t[2, 1, 0, 3, 5, 4], [2, 3, 0, 1, 4, 5], [2, 4, 0, 5, 1, 3], [2, 5, 0, 4, 3, 1],\n\t\t[3, 0, 1, 2, 4, 5], [3, 2, 1, 0, 5, 4], [3, 4, 1, 5, 2, 0], [3, 5, 1, 4, 0, 2],\n\t\t[4, 0, 5, 2, 1, 3], [4, 1, 5, 3, 2, 0], [4, 2, 5, 0, 3, 1], [4, 3, 5, 1, 0, 2],\n\t\t[5, 0, 4, 2, 3, 1], [5, 1, 4, 3, 0, 2], [5, 2, 4, 0, 1, 3], [5, 3, 4, 1, 2, 0]\n\t];\n\n\t// ------------------ public methods --------------------\n\n\t// constructor: the metamolecule should generally have aromaticity calculated, because this can affect the priority,\n\t// and can also exclude some cases, e.g. cis/trans labels\n\tconstructor(public meta:MetaMolecule)\n\t{\n\t\tthis.mol = meta.mol;\n\n\t\tthis.priority = Vec.numberArray(0, this.mol.numAtoms);\n\t\tthis.chiralTetra = Vec.numberArray(Stereochemistry.STEREO_NONE, this.mol.numAtoms);\n\t\tthis.cistransBond = Vec.numberArray(Stereochemistry.STEREO_NONE, this.mol.numBonds);\n\t\tthis.squarePlanar = Vec.numberArray(Stereochemistry.STEREO_NONE, this.mol.numAtoms);\n\t\t//this.chiralOcta = Vec.numberArray(Stereochemistry.STEREO_NONE, this.mol.numAtoms);\n\t}\n\n\t// performs the calculation by filling in the arrays\n\tpublic calculate():void\n\t{\n\t\tthis.isH = Vec.booleanArray(false, this.mol.numAtoms);\n\t\tfor (let n = this.mol.numAtoms; n >= 1; n--) this.isH[n - 1] = this.mol.atomElement(n) == 'H';\n\n\t\tthis.buildPriority();\n\t\tthis.buildTetraChirality();\n\t\tthis.buildBondCisTrans();\n\t\tthis.buildPlanarCisTrans();\n\t\tthis.buildOctaChirality();\n\t}\n\n\t// access to calculated values; indices are 1-based\n\tpublic atomPriority(atom:number):number {return this.priority[atom - 1];}\n\tpublic atomTetraChirality(atom:number):number {return this.chiralTetra[atom - 1];}\n\tpublic bondSideStereo(bond:number):number {return this.cistransBond[bond - 1];}\n\tpublic atomPlanarStereo(atom:number):number {return this.squarePlanar[atom - 1];}\n\t//public atomOctaChirality(atom:number):number {return this.chiralOcta[atom - 1];}\n\n\t// for bulk access, sometimes more convenient\n\tpublic getPriorities():number[] {return this.priority.slice(0);}\n\tpublic getAtomTetraChiral():number[] {return this.chiralTetra.slice(0);}\n\tpublic getBondSideStereo():number[] {return this.cistransBond.slice(0);}\n\n\t// ------------------ static methods --------------------\n\n\t// convenience\n\tpublic static create(meta:MetaMolecule):Stereochemistry\n\t{\n\t\tlet stereo = new Stereochemistry(meta);\n\t\tstereo.calculate();\n\t\treturn stereo;\n\t}\n\n\t/*\n\t\tThe Rubric Methods: each of these examines an atom/bond and ascertains whether it has sufficient substituents, and\n\t\tlayout information (coordinates and/or wedges) for it to fit into a certain type of geometry-locked template, which\n\t\tcan infer chirality or restricted bond stereochemistry; the return value is an array with the adjacent indices fitted\n\t\tinto the mould, sometimes with 0 as a placeholder for implicit hydrogens or missing substituents; or null if there are\n\t\tinsufficient neighbours or geometry clues.\n\n\t\tThese methods do NOT make any judgment calls as to whether the atom types should limit to the geometry - the caller must\n\t\tprovide this logic. They also make no judgment about degeneracy, which means that the atom/bond is not necessarily\n\t\tstereochemically active.\n\t*/\n\n\t//\n\t//                    4    3\n\t// assignment style:   \\\\ #      (3 is pointing down, 4 is pointing up)\n\t//                       A\n\t//                     /   \\\n\t//                    1     2\n\tpublic static rubricTetrahedral(mol:Molecule, atom:number):number[]\n\t{\n\t\t// must have at least 3 actual neighbours, and actual+virtual H's of 4\n\t\tif (mol.atomAdjCount(atom) < 3 || mol.atomAdjCount(atom) + mol.atomHydrogens(atom) != 4) return null;\n\n\t\t// must have at least one wedge originating from the atom, and no squigglies\n\t\tlet adjBonds = mol.atomAdjBonds(atom);\n\t\tlet hasWedge = false;\n\t\tfor (let n = 0; n < adjBonds.length; n++)\n\t\t{\n\t\t\tlet bt = mol.bondType(adjBonds[n]);\n\t\t\tif (bt == Molecule.BONDTYPE_UNKNOWN) return null; // squiggly\n\t\t\tif (mol.bondFrom(adjBonds[n]) != atom) continue;\n\t\t\tif (bt == Molecule.BONDTYPE_INCLINED || bt == Molecule.BONDTYPE_DECLINED) hasWedge = true;\n\t\t}\n\t\tif (!hasWedge && !mol.is3D()) return null;\n\n\t\t// pull out coordinates, including fakes for Z\n\t\tlet adj = mol.atomAdjList(atom);\n\t\tlet x = [0, 0, 0, 0];\n\t\tlet y = [0, 0, 0, 0];\n\t\tlet z = [0, 0, 0, 0];\n\t\tlet numShort = 0, numWedges = 0;\n\t\tfor (let n = 0; n < adjBonds.length; n++)\n\t\t{\n\t\t\tconst bfr = mol.bondFrom(adjBonds[n]), bt = mol.bondType(adjBonds[n]);\n\t\t\tx[n] = mol.atomX(adj[n]) - mol.atomX(atom);\n\t\t\ty[n] = mol.atomY(adj[n]) - mol.atomY(atom);\n\t\t\tif (mol.is3D())\n\t\t\t{\n\t\t\t\tz[n] = mol.atomZ(adj[n]) - mol.atomZ(atom);\n\t\t\t}\n\t\t\telse if (bfr == atom)\n\t\t\t{\n\t\t\t\tif (bt == Molecule.BONDTYPE_INCLINED)\n\t\t\t\t{\n\t\t\t\t\tz[n] = 1;\n\t\t\t\t\tnumWedges++;\n\t\t\t\t}\n\t\t\t\telse if (bt == Molecule.BONDTYPE_DECLINED)\n\t\t\t\t{\n\t\t\t\t\tz[n] = -1;\n\t\t\t\t\tnumWedges++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// normalise the length, and stop if it's insane\n\t\t\tlet dsq = norm_xyz(x[n], y[n], z[n]);\n\t\t\tif (dsq < 0.01 * 0.01)\n\t\t\t{\n\t\t\t\tnumShort++;\n\t\t\t\tif (numShort > 1) return null; // second one is a dealbreaker\n\t\t\t}\n\t\t}\n\n\t\t// build implicit-H position\n\t\tif (adjBonds.length == 3)\n\t\t{\n\t\t\tadj.push(0);\n\t\t\tif (!mol.is3D() && numWedges == 1)\n\t\t\t{\n\t\t\t\t// special deal it's flat, so order the bonds by angle, and push in a canonical set of coordinates; this renormalisation can\n\t\t\t\t// fix some weird drawings, which is common for sugars, and various other things\n\t\t\t\tlet th0 = Math.atan2(y[0], x[0]), th1 = Math.atan2(y[1], x[1]), th2 = Math.atan2(y[2], x[2]);\n\t\t\t\tlet i1 = 1, i2 = 2;\n\t\t\t\tif (angleDiffPos(th1, th0) > angleDiffPos(th2, th0))\n\t\t\t\t{\n\t\t\t\t\ti2 = 1;\n\t\t\t\t\ti1 = 2;\n\t\t\t\t}\n\n\t\t\t\tx[0] = 1.5;\n\t\t\t\ty[0] = 0;\n\t\t\t\tx[1] = -0.75;\n\t\t\t\ty[i1] = 1.3;\n\t\t\t\tx[2] = -0.75;\n\t\t\t\ty[i2] = -1.3;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// use geometry largely as-is\n\t\t\t\tx[3] = -(x[0] + x[1] + x[2]);\n\t\t\t\ty[3] = -(y[0] + y[1] + y[2]);\n\t\t\t\tz[3] = -(z[0] + z[1] + z[2]);\n\t\t\t\tlet dsq = norm2_xyz(x[3], y[3], z[3]);\n\t\t\t\tif (dsq < 0.01 * 0.01) return null;\n\t\t\t\tlet inv = 1.0 / Math.sqrt(dsq);\n\t\t\t\tx[3] *= inv;\n\t\t\t\ty[3] *= inv;\n\t\t\t\tz[3] *= inv;\n\t\t\t}\n\t\t}\n\n\t\tlet one = 0, two = 0;\n\t\tfor (let i = 1; i <= 6; i++)\n\t\t{\n\t\t\tlet a = 0, b = 0;\n\t\t\tif (i == 1) {a = 1; b = 2;}\n\t\t\telse if (i == 2) {a = 2; b = 3;}\n\t\t\telse if (i == 3) {a = 3; b = 1;}\n\t\t\telse if (i == 4) {a = 2; b = 1;}\n\t\t\telse if (i == 5) {a = 3; b = 2;}\n\t\t\telse if (i == 6) {a = 1; b = 3;}\n\t\t\tlet xx = y[a] * z[b] - y[b] * z[a] - x[0];\n\t\t\tlet yy = z[a] * x[b] - z[b] * x[a] - y[0];\n\t\t\tlet zz = x[a] * y[b] - x[b] * y[a] - z[0];\n\t\t\tif (i <= 3) one += xx * xx + yy * yy + zz * zz;\n\t\t\telse two += xx * xx + yy * yy + zz * zz;\n\t\t}\n\n\t\tif (two > one) Vec.swap(adj, 2, 3);\n\t\treturn adj;\n\t}\n\n \t//                      1   2\n\t// assignment style:     # #\tnote: the Z-axis direction is arbitrary; 1234 is equivalent to 1432\n\t//                        A\n\t//\t\t\t\t\t\t// \\\\\n\t//                      3   4\n\tpublic static rubricSquarePlanar(mol:Molecule, atom:number):number[]\n\t{\n\t\tif (mol.atomAdjCount(atom) != 4) return null;\n\n\t\t// drawing style must be one of 3 options: 2 up + 2 down, or 2 flat + (2 up/2 down)\n\t\tif (!mol.is3D())\n\t\t{\n\t\t\tlet ninc = 0, ndec = 0;\n\t\t\tfor (let b of mol.atomAdjBonds(atom))\n\t\t\t{\n\t\t\t\tlet bt = mol.bondType(b);\n\t\t\t\tif (bt == Molecule.BONDTYPE_INCLINED) ninc++;\n\t\t\t\telse if (bt == Molecule.BONDTYPE_DECLINED) ndec++;\n\t\t\t}\n\t\t\tif (ninc == 2 && ndec == 2) {}\n\t\t\telse if (ninc == 2 && ndec == 0) {}\n\t\t\telse if (ninc == 0 && ndec == 2) {}\n\t\t\telse return null;\n\t\t}\n\n\t\t// determine all the vector outgoings; ensure that position 3 is opposite position 1; other than that, the order is arbitrary\n\t\tlet adj = mol.atomAdjList(atom);\n\t\tlet v0 = MolUtil.atomVec3(mol, atom);\n\t\tlet v1 = Vec.sub(MolUtil.atomVec3(mol, adj[0]), v0);\n\t\tlet v2 = Vec.sub(MolUtil.atomVec3(mol, adj[1]), v0);\n\t\tlet v3 = Vec.sub(MolUtil.atomVec3(mol, adj[2]), v0);\n\t\tlet v4 = Vec.sub(MolUtil.atomVec3(mol, adj[3]), v0);\n\n\t\tfor (let v of [v1, v2, v3, v4])\n\t\t{\n\t\t\tlet dsq = norm2_xyz(v[0], v[1], v[2]);\n\t\t\tif (dsq < 0.01 * 0.01) continue;\n\t\t\tlet inv = 1.0 / Math.sqrt(dsq);\n\t\t\tv[0] *= inv;\n\t\t\tv[1] *= inv;\n\t\t\tv[2] *= inv;\n\t\t}\n\n\t\tlet d2 = GeomUtil.dist2(v1, v2), d3 = GeomUtil.dist2(v1, v3), d4 = GeomUtil.dist2(v1, v4);\n\t\tif (d2 > d3 && d2 >= d4)\n\t\t{\n\t\t\tVec.swap(adj, 1, 2);\n\t\t\t[v2, v3] = [v3, v2];\n\t\t}\n\t\telse if (d4 > d3)\n\t\t{\n\t\t\tVec.swap(adj, 3, 2);\n\t\t\t[v3, v4] = [v4, v3];\n\t\t}\n\n\t\t// circle around and make sure the acute angles are with reasonable bounds; 90 degrees is ideal, +/- 45 is OK\n\t\t// for 3D cases we don't have the wedge filter, so make the constraint tighter\n\t\tconst MIN_ANGLE = (mol.is3D() ? 80 : 45) * DEGRAD;\n\t\tconst MAX_ANGLE = (mol.is3D() ? 100 : 135) * DEGRAD;\n\t\tconst th12 = GeomUtil.acuteAngle(v1, v2);\n\t\tif (th12 < MIN_ANGLE || th12 > MAX_ANGLE) return null;\n\t\tconst th23 = GeomUtil.acuteAngle(v2, v3);\n\t\tif (th23 < MIN_ANGLE || th23 > MAX_ANGLE) return null;\n\t\tconst th34 = GeomUtil.acuteAngle(v3, v4);\n\t\tif (th34 < MIN_ANGLE || th34 > MAX_ANGLE) return null;\n\t\tconst th41 = GeomUtil.acuteAngle(v4, v1);\n\t\tif (th41 < MIN_ANGLE || th41 > MAX_ANGLE) return null;\n\t\treturn adj;\n\t}\n\n\t//                        5  3\n\t// assignment style:      | #    (4->5 is the \"axial up\" and [1,2,3] follow the right hand vector rule)\n\t//                     1--A      (only position 1 is allowed to be vacant, and only 2 & 3 can be opposite)\n\t//                        |\\\\\n\t//                        4  2\n\tpublic static rubricBipyrimidal(mol:Molecule, atom:number):number[]\n\t{\n\t\tconst nadj = mol.atomAdjCount(atom);\n\t\tif (nadj != 4 && nadj != 5) return null;\n\n\t\t// if sketch, must have exactly 1 up & 1 down\n\t\tlet atom2 = 0, atom3 = 0;\n\t\tlet adj = mol.atomAdjList(atom), bonds = mol.atomAdjBonds(atom);\n\t\tif (!mol.is3D())\n\t\t{\n\t\t\tfor (let n = 0; n < adj.length; n++)\n\t\t\t{\n\t\t\t\tif (mol.bondType(bonds[n]) == Molecule.BONDTYPE_INCLINED)\n\t\t\t\t{\n\t\t\t\t\tif (atom2 > 0) return null;\n\t\t\t\t\tatom2 = adj[n];\n\t\t\t\t}\n\t\t\t\telse if (mol.bondType(bonds[n]) == Molecule.BONDTYPE_DECLINED)\n\t\t\t\t{\n\t\t\t\t\tif (atom3 > 0) return null;\n\t\t\t\t\tatom3 = adj[n];\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (atom2 == 0 || atom3 == 0) return null;\n\n\t\t\t// the two bonds with opposite wedges cannot be close to opposite\n\t\t\tlet th1 = Math.atan2(mol.atomY(atom2) - mol.atomY(atom), mol.atomX(atom2) - mol.atomX(atom));\n\t\t\tlet th2 = Math.atan2(mol.atomY(atom3) - mol.atomY(atom), mol.atomX(atom3) - mol.atomX(atom));\n\t\t\tif (Math.abs(angleDiff(th1, th2)) > 160 * DEGRAD) return null;\n\t\t}\n\n\t\t// get all the relative emergent vectors\n\t\tlet v0 = MolUtil.atomVec3(mol, atom);\n\t\tlet v:number[][] = [[], [], [], [], []];\n\t\tconst THRESH = 0.1; // bond lengths in general must be this long, otherwise the structure is unworthy\n\t\tfor (let n = 0; n < nadj; n++)\n\t\t{\n\t\t\tv[n] = Vec.sub(MolUtil.atomVec3(mol, adj[n]), v0);\n\t\t\tconst mag = GeomUtil.magnitude(v[n]);\n\t\t\tif (mag < THRESH) return null;\n\t\t\tVec.mulBy(v[n], 1.0 / mag);\n\n\t\t\t// if it's 2D, atom2 & 3 are defined: do faux embedding\n\t\t\tif (adj[n] == atom2) v[n][2] += 1; // up\n\t\t\telse if (adj[n] == atom3) v[n][2] -= 1; // down\n\t\t}\n\n\t\t// figure out atoms 4 & 5; for 2D can rule out two candidates already\n\t\tlet atom4 = 0, atom5 = 0;\n\t\tconst ANGLE_OPPOSITE = 175 * DEGRAD;\n\t\tfor (let i = 0; i < nadj - 1; i++) if (adj[i] != atom2 && adj[i] != atom3)\n\t\t{\n\t\t\tfor (let j = i + 1; j < nadj; j++) if (adj[j] != atom2 && adj[j] != atom3)\n\t\t\t{\n\t\t\t\tlet theta = GeomUtil.acuteAngle(v[i], v[j]);\n\t\t\t\tif (theta > ANGLE_OPPOSITE)\n\t\t\t\t{\n\t\t\t\t\tif (atom4 != 0) return null; // can't have two angles close to 180 degrees\n\t\t\t\t\tatom4 = adj[i];\n\t\t\t\t\tatom5 = adj[j];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// if 3D, atoms 2 & 3 can be selected arbitrarily\n\t\tif (mol.is3D())\n\t\t{\n\t\t\tfor (let a of adj) if (a != atom4 && a != atom5)\n\t\t\t{\n\t\t\t\tif (atom2 == 0) atom2 = a;\n\t\t\t\telse if (atom3 == 0) atom3 = a;\n\t\t\t}\n\t\t}\n\t\tif (!atom4 || !atom5) return null;\n\n\t\tlet v1 = null;\n\t\tlet v2 = v[adj.indexOf(atom2)];\n\t\tlet v3 = v[adj.indexOf(atom3)];\n\t\tlet v4 = v[adj.indexOf(atom4)];\n\t\tlet v5 = v[adj.indexOf(atom5)];\n\n\t\t// the atom3 position is either real or virtual\n\t\tlet atom1 = 0;\n\t\tif (nadj == 5)\n\t\t{\n\t\t\tfor (let n = 0; n < nadj; n++) if (adj[n] != atom2 && adj[n] != atom3 && adj[n] != atom4 && adj[n] != atom5)\n\t\t\t{\n\t\t\t\tatom1 = adj[n];\n\t\t\t\tv1 = v[n];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\telse // create a virtual atom\n\t\t{\n\t\t\tv1 = [0, 0, 0];\n\t\t\tv1 = Vec.sub(v1, v2);\n\t\t\tv1 = Vec.sub(v1, v3);\n\t\t\tconst mag = GeomUtil.magnitude(v1);\n\t\t\tif (mag < THRESH) return null; // (is this being unfair at all?)\n\t\t\tVec.mulBy(v1, 1.0 / mag);\n\t\t}\n\n\t\t// if the cross product of 4->5 x 0->1 is closer to 2, parity is even\n\t\tlet v45 = Vec.sub(v5, v4);\n\t\tlet cross = GeomUtil.crossProduct(v45, v1);\n\t\tlet dsq2 = GeomUtil.dist2(cross, v2), dsq3 = GeomUtil.dist2(cross, v3);\n\t\tif (dsq2 < dsq3)\n\t\t\treturn [atom1, atom2, atom3, atom4, atom5];\n\t\telse\n\t\t\treturn [atom1, atom2, atom3, atom5, atom4];\n\t}\n\n\t//                        6 2\n\t// assignment style:      |#    (5->6 is the \"axial up\" and [1,2,3,4] follow the right hand vector rule)\n\t//                     3--A--1\n\t//\t\t\t\t\t\t//|\n\t//                     4  5\n\tpublic static rubricOctahedral(mol:Molecule, atom:number):number[]\n\t{\n\t\tconst nadj = mol.atomAdjCount(atom);\n\t\tif (nadj != 5 && nadj != 6) return null;\n\n\t\tlet adj = mol.atomAdjList(atom), bonds = mol.atomAdjBonds(atom);\n\t\tif (nadj == 5) {adj.push(0); bonds.push(0);}\n\n\t\t// if a 2D sketch, make sure there are enough wedges\n\t\tif (!mol.is3D())\n\t\t{\n\t\t\tlet numWedges = 0;\n\t\t\tfor (let b of bonds) if (b > 0)\n\t\t\t{\n\t\t\t\tconst bt = mol.bondType(b);\n\t\t\t\tif (bt == Molecule.BONDTYPE_INCLINED || bt == Molecule.BONDTYPE_DECLINED) numWedges++;\n\t\t\t}\n\t\t\tif ((nadj == 5 && numWedges < 1) || (nadj == 6 && numWedges < 2)) return null;\n\t\t}\n\n\t\tconst THRESH = 0.1; // bond lengths in general must be this long, otherwise the structure is unworthy\n\n\t\t// get all the relative emergent vectors; generate faux embedding for wedges\n\t\tlet v0 = MolUtil.atomVec3(mol, atom);\n\t\tlet v:number[][] = [[], [], [], [], [], []];\n\t\tfor (let n = 0; n < nadj; n++)\n\t\t{\n\t\t\tv[n] = MolUtil.atomVec3(mol, adj[n]);\n\t\t\tVec.subFromArray(v[n], v0);\n\t\t\tlet mag = GeomUtil.magnitude(v[n]);\n\t\t\tif (mag < THRESH) return null;\n\t\t\tVec.mulBy(v[n], 1 / mag);\n\n\t\t\tlet bt = mol.bondType(bonds[n]);\n\t\t\tif (bt == Molecule.BONDTYPE_INCLINED)\n\t\t\t{\n\t\t\t\tif (mol.bondFrom(bonds[n]) == atom) v[n][2] += 1; else v[n][2] -= 1;\n\t\t\t}\n\t\t\telse if (bt == Molecule.BONDTYPE_DECLINED)\n\t\t\t{\n\t\t\t\tif (mol.bondFrom(bonds[n]) == atom) v[n][2] -= 1; else v[n][2] += 1;\n\t\t\t}\n\t\t}\n\n\t\t// if there's a missing spot, compose it from the opposite of the sum of all the other directions\n\t\tif (nadj == 5)\n\t\t{\n\t\t\tv[5] = [0, 0, 0];\n\t\t\tfor (let n = 0; n < 5; n++) Vec.subFromArray(v[5], v[n]);\n\t\t\tlet mag = GeomUtil.magnitude(v[5]);\n\t\t\tif (mag < THRESH) return null; // (is this being unfair at all?)\n\t\t\tVec.mulBy(v[5], 1 / mag);\n\t\t}\n\n\t\t// first reference: locate ligands that are as far away as possible from each other (i.e. 180 degrees), and stick these in the axial positions\n\t\tlet slots = [-1, -1, -1, -1, 0, 1];\n\t\tlet bestOpposite = GeomUtil.acuteAngle(v[0], v[1]);\n\t\tfor (let i = 0; i < 5; i++) for (let j = (i == 0 ? 2 : i + 1); j < 6; j++)\n\t\t{\n\t\t\tlet theta = GeomUtil.acuteAngle(v[i], v[j]);\n\t\t\tif (theta > bestOpposite)\n\t\t\t{\n\t\t\t\tslots[4] = i;\n\t\t\t\tslots[5] = j;\n\t\t\t\tbestOpposite = theta;\n\t\t\t}\n\t\t}\n\t\tlet axial = Vec.sub(v[slots[5]], v[slots[4]]);\n\n\t\t// second reference: locate the ligand that is as close as possible to orthogonal to the axial vector, and stick this in the first equatorial position\n\t\tlet bestOrthogonal = Number.POSITIVE_INFINITY;\n\t\tfor (let n = 0; n < 6; n++) if (n != slots[4] && n != slots[5])\n\t\t{\n\t\t\tlet delta = Math.abs((90 * DEGRAD) - GeomUtil.acuteAngle(v[n], axial));\n\t\t\tif (delta < bestOrthogonal)\n\t\t\t{\n\t\t\t\tslots[0] = n;\n\t\t\t\tbestOrthogonal = delta;\n\t\t\t}\n\t\t}\n\n\t\t// third reference: use the cross product between axial & current equatorial to grab the next two in sequence\n\t\tfor (let s = 1; s <= 2; s++)\n\t\t{\n\t\t\tlet cross = GeomUtil.crossProduct(axial, v[slots[s - 1]]);\n\t\t\tlet bestOrient = Number.POSITIVE_INFINITY;\n\n\t\t\tfor (let n = 0; n < 6; n++)\n\t\t\t{\n\t\t\t\tif (n == slots[4] || n == slots[5] || n == slots[0] || n == slots[1]) continue;\n\t\t\t\tlet delta = GeomUtil.acuteAngle(v[n], cross);\n\t\t\t\tif (delta < bestOrient)\n\t\t\t\t{\n\t\t\t\t\tslots[s] = n;\n\t\t\t\t\tbestOrient = delta;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// the last one is implied by process of elimination\n\t\tfor (let n = 0; n < 6; n++) if (slots.indexOf(n) < 0)\n\t\t{\n\t\t\tslots[3] = n;\n\t\t\tbreak;\n\t\t}\n\n\t\t/*Util.writeln(\"NOW slots = \"+Util.arrayStr(slots));\n\t\tfor (int n = 0; n < 6; n++) Util.writeln(\" position \"+(n+1)+\" -> atom \"+mol.atomElement(adj[slots[n]]));*/\n\n\t\t// convert to atom indices\n\t\tlet rubric = [0, 0, 0, 0, 0, 0];\n\t\tfor (let n = 0; n < 6; n++) rubric[n] = slots[n] < 0 ? 0 : adj[slots[n]];\n\t\treturn rubric;\n\t}\n\n\t//                      1      3\n\t//                       \\    /\n\t// assignment style:      A==B\n\t//                       /    \\\n\t//\t\t\t\t\t    2      4\n\tpublic static rubricBondSides(mol:Molecule, bond:number):number[]\n\t{\n\t\tconst bfr = mol.bondFrom(bond), bto = mol.bondTo(bond);\n\t\tconst nfr = mol.atomAdjCount(bfr), nto = mol.atomAdjCount(bto);\n\t\tif (nfr < 2 || nfr > 3 || nto < 2 || nto > 3) return null;\n\t\tlet adj1 = mol.atomAdjList(bfr), adj2 = mol.atomAdjList(bto);\n\t\tlet f1 = 0, f2 = 0, t1 = 0, t2 = 0;\n\t\tfor (let i = 0; i < adj1.length; i++)\n\t\t{\n\t\t\tif (adj1[i] != bto)\n\t\t\t{\n\t\t\t\tif (f1 == 0) f1 = adj1[i];\n\t\t\t\telse f2 = adj1[i];\n\t\t\t}\n\t\t}\n\t\tfor (let i = 0; i < adj2.length; i++)\n\t\t{\n\t\t\tif (adj2[i] != bfr)\n\t\t\t{\n\t\t\t\tif (t1 == 0) t1 = adj2[i];\n\t\t\t\telse t2 = adj2[i];\n\t\t\t}\n\t\t}\n\n\t\tif (f1 > 0 && f2 > 0 && mol.atomElement(f1) == 'H') {let f = f1; f1 = f2; f2 = f;}\n\t\tif (t1 > 0 && t2 > 0 && mol.atomElement(t1) == 'H') {let t = t1; t1 = t2; t2 = t;}\n\n\t\t// make a determination of whether the first substituents are on the same side, using the cross product; if there\n\t\t// are only 2 substituents, this ends up being definitive\n\t\tlet vfr = MolUtil.atomVec3(mol, bfr), vto = MolUtil.atomVec3(mol, bto);\n\t\tlet vbond = Vec.sub(vto, vfr);//,vt0=Vec.neg(vf0);\n\t\tlet vf1 = Vec.sub(MolUtil.atomVec3(mol, f1), vfr), vt1 = Vec.sub(MolUtil.atomVec3(mol, t1), vto);\n\n\t\tconst THRESHSQ = 0.1 * 0.1; // cross product must be this long; if not, it's either linear, or unreasonably short\n\n\t\tlet xf1 = GeomUtil.crossProduct(vf1, vbond);\n\t\tif (GeomUtil.magnitude2(xf1) < THRESHSQ) return null;\n\t\tlet xt1 = GeomUtil.crossProduct(vt1, vbond);\n\t\tif (GeomUtil.magnitude2(xt1) < THRESHSQ) return null;\n\n\t\tlet xf1N = Vec.neg(xf1);\n\t\tlet keepF1T1 = GeomUtil.dist2(xf1, xt1) < GeomUtil.dist2(xf1N, xt1);\n\t\tlet keepF2T1 = keepF1T1, keepF1T2 = keepF1T1, keepF2T2 = keepF1T1;\n\n\t\t// check the other substituents, if they are defined: these may contradict the first determination, and hence cause\n\t\t// the stereo assignment to be rejected\n\t\t// note that the determination is tolerant of hydrogen atoms that are planted pretty much on top of their heavy\n\t\t// neighbour - this can make the algorithm more tolerant to add/create hydrogen cycles\n\t\tlet vf2:number[] = null, vt2:number[] = null, xf2:number[] = null, xt2:number[] = null, xf2N:number[] = null;\n\t\tif (f2 > 0)\n\t\t{\n\t\t\tvf2 = Vec.sub(MolUtil.atomVec3(mol, f2), vfr);\n\t\t\tif (GeomUtil.magnitude2(vf2) < THRESHSQ)\n\t\t\t{\n\t\t\t\tif (mol.atomElement(f2) != 'H') return null;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\txf2 = GeomUtil.crossProduct(vf2, vbond);\n\t\t\t\tif (GeomUtil.magnitude2(xf2) < THRESHSQ) return null;\n\t\t\t\txf2N = Vec.neg(xf2);\n\t\t\t\tkeepF2T1 = GeomUtil.dist2(xf2, xt1) > GeomUtil.dist2(xf2N, xt1);\n\t\t\t}\n\t\t}\n\t\tif (t2 > 0)\n\t\t{\n\t\t\tvt2 = Vec.sub(MolUtil.atomVec3(mol, t2), vto);\n\t\t\tif (GeomUtil.magnitude2(vt2) < THRESHSQ)\n\t\t\t{\n\t\t\t\tif (mol.atomElement(t2) != 'H') return null;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\txt2 = GeomUtil.crossProduct(vt2, vbond);\n\t\t\t\tif (GeomUtil.magnitude2(xt2) < THRESHSQ) return null;\n\t\t\t\tkeepF1T2 = GeomUtil.dist2(xf1, xt2) > GeomUtil.dist2(xf1N, xt2);\n\t\t\t}\n\t\t}\n\t\tif (/*f2>0 && t2>0*/xf2 != null && xt2 != null)\n\t\t{\n\t\t\tkeepF2T2 = GeomUtil.dist2(xf2, xt2) < GeomUtil.dist2(xf2N, xt2);\n\t\t}\n\n\t\t// pick the order based on sides\n\t\tif (keepF1T1 && keepF2T1 && keepF1T2 && keepF2T2) return [f1, f2, t1, t2];\n\t\tif (!keepF1T1 && !keepF2T1 && !keepF1T2 && !keepF2T2) return [f1, f2, t2, t1];\n\n\t\treturn null;\n\t}\n\n\t// ------------------ private methods --------------------\n\n\t// compute the chirality values for each atom centre\n\tprivate buildTetraChirality():void\n\t{\n\t\tconst mol = this.mol, na = mol.numAtoms, nb = mol.numBonds;\n\n\t\t// !! USE THE \"BROKEN\" value for screwed up stuff\n\n\t\tlet haswedge = Vec.booleanArray(false, na);\n\t\tfor (let n = 1; n <= nb; n++)\n\t\t{\n\t\t\tif (mol.bondType(n) == Molecule.BONDTYPE_INCLINED || mol.bondType(n) == Molecule.BONDTYPE_DECLINED)\n\t\t\t\thaswedge[mol.bondFrom(n) - 1] = true;\n\t\t}\n\n\t\tskip_atom: for (let n = 1; n <= na; n++)\n\t\t{\n\t\t\tthis.chiralTetra[n - 1] = Stereochemistry.STEREO_NONE;\n\t\t\tlet adj = mol.atomAdjList(n);\n\t\t\tif (!(adj.length == 4 || (adj.length == 3 && mol.atomHydrogens(n) == 1))) continue;\n\t\t\tif (adj.length == 3 && (this.isH[adj[0] - 1] || this.isH[adj[1] - 1] || this.isH[adj[2] - 1])) continue;\n\t\t\tfor (let i = 0; i < adj.length - 1; i++)\n\t\t\t{\n\t\t\t\tfor (let j = i + 1; j < adj.length; j++)\n\t\t\t\t{\n\t\t\t\t\tif (this.priority[adj[i] - 1] == this.priority[adj[j] - 1]) continue skip_atom;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!haswedge[n - 1] && !mol.is3D())\n\t\t\t{\n\t\t\t\tthis.chiralTetra[n - 1] = Stereochemistry.STEREO_UNKNOWN;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet rubric = Stereochemistry.rubricTetrahedral(mol, n);\n\t\t\tif (rubric == null) continue;\n\n\t\t\tlet pri =\n\t\t\t[\n\t\t\t\trubric[0] == 0 ? 0 : this.priority[rubric[0] - 1],\n\t\t\t\trubric[1] == 0 ? 0 : this.priority[rubric[1] - 1],\n\t\t\t\trubric[2] == 0 ? 0 : this.priority[rubric[2] - 1],\n\t\t\t\trubric[3] == 0 ? 0 : this.priority[rubric[3] - 1]\n\t\t\t];\n\t\t\tpri = Vec.idxSort(pri);\n\t\t\tlet parity = Permutation.parityIdentity(pri);\n\n\t\t\tthis.chiralTetra[n - 1] = (parity & 1) == 0 ? Stereochemistry.STEREO_POS : Stereochemistry.STEREO_NEG;\n\t\t}\n\t}\n\n\t// compute the cis/trans stereochemistry for each bond\n\tprivate buildBondCisTrans():void\n\t{\n\t\tconst mol = this.mol, na = mol.numAtoms, nb = mol.numBonds;\n\t\tlet sf = [0, 0], st = [0, 0];\n\n\t\t// bonds in small rings should not get an E/Z assignment, due to geometry constraints\n\t\tlet ringMask = Vec.booleanArray(false, nb);\n\t\tfor (let rsz = 3; rsz <= 7; rsz++)\n\t\t{\n\t\t\tfor (let r of mol.findRingsOfSize(rsz))\n\t\t\t{\n\t\t\t\tfor (let n = 0; n < r.length; n++)\n\t\t\t\t{\n\t\t\t\t\tlet b = mol.findBond(r[n], r[n < r.length - 1 ? n + 1 : 0]);\n\t\t\t\t\tringMask[b - 1] = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tskip_bond: for (let n = 1; n <= nb; n++)\n\t\t{\n\t\t\tthis.cistransBond[n - 1] = Stereochemistry.STEREO_NONE;\n\t\t\tif (mol.bondOrder(n) != 2 || this.meta.isBondAromatic(n) || ringMask[n - 1]) continue;\n\n\t\t\tlet bfr = mol.bondFrom(n), bto = mol.bondTo(n);\n\t\t\tlet adj1 = mol.atomAdjList(bfr), adj2 = mol.atomAdjList(bto);\n\t\t\tif (adj1.length <= 1 || adj2.length <= 1 || adj1.length > 3 || adj2.length > 3) continue;\n\t\t\tif (adj1.length == 2 && (this.isH[adj1[0] - 1] || this.isH[adj1[1] - 1])) continue;\n\t\t\tif (adj2.length == 2 && (this.isH[adj2[0] - 1] || this.isH[adj2[1] - 1])) continue;\n\n\t\t\t// make sure neither side has two with equivalent priority\n\t\t\tfor (let i = 0; i < adj1.length - 1; i++)\n\t\t\t\tif (adj1[i] != bfr) for (let j = i + 1; j < adj1.length; j++)\n\t\t\t\t\tif (adj1[j] != bfr) if (this.priority[adj1[i] - 1] == this.priority[adj1[j] - 1]) continue skip_bond;\n\t\t\tfor (let i = 0; i < adj2.length - 1; i++)\n\t\t\t\tif (adj2[i] != bto) for (let j = i + 1; j < adj2.length; j++)\n\t\t\t\t\tif (adj2[j] != bto) if (this.priority[adj2[i] - 1] == this.priority[adj2[j] - 1]) continue skip_bond;\n\n\t\t\t// if it's a squiggly bond, that means unknown\n\t\t\tif (mol.bondType(n) == Molecule.BONDTYPE_UNKNOWN)\n\t\t\t{\n\t\t\t\tthis.cistransBond[n - 1] = Stereochemistry.STEREO_UNKNOWN;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet rubric = Stereochemistry.rubricBondSides(mol, n);\n\t\t\tif (rubric == null) continue;\n\n\t\t\tlet pf1 = rubric[0] == 0 ? 0 : this.priority[rubric[0] - 1];\n\t\t\tlet pf2 = rubric[1] == 0 ? 0 : this.priority[rubric[1] - 1];\n\t\t\tlet pt1 = rubric[2] == 0 ? 0 : this.priority[rubric[2] - 1];\n\t\t\tlet pt2 = rubric[3] == 0 ? 0 : this.priority[rubric[3] - 1];\n\n\t\t\tthis.cistransBond[n - 1] = ((pf1 < pf2) == (pt1 < pt2)) ? Stereochemistry.STEREO_POS : Stereochemistry.STEREO_NEG;\n\t\t}\n\t}\n\n\t// compute the cis/trans stereochemistry for square planar atoms\n\tprivate buildPlanarCisTrans():void\n\t{\n\t\tconst mol = this.mol, na = mol.numAtoms, nb = mol.numBonds;\n\n\t\tskip_atom: for (let n = 1; n <= na; n++)\n\t\t{\n\t\t\tthis.squarePlanar[n - 1] = Stereochemistry.STEREO_NONE;\n\t\t\tif (mol.atomAdjCount(n) != 4) continue; // NOTE: entertain the notion of making it work with virtual hydrogens\n\t\t\tif (Chemistry.ELEMENT_BLOCKS[mol.atomicNumber(n)] < 3) continue; // only d- or f-blocks need apply\n\n\t\t\tlet adj = mol.atomAdjList(n);\n\n\t\t\t// if 3 or more substituents are the same, nothing to see here\n\t\t\tfor (let i = 0; i < adj.length; i++)\n\t\t\t{\n\t\t\t\tlet count = 0;\n\t\t\t\tfor (let j = 0; j < adj.length; j++)\n\t\t\t\t{\n\t\t\t\t\tif (this.priority[adj[i] - 1] == this.priority[adj[j] - 1]) count++;\n\t\t\t\t}\n\t\t\t\tif (count >= 3) continue skip_atom;\n\t\t\t}\n\n\t\t\tlet rubric = Stereochemistry.rubricSquarePlanar(mol, n);\n\t\t\tif (rubric == null) continue;\n\n\t\t\tlet pri =\n\t\t\t[\n\t\t\t\trubric[0] == 0 ? 0 : this.priority[rubric[0] - 1],\n\t\t\t\trubric[1] == 0 ? 0 : this.priority[rubric[1] - 1],\n\t\t\t\trubric[2] == 0 ? 0 : this.priority[rubric[2] - 1],\n\t\t\t\trubric[3] == 0 ? 0 : this.priority[rubric[3] - 1]\n\t\t\t];\n\n\t\t\tlet parity = Permutation.parityOrder(pri);\n\t\t\tthis.squarePlanar[n - 1] = (parity & 1) == 0 ? Stereochemistry.STEREO_POS : Stereochemistry.STEREO_NEG;\n\t\t}\n\t}\n\n\t// compute the R/S chirality for octahedral centres\n\tprivate buildOctaChirality():void\n\t{\n\t\t// !! TODO\n\t}\n\n\t// generates Cahn-Ingold-Prelog priority for each atom, where degeneracies are indicated by having the same number\n\tprivate buildPriority():void\n\t{\n\t\tconst mol = this.mol, na = mol.numAtoms, nb = mol.numBonds;\n\n\t\t// build a graph representation which has entries replicated according to bond order, and -1 for implicit hydrogens\n\t\tlet cipgr:number[][] = [];\n\t\tfor (let n = 0; n < na; n++) cipgr.push(Vec.numberArray(-1, mol.atomHydrogens(n + 1)));\n\t\tfor (let n = 1; n <= nb; n++)\n\t\t{\n\t\t\tlet bf = mol.bondFrom(n) - 1, bt = mol.bondTo(n) - 1, bo = mol.bondOrder(n);\n\t\t\tif (this.meta.isBondAromatic(n)) bo = 2; // hacky\n\t\t\tif (bf != bt) for (let i = 0; i < bo; i++)\n\t\t\t{\n\t\t\t\tcipgr[bf].push(bt);\n\t\t\t\tcipgr[bt].push(bf);\n\t\t\t}\n\t\t}\n\n\t\t// seed the priorities with atomic number\n\t\tthis.priority = Vec.numberArray(0, na);\n\t\tlet anyActualH = false;\n\t\tfor (let n = 0; n < na; n++)\n\t\t{\n\t\t\tthis.priority[n] = mol.atomicNumber(n + 1);\n\t\t\tif (this.priority[n] == 1) anyActualH = true;\n\t\t}\n\n\t\t// pass through and reassign priorities as many times as necessary, until no change\n\t\tlet prigr:number[][] = [];\n\t\tfor (let n = 0; n < na; n++) prigr.push([]);\n\t\twhile (true)\n\t\t{\n\t\t\t// make an equivalent to cipgr which has priorities instead of indices\n\t\t\tfor (let n = 0; n < na; n++)\n\t\t\t{\n\t\t\t\tlet cip = cipgr[n], pri:number[] = [];\n\t\t\t\tfor (let i = 0; i < cip.length; i++) pri.push(cip[i] < 0 ? 1 : this.priority[cip[i]]);\n\t\t\t\tVec.sort(pri);\n\t\t\t\tprigr[n] = pri;\n\t\t\t}\n\n\t\t\t// divide each priority category into groups, then for each of these groups, split the contents out and reassign\n\t\t\tlet groups = this.sortAndGroup(this.priority);\n\t\t\tlet nextpri = anyActualH ? 0 : 1;\n\t\t\tlet repartitioned = false;\n\n\t\t\tfor (let n = 0; n < groups.length; n++)\n\t\t\t{\n\t\t\t\t// sort the groups according to their cipgr contents\n\t\t\t\tlet g = groups[n];\n\t\t\t\tfor (let p = 0; p < g.length - 1;)\n\t\t\t\t{\n\t\t\t\t\tconst i1 = g[p], i2 = g[p + 1];\n\t\t\t\t\tlet cmp = 0, sz = Math.max(prigr[i1].length, prigr[i2].length);\n\t\t\t\t\tfor (let i = 0; i < sz; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet v1 = i < prigr[i1].length ? prigr[i1][i] : 0, v2 = i < prigr[i2].length ? prigr[i2][i] : 0;\n\t\t\t\t\t\tif (v1 < v2)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcmp = -1;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (v1 > v2)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcmp = 1;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (cmp > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tg[p] = i2;\n\t\t\t\t\t\tg[p + 1] = i1;\n\t\t\t\t\t\tif (p > 0) p--;\n\t\t\t\t\t}\n\t\t\t\t\telse p++;\n\t\t\t\t}\n\t\t\t\t//Util.writeln(\" after sort: \"+Util.arrayStr(g));\n\t\t\t\t//for (int z : g) Util.writeln(\"   pri=\"+Util.arrayStr(prigr[z]));\n\t\t\t\tfor (let i = 0; i < g.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (i == 0) nextpri++;\n\t\t\t\t\telse if (prigr[g[i]].length != prigr[g[i - 1]].length)\n\t\t\t\t\t{\n\t\t\t\t\t\tnextpri++;\n\t\t\t\t\t\trepartitioned = true;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tfor (let j = 0; j < prigr[g[i]].length; j++) if (prigr[g[i]][j] != prigr[g[i - 1]][j])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tnextpri++;\n\t\t\t\t\t\t\trepartitioned = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.priority[g[i]] = nextpri;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!repartitioned) break;\n\t\t}\n\t}\n\n\t// utility method, used during priority generation\n\tprivate sortAndGroup(val:number[]):number[][]\n\t{\n\t\tlet uset = new Set<number>();\n\t\tfor (let v of val) uset.add(v);\n\t\tlet unique = Array.from(uset);\n\t\tVec.sort(unique);\n\t\tlet ret:number[][] = [];\n\t\tfor (let n = 0; n < unique.length; n++) ret.push([]);\n\n\t\tfor (let n = 0; n < val.length; n++)\n\t\t{\n\t\t\tlet grp = unique.indexOf(val[n]);\n\t\t\tret[grp].push(n);\n\t\t}\n\n\t\treturn ret;\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Vec} from '../util/Vec';\nimport {Chemistry} from './Chemistry';\nimport {DotPath} from './DotPath';\nimport {Molecule} from './Molecule';\nimport {MolUtil} from './MolUtil';\nimport {Stereochemistry} from './Stereochemistry';\n\n/*\n\tA \"meta-molecule\" is a container for a molecule which stores derived information about it. This is a compensation for the\n\tfact that the molecular datastructure is extremely minimalistic, and includes only very low level chemical interpretation.\n\tThe low level molecule object is intended to represent a work in progress, something that is likely being sketched or chopped up\n\tand reassembled by algorithms. The meta-molecule wrapper is based on the assumption that the molecule is \"done\", and is\n\tready to be compared to other fully described molecules.\n\n\tEach of the fields contained within may or may not be defined, and should be calculated as necessary, which means that\n\tthis class basically operates as a cache.\n\n\tTypical use case:\n\n\t\tMetaMolecule meta=new MetaMolecule(mol);\n\t\tcalculateStrictAromaticity();\n\t\tcalculateStereoRubric();\n\n\tNote that the calculations are not necessarily independent, so order of calling can be important.\n\n\tCan also be used as a convenient storage place for the \"skeleton hash\", which is useful for screening isomorphisms.\n*/\n\nexport class MetaMolecule\n{\n\tpublic static skeletonHash:(mol:Molecule) => string = null;\n\tpublic static isomorphMatch:(meta1:MetaMolecule, meta2:MetaMolecule, timeout:number) => boolean = null;\n\n\tpublic atomArom:boolean[] = null;\n\tpublic bondArom:boolean[] = null;\n\tpublic rubricTetra:number[][] = null;\n\tpublic rubricSquare:number[][] = null;\n\tpublic rubricBipy:number[][] = null;\n\tpublic rubricOcta:number[][] = null;\n\tpublic rubricSides:number[][] = null;\n\tpublic hash:string = null;\n\tpublic heavyHash:string = null;\n\tpublic uniqueElements:string[] = null;\n\tpublic dots:DotPath = null;\n\n\tprivate piAtom:boolean[] = null; // true for all atoms that have at least one double bond attached\n\n\t// --------------------- public methods ---------------------\n\n\tconstructor(public mol:Molecule)\n\t{\n\t}\n\n\t// strict aromaticity: considers only rings with pure alternating single/double bonds, i.e. benzene-style; fused ring\n\t// systems like naphthalene are handled iteratively; many types of aromaticity are excluded, e.g. thiophene (lone pair),\n\t// imidazolium (ions) and larger rings (e.g. porphyrins); this calculation is reasonably fast\n\tpublic calculateStrictAromaticity():void\n\t{\n\t\tlet mol = this.mol;\n\t\tthis.atomArom = Vec.booleanArray(false, mol.numAtoms);\n\t\tthis.bondArom = Vec.booleanArray(false, mol.numBonds);\n\n\t\tlet rings = mol.findRingsOfSize(6);\n\t\tconst nr = rings.length;\n\t\tif (nr == 0) return;\n\n\t\t// assign the potentially-aromatic rings\n\t\tthis.ensurePiAtoms();\n\t\tlet mask = Vec.booleanArray(false, nr); // false=not decided; true=already processed\n\t\tfor (let n = 0; n < nr; n++)\n\t\t{\n\t\t\tfor (let i = 0; i < rings[n].length; i++)\n\t\t\t{\n\t\t\t\tlet a = rings[n][i];\n\t\t\t\tif (!this.piAtom[a - 1])\n\t\t\t\t{\n\t\t\t\t\tmask[n] = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tlet b = mol.findBond(a, rings[n][i == rings[n].length - 1 ? 0 : i + 1]);\n\t\t\t\tlet bo = mol.bondOrder(b);\n\t\t\t\tif (bo != 1 && bo != 2)\n\t\t\t\t{\n\t\t\t\t\tmask[n] = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// keep classifying rings as aromatic until no change; this needs to be done iteratively, for the benefit of highly\n\t\t// embedded ring systems, that can't be classified as aromatic until it is known that their neighbours obviously are\n\t\twhile (true)\n\t\t{\n\t\t\tlet anyChange = false;\n\n\t\t\tfor (let n = 0; n < nr; n++) if (!mask[n])\n\t\t\t{\n\t\t\t\tlet phase1 = true, phase2 = true; // has to go 121212 or 212121; already arom=either is OK\n\t\t\t\tfor (let i = 0; i < rings[n].length; i++)\n\t\t\t\t{\n\t\t\t\t\tlet b = mol.findBond(rings[n][i], rings[n][i == rings[n].length - 1 ? 0 : i + 1]);\n\t\t\t\t\tif (this.bondArom[b - 1]) continue; // valid for either phase\n\t\t\t\t\tlet bo = mol.bondOrder(b);\n\t\t\t\t\tphase1 = phase1 && bo == (2 - (i & 1));\n\t\t\t\t\tphase2 = phase2 && bo == (1 + (i & 1));\n\t\t\t\t}\n\t\t\t\tif (!phase1 && !phase2) continue;\n\n\t\t\t\tfor (let i = 0; i < rings[n].length; i++)\n\t\t\t\t{\n\t\t\t\t\tlet b = mol.findBond(rings[n][i], rings[n][i == rings[n].length - 1 ? 0 : i + 1]);\n\t\t\t\t\tthis.bondArom[b - 1] = true;\n\t\t\t\t}\n\n\t\t\t\tmask[n] = true;\n\t\t\t\tanyChange = true;\n\t\t\t}\n\n\t\t\tif (!anyChange) break;\n\t\t}\n\n\t\t// update the atom aromaticity flags\n\t\tfor (let n = 0; n < this.bondArom.length; n++) if (this.bondArom[n])\n\t\t{\n\t\t\tthis.atomArom[mol.bondFrom(n + 1) - 1] = true;\n\t\t\tthis.atomArom[mol.bondTo(n + 1) - 1] = true;\n\t\t}\n\t}\n\n\t// relaxed aromaticity: based on strict aromaticity, but extends to other small ring sizes; it is also reasonably\n\t// fast - there are no opportunities for exponential graph-walk blowups\n\tpublic calculateRelaxedAromaticity():void\n\t{\n\t\tlet mol = this.mol;\n\t\tthis.atomArom = Vec.booleanArray(false, mol.numAtoms);\n\t\tthis.bondArom = Vec.booleanArray(false, mol.numBonds);\n\n\t\tthis.ensurePiAtoms();\n\t\tconst na = mol.numAtoms, nb = mol.numBonds;\n\t\tlet electrons = Vec.numberArray(0, na); // # lone pair electrons available for donating into the ring; >=2 qualifies\n\t\tlet exocyclic = Vec.booleanArray(false, na); // true=has a double bond that sticks out of the ring block\n\t\tfor (let n = 1; n <= na; n++)\n\t\t{\n\t\t\tlet atno = mol.atomicNumber(n);\n\t\t\telectrons[n - 1] = (Chemistry.ELEMENT_BLOCKS[atno] == 2 ? Chemistry.ELEMENT_VALENCE[atno] : 0) - mol.atomCharge(n) - mol.atomHydrogens(n)\n\t\t\t\t\t\t\t- mol.atomUnpaired(n);\n\t\t}\n\t\tfor (let n = 1; n <= nb; n++)\n\t\t{\n\t\t\tconst bfr = mol.bondFrom(n), bto = mol.bondTo(n), bo = mol.bondOrder(n);\n\t\t\telectrons[bfr - 1] -= bo;\n\t\t\telectrons[bto - 1] -= bo;\n\t\t\tif (bo == 2)\n\t\t\t{\n\t\t\t\tconst rblk1 = mol.atomRingBlock(bfr), rblk2 = mol.atomRingBlock(bto);\n\t\t\t\tif (rblk1 > 0 && rblk1 != rblk2) exocyclic[bfr - 1] = true;\n\t\t\t\tif (rblk2 > 0 && rblk2 != rblk1) exocyclic[bto - 1] = true;\n\t\t\t}\n\t\t}\n\n\t\t// compile candidate rings: all atoms must have some potentially qualifying pi-action doing on\n\n\t\tlet rings:number[][] = [];\n\t\tfor (let rsz = 3; rsz <= 7; rsz++) for (let rng of mol.findRingsOfSize(rsz))\n\t\t{\n\t\t\tlet valid = true;\n\t\t\tfor (let n = 0; n < rsz; n++)\n\t\t\t{\n\t\t\t\tconst a = rng[n];\n\t\t\t\tif (!this.piAtom[a - 1] && electrons[a - 1] < 2 && !exocyclic[a - 1])\n\t\t\t\t{\n\t\t\t\t\tvalid = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tlet b = mol.findBond(a, rng[n < rsz - 1 ? n + 1 : 0]);\n\t\t\t\tlet bo = mol.bondOrder(b);\n\t\t\t\tif (bo != 1 && bo != 2)\n\t\t\t\t{\n\t\t\t\t\tvalid = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (valid) rings.push(rng);\n\t\t}\n\n\t\t// keep processing rings, until no new ones are found\n\n\t\twhile (rings.length > 0)\n\t\t{\n\t\t\tlet anyChange = false;\n\n\t\t\tfor (let n = 0; n < rings.length; n++)\n\t\t\t{\n\t\t\t\tlet r = rings[n];\n\n\t\t\t\tlet paths = [0];\n\t\t\t\tfor (let i = 0; i < r.length; i++)\n\t\t\t\t{\n\t\t\t\t\tconst a = r[i];\n\t\t\t\t\tconst b1 = mol.findBond(a, r[i < r.length - 1 ? i + 1 : 0]);\n\t\t\t\t\tconst b2 = mol.findBond(a, r[i > 0 ? i - 1 : r.length - 1]);\n\t\t\t\t\tif (this.bondArom[b1 - 1])\n\t\t\t\t\t{\n\t\t\t\t\t\t// contemplate with or without extra pi-bond\n\t\t\t\t\t\tfor (let j = paths.length - 1; j >= 0; j--)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst e = paths[j] + 2;\n\t\t\t\t\t\t\tif (paths.indexOf(e) < 0) paths = Vec.append(paths, e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (mol.bondOrder(b1) == 2) Vec.addTo(paths, 2);\n\t\t\t\t\telse if (electrons[a - 1] >= 2 && mol.bondOrder(b1) == 1 && mol.bondOrder(b2) == 1) Vec.addTo(paths, 2);\n\t\t\t\t}\n\n\t\t\t\t// see if there's anything Hueckel (4N+2) buried in there\n\t\t\t\tlet arom = false;\n\t\t\t\tfor (let e of paths)\n\t\t\t\t{\n\t\t\t\t\tif (e == 2 && r.length == 3)\n\t\t\t\t\t{\n\t\t\t\t\t\tarom = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} // N==0 case only for 3 membered rings, e.g. cyclopropylium\n\t\t\t\t\tif (e == 6)\n\t\t\t\t\t{\n\t\t\t\t\t\tarom = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t// (anything bigger does not apply, because only using small rings)\n\t\t\t\t}\n\t\t\t\tif (arom)\n\t\t\t\t{\n\t\t\t\t\tfor (let i = 0; i < r.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet a = r[i], b = mol.findBond(a, r[i < r.length - 1 ? i + 1 : 0]);\n\t\t\t\t\t\tthis.atomArom[a - 1] = true;\n\t\t\t\t\t\tthis.bondArom[b - 1] = true;\n\t\t\t\t\t}\n\t\t\t\t\trings.splice(n, 1);\n\t\t\t\t\tn--;\n\t\t\t\t\tanyChange = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!anyChange) break;\n\t\t}\n\t}\n\n\t/*\n\t// extended Hueckel aromaticity: any ring pathway which meets the 4n+2 PI electron rule, counting double bonds and\n\t// lone pairs, is classified as aromatic\n\tpublic void calculateExtendedAromaticity() throws MoleculeCalcException\n\t{\n\t\t// !!\n\t\tthrow new MoleculeCalcException(\"Hueckel aromaticity: not implemented yet\");\n\t}*/\n\n\t// goes through the atoms and bonds, and determines \"geometry rubric\" sequences for those that are considered to\n\t// be potentially stereo-active; chemical judgment calls are made within this method\n\t// NOTE: it is a good idea to calculate aromaticity first, since it can affect atom classification\n\tpublic calculateStereoRubric():void\n\t{\n\t\tconst mol = this.mol, na = mol.numAtoms, nb = mol.numBonds;\n\t\tthis.rubricTetra = new Array(na);\n\t\tthis.rubricSquare = new Array(na);\n\t\tthis.rubricBipy = new Array(na);\n\t\tthis.rubricOcta = new Array(na);\n\t\tthis.rubricSides = new Array(nb);\n\n\t\tfor (let n = 1; n <= na; n++)\n\t\t{\n\t\t\tlet blk = Chemistry.ELEMENT_BLOCKS[mol.atomicNumber(n)];\n\t\t\tlet adjc = mol.atomAdjCount(n), hc = mol.atomHydrogens(n);\n\t\t\tlet ninc = 0, ndec = 0;\n\t\t\tfor (let b of mol.atomAdjBonds(n))\n\t\t\t{\n\t\t\t\tif (mol.bondType(b) == Molecule.BONDTYPE_INCLINED && mol.bondFrom(b) == n) ninc++;\n\t\t\t\telse if (mol.bondType(b) == Molecule.BONDTYPE_DECLINED && mol.bondFrom(b) == n) ndec++;\n\t\t\t}\n\n\t\t\t// p-block atoms with 4 neighbours (1 of which can be implicit H) are allowed tetrahedral chirality\n\t\t\t// (or more stringent requirements for d- & f-block)\n\t\t\tif (blk == 2 && ((adjc == 3 && hc == 1) || (adjc == 4 && hc == 0)))\n\t\t\t{\n\t\t\t\tthis.rubricTetra[n - 1] = Stereochemistry.rubricTetrahedral(mol, n);\n\t\t\t}\n\t\t\telse if (blk >= 3 && adjc == 4 && ninc == 1 && ndec == 1)\n\t\t\t{\n\t\t\t\tthis.rubricTetra[n - 1] = Stereochemistry.rubricTetrahedral(mol, n);\n\t\t\t}\n\n\t\t\t// d- & f-block atoms with 4 neighbours can have square planar constraints\n\t\t\tif (blk >= 3 && adjc == 4 && hc == 0)\n\t\t\t{\n\t\t\t\tthis.rubricSquare[n - 1] = Stereochemistry.rubricSquarePlanar(mol, n);\n\t\t\t}\n\n\t\t\t// d- and f-block atoms with 4 or 5 neighbours can have trigonal bipyramidal constraints\n\t\t\tif (blk >= 3 && (adjc == 4 || adjc == 5) && hc == 0)\n\t\t\t{\n\t\t\t\tthis.rubricBipy[n - 1] = Stereochemistry.rubricBipyrimidal(mol, n);\n\t\t\t}\n\n\t\t\t// d- & f-block atoms with 5 or 6 neighbours can have octahedral constraints\n\t\t\t// (as can p-block atoms with 6 neighbours)\n\t\t\tif (blk >= 3 && (adjc == 5 || adjc == 6) && hc == 0)\n\t\t\t{\n\t\t\t\tthis.rubricOcta[n - 1] = Stereochemistry.rubricOctahedral(mol, n);\n\t\t\t}\n\t\t\telse if (blk == 2 && adjc == 6 && hc == 0)\n\t\t\t{\n\t\t\t\tthis.rubricOcta[n - 1] = Stereochemistry.rubricOctahedral(mol, n);\n\t\t\t}\n\t\t}\n\n\t\t// certain double bonds are considered to have restricted rotation constraints\n\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t{\n\t\t\tif (mol.bondOrder(n) != 2 || mol.bondType(n) == Molecule.BONDTYPE_UNKNOWN || this.isBondAromatic(n)) continue;\n\n\t\t\tlet bfr = mol.bondFrom(n), bto = mol.bondTo(n);\n\t\t\tlet blk1 = Chemistry.ELEMENT_BLOCKS[mol.atomicNumber(bfr)];\n\t\t\tlet blk2 = Chemistry.ELEMENT_BLOCKS[mol.atomicNumber(bto)];\n\t\t\tlet adjc1 = mol.atomAdjCount(bfr), hc1 = mol.atomHydrogens(bfr);\n\t\t\tlet adjc2 = mol.atomAdjCount(bto), hc2 = mol.atomHydrogens(bto);\n\n\t\t\t// if both sides of the bond are p-block atoms, and have 2 substituents, can be side-constrained\n\t\t\t// (note: things like C=N-, with potentially constrained lone pairs, are not considered)\n\t\t\tif (blk1 == 2 && blk2 == 2 && (adjc1 + hc1 == 3 && hc1 <= 1) && (adjc2 + hc2 == 3 && hc2 <= 1))\n\t\t\t{\n\t\t\t\tthis.rubricSides[n - 1] = Stereochemistry.rubricBondSides(mol, n);\n\t\t\t}\n\t\t}\n\t}\n\n\t// removes all hydrogens from the molecule, cloning it anything changes; if this is called after the aromaticity/stereochemistry is calculated, these will be\n\t// remapped as necessary\n\tpublic removeHydrogens():void\n\t{\n\t\tlet mol = this.mol, na = mol.numAtoms, nb = mol.numBonds;\n\t\tlet atomMask = Vec.booleanArray(true, na), bondMask = Vec.booleanArray(true, nb);\n\t\tfor (let n = 1; n <= na; n++) if (MolUtil.boringHydrogen(mol, n))\n\t\t{\n\t\t\tatomMask[n - 1] = false;\n\t\t\tbondMask[mol.atomAdjBonds(n)[0] - 1] = false;\n\t\t}\n\t\tif (Vec.allTrue(atomMask)) return;\n\n\t\tmol = MolUtil.subgraphMask(mol, atomMask);\n\n\t\tif (this.atomArom) this.atomArom = Vec.maskGet(this.atomArom, atomMask);\n\t\tif (this.bondArom) this.bondArom = Vec.maskGet(this.bondArom, bondMask);\n\n\t\tif (this.rubricTetra || this.rubricSquare || this.rubricBipy || this.rubricOcta || this.rubricSides)\n\t\t{\n\t\t\tif (this.rubricTetra) this.rubricTetra = Vec.maskGet(this.rubricTetra, atomMask);\n\t\t\tif (this.rubricSquare) this.rubricSquare = Vec.maskGet(this.rubricSquare, atomMask);\n\t\t\tif (this.rubricBipy) this.rubricBipy = Vec.maskGet(this.rubricBipy, atomMask);\n\t\t\tif (this.rubricOcta) this.rubricOcta = Vec.maskGet(this.rubricOcta, atomMask);\n\t\t\tif (this.rubricSides) this.rubricSides = Vec.maskGet(this.rubricSides, bondMask);\n\n\t\t\tlet atomMap = Vec.prepend(Vec.add(Vec.maskMap(atomMask), 1), 0);\n\t\t\tfor (let n = 0; n < Vec.len(this.rubricTetra); n++) if (this.rubricTetra[n]) this.rubricTetra[n] = Vec.idxGet(atomMap, this.rubricTetra[n]);\n\t\t\tfor (let n = 0; n < Vec.len(this.rubricSquare); n++) if (this.rubricSquare[n]) this.rubricSquare[n] = Vec.idxGet(atomMap, this.rubricSquare[n]);\n\t\t\tfor (let n = 0; n < Vec.len(this.rubricBipy); n++) if (this.rubricBipy[n]) this.rubricBipy[n] = Vec.idxGet(atomMap, this.rubricBipy[n]);\n\t\t\tfor (let n = 0; n < Vec.len(this.rubricOcta); n++) if (this.rubricOcta[n]) this.rubricOcta[n] = Vec.idxGet(atomMap, this.rubricOcta[n]);\n\t\t\tfor (let n = 0; n < Vec.len(this.rubricSides); n++) if (this.rubricSides[n]) this.rubricSides[n] = Vec.idxGet(atomMap, this.rubricSides[n]);\n\t\t}\n\n\t\t// (... recreate anything else that's affected)\n\t}\n\n\t// defines the \"skeleton hash\" field, for prescreening\n\tpublic calculateSkeletonHash():void\n\t{\n\t\tif (MetaMolecule.skeletonHash == null) throw 'Skeleton hash not available.';\n\t\tthis.hash = MetaMolecule.skeletonHash(this.mol);\n\t}\n\n\t// define the \"heavy hash\": like for skeleton, but with explicit hydrogens removed\n\tpublic calculateHeavyHash():void\n\t{\n\t\tlet anyH = false;\n\t\tfor (let n = 1; n <= this.mol.numAtoms; n++) if (this.mol.atomElement(n) == 'H') {anyH = true; break;}\n\t\tif (!anyH)\n\t\t{\n\t\t\tthis.heavyHash = this.getSkeletonHash();\n\t\t\treturn;\n\t\t}\n\n\t\tlet hvy = this.mol.clone();\n\t\tfor (let n = hvy.numAtoms; n >= 1; n--) if (hvy.atomElement(n) == 'H') hvy.deleteAtomAndBonds(n);\n\t\tthis.heavyHash = MetaMolecule.skeletonHash(hvy);\n\t}\n\n\t// access to aromaticity: either by 1-based single index, or grabbing the whole array\n\tpublic isAtomAromatic(atom:number):boolean\n\t{\n\t\treturn this.atomArom == null ? false : this.atomArom[atom - 1];\n\t}\n\tpublic isBondAromatic(bond:number):boolean\n\t{\n\t\treturn this.bondArom == null ? false : this.bondArom[bond - 1];\n\t}\n\n\t// modified version of bond order: returns -1 to encode for aromaticity; if not aromatic, or aromaticity wasn't calculated,\n\t// this is the same as the regular bond order\n\tpublic bondOrderArom(bond:number):number\n\t{\n\t\treturn this.bondArom != null && this.bondArom[bond - 1] ? -1 : this.mol.bondOrder(bond);\n\t}\n\n\tpublic getAtomAromaticity():boolean[]\n\t{\n\t\treturn this.atomArom == null ? null : this.atomArom.slice(0);\n\t}\n\tpublic getBondAromaticity():boolean[]\n\t{\n\t\treturn this.bondArom == null ? null : this.bondArom.slice(0);\n\t}\n\n\t// cached access to hash-type properties: first invocation slow, after that fast\n\tpublic getSkeletonHash():string\n\t{\n\t\tif (this.hash == null) this.calculateSkeletonHash();\n\t\treturn this.hash;\n\t}\n\tpublic getHeavyHash():string\n\t{\n\t\tif (this.heavyHash == null) this.calculateHeavyHash();\n\t\treturn this.heavyHash;\n\t}\n\tpublic getDotPath():DotPath\n\t{\n\t\tif (this.dots == null) this.dots = new DotPath(this.mol);\n\t\treturn this.dots;\n\t}\n\n\tpublic getUniqueElements():string[]\n\t{\n\t\tif (this.uniqueElements == null)\n\t\t{\n\t\t\tthis.uniqueElements = [];\n\t\t\tfor (let n = 1; n <= this.mol.numAtoms; n++)\n\t\t\t{\n\t\t\t\tlet el = this.mol.atomElement(n);\n\t\t\t\tif (this.uniqueElements.indexOf(el) < 0) this.uniqueElements.push(el);\n\t\t\t}\n\t\t}\n\t\treturn this.uniqueElements;\n\t}\n\n\t// equivalence: assumes that both metavectors have been marked up according to the same additional into, i.e.\n\t// aromaticity, stereo, etc.; it will try to resolve the equivalence and get to the answer as quickly as possible,\n\t// with the isomorphism test being the final option\n\tpublic equivalentTo(other:MetaMolecule, timeout = 1000):boolean\n\t{\n\t\tif (MetaMolecule.isomorphMatch == null) throw 'Isomorph search unavailable.';\n\n\t\t// phase 1: different atom/bond counts, don't waste any time\n\t\tif (this.mol.numAtoms != other.mol.numAtoms || this.mol.numBonds != other.mol.numBonds) return false;\n\n\t\t// phase 2: make sure both hashes are generated, and use to screen\n\t\tif (this.hash == null) this.calculateSkeletonHash();\n\t\tif (other.hash == null) other.calculateSkeletonHash();\n\t\tif (this.hash != other.hash) return false;\n\n\t\t// phase 3: if molecules are literally equal, no need to get fancy\n\t\tif (this.mol.compareTo(other.mol) == 0) return true;\n\n\t\t// phase 4: check if any elements are unique on either side\n\t\tlet uniq1 = this.getUniqueElements(), uniq2 = other.getUniqueElements();\n\t\tfor (let n = 0; n < uniq1.length; n++)\n\t\t{\n\t\t\tif (!uniq2.includes(uniq1[n])) return false;\n\t\t}\n\t\n\t\t// phase 5: the most laborious part, finding any isomorphism\n\t\treturn MetaMolecule.isomorphMatch(this, other, timeout);\n\t}\n\n\t// convenience constructor alternatives\n\tpublic static createRubric(mol:Molecule):MetaMolecule\n\t{\n\t\tif (mol == null) return null;\n\t\tlet meta = new MetaMolecule(mol);\n\t\tmeta.calculateStereoRubric();\n\t\treturn meta;\n\t}\n\n\tpublic static createStrict(mol:Molecule):MetaMolecule\n\t{\n\t\tif (mol == null) return null;\n\t\tlet meta = new MetaMolecule(mol);\n\t\tmeta.calculateStrictAromaticity();\n\t\treturn meta;\n\t}\n\n\tpublic static createStrictRubric(mol:Molecule):MetaMolecule\n\t{\n\t\tif (mol == null) return null;\n\t\tlet meta = new MetaMolecule(mol);\n\t\tmeta.calculateStrictAromaticity();\n\t\tmeta.calculateStereoRubric();\n\t\treturn meta;\n\t}\n\n\tpublic static createRelaxed(mol:Molecule):MetaMolecule\n\t{\n\t\tif (mol == null) return null;\n\t\tlet meta = new MetaMolecule(mol);\n\t\tmeta.calculateRelaxedAromaticity();\n\t\treturn meta;\n\t}\n\n\tpublic static createRelaxedRubric(mol:Molecule):MetaMolecule\n\t{\n\t\tif (mol == null) return null;\n\t\tlet meta = new MetaMolecule(mol);\n\t\tmeta.calculateRelaxedAromaticity();\n\t\tmeta.calculateStereoRubric();\n\t\treturn meta;\n\t}\n\n\t// ------------------ private methods --------------------\n\n\t// define pi-atoms, if not already\n\tprivate ensurePiAtoms():void\n\t{\n\t\tif (this.piAtom != null) return;\n\t\tthis.piAtom = Vec.booleanArray(false, this.mol.numAtoms);\n\t\tfor (let n = 1; n <= this.mol.numBonds; n++) if (this.mol.bondOrder(n) == 2)\n\t\t{\n\t\t\t{\n\t\t\t\tthis.piAtom[this.mol.bondFrom(n) - 1] = true;\n\t\t\t\tthis.piAtom[this.mol.bondTo(n) - 1] = true;\n\t\t\t}\n\t\t}\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Chemistry} from '../data/Chemistry';\nimport {MetaMolecule} from '../data/MetaMolecule';\nimport {Molecule} from '../data/Molecule';\nimport {MolUtil} from '../data/MolUtil';\nimport {Permutation, Vec} from '../util/Vec';\n\n/*\n\tCircular fingerprints: for generating ECFP-2/4/6 and FCFP-2/4/6 fingerprints. These are described by:\n\n    \tOriginal proprietary version:\n    \t\tJ. Chem. Inf. Model., 50, 742–754 (2010)\n    \t\thttp://pubs.acs.org/doi/abs/10.1021/ci100050t\n\n    \tOpen source version (implemented in this module):\n    \t\tJ. Cheminf., 6:38 (2014)\n    \t\thttp://www.jcheminf.com/content/6/1/38\n\n\tNote that integer hashing is done using the CRC32 algorithm, using the Java CRC32 class, which is the same\n\tformula/parameters as used by PNG files, and described in: http://www.w3.org/TR/PNG/#D-CRCAppendix\n\n\tImplicit vs. explicit hydrogens are handled, i.e. it doesn't matter whether the incoming molecule is hydrogen\n\tsuppressed or not. However, inline abbreviations do need to be expanded out prior to doing the calculation.\n*/\n\nlet crc_table:number[] = [];\nfunction make_crc_table():void\n{\n\tif (crc_table.length > 0) return;\n\tfor (let n = 0; n < 256; n++)\n\t{\n\t\tlet c = n;\n\t\tfor (let i = 0; i < 8; i++) if ((c & 1) != 0) c = 0xEDB88320 ^ (c >>> 1); else c = (c >>> 1);\n\t\tcrc_table.push(c);\n\t}\n}\nconst BOOT_CRC = 0xFFFFFFFF;\nfunction start_crc():number {return BOOT_CRC;}\nfunction feed_crc(crc:number, byte:number):number\n{\n\tlet idx = (crc ^ byte) & 0xFF;\n\treturn crc_table[idx] ^ (crc >>> 8);\n}\nfunction end_crc(crc:number):number {return crc ^ BOOT_CRC;}\n\nexport interface CircularFP\n{\n\thashCode:number;\n\titeration:number;\n\tatoms:number[];\n\tcentralAtom:number;\n}\n\nexport class CircularFingerprints\n{\n\tpublic static CLASS_ECFP0 = 0;\n\tpublic static CLASS_ECFP2 = 1;\n\tpublic static CLASS_ECFP4 = 2;\n\tpublic static CLASS_ECFP6 = 3;\n\n\t// plugins: interception of fingerprint addition\n\tpublic hookApplyNewFP:(newFP:CircularFP) => void = null;\n\tpublic hookConsiderNewFP:(newFP:CircularFP) => void = null;\n\n\tprivate identity:number[] = [];\n\tprivate resolvedChiral:boolean[] = [];\n\tprivate atomGroup:number[][] = [];\n\tprivate fplist:CircularFP[] = [];\n\tprivate amask:boolean[] = [];\n\tprivate atomAdj:number[][] = [];\n\tprivate bondAdj:number[][] = [];\n\n\t// --------------------- public methods ---------------------\n\n\tconstructor(private meta:MetaMolecule, private kind:number)\n\t{\n\t\tmake_crc_table(); // (nop if already made)\n\t}\n\n\t// performs the calculation; after completion, the results may be fetched\n\tpublic calculate():void\n\t{\n\t\tlet mol = this.meta.mol, na = mol.numAtoms;\n\t\tthis.identity = Vec.numberArray(0, na);\n\t\tthis.resolvedChiral = Vec.booleanArray(false, na);\n\t\tfor (let n = 0; n < na; n++) this.atomGroup.push([]);\n\n\t\t// setup the potential correction between explicit vs. implicit hydrogens, and the stashed adjacency list\n\t\tthis.amask = Vec.booleanArray(false, na);\n\t\tfor (let n = 0; n < na; n++)\n\t\t{\n\t\t\tthis.amask[n] = mol.atomicNumber(n + 1) >= 2 && !MolUtil.hasAbbrev(mol, n + 1);\n\t\t\tthis.atomAdj.push([]);\n\t\t\tthis.bondAdj.push([]);\n\t\t}\n\t\tfor (let n = 0; n < na; n++)\n\t\t{\n\t\t\tif (!this.amask[n]) continue;\n\t\t\tthis.atomAdj[n] = mol.atomAdjList(n + 1);\n\t\t\tthis.bondAdj[n] = mol.atomAdjBonds(n + 1);\n\t\t\tfor (let i = this.atomAdj[n].length - 1; i >= 0; i--) if (!this.amask[this.atomAdj[n][i] - 1])\n\t\t\t{\n\t\t\t\tthis.atomAdj[n].splice(i, 1);\n\t\t\t\tthis.bondAdj[n].splice(i, 1);\n\t\t\t}\n\t\t}\n\n\t\t// seed the initial atom identities, at iteration zero\n\t\tfor (let n = 0; n < na; n++) if (this.amask[n])\n\t\t{\n\t\t\tthis.identity[n] = this.initialIdentityECFP(n + 1);\n\t\t\tthis.atomGroup[n] = [n + 1];\n\t\t\tthis.applyNewFP({hashCode: this.identity[n], iteration: 0, atoms: this.atomGroup[n], centralAtom: n + 1});\n\t\t}\n\t\tlet niter = this.kind; // (corresponds: numeric value is # iterations)\n\n\t\t// iterate outward\n\t\tfor (let iter = 1; iter <= niter; iter++)\n\t\t{\n\t\t\tlet newident = Vec.numberArray(0, na);\n\t\t\tfor (let n = 0; n < na; n++) if (this.amask[n]) newident[n] = this.circularIterate(iter, n + 1);\n\t\t\tthis.identity = newident;\n\n\t\t\tfor (let n = 0; n < na; n++) if (this.amask[n])\n\t\t\t{\n\t\t\t\tthis.atomGroup[n] = this.growAtoms(this.atomGroup[n]);\n\t\t\t\tthis.considerNewFP({hashCode: this.identity[n], iteration: iter, atoms: this.atomGroup[n], centralAtom: n + 1});\n\t\t\t}\n\t\t}\n\t}\n\n\t// convenience constructors; note that molecules should have abbreviations expanded out beforehand\n\tpublic static create(meta:Molecule | MetaMolecule, kind:number):CircularFingerprints\n\t{\n\t\tif (meta instanceof Molecule) meta = MetaMolecule.createStrictRubric(meta);\n\t\tlet circ = new CircularFingerprints(meta, kind);\n\t\tcirc.calculate();\n\t\treturn circ;\n\t}\n\n\t// access to the results/input content\n\tpublic getMolecule():Molecule {return this.meta.mol;}\n\tpublic get numFP():number {return this.fplist.length;}\n\tpublic getFP(idx:number):CircularFP {return this.fplist[idx];}\n\tpublic getFingerprints():CircularFP[] {return this.fplist.slice(0);}\n\n\t// pulls out just the unique instances of each hash code, and returns the sorted list\n\tpublic getUniqueHashes():number[]\n\t{\n\t\tlet hashes = new Set<number>();\n\t\tfor (let fp of this.fplist) hashes.add(fp.hashCode);\n\t\treturn Vec.sorted(Array.from(hashes));\n\t}\n\n\t// as above, except cuts off the bits to a certain folding; note that the folding size must be an exponent of 2\n\tpublic getFoldedHashes(maxBits:number):number[]\n\t{\n\t\tlet andBits = maxBits - 1;\n\t\tlet hashes = new Set<number>();\n\t\tfor (let fp of this.fplist) hashes.add(fp.hashCode & andBits);\n\t\treturn Vec.sorted(Array.from(hashes));\n\t}\n\n\t// calculates the Tanimoto coefficient for two lists of hash codes: these are assumed to be sorted and unique, which\n\t// allows the calculation to be done in O(N) time\n\tpublic static tanimoto(hash1:number[], hash2:number[]):number\n\t{\n\t\tlet shared = 0, total = 0;\n\t\tlet sz1 = hash1.length, sz2 = hash2.length;\n\t\tif (sz1 == 0 && sz2 == 0) return 0;\n\t\tlet i1 = 0, i2 = 0;\n\t\twhile (i1 < sz1 || i2 < sz2)\n\t\t{\n\t\t\tif (i1 == sz1) {total += sz2 - i2; break;}\n\t\t\tif (i2 == sz2) {total += sz1 - i1; break;}\n\t\t\tlet v1 = hash1[i1], v2 = hash2[i2];\n\t\t\tif (v1 == v2) {shared += 1; i1 += 1; i2 += 1;}\n\t\t\telse if (v1 < v2) i1 += 1; else i2 += 1;\n\t\t\ttotal += 1;\n\t\t}\n\t\treturn shared / total;\n\t}\n\n\t// ----------------- private methods -----------------\n\n\t// calculates an integer number that stores the bit-packed identity of the given atom\n\tprivate initialIdentityECFP(atom:number):number\n\t{\n\t\tconst mol = this.meta.mol;\n\t\tlet adj = mol.atomAdjList(atom); // (note: want them all)\n\n\t\t/*\n\t\t\tAtom properties from the source reference:\n\t\t\t\t(1) number of heavy atom neighbours\n\t\t\t\t(2) atom degree: valence minus # hydrogens\n\t\t\t\t(3) atomic number\n\t\t\t\t(4) atom charge\n\t\t\t\t(5) number of hydrogen neighbours\n\t\t\t\t(6) whether the atom is in a ring\n\t\t*/\n\n\t\tlet nheavy = 0, nhydr = mol.atomHydrogens(atom);\n\t\tfor (let a of adj) if (mol.atomElement(a) == 'H') nhydr++; else nheavy++;\n\n\t\tlet atno = mol.atomicNumber(atom);\n\t\tlet degree = Math.max(0, Chemistry.ELEMENT_BONDING[atno] - nhydr);\n\t\tlet chg = mol.atomCharge(atom);\n\t\tlet inring = mol.atomRingBlock(atom) > 0 ? 1 : 0;\n\n\t\tlet crc = start_crc();\n\t\tcrc = feed_crc(crc, (nheavy << 4) | degree);\n\t\tcrc = feed_crc(crc, atno);\n\t\tcrc = feed_crc(crc, chg + 0x80);\n\t\tcrc = feed_crc(crc, (nhydr << 4) | inring);\n\t\treturn end_crc(crc);\n\t}\n\n\t// takes the current identity values\n\tprivate circularIterate(iter:number, atom:number):number\n\t{\n\t\tlet adj = this.atomAdj[atom - 1], adjb = this.bondAdj[atom - 1];\n\n\t\t// build out a sequence, formulated as\n\t\t//     {iteration,original#, adj0-bondorder,adj0-identity, ..., [chiral?]}\n\t\tlet seq = Vec.numberArray(0, 2 + 2 * adj.length);\n\t\tseq[0] = iter;\n\t\tseq[1] = this.identity[atom - 1];\n\t\tfor (let n = 0; n < adj.length; n++)\n\t\t{\n\t\t\tseq[2 * n + 2] = this.meta.isBondAromatic(adjb[n]) ? 0xF : this.meta.mol.bondOrder(adjb[n]);\n\t\t\tseq[2 * n + 3] = this.identity[adj[n] - 1];\n\t\t}\n\n\t\t// now sort the adjacencies by bond order first, then identity second\n\t\tlet p = 0;\n\t\twhile (p < adj.length - 1)\n\t\t{\n\t\t\tlet i = 2 + 2 * p;\n\t\t\tif (seq[i] > seq[i + 2] || (seq[i] == seq[i + 2] && seq[i + 1] > seq[i + 3]))\n\t\t\t{\n\t\t\t\tVec.swap(seq, i, i + 2);\n\t\t\t\tVec.swap(seq, i + 1, i + 3);\n\t\t\t\tif (p > 0) p--;\n\t\t\t}\n\t\t\telse p++;\n\t\t}\n\n\t\t// roll it up into a hash code\n\t\tlet crc = start_crc();\n\t\tfor (let n = 0; n < seq.length; n += 2)\n\t\t{\n\t\t\tcrc = feed_crc(crc, seq[n]);\n\t\t\tlet v = seq[n + 1];\n\t\t\tcrc = feed_crc(crc, v >> 24);\n\t\t\tcrc = feed_crc(crc, (v >> 16) & 0xFF);\n\t\t\tcrc = feed_crc(crc, (v >> 8) & 0xFF);\n\t\t\tcrc = feed_crc(crc, v & 0xFF);\n\t\t}\n\n\t\t// chirality flag: one chance to resolve it\n\t\tif (!this.resolvedChiral[atom - 1] && Vec.len(this.meta.rubricTetra) > 0 && this.meta.rubricTetra[atom - 1] != null)\n\t\t{\n\t\t\tlet ru = this.meta.rubricTetra[atom - 1];\n\t\t\tlet par =\n\t\t\t[\n\t\t\t\tru[0] == 0 ? 0 : this.identity[ru[0] - 1],\n\t\t\t\tru[1] == 0 ? 0 : this.identity[ru[1] - 1],\n\t\t\t\tru[2] == 0 ? 0 : this.identity[ru[2] - 1],\n\t\t\t\tru[3] == 0 ? 0 : this.identity[ru[3] - 1]\n\t\t\t];\n\t\t\tif (par[0] != par[1] && par[0] != par[2] && par[0] != par[3] && par[1] != par[2] && par[1] != par[3] && par[2] != par[3])\n\t\t\t{\n\t\t\t\t// add 1 or 2 to the end of the list, depending on the parity\n\t\t\t\tcrc = feed_crc(crc, Permutation.parityOrder(par) + 1);\n\t\t\t\tthis.resolvedChiral[atom - 1] = true;\n\t\t\t}\n\t\t}\n\n\t\treturn end_crc(crc);\n\t}\n\n\t// takes a set of atom indices and adds all atoms that are adjacent to at least one of them; the resulting list of\n\t// atom indices is sorted\n\tprivate growAtoms(atoms:number[]):number[]\n\t{\n\t\tlet mask = Vec.booleanArray(false, this.meta.mol.numAtoms);\n\t\tfor (let n = 0; n < atoms.length; n++)\n\t\t{\n\t\t\tmask[atoms[n] - 1] = true;\n\t\t\tfor (let a of this.atomAdj[atoms[n] - 1]) mask[a - 1] = true;\n\t\t}\n\t\treturn Vec.add(Vec.maskIdx(mask), 1);\n\t}\n\n\t// add a new fingerprint, with no duplicate check (initial seed round); is only a separate function so it can be trapped\n\tprivate applyNewFP(newFP:CircularFP):void\n\t{\n\t\tif (this.hookConsiderNewFP) this.hookConsiderNewFP(newFP);\n\t\tif (this.hookApplyNewFP) this.hookApplyNewFP(newFP);\n\t\tthis.fplist.push(newFP);\n\t}\n\n\t// consider adding a new fingerprint: if it's a duplicate with regard to the atom list, either replace the match or\n\t// discard it\n\tprivate considerNewFP(newFP:CircularFP):void\n\t{\n\t\tif (this.hookConsiderNewFP) this.hookConsiderNewFP(newFP);\n\n\t\tlet hit = -1;\n\t\tlet fp:CircularFP = null;\n\t\tfor (let n = 0; n < this.fplist.length; n++)\n\t\t{\n\t\t\tlet lookFP = this.fplist[n];\n\t\t\tif (Vec.equals(lookFP.atoms, newFP.atoms)) {fp = lookFP; hit = n; break;}\n\t\t}\n\t\tif (hit < 0)\n\t\t{\n\t\t\tthis.fplist.push(newFP);\n\t\t\treturn;\n\t\t}\n\n\t\t// if the preexisting fingerprint is from an earlier iteration, or has a lower hashcode, discard\n\t\tif (fp.iteration < newFP.iteration || fp.hashCode < newFP.hashCode) return;\n\n\t\tthis.fplist[hit] = newFP;\n\t\tif (this.hookApplyNewFP) this.hookApplyNewFP(newFP);\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {MetaMolecule} from '../data/MetaMolecule';\nimport {Molecule} from '../data/Molecule';\nimport {MolUtil} from '../data/MolUtil';\nimport {norm2_xy} from '../util/util';\nimport {Vec} from '../util/Vec';\nimport {CircularFingerprints, CircularFP} from './CircularFingerprints';\n\n/*\n\tA specialisation of the BayesianModel class, which operates exclusively on Circular (ECFP/FCFP) fingerprints.\n\tProvides convenience methods for feeding in raw molecules to create a model, and also serialisation/deserialisation\n\tfeatures allowing models to be stored and recreated with known properties.\n\n\tThe class is designed to operate with fairly large input sizes, but it does need to hold onto all of the calculated\n\tfingerprint lists so that the final build operation can calculate calibration metrics.\n\n\tIt can operate with any degree of fingerprint folding, including none at all (but this means that there is a diabolical\n\tcase that could get very memory intensive).\n\n\tFolding is optional: 0 means that all hash codes are retained (worst case scenario: 4 billion). If folding,\n\tmust be an exponent of two (e.g. 1024, 2048, 4096, etc.) In practice, ROC curves for recalling single properties\n\ttend to hit diminishing returns above folding sizes of about 1024.\n\n\tSerialisation format is:\n\n\t\tBayesian!({fptype},{folding},{low},{high})\n\t\t{hashidx1}={contribution1}\n\t\t{hashidx2}={contribution2}\n\t\t...\n\t\t!End\n\n\tRecommended file extension is \".bayesian\", MIME type is \"chemistry/x-bayesian\"\n\n\tWhere {fptype} is ECFP0/2/4/6 or FCFP0/2/4/6.\n\n\t{low} and {high} are the boundaries of the response value for the training set.\n*/\n\nexport class BayesianModel\n{\n\t// incoming hash codes: actual values, and subsumed values are {#active,#total}\n\tprivate numActive = 0;\n\tprivate inHash:{[id:number] : number[]} = {};\n\tprivate training:number[][] = [];\n\tprivate activity:boolean[] = [];\n\n\t// built model: contributions for each hash code\n\tprivate contribs:{[id:number] : number} = {};\n\tprivate lowThresh = 0;\n\tprivate highThresh = 0;\n\tprivate range = 0;\n\tprivate invRange = 0;\n\n\t// self-validation metrics: can optionally be calculated after a build\n\tprivate estimates:number[] = null;\n\tpublic rocX:number[] = null; // between 0..1, and rounded to modest precision\n\tpublic rocY:number[] = null;\n\tpublic rocType:string = null;\n\tpublic rocAUC = Number.NaN;\n\tpublic trainingSize = 0; // these are serialised, while the actual training set is not\n\tpublic trainingActives = 0;\n\tpublic atomicSlopeA = Number.NaN; // calibration for atomic predictors (to get into [-1,1])\n\tpublic atomicInterceptB = Number.NaN;\n\n\t// truth-table and derived metrics\n\tpublic truthTP = 0;\n\tpublic truthFP = 0;\n\tpublic truthTN = 0;\n\tpublic truthFN = 0;\n\tpublic precision = Number.NaN;\n\tpublic recall = Number.NaN;\n\tpublic specificity = Number.NaN;\n\tpublic statF1 = Number.NaN;\n\tpublic statKappa = Number.NaN;\n\tpublic statMCC = Number.NaN;\n\n\t// optional text attributes (serialisable)\n\tpublic noteTitle:string = null;\n\tpublic noteOrigin:string = null;\n\tpublic noteField:string = null;\n\tpublic noteComments:string[] = null;\n\n\t// ----------------- public methods -----------------\n\n\t// instantiate: must pick a class, which is one of the CircularFingerprints.CLASS_* constants\n\tconstructor(public classType:number, public folding?:number)\n\t{\n\t\tif (this.folding == null) this.folding = 0;\n\t}\n\n\t// creates fingerprints for the indicated molecule, and adds them into the Bayesian inputs; note that for performance purposes, it is allowed to provide precomputed\n\t// hash codes, but the caller must ensure that they are calculated according to the same schema\n\tpublic addMolecule(mol:Molecule, active:boolean, hashes?:number[])\n\t{\n\t\tif (MolUtil.isBlank(mol) && hashes == null) throw 'Molecule cannot be blank or null.';\n\n\t\tif (hashes == null)\n\t\t{\n\t\t\tlet meta = MetaMolecule.createStrictRubric(mol);\n\t\t\tlet circ = new CircularFingerprints(meta, this.classType);\n\t\t\tcirc.calculate();\n\t\t\thashes = this.folding == 0 ? circ.getUniqueHashes() : circ.getFoldedHashes(this.folding);\n\t\t}\n\n\t\tif (active) this.numActive++;\n\t\tthis.training.push(hashes);\n\t\tthis.activity.push(active);\n\t\tfor (let h of hashes)\n\t\t{\n\t\t\tlet stash = this.inHash[h];\n\t\t\tif (stash == null) stash = [0, 0];\n\t\t\tif (active) stash[0]++;\n\t\t\tstash[1]++;\n\t\t\tthis.inHash[h] = stash;\n\t\t}\n\t}\n\n\t// turns the incoming hashes into fingerprint contributions, which makes up a model that can be used to predict\n\t// newly submitted structures\n\tpublic build():void\n\t{\n\t\tthis.trainingSize = this.training.length; // for posterity\n\t\tthis.trainingActives = this.numActive;\n\n\t\tthis.contribs = [];\n\n\t\tconst sz = this.training.length;\n\t\tconst invSz = 1.0 / sz;\n\t\tconst P_AT = this.numActive * invSz;\n\n\t\tfor (let hashStr in this.inHash)\n\t\t{\n\t\t\tlet hash = parseInt(hashStr);\n\t\t\tconst AT = this.inHash[hash];\n\t\t\tconst A = AT[0], T = AT[1];\n\t\t\tconst Pcorr = (A + 1) / (T * P_AT + 1);\n\t\t\tconst P = Math.log(Pcorr);\n\t\t\tthis.contribs[hash] = P;\n\t\t}\n\n\t\tthis.lowThresh = Number.POSITIVE_INFINITY;\n\t\tthis.highThresh = Number.NEGATIVE_INFINITY;\n\t\tfor (let fp of this.training)\n\t\t{\n\t\t\tlet val = 0;\n\t\t\tfor (let hash of fp) val += this.contribs[hash];\n\t\t\tthis.lowThresh = Math.min(this.lowThresh, val);\n\t\t\tthis.highThresh = Math.max(this.highThresh, val);\n\t\t}\n\t\tthis.range = this.highThresh - this.lowThresh;\n\t\tthis.invRange = this.range > 0 ? 1 / this.range : 0;\n\t}\n\n\t// calculates fingerprints for a molecule, and returns the predictor value\n\tpublic predictMolecule(mol:Molecule):number\n\t{\n\t\tif (MolUtil.isBlank(mol)) throw 'Molecule cannot be blank or null.';\n\n\t\tlet meta = MetaMolecule.createStrictRubric(mol);\n\t\tlet circ = new CircularFingerprints(meta, this.classType);\n\t\tcirc.calculate();\n\t\tlet hashes = this.folding == 0 ? circ.getUniqueHashes() : circ.getFoldedHashes(this.folding);\n\t\treturn this.predictFP(hashes);\n\t}\n\n\t// perform the prediction, given the precomputed hash codes; this may be called from outside of the class for performance reasons, but the caller\n\t// must take care to ensure that the same fingerprint scheme is used, and that the hash codes are ordered\n\tpublic predictFP(hashes:number[]):number\n\t{\n\t\tlet val = 0;\n\t\tfor (let h of hashes)\n\t\t{\n\t\t\tlet c = this.contribs[h];\n\t\t\tif (c != null) val += c;\n\t\t}\n\t\treturn val;\n\t}\n\n\t// converts the predictor (as calculated above) into a value that is scaled and translated into a range that can be used as a probability: most values\n\t// will fall between 0..1, though some out-of-domain cases will exceed this range and may have to be capped\n\tpublic scalePredictor(pred:number):number\n\t{\n\t\t// special case: if there is no differentiation scale, it's either above or below (typically happens with tiny models)\n\t\tif (this.range == 0) return pred >= this.highThresh ? 1 : 0;\n\t\treturn (pred - this.lowThresh) * this.invRange;\n\t}\n\n\t// while the scaled predictor (above) is generally between 0..1 (\"probability-like\"), results can go out of bounds; using the arctan\n\t// function scales it so that the centroid is the same (0.5), but lower/higher values approach 0 or 1 as asymptotes; this is a useful\n\t// way of keeping it within the range without resorting to capping, and has another handy effect of allowing known results to be stored\n\t// in the same field (i.e. 0=known inactive, 1=known active, because these values cannot otherwise be reached)\n\tpublic scaleArcTan(scaled:number):number\n\t{\n\t\tconst INVPI = 1.0 / Math.PI;\n\t\treturn Math.atan(2 * scaled - 1) * INVPI + 0.5;\n\t}\n\n\t// figure out the proportion of a molecule's fingerprints are represented in the model\n\tpublic calculateOverlap(mol:Molecule):number\n\t{\n\t\tif (MolUtil.isBlank(mol)) throw 'Molecule cannot be blank or null.';\n\n\t\tlet meta = MetaMolecule.createStrictRubric(mol);\n\t\tlet circ = new CircularFingerprints(meta, this.classType);\n\t\tcirc.calculate();\n\t\tlet hashes = this.folding == 0 ? circ.getUniqueHashes() : circ.getFoldedHashes(this.folding);\n\t\treturn this.calculateOverlapFP(hashes);\n\t}\n\n\tpublic calculateOverlapFP(hashes:number[]):number\n\t{\n\t\tif (hashes.length == 0) return 0;\n\t\tlet count = 0.0;\n\t\tfor (let h of hashes) if (this.contribs[h] != null) count++;\n\t\treturn hashes.length == 1 ? count : count / hashes.length;\n\t}\n\n\t// builds an array of contribution values per atom; the scale is: 0=neutral, -1=very inactive, 1=very active (but not capped)\n\tpublic calculateAtomPredictors(mol:Molecule):number[]\n\t{\n\t\tconst na = mol.numAtoms;\n\t\tlet atomic = Vec.numberArray(0, na); // (default of zero: is this the best call?)\n\n\t\t// sum the contributions: for each fingerprint that is defined, smear the contribution equally over all of the atoms that were involved in\n\t\t// a fingerprint with that hash code\n\t\tlet predHashes = new Set<number>();\n\t\tlet cover = this.determineCoverage(mol, predHashes);\n\t\tfor (let h in cover)\n\t\t{\n\t\t\tlet c = this.contribs[h];\n\t\t\tif (c == null) continue;\n\t\t\tlet mask = cover[h];\n\t\t\tlet msz = Vec.maskCount(mask);\n\t\t\tlet invSz = 1.0 / msz;\n\t\t\tfor (let n = 0; n < na; n++) if (mask[n]) atomic[n] += c * invSz;\n\t\t}\n\n\t\t// special deal: if there is a calibration for atomic values, apply that and be done with it\n\t\tif (!isNaN(this.atomicSlopeA))\n\t\t{\n\t\t\tfor (let n = 0; n < na; n++) atomic[n] = (this.atomicSlopeA * atomic[n]) + this.atomicInterceptB;\n\t\t\treturn atomic;\n\t\t}\n\n\t\t// double duty: use the same source material to add up the numeric predictor as well (note that the \"coverage\" hashes are not necessarily\n\t\t// the same as the approved list)\n\t\tlet pred = 0;\n\t\tfor (let h of predHashes)\n\t\t{\n\t\t\tlet c = this.contribs[h as any];\n\t\t\tif (c != null) pred += c;\n\t\t}\n\n\t\t// adjust the contributions to an average of zero, with a fixed standard deviation\n\t\tconst SCALE_STDDEV_TO = 0.25;\n\t\tconst invN = 1.0 / na;\n\t\tVec.addTo(atomic, -Vec.sum(atomic) * invN);\n\t\tlet stdDev = 0;\n\t\tfor (let a of atomic) stdDev += a * a;\n\t\tstdDev = Math.sqrt(stdDev * invN);\n\n\t\tif (stdDev > 1E-3) Vec.mulBy(atomic, SCALE_STDDEV_TO / stdDev);\n\n\t\t// shunt it up so that it is centred around the overal predictor, in the same zero-centred space\n\t\tlet scaled = (this.scalePredictor(pred) - 0.5) * 2; // adjusted to the [-1,1] space\n\t\tif (scaled < -1) scaled = -1; else if (scaled > 1) scaled = 1;\n\t\tVec.addTo(atomic, scaled);\n\t\treturn atomic;\n\t}\n\n\t// produces an ROC validation set using the training data, in leave-one-out fashion; note that this is very slow, and scales to O(N^2) relative\n\t// to the size of the training set, so should only be used for small collections\n\tpublic validateLeaveOneOut():void\n\t{\n\t\tconst sz = this.training.length;\n\t\tthis.estimates = [];\n\t\tfor (let n = 0; n < sz; n++) this.estimates.push(this.singleLeaveOneOut(n));\n\t\tthis.calculateROC();\n\t\tthis.calculateTruth();\n\t\tthis.rocType = 'leave-one-out';\n\t}\n\n\t// produces ROC validation, except using an N-pass split, which is much faster than leave-one-out, and is appropriate for reasonably big datasets\n\tpublic validateFiveFold():void\n\t{\n\t\tthis.rocType = 'five-fold';\n\t\tthis.validateNfold(5);\n\t}\n\n\tpublic validateThreeFold():void\n\t{\n\t\tthis.rocType = 'three-fold';\n\t\tthis.validateNfold(3);\n\t}\n\n\t// clears content from the training set (since it can be a memory hog)\n\tpublic clearTraining():void\n\t{\n\t\tthis.training = [];\n\t\tthis.activity = [];\n\t}\n\n\t// turns the model into a serialised ASCII string format\n\tpublic serialise():string\n\t{\n\t\tlet lines:string[] = [];\n\n\t\tlet fpname = this.classType == CircularFingerprints.CLASS_ECFP0 ? 'ECFP0' : this.classType == CircularFingerprints.CLASS_ECFP2 ? 'ECFP2'\n\t\t\t\t   : this.classType == CircularFingerprints.CLASS_ECFP4 ? 'ECFP4' : this.classType == CircularFingerprints.CLASS_ECFP6 ? 'ECFP6'\n\t\t\t\t   : '?';\n\n\t\tlines.push('Bayesian!(' + fpname + ',' + this.folding + ',' + this.lowThresh + ',' + this.highThresh + ')');\n\n\t\t// primary payload: the bit contributions\n\t\tlet sorted:number[] = [];\n\t\tfor (let hash in this.contribs) sorted.push(parseInt(hash));\n\t\tVec.sort(sorted);\n\t\tfor (let hash of sorted)\n\t\t{\n\t\t\tconst c = this.contribs[hash];\n\t\t\tlines.push(hash + '=' + c);\n\t\t}\n\n\t\t// other information\n\t\tlines.push('training:size=' + this.trainingSize);\n\t\tlines.push('training:actives=' + this.trainingActives);\n\n\t\tif (!Number.isNaN(this.rocAUC)) lines.push('roc:auc=' + this.rocAUC);\n\t\tif (this.rocType != null) lines.push('roc:type=' + this.rocType);\n\t\tif (this.rocX != null && this.rocY != null)\n\t\t{\n\t\t\tlet x = 'roc:x=';\n\t\t\tfor (let n = 0; n < this.rocX.length; n++) x += (n == 0 ? '' : ',') + this.rocX[n];\n\t\t\tlines.push(x);\n\n\t\t\tlet y = 'roc:y=';\n\t\t\tfor (let n = 0; n < this.rocY.length; n++) y += (n == 0 ? '' : ',') + this.rocY[n];\n\t\t\tlines.push(y);\n\t\t}\n\n\t\tif (this.truthTP > 0 || this.truthFP > 0 || this.truthTN > 0 || this.truthFP > 0)\n\t\t{\n\t\t\tlines.push('truth:TP=' + this.truthTP);\n\t\t\tlines.push('truth:FP=' + this.truthFP);\n\t\t\tlines.push('truth:TN=' + this.truthTN);\n\t\t\tlines.push('truth:FN=' + this.truthFN);\n\t\t\tlines.push('truth:precision=' + this.precision);\n\t\t\tlines.push('truth:recall=' + this.recall);\n\t\t\tlines.push('truth:specificity=' + this.specificity);\n\t\t\tlines.push('truth:F1=' + this.statF1);\n\t\t\tlines.push('truth:kappa=' + this.statKappa);\n\t\t\tlines.push('truth:MCC=' + this.statMCC);\n\t\t}\n\n\t\tif (!isNaN(this.atomicSlopeA) && !isNaN(this.atomicInterceptB))\n\t\t{\n\t\t\tlines.push('atomic:slope=' + this.atomicSlopeA);\n\t\t\tlines.push('atomic:intercept=' + this.atomicInterceptB);\n\t\t}\n\n\t\t// notes: freeform user text\n\t\tif (this.noteTitle) lines.push('note:title=' + this.noteTitle);\n\t\tif (this.noteOrigin) lines.push('note:origin=' + this.noteOrigin);\n\t\tif (this.noteField) lines.push('note:field=' + this.noteField);\n\t\tif (this.noteComments) for (let comment of this.noteComments) lines.push('note:comment=' + comment);\n\n\t\tlines.push('!End');\n\n\t\treturn lines.join('\\n');\n\t}\n\n\t// transforms string back into model, if possible\n\tpublic static deserialise(str:string):BayesianModel\n\t{\n\t\tlet lines = str.split('\\n'), lnum = 0;\n\t\tfunction readLine() {return lnum >= lines.length ? null : lines[lnum++].trim();}\n\n\t\tlet line = readLine();\n\t\tif (line == null || !line.startsWith('Bayesian!(') || !line.endsWith(')')) throw 'Not a serialised Bayesian model.';\n\t\tlet bits = line.substring(10, line.length - 1).split(',');\n\t\tif (bits.length < 4) throw 'Invalid header content';\n\n\t\tlet classType = bits[0] == 'ECFP0' ? CircularFingerprints.CLASS_ECFP0 : bits[0] == 'ECFP2' ? CircularFingerprints.CLASS_ECFP2\n\t\t\t\t\t  : bits[0] == 'ECFP4' ? CircularFingerprints.CLASS_ECFP4 : bits[0] == 'ECFP6' ? CircularFingerprints.CLASS_ECFP6\n\t\t\t\t\t  : 0;\n\t\tif (classType == 0) throw 'Unknown fingerprint type: ' + bits[0];\n\n\t\tlet folding = parseInt(bits[1]);\n\t\tif (folding > 0) for (let f = folding; f > 0; f = f >> 1)\n\t\t{\n\t\t\tif ((f & 1) == 1 && f != 1)\n\t\t\t{\n\t\t\t\tfolding = -1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (folding < 0) throw 'Fingerprint folding ' + bits[1] + ' invalid: must be 0 or power of 2.';\n\n\t\tlet model = new BayesianModel(classType, folding);\n\t\tmodel.lowThresh = parseFloat(bits[2]);\n\t\tmodel.highThresh = parseFloat(bits[3]);\n\t\tmodel.range = model.highThresh - model.lowThresh;\n\t\tmodel.invRange = model.range > 0 ? 1 / model.range : 0;\n\n\t\tconst PTN_HASHLINE = new RegExp('^(-?\\\\d+)=([\\\\d\\\\.Ee-]+)');\n\n\t\twhile (true)\n\t\t{\n\t\t\tline = readLine();\n\t\t\tif (line == null) throw 'Missing correct terminator line.';\n\t\t\tif (line == '!End') break;\n\n\t\t\tlet match = PTN_HASHLINE.exec(line);\n\t\t\tif (match != null)\n\t\t\t{\n\t\t\t\tlet hash = parseInt(match[1]);\n\t\t\t\tlet c = parseFloat(match[2]);\n\t\t\t\tmodel.contribs[hash] = c;\n\t\t\t}\n\t\t\telse if (line.startsWith('training:size=')) model.trainingSize = parseInt(line.substring(14));\n\t\t\telse if (line.startsWith('training:actives=')) model.trainingActives = parseInt(line.substring(17));\n\t\t\telse if (line.startsWith('roc:auc=')) model.rocAUC = parseFloat(line.substring(8));\n\t\t\telse if (line.startsWith('roc:type=')) model.rocType = line.substring(9);\n\t\t\telse if (line.startsWith('roc:x='))\n\t\t\t{\n\t\t\t\tmodel.rocX = [];\n\t\t\t\tfor (let s of line.substring(6).split(',')) model.rocX.push(parseFloat(s));\n\t\t\t}\n\t\t\telse if (line.startsWith('roc:y='))\n\t\t\t{\n\t\t\t\tmodel.rocY = [];\n\t\t\t\tfor (let s of line.substring(6).split(',')) model.rocY.push(parseFloat(s));\n\t\t\t}\n\t\t\telse if (line.startsWith('truth:TP=')) model.truthTP = parseInt(line.substring(9), 0);\n\t\t\telse if (line.startsWith('truth:FP=')) model.truthFP = parseInt(line.substring(9), 0);\n\t\t\telse if (line.startsWith('truth:TN=')) model.truthTN = parseInt(line.substring(9), 0);\n\t\t\telse if (line.startsWith('truth:FN=')) model.truthFN = parseInt(line.substring(9), 0);\n\t\t\telse if (line.startsWith('truth:precision=')) model.precision = parseFloat(line.substring(16));\n\t\t\telse if (line.startsWith('truth:recall=')) model.recall = parseFloat(line.substring(13));\n\t\t\telse if (line.startsWith('truth:specificity=')) model.specificity = parseFloat(line.substring(18));\n\t\t\telse if (line.startsWith('truth:F1=')) model.statF1 = parseFloat(line.substring(9));\n\t\t\telse if (line.startsWith('truth:kappa=')) model.statKappa = parseFloat(line.substring(12));\n\t\t\telse if (line.startsWith('truth:MCC=')) model.statMCC = parseFloat(line.substring(10));\n\t\t\telse if (line.startsWith('atomic:slope=')) model.atomicSlopeA = parseFloat(line.substring(13));\n\t\t\telse if (line.startsWith('atomic:intercept=')) model.atomicInterceptB = parseFloat(line.substring(17));\n\t\t\telse if (line.startsWith('note:title=')) model.noteTitle = line.substring(11);\n\t\t\telse if (line.startsWith('note:origin=')) model.noteOrigin = line.substring(12);\n\t\t\telse if (line.startsWith('note:field=')) model.noteField = line.substring(11);\n\t\t\telse if (line.startsWith('note:comment='))\n\t\t\t{\n\t\t\t\tif (model.noteComments == null) model.noteComments = [];\n\t\t\t\tmodel.noteComments.push(line.substring(13));\n\t\t\t}\n\t\t}\n\n\t\treturn model;\n\t}\n\n\t// ----------------- private methods -----------------\n\n\t// estimate leave-one-out predictor for a given training entry\n\tprivate singleLeaveOneOut(idx:number):number\n\t{\n\t\tlet exclActive = this.activity[idx];\n\t\tlet exclSet = new Set<number>();\n\t\tfor (let fp of this.training[idx]) exclSet.add(fp);\n\n\t\tconst sz = this.training.length, szN = sz - 1;\n\t\tconst invSzN = 1.0 / szN;\n\t\tconst activeN = exclActive ? this.numActive - 1 : this.numActive;\n\t\tconst P_AT = activeN * invSzN;\n\n\t\tlet val = 0;\n\t\tfor (let hashStr in this.inHash)\n\t\t{\n\t\t\tconst hash = parseInt(hashStr);\n\t\t\tif (!exclSet.has(hash)) continue;\n\t\t\tconst AT = this.inHash[hash];\n\t\t\tconst A = AT[0] - (exclActive ? 1 : 0), T = AT[1] - 1;\n\t\t\tconst Pcorr = (A + 1) / (T * P_AT + 1);\n\t\t\tconst P = Math.log(Pcorr);\n\t\t\tval += P;\n\t\t}\n\t\treturn val;\n\t}\n\n\t// validation with N segments\n\tprivate validateNfold(nsegs:number):void\n\t{\n\t\t// partition between active & inactive, just in case the mixture is heavily skewed\n\t\tconst sz = this.training.length;\n\t\tlet order = Vec.numberArray(0, sz);\n\t\tlet p = 0;\n\t\tfor (let n = 0; n < sz; n++) if (this.activity[n]) order[p++] = n;\n\t\tfor (let n = 0; n < sz; n++) if (!this.activity[n]) order[p++] = n;\n\n\t\t// build N separate contribution models: each one of them build from the entities that are *not* in the segment\n\t\tlet segContribs:{[id:number] : number}[] = [];\n\t\tfor (let n = 0; n < nsegs; n++) segContribs.push(this.buildPartial(order, n, nsegs));\n\n\t\t// use the separate models to estimate the cases that were not covered\n\t\tthis.estimates = Vec.numberArray(0, sz);\n\t\tfor (let n = 0; n < sz; n++) this.estimates[order[n]] = this.estimatePartial(order, n, segContribs[n % nsegs]);\n\t\tthis.calculateROC();\n\t\tthis.calculateTruth();\n\t}\n\n\t// generates a contribution model based on all the training set for which (n%div)!=seg; e.g. for 5-fold, it would use the 80% of the training set\n\t// that is not implied by the current skein\n\tprivate buildPartial(order:number[], seg:number, div:number)\n\t{\n\t\tconst sz = this.training.length;\n\t\tlet na = 0, nt = 0;\n\t\tlet ih:{[id:number] : number[]} = {};\n\t\tfor (let n = 0; n < sz; n++)\n\t\t{\n\t\t\tif (n % div != seg)\n\t\t\t{\n\t\t\t\tconst active = this.activity[order[n]];\n\t\t\t\tif (active) na++;\n\t\t\t\tnt++;\n\t\t\t\tfor (let h of this.training[order[n]])\n\t\t\t\t{\n\t\t\t\t\tlet stash = ih[h];\n\t\t\t\t\tif (stash == null) stash = [0, 0];\n\t\t\t\t\tif (active) stash[0]++;\n\t\t\t\t\tstash[1]++;\n\t\t\t\t\tih[h] = stash;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet segContribs:{[id:number] : number} = {};\n\n\t\tconst invSz = 1.0 / nt;\n\t\tconst P_AT = na * invSz;\n\t\tfor (let hashStr in ih)\n\t\t{\n\t\t\tlet hash = parseInt(hashStr);\n\t\t\tconst AT = ih[hash];\n\t\t\tconst A = AT[0], T = AT[1];\n\t\t\tconst Pcorr = (A + 1) / (T * P_AT + 1);\n\t\t\tconst P = Math.log(Pcorr);\n\t\t\tsegContribs[hash] = P;\n\t\t}\n\n\t\treturn segContribs;\n\t}\n\n\t// using contributions build from some partial section of the training set, uses that to estimate for an untrained entry\n\tprivate estimatePartial(order:number[], idx:number, segContrib:{[id:number] : number}):number\n\t{\n\t\tlet val = 0;\n\t\tfor (let h of this.training[order[idx]])\n\t\t{\n\t\t\tlet c = segContrib[h];\n\t\t\tif (c != null) val += c;\n\t\t}\n\t\treturn val;\n\t}\n\n\t// assumes estimates already calculated, fills in the ROC data\n\tprivate calculateROC():void\n\t{\n\t\t// sort the available estimates, and take midpoints\n\t\tconst sz = this.training.length;\n\t\tlet idx = Vec.idxSort(this.estimates);\n\t\tlet thresholds:number[] = [];\n\t\tthresholds.push(this.lowThresh - 0.01 * this.range);\n\t\tfor (let n = 0; n < sz - 1; n++)\n\t\t{\n\t\t\tconst th1 = this.estimates[idx[n]], th2 = this.estimates[idx[n + 1]];\n\t\t\tif (th1 == th2) continue;\n\t\t\tthresholds.push(0.5 * (th1 + th2));\n\t\t}\n\t\tthresholds.push(this.highThresh + 0.01 * this.range);\n\n\t\t// x = false positives / actual negatives\n\t\t// y = true positives / actual positives\n\t\tthis.rocX = [];\n\t\tthis.rocY = [];\n\t\tlet rocT:number[] = [];\n\n\t\tlet posTrue = 0, posFalse = 0, ipos = 0;\n\t\tlet invPos = 1.0 / this.numActive, invNeg = 1.0 / (sz - this.numActive);\n\t\tfor (let n = 0; n < thresholds.length; n++)\n\t\t{\n\t\t\tconst th = thresholds[n];\n\t\t\tfor (; ipos < sz; ipos++)\n\t\t\t{\n\t\t\t\tif (th < this.estimates[idx[ipos]]) break;\n\t\t\t\tif (this.activity[idx[ipos]]) posTrue++;\n\t\t\t\telse posFalse++;\n\t\t\t}\n\t\t\tconst x = posFalse * invNeg;\n\t\t\tconst y = posTrue * invPos;\n\t\t\tconst rsz = rocT.length;\n\t\t\tif (rsz > 0 && x == this.rocX[rsz - 1] && y == this.rocY[rsz - 1]) continue;\n\n\t\t\tthis.rocX[rsz] = 1 - x;\n\t\t\tthis.rocY[rsz] = 1 - y;\n\t\t\trocT[rsz] = th;\n\t\t}\n\n\t\tthis.rocX = Vec.reverse(this.rocX);\n\t\tthis.rocY = Vec.reverse(this.rocY);\n\t\trocT = Vec.reverse(rocT);\n\n\t\tthis.calibrateThresholds(this.rocX, this.rocY, rocT);\n\n\t\t// calculate area-under-curve\n\t\tthis.rocAUC = 0;\n\t\tfor (let n = 0; n < rocT.length - 1; n++)\n\t\t{\n\t\t\tconst w = this.rocX[n + 1] - this.rocX[n], h = 0.5 * (this.rocY[n] + this.rocY[n + 1]);\n\t\t\tthis.rocAUC += w * h;\n\t\t}\n\n\t\t// collapse the {x,y} coords: no sensible reason to have huge number of points\n\t\tconst DIST = 0.002, DSQ = DIST * DIST;\n\t\tlet gx:number[] = [], gy:number[] = [];\n\t\tgx.push(this.rocX[0]);\n\t\tgy.push(this.rocY[0]);\n\t\tfor (let i = 1; i < rocT.length - 1; i++)\n\t\t{\n\t\t\tconst dx = this.rocX[i] - gx[gx.length - 1], dy = this.rocY[i] - gy[gy.length - 1];\n\t\t\tif (norm2_xy(dx, dy) < DSQ) continue;\n\t\t\tgx.push(this.rocX[i]);\n\t\t\tgy.push(this.rocY[i]);\n\t\t}\n\t\tgx.push(this.rocX[rocT.length - 1]);\n\t\tgy.push(this.rocY[rocT.length - 1]);\n\t}\n\n\t// builds the \"truth table\", which uses the calibration threshold to determine which side of the line each input molecule is on (with whichever\n\t// cross validation split was used for the ROC); from the 2x2 table, all the other metrics can also be derived\n\tprivate calculateTruth():void\n\t{\n\t\tlet thresh = 0.5 * (this.lowThresh + this.highThresh);\n\t\tthis.truthTP = this.truthFP = this.truthTN = this.truthFN = 0;\n\t\tfor (let n = 0; n < this.activity.length; n++)\n\t\t{\n\t\t\tlet actual = this.activity[n], predicted = this.estimates[n] >= thresh;\n\t\t\tif (actual && predicted) this.truthTP++;\n\t\t\telse if (!actual && predicted) this.truthFP++;\n\t\t\telse if (actual && !predicted) this.truthFN++;\n\t\t\telse if (!actual && !predicted) this.truthTN++;\n\t\t}\n\n\t\tconst TP = this.truthTP, FP = this.truthFP, TN = this.truthTN, FN = this.truthFN;\n\n\t\tlet invSize = 1.0 / this.activity.length;\n\n\t\t// calculate F1 score\n\t\tthis.precision = TP / (TP + FP);\n\t\tthis.recall = TP / (TP + FN);\n\t\tthis.specificity = TN / (TN + FP);\n\t\tthis.statF1 = 2 * (this.precision * this.recall) / (this.precision + this.recall);\n\n\t\t// calculate Cohen's kappa\n\t\tlet Pyes = (TP + FP) * invSize * (TP + FN) * invSize;\n\t\tlet Pno = (FP + TN) * invSize * (FN + TN) * invSize;\n\t\tlet P0 = (TP + TN) * invSize, Pe = Pyes + Pno;\n\t\tthis.statKappa = (P0 - Pe) / (1 - Pe);\n\n\t\t// calculate Matthews correlation coefficient\n\t\tlet mccOver = TP * TN - FP * FN;\n\t\tlet mccUnder = (TP + FP) * (TP + FN) * (TN + FP) * (TN + FN);\n\t\tthis.statMCC = mccOver / Math.sqrt(mccUnder);\n\t}\n\n\t// rederives the low/high thresholds, using ROC curve data: once the analysis is complete, the midpoint will be the optimum balance\n\tprivate calibrateThresholds(x:number[], y:number[], t:number[]):void\n\t{\n\t\tconst sz = t.length;\n\t\tlet idx = 0;\n\t\tfor (let n = 1; n < sz; n++) if (y[n] - x[n] > y[idx] - x[idx]) idx = n;\n\t\tconst midThresh = t[idx];\n\t\tlet idxX = 0, idxY = sz - 1;\n\t\tfor (; idxX < idx - 1; idxX++) if (x[idxX] > 0) break;\n\t\tfor (; idxY > idx + 1; idxY--) if (y[idxY] < 1) break;\n\t\tlet delta = Math.min(t[idxX] - midThresh, midThresh - t[idxY]);\n\t\tthis.lowThresh = midThresh - delta;\n\t\tthis.highThresh = midThresh + delta;\n\t\tthis.range = 2 * delta;\n\t\tthis.invRange = this.range > 0 ? 1 / this.range : 0;\n\t}\n\n\t// reapplies the fingerprint generation for a molecule, given that the outgoing indices are known already; it uses this\n\t// information to generate a mask for each of the indices, which describes the atoms that could lead to the fingerprint's\n\t// creation (including all of the possible redundancies)\n\t// note that the \"approvedHashes\" parameter is optional; it will be used to gather the numeric indices of the hashes\n\t// that were approved, i.e. the normal fingerprint list; done for performance reasons, to avoid recalculating\n\tpublic determineCoverage(mol:Molecule, approvedHashes:Set<number>):{[id:number] : boolean[]}\n\t{\n\t\tconst na = mol.numAtoms;\n\t\tlet cover:{[id:number] : boolean[]} = {};\n\t\tconst andBits = this.folding == 0 ? 0xFFFFFFFF : this.folding - 1;\n\n\t\tlet meta = MetaMolecule.createStrictRubric(mol);\n\t\tlet circ = new CircularFingerprints(meta, this.classType);\n\n\t\tlet collectFP = (fp:CircularFP):void =>\n\t\t{\n\t\t\tlet idx = fp.hashCode & andBits;\n\t\t\tif (this.contribs[idx] == null) return; // hash bit not in the model, so abandon it\n\t\t\tlet mask = cover[idx];\n\t\t\tif (mask == null)\n\t\t\t{\n\t\t\t\tmask = Vec.booleanArray(false, na);\n\t\t\t\tcover[idx] = mask;\n\t\t\t}\n\t\t\tfor (let a of fp.atoms) mask[a - 1] = true;\n\t\t};\n\t\tcirc.hookApplyNewFP = collectFP;\n\t\tcirc.hookConsiderNewFP = collectFP;\n\t\tcirc.calculate();\n\n\t\t// collect the \"approved\" hashes, i.e. the normal operation of the fingerprinter\n\t\tif (approvedHashes != null)\n\t\t{\n\t\t\tlet hashes = this.folding == 0 ? circ.getUniqueHashes() : circ.getFoldedHashes(this.folding);\n\t\t\tfor (let h of hashes) approvedHashes.add(h);\n\t\t}\n\n\t\treturn cover;\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Chemistry} from '../data/Chemistry';\nimport {Molecule} from '../data/Molecule';\nimport {Vec} from '../util/Vec';\n\n/*\n\tTurns a molecule into linear notation, following some of the SMILES string patterns. The output will be recognisable as a\n\tconnection table, but it should be noted that the conversion process is extremely lossy. There are only certain use cases\n\twhere this makes sense, mainly for interoperability purposes, e.g. pasting into an online searching tool, or embedding in a\n\ttext format where some molecule is better than none. The output can be made canonical by providing a set of priorities,\n\tbut this is optional, and there is no plan to sync with any of the existing schemes.\n\n\tSpecific deficiencies which could be addressed:\n\t\t- aromaticity is not used at all; the raw bond orders are encoded\n\t\t- stereochemistry is not encoded at all\n\t\t- no query to SMARTS translation\n*/\n\nexport class BuildSMILES\n{\n\tprivate seq:number[]; // the walk-order atom sequence\n\tprivate link:number[][]; // a list of the linking-codes between nonsequential atoms\n\tprivate conn:number[][]; // a list of the \"other atom\" indices corresponding to above\n\n\t// ------------------ public methods --------------------\n\n\t// note: pri is an optional parameter that can be used to specify the walk-order preference\n\tconstructor(private mol:Molecule, private pri:number[] = null)\n\t{\n\t}\n\n\t// performs the calculation, and returns the string\n\tpublic generate():string\n\t{\n\t\tif (this.mol.numAtoms == 0) return '';\n\n\t\tthis.walkSequence();\n\t\tthis.findLinks();\n\t\treturn this.assemble();\n\t}\n\n\t// ------------------ private methods --------------------\n\n\t// orders the atoms by walking down the list\n\tprivate walkSequence():void\n\t{\n\t\tconst mol = this.mol, na = mol.numAtoms, pri = this.pri;\n\t\tthis.seq = [];\n\t\tlet visited = Vec.booleanArray(false, na);\n\n\t\tlet pos = 1;\n\t\tif (pri != null) pos = Vec.idxMin(pri) + 1;\n\n\t\tfor (let count = 0; count < na; count++)\n\t\t{\n\t\t\tthis.seq.push(pos);\n\t\t\tvisited[pos - 1] = true;\n\n\t\t\tif (count == na - 1) break; // last atom doesn't need a next\n\n\t\t\tlet adj = mol.atomAdjList(pos);\n\t\t\tlet cc = mol.atomConnComp(pos);\n\t\t\tpos = 0;\n\n\t\t\t// see if there is an un-visited neighbour\n\t\t\tfor (let n = 0; n < adj.length; n++) if (!visited[adj[n] - 1])\n\t\t\t{\n\t\t\t\tif (pri == null) {pos = adj[n]; break;}\n\t\t\t\tif (pos == 0 || pri[adj[n] - 1] < pri[pos - 1]) pos = adj[n];\n\t\t\t}\n\t\t\tif (pos > 0) continue;\n\n\t\t\t// see if there is an un-visited atom in the same component\n\t\t\tfor (let n = 1; n <= na; n++) if (!visited[n - 1] && mol.atomConnComp(n) == cc)\n\t\t\t{\n\t\t\t\tif (pri == null) {pos = n; break;}\n\t\t\t\tif (pos == 0 || pri[n - 1] < pri[pos - 1]) pos = n;\n\t\t\t}\n\t\t\tif (pos > 0) continue;\n\n\t\t\t// grab the next un-visited atom\n\t\t\tfor (let n = 1; n <= na; n++) if (!visited[n - 1])\n\t\t\t{\n\t\t\t\tif (pri == null) {pos = n; break;}\n\t\t\t\tif (pos == 0 || pri[n - 1] < pri[pos - 1]) pos = n;\n\t\t\t}\n\n\t\t\tif (pos == 0) throw 'Walk sequence failed.';\n\t\t}\n\t}\n\n\t// walks through the established sequence, and marks up bonds that do not follow the logical sequence; these need to be\n\t// assigned a connection number, between each of the atoms\n\tprivate findLinks():void\n\t{\n\t\tconst mol = this.mol, na = mol.numAtoms, pri = this.pri, seq = this.seq;\n\t\tthis.link = [];\n\t\tthis.conn = [];\n\t\tfor (let n = 0; n < na; n++) {this.link.push([]); this.conn.push([]);}\n\n\t\tlet invseq = Vec.numberArray(0, na);\n\t\tfor (let n = 0; n < na; n++) invseq[seq[n] - 1] = n;\n\n\t\tlet inPlay = Vec.numberArray(-1, na + 1); // true if number is currently reserved for reconnection\n\t\tfor (let n = 0; n < na; n++)\n\t\t{\n\t\t\tlet prev = n > 0 ? seq[n - 1] : 0;\n\t\t\tlet cur = seq[n];\n\t\t\tlet next = n < na - 1 ? seq[n + 1] : 0;\n\n\t\t\tfor (let i = 1; i <= na; i++) if (inPlay[i] >= 0 && n > inPlay[i]) inPlay[i] = -1;\n\n\t\t\tlet adj = mol.atomAdjList(cur);\n\n\t\t\t// if we're using priorities, then the adjacency list needs to be sorted\n\t\t\tif (pri != null) for (let p = 0; p < adj.length - 1;)\n\t\t\t{\n\t\t\t\tif (invseq[adj[p] - 1] > invseq[adj[p + 1] - 1])\n\t\t\t\t{\n\t\t\t\t\tVec.swap(adj, p, p + 1);\n\t\t\t\t\tif (p > 0) p--;\n\t\t\t\t}\n\t\t\t\telse p++;\n\t\t\t}\n\n\t\t\t// generate all the obligatory links\n\t\t\tfor (let i = 0; i < adj.length; i++)\n\t\t\t{\n\t\t\t\tif (adj[i] == prev || adj[i] == next) continue; // these are on-sequence, so no need to connect\n\t\t\t\tlet nbr = adj[i];\n\t\t\t\tif (invseq[cur - 1] > invseq[nbr - 1]) continue; // avoid duplicates\n\n\t\t\t\tlet num = -1;\n\t\t\t\tfor (let j = 1; j <= na; j++) if (inPlay[j] < 0)\n\t\t\t\t{\n\t\t\t\t\tnum = j;\n\t\t\t\t\tinPlay[j] = Math.max(invseq[cur - 1], invseq[nbr - 1]);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tthis.link[cur - 1].push(num);\n\t\t\t\tthis.conn[cur - 1].push(nbr);\n\n\t\t\t\tthis.link[nbr - 1].push(num);\n\t\t\t\tthis.conn[nbr - 1].push(cur);\n\t\t\t}\n\t\t}\n\t}\n\n\t// builds the SMILES string from the precomputed data\n\tprivate assemble():string\n\t{\n\t\tconst mol = this.mol, na = mol.numAtoms, seq = this.seq, link = this.link, conn = this.conn;\n\n\t\tlet smiles = '';\n\n\t\tconst NON_ESCAPED = ['C', 'N', 'O', 'P', 'S'];\n\n\t\tfor (let n = 0; n < na; n++)\n\t\t{\n\t\t\tlet prev = n > 0 ? seq[n - 1] : 0, cur = seq[n];\n\t\t\tlet bidx = prev > 0 ? mol.findBond(prev, cur) : 0;\n\t\t\tif (prev > 0 && bidx == 0) smiles += '.';\n\t\t\tif (bidx > 0)\n\t\t\t{\n\t\t\t\tlet bo = mol.bondOrder(bidx);\n\t\t\t\tif (bo == 2) smiles += '=';\n\t\t\t\telse if (bo == 3) smiles += '#';\n\t\t\t}\n\n\t\t\tlet el = mol.atomElement(cur);\n\t\t\tif (Chemistry.ELEMENTS.indexOf(el) < 0) el = '*';\n\t\t\tlet chg = mol.atomCharge(cur);\n\t\t\tif (NON_ESCAPED.indexOf(el) >= 0 && chg == 0)\n\t\t\t{\n\t\t\t\tsmiles += el;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsmiles += '[' + el;\n\t\t\t\tif (chg > 0) smiles += '+' + chg;\n\t\t\t\tif (chg < 0) smiles += chg;\n\t\t\t\tsmiles += ']';\n\t\t\t}\n\n\t\t\tlet num = link[cur - 1];\n\t\t\tif (num != null) for (let i = 0; i < num.length; i++)\n\t\t\t{\n\t\t\t\tbidx = mol.findBond(cur, conn[cur - 1][i]);\n\t\t\t\tlet bo = mol.bondOrder(bidx);\n\t\t\t\tif (bo == 2) smiles += '=';\n\t\t\t\telse if (bo == 3) smiles += '#';\n\n\t\t\t\tif (num[i] < 10) smiles += num[i];\n\t\t\t\telse smiles += '%' + num[i];\n\t\t\t}\n\t\t}\n\n\t\treturn smiles;\n\t}\n\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {colourCode} from './util';\n\n// public theme definition: the values for these colours can be customised; they will be converted into CSS as soon as the initialisation\n// function is called (see below); the general idea is a tetrachrome: most content is monochrome (black text on white background by default),\n// with interesting content marked in the \"lowlight\" colour (turquoise), and active content in \"highlight\" (green)\nexport class Theme\n{\n\t// e.g. 'http://servername/MolSync'; the REST services hang off of this url: ${BASE_URL}/REST/...\n\tpublic static BASE_URL:string = null;\n\n\t// base for static resources that can be fetched without going through the RPC mechanism\n\tpublic static RESOURCE_URL:string = null;\n\n\t// these are open to modification\n\tpublic static foreground = 0x000000;\n\tpublic static background = 0xFFFFFF;\n\tpublic static lowlight = 0x24D0D0;\n\tpublic static lowlightEdge1 = 0x47D5D2;\n\tpublic static lowlightEdge2 = 0x008FD1;\n\tpublic static highlight = 0x00FF00;\n\tpublic static highlightEdge1 = 0x00CA59;\n\tpublic static highlightEdge2 = 0x008650;\n\tpublic static error = 0xFF0000;\n\n\t/* brought over from MMDS app; consider reinstating them\n\tpublic static dialogBackground = 0x20194C66;\n\tpublic static dialogActiveArea1 = 0x20194C26;\n\tpublic static dialogActiveArea2 = 0x20000026;\n\tpublic static buttonShade1 = 0x40236866;;\n\tpublic static buttonShade2 = 0x40004866;;\n\tpublic static buttonSelected1 = 0x3346D4D2;\n\tpublic static buttonSelected2 = 0x33008FD2;\n\tpublic static buttonHighlighted1 = 0x4C00C958;\n\tpublic static buttonHighlighted2 = 0x4C008550;\n\tpublic static current = 0x00A43C;\n\tpublic static currentBorder = 0x40FFC0;\n\tpublic static selected = 0x009488;\n\tpublic static bankTranslucent = 0xC0309070;*/\n}\n\n// to be called as soon as possible from within any environment that uses WebMolKit functionality\nexport function initWebMolKit(resourcePath:string):void\n{\n\tTheme.RESOURCE_URL = resourcePath;\n\n\t// code below here assumes that DOM is defined (which isn't the case for web workers)\n\ttry {let _ = document;}\n\tcatch (e) {return;}\n\n\tif (document) installInlineCSS('main', composeMainCSS());\n}\n\n/*\n\tInline CSS: each major section of WebMolKit that needs its own CSS tags should call installCSS(..) before doing anything interesting.\n\tThe custom CSS should include some number of definitions with the prefix 'wmk-{tag}-{whatever}', where {tag} is a concise definition\n\tthat can be used to make sure that each of these CSS blocks are installed just once.\n*/\n\nlet cssTagsInstalled = new Set<string>();\nexport function hasInlineCSS(tag:string):boolean {return cssTagsInstalled.has(tag);}\n\n// makes sure a block of CSS is installed, returning true if it was added, false if it was already there\nexport function installInlineCSS(tag:string, css:string):boolean\n{\n\tif (cssTagsInstalled.has(tag)) return false;\n\n\tlet el = document.createElement('style');\n\tel.innerHTML = css;\n\tdocument.head.appendChild(el);\n\tcssTagsInstalled.add(tag);\n\treturn true;\n}\n\n// assembles top-level CSS that's available for theming that doesn't have an encapsulating class\nfunction composeMainCSS():string\n{\n\tlet lowlight = colourCode(Theme.lowlight), lowlightEdge1 = colourCode(Theme.lowlightEdge1), lowlightEdge2 = colourCode(Theme.lowlightEdge2);\n\tlet highlight = colourCode(Theme.highlight), highlightEdge1 = colourCode(Theme.highlightEdge1), highlightEdge2 = colourCode(Theme.highlightEdge2);\n\n\t// NOTE: theme is only partially honoured here; need to tighten it up\n\treturn `\n\t\t.wmk-button\n\t\t{\n\t\t\tdisplay: inline-block;\n\t\t\tpadding: 6px 12px;\n\t\t\tmargin-bottom: 0;\n\t\t\tfont-family: 'Open Sans', sans-serif;\n\t\t\tfont-size: 14px;\n\t\t\tfont-weight: normal;\n\t\t\tline-height: 1.42857143;\n\t\t\ttext-align: center;\n\t\t\twhite-space: nowrap;\n\t\t\tvertical-align: middle;\n\t\t\tcursor: pointer;\n\t\t\tbackground-image: none;\n\t\t\tborder: 1px solid transparent;\n\t\t\tborder-radius: 4px;\n\t\t\t-ms-touch-action: manipulation; touch-action: manipulation;\n\t\t\t-webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;\n\t\t}\n\t\t.wmk-button:focus,\n\t\t.wmk-button:active:focus,\n\t\t.wmk-button.active:focus,\n\t\t.wmk-button.focus,\n\t\t.wmk-button:active.focus,\n\t\t.wmk-button.active.focus\n\t\t{\n\t\t\toutline: thin dotted;\n\t\t\toutline: 5px auto -webkit-focus-ring-color;\n\t\t\toutline-offset: -2px;\n\t\t}\n\t\t.wmk-button:hover,\n\t\t.wmk-button:focus,\n\t\t.wmk-button.focus\n\t\t{\n\t\t\tcolor: #333;\n\t\t\ttext-decoration: none;\n\t\t}\n\t\t.wmk-button:active,\n\t\t.wmk-button.active\n\t\t{\n\t\t\tbackground-image: none;\n\t\t\toutline: 0;\n\t\t\t-webkit-box-shadow: inset 0 3px 5px rgba(0, 0, 0, .125);\n\t\t\tbox-shadow: inset 0 3px 5px rgba(0, 0, 0, .125);\n\t\t}\n\t\t.wmk-button.disabled,\n\t\t.wmk-button[disabled],\n\t\tfieldset[disabled] .wmk-button\n\t\t{\n\t\t\tcursor: not-allowed;\n\t\t\tfilter: alpha(opacity=65);\n\t\t\t-webkit-box-shadow: none;\n\t\t\tbox-shadow: none;\n\t\t\topacity: .65;\n\t\t}\n\t\ta.wmk-button.disabled,\n\t\tfieldset[disabled] a.wmk-button\n\t\t{\n\t\t\tpointer-events: none;\n\t\t}\n\n\t\t/* shrunken button */\n\n\t\t.wmk-button-small\n\t\t{\n\t\t\tpadding: 2px 4px;\n\t\t\tline-height: 1;\n\t\t\tfont-size: 12px;\n\t\t}\n\n\t\t/* default button */\n\n\t\t.wmk-button-default\n\t\t{\n\t\t\tcolor: #333;\n\t\t\tbackground-color: #fff;\n\t\t\tbackground-image: linear-gradient(to right bottom, #FFFFFF, #E0E0E0);\n\t\t\tborder-color: #ccc;\n\t\t}\n\t\t.wmk-button-default:focus,\n\t\t.wmk-button-default.focus\n\t\t{\n\t\t\tcolor: #333;\n\t\t\tbackground-color: #e6e6e6;\n\t\t\tborder-color: #8c8c8c;\n\t\t}\n\t\t.wmk-button-default:hover\n\t\t{\n\t\t\tcolor: #333;\n\t\t\tbackground-color: #e6e6e6;\n\t\t\tborder-color: #adadad;\n\t\t}\n\t\t.wmk-button-default:active,\n\t\t.wmk-button-default.active,\n\t\t.open > .dropdown-toggle.wmk-button-default\n\t\t{\n\t\t\tcolor: #333;\n\t\t\tbackground-color: #e6e6e6;\n\t\t\tborder-color: #adadad;\n\t\t}\n\t\t.wmk-button-default:active:hover,\n\t\t.wmk-button-default.active:hover,\n\t\t.open > .dropdown-toggle.wmk-button-default:hover,\n\t\t.wmk-button-default:active:focus,\n\t\t.wmk-button-default.active:focus,\n\t\t.open > .dropdown-toggle.wmk-button-default:focus,\n\t\t.wmk-button-default:active.focus,\n\t\t.wmk-button-default.active.focus,\n\t\t.open > .dropdown-toggle.wmk-button-default.focus\n\t\t{\n\t\t\tcolor: #333;\n\t\t\tbackground-color: #d4d4d4;\n\t\t\tborder-color: #8c8c8c;\n\t\t}\n\t\t.wmk-button-default:active,\n\t\t.wmk-button-default.active,\n\t\t.open > .dropdown-toggle.wmk-button-default\n\t\t{\n\t\t\tbackground-image: none;\n\t\t}\n\t\t.wmk-button-default.disabled:hover,\n\t\t.wmk-button-default[disabled]:hover,\n\t\tfieldset[disabled] .wmk-button-default:hover,\n\t\t.wmk-button-default.disabled:focus,\n\t\t.wmk-button-default[disabled]:focus,\n\t\tfieldset[disabled] .wmk-button-default:focus,\n\t\t.wmk-button-default.disabled.focus,\n\t\t.wmk-button-default[disabled].focus,\n\t\tfieldset[disabled] .wmk-button-default.focus\n\t\t{\n\t\t\tbackground-color: #fff;\n\t\t\tborder-color: #ccc;\n\t\t}\n\t\t.wmk-button-default .badge\n\t\t{\n\t\t\tcolor: #fff;\n\t\t\tbackground-color: #333;\n\t\t}\n\n\t\t/* primary button */\n\n\t\t.wmk-button-primary\n\t\t{\n\t\t\tcolor: #fff;\n\t\t\tbackground-color: #008FD2;\n\t\t\tbackground-image: linear-gradient(to right bottom, ${lowlightEdge1}, ${lowlightEdge2});\n\t\t\tborder-color: #00C0C0;\n\t\t}\n\t\t.wmk-button-primary:focus,\n\t\t.wmk-button-primary.focus\n\t\t{\n\t\t\tcolor: #fff;\n\t\t\tbackground-color: ${lowlight};\n\t\t\tborder-color: #122b40;\n\t\t}\n\t\t.wmk-button-primary:hover\n\t\t{\n\t\t\tcolor: #fff;\n\t\t\tbackground-color: #286090;\n\t\t\tborder-color: #204d74;\n\t\t}\n\t\t.wmk-button-primary:active,\n\t\t.wmk-button-primary.active,\n\t\t.open > .dropdown-toggle.wmk-button-primary\n\t\t{\n\t\t\tcolor: #fff;\n\t\t\tbackground-color: #286090;\n\t\t\tborder-color: #20744d;\n\t\t}\n\t\t.wmk-button-primary:active:hover,\n\t\t.wmk-button-primary.active:hover,\n\t\t.open > .dropdown-toggle.wmk-button-primary:hover,\n\t\t.wmk-button-primary:active:focus,\n\t\t.wmk-button-primary.active:focus,\n\t\t.open > .dropdown-toggle.wmk-button-primary:focus,\n\t\t.wmk-button-primary:active.focus,\n\t\t.wmk-button-primary.active.focus,\n\t\t.open > .dropdown-toggle.wmk-button-primary.focus\n\t\t{\n\t\t\tcolor: #fff;\n\t\t\tbackground-color: ${highlight};\n\t\t\tbackground-image: linear-gradient(to right bottom, ${highlightEdge1}, ${highlightEdge2});\n\t\t\tborder-color: #12802b;\n\t\t}\n\t\t.wmk-button-primary:active,\n\t\t.wmk-button-primary.active,\n\t\t.open > .dropdown-toggle.wmk-button-primary\n\t\t{\n\t\t\tbackground-image: none;\n\t\t}\n\t\t.wmk-button-primary.disabled:hover,\n\t\t.wmk-button-primary[disabled]:hover,\n\t\tfieldset[disabled] .wmk-button-primary:hover,\n\t\t.wmk-button-primary.disabled:focus,\n\t\t.wmk-button-primary[disabled]:focus,\n\t\tfieldset[disabled] .wmk-button-primary:focus,\n\t\t.wmk-button-primary.disabled.focus,\n\t\t.wmk-button-primary[disabled].focus,\n\t\tfieldset[disabled] .wmk-button-primary.focus\n\t\t{\n\t\t\tbackground-color: #337ab7;\n\t\t\tborder-color: #2ea46d;\n\t\t}\n\t\t.wmk-button-primary .badge\n\t\t{\n\t\t\tcolor: #337ab7;\n\t\t\tbackground-color: #fff;\n\t\t}\n\t`;\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {deepClone, findNode, findNodes, nodeText} from '../util/util';\nimport {XML} from '../util/XML';\nimport {DataSheet, DataSheetColumn} from './DataSheet';\nimport {Molecule} from './Molecule';\nimport {MoleculeStream} from './MoleculeStream';\n\n/*\n\tSerialisation and deserialisation utilities for the DataSheet object.\n\n\tNote that the DataSheet class has a JSON property (.data) that is already suitable for sending back and forth\n\tbetween the server when a JSON-formatted datasheet is required.\n*/\n\nexport class DataSheetStream\n{\n\t// static method: reads in a string that is presumed to XML, and converts it to a datasheet, which is returned; returns null if\n\t// something went wrong\n\tpublic static readXML(strXML:string):DataSheet\n\t{\n\t\tlet xmlDoc:Document;\n\t\tif (XML.customParser)\n\t\t\txmlDoc = new XML.customParser().parseFromString(strXML, 'application/xml');\n\t\telse\n\t\t\txmlDoc = new DOMParser().parseFromString(strXML, 'application/xml');\n\t\tif (xmlDoc == null) return null;\n\t\tlet root = xmlDoc.documentElement;\n\t\tif (root == null) return null;\n\n\t\tlet ds = new DataSheet();\n\n\t\t// overview\n\t\tlet summary = findNode(root, 'Summary');\n\t\tif (summary == null) return null;\n\t\tds.title = nodeText(findNode(summary, 'Title'));\n\t\tds.description = nodeText(findNode(summary, 'Description'));\n\n\t\t// extensions\n\t\tlet extRoot = findNode(root, 'Extension');\n\t\tif (extRoot != null)\n\t\t{\n\t\t\t//let extList=goog.dom.xml.selectNodes(extRoot,'Ext');\n\t\t\tlet extList = findNodes(extRoot, 'Ext');\n\t\t\tfor (let n = 0; n < extList.length; n++)\n\t\t\t{\n\t\t\t\tlet ext = extList[n];\n\t\t\t\t//ds.appendExtension(ext.attributes.name.value,ext.attributes.type.value,nodeText(ext));\n\t\t\t\tds.appendExtension(ext.getAttribute('name'), ext.getAttribute('type'), nodeText(ext));\n\t\t\t}\n\t\t}\n\n\t\t// header: columns\n\t\tlet header = findNode(root, 'Header');\n\t\tlet numCols = parseInt(header.getAttribute('ncols'));//, numRows = parseInt(header.getAttribute('nrows'));\n\t\tlet colList = findNodes(header, 'Column');\n\t\tif (colList.length != numCols) return null;\n\t\tfor (let n = 0; n < numCols; n++)\n\t\t{\n\t\t\tlet col = colList[n];\n\t\t\tlet id = parseInt(col.getAttribute('id'));\n\t\t\tif (id != n + 1) return null;\n\t\t\tds.appendColumn(col.getAttribute('name'), col.getAttribute('type') as DataSheetColumn, nodeText(col));\n\t\t}\n\n\t\t// rows\n\t\tlet rowidx = 0;\n\t\tfor (let row of findNodes(findNode(root, 'Content'), 'Row'))\n\t\t{\n\t\t\tif (parseInt(row.getAttribute('id')) != rowidx + 1) return null;\n\n\t\t\tds.appendRow();\n\n\t\t\tfor (let col of findNodes(row, 'Cell'))\n\t\t\t{\n\t\t\t\tlet colidx = parseInt(col.getAttribute('id')) - 1;\n\t\t\t\tlet ct = ds.colType(colidx), val = nodeText(col);\n\n\t\t\t\tif (val == '') {}\n\t\t\t\telse if (ct == DataSheetColumn.Molecule) ds.setObject(rowidx, colidx, val);\n\t\t\t\telse if (ct == DataSheetColumn.String) ds.setString(rowidx, colidx, val);\n\t\t\t\telse if (ct == DataSheetColumn.Real) ds.setReal(rowidx, colidx, parseFloat(val));\n\t\t\t\telse if (ct == DataSheetColumn.Integer) ds.setInteger(rowidx, colidx, parseInt(val));\n\t\t\t\telse if (ct == DataSheetColumn.Boolean) ds.setBoolean(rowidx, colidx, val == 'true' ? true : val == 'false' ? false : null);\n\t\t\t\telse if (ct == DataSheetColumn.Extend) ds.setExtend(rowidx, colidx, val);\n\n\t\t\t\tcol = col.nextElementSibling;\n\t\t\t\tcolidx++;\n\t\t\t}\n\n\t\t\trow = row.nextElementSibling;\n\t\t\trowidx++;\n\t\t}\n\n\t\treturn ds;\n\t}\n\n\t// instantiate with a JSON object, which is basically the title, description, columns, rows & extensions\n\tpublic static readJSON(json:Record<string, any>):DataSheet\n\t{\n\t\tif (!json.colData || !json.rowData) throw 'Not a JSON-formatted datasheet.';\n\t\treturn new DataSheet(deepClone(json));\n\t}\n\n\t// static method: converts a datasheet into an XML-formatted string\n\tpublic static writeXML(ds:DataSheet):string\n\t{\n\t\t//let xml = new DOMParser().parseFromString('<DataSheet/>', 'text/xml');\n\t\tlet xml:Document;\n\t\tif (XML.customParser)\n\t\t\txml = new XML.customParser().parseFromString('<DataSheet/>', 'application/xml');\n\t\telse\n\t\t\txml = new DOMParser().parseFromString('<DataSheet/>', 'application/xml');\n\n\t\t// summary area\n\t\tlet summary = xml.createElement('Summary');\n\t\txml.documentElement.appendChild(summary);\n\t\tlet title = xml.createElement('Title'), descr = xml.createElement('Description');\n\t\tsummary.appendChild(title); title.appendChild(xml.createTextNode(ds.title));\n\t\tsummary.appendChild(descr); descr.appendChild(xml.createCDATASection(ds.description));\n\n\t\t// extras\n\t\tlet extension = xml.createElement('Extension');\n\t\txml.documentElement.appendChild(extension);\n\t\tfor (let n = 0; n < ds.numExtensions; n++)\n\t\t{\n\t\t\tlet ext = xml.createElement('Ext');\n\t\t\textension.appendChild(ext);\n\t\t\text.setAttribute('name', ds.getExtName(n));\n\t\t\text.setAttribute('type', ds.getExtType(n));\n\t\t\text.appendChild(xml.createCDATASection(ds.getExtData(n)));\n\t\t}\n\n\t\t// columns\n\t\tlet header = xml.createElement('Header');\n\t\txml.documentElement.appendChild(header);\n\t\theader.setAttribute('nrows', ds.numRows.toString());\n\t\theader.setAttribute('ncols', ds.numCols.toString());\n\t\tfor (let n = 0; n < ds.numCols; n++)\n\t\t{\n\t\t\tlet column = xml.createElement('Column');\n\t\t\theader.appendChild(column);\n\t\t\tcolumn.setAttribute('id', (n + 1).toString());\n\t\t\tcolumn.setAttribute('name', ds.colName(n));\n\t\t\tcolumn.setAttribute('type', ds.colType(n));\n\t\t\tcolumn.appendChild(xml.createTextNode(ds.colDescr(n)));\n\t\t}\n\n\t\t// rows\n\t\tlet content = xml.createElement('Content');\n\t\txml.documentElement.appendChild(content);\n\t\tfor (let r = 0; r < ds.numRows; r++)\n\t\t{\n\t\t\tlet row = xml.createElement('Row');\n\t\t\trow.setAttribute('id', (r + 1).toString());\n\t\t\tcontent.appendChild(row);\n\n\t\t\tfor (let c = 0; c < ds.numCols; c++)\n\t\t\t{\n\t\t\t\tlet cell = xml.createElement('Cell');\n\t\t\t\tcell.setAttribute('id', (c + 1).toString());\n\t\t\t\trow.appendChild(cell);\n\t\t\t\tlet ct = ds.colType(c);\n\n\t\t\t\tlet txtNode:Node = null;\n\t\t\t\tif (ds.isNull(r, c)) {}\n\t\t\t\telse if (ct == DataSheetColumn.Molecule)\n\t\t\t\t{\n\t\t\t\t\tlet obj = ds.getObject(r, c);\n\t\t\t\t\tif (obj instanceof Molecule) obj = MoleculeStream.writeNative(obj);\n\t\t\t\t\ttxtNode = xml.createCDATASection(obj as string);\n\t\t\t\t}\n\t\t\t\telse if (ct == DataSheetColumn.String) txtNode = xml.createCDATASection(ds.getString(r, c));\n\t\t\t\telse if (ct == DataSheetColumn.Real) txtNode = xml.createTextNode(ds.getReal(r, c).toString());\n\t\t\t\telse if (ct == DataSheetColumn.Integer) txtNode = xml.createTextNode(ds.getInteger(r, c).toString());\n\t\t\t\telse if (ct == DataSheetColumn.Boolean) txtNode = xml.createTextNode(ds.getBoolean(r, c).toString());\n\t\t\t\telse if (ct == DataSheetColumn.Extend) txtNode = xml.createCDATASection(ds.getExtend(r, c));\n\n\t\t\t\tif (txtNode != null) cell.appendChild(txtNode);\n\t\t\t}\n\t\t}\n\n\t\tif (XML.customSerial)\n\t\t\treturn new XML.customSerial().serializeToString(xml.documentElement);\n\t\telse\n\t\t\treturn new XMLSerializer().serializeToString(xml.documentElement);\n\t}\n\n\t// make a serialisation-ready JSON object with the datasheet content of interest\n\tpublic static writeJSON(ds:DataSheet):any\n\t{\n\t\tlet data = (ds as any).data; // bogarting private member\n\n\t\tlet nrow = ds.numRows, ncol = ds.numCols;\n\t\tlet rowData:any[][] = new Array(nrow);\n\t\tfor (let n = 0; n < nrow; n++) rowData[n] = new Array(ncol);\n\t\tfor (let c = 0; c < ncol; c++)\n\t\t{\n\t\t\tlet doConvert = ds.colType(c) == DataSheetColumn.Molecule;\n\t\t\tfor (let r = 0; r < nrow; r++)\n\t\t\t{\n\t\t\t\tlet val = data.rowData[r][c];\n\t\t\t\tif (val != null && doConvert) val = val.toString(); // turns {mol-or-string} into {string}\n\t\t\t\trowData[r][c] = val;\n\t\t\t}\n\t\t}\n\n\t\tlet json =\n\t\t{\n\t\t\ttitle: data.title,\n\t\t\tdescription: data.description,\n\t\t\tcolData: deepClone(data.colData),\n\t\t\trowData: rowData,\n\t\t\textData: deepClone(data.extData),\n\t\t};\n\t\treturn json;\n\t}\n\n}\n\n","/*\n\tWebMolKit\n\n\t(c) 2010-2020 Molecular Materials Informatics, Inc.\n\n\tAll rights reserved\n\n\thttp://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {CircularFingerprints} from '../calc/CircularFingerprints';\nimport {Theme} from '../util/Theme';\nimport {DEGRAD, escapeHTML, norm_xy, readTextURL} from '../util/util';\nimport {Vec} from '../util/Vec';\nimport {CoordUtil} from './CoordUtil';\nimport {DataSheetColumn} from './DataSheet';\nimport {DataSheetStream} from './DataSheetStream';\nimport {MetaMolecule} from './MetaMolecule';\nimport {Molecule} from './Molecule';\nimport {MolUtil} from './MolUtil';\n\nexport const TEMPLATE_FILES =\n[\n\t'rings',\n\t'termgrp',\n\t'funcgrp',\n\t'protgrp',\n\t'nonplrings',\n\t'largerings',\n\t'crownethers',\n\t'ligmonodent',\n\t'ligbident',\n\t'ligtrident',\n\t'ligmultident',\n\t'cagecmplx',\n\t'aminoacids',\n\t'biomolecules',\n\t'saccharides'\n];\n\n/*\n\tAbbreviation container: a singleton list of inline abbreviations which are initially bootstrapped from the available templates.\n*/\n\nexport interface AbbrevContainerFrag\n{\n\tname:string;\n\tfrag:Molecule;\n\tnameHTML:string; // label in HTML format, with sub & superscripts\n\tnameSearch:string; // label in lower case with formatting characters stripped\n}\n\nexport class AbbrevContainer\n{\n\tpublic static main:AbbrevContainer = null;\n\n\tprivate abbrevs:AbbrevContainerFrag[] = [];\n\n\t// ----------------- static methods -----------------\n\n\t// needs to be called once per lifecycle, in order to ensure that the necessary resources are loaded\n\tpublic static needsSetup() {return !this.main;}\n\tpublic static async setupData()\n\t{\n\t\tif (this.main) return;\n\n\t\tif (!Theme.RESOURCE_URL) throw ('RPC resource URL not defined.');\n\n\t\tthis.main = new AbbrevContainer();\n\n\t\tfor (let tfn of TEMPLATE_FILES)\n\t\t{\n\t\t\tlet url = Theme.RESOURCE_URL + '/data/templates/' + tfn + '.ds';\n\t\t\tlet dsstr = await readTextURL(url);\n\t\t\tlet ds = DataSheetStream.readXML(dsstr);\n\n\t\t\tlet colMol = ds.firstColOfType(DataSheetColumn.Molecule), colAbbrev = ds.findColByName('Abbrev', DataSheetColumn.String);\n\t\t\tif (colMol < 0 || colAbbrev < 0) continue;\n\t\t\tfor (let n = 0; n < ds.numRows; n++)\n\t\t\t{\n\t\t\t\tlet frag = ds.getMoleculeClone(n, colMol), name = ds.getString(n, colAbbrev);\n\t\t\t\tif (!frag || !name) continue;\n\n\t\t\t\tlet attcount = 0, firstConn = 0;\n\t\t\t\tfor (let i = 1; i <= frag.numAtoms; i++) if (frag.atomElement(i) == MolUtil.TEMPLATE_ATTACHMENT)\n\t\t\t\t{\n\t\t\t\t\tif (firstConn == 0) firstConn = i;\n\t\t\t\t\tfrag.setAtomElement(i, MolUtil.ABBREV_ATTACHMENT);\n\t\t\t\t\tattcount++;\n\t\t\t\t}\n\t\t\t\tif (attcount != 1) continue; // (don't want abbreviations with two attachment points; they are sort of valid, but not appropriate for here)\n\t\t\t\tif (firstConn > 1) frag.swapAtoms(1, firstConn);\n\t\t\t\tthis.main.submitAbbreviation(name, frag);\n\t\t\t}\n\n\t\t}\n\t}\n\n\t// returns a shallow copy of the abbreviations (because the original list can grow in the meanwhile)\n\tpublic getAbbrevs():AbbrevContainerFrag[]\n\t{\n\t\treturn this.abbrevs.slice(0);\n\t}\n\n\t// adds an abbreviation explicitly to the collection, if not there already; returns control immediately (background thread)\n\tpublic submitAbbreviation(name:string, infrag:Molecule, promote:boolean = false):void\n\t{\n\t\tlet frag = infrag.clone();\n\t\tthis.submitFragment(name, frag, promote);\n\t}\n\n\t// pulls apart the contents of a molecule, looking for abbreviations; anything that is new gets added to the background; this function returns control immediately\n\tpublic submitMolecule(inmol:Molecule, promote:boolean = false):void\n\t{\n\t\tlet mol = inmol.clone();\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t{\n\t\t\tlet frag = MolUtil.getAbbrev(mol, n);\n\t\t\tif (!frag) continue;\n\t\t\tthis.submitFragment(mol.atomElement(n), frag, promote);\n\t\t}\n\t}\n\n\t// given that an atom has been turned into an abbreviation, searches through the list to see if the fragment structure matches anything; if so, borrows the name\n\t// and modifies the molecule accordingly\n\tpublic substituteAbbrevName(mol:Molecule, atom:number):boolean\n\t{\n\t\tlet frag = MolUtil.getAbbrev(mol, atom);\n\t\tif (!frag) return false;\n\n\t\tlet fragExp = MolUtil.expandedAbbrevs(frag);\n\t\tlet fragMF = MolUtil.molecularFormula(fragExp);\n\t\tlet fragFP = CircularFingerprints.create(MetaMolecule.createStrictRubric(fragExp), CircularFingerprints.CLASS_ECFP6).getUniqueHashes();\n\n\t\tfor (let abbrev of this.abbrevs) if (abbrev.frag.numAtoms == frag.numAtoms)\n\t\t{\n\t\t\tlet match = CoordUtil.sketchEquivalent(frag, abbrev.frag);\n\t\t\tif (!match)\n\t\t\t{\n\t\t\t\tlet afragExp = MolUtil.expandedAbbrevs(abbrev.frag);\n\t\t\t\tif (fragMF == MolUtil.molecularFormula(afragExp))\n\t\t\t\t{\n\t\t\t\t\tlet afragFP = CircularFingerprints.create(MetaMolecule.createStrictRubric(afragExp), CircularFingerprints.CLASS_ECFP6).getUniqueHashes();\n\t\t\t\t\tif (Vec.equals(fragFP, afragFP)) match = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (match)\n\t\t\t{\n\t\t\t\tmol.setAtomElement(atom, abbrev.name);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t// ----------------- private methods -----------------\n\n\t// considers the abbrevation for inclusion in the list; it is assumed that this is being called in a background thread, and also that 'frag' has already been\n\t// copied and is safely owned by this instance\n\tprivate submitFragment(name:string, frag:Molecule, promote:boolean):void\n\t{\n\t\tif (name == '?') return; // no thanks!\n\n\t\t// rotate the fragment so that the attachment (atom 1) is oriented \"west\"\n\t\tlet vx = 0, vy = 0;\n\t\tlet adj = frag.atomAdjList(1);\n\t\tfor (let a of adj)\n\t\t{\n\t\t\tvx += frag.atomX(a) - frag.atomX(1);\n\t\t\tvy += frag.atomY(a) - frag.atomY(1);\n\t\t}\n\t\tif (adj.length > 1) {let inv = 1.0 / adj.length; vx *= inv; vy *= inv;}\n\t\tif (norm_xy(vx, vy) > 0.1 * 0.1)\n\t\t{\n\t\t\tlet theta = Math.atan2(vy, vx);\n\t\t\tif (Math.abs(theta) > 2 * DEGRAD) CoordUtil.rotateMolecule(frag, -theta);\n\t\t}\n\n\t\tlet hit = -1;\n\t\tfor (let n = 0; n < this.abbrevs.length; n++)\n\t\t{\n\t\t\tlet a = this.abbrevs[n];\n\t\t\tif (a.name != name) continue;\n\t\t\t// Q: what to do if same name but different thing? esp. if just a different orientation...\n\t\t\t//if a.frag.compareTo(frag) == 0 || CoordUtil.sketchMappable(mol1:frag, mol2:a.frag) {hit = n; break}\n\t\t\thit = n;\n\t\t\tbreak;\n\t\t}\n\n\t\tlet [html, search] = this.formatAbbrevLabel(name);\n\t\tlet abv:AbbrevContainerFrag = {name, frag, nameHTML: html, nameSearch: search};\n\t\tif (hit < 0)\n\t\t{\n\t\t\tif (promote) this.abbrevs.unshift(abv); else this.abbrevs.push(abv);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (promote && hit > 0)\n\t\t\t{\n\t\t\t\tthis.abbrevs.splice(hit, 1);\n\t\t\t\tthis.abbrevs.unshift(abv);\n\t\t\t}\n\t\t\telse this.abbrevs[hit] = abv;\n\t\t}\n\t}\n\n\t// prepare the HTML & searchable forms of an abbreviation label\n\tprivate formatAbbrevLabel(name:string):[string, string]\n\t{\n\t\tlet html = '', search = '';\n\n\t\tlet append = (bit:string, tag:string):void =>\n\t\t{\n\t\t\tif (tag) html += '<' + tag + '>';\n\t\t\thtml += escapeHTML(bit);\n\t\t\tsearch += bit;\n\t\t\tif (tag) html += '</' + tag + '>';\n\t\t};\n\n\t\tfor (let bit of name.split('|'))\n\t\t{\n\t\t\twhile (true)\n\t\t\t{\n\t\t\t\tlet match = bit.match(/^(.*?)\\{(.*?)\\}(.*)$/);\n\t\t\t\tif (!match) break;\n\t\t\t\tlet pre = match[1], mid = match[2], post = match[3];\n\t\t\t\tappend(pre, null);\n\t\t\t\tif (mid.startsWith('^')) append(mid.substring(1), 'sup'); else append(mid, 'sub');\n\t\t\t\tbit = post;\n\t\t\t}\n\t\t\tappend(bit, null);\n\t\t}\n\n\t\treturn [html, search.toLowerCase()];\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\n/* eslint-disable key-spacing */\n\n/*\n\tProvides fixed constants for dataformats.\n\n\t(Note: presence in this file does not imply that they are all implemented yet)\n*/\n\nexport class FormatList\n{\n\tpublic static FMT_NATIVE = 'native'; // SketchEl molecule format\n\tpublic static FMT_XMLDS = 'xmlds'; // XML datasheet format\n\tpublic static FMT_MDLMOL = 'mdlmol'; // MDL MOLfile (slightly lossy)\n\tpublic static FMT_MDLSDF = 'mdlsdf'; // MDL SDfile (very lossy)\n\tpublic static FMT_MDLRDF = 'mdlrdf'; // MDL RDfile (very lossy)\n\tpublic static FMT_MDLRXN = 'mdlrxn'; // MDL RXNfile (extremely lossy)\n\n\tpublic static GFX_PNG = 'png'; // raster graphics (single image)\n\tpublic static GFX_PNGZIP = 'pngzip'; // zip file containing multiple PNG images\n\tpublic static GFX_SVG = 'svg'; // scalable vector graphics (single diagram)\n\tpublic static GFX_SVGZIP = 'svgzip'; // zip file containing multiple SVG diagrams\n\tpublic static GFX_PDF = 'pdf'; // portable document format (single diagram)\n\tpublic static GFX_PDFZIP = 'pdfzip'; // zip file containing multiple PDF diagrams\n\tpublic static GFX_EPS = 'eps'; // encapsulated postscript (single diagram)\n\tpublic static GFX_HTML = 'html'; // HTML file with embedded SVG diagrams\n\tpublic static GFX_OPENDOC_ODG = 'odg'; // OpenDocument: graphic (single)\n\tpublic static GFX_OPENDOC_ODT = 'odt'; // OpenDocument: text\n\tpublic static GFX_OPENDOC_ODS = 'ods'; // OpenDocument: spreadsheet\n\tpublic static GFX_OOXML_DOCX = 'docx'; // Microsoft Word XML\n\tpublic static GFX_OOXML_XLSX = 'xlsx'; // Microsoft Excel XML\n\n\tpublic static FORMAT_DESCR:Record<string, string> =\n\t{\n\t\t'native':\t'SketchEl Molecule',\n\t\t'xmlds':\t'DataSheet XML',\n\t\t'mdlmol':\t'MDL MOL (single molecule)',\n\t\t'mdlsdf':\t'MDL SDF (molecules + data)',\n\t\t'mdlrdf':\t'MDL RDF (reactions + data)',\n\t\t'mdlrxn':\t'MDL RXN (single reaction)',\n\n\t\t'png':\t\t'PNG image (raster)',\n\t\t'pngzip':\t'ZIP (multiple PNG files)',\n\t\t'svg':\t\t'SVG picture (vector)',\n\t\t'svgzip':\t'ZIP (multiple SVG files)',\n\t\t'pdf':\t\t'PDF diagram (vector)',\n\t\t'pdfzip':\t'ZIP (multiple PDF files)',\n\t\t'eps':\t\t'Encapsulated PostScript (vector)',\n\t\t'html':\t\t'HTML with embedded SVG',\n\t\t'odg':\t\t'OpenDocument Graphic',\n\t\t'odt':\t\t'OpenDocument Text',\n\t\t'ods':\t\t'OpenDocument SpreadSheet',\n\t\t'docx':\t\t'Microsoft Word',\n\t\t'xlsx':\t\t'Microsoft Excel'\n\t};\n\tpublic static FORMAT_EXTN:Record<string, string> =\n\t{\n\t\t'native':\t'.el',\n\t\t'xmlds':\t'.ds',\n\t\t'mdlmol':\t'.mol',\n\t\t'mdlsdf':\t'.sdf',\n\t\t'mdlrdf':\t'.rdf',\n\t\t'mdlrxn':\t'.rxn',\n\t\t'png':\t\t'.png',\n\t\t'pngzip':\t'_png.zip',\n\t\t'svg':\t\t'.svg',\n\t\t'svgzip':\t'_svg.zip',\n\t\t'pdf':\t\t'.pdf',\n\t\t'pdfzip':\t'_pdf.zip',\n\t\t'eps':\t\t'.eps',\n\t\t'html':\t\t'.html',\n\t\t'odg':\t\t'.odg',\n\t\t'odt':\t\t'.odt',\n\t\t'ods':\t\t'.ods',\n\t\t'docx':\t\t'.docx',\n\t\t'xlsx':\t\t'.xlsx'\n\t};\n\tpublic static FORMAT_MIMETYPE:Record<string, string> =\n\t{\n\t\t'native':\t'chemical/x-sketchel',\n\t\t'xmlds':\t'chemical/x-datasheet',\n\t\t'mdlmol':\t'chemical/x-mdl-molfile',\n\t\t'mdlsdf':\t'chemical/x-mdl-sdfile',\n\t\t'mdlrdf':\t'chemical/x-mdl-rdfile',\n\t\t'mdlrxn':\t'chemical/x-mdl-rxnfile',\n\t\t'png':\t\t'image/png',\n\t\t'pngzip':\t'application/zip',\n\t\t'svg':\t\t'image/png',\n\t\t'svgzip':\t'application/zip',\n\t\t'pdf':\t\t'application/pdf',\n\t\t'pdfzip':\t'application/zip',\n\t\t'eps':\t\t'image/eps',\n\t\t'html':\t\t'text/html',\n\t\t'odg':\t\t'application/vnd.oasis.opendocument.graphics',\n\t\t'odt':\t\t'application/vnd.oasis.opendocument.text',\n\t\t'ods':\t\t'application/vnd.oasis.opendocument.spreadsheet',\n\t\t'docx':\t\t'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n\t\t'xlsx':\t\t'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n\t};\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Theme} from '../util/Theme';\nimport {readTextURL} from '../util/util';\nimport {Vec} from '../util/Vec';\n\n/*\n\tManages a tree of ontology (URI) terms, which is an extremely minimalist subset of the functionality of formats\n\tlike OWL. Each term belongs to a single hierarchy and its only property is a label. Content is loaded out of concise\n\ttext files (.onto) that are easy to curate manually.\n\n\tThe class should generally be used as a singleton, with individual items of content loaded into it permanently.\n\n\tThe source content consists of lines of the following form:\n\n\t\t{indentation} {uri} {label}\n\n\twhere {indentation} consists of zero-or-more dashes; the order and indentation level implies the tree structure. The {uri}\n\tis fully expanded, and by definition contains no whitespace. The {label} consumes the remainder of the line, and may contain\n\tany amount of spaces. Blank lines are ignored and comments start with #.\n\n\te.g.\n\t\t# arbitrary ontology\n\t\thttp://thing.com/something#THI_001 thing\n\t\t- http://thing.com/something#THI_002 subset of thing\n\t\t- - http://thing.com/something#THI_003 different kind of thing\n\n\tDuplicate terms are allowed, except for the root branches, which are collapsed into one. Loading an ontology source file\n\tmore than once is not recommended.\n*/\n\nlet globalInstance:OntologyTree = null;\n\nconst ONTOLOGY_FILES =\n[\n\t'units'\n];\n\nexport interface OntologyTreeTerm\n{\n\turi:string;\n\tlabel:string;\n\tparent:OntologyTreeTerm;\n\tchildren:OntologyTreeTerm[];\n\tdepth:number;\n}\n\nexport class OntologyTree\n{\n\tpublic static get main():OntologyTree {return globalInstance;}\n\n\tprivate roots:OntologyTreeTerm[] = [];\n\tprivate mapTerms = new Map<string, OntologyTreeTerm[]>(); // uri-to-term(s)\n\n\tprivate alreadyLoaded = new Set<string>(); // prevent double-loading files\n\n\t// ------------------ public methods --------------------\n\n\tconstructor()\n\t{\n\t}\n\n\t// call this at least once during the early lifecycle: makes sure the default ontology files are loaded\n\tpublic static async init():Promise<void>\n\t{\n\t\tif (globalInstance) return;\n\t\tglobalInstance = new OntologyTree();\n\n\t\tfor (let fn of ONTOLOGY_FILES)\n\t\t{\n\t\t\tlet url = Theme.RESOURCE_URL + '/data/ontology/' + fn + '.onto';\n\t\t\tglobalInstance.loadFromURL(url);\n\t\t}\n\t}\n\n\t// return a list of root branches; note that the list is not cloned at all\n\tpublic getRoots():OntologyTreeTerm[]\n\t{\n\t\treturn this.roots;\n\t}\n\n\t// queries the existence of a term: when returning a branch, not that it is not cloned\n\tpublic hasTerm(uri:string):boolean {return this.mapTerms.has(uri);}\n\tpublic getBranch(uri:string):OntologyTreeTerm[]\n\t{\n\t\treturn this.mapTerms.get(uri);\n\t}\n\n\t// fetches a branch, populating it into a flattened list that is ordered according to the tree hierarchy; this is a convenient\n\t// form for certain use cases, especially interactivity; the container array can be treated as a shallow copy\n\tpublic getBranchList(root:string | OntologyTreeTerm):OntologyTreeTerm[]\n\t{\n\t\tif (typeof root == 'string')\n\t\t{\n\t\t\tlet look = this.mapTerms.get(root);\n\t\t\tif (!look) throw `Unknown branch URI: ${root}`;\n\t\t\tif (look.length > 1) throw `Ambiguous branch URI occurs more than once: ${root}`;\n\t\t\troot = look[0];\n\t\t}\n\n\t\tlet list:OntologyTreeTerm[] = [];\n\t\tlet accumulate = (branch:OntologyTreeTerm):void =>\n\t\t{\n\t\t\tlist.push(branch);\n\t\t\tfor (let child of Vec.safeArray(branch.children)) accumulate(child);\n\t\t};\n\t\taccumulate(root as OntologyTreeTerm);\n\t\treturn list;\n\t}\n\n\t// fetches a file and loads it up; throws an exception if it didn't work\n\tpublic async loadFromURL(url:string):Promise<void>\n\t{\n\t\tif (this.alreadyLoaded.has(url)) return;\n\t\tthis.alreadyLoaded.add(url);\n\n\t\tlet text = await readTextURL(url);\n\t\tif (!text) throw `Resource not found: ${url}`;\n\t\tthis.loadContent(text);\n\t}\n\n\t// loads up a file containing ontology content (see comment at top); throws an exception if anything is invalid\n\tpublic loadContent(text:string):void\n\t{\n\t\tlet termList:OntologyTreeTerm[] = [];\n\t\tlet pos = 0;\n\t\tfor (let line of text.split(/\\n/))\n\t\t{\n\t\t\tpos++;\n\t\t\tline = line.trim();\n\t\t\tif (!line || line.startsWith('#')) continue;\n\n\t\t\tlet idx = line.indexOf('http');\n\t\t\tif (idx < 0) throw `Line ${pos} invalid, no URI term: ${line}`;\n\t\t\tlet depth = 0;\n\t\t\tfor (let n = 0; n < idx; n++) if (line.charAt(n) == '-') depth++;\n\n\t\t\tlet uri = line.substring(idx);\n\t\t\tidx = uri.indexOf(' ');\n\t\t\tif (idx < 0) throw `Line ${pos} invalid, no label: ${line}`;\n\t\t\tlet label = uri.substring(idx + 1);\n\t\t\turi = uri.substring(0, idx);\n\n\t\t\t// if this is a root term, and it already exists, borrow it\n\t\t\tlet term:OntologyTreeTerm = null;\n\t\t\tif (depth == 0) term = this.roots.find((look) => look.uri == uri);\n\n\t\t\tif (!term)\n\t\t\t{\n\t\t\t\tterm = {uri, label, 'parent': null, 'children': [], depth};\n\n\t\t\t\tif (depth == 0) this.roots.push(term);\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tfor (let n = termList.length - 1; n >= 0; n--) if (termList[n].depth == depth - 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tterm.parent = termList[n];\n\t\t\t\t\t\ttermList[n].children.push(term);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tif (!term.parent) throw `Line ${pos} invalid hierarchy, no parent found`;\n\t\t\t\t}\n\n\t\t\t\tlet list = this.mapTerms.get(uri);\n\t\t\t\tif (list) list.push(term); else this.mapTerms.set(uri, [term]);\n\t\t\t}\n\n\t\t\ttermList.push(term);\n\t\t}\n\t}\n\n\tpublic debugString(term:OntologyTreeTerm):string\n\t{\n\t\tlet lines:string[] = [];\n\t\tlet emit = (term:OntologyTreeTerm):void =>\n\t\t{\n\t\t\tlines.push('* '.repeat(term.depth) + `<${term.uri}> \"${term.label}\"`);\n\t\t\tfor (let child of term.children) emit(child);\n\t\t};\n\t\temit(term);\n\t\treturn lines.join('\\n');\n\t}\n\n\t// ------------------ public methods --------------------\n\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {DOM, dom} from '../util/dom';\nimport {Box} from '../util/Geom';\nimport {installInlineCSS} from '../util/Theme';\n\n/*\n\tTooltips: adding popovers to widgets.\n*/\n\nconst CSS_TOOLTIP = `\n    *.wmk-tooltip-outer\n    {\n\t\tposition: absolute;\n\t\tborder-radius: 4px;\n\t\tborder: 1px solid black;\n\t\tbackground-color: white;\n\t\tpadding: 1px;\n\t\tpointer-events: none;\n        font-family: 'Open Sans', sans-serif;\n\t\tfont-size: 14px;\n    }\n\t*.wmk-tooltip-inner\n\t{\n\t\tcolor: white;\n\t\tborder-radius: 4px;\n\t\tbackground-color: black;\n\t\tpadding: 0.3em;\n\t\tmax-width: calc(min(40em, 50vw));\n\t}\n`;\n\nlet globalTooltip:Tooltip = null;\nlet globalPopWatermark = 0;\n\n// adds a well behaved tooltip to the given node (element or JQuery object)\nexport function addTooltip(parent:any, bodyHTML:string, titleHTML?:string, delay?:number):void\n{\n\tinstallInlineCSS('tooltip', CSS_TOOLTIP);\n\n\tlet widget = dom(parent);\n\tlet tooltip = new Tooltip(widget, bodyHTML, titleHTML, delay == null ? 1000 : delay);\n\n\twidget.onMouseEnter(() => tooltip.start());\n\twidget.onMouseLeave(() => tooltip.stop());\n}\n\n// variation of above where the body content is created by a callback function: use when content is expensive\nexport function addTooltipPromise(parent:any, bodyCallback:() => Promise<string>, titleHTML?:string, delay?:number):void\n{\n\tinstallInlineCSS('tooltip', CSS_TOOLTIP);\n\n\tlet widget = dom(parent);\n\tlet tooltip = new Tooltip(widget, null, titleHTML, delay == null ? 1000 : delay);\n\ttooltip.bodyCallback = bodyCallback;\n\n\twidget.onMouseEnter(() => tooltip.start());\n\twidget.onMouseLeave(() => tooltip.stop());\n}\n\n// immediately raise a tooltip, with a position relative to a given widget\nexport function raiseToolTip(parent:any, avoid:Box, bodyHTML:string, titleHTML?:string):void\n{\n\tinstallInlineCSS('tooltip', CSS_TOOLTIP);\n\n\tclearTooltip();\n\tnew Tooltip(dom(parent), bodyHTML, titleHTML, 0).raise(avoid);\n}\n\n// rudely shutdown the tooltip\nexport function clearTooltip():void\n{\n\tif (globalTooltip == null) return;\n\tglobalPopWatermark++;\n\tglobalTooltip.stop();\n}\n\nexport class Tooltip\n{\n\tpublic bodyCallback:() => Promise<string>;\n\n\tprivate watermark:number;\n\tprivate domTooltip:DOM = null;\n\n\tconstructor(private widget:DOM, private bodyHTML:string, private titleHTML:string, private delay:number)\n\t{\n\t}\n\n\t// raise the tooltip after a delay, assuming someone else hasn't bogarted it in the meanwhile\n\tpublic start()\n\t{\n\t\tthis.watermark = ++globalPopWatermark;\n\n\t\t(async () =>\n\t\t{\n\t\t\tif (this.bodyHTML == null && this.bodyCallback) this.bodyHTML = await this.bodyCallback();\n\n\t\t\twindow.setTimeout(() =>\n\t\t\t{\n\t\t\t\tif (this.watermark == globalPopWatermark) this.raise();\n\t\t\t}, this.delay);\n\t\t})();\n\t}\n\n\t// lower the tooltip, if it is still owned by this widget\n\tpublic stop()\n\t{\n\t\tif (this.domTooltip)\n\t\t{\n\t\t\tthis.domTooltip.remove();\n\t\t\tthis.domTooltip = null;\n\t\t}\n\t\t//globalPopWatermark++;\n\t\tthis.watermark = -1; // stop any raise in progress\n\t}\n\n\tpublic raise(avoid?:Box)\n\t{\n\t\tif (!this.widget.exists()) return; // 'tis gone\n\n\t\tglobalTooltip = this;\n\t\tif (this.domTooltip) return;\n\n\t\tlet pop = this.domTooltip = dom('<div/>').class('wmk-tooltip-outer').css({'visibility': 'hidden'}).appendTo(document.body);\n\n\t\t// special deal: if the parent widget has an ancestor with z-index set, then perpetuate that kludge\n\t\tlet sanity = 50;\n\t\tfor (let ancestor = this.widget; ancestor; ancestor = ancestor.parent())\n\t\t{\n\t\t\tif (--sanity == 0) break;\n\t\t\tlet zindex = parseInt(ancestor.elHTML.style.zIndex);\n\t\t\tif (zindex > 0)\n\t\t\t{\n\t\t\t\tpop.setCSS('z-index', (zindex + 1000).toString());\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tlet div = dom('<div/>').appendTo(pop).class('wmk-tooltip-inner');\n\n\t\tlet hasTitle = this.titleHTML != null && this.titleHTML.length > 0, hasBody = this.bodyHTML != null && this.bodyHTML.length > 0;\n\n\t\tif (hasTitle) dom('<div/>').appendTo(div).setHTML('<b>' + this.titleHTML + '</b>');\n\t\tif (hasTitle && hasBody) div.appendHTML('<hr/>');\n\t\tif (hasBody) dom('<div/>').appendTo(div).setHTML(this.bodyHTML);\n\n\t\t// to-do: title, if any\n\n\t\tlet winW = window.innerWidth, winH = window.innerHeight;\n\t\tconst GAP = 2;\n\t\tlet boundDiv = this.widget.el.getBoundingClientRect();\n\t\tlet wx1 = boundDiv.left, wy1 = boundDiv.top;\n\t\tlet wx2 = wx1 + boundDiv.width, wy2 = wy1 + boundDiv.height;\n\n\t\t// if more specific positioning is requested within the widget, adjust accordingly\n\t\tif (avoid)\n\t\t{\n\t\t\twx1 += avoid.x;\n\t\t\twy1 += avoid.y;\n\t\t\twx2 = wx1 + avoid.w;\n\t\t\twy2 = wy1 + avoid.h;\n\t\t}\n\n\t\tlet setPosition = () =>\n\t\t{\n\t\t\tlet popW = pop.width(), popH = pop.height();\n\t\t\tlet posX = 0, posY = 0;\n\t\t\tif (wx1 + popW < winW) posX = wx1;\n\t\t\telse if (popW < wx2) posX = wx2 - popW;\n\t\t\tif (wy2 + GAP + popH < winH) posY = wy2 + GAP;\n\t\t\telse if (wy1 - GAP - popH > 0) posY = wy1 - GAP - popH;\n\t\t\telse posY = wy2 + GAP;\n\n\t\t\tposX += window.pageXOffset;\n\t\t\tposY += window.pageYOffset;\n\n\t\t\tpop.css({'left': `${posX}px`, 'top': `${posY}px`, 'visibility': 'visible'});\n\t\t};\n\n\t\tpop.css({'left': '0px', 'top': '0px'});\n\t\tsetTimeout(() => setPosition(), 1);\n\n\t\tlet checkParent = () =>\n\t\t{\n\t\t\tif (this.watermark != globalPopWatermark || !this.widget.isVisible() || !this.widget.exists())\n\t\t\t\tthis.stop();\n\t\t\telse\n\t\t\t\tsetTimeout(checkParent, 100);\n\t\t};\n\t\tsetTimeout(checkParent, 100);\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {clearTooltip} from '../ui/Tooltip';\nimport {dom, DOM, domLegacy} from '../util/dom';\nimport {installInlineCSS} from '../util/Theme';\n\n/*\n\tDialog: base class for popup dialogs.\n*/\n\nconst CSS_DIALOG = `\n    *.wmk-dialog\n    {\n        font-family: 'Open Sans', sans-serif;\n\t\tfont-size: 16px;\n\t\tcolor: black;\n\t\tuser-select: none;\n    }\n\t*.wmk-noscroll\n\t{\n\t\toverflow: hidden;\n\t}\n`;\n\nexport class Dialog\n{\n\tprivate parent:DOM;\n\n\t// configuration parameters to modify before opening\n\tpublic minPortionWidth = 80; // percentage width of page to occupy\n\tpublic maxPortionWidth = 80; //  ...\n\tpublic maximumWidth = 0; // optional pixel-specific maximum\n\tpublic maximumHeight = 0;\n\tpublic minPortionHeight = 20; // minimum % vertical height, if too small\n\tpublic maxPortionHeight = 0; // optional % of vertical height allowed\n\tpublic topMargin = 50; // pixels to reserve along the top\n\tpublic title = 'Dialog';\n\tpublic allowScroller = true; // if true, vertical scrolling is enabled\n\tpublic zindex:number = null; // optionally the use of zindex, to ensure it goes on top (usually not necessary)\n\n\t// content information that can be accessed after opening\n\tprotected domObscureBackground:DOM; // grey covering banner\n\tprotected domObscureForeground:DOM; // transparent second cover\n\tprotected domPanelBoundary:DOM; // the dialog outline itself\n\tprotected domTitle:DOM; // section that contains the title and mini-buttons\n\tprotected domTitleButtons:DOM; // table cell where the top-right buttons go\n\tprotected domBody:DOM; // the main area, for content\n\tprotected domClose:DOM; // the close button, in case anyone wants to know\n\n\tpublic callbackClose:(source?:Dialog) => void = null;\n\tpublic callbackShown:(source?:Dialog) => void = null;\n\n\t// ------------ public methods ------------\n\n\tconstructor(parent:any = null)\n\t{\n\t\tthis.parent = domLegacy(parent);\n\n\t\tinstallInlineCSS('dialog', CSS_DIALOG);\n\t}\n\n\tpublic onClose(callback:(source?:Dialog) => void)\n\t{\n\t\tthis.callbackClose = callback;\n\t}\n\n\tpublic onShown(callback:(source?:Dialog) => void)\n\t{\n\t\tthis.callbackShown = callback;\n\t}\n\n\t// creates all the DOM objects and shows the dialog; details such as title should be setup before calling this\n\tpublic open():void\n\t{\n\t\tclearTooltip();\n\n\t\tlet body = this.parent || dom(document.body);\n\t\tbody.addClass('wmk-noscroll');\n\n\t\tlet bg = this.domObscureBackground = dom('<div/>').appendTo(body);\n\t\tbg.css({'position': 'fixed'/*, 'z-index': zindex*/});\n\t\tbg.css({'left': '0', 'right': '0', 'top': '0', 'bottom': '0'});\n\t\tbg.css({'background-color': 'black', 'opacity': 0.8});\n\t\tbg.onClick(() => this.close());\n\n\t\tlet fg = this.domObscureForeground = dom('<div/>').appendTo(body);\n\t\tfg.css({'position': 'fixed'/*, 'z-index': zindex + 1*/});\n\t\tfg.css({'left': '0', 'right': '0', 'top': '0', 'bottom': '0'});\n\n\t\tif (this.zindex > 0)\n\t\t{\n\t\t\tbg.setCSS('z-index', this.zindex);\n\t\t\tfg.setCSS('z-index', this.zindex + 1);\n\t\t}\n\n\t\tlet pb = this.domPanelBoundary = dom('<div class=\"wmk-dialog\"/>').appendTo(fg);\n\t\tpb.css({'min-width': this.minPortionWidth + '%'});\n\t\tif (this.maximumWidth > 0) pb.css({'max-width': this.maximumWidth + 'px'});\n\t\telse if (this.maxPortionWidth != null) pb.css({'max-width': this.maxPortionWidth + '%'});\n\t\tif (this.maximumHeight > 0) pb.css({'max-height': this.maximumHeight + 'px'});\n\t\telse if (this.maxPortionHeight > 0) pb.css({'max-height': this.maxPortionHeight + 'vh'});\n\n\t\tpb.css({'background-color': 'white', 'border-radius': '6px', 'border': '1px solid black'});\n\t\tpb.css({'position': 'absolute'});\n\t\tpb.css({'left': (50 - 0.5 * this.minPortionWidth) + '%'});\n\t\tpb.css({'top': this.topMargin + 'px'});\n\t\tpb.css({'min-height': this.minPortionHeight + '%'});\n\n\t\tlet divOuter = dom('<div/>').appendTo(pb).css({'display': 'flex'});\n\t\tdivOuter.css({'flex-direction': 'column', 'align-items': 'stretch'});\n\t\tif (this.maximumHeight > 0) divOuter.css({'max-height': this.maximumHeight + 'px'});\n\t\telse if (this.maxPortionHeight > 0) divOuter.css({'max-height': this.maxPortionHeight + 'vh'});\n\t\tlet tdiv = this.domTitle = dom('<div/>').appendTo(divOuter);\n\t\ttdiv.css({'flex-shrink': '0', 'flex-grow': '0'});\n\t\ttdiv.css({'margin': '0', 'padding': '0'});\n\t\ttdiv.css({'background-color': '#F0F0F0'});\n\t\ttdiv.css({'background-image': 'linear-gradient(to right bottom, #FFFFFF, #E0E0E0)'});\n\t\ttdiv.css({'border-bottom': '1px solid #C0C0C0'});\n\t\ttdiv.css({'border-radius': '6px 6px 0 0'});\n\n\t\tlet bdiv = dom('<div/>').appendTo(divOuter).css({'width': '100%'});\n\t\tbdiv.css({'flex-shrink': '1', 'flex-grow': '0'});\n\t\tif (this.allowScroller) bdiv.css({'overflow-y': 'auto'});\n\n\t\tthis.domBody = dom('<div/>').appendTo(bdiv).css({'padding': '0.5em'}); // (has to be nested, otherwise runs over)\n\n\t\tlet ttlTable = dom('<table/>').appendTo(tdiv), tr = dom('<tr/>').appendTo(ttlTable);\n\t\tttlTable.attr({'width': '100%'});\n\n\t\tlet tdTitle = dom('<td valign=\"center\"/>').appendTo(tr).css({'padding': '0.5em'});\n\t\tlet ttl = dom('<font/>').appendTo(tdTitle).css({'font-size': '1.5em', 'font-weight': '600'});\n\t\tttl.setText(this.title);\n\n\t\tlet tdButtons = this.domTitleButtons = dom('<td align=\"right\" valign=\"center\"/>').appendTo(tr).css({'padding': '0.5em'});\n\t\tthis.domClose = dom('<button class=\"wmk-button wmk-button-default\">Close</button>').appendTo(tdButtons);\n\t\tthis.domClose.onClick(() => this.close());\n\n\t\tthis.populate();\n\n\t\tthis.repositionSize();\n\n\t\t/*bg.show();\n\t\tpb.show();*/\n\n\t\tif (this.callbackShown) this.callbackShown(this); // currently there's no delay so it's fine to just call it\n\t}\n\n\t// closes and hides the dialog\n\tpublic close():void\n\t{\n\t\tclearTooltip();\n\n\t\tthis.domObscureBackground.remove();\n\t\tthis.domObscureForeground.remove();\n\n\t\tlet body = this.parent || dom(document.body);\n\t\tbody.removeClass('wmk-noscroll');\n\n\t\tif (this.callbackClose) this.callbackClose(this);\n\t}\n\n\t// sizes may have changed, so adjust if necessary\n\tpublic bump():void\n\t{\n\t\tthis.repositionSize();\n\t}\n\n\t// use this to obtain the parts of the dialog box intended for modification\n\tpublic bodyDOM():DOM {return this.domBody;}\n\tpublic buttonsDOM():DOM {return this.domTitleButtons;}\n\n\t// override this function to create the content; this gets called right before the dialog box is shown\n\tprotected populate():void\n\t{\n\t\tthis.bodyDOM().setText('Empty dialog box.');\n\t}\n\n\t// ------------ private methods ------------\n\n\t// have this called when the size may have changed, and need to update position\n\tprivate repositionSize():void\n\t{\n\t\tlet docW = window.innerWidth, dlgW = this.domPanelBoundary.width();\n\t\tthis.domPanelBoundary.css({'left': (0.5 * (docW - dlgW)) + 'px'});\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {dom, DOM} from '../util/dom';\nimport {addTooltip} from './Tooltip';\n\n/*\n\tBase class for widgets. Maintains the wrapping <div> element into which everything is rendered.\n*/\n\nexport class Widget\n{\n\tprotected tagType = 'div';\n\n\t//public content:JQuery = null;\n\n\tprivate domContent:DOM = null;\n\tpublic get contentDOM():DOM {return this.domContent;}\n\n\tconstructor() {}\n\n\t// create the underlying structure; the parent parameter must be jQuery- or DOM-compatible\n\tpublic render(parent:DOM | Element):void\n\t{\n\t\tlet tag = this.tagType;\n\t\tthis.domContent = dom(`<${tag}/>`).appendTo(parent as (DOM | Element));\n\t}\n\n\t// deconstructs the widget; this is not a hook, rather it is for the benefit of calling code that wants the widget gone\n\tpublic remove():void\n\t{\n\t\tif (this.domContent) this.domContent.remove();\n\t\tthis.domContent = null;\n\t}\n\n\t// convenience function: attaches a tooltip to the main content element, after rendering\n\tpublic addTooltip(bodyHTML:string, titleHTML?:string):void\n\t{\n\t\taddTooltip(this.contentDOM, bodyHTML, titleHTML);\n\t}\n\n\t// convenience wrapper\n\tpublic grabFocus():void\n\t{\n\t\tthis.domContent.grabFocus();\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {FontData} from '../gfx/FontData';\nimport {MetaVector} from '../gfx/MetaVector';\nimport {dom, DOM} from '../util/dom';\nimport {Theme} from '../util/Theme';\nimport {colourCanvas, eventCoords, newElement, pathRoundedRect, pixelDensity, setBoundaryPixels} from '../util/util';\nimport {Vec} from '../util/Vec';\nimport {ButtonBank, ButtonBankItem} from './ButtonBank';\nimport {Widget} from './Widget';\n\n/*\n\tButtonView: a container for a stack of ButtonBanks. The ButtonView handles all the display/user interaction parts\n\tof a button bank. A ButtonView should be owned by a container object that defines a region of space within which this\n\tobject can position itself.\n*/\n\nexport enum ButtonViewPosition\n{\n\tLeft,\n\tRight,\n\tTop,\n\tBottom,\n\tCentre,\n}\n\nexport interface ButtonViewDisplay\n{\n\tid:string;\n\tx?:number;\n\ty?:number;\n\twidth?:number;\n\theight?:number;\n\thelpSpan?:DOM;\n\timgDOM?:DOM;\n}\n\nexport class ButtonView extends Widget\n{\n\tpublic idealSize = 50;\n\tpublic width = 0;\n\tpublic height = 0;\n\tpublic selectedButton:string = null;\n\tpublic highlightButton:string = null;\n\tpublic maxButtonColumns = 0; // optional\n\tpublic maxButtonRows = 0; // optional\n\n\tprivate border = 0x808080;\n\tprivate background = 0xFFFFFF;\n\tprivate buttonColNorm1 = 0x47D5D2;\n\tprivate buttonColNorm2 = 0x008FD1;\n\tprivate buttonColActv1 = 0x30FF69;\n\tprivate buttonColActv2 = 0x008650;\n\tprivate buttonColSel1 = 0xFFFFFF;\n\tprivate buttonColSel2 = 0xE0E0E0;\n\n\tprivate canvas:HTMLCanvasElement = null;\n\tprivate stack:ButtonBank[] = [];\n\tprivate display:ButtonViewDisplay[] = [];\n\tprivate hasBigButtons = true;\n\tprivate prefabImgSize = 44;\n\tprivate gripHeight = 30;\n\tprivate gripWidth = 50;\n\tprivate isRaised = true;\n\tprivate outPadding = 2;\n\tprivate inPadding = 2;\n\tprivate x = 0;\n\tprivate y = 0;\n\n\t// static cache: needs to be filled out just once; will contain the {icon:svg} pairs that can be used in the buttons\n\t//private static ACTION_ICONS:Record<string, string> = {};\n\n\tprivate isMacLike = false;\n\n\tconstructor(private position:ButtonViewPosition, private parentX:number, private parentY:number, private parentWidth:number, private parentHeight:number)\n\t{\n\t\tsuper();\n\n\t\t// NOTE: this is going to be a problem soon, but there's no replacement\n\t\tthis.isMacLike = !!navigator.platform.match(/(Mac|iPhone|iPod|iPad)/i);\n\t}\n\n\t// for future reference, parent boundary size is different\n\tpublic setParentSize(width:number, height:number):void\n\t{\n\t\tthis.parentWidth = width;\n\t\tthis.parentHeight = height;\n\t\tif (this.contentDOM)\n\t\t{\n\t\t\tthis.applyOffset();\n\t\t\tthis.redraw();\n\t\t}\n\t}\n\n\t// --------------------------------------- public methods ---------------------------------------\n\n\t// returns the current bank, or null if none\n\tpublic get topBank():ButtonBank\n\t{\n\t\treturn this.stack.length > 0 ? this.stack[this.stack.length - 1] : null;\n\t}\n\n\t// returns how many banks are piled up\n\tpublic get stackSize():number {return this.stack.length;}\n\n\t// create the canvas\n\tpublic render(parent:any):void\n\t{\n\t\tsuper.render(parent);\n\n\t\tthis.contentDOM.css({'position': 'absolute', 'width': `${this.width}px`, 'height': `${this.height}px`});\n\t\tthis.contentDOM.addClass('no_selection');\n\n\t\tthis.layoutButtons();\n\n\t\tlet canvasStyle = 'position: absolute; left: 0; top: 0;';\n\t\tcanvasStyle += 'pointer-events: none;';\n\t\tthis.canvas = newElement(this.contentDOM.el, 'canvas', {'width': this.width, 'height': this.height, 'style': canvasStyle}) as HTMLCanvasElement;\n\t\tthis.canvas.style.width = this.width + 'px';\n\t\tthis.canvas.style.height = this.height + 'px';\n\n\t\tthis.applyOffset();\n\t\tthis.redraw();\n\n\t\tthis.contentDOM.onClick((event) => this.mouseClick(event));\n\t\tthis.contentDOM.onDblClick((event) => this.mouseDoubleClick(event));\n\t\tthis.contentDOM.onMouseDown((event) => {event.preventDefault(); this.mouseDown(event);});\n\t\tthis.contentDOM.onMouseUp((event) => this.mouseUp(event));\n\t\tthis.contentDOM.onMouseOver((event) => this.mouseOver(event));\n\t\tthis.contentDOM.onMouseLeave((event) => this.mouseOut(event));\n\t\tthis.contentDOM.onMouseMove((event) => this.mouseMove(event));\n\t}\n\n\t// adds a new molsync.ui.ButtonBank instance to the stack, making it the current one\n\tpublic pushBank(bank:ButtonBank):void\n\t{\n\t\tbank.buttonView = this;\n\t\tbank.isSubLevel = this.stack.length > 0;\n\t\tbank.init();\n\t\tthis.stack.push(bank);\n\n\t\tif (this.canvas != null)\n\t\t{\n\t\t\tthis.layoutButtons();\n\t\t\tthis.replaceCanvas();\n\t\t\tthis.applyOffset();\n\t\t\tthis.redraw();\n\t\t}\n\t}\n\n\t// removes the top buttonbank from the stack\n\tpublic popBank():void\n\t{\n\t\tif (this.stack.length == 0) return;\n\t\tVec.last(this.stack).bankClosed();\n\t\tthis.stack.length--;\n\n\t\tif (this.canvas != null)\n\t\t{\n\t\t\tthis.layoutButtons();\n\t\t\tthis.replaceCanvas();\n\t\t\tthis.applyOffset();\n\t\t\tthis.redraw();\n\t\t}\n\t}\n\n\t// updates the current bank, given that the buttons have probably changed\n\tpublic refreshBank():void\n\t{\n\t\tif (this.canvas != null)\n\t\t{\n\t\t\tthis.layoutButtons();\n\t\t\tthis.replaceCanvas();\n\t\t\tthis.applyOffset();\n\t\t\tthis.redraw();\n\t\t}\n\t}\n\n\t// get/set the selected button index, by ID\n\tpublic getSelectedButton():string\n\t{\n\t\treturn this.selectedButton;\n\t}\n\tpublic setSelectedButton(id:string):void\n\t{\n\t\tif (id != this.selectedButton)\n\t\t{\n\t\t\tthis.selectedButton = id;\n\t\t\tthis.redraw();\n\t\t}\n\t}\n\n\t// pick next/previous button\n\tpublic cycleSelected(dir:number):void\n\t{\n\t\tlet sorted = this.display.filter((s) => s.id != '*');\n\t\tsorted.sort((d1, d2) => (d1.y * 10000 + d1.x) - (d2.y * 10000 + d2.x));\n\n\t\tlet idx = 0, sz = sorted.length;\n\t\tfor (let n = 0; n < sz; n++) if (sorted[n].id == this.selectedButton) {idx = n; break;}\n\t\tthis.selectedButton = sorted[(idx + dir + sz) % sz].id;\n\t\tthis.redraw();\n\t}\n\n\t// raises or lowers the buttonbank\n\tpublic raiseBank():void\n\t{\n\t\tif (this.isRaised) return;\n\t\tthis.isRaised = true;\n\t\tif (this.contentDOM)\n\t\t{\n\t\t\tthis.layoutButtons();\n\t\t\tthis.replaceCanvas();\n\t\t\tthis.applyOffset();\n\t\t\tthis.redraw();\n\t\t}\n\t}\n\tpublic lowerBank():void\n\t{\n\t\tif (!this.isRaised) return;\n\t\tthis.isRaised = false;\n\t\tif (this.contentDOM)\n\t\t{\n\t\t\tthis.layoutButtons();\n\t\t\tthis.replaceCanvas();\n\t\t\tthis.applyOffset();\n\t\t\tthis.redraw();\n\t\t}\n\t}\n\n\t// determines whether or not the \"big buttons\" are used; big buttons are typically better for mobile devices, which\n\t// tend to have high screen DPI, while on PC monitors they tend to look a bit goofy\n\tpublic getHasBigButtons():boolean\n\t{\n\t\treturn this.hasBigButtons;\n\t}\n\tpublic setHasBigButtons(flag:boolean)\n\t{\n\t\tthis.hasBigButtons = flag;\n\t\tthis.prefabImgSize = flag ? 44 : 36;\n\t\tthis.idealSize = flag ? 50 : 40;\n\t}\n\n\t// returns true if the coordinate is (more or less) within the button outline, which is necessary for propagating mouse events;\n\t// it's also sometimes handy for exterior code to check if the position is covered\n\tpublic withinOutline(x:number, y:number)\n\t{\n\t\tlet w = this.width, h = this.height;\n\t\tif (x < 0 || x > w || y < 0 || y > h) return false;\n\n\t\tif (this.position == ButtonViewPosition.Centre || this.stack.length == 0) return true;\n\t\tif (this.position == ButtonViewPosition.Left)\n\t\t{\n\t\t\tlet my = 0.5 * h - 1, gw = this.gripHeight, hg = 0.5 * this.gripWidth;\n\t\t\treturn x < w - gw || (y > my - hg && y < my + hg);\n\t\t}\n\t\telse if (this.position == ButtonViewPosition.Right)\n\t\t{\n\t\t\tlet my = 0.5 * h - 1, gw = this.gripHeight, hg = 0.5 * this.gripWidth;\n\t\t\treturn x > gw || (y > my - hg && y < my + hg);\n\t\t}\n\t\telse if (this.position == ButtonViewPosition.Top)\n\t\t{\n\t\t\tlet mx = 0.5 * w - 1, gh = this.gripHeight, hg = 0.5 * this.gripWidth;\n\t\t\treturn y < h - gh || (x > mx - hg && x < mx + hg);\n\t\t}\n\t\telse if (this.position == ButtonViewPosition.Bottom)\n\t\t{\n\t\t\tlet mx = 0.5 * w - 1, gh = this.gripHeight, hg = 0.5 * this.gripWidth;\n\t\t\treturn y > gh || (x > mx - hg && x < mx + hg);\n\t\t}\n\t\treturn true;\n\t}\n\n\t// returns the space taken up by the \"grip\"; this is the value of the \"height\", which will have been rotated for left/right banks\n\tpublic gripSize():number\n\t{\n\t\treturn this.gripHeight;\n\t}\n\n\t// returns the minimum size (either width or height depending on orientation) given a particular number of buttons in the aligning direction, not\n\t// including grip widgets\n\tpublic sizeForButtons(nbtn:number):number\n\t{\n\t\treturn this.idealSize * nbtn + this.inPadding * (nbtn - 1) + 2 * this.outPadding;\n\t}\n\n\t// --------------------------------------- private methods ---------------------------------------\n\n\t// figures out the size that this buttonview needs to be\n\tprivate layoutButtons():void\n\t{\n\t\tif (this.contentDOM == null) return; // too soon\n\n\t\tlet outPadding = this.outPadding, inPadding = this.inPadding;\n\n\t\t// clean up previous buttons\n\t\tthis.removeDisplayButtons();\n\n\t\t// special case: no content\n\t\tif (this.stack.length == 0)\n\t\t{\n\t\t\tthis.width = 10;\n\t\t\tthis.height = 10;\n\t\t\tif (this.position == ButtonViewPosition.Left || this.position == ButtonViewPosition.Right) this.height = this.parentHeight;\n\t\t\telse if (this.position == ButtonViewPosition.Top || this.position == ButtonViewPosition.Bottom) this.width = this.parentWidth;\n\t\t\treturn;\n\t\t}\n\n\t\t// it not raised, it shall be small, and have only a grip\n\t\tif (!this.isRaised)\n\t\t{\n\t\t\tif (this.position == ButtonViewPosition.Left || this.position == ButtonViewPosition.Right)\n\t\t\t{\n\t\t\t\tthis.width = this.gripHeight;\n\t\t\t\tthis.height = this.gripWidth + 2 * outPadding;\n\t\t\t}\n\t\t\telse if (this.position == ButtonViewPosition.Top || this.position == ButtonViewPosition.Bottom)\n\t\t\t{\n\t\t\t\tthis.width = this.gripWidth + 2 * outPadding;\n\t\t\t\tthis.height = this.gripHeight;\n\t\t\t}\n\t\t\tthis.addGripButton();\n\t\t\treturn;\n\t\t}\n\n\t\tlet bank = this.stack[this.stack.length - 1];\n\t\tbank.buttons = [];\n\t\tbank.update();\n\n\t\t// decide how much room the 'pop button' takes up\n\t\tlet popWidth = 0, popHeight = 0;\n\t\tif (this.stack.length == 1) {}\n\t\telse if (this.position == ButtonViewPosition.Left || this.position == ButtonViewPosition.Right) popHeight = this.gripHeight + inPadding;\n\t\telse if (this.position == ButtonViewPosition.Top || this.position == ButtonViewPosition.Bottom) popWidth = this.gripHeight + inPadding;\n\n\t\t// burn through layout possibilities, and keep the best one\n\t\tlet bestLayout:string[][] = null, bestScore:number = null;\n\t\tif (this.position == ButtonViewPosition.Left || this.position == ButtonViewPosition.Right)\n\t\t{\n\t\t\tlet maxSlotHeight = Math.floor((this.parentHeight - 2 * outPadding - inPadding /*- popHeight*/) / (this.idealSize + inPadding));\n\t\t\tlet minSlotHeight = Math.ceil(0.5 * maxSlotHeight);\n\t\t\tfor (let i = maxSlotHeight; i >= minSlotHeight; i--)\n\t\t\t{\n\t\t\t\tlet slotWidth = Math.ceil(bank.buttons.length / i);\n\t\t\t\tfor (let j = slotWidth; j <= slotWidth + 1; j++)\n\t\t\t\t{\n\t\t\t\t\tlet layout = this.layoutMaxHeight(bank, i, j);\n\t\t\t\t\tlet score = this.scoreLayout(layout) + 1 * layout[0].length;\n\t\t\t\t\tif (bestLayout == null || score < bestScore)\n\t\t\t\t\t{\n\t\t\t\t\t\tbestLayout = layout;\n\t\t\t\t\t\tbestScore = score;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (this.position == ButtonViewPosition.Top || this.position == ButtonViewPosition.Bottom)\n\t\t{\n\t\t\tlet maxSlotWidth = Math.floor((this.parentWidth - 2 * outPadding - inPadding - popWidth) / (this.idealSize + inPadding));\n\t\t\tlet minSlotWidth = Math.ceil(0.5 * maxSlotWidth);\n\t\t\tfor (let n = maxSlotWidth; n >= minSlotWidth; n--)\n\t\t\t{\n\t\t\t\tlet layout = this.layoutMaxWidth(bank, n);\n\t\t\t\tlet score = this.scoreLayout(layout) + 1 * layout.length;\n\t\t\t\tif (bestLayout == null || score < bestScore)\n\t\t\t\t{\n\t\t\t\t\tbestLayout = layout;\n\t\t\t\t\tbestScore = score;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// !! implement \"middle of window\" type (?)\n\t\t}\n\n\t\t// determine total size, and position everything\n\t\tlet ncols = bestLayout[0].length, nrows = bestLayout.length;\n\t\tthis.width = 2 * outPadding + inPadding + (this.idealSize + inPadding) * ncols + popWidth;\n\t\tthis.height = 2 * outPadding + inPadding + (this.idealSize + inPadding) * nrows + popHeight;\n\n\t\tif (this.position == ButtonViewPosition.Left || this.position == ButtonViewPosition.Right) this.width += this.gripHeight;\n\t\telse if (this.position == ButtonViewPosition.Top || this.position == ButtonViewPosition.Bottom) this.height += this.gripHeight;\n\t\tthis.addGripButton();\n\n\t\tif (popWidth > 0 || popHeight > 0)\n\t\t{\n\t\t\tlet d:ButtonViewDisplay =\n\t\t\t{\n\t\t\t\tid: '!',\n\t\t\t\tx: outPadding + inPadding,\n\t\t\t\ty: outPadding + inPadding,\n\t\t\t\twidth: popWidth - inPadding,\n\t\t\t\theight: popHeight - inPadding\n\t\t\t};\n\t\t\tif (this.position == ButtonViewPosition.Right) d.x += this.gripHeight;\n\t\t\telse if (this.position == ButtonViewPosition.Bottom) d.y += this.gripHeight;\n\t\t\tif (popWidth == 0) d.width = ncols * this.idealSize + inPadding * (ncols - 1);\n\t\t\tif (popHeight == 0) d.height = nrows * this.idealSize + inPadding * (nrows - 1);\n\t\t\tthis.display.push(d);\n\t\t}\n\n\t\t// add in all the actual buttons\n\t\tfor (let y = 0; y < nrows; y++) for (let x = 0; x < ncols; x++)\n\t\t{\n\t\t\tfor (let n = 0; n < bank.buttons.length; n++) if (bestLayout[y][x] == bank.buttons[n].id)\n\t\t\t{\n\t\t\t\tlet b = bank.buttons[n], d:ButtonViewDisplay = {id: b.id};\n\t\t\t\td.x = outPadding + inPadding + popWidth + (this.idealSize + inPadding) * x;\n\t\t\t\td.y = outPadding + inPadding + popHeight + (this.idealSize + inPadding) * y;\n\t\t\t\tif (this.position == ButtonViewPosition.Right) d.x += this.gripHeight;\n\t\t\t\telse if (this.position == ButtonViewPosition.Bottom) d.y += this.gripHeight;\n\t\t\t\td.width = this.idealSize;\n\t\t\t\td.height = this.idealSize;\n\t\t\t\tthis.display.push(d);\n\t\t\t}\n\t\t}\n\t}\n\n\t// if appropriate, adds a grip button, with a suitable position\n\tprivate addGripButton():void\n\t{\n\t\tif (this.position == ButtonViewPosition.Centre) return;\n\n\t\tlet d:ButtonViewDisplay = {id: '*'}, spc = 3;\n\t\tif (this.position == ButtonViewPosition.Left)\n\t\t{\n\t\t\td.width = this.gripHeight - spc;\n\t\t\td.height = this.gripWidth - 2 * spc;\n\t\t\td.x = this.width - d.width - spc - 1;\n\t\t\td.y = 0.5 * (this.height - d.height);\n\t\t}\n\t\telse if (this.position == ButtonViewPosition.Right)\n\t\t{\n\t\t\td.width = this.gripHeight - spc;\n\t\t\td.height = this.gripWidth - 2 * spc;\n\t\t\td.x = spc + 1;\n\t\t\td.y = 0.5 * (this.height - d.height);\n\t\t}\n\t\telse if (this.position == ButtonViewPosition.Top)\n\t\t{\n\t\t\td.width = this.gripWidth - 2 * spc;\n\t\t\td.height = this.gripHeight - spc;\n\t\t\td.x = 0.5 * (this.width - d.width);\n\t\t\td.y = this.height - d.height - spc - 1;\n\t\t}\n\t\telse if (this.position == ButtonViewPosition.Bottom)\n\t\t{\n\t\t\td.width = this.gripWidth - 2 * spc;\n\t\t\td.height = this.gripHeight - spc;\n\t\t\td.x = 0.5 * (this.width - d.width);\n\t\t\td.y = spc + 1;\n\t\t}\n\t\tthis.display.push(d);\n\t}\n\n\t// recreates the canvas, on account of it having a different size; note the \"setSize\" method is marked to-be-done in the closures\n\t// library, so this may not always be necessary\n\tprivate replaceCanvas():void\n\t{\n\t\tthis.contentDOM.empty();\n\n\t\tfor (let n = 0; n < this.display.length; n++)\n\t\t{\n\t\t\tthis.display[n].imgDOM = null;\n\t\t\tthis.display[n].helpSpan = null;\n\t\t}\n\n\t\tlet canvasStyle = 'position: absolute; left: 0; top: 0;';\n\t\tcanvasStyle += 'pointer-events: none;';\n\t\tthis.canvas = newElement(this.contentDOM.el, 'canvas', {'width': this.width, 'height': this.height, 'style': canvasStyle}) as HTMLCanvasElement;\n\t}\n\n\t// removes all the display buttons, making sure to delete the HTML objects as necessary\n\tprivate removeDisplayButtons():void\n\t{\n\t\tthis.contentDOM.empty();\n\t\tthis.display = [];\n\t}\n\n\t// positions the canvas within its parent\n\tprivate applyOffset():void\n\t{\n\t\tlet x:number, y:number;\n\t\tif (this.position == ButtonViewPosition.Left)\n\t\t{\n\t\t\tx = 0;\n\t\t\ty = 0.5 * (this.parentHeight - this.height);\n\t\t}\n\t\telse if (this.position == ButtonViewPosition.Right)\n\t\t{\n\t\t\tx = this.parentWidth - this.width;\n\t\t\ty = 0.5 * (this.parentHeight - this.height);\n\t\t}\n\t\telse if (this.position == ButtonViewPosition.Top)\n\t\t{\n\t\t\tx = 0.5 * (this.parentWidth - this.width);\n\t\t\ty = 0;\n\t\t}\n\t\telse if (this.position == ButtonViewPosition.Bottom)\n\t\t{\n\t\t\tx = 0.5 * (this.parentWidth - this.width);\n\t\t\ty = this.parentHeight - this.height;\n\t\t}\n\t\telse // == 'centre'\n\t\t{\n\t\t\tx = 0.5 * (this.parentWidth - this.width);\n\t\t\ty = 0.5 * (this.parentHeight - this.height);\n\t\t}\n\n\t\tthis.x = this.parentX + x;\n\t\tthis.y = this.parentY + y;\n\n\t\tthis.contentDOM.css({'position': 'absolute'});\n\t\tsetBoundaryPixels(this.contentDOM, this.x, this.y, this.width, this.height);\n\t}\n\n\t// redraws the buttons, in response to some kind of state change\n\tprivate redraw():void\n\t{\n\t\tif (!this.contentDOM || !this.canvas) return;\n\n\t\t// background\n\n\t\tlet density = pixelDensity();\n\t\tthis.canvas.width = this.width * density;\n\t\tthis.canvas.height = this.height * density;\n\t\tthis.canvas.style.width = this.width + 'px';\n\t\tthis.canvas.style.height = this.height + 'px';\n\n\t\tlet ctx = this.canvas.getContext('2d');\n\t\tctx.save();\n\t\tctx.scale(density, density);\n\t\tctx.clearRect(0, 0, this.width, this.height);\n\n\t\tlet path = this.traceOutline();\n\t\tctx.fillStyle = colourCanvas(this.background);\n\t\tctx.fill(path);\n\t\tctx.strokeStyle = colourCanvas(this.border);\n\t\tctx.lineWidth = 1;\n\t\tctx.stroke(path);\n\n\t\tlet bank = this.stack.length > 0 ? this.stack[this.stack.length - 1] : null;\n\n\t\tthis.contentDOM.css({'width': this.width + 'px', 'height': this.height + 'px'});\n\n\t\t// button outlines\n\t\tfor (let n = 0; n < this.display.length; n++)\n\t\t{\n\t\t\tconst d = this.display[n], b = this.buttonFromID(d.id);\n\n\t\t\tlet col1:number, col2:number;\n\t\t\tif (this.highlightButton != null && d.id == this.highlightButton)\n\t\t\t{\n\t\t\t\tcol1 = this.buttonColActv1;\n\t\t\t\tcol2 = this.buttonColActv2;\n\t\t\t}\n\t\t\telse if (this.selectedButton != null && d.id == this.selectedButton)\n\t\t\t{\n\t\t\t\tcol1 = this.buttonColSel1;\n\t\t\t\tcol2 = this.buttonColSel2;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcol1 = this.buttonColNorm1;\n\t\t\t\tcol2 = this.buttonColNorm2;\n\t\t\t}\n\n\t\t\tctx.save();\n\t\t\tpath = pathRoundedRect(d.x + 0.5, d.y + 0.5, d.x + d.width - 1, d.y + d.height - 1, 5);\n\t\t\tif (col2 != null)\n\t\t\t{\n\t\t\t\tlet grad = ctx.createLinearGradient(d.x, d.y, d.x + d.width, d.y + d.height);\n\t\t\t\tgrad.addColorStop(0, colourCanvas(col1));\n\t\t\t\tgrad.addColorStop(1, colourCanvas(col2));\n\t\t\t\tctx.fillStyle = grad;\n\t\t\t}\n\t\t\telse ctx.fillStyle = colourCanvas(col1);\n\t\t\tctx.fill(path);\n\t\t\tctx.strokeStyle = colourCanvas(this.border);\n\t\t\tctx.lineWidth = 0.5;\n\t\t\tctx.stroke(path);\n\t\t\tctx.restore();\n\n\t\t\tif (d.imgDOM != null)\n\t\t\t{\n\t\t\t\td.imgDOM.remove();\n\t\t\t\td.imgDOM = null;\n\t\t\t}\n\n\t\t\tif (b != null)\n\t\t\t{\n\t\t\t\tif (d.helpSpan == null)\n\t\t\t\t{\n\t\t\t\t\td.helpSpan = dom('<span style=\"position: absolute;\"/>').appendTo(this.contentDOM);\n\t\t\t\t\tlet txt = b.helpText;\n\t\t\t\t\tif (b.mnemonic)\n\t\t\t\t\t{\n\t\t\t\t\t\twhile (txt.endsWith('.')) txt = txt.substring(0, txt.length - 1);\n\n\t\t\t\t\t\tlet keyText = b.mnemonic;\n\t\t\t\t\t\tlet match = keyText.match(/^(.*)CmdOrCtrl(.*)$/);\n\t\t\t\t\t\tif (match) keyText = match[1] + (this.isMacLike ? 'Cmd' : 'Ctrl') + match[2];\n\t\t\t\t\t\ttxt += ' [' + keyText + ']';\n\t\t\t\t\t}\n\t\t\t\t\tthis.addTooltip(d.helpSpan.el.outerHTML, txt);\n\t\t\t\t}\n\t\t\t\tsetBoundaryPixels(d.helpSpan, d.x, d.y, d.width, d.height);\n\t\t\t}\n\n\t\t\tif (b == null) {}\n\t\t\telse if (b.imageFN != null && d.imgDOM == null)\n\t\t\t{\n\t\t\t\td.imgDOM = dom('<img/>').appendTo(this.contentDOM).css({'position': 'absolute', 'pointer-events': 'none'});\n\t\t\t\td.imgDOM.setAttr('src', Theme.RESOURCE_URL + '/img/actions/' + b.imageFN + '.svg');\n\t\t\t\tconst sz = this.prefabImgSize;\n\t\t\t\tconst bx = d.x + Math.floor(0.5 * (d.width - sz));\n\t\t\t\tconst by = d.y + Math.floor(0.5 * (d.height - sz));\n\t\t\t\tsetBoundaryPixels(d.imgDOM, bx, by, sz, sz);\n\t\t\t}\n\t\t\telse if (b.metavec != null)\n\t\t\t{\n\t\t\t\tlet draw = b.metavec instanceof MetaVector ? b.metavec as MetaVector : new MetaVector(b.metavec);\n\t\t\t\tdraw.offsetX = d.x + Math.floor(0.5 * (d.width - draw.width));\n\t\t\t\tdraw.offsetY = d.y + Math.floor(0.5 * (d.height - draw.height));\n\t\t\t\tdraw.renderContext(ctx);\n\t\t\t}\n\t\t\telse if (b.text != null)\n\t\t\t{\n\t\t\t\tlet sz = this.idealSize;\n\t\t\t\tlet draw = new MetaVector({'size': [sz, sz]});\n\t\t\t\tlet fsz = sz * 0.6;\n\t\t\t\tlet wad = FontData.main.measureText(b.text, fsz);\n\n\t\t\t\tif (wad[1] + wad[2] > sz)\n\t\t\t\t{\n\t\t\t\t\tfsz *= sz / (wad[1] + wad[2]);\n\t\t\t\t\twad = FontData.main.measureText(b.text, fsz);\n\t\t\t\t}\n\t\t\t\tif (wad[0] > sz)\n\t\t\t\t{\n\t\t\t\t\tfsz *= sz / wad[0];\n\t\t\t\t\twad = FontData.main.measureText(b.text, fsz);\n\t\t\t\t}\n\t\t\t\tlet x = 0.5 * (sz - wad[0]), y = 0.5 * (sz + wad[1]);\n\t\t\t\tdraw.drawText(x - 1, y, b.text, fsz, 0x000000);\n\t\t\t\tdraw.drawText(x + 1, y, b.text, fsz, 0x000000);\n\t\t\t\tdraw.drawText(x, y - 1, b.text, fsz, 0x000000);\n\t\t\t\tdraw.drawText(x, y + 1, b.text, fsz, 0x000000);\n\t\t\t\tdraw.drawText(x, y, b.text, fsz, 0xFFFFFF);\n\t\t\t\tdraw.offsetX = d.x + Math.floor(0.5 * (d.width - draw.width));\n\t\t\t\tdraw.offsetY = d.y + Math.floor(0.5 * (d.height - draw.height));\n\t\t\t\tdraw.renderContext(ctx);\n\t\t\t}\n\n\t\t\t// optionally draw the submenus indicator\n\t\t\tif (b != null && b.isSubMenu)\n\t\t\t{\n\t\t\t\tctx.save();\n\t\t\t\tlet sx = d.x + d.width - 3, sy = d.y + d.height - 3;\n\t\t\t\tctx.beginPath();\n\t\t\t\tctx.moveTo(sx, sy);\n\t\t\t\tctx.lineTo(sx - 6, sy);\n\t\t\t\tctx.lineTo(sx, sy - 6);\n\t\t\t\tctx.closePath();\n\t\t\t\tctx.fillStyle = 'black';\n\t\t\t\tctx.fill();\n\t\t\t\tctx.restore();\n\t\t\t}\n\n\t\t\t// if it's the grip-button, draw the caret\n\t\t\tif (d.id == '*')\n\t\t\t{\n\t\t\t\tctx.save();\n\n\t\t\t\tpath = new Path2D();\n\t\t\t\tlet px:number[], py:number[], flip = this.isRaised;\n\t\t\t\tif (this.position == ButtonViewPosition.Left || this.position == ButtonViewPosition.Right)\n\t\t\t\t{\n\t\t\t\t\tpx = [0.2, 0.7, 0.7]; py = [0.5, 0.3, 0.7];\n\t\t\t\t\tif (this.position == ButtonViewPosition.Left) flip = !flip;\n\t\t\t\t}\n\t\t\t\telse if (this.position == ButtonViewPosition.Top || this.position == ButtonViewPosition.Bottom)\n\t\t\t\t{\n\t\t\t\t\tpx = [0.5, 0.3, 0.7]; py = [0.2, 0.7, 0.7];\n\t\t\t\t\tif (this.position == ButtonViewPosition.Top) flip = !flip;\n\t\t\t\t}\n\t\t\t\tif (flip) {px = [1 - px[0], 1 - px[1], 1 - px[2]]; py = [1 - py[0], 1 - py[1], 1 - py[2]];}\n\t\t\t\tpath.moveTo(d.x + d.width * px[0], d.y + d.height * py[0]);\n\t\t\t\tpath.lineTo(d.x + d.width * px[1], d.y + d.height * py[1]);\n\t\t\t\tpath.lineTo(d.x + d.width * px[2], d.y + d.height * py[2]);\n\t\t\t\tpath.closePath();\n\t\t\t\tctx.fillStyle = 'white';\n\t\t\t\tctx.strokeStyle = 'black';\n\t\t\t\tctx.lineWidth = 0;\n\t\t\t\tctx.fill(path);\n\t\t\t\tctx.stroke(path);\n\n\t\t\t\tctx.restore();\n\t\t\t}\n\t\t\telse if (d.id == '!')\n\t\t\t{\n\t\t\t\tctx.save();\n\n\t\t\t\tlet path1 = new Path2D(), path2 = new Path2D();\n\n\t\t\t\tlet inset = 5;\n\t\t\t\tlet w = d.width - inset * 2, h = d.height - inset * 2;\n\n\t\t\t\tfor (let z = 5; z < w + h - 1; z += 12)\n\t\t\t\t{\n\t\t\t\t\tlet x1 = 0, y1 = z, x2 = z, y2 = 0;\n\t\t\t\t\tif (y1 > h)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet delta = y1 - h;\n\t\t\t\t\t\tx1 += delta;\n\t\t\t\t\t\ty1 -= delta;\n\t\t\t\t\t}\n\t\t\t\t\tif (x2 > w)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet delta = x2 - w;\n\t\t\t\t\t\tx2 -= delta;\n\t\t\t\t\t\ty2 += delta;\n\t\t\t\t\t}\n\t\t\t\t\tpath1.moveTo(d.x + inset + x1, d.y + inset + y1);\n\t\t\t\t\tpath1.lineTo(d.x + inset + x2, d.y + inset + y2);\n\t\t\t\t\tpath2.moveTo(d.x + inset + x1 + 1, d.y + inset + y1);\n\t\t\t\t\tpath2.lineTo(d.x + inset + x2 + 1, d.y + inset + y2);\n\t\t\t\t}\n\n\t\t\t\tctx.lineWidth = 1;\n\t\t\t\tctx.strokeStyle = '#404040';\n\t\t\t\tctx.stroke(path1);\n\t\t\t\tctx.strokeStyle = 'white';\n\t\t\t\tctx.stroke(path2);\n\n\t\t\t\tctx.restore();\n\t\t\t}\n\t\t}\n\n\t\tctx.restore();\n\t}\n\tprivate delayedRedraw():void\n\t{\n\t\twindow.setTimeout(() => this.redraw(), 100);\n\t}\n\n\t// mapping ID tags into raw/display button objects\n\tprivate buttonFromID(id:string):ButtonBankItem\n\t{\n\t\tlet bank = this.stack[this.stack.length - 1];\n\t\tfor (let n = 0; n < bank.buttons.length; n++) if (bank.buttons[n].id == id) return bank.buttons[n];\n\t\treturn null;\n\t}\n\tprivate displayFromID(id:string):ButtonViewDisplay\n\t{\n\t\tfor (let n = 0; n < this.display.length; n++) if (this.display[n].id == id) return this.display[n];\n\t\treturn null;\n\t}\n\n\t// produces a path that runs around the outside edge of the buttonbank; the shape depends on the orientation\n\tprivate traceOutline():Path2D\n\t{\n\t\tlet w = this.width, h = this.height, uw = w - 1, uh = h - 1, r = 8;\n\t\tif (this.position == ButtonViewPosition.Centre || this.stack.length == 0) return pathRoundedRect(0.5, 0.5, w - 0.5, h - 0.5, r);\n\n\t\tlet path = new Path2D();\n\n\t\tif (this.position == ButtonViewPosition.Left)\n\t\t{\n\t\t\tlet my = 0.5 * h - 1, gw = this.gripHeight, hg = 0.5 * this.gripWidth;\n\t\t\tpath.moveTo(0.5, 0.5);\n\t\t\tpath.lineTo(0.5 + uw - gw - r, 0.5);\n\t\t\tpath.bezierCurveTo(0.5 + uw - gw, 0.5, 0.5 + uw - gw, 0.5, 0.5 + uw - gw, 0.5 + r);\n\t\t\tpath.lineTo(0.5 + uw - gw, 0.5 + my - hg);\n\t\t\tpath.lineTo(0.5 + uw - r, 0.5 + my - hg);\n\t\t\tpath.bezierCurveTo(0.5 + uw, 0.5 + my - hg, 0.5 + uw, 0.5 + my - hg, 0.5 + uw, 0.5 + my - hg + r);\n\t\t\tpath.lineTo(0.5 + uw, 0.5 + my + hg - r);\n\t\t\tpath.bezierCurveTo(0.5 + uw, 0.5 + my + hg, 0.5 + uw, 0.5 + my + hg, 0.5 + uw - r, 0.5 + my + hg);\n\t\t\tpath.lineTo(0.5 + uw - gw, 0.5 + my + hg);\n\t\t\tpath.lineTo(0.5 + uw - gw, 0.5 + uh - r);\n\t\t\tpath.bezierCurveTo(0.5 + uw - gw, 0.5 + uh, 0.5 + uw - gw, 0.5 + uh, 0.5 + uw - gw - r, 0.5 + uh);\n\t\t\tpath.lineTo(0.5, 0.5 + uh);\n\t\t}\n\t\telse if (this.position == ButtonViewPosition.Right)\n\t\t{\n\t\t\tlet my = 0.5 * h - 1, gw = this.gripHeight, hg = 0.5 * this.gripWidth;\n\t\t\tpath.moveTo(w - 0.5, 0.5);\n\t\t\tpath.lineTo(w - (0.5 + uw - gw - r), 0.5);\n\t\t\tpath.bezierCurveTo(w - (0.5 + uw - gw), 0.5, w - (0.5 + uw - gw), 0.5, w - (0.5 + uw - gw), 0.5 + r);\n\t\t\tpath.lineTo(w - (0.5 + uw - gw), 0.5 + my - hg);\n\t\t\tpath.lineTo(w - (0.5 + uw - r), 0.5 + my - hg);\n\t\t\tpath.bezierCurveTo(w - (0.5 + uw), 0.5 + my - hg, w - (0.5 + uw), 0.5 + my - hg, w - (0.5 + uw), 0.5 + my - hg + r);\n\t\t\tpath.lineTo(w - (0.5 + uw), 0.5 + my + hg - r);\n\t\t\tpath.bezierCurveTo(w - (0.5 + uw), 0.5 + my + hg, w - (0.5 + uw), 0.5 + my + hg, w - (0.5 + uw - r), 0.5 + my + hg);\n\t\t\tpath.lineTo(w - (0.5 + uw - gw), 0.5 + my + hg);\n\t\t\tpath.lineTo(w - (0.5 + uw - gw), 0.5 + uh - r);\n\t\t\tpath.bezierCurveTo(w - (0.5 + uw - gw), 0.5 + uh, w - (0.5 + uw - gw), 0.5 + uh, w - (0.5 + uw - gw - r), 0.5 + uh);\n\t\t\tpath.lineTo(w - 0.5, 0.5 + uh);\n\t\t}\n\t\telse if (this.position == ButtonViewPosition.Top)\n\t\t{\n\t\t\tlet mx = 0.5 * w - 1, gh = this.gripHeight, hg = 0.5 * this.gripWidth;\n\t\t\tpath.moveTo(0.5, h - (0.5 + uh));\n\t\t\tpath.lineTo(0.5, h - (0.5 + gh + r));\n\t\t\tpath.bezierCurveTo(0.5, h - (0.5 + gh), 0.5, h - (0.5 + gh), 0.5 + r, h - (0.5 + gh));\n\t\t\tpath.lineTo(0.5 + mx - hg, h - (0.5 + gh));\n\t\t\tpath.lineTo(0.5 + mx - hg, h - (0.5 + r));\n\t\t\tpath.bezierCurveTo(0.5 + mx - hg, h - 0.5, 0.5 + mx - hg, h - 0.5, 0.5 + mx - hg + r, h - 0.5);\n\t\t\tpath.lineTo(0.5 + mx + hg - r, h - 0.5);\n\t\t\tpath.bezierCurveTo(0.5 + mx + hg, h - 0.5, 0.5 + mx + hg, h - 0.5, 0.5 + mx + hg, h - (0.5 + r));\n\t\t\tpath.lineTo(0.5 + mx + hg, h - (0.5 + gh));\n\t\t\tpath.lineTo(0.5 + uw - r, h - (0.5 + gh));\n\t\t\tpath.bezierCurveTo(0.5 + uw, h - (0.5 + gh), 0.5 + uw, h - (0.5 + gh), 0.5 + uw, h - (0.5 + gh + r));\n\t\t\tpath.lineTo(0.5 + uw, h - (0.5 + uh));\n\t\t}\n\t\telse if (this.position == ButtonViewPosition.Bottom)\n\t\t{\n\t\t\tlet mx = 0.5 * w - 1, gh = this.gripHeight, hg = 0.5 * this.gripWidth;\n\t\t\tpath.moveTo(0.5, 0.5 + uh);\n\t\t\tpath.lineTo(0.5, 0.5 + gh + r);\n\t\t\tpath.bezierCurveTo(0.5, 0.5 + gh, 0.5, 0.5 + gh, 0.5 + r, 0.5 + gh);\n\t\t\tpath.lineTo(0.5 + mx - hg, 0.5 + gh);\n\t\t\tpath.lineTo(0.5 + mx - hg, 0.5 + r);\n\t\t\tpath.bezierCurveTo(0.5 + mx - hg, 0.5, 0.5 + mx - hg, 0.5, 0.5 + mx - hg + r, 0.5);\n\t\t\tpath.lineTo(0.5 + mx + hg - r, 0.5);\n\t\t\tpath.bezierCurveTo(0.5 + mx + hg, 0.5, 0.5 + mx + hg, 0.5, 0.5 + mx + hg, 0.5 + r);\n\t\t\tpath.lineTo(0.5 + mx + hg, 0.5 + gh);\n\t\t\tpath.lineTo(0.5 + uw - r, 0.5 + gh);\n\t\t\tpath.bezierCurveTo(0.5 + uw, 0.5 + gh, 0.5 + uw, 0.5 + gh, 0.5 + uw, 0.5 + gh + r);\n\t\t\tpath.lineTo(0.5 + uw, 0.5 + uh);\n\t\t}\n\t\treturn path;\n\t}\n\n\t// used for horizontal buttonbanks: provide a maximum width, and try to fill it evenly; returns slot[y][x]='id'/undef\n\tprivate layoutMaxWidth(bank:ButtonBank, slotWidth:number):string[][]\n\t{\n\t\tif (bank.buttons.length == 0) return [[null]];\n\n\t\t// !! consider the buddy system when feeding things in...\n\t\tlet bx = new Array(bank.buttons.length), by = new Array(bank.buttons.length);\n\t\tlet x = 0, y = 0, w = 0, h = 0;\n\t\tfor (let n = 0; n < bank.buttons.length; n++)\n\t\t{\n\t\t\tw = Math.max(x + 1, w);\n\t\t\th = Math.max(y + 1, h);\n\t\t\tbx[n] = x;\n\t\t\tby[n] = y;\n\t\t\tx++;\n\t\t\tif (x >= slotWidth) {x = 0; y++;}\n\t\t}\n\t\tlet slot = new Array(h);\n\t\tfor (let n = 0; n < h; n++) slot[n] = new Array(w);\n\t\tfor (let n = 0; n < bank.buttons.length; n++)\n\t\t{\n\t\t\tslot[by[n]][bx[n]] = bank.buttons[n].id;\n\t\t}\n\t\treturn slot;\n\t}\n\n\t// used for vertical buttonbanks: provide a maximum height, and a row width, and try to fill it evenly; note that the buttons\n\t// are still fed in left-to-right, just like the layoutMaxWidth method; returns slot[y][x]='id'/undef\n\tprivate layoutMaxHeight(bank:ButtonBank, slotHeight:number, slotWidth:number):string[][]\n\t{\n\t\tif (bank.buttons.length == 0) return [[null]];\n\n\t\t// !! consider the buddy system when feeding things in...\n\t\tlet bx = new Array(bank.buttons.length), by = new Array(bank.buttons.length);\n\t\tlet x = 0, y = 0, w = 0, h = 0;\n\t\tfor (let n = 0; n < bank.buttons.length; n++)\n\t\t{\n\t\t\tw = Math.max(x + 1, w);\n\t\t\th = Math.max(y + 1, h);\n\t\t\tbx[n] = x;\n\t\t\tby[n] = y;\n\t\t\tx++;\n\t\t\tif (x >= slotWidth) {x = 0; y++;}\n\t\t}\n\t\tlet slot = new Array(h);\n\t\tfor (let n = 0; n < h; n++) slot[n] = new Array(w);\n\t\tfor (let n = 0; n < bank.buttons.length; n++)\n\t\t{\n\t\t\tslot[by[n]][bx[n]] = bank.buttons[n].id;\n\t\t}\n\t\treturn slot;\n\t}\n\n\t// takes an array of slot[y][x], and calculates a base score; higher is bad, i.e. penalty based\n\tprivate scoreLayout(slots:string[][])\n\t{\n\t\tlet score = 0;\n\t\tlet nrows = slots.length, ncols = slots[0].length;\n\t\tfor (let y = 0; y < nrows; y++) for (let x = 0; x < ncols; x++)\n\t\t{\n\t\t\tif (slots[y][x] == null) score++;\n\t\t}\n\t\tif (this.maxButtonRows > 0 && nrows > this.maxButtonRows) score += (nrows - this.maxButtonRows) * 100;\n\t\tif (this.maxButtonColumns > 0 && ncols > this.maxButtonColumns) score += (ncols - this.maxButtonColumns) * 100;\n\t\treturn score;\n\t}\n\n\t// returns the index of the button underneath the position, or -1 if none\n\tprivate pickButtonIndex(x:number, y:number)\n\t{\n\t\tfor (let n = 0; n < this.display.length; n++)\n\t\t{\n\t\t\tlet d = this.display[n];\n\t\t\tif (x >= d.x && y >= d.y && x < d.x + d.width && y < d.y + d.height) return n;\n\t\t}\n\t\treturn -1;\n\t}\n\tprivate pickButtonID(x:number, y:number):string\n\t{\n\t\tlet idx = this.pickButtonIndex(x, y);\n\t\tif (idx < 0) return undefined;\n\t\treturn this.display[idx].id;\n\t}\n\n\t// the button index has been clicked, so activate the corresponding action\n\tprivate triggerButton(id:string):void\n\t{\n\t\tif (id == '*')\n\t\t{\n\t\t\tif (this.isRaised)\n\t\t\t\tthis.lowerBank();\n\t\t\telse\n\t\t\t\tthis.raiseBank();\n\t\t\treturn;\n\t\t}\n\t\telse if (id == '!')\n\t\t{\n\t\t\tthis.popBank();\n\t\t\treturn;\n\t\t}\n\t\tlet bank = this.stack[this.stack.length - 1];\n\t\tbank.hitButton(id);\n\t}\n\n\t// --------------------------------------- toolkit events ---------------------------------------\n\n\t// event responses\n\tprivate mouseClick(event:MouseEvent):void\n\t{\n\t}\n\tprivate mouseDoubleClick(event:MouseEvent):void\n\t{\n\t\t// (do something?)\n\t\tevent.stopImmediatePropagation();\n\t}\n\tprivate mouseDown(event:MouseEvent):void\n\t{\n\t\tthis.contentDOM.parent().grabFocus();\n\n\t\tlet xy = eventCoords(event, this.contentDOM);\n\t\tif (!this.withinOutline(xy[0], xy[1])) return; // propagate\n\n\t\t// !! ?? let shift = event.shiftKey, ctrl = event.ctrlKey, alt = event.altKey, meta = event.metaKey, plat = event.platformModifierKey;\n\t\tlet id = this.pickButtonID(xy[0], xy[1]);\n\n\t\tif (id != this.highlightButton)\n\t\t{\n\t\t\tthis.highlightButton = id;\n\t\t\tthis.redraw();\n\t\t}\n\n\t\tevent.stopPropagation();\n\t}\n\tprivate mouseUp(event:MouseEvent):void\n\t{\n\t\tlet xy = eventCoords(event, this.contentDOM);\n\t\tif (!this.withinOutline(xy[0], xy[1])) return; // propagate\n\n\t\t// !! ?? let shift = event.shiftKey, ctrl = event.ctrlKey, alt = event.altKey, meta = event.metaKey, plat = event.platformModifierKey;\n\t\tlet id = this.pickButtonID(xy[0], xy[1]);\n\n\t\tif (id != null && this.highlightButton == id)\n\t\t{\n\t\t\tthis.highlightButton = undefined;\n\t\t\tthis.triggerButton(id);\n\t\t\tthis.delayedRedraw();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.highlightButton = undefined;\n\t\t\tthis.delayedRedraw();\n\t\t}\n\n\t\tevent.stopPropagation();\n\t}\n\tprivate mouseOver(event:MouseEvent):void\n\t{\n\t\tlet xy = eventCoords(event, this.contentDOM);\n\t\tif (!this.withinOutline(xy[0], xy[1])) return; // propagate\n\n\t\t// (do something?)\n\n\t\tevent.stopPropagation();\n\t}\n\tprivate mouseOut(event:MouseEvent):void\n\t{\n\t\tlet xy = eventCoords(event, this.contentDOM);\n\t\tif (!this.withinOutline(xy[0], xy[1]))\n\t\t{\n\t\t\tif (this.highlightButton != null)\n\t\t\t{\n\t\t\t\tthis.highlightButton = null;\n\t\t\t\tthis.delayedRedraw();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.highlightButton != null)\n\t\t{\n\t\t\tlet xy = eventCoords(event, this.contentDOM);\n\t\t\tlet id = this.pickButtonID(xy[0], xy[1]);\n\t\t\tif (id != this.highlightButton)\n\t\t\t{\n\t\t\t\tthis.highlightButton = null;\n\t\t\t\tthis.delayedRedraw();\n\t\t\t}\n\t\t}\n\n\t\tevent.stopPropagation();\n\t}\n\tprivate mouseMove(event:MouseEvent):void\n\t{\n\t\tlet xy = eventCoords(event, this.contentDOM);\n\t\tif (!this.withinOutline(xy[0], xy[1])) return; // propagate\n\n\t\t// (do something?)\n\n\t\t//event.stopPropagation();\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2020 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {AbbrevContainer} from '../data/AbbrevContainer';\nimport {BondArtifact} from '../data/BondArtifact';\nimport {Chemistry} from '../data/Chemistry';\nimport {CoordUtil} from '../data/CoordUtil';\nimport {Graph} from '../data/Graph';\nimport {Molecule} from '../data/Molecule';\nimport {MolUtil} from '../data/MolUtil';\nimport {PolymerBlock} from '../data/PolymerBlock';\nimport {QueryTypeAtom, QueryUtil} from '../data/QueryUtil';\nimport {SketchUtil} from '../data/SketchUtil';\nimport {MetaVector} from '../gfx/MetaVector';\nimport {angleDiff, angleNorm, DEGRAD, norm2_xy, norm_xy, RADDEG, TWOPI} from '../util/util';\nimport {Vec} from '../util/Vec';\nimport {MetalLigate} from './MetalLigate';\nimport {Sketcher} from './Sketcher';\nimport {FusionPermutation, TemplateFusion} from './TemplateFusion';\n\n/*\n\tMoleculeActivity: command-oriented modifications of the current molecular state.\n\n\tThe invocation differs from the iOS/BlackBerry equivalents: rather than dividing each task into 2 parts, for testing\n\twhether an action is possible and actually carrying it out, there are two different functions: evaluate and execute.\n\tEvaluation is a very shallow analysis of whether a command has any chance of being relevant for the current state. If\n\tthe amount of effort involved in figuring it out is non-trivial (e.g. requires an RPC), it will just return yes. The\n\texecution mode is charged with the duty of updating the EditMolecule state, or reporting any errors that might occur.\n*/\n\nexport enum ActivityType\n{\n\tDelete = 1,\n\tClear,\n\tCopy,\n\tCut,\n\tSelectAll,\n\tSelectNone,\n\tSelectPrevComp,\n\tSelectNextComp,\n\tSelectSide,\n\tSelectGrow,\n\tSelectShrink,\n\tSelectChain,\n\tSelectSmRing,\n\tSelectRingBlk,\n\tSelectCurElement,\n\tSelectToggle,\n\tSelectUnCurrent,\n\tElement,\n\tAtomPos,\n\tCharge,\n\tConnect,\n\tDisconnect,\n\tMetalLigate,\n\tBondOrder,\n\tBondType,\n\tBondGeom,\n\tBondAtom,\n\tBondSwitch,\n\tBondRotate,\n\tBondAddTwo,\n\tBondInsert,\n\tJoin,\n\tNudge,\n\tNudgeLots,\n\tNudgeFar,\n\tFlip,\n\tScale,\n\tRotate,\n\tBondDist,\n\tAlignAngle,\n\tAlignRegular,\n\tAdjustTorsion,\n\tMove,\n\tRing,\n\t/*BondDist,\n\tCycleBond,*/\n\tTemplateFusion,\n\tAbbrevTempl,\n\tAbbrevGroup,\n\tAbbrevFormula,\n\tAbbrevClear,\n\tAbbrevExpand,\n\tBondArtifactPath,\n\tBondArtifactRing,\n\tBondArtifactArene,\n\tBondArtifactClear,\n\tPolymerBlock,\n\tAddHydrogens,\n\tRemoveHydrogens,\n\tQueryClear,\n\tQueryCopy,\n\tQueryPaste,\n\tQuerySetAtom,\n\tQuerySetBond,\n\tQueryBondAny,\n\tSproutDirection,\n}\n\nexport interface SketchState\n{\n\tmol:Molecule;\n\tcurrentAtom:number;\n\tcurrentBond:number;\n\tselectedMask:boolean[];\n\n\t// only used in specific circumstances\n\tpermutations?:FusionPermutation[];\n\n\t// alternate outcome provided occasionally\n\taltmol?:Molecule;\n}\n\nexport interface TemplatePermutation\n{\n\tmol:string;\n\tdisplay:string;\n\tmolidx:number[];\n\ttemidx:number[];\n\tsrcidx:number[];\n\tmetavec?:MetaVector;\n}\n\nexport class MoleculeActivity\n{\n\tprivate subjectMask:boolean[];\n\tprivate subjectIndex:number[];\n\tprivate subjectLength:number;\n\tprivate hasSelected:boolean;\n\n\tpublic output:SketchState;\n\tpublic errmsg:string;\n\tpublic toClipboard:string = null;\n\n\tconstructor(public input:SketchState, public activity:ActivityType, private param:Record<string, any>, private owner?:Sketcher)\n\t{\n\t\tthis.output =\n\t\t{\n\t\t\tmol: null,\n\t\t\tcurrentAtom: -1,\n\t\t\tcurrentBond: -1,\n\t\t\tselectedMask: null\n\t\t};\n\n\t\tlet na = this.input.mol.numAtoms;\n\t\tif (this.input.selectedMask == null) this.input.selectedMask = Vec.booleanArray(false, na);\n\t\twhile (this.input.selectedMask.length < na) this.input.selectedMask.push(false);\n\t\tthis.subjectMask = this.input.selectedMask.slice(0);\n\t\tthis.subjectLength = Vec.maskCount(this.subjectMask);\n\t\tthis.subjectIndex = [];\n\t\tthis.hasSelected = this.subjectLength > 0;\n\n\t\tif (this.subjectLength == 0)\n\t\t{\n\t\t\tif (this.input.currentAtom > 0)\n\t\t\t{\n\t\t\t\tthis.subjectLength = 1;\n\t\t\t\tthis.subjectMask[this.input.currentAtom - 1] = true;\n\t\t\t\tthis.subjectIndex = [this.input.currentAtom];\n\t\t\t}\n\t\t\telse if (this.input.currentBond > 0)\n\t\t\t{\n\t\t\t\tlet bfr = this.input.mol.bondFrom(this.input.currentBond), bto = this.input.mol.bondTo(this.input.currentBond);\n\t\t\t\tlet b1 = Math.min(bfr, bto), b2 = Math.max(bfr, bto);\n\t\t\t\tthis.subjectLength = 2;\n\t\t\t\tthis.subjectMask[b1 - 1] = true;\n\t\t\t\tthis.subjectMask[b2 - 1] = true;\n\t\t\t\tthis.subjectIndex = [b1, b2];\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.subjectIndex = Vec.maskIdx(this.subjectMask);\n\t\t\tVec.addTo(this.subjectIndex, 1);\n\t\t}\n\t}\n\n\t// provide the optional owner parameter: if defined, then it will be called after the operation is complete\n\t// (note: this is anachronistic, and should be refactored out)\n\tpublic setOwner(owner:any):void\n\t{\n\t\tthis.owner = owner;\n\t}\n\n\t// --------------------------------------- public methods ---------------------------------------\n\n\t// returns false if the activity cannot be executed; errs on the side of generosity, i.e. false positives are to be expected\n\tpublic evaluate():boolean\n\t{\n\t\t// ... actually do it...\n\t\treturn true;\n\t}\n\n\t// carries out the activity; some activities are performed immediately, while others require an RPC request; when it is finished,\n\t// the molecule state will be updated if successful, or an error will be displayed if not\n\tpublic execute():void\n\t{\n\t\tlet param = this.param;\n\n\t\tif (this.activity == ActivityType.Delete) this.execDelete();\n\t\telse if (this.activity == ActivityType.Clear) this.execClear();\n\t\telse if (this.activity == ActivityType.Copy) this.execCopy(false);\n\t\telse if (this.activity == ActivityType.Cut) this.execCopy(true);\n\t\telse if (this.activity == ActivityType.SelectAll) this.execSelectAll(true);\n\t\telse if (this.activity == ActivityType.SelectNone) this.execSelectAll(false);\n\t\telse if (this.activity == ActivityType.SelectPrevComp) this.execSelectComp(-1);\n\t\telse if (this.activity == ActivityType.SelectNextComp) this.execSelectComp(1);\n\t\telse if (this.activity == ActivityType.SelectSide) this.execSelectSide();\n\t\telse if (this.activity == ActivityType.SelectGrow) this.execSelectGrow();\n\t\telse if (this.activity == ActivityType.SelectShrink) this.execSelectShrink();\n\t\telse if (this.activity == ActivityType.SelectChain) this.execSelectChain();\n\t\telse if (this.activity == ActivityType.SelectSmRing) this.execSelectSmRing();\n\t\telse if (this.activity == ActivityType.SelectRingBlk) this.execSelectRingBlk();\n\t\telse if (this.activity == ActivityType.SelectCurElement) this.execSelectCurElement();\n\t\telse if (this.activity == ActivityType.SelectToggle) this.execSelectToggle();\n\t\telse if (this.activity == ActivityType.SelectUnCurrent) this.execSelectUnCurrent();\n\t\telse if (this.activity == ActivityType.Element) this.execElement(param.element, param.positionX, param.positionY, param.keepAbbrev);\n\t\telse if (this.activity == ActivityType.Charge) this.execCharge(param.delta);\n\t\telse if (this.activity == ActivityType.Connect) this.execConnect(1, Molecule.BONDTYPE_NORMAL);\n\t\telse if (this.activity == ActivityType.Disconnect) this.execDisconnect();\n\t\telse if (this.activity == ActivityType.MetalLigate) this.execMetalLigate();\n\t\telse if (this.activity == ActivityType.BondOrder) this.execBond(param.order, Molecule.BONDTYPE_NORMAL);\n\t\telse if (this.activity == ActivityType.BondType) this.execBond(1, param.type);\n\t\telse if (this.activity == ActivityType.BondGeom) this.execBondGeom(param.geom);\n\t\telse if (this.activity == ActivityType.BondAtom) this.execBondAtom(param.order, param.type, param.element, param.x1, param.y1, param.x2, param.y2);\n\t\telse if (this.activity == ActivityType.BondSwitch) this.execBondSwitch();\n\t\telse if (this.activity == ActivityType.BondRotate) this.execBondRotate();\n\t\telse if (this.activity == ActivityType.BondAddTwo) this.execBondAddTwo();\n\t\telse if (this.activity == ActivityType.BondInsert) this.execBondInsert();\n\t\telse if (this.activity == ActivityType.Join) this.execJoin();\n\t\telse if (this.activity == ActivityType.Nudge) this.execNudge(param.dir, 0.1);\n\t\telse if (this.activity == ActivityType.NudgeLots) this.execNudge(param.dir, 1);\n\t\telse if (this.activity == ActivityType.NudgeFar) this.execNudgeFar(param.dir);\n\t\telse if (this.activity == ActivityType.Flip) this.execFlip(param.axis);\n\t\telse if (this.activity == ActivityType.Scale) this.execScale(param.mag);\n\t\telse if (this.activity == ActivityType.Rotate) this.execRotate(param.theta, param.centreX, param.centreY);\n\t\telse if (this.activity == ActivityType.BondDist) this.execBondDist(param.dist);\n\t\telse if (this.activity == ActivityType.AlignAngle) this.execAlignAngle(param.angle);\n\t\telse if (this.activity == ActivityType.AlignRegular) this.execAlignRegular();\n\t\telse if (this.activity == ActivityType.AdjustTorsion) this.execAdjustTorsion(param.angle);\n\t\telse if (this.activity == ActivityType.Move) this.execMove(param.refAtom, param.deltaX, param.deltaY);\n\t\telse if (this.activity == ActivityType.Ring) this.execRing(param.ringX, param.ringY, param.aromatic);\n\t\t/*else if (this.activity == ActivityType.BondDist)\n\t\t{\n\t\t\t// !!\n\t\t}\n\t\telse if (this.activity == ActivityType.CycleBond)\n\t\t{\n\t\t\t// !!\n\t\t}*/\n\t\telse if (this.activity == ActivityType.TemplateFusion)\n\t\t{\n\t\t\tthis.execTemplateFusion(Molecule.fromString(param.fragNative));\n\t\t\tif (this.owner) this.owner.setPermutations(this.output.permutations as any as TemplatePermutation[]);\n\t\t\treturn;\n\t\t}\n\t\telse if (this.activity == ActivityType.AbbrevTempl) this.execAbbrevTempl();\n\t\telse if (this.activity == ActivityType.AbbrevGroup) this.execAbbrevGroup();\n\t\telse if (this.activity == ActivityType.AbbrevFormula) this.execAbbrevFormula();\n\t\telse if (this.activity == ActivityType.AbbrevClear) this.execAbbrevClear();\n\t\telse if (this.activity == ActivityType.AbbrevExpand) this.execAbbrevExpand();\n\t\telse if (this.activity == ActivityType.BondArtifactPath || this.activity == ActivityType.BondArtifactRing ||\n\t\t\t\tthis.activity == ActivityType.BondArtifactArene || this.activity == ActivityType.BondArtifactClear) this.execBondArtifact(this.activity);\n\t\telse if (this.activity == ActivityType.PolymerBlock) this.execPolymerBlock();\n\t\telse if (this.activity == ActivityType.AddHydrogens) this.execAddHydrogens();\n\t\telse if (this.activity == ActivityType.RemoveHydrogens) this.execRemoveHydrogens();\n\t\telse if (this.activity == ActivityType.QueryClear) this.execQueryClear();\n\t\telse if (this.activity == ActivityType.QueryCopy) this.execQueryCopy();\n\t\telse if (this.activity == ActivityType.QueryPaste) this.execQueryPaste();\n\t\telse if (this.activity == ActivityType.QuerySetAtom) this.execQuerySetAtom();\n\t\telse if (this.activity == ActivityType.QuerySetBond) this.execQuerySetBond();\n\t\telse if (this.activity == ActivityType.QueryBondAny) this.execQueryBondAny();\n\t\telse if (this.activity == ActivityType.SproutDirection) this.execSproutDirection(param.deltaX, param.deltaY);\n\n\t\tthis.finish();\n\t}\n\n\t// --------------------------------------- private methods ---------------------------------------\n\n\t// call this when execution has finished\n\tprivate finish():void\n\t{\n\t\tif (!this.owner) return;\n\n\t\tif (this.output.mol != null || this.output.currentAtom >= 0 || this.output.currentBond >= 0 || this.output.selectedMask != null)\n\t\t{\n\t\t\tthis.owner.setState(this.output, true);\n\n\t\t\tif (this.errmsg != null) this.owner.showMessage(this.errmsg, false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.errmsg != null) this.owner.showMessage(this.errmsg, true);\n\t\t}\n\t}\n\n\tpublic execDelete():void\n\t{\n\t\tif (!this.requireSubject()) return;\n\n\t\tlet mol = this.input.mol;\n\n\t\tthis.output.mol = mol.clone();\n\t\tthis.zapSubject();\n\n\t\t// if just a current bond, zap it\n\t\tif (this.input.currentBond > 0 && !this.hasSelected)\n\t\t{\n\t\t\tthis.output.mol.deleteBond(this.input.currentBond);\n\t\t\tthis.output.currentBond = 0;\n\t\t\treturn;\n\t\t}\n\n\t\t// if a terminal atom, bump over the selection\n\t\tif (this.subjectLength == 1 && this.subjectIndex[0] == this.input.currentAtom)\n\t\t{\n\t\t\tlet adj = mol.atomAdjList(this.input.currentAtom);\n\t\t\tif (adj.length == 1)\n\t\t\t{\n\t\t\t\tthis.output.currentAtom = adj[0];\n\t\t\t\tif (this.output.currentAtom > this.input.currentAtom) this.output.currentAtom--;\n\t\t\t}\n\t\t}\n\n\t\t// do the deletion\n\t\tfor (let n = this.subjectLength - 1; n >= 0; n--) this.output.mol.deleteAtomAndBonds(this.subjectIndex[n]);\n\t}\n\n\tpublic execCopy(withCut:boolean):void\n\t{\n\t\tlet mol = this.input.mol;\n\t\tif (this.subjectLength > 0) mol = MolUtil.subgraphWithAttachments(mol, this.subjectMask);\n\n\t\tif (this.owner) this.owner.performCopy(mol);\n\t\telse this.toClipboard = mol.toString();\n\n\t\tif (withCut)\n\t\t{\n\t\t\tthis.zapSubject();\n\t\t\tthis.output.mol = MolUtil.subgraphMask(this.input.mol, Vec.notMask(this.subjectMask));\n\t\t}\n\t}\n\n\tpublic execClear():void\n\t{\n\t\tthis.output.mol = new Molecule();\n\t\tthis.zapSubject();\n\t}\n\n\tpublic execSelectAll(all:boolean):void\n\t{\n\t\tlet same = true;\n\t\tfor (let n = 0; n < this.input.mol.numAtoms; n++) if (this.subjectMask[n] != all)\n\t\t{\n\t\t\tsame = false;\n\t\t\tbreak;\n\t\t}\n\t\tif (same)\n\t\t{\n\t\t\tthis.errmsg = all ? 'All atoms already selected.' : 'All atoms already deselected.';\n\t\t\treturn;\n\t\t}\n\t\tthis.output.selectedMask = Vec.booleanArray(all, this.input.mol.numAtoms);\n\t}\n\n\tpublic execSelectComp(dir:number):void\n\t{\n\t\tlet cclist = MolUtil.componentList(this.input.mol);\n\t\tif (cclist.length == 1 && this.hasSelected && this.subjectLength == this.input.mol.numAtoms)\n\t\t{\n\t\t\tthis.errmsg = 'All atoms already selected.';\n\t\t\treturn;\n\t\t}\n\t\tlet sel = this.pickSelectedGroup(cclist, dir);\n\t\tthis.output.selectedMask = Vec.booleanArray(false, this.input.mol.numAtoms);\n\t\tfor (let n = 0; n < cclist[sel].length; n++) this.output.selectedMask[cclist[sel][n] - 1] = true;\n\t}\n\n\tpublic execSelectSide():void\n\t{\n\t\tif (!this.requireCurrent()) return;\n\n\t\tlet mol = this.input.mol, currentAtom = this.input.currentAtom, currentBond = this.input.currentBond;\n\n\t\tif (currentAtom > 0 && mol.atomAdjCount(currentAtom) == 0)\n\t\t{\n\t\t\tthis.errmsg = 'Current atom has no neighbours.';\n\t\t\treturn;\n\t\t}\n\t\tif (currentBond > 0 && mol.atomAdjCount(mol.bondFrom(currentBond)) == 1 && mol.atomAdjCount(mol.bondTo(currentBond)) == 1)\n\t\t{\n\t\t\tthis.errmsg = 'Current bond has no neighbours.';\n\t\t\treturn;\n\t\t}\n\n\t\tlet sides = currentAtom > 0 ? MolUtil.getAtomSides(mol, currentAtom) : MolUtil.getBondSides(mol, currentBond);\n\t\tlet sel = this.pickSelectedGroup(sides, 1);\n\t\tthis.output.selectedMask = Vec.booleanArray(false, mol.numAtoms);\n\t\tfor (let n = 0; n < sides[sel].length; n++) this.output.selectedMask[sides[sel][n] - 1] = true;\n\t}\n\n\tpublic execSelectGrow():void\n\t{\n\t\tif (!this.requireSubject()) return;\n\n\t\tlet mol = this.input.mol, currentAtom = this.input.currentAtom, currentBond = this.input.currentBond;\n\t\tthis.output.selectedMask = this.input.selectedMask.slice(0);\n\n\t\tif (!this.hasSelected)\n\t\t{\n\t\t\tif (currentAtom > 0)\n\t\t\t{\n\t\t\t\tthis.output.selectedMask[currentAtom - 1] = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.output.selectedMask[mol.bondFrom(currentBond) - 1] = true;\n\t\t\t\tthis.output.selectedMask[mol.bondTo(currentBond) - 1] = true;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t\t{\n\t\t\t\tlet bfr = mol.bondFrom(n) - 1, bto = mol.bondTo(n) - 1;\n\t\t\t\tif (this.input.selectedMask[bfr] && !this.input.selectedMask[bto]) this.output.selectedMask[bto] = true;\n\t\t\t\telse if (this.input.selectedMask && !this.input.selectedMask[bfr]) this.output.selectedMask[bfr] = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic execSelectShrink():void\n\t{\n\t\tif (!this.requireSelected()) return;\n\n\t\tlet mol = this.input.mol;\n\t\tlet count = Vec.numberArray(0, mol.numAtoms);\n\n\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t{\n\t\t\tlet bfr = mol.bondFrom(n) - 1, bto = mol.bondTo(n) - 1;\n\t\t\tif (!this.input.selectedMask[bfr] || !this.input.selectedMask[bto]) continue;\n\t\t\tcount[bfr]++;\n\t\t\tcount[bto]++;\n\t\t}\n\n\t\tthis.output.selectedMask = this.input.selectedMask.slice(0);\n\t\tfor (let n = 0; n < mol.numAtoms; n++) this.output.selectedMask[n] = this.input.selectedMask[n] && count[n] >= 2;\n\t}\n\n\tpublic execSelectChain():void\n\t{\n\t\tif (!this.requireSubject()) return;\n\n\t\tlet mol = this.input.mol;\n\t\tthis.output.selectedMask = this.input.selectedMask.slice(0);\n\n\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t{\n\t\t\tlet bfr = mol.bondFrom(n) - 1, bto = mol.bondTo(n) - 1;\n\t\t\tif (this.input.selectedMask[bfr] && !this.input.selectedMask[bto] && mol.atomRingBlock(bto + 1) == 0) this.output.selectedMask[bto] = true;\n\t\t\telse if (this.input.selectedMask[bto] && !this.input.selectedMask[bfr] && mol.atomRingBlock(bfr + 1) == 0) this.output.selectedMask[bfr] = true;\n\t\t}\n\t}\n\n\tpublic execSelectSmRing():void\n\t{\n\t\tif (!this.requireSubject()) return;\n\n\t\tthis.output.selectedMask = this.input.selectedMask.slice(0);\n\n\t\tfor (let r = 3; r <= 8; r++)\n\t\t{\n\t\t\tlet rings = this.input.mol.findRingsOfSize(r);\n\t\t\tfor (let i = 0; i < rings.length; i++)\n\t\t\t{\n\t\t\t\tlet any = false;\n\t\t\t\tfor (let j = 0; j < rings[i].length; j++) if (this.subjectMask[rings[i][j] - 1])\n\t\t\t\t{\n\t\t\t\t\tany = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (any) for (let j = 0; j < rings[i].length; j++) this.output.selectedMask[rings[i][j] - 1] = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic execSelectRingBlk():void\n\t{\n\t\tif (!this.requireSubject()) return;\n\n\t\tlet mol = this.input.mol;\n\t\tthis.output.selectedMask = this.input.selectedMask.slice(0);\n\n\t\tlet maxRB = 0;\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) maxRB = Math.max(maxRB, mol.atomRingBlock(n));\n\t\tif (maxRB == 0) return;\n\n\t\tlet gotRB = Vec.booleanArray(false, maxRB);\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t{\n\t\t\tlet rb = mol.atomRingBlock(n);\n\t\t\tif (rb > 0 && this.subjectMask[n - 1]) gotRB[rb - 1] = true;\n\t\t}\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t{\n\t\t\tlet rb = mol.atomRingBlock(n);\n\t\t\tif (rb > 0 && gotRB[rb - 1]) this.output.selectedMask[n - 1] = true;\n\t\t}\n\t}\n\n\tpublic execSelectCurElement():void\n\t{\n\t\tif (!this.requireCurrent()) return;\n\n\t\tlet mol = this.input.mol;\n\t\tthis.output.selectedMask = this.input.selectedMask.slice(0);\n\n\t\tlet el1 = '', el2 = '';\n\t\tif (this.input.currentAtom > 0)\n\t\t{\n\t\t\tel1 = mol.atomElement(this.input.currentAtom);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tel1 = mol.atomElement(mol.bondFrom(this.input.currentBond));\n\t\t\tel2 = mol.atomElement(mol.bondTo(this.input.currentBond));\n\t\t}\n\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t\tif (mol.atomElement(n) == el1 || mol.atomElement(n) == el2) this.output.selectedMask[n - 1] = true;\n\t}\n\n\tpublic execSelectToggle():void\n\t{\n\t\tif (!this.requireCurrent()) return;\n\n\t\tthis.output.selectedMask = this.input.selectedMask.slice(0);\n\n\t\tif (this.input.currentAtom > 0)\n\t\t{\n\t\t\tthis.output.selectedMask[this.input.currentAtom - 1] = !this.output.selectedMask[this.input.currentAtom - 1];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet bfr = this.input.mol.bondFrom(this.input.currentBond), bto = this.input.mol.bondTo(this.input.currentBond);\n\t\t\tlet sel = !this.input.selectedMask[bfr - 1] || !this.input.selectedMask[bto - 1];\n\t\t\tthis.output.selectedMask[bfr - 1] = sel;\n\t\t\tthis.output.selectedMask[bto - 1] = sel;\n\t\t}\n\t}\n\n\tpublic execSelectUnCurrent():void\n\t{\n\t\tif (!this.requireCurrent()) return;\n\n\t\tthis.output.selectedMask = this.input.selectedMask.slice(0);\n\n\t\tif (this.input.currentAtom > 0)\n\t\t{\n\t\t\tthis.output.selectedMask[this.input.currentAtom - 1] = false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.output.selectedMask[this.input.mol.bondFrom(this.input.currentBond) - 1] = false;\n\t\t\tthis.output.selectedMask[this.input.mol.bondTo(this.input.currentBond) - 1] = false;\n\t\t}\n\t}\n\n\tpublic execElement(element:string, positionX?:number, positionY?:number, keepAbbrev?:boolean):void\n\t{\n\t\tconst QUERY_ELEMENTS = ['A', 'X', 'Y', 'Z', 'Q', 'M', 'T', 'E', 'R'];\n\n\t\tif (this.subjectLength > 0 && !QUERY_ELEMENTS.includes(element))\n\t\t{\n\t\t\tlet anyChange = false;\n\t\t\tfor (let n = 0; n < this.subjectLength; n++) if (this.input.mol.atomElement(this.subjectIndex[n]) != element)\n\t\t\t{\n\t\t\t\tanyChange = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (!anyChange)\n\t\t\t{\n\t\t\t\tthis.errmsg = 'Elements not changed.';\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tlet mol = this.output.mol = this.input.mol.clone();\n\n\t\tlet applyQuery = (atom:number) =>\n\t\t{\n\t\t\tif (element == 'A')\n\t\t\t{\n\t\t\t\tQueryUtil.setQueryAtomElementsNot(mol, atom, ['H']);\n\t\t\t\tQueryUtil.deleteQueryAtom(mol, atom, QueryTypeAtom.Elements);\n\t\t\t}\n\t\t\telse if (element == 'X')\n\t\t\t{\n\t\t\t\tQueryUtil.setQueryAtomElements(mol, atom, ['F', 'Cl', 'Br', 'I']);\n\t\t\t\tQueryUtil.deleteQueryAtom(mol, atom, QueryTypeAtom.ElementsNot);\n\t\t\t}\n\t\t\telse if (element == 'Y')\n\t\t\t{\n\t\t\t\tQueryUtil.setQueryAtomElements(mol, atom, ['O', 'S', 'Se', 'Te']);\n\t\t\t\tQueryUtil.deleteQueryAtom(mol, atom, QueryTypeAtom.ElementsNot);\n\t\t\t}\n\t\t\telse if (element == 'Z')\n\t\t\t{\n\t\t\t\tQueryUtil.setQueryAtomElements(mol, atom, ['F', 'Cl', 'Br', 'O', 'S']);\n\t\t\t\tQueryUtil.deleteQueryAtom(mol, atom, QueryTypeAtom.ElementsNot);\n\t\t\t}\n\t\t\telse if (element == 'Q')\n\t\t\t{\n\t\t\t\tQueryUtil.setQueryAtomElementsNot(mol, atom, ['H', 'C']);\n\t\t\t\tQueryUtil.deleteQueryAtom(mol, atom, QueryTypeAtom.Elements);\n\t\t\t}\n\t\t\telse if (element == 'M')\n\t\t\t{\n\t\t\t\tconst NON_METALS = ['H', 'B', 'C', 'N', 'O', 'F', 'Si', 'P', 'S', 'Cl', 'As', 'Se', 'Br', 'Te', 'I'];\n\t\t\t\tQueryUtil.setQueryAtomElementsNot(mol, atom, NON_METALS);\n\t\t\t\tQueryUtil.deleteQueryAtom(mol, atom, QueryTypeAtom.Elements);\n\t\t\t}\n\t\t\telse if (element == 'T')\n\t\t\t{\n\t\t\t\tconst TRANSITION_METALS =\n\t\t\t\t[\n\t\t\t\t\t'Sc', 'Ti', 'V', 'Cr', 'Mn', 'Fe', 'Co', 'Ni', 'Cu', 'Zn',\n\t\t\t\t\t'Y', 'Zr', 'Nb', 'Mo', 'Tc', 'Ru', 'Rh', 'Pd', 'Ag', 'Cd',\n\t\t\t\t\t'Hf', 'Ta', 'W', 'Re', 'Os', 'Ir', 'Pt', 'Au', 'Hg',\n\t\t\t\t\t'La', 'Ce', 'Pr', 'Nd', 'Pm', 'Sm', 'Eu', 'Gd', 'Tb', 'Dy', 'Ho', 'Er', 'Tm', 'Yb', 'Lu',\n\t\t\t\t\t'Ac', 'Th', 'Pa', 'U', 'Np', 'Pu', 'Am', 'Cm', 'Bk', 'Cf', 'Es', 'Fm', 'Md', 'No', 'Lr'\n\t\t\t\t];\n\t\t\t\tQueryUtil.setQueryAtomElements(mol, atom, TRANSITION_METALS);\n\t\t\t\tQueryUtil.deleteQueryAtom(mol, atom, QueryTypeAtom.ElementsNot);\n\t\t\t}\n\t\t\telse if (element == 'E')\n\t\t\t{\n\t\t\t\tconst MAIN_GROUPS =\n\t\t\t\t[\n\t\t\t\t\t'B', 'N', 'O', 'F',\n\t\t\t\t\t'Al', 'Si', 'P', 'S', 'Cl',\n\t\t\t\t\t'Zn', 'Ga', 'Se', 'As', 'Se', 'Br',\n\t\t\t\t\t'Cd', 'In', 'Sn', 'Sb', 'Te', 'I',\n\t\t\t\t\t'Hg', 'Tl', 'Pb', 'Bi', 'Pb', 'At'\n\t\t\t\t];\n\t\t\t\tQueryUtil.setQueryAtomElements(mol, atom, MAIN_GROUPS);\n\t\t\t\tQueryUtil.deleteQueryAtom(mol, atom, QueryTypeAtom.ElementsNot);\n\t\t\t}\n\t\t\telse if (element == 'R')\n\t\t\t{\n\t\t\t\tQueryUtil.setQueryAtomElements(mol, atom, ['C', 'N', 'O', 'S', 'P', 'H']);\n\t\t\t\tQueryUtil.deleteQueryAtom(mol, atom, QueryTypeAtom.ElementsNot);\n\t\t\t}\n\t\t};\n\n\t\tif (mol.numAtoms == 0)\n\t\t{\n\t\t\tmol.addAtom(element, 0, 0);\n\t\t\tapplyQuery(mol.numAtoms);\n\t\t}\n\t\telse if (this.subjectLength == 0)\n\t\t{\n\t\t\t// when there's no subject, this is an add-atom operation\n\t\t\tif (positionX != null && positionY != null)\n\t\t\t\tmol.addAtom(element, positionX, positionY);\n\t\t\telse\n\t\t\t\tSketchUtil.placeNewAtom(mol, element);\n\t\t\tapplyQuery(mol.numAtoms);\n\t\t}\n\t\telse // there is a subject, so it's a change-atom operation\n\t\t{\n\t\t\tfor (let n = 0; n < this.subjectLength; n++)\n\t\t\t{\n\t\t\t\tif (keepAbbrev)\n\t\t\t\t\tmol.setAtomElement(this.subjectIndex[n], element);\n\t\t\t\telse\n\t\t\t\t\tMolUtil.setAtomElement(mol, this.subjectIndex[n], element);\n\t\t\t\tapplyQuery(this.subjectIndex[n]);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic execCharge(delta:number):void\n\t{\n\t\tif (!this.requireSubject()) return;\n\n\t\tthis.output.mol = this.input.mol.clone();\n\t\tfor (let n = 0; n < this.subjectLength; n++)\n\t\t{\n\t\t\tlet chg = Math.max(-20, Math.min(20, this.input.mol.atomCharge(this.subjectIndex[n]) + delta));\n\t\t\tthis.output.mol.setAtomCharge(this.subjectIndex[n], chg);\n\t\t}\n\t}\n\n\tpublic execConnect(order:number, type:number):void\n\t{\n\t\tif (!this.requireSubject()) return;\n\n\t\tlet conn = SketchUtil.pickAtomsToConnect(this.input.mol, this.subjectIndex);\n\t\tif (conn == null)\n\t\t{\n\t\t\tthis.errmsg = 'Subject atoms contain no bonds suitable for connection.';\n\t\t\treturn;\n\t\t}\n\n\t\tthis.output.mol = this.input.mol.clone();\n\t\tfor (let n = 0; n < conn.length; n += 2) MolUtil.addBond(this.output.mol, conn[n], conn[n + 1], order, type);\n\t}\n\n\tpublic execDisconnect():void\n\t{\n\t\tlet zap:number[] = [];\n\n\t\tlet mol = this.input.mol;\n\n\t\tif (this.hasSelected)\n\t\t{\n\t\t\tfor (let n = 1; n <= mol.numBonds; n++) if (this.subjectMask[mol.bondFrom(n) - 1] && this.subjectMask[mol.bondTo(n) - 1]) zap.push(n);\n\t\t}\n\t\telse if (this.input.currentAtom > 0)\n\t\t{\n\t\t\tfor (let a of mol.atomAdjBonds(this.input.currentAtom)) zap.push(a);\n\t\t}\n\t\telse if (this.input.currentBond > 0)\n\t\t{\n\t\t\tzap.push(this.input.currentBond);\n\t\t}\n\t\tif (zap.length == 0)\n\t\t{\n\t\t\tthis.errmsg = 'Subject atoms contain no bonds suitable for disconnection.';\n\t\t\treturn;\n\t\t}\n\n\t\tlet killmask = Vec.booleanArray(false, mol.numBonds);\n\t\tfor (let b of zap) killmask[b - 1] = true;\n\n\t\tthis.output.mol = this.input.mol.clone();\n\t\tfor (let n = mol.numBonds; n >= 1; n--) if (killmask[n - 1]) this.output.mol.deleteBond(n);\n\t}\n\n\tpublic execMetalLigate():void\n\t{\n\t\tif (!this.requireSubject()) return;\n\n\t\tlet mol = this.input.mol;\n\n\t\tlet ligAtoms = this.subjectIndex.slice(0);\n\n\t\t// ideally the user specified the metal by way of the current atom, but otherwise make a guess\n\t\tlet metalAtom = this.input.currentAtom;\n\t\tif (metalAtom == 0)\n\t\t{\n\t\t\tfor (let a of this.subjectIndex)\n\t\t\t{\n\t\t\t\tlet atno = mol.atomicNumber(a);\n\t\t\t\tif (Chemistry.ELEMENT_BLOCKS[atno] >= 3) {metalAtom = a; break;}\n\t\t\t}\n\t\t}\n\t\tif (metalAtom == 0)\n\t\t{\n\t\t\tfor (let a of this.subjectIndex)\n\t\t\t{\n\t\t\t\tlet atno = mol.atomicNumber(a);\n\t\t\t\tif (Chemistry.ELEMENT_ROWS[atno] >= 3) {metalAtom = a; break;}\n\t\t\t}\n\t\t}\n\n\t\tif (metalAtom == 0)\n\t\t{\n\t\t\tthis.errmsg = 'Unsure which is the metal atom: try indicating as current.';\n\t\t\treturn;\n\t\t}\n\n\t\tlet i = ligAtoms.indexOf(metalAtom);\n\t\tif (i >= 0) ligAtoms.splice(i, 1);\n\n\t\tif (ligAtoms.length == 0) ligAtoms = mol.atomAdjList(metalAtom);\n\t\tif (ligAtoms.length == 0)\n\t\t{\n\t\t\tthis.errmsg = 'Metal centre has no attachments: try selecting atom join-points.';\n\t\t\treturn;\n\t\t}\n\n\t\tmol = new MetalLigate(mol, metalAtom, ligAtoms).generate();\n\n\t\tthis.output.mol = mol;\n\t\tthis.output.currentAtom = metalAtom;\n\t\tthis.output.currentBond = -1;\n\t\tthis.output.selectedMask = Vec.booleanArray(false, mol.numAtoms);\n\t\tfor (let a of ligAtoms) this.output.selectedMask[a - 1] = true;\n\t}\n\n\tpublic execBond(order:number, type:number):void\n\t{\n\t\tif (!this.requireSubject()) return;\n\n\t\t// one atom subject: this is a request for a new bond\n\t\tif (this.subjectLength == 1)\n\t\t{\n\t\t\tthis.performBondNew(this.subjectIndex[0], order, type);\n\t\t\treturn;\n\t\t}\n\n\t\t// see whether the selected atoms are from 2 disconnected groups, which determines whether it's a change-order operation\n\t\t// or a connect operation\n\t\tlet ccmol = MolUtil.subgraphMask(this.input.mol, this.subjectMask);\n\t\tlet oneComp = true;\n\t\tfor (let n = ccmol.numAtoms; n >= 1; n--) if (ccmol.atomConnComp(n) != 1) {oneComp = false; break;}\n\t\tif (oneComp)\n\t\t\tthis.performBondChange(order, type);\n\t\telse\n\t\t\tthis.execConnect(order, type);\n\t}\n\n\tpublic execBondGeom(geom:number):void\n\t{\n\t\tlet bond = this.subjectLength == 2 ? this.input.mol.findBond(this.subjectIndex[0], this.subjectIndex[1]) : 0;\n\t\tif (this.subjectLength == 0 || this.subjectLength > 2 || (this.subjectLength == 2 && bond == 0))\n\t\t{\n\t\t\tthis.errmsg = 'The subject must be a single atom or bond.';\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.subjectLength == 1)\n\t\t\tthis.performBondGeomAtom(geom, this.subjectIndex[0]);\n\t\telse\n\t\t\tthis.performBondGeomBond(geom, bond);\n\t}\n\n\tpublic execBondAtom(order:number, type:number, element:string, x1:number, y1:number, x2:number, y2:number):void\n\t{\n\t\tlet mol = this.input.mol;\n\t\tlet a1 = CoordUtil.atomAtPoint(mol, x1, y1, 0.01), a2 = CoordUtil.atomAtPoint(mol, x2, y2, 0.01);\n\t\tif (a1 > 0 && a1 == a2) return; // bond to self\n\t\tif (a1 > 0 && a2 > 0 && mol.findBond(a1, a2) > 0) return;\n\n\t\tthis.output.mol = mol.clone();\n\n\t\tif (a1 == 0) a1 = this.output.mol.addAtom('C', x1, y1);\n\t\tif (a2 == 0) a2 = this.output.mol.addAtom(element, x2, y2);\n\t\tthis.output.mol.addBond(a1, a2, order, type);\n\t}\n\n\tpublic execBondSwitch():void\n\t{\n\t\tif (this.input.altmol)\n\t\t{\n\t\t\tthis.output.mol = this.input.altmol;\n\t\t\tthis.output.altmol = this.input.mol;\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.requireSubject()) return;\n\n\t\tlet mol = this.input.mol;\n\n\t\t// decide which bonds are applicable\n\t\tlet src = 0, dst:number[] = [];\n\t\tif (this.subjectLength == 1)\n\t\t{\n\t\t\tsrc = this.subjectIndex[0];\n\t\t\tlet adj = mol.atomAdjList(src);\n\t\t\tfor (let n = 0; n < adj.length; n++) if (mol.atomAdjCount(adj[n]) == 1) dst.push(adj[n]);\n\t\t}\n\t\telse if (this.subjectLength == 2 && mol.findBond(this.subjectIndex[0], this.subjectIndex[1]) > 0)\n\t\t{\n\t\t\tlet ac1 = mol.atomAdjCount(this.subjectIndex[0]), ac2 = mol.atomAdjCount(this.subjectIndex[1]);\n\t\t\tif (ac1 > 1 && ac2 == 1)\n\t\t\t{\n\t\t\t\tsrc = this.subjectIndex[0];\n\t\t\t\tdst.push(this.subjectIndex[1]);\n\t\t\t}\n\t\t\telse if (ac1 == 1 && ac2 > 1)\n\t\t\t{\n\t\t\t\tsrc = this.subjectIndex[1];\n\t\t\t\tdst.push(this.subjectIndex[0]);\n\t\t\t}\n\t\t}\n\n\t\tif (src == 0 || dst.length == 0)\n\t\t{\n\t\t\tthis.errmsg = 'Subject must include a terminal bond.';\n\t\t\treturn;\n\t\t}\n\n\t\tlet geoms = SketchUtil.guessAtomGeometry(mol, src, 1);\n\t\tif (geoms.length == 0)\n\t\t{\n\t\t\tthis.errmsg = 'No alternative geometries identified.';\n\t\t\treturn;\n\t\t}\n\n\t\tthis.output.mol = SketchUtil.switchAtomGeometry(mol, src, dst, geoms);\n\t\tif (this.output.mol == null)\n\t\t{\n\t\t\tthis.errmsg = 'No alternative geometries identified.';\n\t\t}\n\t}\n\n\tpublic execBondRotate():void\n\t{\n\t\tlet bond = this.input.currentBond;\n\n\t\tif (bond == 0)\n\t\t{\n\t\t\tthis.errmsg = 'There must be a current bond.';\n\t\t\treturn;\n\t\t}\n\n\t\tlet mol = this.input.mol;\n\t\tif (mol.bondInRing(bond))\n\t\t{\n\t\t\tthis.errmsg = 'Cannot rotate a ring-bond.';\n\t\t\treturn;\n\t\t}\n\t\tif (mol.atomAdjCount(mol.bondFrom(bond)) == 1 && mol.atomAdjCount(mol.bondTo(bond)) == 1)\n\t\t{\n\t\t\tthis.errmsg = 'Two-atom components do not rotate.';\n\t\t\treturn;\n\t\t}\n\n\t\tmol = mol.clone();\n\n\t\tlet [atom1, atom2, side] = this.mobileSide(bond, true);\n\t\tlet cx = mol.atomX(atom1), cy = mol.atomY(atom1);\n\t\tlet theta = Math.atan2(mol.atomY(atom1) - mol.atomY(atom2), mol.atomX(atom1) - mol.atomX(atom2));\n\t\tfor (let a of side) if (a != atom1)\n\t\t{\n\t\t\tlet dx = mol.atomX(a) - cx, dy = mol.atomY(a) - cy, dist = norm_xy(dx, dy);\n\t\t\tlet dtheta = Math.atan2(dy, dx);\n\t\t\tdtheta = theta - angleDiff(dtheta, theta);\n\t\t\tmol.setAtomPos(a, cx + dist * Math.cos(dtheta), cy + dist * Math.sin(dtheta));\n\t\t}\n\t\tlet mask = Vec.idxMask(Vec.add(side, -1), mol.numAtoms);\n\t\tfor (let b = 1; b <= mol.numBonds; b++) if (mask[mol.bondFrom(b) - 1] && mask[mol.bondTo(b) - 1])\n\t\t{\n\t\t\tlet bt = mol.bondType(b);\n\t\t\tif (bt == Molecule.BONDTYPE_INCLINED) mol.setBondType(b, Molecule.BONDTYPE_DECLINED);\n\t\t\telse if (bt == Molecule.BONDTYPE_DECLINED) mol.setBondType(b, Molecule.BONDTYPE_INCLINED);\n\t\t}\n\n\t\tif (CoordUtil.sketchEquivalent(this.input.mol, mol))\n\t\t{\n\t\t\tthis.errmsg = 'Rotation has no effect.';\n\t\t\treturn;\n\t\t}\n\n\t\tthis.output.mol = mol;\n\t}\n\n\tpublic execBondAddTwo():void\n\t{\n\t\tif (this.subjectLength != 1)\n\t\t{\n\t\t\tthis.errmsg = 'Subject must be a single atom.';\n\t\t\treturn;\n\t\t}\n\t\tlet atom = this.subjectIndex[0];\n\t\tif (this.input.mol.atomAdjCount(atom) < 2)\n\t\t{\n\t\t\tthis.errmsg = 'Subject atom must already have at least 2 bonds.';\n\t\t\treturn;\n\t\t}\n\n\t\tlet ang = SketchUtil.calculateNewBondAngles(this.input.mol, atom, 1);\n\t\tif (ang.length == 0) ang = SketchUtil.exitVectors(this.input.mol, atom);\n\t\tif (ang.length == 0)\n\t\t{\n\t\t\tthis.errmsg = 'Could not find a suitable geometry for new substituents.';\n\t\t\treturn;\n\t\t}\n\n\t\tlet baseAng = ang[0];\n\t\tlet cx = this.input.mol.atomX(atom), cy = this.input.mol.atomY(atom);\n\t\tif (ang.length > 1)\n\t\t{\n\t\t\tlet best = 0;\n\t\t\tfor (let n = 0; n < ang.length; n++)\n\t\t\t{\n\t\t\t\tlet x = cx + Molecule.IDEALBOND * Math.cos(ang[n]);\n\t\t\t\tlet y = cy + Molecule.IDEALBOND * Math.sin(ang[n]);\n\t\t\t\tlet score = CoordUtil.congestionPoint(this.input.mol, x, y);\n\t\t\t\tif (n == 0 || score < best) {best = score; baseAng = ang[n];}\n\t\t\t}\n\t\t}\n\n\t\tlet ang1 = baseAng - 30.0 * DEGRAD, ang2 = baseAng + 30.0 * DEGRAD;\n\n\t\t// NOTE: maybe try out variations? ... may be better to just leave it as the entirely predictable 60 degrees...\n\n\t\tlet mol = this.input.mol.clone();\n\t\tlet a1 = mol.addAtom('C', cx + Molecule.IDEALBOND * Math.cos(ang1), cy + Molecule.IDEALBOND * Math.sin(ang1));\n\t\tlet a2 = mol.addAtom('C', cx + Molecule.IDEALBOND * Math.cos(ang2), cy + Molecule.IDEALBOND * Math.sin(ang2));\n\t\tmol.addBond(atom, a1, 1);\n\t\tmol.addBond(atom, a2, 1);\n\t\tthis.output.mol = mol;\n\t}\n\n\tpublic execBondInsert():void\n\t{\n\t\tlet mol = this.input.mol, bond = this.input.currentBond;\n\n\t\tif (bond == 0)\n\t\t{\n\t\t\tthis.errmsg = 'There must be a current bond.';\n\t\t\treturn;\n\t\t}\n\t\tif (mol.bondInRing(bond))\n\t\t{\n\t\t\tthis.errmsg = 'Cannot insert into a ring-bond.';\n\t\t\treturn;\n\t\t}\n\n\t\tlet [alink, _, side] = this.mobileSide(bond);\n\n\t\tmol = mol.clone();\n\t\tmol.setBondOrder(bond, 1);\n\n\t\tlet fragmask = Vec.booleanArray(false, mol.numAtoms);\n\t\tfor (let a of side) fragmask[a - 1] = true;\n\t\tlet frag = MolUtil.subgraphWithAttachments(mol, fragmask);\n\n\t\tfor (let n = mol.numAtoms; n >= 1; n--) if (fragmask[n - 1] && n != alink)\n\t\t{\n\t\t\tmol.deleteAtomAndBonds(n);\n\t\t\tif (n < alink) alink -= 1;\n\t\t}\n\n\t\tmol.setAtomElement(alink, 'C');\n\t\tmol.setAtomCharge(alink, 0);\n\t\tmol.setAtomUnpaired(alink, 0);\n\t\tmol.setAtomHExplicit(alink, Molecule.HEXPLICIT_UNKNOWN);\n\t\tmol.setAtomIsotope(alink, Molecule.ISOTOPE_NATURAL);\n\t\tmol.setAtomMapNum(alink, 0);\n\t\tmol.setAtomExtra(alink, []);\n\t\tmol.setAtomTransient(alink, []);\n\n\t\tlet fusion = new TemplateFusion(mol, frag, '');\n\t\tfusion.withGuideOnly = true;\n\t\tfusion.permuteAtom(alink);\n\t\tif (fusion.perms.length == 0)\n\t\t{\n\t\t\tthis.errmsg = 'Unable to insert.'; // should be rare (?)\n\t\t\treturn;\n\t\t}\n\t\tthis.output.mol = fusion.perms[0].mol;\n\t\tthis.zapSubject();\n\t\tthis.output.currentAtom = alink;\n\t}\n\n\tpublic execJoin():void\n\t{\n\t\tif (!this.requireSubject()) return;\n\n\t\tthis.output.mol = SketchUtil.joinOverlappingAtoms(this.input.mol, this.subjectMask);\n\n\t\tif (this.output.mol == null)\n\t\t{\n\t\t\tthis.errmsg = 'Subject contains no overlapping atoms.';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.zapSubject();\n\t\t}\n\t}\n\n\tpublic execNudge(dir:string, extent:number):void\n\t{\n\t\tif (!this.requireSubject()) return;\n\n\t\tlet dx = extent * (dir == 'left' ? -1 : dir == 'right' ? 1 : 0);\n\t\tlet dy = extent * (dir == 'down' ? -1 : dir == 'up' ? 1 : 0);\n\n\t\tthis.output.mol = this.input.mol.clone();\n\t\tfor (let n = 0; n < this.subjectLength; n++)\n\t\t{\n\t\t\tlet x = this.output.mol.atomX(this.subjectIndex[n]), y = this.output.mol.atomY(this.subjectIndex[n]);\n\t\t\tthis.output.mol.setAtomPos(this.subjectIndex[n], x + dx, y + dy);\n\t\t}\n\t}\n\n\tpublic execNudgeFar(dir:string):void\n\t{\n\t\tif (!this.requireSubject()) return;\n\t\tif (this.subjectLength == this.input.mol.numAtoms)\n\t\t{\n\t\t\tthis.errmsg = 'Cannot apply to entire molecule.';\n\t\t\treturn;\n\t\t}\n\n\t\tlet dx = dir == 'left' ? -1 : dir == 'right' ? 1 : 0;\n\t\tlet dy = dir == 'down' ? -1 : dir == 'up' ? 1 : 0;\n\n\t\tthis.output.mol = SketchUtil.moveToEdge(this.input.mol, this.subjectMask, dx, dy);\n\t\tif (this.output.mol == null)\n\t\t{\n\t\t\tthis.execNudge(dir, 1); // convert it to a nudge-lots operation\n\t\t}\n\t}\n\n\tpublic execFlip(axis:string):void\n\t{\n\t\tif (this.input.mol.numAtoms < 2)\n\t\t{\n\t\t\tthis.errmsg = 'At least 2 atoms are required.';\n\t\t\treturn;\n\t\t}\n\t\tlet isVertical = axis == 'ver'; // else 'hor'\n\n\t\t// decide where the centre of gravity is, and which atoms are to be affected\n\t\tlet cx = 0, cy = 0;\n\t\tlet mask = this.subjectMask, mol = this.input.mol;\n\t\tif (this.input.currentAtom > 0)\n\t\t{\n\t\t\tcx = mol.atomX(this.input.currentAtom);\n\t\t\tcy = mol.atomY(this.input.currentAtom);\n\t\t\tif (!this.hasSelected)\n\t\t\t{\n\t\t\t\tmask = Vec.booleanArray(false, mol.numAtoms);\n\t\t\t\tlet cc = mol.atomConnComp(this.input.currentAtom);\n\t\t\t\tfor (let n = 1; n <= mol.numAtoms; n++) mask[n - 1] = mol.atomConnComp(n) == cc;\n\t\t\t}\n\t\t}\n\t\telse if (this.input.currentBond > 0)\n\t\t{\n\t\t\tlet bfr = mol.bondFrom(this.input.currentBond), bto = mol.bondTo(this.input.currentBond);\n\t\t\tcx = 0.5 * (mol.atomX(bfr) + mol.atomX(bto));\n\t\t\tcy = 0.5 * (mol.atomY(bfr) + mol.atomY(bto));\n\t\t\tif (!this.hasSelected)\n\t\t\t{\n\t\t\t\tmask = Vec.booleanArray(false, mol.numAtoms);\n\t\t\t\tlet cc = mol.atomConnComp(bfr);\n\t\t\t\tfor (let n = 1; n <= mol.numAtoms; n++) mask[n - 1] = mol.atomConnComp(n) == cc;\n\t\t\t}\n\t\t}\n\t\telse if (this.subjectLength == 0)\n\t\t{\n\t\t\tlet box = mol.boundary();\n\t\t\tcx = 0.5 * (box.minX() + box.maxX());\n\t\t\tcy = 0.5 * (box.minY() + box.maxY());\n\t\t\tmask = Vec.booleanArray(true, mol.numAtoms);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (let n = 0; n < this.subjectLength; n++)\n\t\t\t{\n\t\t\t\tcx += mol.atomX(this.subjectIndex[n]);\n\t\t\t\tcy += mol.atomY(this.subjectIndex[n]);\n\t\t\t}\n\t\t\tlet invSz = 1.0 / this.subjectLength;\n\t\t\tcx *= invSz;\n\t\t\tcy *= invSz;\n\t\t}\n\n\t\t// perform the flip\n\t\tthis.output.mol = mol.clone();\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (mask[n - 1])\n\t\t{\n\t\t\tif (!isVertical)\n\t\t\t\tthis.output.mol.setAtomX(n, 2 * cx - this.output.mol.atomX(n));\n\t\t\telse\n\t\t\t\tthis.output.mol.setAtomY(n, 2 * cy - this.output.mol.atomY(n));\n\t\t}\n\t}\n\n\tpublic execScale(mag:number):void\n\t{\n\t\tconst {mol, currentAtom, currentBond} = this.input;\n\n\t\tif (mol.numAtoms < 2)\n\t\t{\n\t\t\tthis.errmsg = 'At least 2 atoms are required.';\n\t\t\treturn;\n\t\t}\n\n\t\t// special case: a current atom is surrounded by one or more selected atoms - shift them based on what residual component they\n\t\t// belong to; useful also for multidentate ligands\n\t\tif (currentAtom > 0)\n\t\t{\n\t\t\tlet connAtoms:number[] = [];\n\t\t\tfor (let a of this.subjectIndex) if (a != currentAtom && mol.findBond(currentAtom, a) > 0) connAtoms.push(a);\n\t\t\tlet g = Graph.fromMolecule(mol);\n\t\t\tg.isolateNode(currentAtom - 1);\n\n\t\t\tlet anything = false;\n\t\t\tfor (let cc of g.calculateComponentGroups())\n\t\t\t{\n\t\t\t\tVec.addTo(cc, 1);\n\t\t\t\tlet sz = 0, dx = 0, dy = 0;\n\t\t\t\tfor (let a of cc) if (connAtoms.includes(a))\n\t\t\t\t{\n\t\t\t\t\tdx += mol.atomX(a) - mol.atomX(currentAtom);\n\t\t\t\t\tdy += mol.atomY(a) - mol.atomY(currentAtom);\n\t\t\t\t\tsz++;\n\t\t\t\t}\n\t\t\t\tif (sz == 0) continue;\n\n\t\t\t\t[dx, dy] = [dx / sz, dy / sz];\n\t\t\t\tif (Math.abs(dx) < 0.1 && Math.abs(dy) < 0.1) continue;\n\t\t\t\t[dx, dy] = [dx * (mag - 1), dy * (mag - 1)];\n\n\t\t\t\tif (!this.output.mol) this.output.mol = mol.clone();\n\t\t\t\tfor (let a of cc) this.output.mol.setAtomPos(a, this.output.mol.atomX(a) + dx, this.output.mol.atomY(a) + dy);\n\n\t\t\t\tanything = true;\n\t\t\t}\n\t\t\tif (anything) return;\n\t\t}\n\n\t\t// special case: subject indicates a non-ring bond, so magnify the bond distance, and shift the component of one/both sides\n\t\tlet b:number;\n\t\tif (this.subjectLength == 2 && (b = mol.findBond(this.subjectIndex[0], this.subjectIndex[1])) > 0 && !mol.bondInRing(b))\n\t\t{\n\t\t\tlet a1 = this.subjectIndex[0], a2 = this.subjectIndex[1];\n\t\t\tlet ccmol = mol.clone();\n\t\t\tccmol.deleteBond(b);\n\t\t\tlet idx1:number[] = [], idx2:number[] = [];\n\t\t\tfor (let n = 1; n <= ccmol.numAtoms; n++)\n\t\t\t{\n\t\t\t\tif (ccmol.atomConnComp(n) == ccmol.atomConnComp(a1)) idx1.push(n);\n\t\t\t\telse if (ccmol.atomConnComp(n) == ccmol.atomConnComp(a2)) idx2.push(n);\n\t\t\t}\n\t\t\tlet dx = (mol.atomX(a2) - mol.atomX(a1)) * (mag - 1);\n\t\t\tlet dy = (mol.atomY(a2) - mol.atomY(a1)) * (mag - 1);\n\t\t\tif (idx1.length == idx2.length) {dx *= 0.5; dy *= 0.5;}\n\n\t\t\tthis.output.mol = mol.clone();\n\n\t\t\tif (idx1.length <= idx2.length) for (let n = 0; n < idx1.length; n++)\n\t\t\t{\n\t\t\t\tlet a = idx1[n];\n\t\t\t\tthis.output.mol.setAtomPos(a, this.output.mol.atomX(a) - dx, this.output.mol.atomY(a) - dy);\n\t\t\t}\n\t\t\tif (idx2.length <= idx1.length) for (let n = 0; n < idx2.length; n++)\n\t\t\t{\n\t\t\t\tlet a = idx2[n];\n\t\t\t\tthis.output.mol.setAtomPos(a, this.output.mol.atomX(a) + dx, this.output.mol.atomY(a) + dy);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\t// scale about centre of gravity\n\t\tlet cx = 0, cy = 0;\n\t\tif (currentAtom > 0)\n\t\t{\n\t\t\tcx = mol.atomX(currentAtom);\n\t\t\tcy = mol.atomY(currentAtom);\n\t\t}\n\t\telse if (currentBond > 0)\n\t\t{\n\t\t\tlet bfr = mol.bondFrom(currentBond), bto = mol.bondTo(currentBond);\n\t\t\tcx = 0.5 * (mol.atomX(bfr) + mol.atomX(bto));\n\t\t\tcy = 0.5 * (mol.atomY(bfr) + mol.atomY(bto));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (let n = 0; n < this.subjectLength; n++)\n\t\t\t{\n\t\t\t\tcx += mol.atomX(this.subjectIndex[n]);\n\t\t\t\tcy += mol.atomY(this.subjectIndex[n]);\n\t\t\t}\n\t\t\tlet invSz = 1.0 / this.subjectLength;\n\t\t\tcx *= invSz;\n\t\t\tcy *= invSz;\n\t\t}\n\n\t\tthis.output.mol = mol.clone();\n\t\tfor (let n = 0; n < this.subjectLength; n++)\n\t\t{\n\t\t\tlet x = this.output.mol.atomX(this.subjectIndex[n]);\n\t\t\tlet y = this.output.mol.atomY(this.subjectIndex[n]);\n\t\t\tthis.output.mol.setAtomPos(this.subjectIndex[n], (x - cx) * mag + cx, (y - cy) * mag + cy);\n\t\t}\n\t}\n\n\tpublic execRotate(theta:number, centreX:number, centreY:number):void\n\t{\n\t\ttheta *= DEGRAD; // (parameter is in degrees)\n\n\t\tlet mol = this.input.mol;\n\n\t\t// if a centre position is indicated, use that\n\t\tif (centreX != null && centreY != null)\n\t\t{\n\t\t\tthis.output.mol = mol.clone();\n\t\t\tlet mask = this.subjectLength == 0 ? Vec.booleanArray(true, mol.numAtoms) : this.subjectMask;\n\t\t\tCoordUtil.rotateAtoms(this.output.mol, mask, centreX, centreY, theta);\n\t\t\treturn;\n\t\t}\n\n\t\tif (mol.numAtoms < 2)\n\t\t{\n\t\t\tthis.errmsg = 'At least 2 atoms are required.';\n\t\t\treturn;\n\t\t}\n\n\t\t// decide where the centre of gravity is, and which atoms are to be affected\n\t\tlet cx = 0, cy = 0;\n\t\tlet mask = this.subjectMask;\n\t\tif (this.input.currentAtom > 0)\n\t\t{\n\t\t\tcx = mol.atomX(this.input.currentAtom);\n\t\t\tcy = mol.atomY(this.input.currentAtom);\n\t\t\tif (!this.hasSelected)\n\t\t\t{\n\t\t\t\tmask = Vec.booleanArray(false, mol.numAtoms);\n\t\t\t\tlet cc = mol.atomConnComp(this.input.currentAtom);\n\t\t\t\tfor (let n = 1; n <= mol.numAtoms; n++) mask[n - 1] = mol.atomConnComp(n) == cc;\n\t\t\t}\n\n\t\t\tif (Vec.maskCount(mask) == 1 && mask[this.input.currentAtom - 1])\n\t\t\t{\n\t\t\t\tthis.errmsg = 'Component is isolated.';\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\telse if (this.input.currentBond > 0)\n\t\t{\n\t\t\tlet bfr = mol.bondFrom(this.input.currentBond), bto = mol.bondTo(this.input.currentBond);\n\t\t\tcx = 0.5 * (mol.atomX(bfr) + mol.atomX(bto));\n\t\t\tcy = 0.5 * (mol.atomY(bfr) + mol.atomY(bto));\n\t\t\tif (!this.hasSelected)\n\t\t\t{\n\t\t\t\tmask = Vec.booleanArray(false, mol.numAtoms);\n\t\t\t\tlet cc = mol.atomConnComp(bfr);\n\t\t\t\tfor (let n = 1; n <= mol.numAtoms; n++) mask[n - 1] = mol.atomConnComp(n) == cc;\n\t\t\t}\n\t\t}\n\t\telse if (this.subjectLength == 0)\n\t\t{\n\t\t\tlet box = mol.boundary();\n\t\t\tcx = 0.5 * (box.minX() + box.maxX());\n\t\t\tcy = 0.5 * (box.minY() + box.maxY());\n\t\t\tmask = Vec.booleanArray(true, mol.numAtoms);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.subjectLength == 1)\n\t\t\t{\n\t\t\t\tthis.errmsg = 'Component is isolated.';\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfor (let n = 0; n < this.subjectLength; n++)\n\t\t\t{\n\t\t\t\tcx += mol.atomX(this.subjectIndex[n]);\n\t\t\t\tcy += mol.atomY(this.subjectIndex[n]);\n\t\t\t}\n\t\t\tlet invSz = 1.0 / this.subjectLength;\n\t\t\tcx *= invSz;\n\t\t\tcy *= invSz;\n\t\t}\n\n\t\t// perform the rotation\n\t\tthis.output.mol = mol.clone();\n\t\tCoordUtil.rotateAtoms(this.output.mol, mask, cx, cy, theta);\n\t}\n\n\tpublic execBondDist(dist:number):void\n\t{\n\t\tlet bond = this.input.currentBond;\n\t\tif (bond == 0)\n\t\t{\n\t\t\tthis.errmsg = 'There must be a current bond.';\n\t\t\treturn;\n\t\t}\n\n\t\tlet mol = this.input.mol.clone();\n\n\t\tif (mol.bondInRing(bond))\n\t\t{\n\t\t\tlet atom1 = mol.bondFrom(bond), atom2 = mol.bondTo(bond);\n\t\t\tlet dx = mol.atomX(atom2) - mol.atomX(atom1), dy = mol.atomY(atom2) - mol.atomY(atom1), curDist = norm_xy(dx, dy), inv = 1.0 / curDist;\n\t\t\tlet sel1 = this.isSelected(atom1), sel2 = this.isSelected(atom2);\n\t\t\tlet ox = dx * (dist - curDist) * inv, oy = dy * (dist - curDist) * inv;\n\t\t\tif (sel1 && !sel2)\n\t\t\t{\n\t\t\t\tmol.setAtomPos(atom1, mol.atomX(atom1) - ox, mol.atomY(atom1) - oy);\n\t\t\t}\n\t\t\telse if (sel2 && !sel1)\n\t\t\t{\n\t\t\t\tmol.setAtomPos(atom2, mol.atomX(atom2) + ox, mol.atomY(atom2) + oy);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmol.setAtomPos(atom1, mol.atomX(atom1) - 0.5 * ox, mol.atomY(atom1) - 0.5 * oy);\n\t\t\t\tmol.setAtomPos(atom2, mol.atomX(atom2) + 0.5 * ox, mol.atomY(atom2) + 0.5 * oy);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet [atom1, atom2, side] = this.mobileSide(bond);\n\t\t\tlet dx = mol.atomX(atom2) - mol.atomX(atom1), dy = mol.atomY(atom2) - mol.atomY(atom1);\n\t\t\tlet curDist = norm_xy(dx, dy), inv = 1.0 / curDist;\n\t\t\tlet ox = dx * (dist - curDist) * inv, oy = dy * (dist - curDist) * inv;\n\t\t\tfor (let a of side) mol.setAtomPos(a, mol.atomX(a) - ox, mol.atomY(a) - oy);\n\t\t}\n\n\t\tthis.output.mol = mol;\n\t}\n\n\tpublic execAlignAngle(angle:number):void\n\t{\n\t\tlet bond = this.input.currentBond;\n\t\tif (bond == 0)\n\t\t{\n\t\t\tthis.errmsg = 'There must be a current bond.';\n\t\t\treturn;\n\t\t}\n\n\t\tlet mol = this.input.mol.clone();\n\n\t\tif (mol.bondInRing(bond))\n\t\t{\n\t\t\tthis.errmsg = 'Cannot align a ring-bond.';\n\t\t\treturn;\n\t\t}\n\n\t\tlet [atom1, atom2, side] = this.mobileSide(bond);\n\t\tlet cx = mol.atomX(atom2), cy = mol.atomY(atom2);\n\t\tlet delta = angle - Math.atan2(mol.atomY(atom1) - cy, mol.atomX(atom1) - cx);\n\t\tlet cosTheta = Math.cos(delta), sinTheta = Math.sin(delta);\n\n\t\tfor (let a of side)\n\t\t{\n\t\t\tlet x = mol.atomX(a) - cx, y = mol.atomY(a) - cy;\n\t\t\tmol.setAtomPos(a, cx + x * cosTheta - y * sinTheta, cy + x * sinTheta + y * cosTheta);\n\t\t}\n\n\t\tthis.output.mol = mol;\n\t}\n\n\tpublic execAlignRegular():void\n\t{\n\t\tlet bond = this.input.currentBond;\n\t\tif (bond == 0)\n\t\t{\n\t\t\tthis.errmsg = 'There must be a current bond.';\n\t\t\treturn;\n\t\t}\n\n\t\tlet mol = this.input.mol.clone();\n\t\tlet bfr = mol.bondFrom(this.input.currentBond), bto = mol.bondTo(this.input.currentBond);\n\t\tlet theta = Math.atan2(mol.atomY(bto) - mol.atomY(bfr), mol.atomX(bto) - mol.atomX(bfr)) * RADDEG;\n\t\tif (theta < 0) theta += 360;\n\n\t\tlet snap = Math.round(theta / 30) * 30;\n\t\tif (Math.abs(theta - snap) < 0.001) return; // no change\n\t\tlet delta = (snap - theta) * DEGRAD;\n\n\t\tlet mask = this.input.selectedMask;\n\t\tif (Vec.allFalse(mask))\n\t\t{\n\t\t\tlet cc = mol.atomConnComp(bfr);\n\t\t\tfor (let n = 1; n <= mol.numAtoms; n++) mask[n - 1] = cc == mol.atomConnComp(n);\n\t\t}\n\n\t\tlet cx = 0.5 * (mol.atomX(bfr) + mol.atomX(bto)), cy = 0.5 * (mol.atomY(bfr) + mol.atomY(bto));\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (mask[n - 1])\n\t\t{\n\t\t\tlet dx = mol.atomX(n) - cx, dy = mol.atomY(n) - cy;\n\t\t\tlet th = Math.atan2(dy, dx) + delta, dist = norm_xy(dx, dy);\n\t\t\tmol.setAtomPos(n, cx + dist * Math.cos(th), cy + dist * Math.sin(th));\n\t\t}\n\n\t\tthis.output.mol = mol;\n\t}\n\n\tpublic execAdjustTorsion(angle:number):void\n\t{\n\t\t// NOTE: input definition is a awkward; selected = 3 atoms that make up the torsion (A1-A2-A3); current be set to A1, and defines\n\t\t// (A1,A2) such that the angle is A3-A1; these is necessary because the user could be referring to either the acute or obtuse angle;\n\t\t// note that the special case where the 3 atoms are all in the same ring uses the order of selected atoms as a hint, which breaks the\n\t\t// input convention\n\n\t\tif (this.input.currentAtom == 0 || Vec.maskCount(this.input.selectedMask) != 3)\n\t\t{\n\t\t\tthis.errmsg = 'Must be 3 selected atoms and a current atom.';\n\t\t\treturn;\n\t\t}\n\n\t\tlet mol = this.input.mol.clone();\n\n\t\tlet a1 = this.input.currentAtom;\n\t\tlet atoms:number[] = [];\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (n != a1 && this.input.selectedMask[n - 1]) atoms.push(n);\n\t\tlet a2 = mol.findBond(a1, atoms[0]) > 0 ? atoms.shift() :\n\t\t\t\t mol.findBond(a1, atoms[1]) > 0 ? atoms.pop() : 0;\n\t\tif (a2 == 0 || mol.findBond(a2, atoms[0]) == 0)\n\t\t{\n\t\t\tthis.errmsg = 'Selected atoms must be consecutive.';\n\t\t\treturn;\n\t\t}\n\t\tlet a3 = atoms[0];\n\n\t\tlet cx = mol.atomX(a2), cy = mol.atomY(a2);\n\t\tlet theta1 = Math.atan2(mol.atomY(a1) - cy, mol.atomX(a1) - cx);\n\t\tlet theta3 = Math.atan2(mol.atomY(a3) - cy, mol.atomX(a3) - cx);\n\t\tlet delta = angle - angleDiff(theta3, theta1);\n\n\t\tlet group1:number[] = [], group3:number[] = [];\n\t\tif (mol.atomRingBlock(a1) == 0 || mol.atomRingBlock(a1) != mol.atomRingBlock(a3))\n\t\t{\n\t\t\tlet g = Graph.fromMolecule(mol);\n\t\t\tg.removeEdge(a2 - 1, a1 - 1);\n\t\t\tg.removeEdge(a2 - 1, a3 - 1);\n\t\t\tlet cc = g.calculateComponents();\n\t\t\tfor (let n = 0; n < g.numNodes; n++)\n\t\t\t{\n\t\t\t\tif (cc[n] == cc[a1 - 1]) group1.push(n + 1);\n\t\t\t\telse if (cc[n] == cc[a3 - 1]) group3.push(n + 1);\n\t\t\t}\n\t\t}\n\t\tif (mol.atomRingBlock(a1) > 0 && mol.atomRingBlock(a1) == mol.atomRingBlock(a2)) group1 = [a1];\n\t\tif (mol.atomRingBlock(a3) > 0 && mol.atomRingBlock(a3) == mol.atomRingBlock(a2)) group3 = [a3];\n\n\t\tCoordUtil.rotateAtoms(mol, Vec.idxMask(Vec.add(group1, -1), mol.numAtoms), cx, cy, -0.5 * delta);\n\t\tCoordUtil.rotateAtoms(mol, Vec.idxMask(Vec.add(group3, -1), mol.numAtoms), cx, cy, 0.5 * delta);\n\n\t\tthis.output.mol = mol;\n\t}\n\n\tpublic execMove(refAtom:number, deltaX:number, deltaY:number):void\n\t{\n\t\tlet subj = this.subjectIndex;\n\t\tif (Vec.len(subj) == 0)\n\t\t{\n\t\t\tif (refAtom == 0) return;\n\t\t\tsubj = [refAtom];\n\t\t}\n\n\t\tthis.output.mol = this.input.mol.clone();\n\t\tfor (let a of subj) this.output.mol.setAtomPos(a, this.output.mol.atomX(a) + deltaX, this.output.mol.atomY(a) + deltaY);\n\t}\n\n\tpublic execRing(ringX:number[], ringY:number[], aromatic:boolean):void\n\t{\n\t\tlet rsz = ringX.length;\n\t\tlet atoms = Vec.numberArray(0, rsz), bonds = Vec.numberArray(0, rsz);\n\n\t\tlet outmol = this.input.mol.clone();\n\t\tfor (let n = 0; n < rsz; n++)\n\t\t{\n\t\t\tatoms[n] = CoordUtil.atomAtPoint(outmol, ringX[n], ringY[n]);\n\t\t\tif (atoms[n] == 0) atoms[n] = outmol.addAtom('C', ringX[n], ringY[n]);\n\t\t}\n\t\tfor (let n = 0; n < rsz; n++)\n\t\t{\n\t\t\tlet nn = n < rsz - 1 ? n + 1 : 0;\n\t\t\tbonds[n] = outmol.findBond(atoms[n], atoms[nn]);\n\t\t\tif (bonds[n] == 0) bonds[n] = outmol.addBond(atoms[n], atoms[nn], 1);\n\t\t}\n\n\t\t// if aromaticity is desired, do an extremely crude Kekulisation\n\t\tif (aromatic)\n\t\t{\n\t\t\tlet valence = Vec.numberArray(0, rsz);\n\t\t\tlet pi = Vec.booleanArray(false, rsz);\n\t\t\tfor (let n = 0; n < rsz; n++)\n\t\t\t{\n\t\t\t\tvalence[n] = Chemistry.ELEMENT_BONDING[outmol.atomicNumber(atoms[n])] + outmol.atomCharge(atoms[n]);\n\t\t\t\tif (outmol.atomHExplicit(atoms[n]) != Molecule.HEXPLICIT_UNKNOWN) valence[n] -= outmol.atomHExplicit(atoms[n]);\n\t\t\t\tfor (let b of outmol.atomAdjBonds(atoms[n])) valence[n] -= outmol.bondOrder(b);\n\t\t\t\tif (outmol.bondOrder(bonds[n]) >= 2)\n\t\t\t\t{\n\t\t\t\t\tpi[n] = true;\n\t\t\t\t\tif (n < rsz - 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tpi[n] = true;\n\t\t\t\t\t\tn++;\n\t\t\t\t\t}\n\t\t\t\t\telse pi[0] = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (let n = 0; n < rsz; n++)\n\t\t\t{\n\t\t\t\tlet nn = n < rsz - 1 ? n + 1 : 0;\n\t\t\t\tif (pi[n] || pi[nn]) continue;\n\n\t\t\t\tif (valence[n] > 0 && valence[nn] > 0)\n\t\t\t\t{\n\t\t\t\t\toutmol.setBondOrder(bonds[n], 2);\n\t\t\t\t\tpi[n] = true;\n\t\t\t\t\tpi[nn] = true;\n\t\t\t\t\tvalence[n]--;\n\t\t\t\t\tvalence[nn]--;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.output.mol = outmol;\n\t}\n\n\tpublic execTemplateFusion(frag:Molecule):void\n\t{\n\t\tlet mol = this.input.mol;\n\t\tlet fusion = new TemplateFusion(mol, frag, '');\n\t\tif (this.subjectLength == 0) fusion.permuteNone();\n\t\telse if (this.subjectLength == 1) fusion.permuteAtom(this.subjectIndex[0]);\n\t\telse if (this.subjectLength == 2 && mol.findBond(this.subjectIndex[0], this.subjectIndex[1]) > 0)\n\t\t\tfusion.permuteBond(this.subjectIndex[0], this.subjectIndex[1]);\n\t\telse fusion.permuteMulti(this.subjectIndex);\n\n\t\t// package up the results\n\t\tlet permutations:any[] = [];\n\t\tfor (let perm of fusion.perms)\n\t\t{\n\t\t\tlet obj:Record<string, any> = {};\n\t\t\tobj['mol'] = perm.mol.toString();\n\t\t\tobj['display'] = perm.display.toString();\n\t\t\tobj['molidx'] = perm.molidx;\n\t\t\tobj['temidx'] = perm.temidx;\n\t\t\tobj['srcidx'] = perm.srcidx;\n\t\t\tpermutations.push(obj);\n\t\t}\n\t\tthis.output.permutations = permutations;\n\t}\n\n\tpublic execAbbrevTempl():void\n\t{\n\t\t/*\n\t\t// note: 'fusion' needs to ensure that permutation 0 is the one to use\n\t\tlet perm = fusion.getPerm(0)\n\t\tlet fused = perm.mol\n\t\tvar srcidx = perm.srcidx\n\n\t\t// consider the possibility that we might be wanting to convert a terminal atom directly into an abbreviation\n\t\tlet midx = perm.midx\n\t\tlet markback = (!perm.bridged && !perm.guided && midx.count == 1 && instate.mol.atomAdjCount(midx[0]) == 1)\n\t\t\t\t\t|| (perm.guided && midx.count == 1 && fusion.numAttach == 2)\n\t\tif markback\n\t\t{\n\t\t\tlet i = indexOf(midx[0], srcidx)\n\t\t\tif i >= 0 {srcidx[i] = 0} // mark it part of the graft-on, not the original\n\t\t}\n\n\t\t// see if it really can be done\n\t\tvar srcmask = boolArray(false, srcidx.count)\n\t\tfor n in 0 ..< srcidx.count {srcmask[n] = srcidx[n] > 0}\n\t\tlet mol = MolUtil.convertToAbbrev(fused, srcmask:srcmask, abbrevName:fusion.abbrev)\n\t\tif mol == nil\n\t\t{\n\t\t\tmessage = \"Inline abbreviations must be terminal with exactly one attachment point.\";\n\t\t\treturn false\n\t\t}\n\n\t\tif !doCommit {return true}\n\n\t\tzapSubject()\n\t\toutstate.mol = mol!\n\t\toutstate.currentAtom = mol!.numAtoms\n\n\t\treturn true\n*/\n\t}\n\n\tpublic execAbbrevGroup():void\n\t{\n\t\tif (!this.requireSubject()) return;\n\t\tif (!this.checkAbbreviationReady()) return;\n\n\t\tlet mol = MolUtil.convertToAbbrev(this.input.mol, Vec.notMask(this.subjectMask), '?');\n\t\tif (mol == null)\n\t\t{\n\t\t\t// (probably already filtered out from above)\n\t\t\tthis.errmsg = 'Inline abbreviations must be terminal with exactly one attachment point.';\n\t\t\treturn;\n\t\t}\n\t\tif (AbbrevContainer.main)\n\t\t{\n\t\t\tAbbrevContainer.main.submitMolecule(mol, true);\n\t\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (mol.atomElement(n) == '?' && MolUtil.hasAbbrev(mol, n)) AbbrevContainer.main.substituteAbbrevName(mol, n);\n\t\t}\n\n\t\tthis.output.mol = mol;\n\t\tthis.zapSubject();\n\t\tthis.output.currentAtom = mol.numAtoms;\n\t}\n\n\tpublic execAbbrevFormula():void\n\t{\n\t\tif (!this.requireSubject()) return;\n\t\tif (!this.checkAbbreviationReady()) return;\n\n\t\tlet fixed = this.input.mol.clone();\n\t\tfor (let n = 1; n <= fixed.numAtoms; n++) fixed.setAtomHExplicit(n, fixed.atomHydrogens(n));\n\t\tlet abv = MolUtil.subgraphMask(fixed, this.subjectMask);\n\t\tlet formula = MolUtil.molecularFormula(abv, true);\n\n\t\tlet mol = MolUtil.convertToAbbrev(this.input.mol, Vec.notMask(this.subjectMask), formula);\n\t\tif (mol == null)\n\t\t{\n\t\t\t// (probably already filtered out from above)\n\t\t\tthis.errmsg = 'Inline abbreviations must be terminal with exactly one attachment point.';\n\t\t\treturn;\n\t\t}\n\n\t\tthis.output.mol = mol;\n\t\tthis.zapSubject();\n\t\tthis.output.currentAtom = mol.numAtoms;\n\t}\n\n\tpublic execAbbrevClear():void\n\t{\n\t\tlet idx:number[] = [];\n\t\tfor (let n of this.subjectIndex) if (MolUtil.hasAbbrev(this.input.mol, n)) idx.push(n);\n\n\t\tif (idx.length == 0)\n\t\t{\n\t\t\tthis.errmsg = 'No abbreviations to clear.';\n\t\t\treturn;\n\t\t}\n\n\t\tlet mol = this.input.mol.clone();\n\t\tfor (let n of idx) MolUtil.clearAbbrev(mol, n);\n\t\tthis.output.mol = mol;\n\t}\n\n\tpublic execAbbrevExpand():void\n\t{\n\t\tlet idx:number[] = [];\n\t\tfor (let n of this.subjectIndex) if (MolUtil.hasAbbrev(this.input.mol, n)) idx.push(n);\n\n\t\tif (idx.length == 0)\n\t\t{\n\t\t\tthis.errmsg = 'No abbreviations to expand.';\n\t\t\treturn;\n\t\t}\n\n\t\tlet mol = this.input.mol.clone();\n\t\tfor (let n of idx) MolUtil.expandOneAbbrev(mol, n, true);\n\t\tthis.output.mol = mol;\n\t\tthis.zapSubject();\n\t}\n\n\tpublic execBondArtifact(activity:ActivityType):void\n\t{\n\t\tif (!this.requireAtoms() || !this.requireSubject()) return;\n\n\t\tlet artif = new BondArtifact(this.input.mol.clone());\n\t\tlet subject = this.subjectIndex.slice(0), curAtom = this.input.currentAtom;\n\t\tif (curAtom > 0 && subject.indexOf(curAtom) < 0) subject.push(curAtom);\n\n\t\tif (activity == ActivityType.BondArtifactPath)\n\t\t{\n\t\t\tif (!artif.createPath(subject)) {this.errmsg = 'Path artifact not suitable.'; return;}\n\t\t}\n\t\telse if (activity == ActivityType.BondArtifactRing)\n\t\t{\n\t\t\tif (!artif.createRing(subject)) {this.errmsg = 'Ring artifact not suitable.'; return;}\n\t\t}\n\t\telse if (activity == ActivityType.BondArtifactArene)\n\t\t{\n\t\t\tif (!artif.createArene(subject)) {this.errmsg = 'Arene artifact not suitable.'; return;}\n\t\t}\n\t\telse if (activity == ActivityType.BondArtifactClear)\n\t\t{\n\t\t\tif (!artif.removeArtifact(subject))\n\t\t\t{\n\t\t\t\tif (this.removePolymerBlock(subject)) return;\n\n\t\t\t\tthis.errmsg = 'No artifact removed.';\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tartif.rewriteMolecule();\n\t\tthis.output.mol = artif.mol;\n\t}\n\n\tpublic execPolymerBlock():void\n\t{\n\t\tif (!this.requireAtoms() || !this.requireSubject()) return;\n\t\tif (this.owner) this.owner.performPolymerBlock(this.subjectIndex);\n\t}\n\n\tpublic execAddHydrogens():void\n\t{\n\t\tlet mol = this.input.mol.clone();\n\n\t\tif (!this.requireAtoms()) return;\n\t\tlet atoms = this.subjectIndex;\n\t\tif (atoms.length == 0) atoms = Vec.identity1(mol.numAtoms);\n\n\t\tfor (let a of atoms)\n\t\t{\n\t\t\tlet hc = mol.atomHydrogens(a);\n\t\t\tif (hc > 0) SketchUtil.placeAdditionalHydrogens(mol, a, hc);\n\t\t}\n\n\t\tif (mol.numAtoms == this.input.mol.numAtoms)\n\t\t{\n\t\t\tthis.errmsg = 'Nothing needs to be added.';\n\t\t\treturn;\n\t\t}\n\n\t\tthis.output.mol = mol;\n\t}\n\n\tpublic execRemoveHydrogens():void\n\t{\n\t\tif (!this.requireAtoms()) return;\n\n\t\tlet mol = this.input.mol;\n\n\t\tlet selmask = this.subjectMask;\n\t\tif (Vec.allFalse(selmask)) selmask = Vec.booleanArray(true, mol.numAtoms);\n\t\tlet keepmask = Vec.booleanArray(true, mol.numAtoms);\n\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (MolUtil.boringHydrogen(mol, n))\n\t\t{\n\t\t\tlet nbr = mol.atomAdjList(n)[0];\n\t\t\tif (selmask[n - 1] || selmask[nbr - 1]) keepmask[n - 1] = false;\n\t\t}\n\n\t\tif (Vec.allTrue(keepmask))\n\t\t{\n\t\t\tthis.errmsg = 'Nothing to be deleted.';\n\t\t\treturn;\n\t\t}\n\n\t\tthis.output.mol = MolUtil.subgraphMask(mol, keepmask);\n\t}\n\n\tpublic execQueryClear():void\n\t{\n\t\tif (!this.requireSubject()) return;\n\n\t\tlet mol = this.input.mol.clone();\n\n\t\tconst {currentBond} = this.input;\n\t\tif (currentBond > 0 && QueryUtil.hasAnyQueryBond(mol, currentBond))\n\t\t{\n\t\t\tQueryUtil.deleteQueryBondAll(mol, currentBond);\n\t\t\tthis.output.mol = mol;\n\t\t\treturn;\n\t\t}\n\n\t\tlet anything = false;\n\t\tfor (let a of this.subjectIndex) if (QueryUtil.hasAnyQueryAtom(mol, a))\n\t\t{\n\t\t\tQueryUtil.deleteQueryAtomAll(mol, a);\n\t\t\tanything = true;\n\t\t}\n\t\tfor (let b = 1; b <= mol.numBonds; b++) if (this.subjectMask[mol.bondFrom(b) - 1] && this.subjectMask[mol.bondTo(b) - 1] && QueryUtil.hasAnyQueryBond(mol, b))\n\t\t{\n\t\t\tQueryUtil.deleteQueryBondAll(mol, b);\n\t\t\tanything = true;\n\t\t}\n\n\t\tif (anything)\n\t\t\tthis.output.mol = mol;\n\t\telse\n\t\t\tthis.errmsg = 'No query terms to clear.';\n\t}\n\n\tpublic execQueryCopy():void\n\t{\n\t\tif (!this.requireSubject()) return;\n\n\t\tconst {mol, currentBond} = this.input;\n\n\t\tif (currentBond > 0)\n\t\t{\n\t\t\tif (!QueryUtil.hasAnyQueryBond(mol, currentBond))\n\t\t\t{\n\t\t\t\tthis.errmsg = 'Bond has no query terms.';\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet qmol = new Molecule();\n\t\t\tqmol.addAtom('*', 0, 0);\n\t\t\tqmol.addAtom('*', Molecule.IDEALBOND, 0);\n\t\t\tqmol.addBond(1, 2, 1);\n\t\t\tqmol.setBondExtra(1, mol.bondExtra(currentBond).filter((xtra) => xtra.startsWith('q')));\n\t\t\tthis.toClipboard = qmol.toString();\n\t\t}\n\t\telse if (this.subjectLength == 1)\n\t\t{\n\t\t\tlet atom = this.subjectIndex[0];\n\t\t\tif (!QueryUtil.hasAnyQueryAtom(mol, atom))\n\t\t\t{\n\t\t\t\tthis.errmsg = 'Atom has no query terms.';\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet qmol = new Molecule();\n\t\t\tqmol.addAtom('*', 0, 0);\n\t\t\tqmol.setAtomExtra(1, mol.atomExtra(atom).filter((xtra) => xtra.startsWith('q')));\n\t\t\tthis.toClipboard = qmol.toString();\n\t\t}\n\t\telse this.errmsg = 'Subject has to be a single atom or bond.';\n\t}\n\n\tpublic execQueryPaste():void\n\t{\n\t\tif (!this.requireSubject()) return;\n\n\t\tlet qmol:Molecule = this.param.qmol;\n\t\tif (!qmol) {}\n\t\telse if (qmol.numAtoms == 1 && qmol.atomElement(1) == '*' && QueryUtil.hasAnyQueryAtom(qmol, 1))\n\t\t{\n\t\t\tlet mol = this.output.mol = this.input.mol.clone();\n\t\t\tlet qterms = qmol.atomExtra(1).filter((xtra) => xtra.startsWith('q'));\n\t\t\tfor (let a of this.subjectIndex)\n\t\t\t{\n\t\t\t\tlet aterms = mol.atomExtra(a).filter((xtra) => xtra.startsWith('q'));\n\t\t\t\tmol.setAtomExtra(a, [...aterms, ...qterms]);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\telse if (qmol.numAtoms == 2 && qmol.atomElement(1) == '*' && qmol.atomElement(2) == '*' &&\n\t\t\t\t qmol.numBonds == 1 && QueryUtil.hasAnyQueryBond(qmol, 1))\n\t\t{\n\t\t\tlet mol = this.output.mol = this.input.mol.clone();\n\t\t\tlet qterms = qmol.bondExtra(1).filter((xtra) => xtra.startsWith('q'));\n\t\t\tfor (let b = 1; b <= mol.numBonds; b++) if (this.subjectMask[mol.bondFrom(b) - 1] && this.subjectMask[mol.bondTo(b) - 1])\n\t\t\t{\n\t\t\t\tlet bterms = mol.bondExtra(b).filter((xtra) => xtra.startsWith('q'));\n\t\t\t\tmol.setBondExtra(b, [...bterms, ...qterms]);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tthis.errmsg = 'Unable to paste query terms.';\n\t}\n\n\tpublic execQuerySetAtom():void\n\t{\n\t\t// TODO\n\t}\n\n\tpublic execQuerySetBond():void\n\t{\n\t\t// TODO\n\t}\n\n\tpublic execQueryBondAny():void\n\t{\n\t\tif (!this.requireSubject()) return;\n\n\t\tconst {mol, currentBond} = this.input;\n\t\tlet bonds:number[] = [];\n\t\tfor (let n = 1; n <= mol.numBonds; n++) if (this.subjectMask[mol.bondFrom(n) - 1] && this.subjectMask[mol.bondTo(n) - 1]) bonds.push(n);\n\t\tif (bonds.length == 0)\n\t\t{\n\t\t\tthis.errmsg = 'Must select at least one bond.';\n\t\t\treturn;\n\t\t}\n\n\t\tthis.output.mol = mol.clone();\n\n\t\tfor (let b of bonds)\n\t\t{\n\t\t\tthis.output.mol.setBondOrder(b, 0);\n\t\t\tQueryUtil.setQueryBondOrders(this.output.mol, b, [-1, 0, 1, 2, 3, 4]);\n\t\t}\n\t}\n\n\tpublic execSproutDirection(deltaX:number, deltaY:number):void\n\t{\n\t\tif (!this.requireCurrent()) return;\n\t\tif (deltaX == 0 && deltaY == 0) return;\n\n\t\tconst {mol, currentAtom} = this.input;\n\n\t\tlet angleOptions:number[];\n\t\tif (mol.atomAdjCount(currentAtom) == 0)\n\t\t\tangleOptions = Vec.identity0(12).map((n) => n * TWOPI / 12);\n\t\telse\n\t\t\tangleOptions = SketchUtil.primeDirections(mol, currentAtom) ?? SketchUtil.exitVectors(mol, currentAtom);\n\t\tif (angleOptions.length == 0) return;\n\n\t\tlet theta = Math.atan2(deltaY, deltaX);\n\t\tlet idx = Vec.idxMin(angleOptions.map((look) => Math.abs(angleDiff(theta, look)) + 0.01 * Math.abs(Math.sin(look))));\n\t\tlet px = mol.atomX(currentAtom) + Molecule.IDEALBOND * Math.cos(angleOptions[idx]);\n\t\tlet py = mol.atomY(currentAtom) + Molecule.IDEALBOND * Math.sin(angleOptions[idx]);\n\n\t\tthis.output.mol = mol.clone();\n\t\tlet newAtom = this.output.mol.addAtom('C', px, py);\n\t\tthis.output.mol.addBond(currentAtom, newAtom, 1);\n\t\tthis.output.mol = SketchUtil.joinOverlappingAtoms(this.output.mol, Vec.booleanArray(true, this.output.mol.numAtoms)) ?? this.output.mol;\n\n\t\tfor (let n = 1; n <= this.output.mol.numAtoms; n++)\n\t\t{\n\t\t\tlet dx = this.output.mol.atomX(n) - px, dy = this.output.mol.atomY(n) - py;\n\t\t\tif (norm2_xy(dx, dy) < CoordUtil.OVERLAP_THRESHOLD_SQ)\n\t\t\t{\n\t\t\t\tthis.output.currentAtom = n;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\t/*\n\t// input: (standard)\n\t// output: (standard)\n\tpublic void execBondInsert() throws Exception\n\t{\n\t\tif (!requireSubject()) return;\n\n\t\tif (currentBond == 0)\n\t\t{\n\t\t\terrmsg = 'There must be a current bond.';\n\t\t\treturn;\n\t\t}\n\t\tif (mol.bondInRing(currentBond))\n\t\t{\n\t\t\terrmsg = 'Cannot insert into a ring-bond.';\n\t\t\treturn;\n\t\t}\n\n\t\tint[][] sides = MolUtil.getBondSides(mol, currentBond);\n\t\tint[] side1 = sides[0], side2 = sides[1];\n\t\tint[] atoms = null;\n\t\tint a1 = mol.bondFrom(currentBond), a2 = mol.bondTo(currentBond);\n\t\tboolean sel1 = selectedMask[a1 - 1], sel2 = selectedMask[a2 - 1];\n\t\tif (sel1 && !sel2) atoms = side1;\n\t\telse if (!sel1 && sel2) atoms = side2;\n\t\telse if (side1.length < side2.length) atoms = side1;\n\t\telse atoms = side2;\n\n\t\tint alink = Vec.indexOf(a1, atoms) >= 0 ? a1 : a2;\n\t\toutmol = mol.clone();\n\t\toutmol.setBondOrder(currentBond, 1);\n\n\t\tboolean[] fragmask = Vec.booleanArray(false, mol.numAtoms);\n\t\tfor (int n = 0; n < atoms.length; n++) fragmask[atoms[n] - 1] = true;\n\t\tMolecule frag = MolUtil.subgraphWithAttachments(outmol, fragmask);\n\n\t\tfor (int n = outmol.numAtoms; n >= 1; n--) if (fragmask[n - 1] && n != alink)\n\t\t{\n\t\t\toutmol.deleteAtomAndBonds(n);\n\t\t\tif (n < alink) alink--;\n\t\t}\n\n\t\tmol.setAtomElement(alink, \"C\");\n\t\tmol.setAtomCharge(alink, 0);\n\t\tmol.setAtomUnpaired(alink, 0);\n\t\tmol.setAtomHExplicit(alink, Molecule.HEXPLICIT_UNKNOWN);\n\t\tmol.setAtomIsotope(alink, Molecule.ISOTOPE_NATURAL);\n\t\tmol.setAtomMapNum(alink, 0);\n\t\tmol.setAtomExtra(alink, null);\n\t\tmol.setAtomTransient(alink, null);\n\n\t\tTemplateFusion fusion = new TemplateFusion(outmol, frag, \"\");\n\t\tfusion.setWithGuideOnly(true);\n\t\tfusion.permuteAtom(alink);\n\t\tif (fusion.numPerms() == 0)\n\t\t{\n\t\t\t// (should be rare or impossible)\n\t\t\terrmsg = 'Unable to insert an atom.';\n\t\t\treturn;\n\t\t}\n\n\t\toutmol = fusion.getPerm(0).mol;\n\t\tzapSubject();\n\t\toutCurrentAtom = alink;\n\t}*/\n\n\t// ----------------- private methods -----------------\n\n\t// if there is no subject, sets the error message and returns false\n\tprivate requireSubject():boolean\n\t{\n\t\tif (this.subjectLength == 0) this.errmsg = 'Subject required: current atom/bond or selected atoms.';\n\t\treturn this.subjectLength > 0;\n\t}\n\n\t// complains if there aren't any atoms\n\tprivate requireAtoms():boolean\n\t{\n\t\tif (this.input.mol.numAtoms == 0) this.errmsg = 'There are no atoms.';\n\t\treturn this.input.mol.numAtoms > 0;\n\t}\n\n\t// complains if there's no current atom/bond\n\tprivate requireCurrent():boolean\n\t{\n\t\tif (this.input.currentAtom == 0 && this.input.currentBond == 0)\n\t\t{\n\t\t\tthis.errmsg = 'There must be a current atom or bond.';\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t// complains if there are no selected atoms\n\tprivate requireSelected():boolean\n\t{\n\t\tif (!this.hasSelected) this.errmsg = 'No atoms are selected.';\n\t\treturn this.hasSelected;\n\t}\n\n\t// for a set of groups of atoms, select one that is represented by the current subject; optionally advanced\n\t// to the next group\n\tprivate pickSelectedGroup(groups:number[][], dir:number):number\n\t{\n\t\tif (this.subjectLength == 0) return 0;\n\n\t\t// if any is all-selected, that's the starting point (+ dir)\n\t\tfor (let i = 0; i < groups.length; i++)\n\t\t{\n\t\t\tlet g = groups[i];\n\t\t\tlet all = true;\n\t\t\tfor (let j = 0; j < g.length; j++) if (!this.subjectMask[g[j] - 1])\n\t\t\t{\n\t\t\t\tall = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (all)\n\t\t\t{\n\t\t\t\ti += dir;\n\t\t\t\treturn i < 0 ? i + groups.length : i >= groups.length ? i - groups.length : i;\n\t\t\t}\n\t\t}\n\n\t\t// anything partly selected will do\n\t\tfor (let i = 0; i < groups.length; i++)\n\t\t{\n\t\t\tlet g = groups[i];\n\t\t\tfor (let j = 0; j < g.length; j++) if (this.subjectMask[g[j] - 1]) return i;\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\t// makes sure output has no subject of any kind\n\tprivate zapSubject():void\n\t{\n\t\tthis.output.currentAtom = 0;\n\t\tthis.output.currentBond = 0;\n\t\tthis.output.selectedMask = Vec.booleanArray(false, this.input.mol.numAtoms);\n\t}\n\n\t// support for bond addition\n\tprivate performBondNew(atom:number, order:number, type:number):void\n\t{\n\t\tlet mol = this.input.mol;\n\n\t\tlet ang = SketchUtil.calculateNewBondAngles(mol, atom, order);\n\t\tif (ang.length == 0) ang = SketchUtil.exitVectors(mol, atom);\n\t\tif (ang.length == 0)\n\t\t{\n\t\t\t// (probably impossible...)\n\t\t\tthis.errmsg = 'Could not find a suitable geometry for a new substituent.';\n\t\t\treturn;\n\t\t}\n\n\t\tlet bx:number[] = [], by:number[] = [], bscore:number[] = [];\n\t\tfor (let n = 0; n < ang.length; n++)\n\t\t{\n\t\t\tlet x = mol.atomX(atom) + Molecule.IDEALBOND * Math.cos(ang[n]);\n\t\t\tlet y = mol.atomY(atom) + Molecule.IDEALBOND * Math.sin(ang[n]);\n\t\t\tlet score = CoordUtil.congestionPoint(mol, x, y);\n\t\t\tif (Chemistry.ELEMENT_BLOCKS[mol.atomicNumber(atom)] <= 2)\n\t\t\t\tscore += Math.abs(angleNorm(ang[n])) * 1E-8; // rounding error bias for pointing right\n\t\t\telse\n\t\t\t\tscore += Math.abs(angleDiff(0.5 * Math.PI, ang[n])) * 1E-8; // bias for pointing up\n\n\t\t\tbx.push(x);\n\t\t\tby.push(y);\n\t\t\tbscore.push(score);\n\t\t}\n\t\tlet idx = Vec.idxSort(bscore);\n\n\t\tthis.output.mol = mol.clone();\n\t\tlet anum = CoordUtil.atomAtPoint(this.output.mol, bx[idx[0]], by[idx[0]]);\n\t\tif (anum == 0) anum = this.output.mol.addAtom('C', bx[idx[0]], by[idx[0]]);\n\t\tMolUtil.addBond(this.output.mol, atom, anum, order, type);\n\n\t\tif (idx.length >= 2)\n\t\t{\n\t\t\tthis.output.altmol = mol.clone();\n\t\t\tanum = CoordUtil.atomAtPoint(this.output.altmol, bx[idx[1]], by[idx[1]]);\n\t\t\tif (anum == 0) anum = this.output.altmol.addAtom('C', bx[idx[1]], by[idx[1]]);\n\t\t\tMolUtil.addBond(this.output.altmol, atom, anum, order, type);\n\t\t}\n\t}\n\n\t// support for bond order\n\tprivate performBondChange(order:number, type:number):void\n\t{\n\t\tlet mol = this.input.mol;\n\n\t\tlet bonds:number[] = [];\n\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t\tif (this.subjectMask[mol.bondFrom(n) - 1] && this.subjectMask[mol.bondTo(n) - 1]) bonds.push(n);\n\n\t\tlet switchType = type == Molecule.BONDTYPE_DECLINED || type == Molecule.BONDTYPE_INCLINED;\n\t\tlet stereoType = switchType || type == Molecule.BONDTYPE_UNKNOWN;\n\t\tlet anyChange = switchType;\n\n\t\tfor (let n = 0; n < bonds.length && !anyChange; n++)\n\t\t{\n\t\t\tlet b = bonds[n];\n\t\t\tif (mol.bondOrder(b) != order && type == Molecule.BONDTYPE_NORMAL) anyChange = true;\n\t\t\telse if (mol.bondType(b) != type) anyChange = true;\n\t\t}\n\n\t\tif (!anyChange)\n\t\t{\n\t\t\tthis.errmsg = 'No bond changes made.';\n\t\t\treturn;\n\t\t}\n\n\t\tthis.output.mol = mol.clone();\n\n\t\tfor (let n = 0; n < bonds.length; n++)\n\t\t{\n\t\t\tlet b = bonds[n], bfr = this.output.mol.bondFrom(b), bto = this.output.mol.bondTo(b);\n\n\t\t\tif (switchType && this.output.mol.bondType(b) == type)\n\t\t\t{\n\t\t\t\tthis.output.mol.setBondFromTo(b, bto, bfr);\n\t\t\t}\n\t\t\telse if (this.output.mol.bondOrder(b) != order || this.output.mol.bondType(b) != type)\n\t\t\t{\n\t\t\t\tif (!stereoType && order != this.output.mol.bondOrder(b)) this.output.mol.setBondOrder(b, order);\n\t\t\t\telse this.output.mol.setBondType(b, type);\n\t\t\t}\n\t\t\telse if (switchType)\n\t\t\t{\n\t\t\t\tthis.output.mol.setBondFromTo(b, bto, bfr);\n\t\t\t}\n\t\t}\n\t}\n\n\t// support for atom-geometry\n\tprivate performBondGeomAtom(geom:number, atom:number):void\n\t{\n\t\tlet mol = this.input.mol;\n\n\t\tlet adj = mol.atomAdjList(atom);\n\t\tlet asz = adj.length, gsz = SketchUtil.GEOM_ANGLES[geom].length;\n\n\t\tif (asz > gsz)\n\t\t{\n\t\t\tthis.errmsg = 'The current atom has more bonds than does the selected geometry.';\n\t\t\treturn;\n\t\t}\n\n\t\t// isolated atom: defer to the regular add-bond feature\n\t\tif (asz == 0)\n\t\t{\n\t\t\tthis.performBondNew(atom, 1, Molecule.BONDTYPE_NORMAL);\n\t\t\treturn;\n\t\t}\n\n\t\t// already at limit: only refit applies\n\t\tif (asz == gsz)\n\t\t{\n\t\t\tthis.output.mol = SketchUtil.refitAtomGeometry(mol, atom, geom);\n\t\t\tif (this.output.mol == null) this.errmsg = 'Could not re-fit the atom geometry.';\n\t\t\treturn;\n\t\t}\n\n\t\t// decide whether to refit, or add a new bond onto a vacant slot\n\t\tlet ang = CoordUtil.atomBondAngles(mol, atom);\n\t\tlet newang = SketchUtil.mapAngleSubstituent(geom, ang);\n\n\t\t// doesn't match, so refit\n\t\tif (newang == null)\n\t\t{\n\t\t\tthis.output.mol = SketchUtil.refitAtomGeometry(mol, atom, geom);\n\t\t\tif (this.output.mol == null) this.errmsg = 'Could not re-fit the atom geometry.';\n\t\t\treturn;\n\t\t}\n\n\t\t// add new bond\n\t\tthis.output.mol = mol.clone();\n\t\tlet theta = SketchUtil.pickNewAtomDirection(mol, atom, newang);\n\t\tlet x = this.output.mol.atomX(atom) + Molecule.IDEALBOND * Math.cos(theta);\n\t\tlet y = this.output.mol.atomY(atom) + Molecule.IDEALBOND * Math.sin(theta);\n\t\tlet anum = CoordUtil.atomAtPoint(this.output.mol, x, y);\n\t\tif (anum == 0) anum = this.output.mol.addAtom('C', x, y);\n\t\tMolUtil.addBond(this.output.mol, atom, anum, 1);\n\t}\n\n\t// support for bond-geometry\n\tprivate performBondGeomBond(geom:number, bond:number):void\n\t{\n\t\tlet mol = this.input.mol;\n\n\t\t// examine both sides (bfr,bto): make sure that 'bto' is terminal, else error\n\t\tlet bfr = mol.bondFrom(bond), bto = mol.bondTo(bond);\n\t\tlet ac1 = mol.atomAdjCount(bfr), ac2 = mol.atomAdjCount(bto);\n\t\tif (ac1 > 1 && ac2 == 1) {}\n\t\telse if (ac1 == 1 && ac2 > 1) {let t = ac1; ac1 = ac2; ac2 = t;}\n\t\telse\n\t\t{\n\t\t\tthis.errmsg = 'One end of the bond must be terminal.';\n\t\t\treturn;\n\t\t}\n\n\t\t// consider possible angles that the bond can be migrated to\n\t\tlet adj = mol.atomAdjList(bfr);\n\t\tlet x1 = mol.atomX(bfr), y1 = mol.atomY(bfr);\n\t\tlet x2 = mol.atomX(bto), y2 = mol.atomY(bto);\n\t\tlet ang:number[] = [];\n\t\tfor (let n = 0, p = 0; n < adj.length; n++) if (adj[n] != bto)\n\t\t{\n\t\t\tang.push(Math.atan2(mol.atomY(adj[n]) - y1, mol.atomX(adj[n]) - x1));\n\t\t}\n\t\tlet newang = SketchUtil.mapAngleSubstituent(geom, ang);\n\t\tif (newang == null)\n\t\t{\n\t\t\tthis.errmsg = 'No alternative geometries identified.';\n\t\t\treturn;\n\t\t}\n\n\t\t// pick the one that has the lowest angular increment from the current angle, i.e. around the clock\n\t\tlet bestAng = TWOPI + 1, bestX = 0, bestY = 0;\n\t\tlet curth = Math.atan2(y2 - y1, x2 - x1), r = norm_xy(x2 - x1, y2 - y1);\n\n\t\tfor (let n = 0; n < newang.length; n++)\n\t\t{\n\t\t\tlet th = angleDiff(newang[n], curth);\n\t\t\tif (th < 0) th += TWOPI;\n\t\t\tif (n > 0 && th > bestAng) continue;\n\n\t\t\tlet x = x1 + r * Math.cos(th + curth);\n\t\t\tlet y = y1 + r * Math.sin(th + curth);\n\t\t\tif (CoordUtil.atomAtPoint(mol, x, y) > 0) continue;\n\n\t\t\tbestAng = th;\n\t\t\tbestX = x;\n\t\t\tbestY = y;\n\t\t}\n\t\tif (bestAng > TWOPI)\n\t\t{\n\t\t\tthis.errmsg = 'No alternative geometries identified.';\n\t\t\treturn;\n\t\t}\n\n\t\tthis.output.mol = mol.clone();\n\t\tthis.output.mol.setAtomPos(bto, bestX, bestY);\n\t}\n\n\t// returns true only if the subject matter is ready to be turned into a terminal inline abbreviation\n\tprivate checkAbbreviationReady():boolean\n\t{\n\t\tlet junction = 0;\n\n\t\tlet mol = this.input.mol, subjmask = this.subjectMask;\n\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t{\n\t\t\tlet b1 = mol.bondFrom(n), b2 = mol.bondTo(n);\n\t\t\tlet atom = 0;\n\n\t\t\tif ((subjmask[b1 - 1] && !subjmask[b2 - 1] && MolUtil.hasAbbrev(mol, b1)) ||\n\t\t\t\t(subjmask[b2 - 1] && !subjmask[b1 - 1] && MolUtil.hasAbbrev(mol, b2)))\n\t\t\t{\n\t\t\t\tthis.errmsg = 'Already an abbreviation.';\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (subjmask[b1 - 1] && !subjmask[b2 - 1]) atom = b1;\n\t\t\telse if (subjmask[b2 - 1] && !subjmask[b1 - 1]) atom = b2;\n\n\t\t\tif (atom == 0 || atom == junction) {}\n\t\t\telse if (junction == 0) junction = atom;\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.errmsg = 'The selected group must be terminal.';\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t// assuming the bond is not in a ring, figures out which side is \"lighter\", and returns the opposite; note that if one of the two\n\t// bond atoms is selected, then that one is picked preferentially; if requested, it will not consider a \"terminal\" end\n\tprivate mobileSide(bond:number, disqualTerminal = false):[number, number, number[]]\n\t{\n\t\tlet {mol} = this.input;\n\t\tlet atom1 = mol.bondFrom(bond), atom2 = mol.bondTo(bond);\n\n\t\tlet g = Graph.fromMolecule(mol);\n\t\tg.removeEdge(atom1 - 1, atom2 - 1);\n\t\tlet side1:number[] = [], side2:number[] = [];\n\t\tfor (let grp of g.calculateComponentGroups())\n\t\t{\n\t\t\tif (grp.includes(atom1 - 1)) side1 = Vec.add(grp, 1);\n\t\t\tif (grp.includes(atom2 - 1)) side2 = Vec.add(grp, 1);\n\t\t}\n\t\tlet weight1 = side1.length * (mol.atomRingBlock(atom1) > 0 ? 2 : 1);\n\t\tlet weight2 = side2.length * (mol.atomRingBlock(atom2) > 0 ? 2 : 1);\n\t\tlet sel1 = false, sel2 = false;\n\t\tfor (let a of side1) if (this.isSelected(a)) {sel1 = true; break;}\n\t\tfor (let a of side2) if (this.isSelected(a)) {sel2 = true; break;}\n\n\t\tif (disqualTerminal && mol.atomAdjCount(atom1) == 1) return [atom2, atom1, side2];\n\t\telse if (disqualTerminal && mol.atomAdjCount(atom2) == 1) return [atom1, atom2, side1];\n\t\telse if (sel1 && !sel2) {}\n\t\telse if ((sel2 && !sel1) || weight2 < weight1) return [atom2, atom1, side2];\n\t\treturn [atom1, atom2, side1];\n\t}\n\n\t// returns true if the atom is indicated in the selection mask of the input, if there is one\n\tprivate isSelected(atom:number):boolean\n\t{\n\t\tlet mask = this.input.selectedMask;\n\t\treturn mask ? mask[atom - 1] : false;\n\t}\n\n\t// if the atoms overlap with a polymer block, zap it, apply the results, and return true\n\tprivate removePolymerBlock(atoms:number[]):boolean\n\t{\n\t\tlet polymer = new PolymerBlock(this.input.mol.clone());\n\n\t\tfor (let id of polymer.getIDList())\n\t\t{\n\t\t\tlet unit = polymer.getUnit(id);\n\t\t\tfor (let atom of atoms) if (unit.atoms.includes(atom))\n\t\t\t{\n\t\t\t\tpolymer.removeUnit(id);\n\t\t\t\tpolymer.rewriteMolecule();\n\t\t\t\tthis.output.mol = polymer.mol;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {ButtonView} from './ButtonView';\n\n/*\n\tButtonBank: abstract base class for providing a \"bank of buttons\". The instance is expected to server up a list\n\tof renderable buttons, and to respond when buttons are pressed. A ButtonBank is always owned by a ButtonView instance,\n\twhich calls the shots.\n\n\tContent:\n\t\t.buttons: an array of buttons, each of them an object with the following properties:\n\t\t\t.id: identification code supplied when a button is activated\n\t\t\t.imageFN: root prefix for a static image to display\n\t\t\t.metavec: metavector data to display instead of an image (raw data, not object)\n\t\t\t.helpText: explanatory text\n\t\t\t.isSubMenu: true if the button should be annotated with a submenu glyph\n\t\t\t.mnemonic: optional keyboard shortcut & annotation\n\t\t.ownerView: the molsync.ui.ButtonView object that owns this buttonbank; gets set after the constructor is called\n*/\n\nexport interface ButtonBankItem\n{\n\tid:string;\n\timageFN?:string;\n\tmetavec?:any; // either an instance of MetaVector or a dictionary that can be used to make one (server-generated: semi-deprecated)\n\thelpText:string;\n\tisSubMenu?:boolean;\n\tmnemonic?:string; // key combination for display with modifiers, e.g. Shift+X, which gets interpreted for action purposes\n\tkey?:string; // from KeyCode; overrides the key part of the mnemonic\n\ttext?:string;\n}\n\nexport abstract class ButtonBank\n{\n\tpublic buttonView:ButtonView; // the widget parent\n\tpublic isSubLevel = false; // true if it's not the first-on-stack\n\tpublic buttons:ButtonBankItem[] = [];\n\n\tconstructor() {}\n\n\t// called when the bank is added to a view; the .ownerView property will be set at this point\n\tpublic init():void {}\n\n\t// update the list of buttons; this may be called more than once, e.g. when resizing, or being popped back off the stack; this\n\t// method must be overridden\n\tpublic abstract update():void;\n\n\t// this gets called when a button is activated, i.e. clicked\n\tpublic abstract hitButton(id:string):void;\n\n\t// a key has been pressed: the button bank may choose to react to it\n\tpublic claimKey(event:KeyboardEvent):boolean {return false;}\n\n\t// override to capture the closing of the bank (a cleanup opportunity)\n\tpublic bankClosed() {}\n\n\t// utility function: returns true if the system-generated keyboard event for a \"keypress\" action matches the mnemonic string (which is\n\t// used as a shorthand in the button definitions); the mnemonic format is basically:\n\t//\n\t//     {modifier1}-{modifier2}-...-{keychar}\n\t//\n\t// where the modifiers consist of Shift-, Ctrl-, Alt-; and the keychar is usually a plain keyboard character which is case insensitive - with\n\t// special word codes for unprintables\n\tpublic static matchKey(event:KeyboardEvent, mnemonic:string, key:string):boolean\n\t{\n\t\tif (mnemonic == null || mnemonic == '') return false;\n\n\t\tlet mshift = false, mctrl = false, malt = false, mmeta = false, mkey = mnemonic;\n\t\twhile (true)\n\t\t{\n\t\t\tif (mkey.startsWith('Shift+')) {mshift = true; mkey = mkey.substring(6);}\n\t\t\telse if (mkey.startsWith('Ctrl+')) {mctrl = true; mkey = mkey.substring(5);}\n\t\t\telse if (mkey.startsWith('Alt+')) {malt = true; mkey = mkey.substring(4);}\n\t\t\telse if (mkey.startsWith('Cmd+')) {mmeta = true; mkey = mkey.substring(4);}\n\t\t\telse break;\n\t\t}\n\n\t\t//console.log('MatchKey:',{mkey,mshift,mctrl,malt,mmeta});\n\n\t\tif (mshift != event.shiftKey) return false;\n\t\tif (mctrl != event.ctrlKey) return false;\n\t\tif (malt != event.altKey) return false;\n\t\tif (mmeta != event.metaKey) return false;\n\n\t\tif (key) mkey = key; // override\n\n\t\treturn mkey.toLowerCase() == event.key.toLowerCase();\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2020 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Graph} from '../data/Graph';\nimport {Molecule} from '../data/Molecule';\nimport {MolUtil} from '../data/MolUtil';\nimport {GeomUtil} from '../util/Geom';\nimport {angleDiffPos, DEGRAD, norm2_xy, norm_xy, signum, sqr, TWOPI} from '../util/util';\nimport {Vec} from '../util/Vec';\n\n/*\n\tGiven a metal centre, and some number of atoms that are (or should be) connected to the metal, finds an aesthetically acceptable arrangement. It\n\tassumes that the ligands themselves are arranged and only need to be oriented. If there are metal-bonded atoms that are not listed in the parameter,\n\tthese will be treated as fixed obstacles.\n*/\n\ninterface Ligand\n{\n\tatoms:number[]; // all atoms of the ligand\n\tattach:number[]; // attachment points to the metal\n\tavgTheta?:number; // average extension of the ligand attachment point(s)\n}\n\nexport class MetalLigate\n{\n\tprivate mol:Molecule;\n\tprivate ligands:Ligand[] = [];\n\n\t// ----------------- public methods -----------------\n\n\tconstructor(mol:Molecule, private metalAtom:number, private ligandAttach:number[])\n\t{\n\t\tthis.mol = mol.clone();\n\t}\n\n\t// creates enough fragments to cover all of the incoming atoms; throws a DepictorFaultException if anything goes wrong\n\tpublic generate():Molecule\n\t{\n\t\tconst {mol, metalAtom, ligandAttach, ligands} = this;\n\n\t\tlet g = Graph.fromMolecule(mol);\n\t\tg.isolateNode(metalAtom - 1);\n\t\tfor (let cc of g.calculateComponentGroups())\n\t\t{\n\t\t\tVec.addTo(cc, 1);\n\t\t\tlet anything = false;\n\t\t\tfor (let a of ligandAttach) if (cc.indexOf(a) >= 0) {anything = true; break;}\n\t\t\tif (!anything) continue;\n\n\t\t\tlet lig:Ligand = {atoms: cc, attach: []};\n\t\t\tlig.atoms = cc;\n\t\t\tlet anyAttached = false;\n\t\t\tfor (let a of lig.atoms) if (mol.findBond(a, metalAtom) > 0) {anyAttached = true; break;}\n\t\t\tfor (let a of lig.atoms)\n\t\t\t{\n\t\t\t\tlet bonded = mol.findBond(a, metalAtom) > 0;\n\t\t\t\tif (bonded || (!anyAttached && ligandAttach.includes(a))) lig.attach.push(a);\n\t\t\t}\n\t\t\tligands.push(lig);\n\n\t\t\tfor (let a of lig.attach) if (mol.findBond(a, metalAtom) == 0) this.makeLigandBond(a);\n\t\t}\n\n\t\tif (ligands.length == 0) throw new Error('No ligand atoms');\n\n\t\t// figure out angular projections for ligands (both fixed and motile)\n\n\t\tlet otherLigands = mol.atomAdjList(metalAtom);\n\t\tfor (let lig of ligands) otherLigands = Vec.exclude(otherLigands, lig.attach);\n\n\t\tlet mx = mol.atomX(metalAtom), my = mol.atomY(metalAtom);\n\n\t\tlet otherTheta:number[] = new Array(otherLigands.length);\n\t\tfor (let n = 0; n < otherLigands.length; n++) otherTheta[n] = Math.atan2(mol.atomY(otherLigands[n]) - my, mol.atomX(otherLigands[n]) - mx);\n\n\t\tfor (let lig of ligands)\n\t\t{\n\t\t\tif (lig.attach.length == 1)\n\t\t\t{\n\t\t\t\tlet a = lig.attach[0];\n\t\t\t\tlig.avgTheta = Math.atan2(mol.atomY(a) - my, mol.atomX(a) - mx);\n\t\t\t\tthis.orientLigand(lig);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// figure out the average, without recursion errors\n\t\t\t\tlet theta:number[] = new Array(lig.attach.length);\n\t\t\t\tfor (let n = 0; n < lig.attach.length; n++)\n\t\t\t\t{\n\t\t\t\t\tlet a = lig.attach[n];\n\t\t\t\t\ttheta[n] = Math.atan2(mol.atomY(a) - my, mol.atomX(a) - mx);\n\t\t\t\t}\n\t\t\t\ttheta = GeomUtil.sortAngles(theta);\n\t\t\t\tlet base = theta[0];\n\t\t\t\tfor (let n = 0; n < theta.length; n++) theta[n] = angleDiffPos(theta[n], base);\n\t\t\t\tlig.avgTheta = base + Vec.sum(theta) / theta.length;\n\n\t\t\t\tthis.orientLigand(lig);\n\t\t\t}\n\t\t}\n\n\t\t// overall cases: arrange around as many fixed references as necessary\n\n\t\tif (otherLigands.length == 0)\n\t\t{\n\t\t\tligands.sort((l1, l2) => signum(l1.avgTheta - l2.avgTheta));\n\t\t\tthis.arrangeLigandsFree(ligands);\n\t\t}\n\t\telse if (otherLigands.length == 1)\n\t\t{\n\t\t\tligands.sort((l1, l2) =>\n\t\t\t{\n\t\t\t\tlet diff1 = angleDiffPos(l1.avgTheta, otherTheta[0]);\n\t\t\t\tlet diff2 = angleDiffPos(l2.avgTheta, otherTheta[0]);\n\t\t\t\treturn signum(diff1 - diff2);\n\t\t\t});\n\t\t\tthis.arrangeLigandsRange(ligands, otherTheta[0], TWOPI, true);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet otherOrder = Vec.idxSort(otherTheta);\n\t\t\tfor (let n = 0; n < otherOrder.length; n++)\n\t\t\t{\n\t\t\t\tlet nn = (n + 1) % otherOrder.length;\n\t\t\t\tlet theta = otherTheta[otherOrder[n]];\n\t\t\t\tlet extent = angleDiffPos(otherTheta[otherOrder[nn]], theta);\n\n\t\t\t\tlet batch:Ligand[] = [];\n\t\t\t\tfor (let lig of ligands)\n\t\t\t\t{\n\t\t\t\t\tlet diff = angleDiffPos(lig.avgTheta, theta);\n\t\t\t\t\tif (diff < extent) batch.push(lig);\n\t\t\t\t}\n\t\t\t\tif (batch.length == 0) continue;\n\t\t\t\tbatch.sort((l1, l2) =>\n\t\t\t\t{\n\t\t\t\t\tlet diff1 = angleDiffPos(l1.avgTheta, theta);\n\t\t\t\t\tlet diff2 = angleDiffPos(l2.avgTheta, theta);\n\t\t\t\t\treturn signum(diff1 - diff2);\n\t\t\t\t});\n\t\t\t\tthis.arrangeLigandsRange(batch, theta, extent, true);\n\t\t\t}\n\t\t}\n\n\t\tthis.resolveClashes();\n\n\t\treturn mol;\n\t}\n\n\t// ----------------- private methods -----------------\n\n\t// make ligand atom bonded to metal; pick a reasonable bond order\n\tprivate makeLigandBond(ligAtom:number):void\n\t{\n\t\tconst {mol, metalAtom} = this;\n\n\t\tlet mchg = mol.atomCharge(metalAtom), lchg = mol.atomCharge(ligAtom);\n\t\tif (mchg > 0 && lchg < 0)\n\t\t{\n\t\t\tmol.setAtomCharge(metalAtom, mchg - 1);\n\t\t\tmol.setAtomCharge(ligAtom, lchg + 1);\n\t\t\tmol.addBond(metalAtom, ligAtom, 1);\n\t\t\treturn;\n\t\t}\n\t\tif (mchg < 0 && lchg > 0)\n\t\t{\n\t\t\tmol.setAtomCharge(metalAtom, mchg + 1);\n\t\t\tmol.setAtomCharge(ligAtom, lchg - 1);\n\t\t\tmol.addBond(metalAtom, ligAtom, 1);\n\t\t\treturn;\n\t\t}\n\n\t\tlet order = 0;\n\t\tif (mol.atomHExplicit(ligAtom) == Molecule.HEXPLICIT_UNKNOWN && mol.atomHydrogens(ligAtom) > 0) order = 1;\n\t\tmol.addBond(metalAtom, ligAtom, order);\n\t}\n\n\t// assuming multiple attachment points, orient the ligand so that each of its attachment points are equidistant from the metal, using the average\n\t// theta value as the guideline\n\tprivate orientLigand(lig:Ligand):void\n\t{\n\t\tconst {mol, metalAtom} = this;\n\n\t\tlet mx = mol.atomX(metalAtom), my = mol.atomY(metalAtom);\n\n\t\tlet lsz = lig.atoms.length, asz = lig.attach.length;\n\t\tlet idxAttach:number[] = new Array(asz);\n\t\tfor (let n = 0; n < asz; n++) idxAttach[n] = lig.atoms.indexOf(lig.attach[n]);\n\n\t\t// step 1: extend the ligand out along its axis, so the bonds are long\n\t\tlet lx:number[] = new Array(lsz), ly:number[] = new Array(lsz);\n\t\tlet ax = MolUtil.arrayAtomX(mol), ay = MolUtil.arrayAtomY(mol);\n\t\tlet molExtent = Vec.max(ax) - Vec.min(ax) + Vec.max(ay) - Vec.min(ay);\n\t\tlet dx = molExtent * Math.cos(lig.avgTheta), dy = molExtent * Math.sin(lig.avgTheta);\n\t\tfor (let n = 0; n < lsz; n++)\n\t\t{\n\t\t\tlx[n] = mol.atomX(lig.atoms[n]) + dx;\n\t\t\tly[n] = mol.atomY(lig.atoms[n]) + dy;\n\t\t}\n\n\t\t// step 2: rotate in increments to get approximately the best orientation, in order to find the preferred ordering\n\t\tlet cx = Vec.sum(lx) / lsz, cy = Vec.sum(ly) / lsz;\n\t\tlet weight:number[] = [];\n\t\tfor (let n = 0; n < lsz; n++)\n\t\t{\n\t\t\tlet closest = Number.POSITIVE_INFINITY;\n\t\t\tfor (let idx of idxAttach) closest = Math.min(closest, norm2_xy(lx[n] - lx[idx], ly[n] - ly[idx]));\n\t\t\tweight.push(1.0 / (1 + Math.sqrt(closest)));\n\t\t}\n\t\tlet bestScore = Number.POSITIVE_INFINITY;\n\t\tlet bestLX:number[] = null, bestLY:number[] = null;\n\t\tfor (let theta = 0; theta < 360; theta += 15)\n\t\t{\n\t\t\tlet cosTheta = Math.cos(theta * DEGRAD), sinTheta = Math.sin(theta * DEGRAD);\n\t\t\tlet rx:number[] = new Array(lsz), ry:number[] = new Array(lsz);\n\t\t\tlet score = 0;\n\t\t\tfor (let n = 0; n < lsz; n++)\n\t\t\t{\n\t\t\t\tlet x = lx[n] - cx, y = ly[n] - cy;\n\t\t\t\trx[n] = cx + x * cosTheta - y * sinTheta;\n\t\t\t\try[n] = cy + x * sinTheta + y * cosTheta;\n\t\t\t\tlet dist = norm_xy(rx[n] - mx, ry[n] - my);\n\t\t\t\tif (lig.attach.indexOf(lig.atoms[n]) >= 0) score += dist; else score -= dist * weight[n];\n\t\t\t}\n\t\t\tif (score < bestScore)\n\t\t\t{\n\t\t\t\tbestScore = score;\n\t\t\t\tbestLX = rx;\n\t\t\t\tbestLY = ry;\n\t\t\t}\n\t\t}\n\t\tlx = bestLX;\n\t\tly = bestLY;\n\n\t\tif (asz == 1)\n\t\t{\n\t\t\t// shrink the bond length back down to normal\n\t\t\tdx = Molecule.IDEALBOND * Math.cos(lig.avgTheta);\n\t\t\tdy = Molecule.IDEALBOND * Math.sin(lig.avgTheta);\n\t\t\tVec.addTo(lx, mx + dx - lx[idxAttach[0]]);\n\t\t\tVec.addTo(ly, my + dy - ly[idxAttach[0]]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// step 3: get an ordering of the attachment angles\n\t\t\tlet attTheta:number[] = new Array(asz), attDist = Vec.numberArray(0, asz), attDX = Vec.numberArray(0, asz), attDY = Vec.numberArray(0, asz);\n\t\t\tfor (let n = 0; n < asz; n++)\n\t\t\t{\n\t\t\t\tlet ox = lx[idxAttach[n]] - mx, oy = ly[idxAttach[n]] - my;\n\t\t\t\tattTheta[n] = Math.atan2(oy, ox);\n\t\t\t\tif (asz > 2)\n\t\t\t\t{\n\t\t\t\t\tattDist[n] = norm_xy(ox, oy);\n\t\t\t\t\tattDX[n] = ox / attDist[n];\n\t\t\t\t\tattDY[n] = oy / attDist[n];\n\t\t\t\t}\n\t\t\t}\n\t\t\tVec.addTo(attDist, -Vec.min(attDist));\n\t\t\tlet orderAttach = GeomUtil.idxSortAngles(attTheta);\n\n\t\t\t// step 4: get a mapping onto desired coords, and run with it\n\t\t\tlet srcX:number[] = new Array(asz), srcY:number[] = new Array(asz);\n\t\t\tlet dstX:number[] = new Array(asz), dstY:number[] = new Array(asz);\n\t\t\tlet dtheta = 45 * DEGRAD / (asz - 1), theta = lig.avgTheta - 0.5 * dtheta;\n\t\t\tfor (let n = 0; n < asz; n++)\n\t\t\t{\n\t\t\t\tsrcX[n] = lx[idxAttach[orderAttach[n]]];\n\t\t\t\tsrcY[n] = ly[idxAttach[orderAttach[n]]];\n\t\t\t\tdstX[n] = mx + Molecule.IDEALBOND * Math.cos(theta) + attDist[n] * attDX[n];\n\t\t\t\tdstY[n] = my + Molecule.IDEALBOND * Math.sin(theta) + attDist[n] * attDY[n];\n\n\t\t\t\ttheta += dtheta / (asz - 1);\n\t\t\t}\n\t\t\tlet tfm = GeomUtil.superimpose(srcX, srcY, dstX, dstY);\n\t\t\tfor (let n = 0; n < lsz; n++)\n\t\t\t{\n\t\t\t\tlet [x, y] = GeomUtil.applyAffine(lx[n], ly[n], tfm);\n\t\t\t\tlx[n] = x;\n\t\t\t\tly[n] = y;\n\t\t\t}\n\t\t}\n\n\t\tfor (let n = 0; n < lsz; n++) mol.setAtomPos(lig.atoms[n], lx[n], ly[n]);\n\t}\n\n\t// arrange the given ligands in order, given that there are no reference constraints, so use the initial vectors\n\tprivate arrangeLigandsFree(batch:Ligand[]):void\n\t{\n\t\tif (batch.length == 1) return; // leave it be\n\n\t\tlet refTheta = Vec.last(batch).avgTheta;\n\t\trefTheta += 0.5 * angleDiffPos(Vec.first(batch).avgTheta, refTheta);\n\t\tthis.arrangeLigandsRange(batch, refTheta, TWOPI, false);\n\t}\n\n\t// arrange the given ligands in order, between the indicated range\n\tprivate arrangeLigandsRange(batch:Ligand[], refTheta:number, refSpan:number, bounded:boolean):void\n\t{\n\t\tconst {mol, metalAtom} = this;\n\n\t\tlet mx = mol.atomX(metalAtom), my = mol.atomY(metalAtom);\n\n\t\tlet bsz = batch.length;\n\t\tlet thetaMin:number[] = new Array(bsz), thetaSpan:number[] = new Array(bsz);\n\n\t\tlet ligandSpan = 0;\n\n\t\tfor (let n = 0; n < bsz; n++)\n\t\t{\n\t\t\tlet [theta1, theta2] = this.determineThetaBounds(batch[n]);\n\t\t\tthetaMin[n] = theta1;\n\t\t\tthetaSpan[n] = angleDiffPos(theta2, theta1);\n\t\t\tligandSpan += thetaSpan[n];\n\t\t}\n\n\t\tlet residual = (refSpan - ligandSpan) / (bsz + (bounded ? 1 : 0));\n\t\tlet theta = refTheta + (bounded ? residual : 0.5 * residual);\n\t\tfor (let n = 0; n < bsz; n++)\n\t\t{\n\t\t\tlet rotTheta = theta - thetaMin[n];\n\t\t\tlet cosTheta = Math.cos(rotTheta), sinTheta = Math.sin(rotTheta);\n\n\t\t\tfor (let a of batch[n].atoms)\n\t\t\t{\n\t\t\t\tlet x = mol.atomX(a) - mx, y = mol.atomY(a) - my;\n\t\t\t\tmol.setAtomPos(a, mx + x * cosTheta - y * sinTheta, my + x * sinTheta + y * cosTheta);\n\t\t\t}\n\n\t\t\ttheta += thetaSpan[n] + residual;\n\t\t}\n\t}\n\n\t// returns {lowTheta,highTheta} for the ligand based on its attachment points\n\tprivate determineThetaBounds(lig:Ligand):[number, number]\n\t{\n\t\tconst {mol, metalAtom} = this;\n\t\tlet theta:number[] = [];\n\t\tlet mx = mol.atomX(metalAtom), my = mol.atomY(metalAtom);\n\t\tfor (let n = 0; n < lig.attach.length; n++)\n\t\t{\n\t\t\tlet x = mol.atomX(lig.attach[n]) - mx;\n\t\t\tlet y = mol.atomY(lig.attach[n]) - my;\n\t\t\ttheta.push(Math.atan2(y, x));\n\t\t}\n\t\tVec.sort(theta);\n\n\t\tlet bestScore = Number.POSITIVE_INFINITY, bestMin = 0, bestMax = 0;\n\n\t\tfor (let n = 0; n < theta.length; n++)\n\t\t{\n\t\t\tlet score = 0;\n\t\t\tfor (let i = 0; i < theta.length - 1; i++) score += angleDiffPos(theta[i + 1], theta[i]);\n\t\t\tif (score < bestScore)\n\t\t\t{\n\t\t\t\tbestScore = score;\n\t\t\t\tbestMin = Vec.first(theta);\n\t\t\t\tbestMax = Vec.last(theta);\n\t\t\t}\n\t\t\ttheta.push(theta.shift());\n\t\t}\n\n\t\treturn [bestMin, bestMax];\n\t}\n\n\t// if any of the ligand blocks clash, keep pushing them outward until resolution\n\tprivate resolveClashes():void\n\t{\n\t\tconst {mol, metalAtom, ligands} = this;\n\n\t\tconst na = mol.numAtoms, nb = mol.numBonds, lsz = this.ligands.length;\n\n\t\tlet ablk = Vec.numberArray(-1, na), bblk = Vec.numberArray(-1, nb); // -1=other component, 0=metal, >0=ligand\n\t\tfor (let n = 1; n <= na; n++) if (mol.atomConnComp(n) == mol.atomConnComp(metalAtom)) ablk[n - 1] = 0;\n\t\tfor (let n = 0; n < lsz; n++) for (let a of ligands[n].atoms) ablk[a - 1] = n + 1;\n\t\tfor (let n = 1; n <= nb; n++)\n\t\t{\n\t\t\tlet blk1 = ablk[mol.bondFrom(n) - 1], blk2 = ablk[mol.bondTo(n) - 1];\n\t\t\tif (blk1 < 0 || blk2 < 0) {}\n\t\t\telse if (blk1 == blk2) bblk[n - 1] = blk1;\n\t\t}\n\n\t\tlet bumpDX:number[] = new Array(lsz), bumpDY:number[] = new Array(lsz);\n\t\tlet mx = mol.atomX(metalAtom), my = mol.atomY(metalAtom);\n\t\tfor (let n = 0; n < lsz; n++)\n\t\t{\n\t\t\tlet lig = ligands[n];\n\t\t\tlet dx = 0, dy = 0;\n\t\t\tfor (let a of lig.attach)\n\t\t\t{\n\t\t\t\tdx += mol.atomX(a) - mx;\n\t\t\t\tdy += mol.atomY(a) - my;\n\t\t\t}\n\t\t\tdx /= lig.attach.length;\n\t\t\tdy /= lig.attach.length;\n\t\t\tlet invDist = 1.0 / norm_xy(dx, dy);\n\t\t\tbumpDX[n] = dx * 0.5 * invDist;\n\t\t\tbumpDY[n] = dy * 0.5 * invDist;\n\t\t}\n\n\t\tconst CLOSE_SQ = sqr(0.5);\n\n\t\tfor (let count = 0; count < 12; count++)\n\t\t{\n\t\t\tlet tainted = Vec.booleanArray(false, lsz);\n\t\t\touter: for (let i = 0; i < na - 1; i++)\n\t\t\t{\n\t\t\t\tif (ablk[i] < 0) continue;\n\t\t\t\tfor (let j = i + 1; j < na; j++) if (ablk[j] >= 0 && ablk[j] != ablk[i])\n\t\t\t\t{\n\t\t\t\t\tif (norm2_xy(mol.atomX(i + 1) - mol.atomX(j + 1), mol.atomY(i + 1) - mol.atomY(j + 1)) < CLOSE_SQ)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (ablk[i] > 0) tainted[ablk[i] - 1] = true;\n\t\t\t\t\t\tif (ablk[j] > 0) tainted[ablk[j] - 1] = true;\n\t\t\t\t\t}\n\t\t\t\t\tif (Vec.allTrue(tainted)) break outer;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (Vec.anyFalse(tainted)) outer: for (let i = 0; i < nb - 1; i++)\n\t\t\t{\n\t\t\t\tif (bblk[i] < 0) continue;\n\t\t\t\tlet x1 = mol.atomX(mol.bondFrom(i + 1)), y1 = mol.atomY(mol.bondFrom(i + 1));\n\t\t\t\tlet x2 = mol.atomX(mol.bondTo(i + 1)), y2 = mol.atomY(mol.bondTo(i + 1));\n\n\t\t\t\tfor (let j = i + 1; j < nb; j++) if (bblk[j] >= 0 && bblk[j] != bblk[i])\n\t\t\t\t{\n\t\t\t\t\tlet x3 = mol.atomX(mol.bondFrom(j + 1)), y3 = mol.atomY(mol.bondFrom(j + 1));\n\t\t\t\t\tlet x4 = mol.atomX(mol.bondTo(j + 1)), y4 = mol.atomY(mol.bondTo(j + 1));\n\t\t\t\t\tif (GeomUtil.doLineSegsIntersect(x1, y1, x2, y2, x3, y3, x4, y4))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (bblk[i] > 0) tainted[bblk[i] - 1] = true;\n\t\t\t\t\t\tif (bblk[j] > 0) tainted[bblk[j] - 1] = true;\n\t\t\t\t\t}\n\t\t\t\t\tif (Vec.allTrue(tainted)) break outer;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (Vec.allFalse(tainted)) break;\n\n\t\t\tfor (let n = 0; n < lsz; n++) if (tainted[n])\n\t\t\t{\n\t\t\t\tfor (let a of ligands[n].atoms)\n\t\t\t\t{\n\t\t\t\t\tmol.setAtomPos(a, mol.atomX(a) + bumpDX[n], mol.atomY(a) + bumpDY[n]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2020 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {BondArtifact} from '../data/BondArtifact';\nimport {CoordUtil} from '../data/CoordUtil';\nimport {Graph} from '../data/Graph';\nimport {Molecule} from '../data/Molecule';\nimport {MolUtil} from '../data/MolUtil';\nimport {PolymerBlock} from '../data/PolymerBlock';\nimport {SketchUtil} from '../data/SketchUtil';\nimport {angleDiff, DEGRAD, norm_xy, RADDEG} from '../util/util';\nimport {Vec} from '../util/Vec';\n\n/*\n    Algorithm class that exists for the purpose of generating some number of template-fusion permutations,\n\tstarting with an edit state (molecule,subject) and a template.\n*/\n\nexport class FusionPermutation\n{\n\tpublic mol:Molecule; // contains the fused result\n\tpublic display:Molecule; // the appended fragment, modified for display\n\tpublic molidx:number[]; // atom correspondence between starting molecule (parent.mol) and template (display)\n\tpublic temidx:number[];\n\tpublic srcidx:number[]; // for each atom in mol, >0=present in original molecule, 0=not so\n\n\tpublic attdist = 0;\n\tpublic guided = false;\n\tpublic bridged = false;\n\tpublic scoreModifier = 0;\n\tpublic chainSelect = 0;\n}\n\nexport class TemplateFusion\n{\n\tpublic perms:FusionPermutation[] = [];\n\tpublic numAttach = 0;\n\tpublic withGuideOnly = false;\n\n\tprivate guidetempl:Molecule = null;\n\tprivate guideidx:number[] = [];\n\tprivate guideadj:number[] = [];\n\n\tpublic timeLimit = 5.0; // number of seconds after which template fusion should quit with what it has\n\tpublic static RESERVED_GUIDESYMBOL = 'XXX';\n\n\t// ------------------ public methods --------------------\n\n\tconstructor(public mol:Molecule, public templ:Molecule, public abbrev:string)\n\t{\n\t\t// renumber any incoming bond artifacts\n\t\tlet artif1 = new BondArtifact(mol), artif2 = new BondArtifact(templ);\n\t\tartif2.harmoniseNumbering(artif1);\n\t\tartif2.rewriteMolecule();\n\n\t\t// and polymers\n\t\tlet poly1 = new PolymerBlock(mol), poly2 = new PolymerBlock(templ);\n\t\tpoly2.harmoniseNumbering(poly1);\n\t\tpoly2.rewriteMolecule();\n\n\t\tthis.huntForGuides();\n\t}\n\n\t// place the template with no reference anchor\n\tpublic permuteNone():void\n\t{\n\t\tlet numAttach = 0;\n\n\t\tlet oldmol = this.mol.clone(), newmol = this.templ.clone();\n\n\t\tif (oldmol.numAtoms > 0)\n\t\t{\n\t\t\tlet oldbox = oldmol.boundary(), newbox = newmol.boundary();\n\t\t\tlet dx = oldbox.maxX() + 1 - newbox.minX();\n\t\t\tlet dy = 0.5 * (oldbox.minY() + oldbox.maxY()) - 0.5 * (newbox.minY() + newbox.maxY());\n\t\t\tCoordUtil.translateMolecule(newmol, dx, dy);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet newbox = newmol.boundary();\n\t\t\tCoordUtil.translateMolecule(newmol, -newbox.midX(), -newbox.midY());\n\t\t}\n\n\t\tlet oldbox = oldmol.boundary(), newbox = newmol.boundary();\n\t\tlet cx = newbox.midX(), cy = newbox.midY();\n\t\tlet ROTN = [0, 30, 45, 60, 90, 120, 135, 150, 180, 210, 225, 240, 270, 300, 315, 330];\n\t\tduplicate: for (let n = 0; n < ROTN.length; n++)\n\t\t{\n\t\t\tlet rotmol = newmol.clone();\n\t\t\tCoordUtil.rotateMolecule(rotmol, -ROTN[n] * DEGRAD, cx, cy);\n\n\t\t\tfor (let i = 0; i < this.perms.length; i++)\n\t\t\t\tif (CoordUtil.sketchEquivalent(rotmol, this.perms[i].display)) continue duplicate;\n\n\t\t\tlet p = new FusionPermutation();\n\t\t\tp.mol = oldmol.clone();\n\t\t\tp.mol.append(rotmol);\n\t\t\tp.display = rotmol;\n\t\t\tp.srcidx = this.sourceIndex(p.mol, oldmol);\n\t\t\tp.attdist = 0;\n\t\t\tp.guided = false;\n\t\t\tthis.perms.push(p);\n\t\t}\n\t}\n\n\t// generate permutations with one atom reference point\n\tpublic permuteAtom(atom:number):void\n\t{\n\t\tthis.numAttach = 1;\n\n\t\tlet timeStart = new Date().getTime();\n\t\tlet oldmol = this.mol.clone(), newmol = this.templ.clone();\n\t\tlet newperms:FusionPermutation[] = [];\n\n\t\tif (this.guidetempl != null)\n\t\t{\n\t\t\tlet fliptempl = CoordUtil.mirrorImage(this.guidetempl.clone());\n\n\t\t\tfor (let n = 0; n < this.guideidx.length; n++)\n\t\t\t{\n\t\t\t\tif (new Date().getTime() - timeStart > this.timeLimit * 1000) break;\n\n\t\t\t\tthis.composeGuidedOne(newperms, oldmol, this.guidetempl, atom, this.guideidx[n]);\n\t\t\t\tthis.composeGuidedOne(newperms, oldmol, fliptempl, atom, this.guideidx[n]);\n\t\t\t}\n\t\t}\n\n\t\tif (!this.withGuideOnly)\n\t\t{\n\t\t\tlet flipmol = newmol.clone();\n\t\t\tCoordUtil.mirrorImage(flipmol);\n\n\t\t\tfor (let n = 1; n <= newmol.numAtoms; n++)\n\t\t\t{\n\t\t\t\tif (new Date().getTime() - timeStart > this.timeLimit * 1000) break;\n\n\t\t\t\tthis.composeDirectOne(newperms, oldmol, newmol, atom, n);\n\t\t\t\tthis.composeDirectOne(newperms, oldmol, flipmol, atom, n);\n\n\t\t\t\tthis.composeBridge(newperms, oldmol, newmol, atom, n);\n\t\t\t\tthis.composeBridge(newperms, oldmol, flipmol, atom, n);\n\t\t\t}\n\t\t}\n\n\t\tthis.affixRawPermutations(newperms);\n\t}\n\n\t// generate permutations with a bond reference point\n\tpublic permuteBond(a1:number, a2:number):void\n\t{\n\t\tthis.numAttach = 2;\n\n\t\tlet timeStart = new Date().getTime();\n\t\tlet oldmol = this.mol.clone(), newmol = this.templ.clone();\n\t\tlet newperms:FusionPermutation[] = [];\n\n\t\tif (this.guidetempl != null)\n\t\t{\n\t\t\tlet fliptempl = CoordUtil.mirrorImage(this.guidetempl.clone());\n\n\t\t\tfor (let i = 0; i < this.guideidx.length; i++)\n\t\t\t{\n\t\t\t\tif (new Date().getTime() - timeStart > this.timeLimit * 1000) break;\n\n\t\t\t\tlet g1 = this.guideidx[i];\n\t\t\t\tlet adj = this.guidetempl.atomAdjList(g1);\n\t\t\t\tfor (let j = 0; j < adj.length; j++)\n\t\t\t\t{\n\t\t\t\t\tlet g2 = adj[j];\n\n\t\t\t\t\tthis.composeGuidedTwo(newperms, oldmol, this.guidetempl, a1, a2, g1, g2, true);\n\t\t\t\t\tthis.composeGuidedTwo(newperms, oldmol, this.guidetempl, a2, a1, g1, g2, true);\n\t\t\t\t\tthis.composeGuidedTwo(newperms, oldmol, fliptempl, a1, a2, g1, g2, true);\n\t\t\t\t\tthis.composeGuidedTwo(newperms, oldmol, fliptempl, a2, a1, g1, g2, true);\n\n\t\t\t\t\tthis.composeGuidedTwo(newperms, oldmol, this.guidetempl, a1, a2, g1, g2, false);\n\t\t\t\t\tthis.composeGuidedTwo(newperms, oldmol, this.guidetempl, a2, a1, g1, g2, false);\n\t\t\t\t\tthis.composeGuidedTwo(newperms, oldmol, fliptempl, a1, a2, g1, g2, false);\n\t\t\t\t\tthis.composeGuidedTwo(newperms, oldmol, fliptempl, a2, a1, g1, g2, false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!this.withGuideOnly)\n\t\t{\n\t\t\tlet flipmol = newmol.clone();\n\t\t\tCoordUtil.mirrorImage(flipmol);\n\n\t\t\tfor (let n = 1; n <= newmol.numBonds; n++)\n\t\t\t{\n\t\t\t\tif (new Date().getTime() - timeStart > this.timeLimit * 1000) break;\n\n\t\t\t\tlet nfr = newmol.bondFrom(n), nto = newmol.bondTo(n);\n\t\t\t\tthis.composeDirectTwo(newperms, oldmol, newmol, a1, a2, nfr, nto);\n\t\t\t\tthis.composeDirectTwo(newperms, oldmol, flipmol, a1, a2, nfr, nto);\n\t\t\t\tthis.composeDirectTwo(newperms, oldmol, newmol, a1, a2, nto, nfr);\n\t\t\t\tthis.composeDirectTwo(newperms, oldmol, flipmol, a1, a2, nto, nfr);\n\t\t\t}\n\t\t}\n\n\t\tthis.affixRawPermutations(newperms);\n\t}\n\n\t// generate permutations with many reference points\n\tpublic permuteMulti(atoms:number[]):void\n\t{\n\t\tthis.numAttach = atoms.length;\n\n\t\tlet timeStart = new Date().getTime();\n\t\tlet oldmol = this.mol.clone(), newmol = this.templ.clone();\n\t\tlet newperms:FusionPermutation[] = [];\n\n\t\tif (this.guidetempl != null)\n\t\t{\n\t\t\tlet fliptempl = CoordUtil.mirrorImage(this.guidetempl.clone());\n\n\t\t\tif (this.guideidx.length == atoms.length)\n\t\t\t{\n\t\t\t\tthis.composeGuidedMulti(newperms, oldmol, this.guidetempl, atoms, this.guideidx, true);\n\t\t\t\tthis.composeGuidedMulti(newperms, oldmol, fliptempl, atoms, this.guideidx, true);\n\t\t\t}\n\t\t\tif (this.guideadj.length == atoms.length)\n\t\t\t{\n\t\t\t\tthis.composeGuidedMulti(newperms, oldmol, this.guidetempl, atoms, this.guideadj, false);\n\t\t\t\tthis.composeGuidedMulti(newperms, oldmol, fliptempl, atoms, this.guideadj, false);\n\t\t\t}\n\t\t}\n\n\t\tif (!this.withGuideOnly)\n\t\t{\n\t\t\tlet flipmol = newmol.clone();\n\t\t\tCoordUtil.mirrorImage(flipmol);\n\n\t\t\tfor (let n = 1; n <= newmol.numAtoms; n++)\n\t\t\t{\n\t\t\t\tif (new Date().getTime() - timeStart > this.timeLimit * 1000) break;\n\n\t\t\t\tthis.composeDirectMulti(newperms, oldmol, newmol, atoms, n);\n\t\t\t\tthis.composeDirectMulti(newperms, oldmol, flipmol, atoms, n);\n\t\t\t}\n\t\t}\n\n\t\tthis.affixRawPermutations(newperms);\n\t}\n\n\t// ------------------ private methods --------------------\n\n\tprivate huntForGuides():void\n\t{\n\t\tthis.guideidx = [];\n\t\tthis.guideadj = [];\n\t\tfor (let n = 1; n <= this.templ.numAtoms; n++) if (this.templ.atomElement(n) == 'X' && this.templ.atomAdjCount(n) > 0)\n\t\t{\n\t\t\tthis.guideidx.push(n);\n\t\t\tlet adj = this.templ.atomAdjList(n);\n\t\t\tfor (let i = 0; i < adj.length; i++) if (this.guideadj.indexOf(adj[i]) < 0) this.guideadj.push(adj[i]);\n\t\t}\n\t\tif (this.guideidx.length > 0)\n\t\t{\n\t\t\tthis.guidetempl = this.templ.clone();\n\t\t\tfor (let n = this.guideidx.length - 1; n >= 0; n--) this.templ.deleteAtomAndBonds(this.guideidx[n]);\n\t\t}\n\t}\n\tprivate composeDirectOne(list:FusionPermutation[], oldmol:Molecule, newmol:Molecule, o1:number, n1:number)\n\t{\n\t\tlet otheta = SketchUtil.primeDirections(oldmol, o1);\n\t\tlet ntheta = SketchUtil.primeDirections(newmol, n1);\n\t\tlet ocurrent = CoordUtil.atomBondAngles(oldmol, o1);\n\t\tlet ncurrent = CoordUtil.atomBondAngles(newmol, n1);\n\n\t\t// create the list of angle matches to try out\n\t\tlet theta1:number[] = [], theta2:number[] = [], scoreMod:number[] = [];\n\n\t\tfor (let i = 0; i < ocurrent.length; i++) for (let j = 0; j < ntheta.length; j++)\n\t\t{\n\t\t\ttheta1.push(ocurrent[i]);\n\t\t\ttheta2.push(ntheta[j]);\n\t\t\tscoreMod.push(-51);\n\t\t}\n\t\tfor (let i = 0; i < otheta.length; i++) for (let j = 0; j < ncurrent.length; j++)\n\t\t{\n\t\t\ttheta1.push(otheta[i]);\n\t\t\ttheta2.push(ncurrent[j]);\n\t\t\tscoreMod.push(0);\n\t\t}\n\t\tfor (let i = 0; i < otheta.length; i++) for (let j = 0; j < ntheta.length; j++)\n\t\t{\n\t\t\ttheta1.push(otheta[i]);\n\t\t\ttheta2.push(ntheta[j]);\n\t\t\tscoreMod.push(0);\n\t\t}\n\n\t\t// now combine them\n\t\tlet bfs = Graph.fromMolecule(newmol).calculateBFS(0);\n\t\tlet ox = oldmol.atomX(o1), oy = oldmol.atomY(o1), nx = newmol.atomX(n1), ny = newmol.atomY(n1);\n\t\tfor (let n = 0; n < theta1.length; n++)\n\t\t{\n\t\t\tlet dth = angleDiff(theta1[n], theta2[n]);\n\t\t\tlet frag = newmol.clone();\n\t\t\tCoordUtil.translateMolecule(frag, ox - nx, oy - ny);\n\t\t\tCoordUtil.rotateMolecule(frag, dth, ox, oy);\n\n\t\t\tlet pmol = oldmol.clone();\n\t\t\tlet osz = pmol.numAtoms;\n\t\t\tpmol.append(frag);\n\t\t\tlet srcidx = this.sourceIndex(pmol, oldmol);\n\t\t\tSketchUtil.mergeFragmentsMask(pmol, this.asMask(srcidx));\n\n\t\t\tif (pmol.numAtoms == osz) continue;\n\n\t\t\tlet p = new FusionPermutation();\n\t\t\tp.mol = pmol;\n\t\t\tp.display = frag;\n\t\t\tp.srcidx = srcidx;\n\t\t\tp.molidx = [o1];\n\t\t\tp.temidx = [n1];\n\t\t\tp.attdist = bfs[n1 - 1];\n\t\t\tp.guided = false;\n\t\t\tp.scoreModifier = scoreMod[n];\n\t\t\tthis.removeExtraGuides(p, oldmol);\n\t\t\tlist.push(p);\n\t\t}\n\t}\n\tprivate composeDirectTwo(list:FusionPermutation[], oldmol:Molecule, newmol:Molecule, o1:number, o2:number, n1:number, n2:number):void\n\t{\n\t\tlet oth = Math.atan2(oldmol.atomY(o2) - oldmol.atomY(o1), oldmol.atomX(o2) - oldmol.atomX(o1));\n\t\tlet nth = Math.atan2(newmol.atomY(n2) - newmol.atomY(n1), newmol.atomX(n2) - newmol.atomX(n1));\n\t\tlet cx = 0.5 * (oldmol.atomX(o1) + oldmol.atomX(o2)), cy = 0.5 * (oldmol.atomY(o1) + oldmol.atomY(o2));\n\n\t\tlet frag = newmol.clone();\n\t\tCoordUtil.translateMolecule(frag, cx - 0.5 * (newmol.atomX(n1) + newmol.atomX(n2)), cy - 0.5 * (newmol.atomY(n1) + newmol.atomY(n2)));\n\t\tCoordUtil.rotateMolecule(frag, oth - nth, cx, cy);\n\t\tfrag.setAtomPos(n1, oldmol.atomX(o1), oldmol.atomY(o1));\n\t\tfrag.setAtomPos(n2, oldmol.atomX(o2), oldmol.atomY(o2));\n\n\t\tlet pmol = oldmol.clone();\n\t\tlet osz = pmol.numAtoms;\n\t\tpmol.append(frag);\n\t\tlet srcidx = this.sourceIndex(pmol, oldmol);\n\t\tSketchUtil.mergeFragmentsMask(pmol, this.asMask(srcidx));\n\n\t\tif (pmol.numAtoms == osz) return;\n\n\t\tlet bfs = Graph.fromMolecule(newmol).calculateBFS(0);\n\n\t\tlet p = new FusionPermutation();\n\t\tp.mol = pmol;\n\t\tp.display = frag;\n\t\tp.srcidx = srcidx;\n\t\tp.molidx = [o1, o2];\n\t\tp.temidx = [n1, n2];\n\t\tp.attdist = Math.min(bfs[n1 - 1], bfs[n2 - 1]);\n\t\tp.guided = false;\n\t\tthis.removeExtraGuides(p, oldmol);\n\t\tlist.push(p);\n\t}\n\tprivate composeDirectMulti(list:FusionPermutation[], oldmol:Molecule, newmol:Molecule, oidx:number[], n1:number):void\n\t{\n\t\tlet frag = newmol.clone();\n\n\t\tlet x0 = oldmol.atomX(oidx[0]), y0 = oldmol.atomY(oidx[0]);\n\t\tCoordUtil.translateMolecule(frag, x0 - frag.atomX(n1), y0 - frag.atomY(n1));\n\t\tlet ox = oldmol.atomX(oidx[1]) - x0, oy = oldmol.atomY(oidx[1]) - y0;\n\t\tlet otheta = Math.atan2(oy, ox), orad = norm_xy(ox, oy);\n\n\t\tlet bfs = Graph.fromMolecule(newmol).calculateBFS(1);\n\t\tlet nidx:number[] = [];\n\n\t\tfor (let n2 = 1; n2 <= frag.numAtoms; n2++) if (n1 != n2)\n\t\t{\n\t\t\tlet nx = frag.atomX(n2) - frag.atomX(n1), ny = frag.atomY(n2) - frag.atomY(n1), nrad = norm_xy(nx, ny);\n\t\t\tif (Math.abs(nrad - orad) > 0.1) continue; // no point in trying to map {o1,o2} to {n1,n2}\n\t\t\tlet ntheta = Math.atan2(ny, nx);\n\t\t\tCoordUtil.rotateMolecule(frag, otheta - ntheta, x0, y0);\n\n\t\t\tnidx = [n1, n2];\n\n\t\t\tfor (let i = 2; i < oidx.length; i++)\n\t\t\t{\n\t\t\t\tlet hit = false;\n\t\t\t\tfor (let j = 1; j <= frag.numAtoms; j++) if (nidx.indexOf(j) < 0)\n\t\t\t\t\tif (norm_xy(oldmol.atomX(oidx[i]) - frag.atomX(j), oldmol.atomY(oidx[i]) - frag.atomY(j)) < 0.1 * 0.1)\n\t\t\t\t{\n\t\t\t\t\thit = true;\n\t\t\t\t\tnidx.push(j);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (!hit) break;\n\t\t\t}\n\n\t\t\tif (nidx.length < oidx.length) continue;\n\n\t\t\tlet lowbfs = bfs.length;\n\t\t\tfor (let n = 0; n < nidx.length; n++) lowbfs = Math.min(lowbfs, bfs[nidx[n] - 1]);\n\n\t\t\tlet dx = 0, dy = 0;\n\t\t\tfor (let n = 0; n < oidx.length; n++)\n\t\t\t{\n\t\t\t\tdx += oldmol.atomX(oidx[n]) - frag.atomX(nidx[n]);\n\t\t\t\tdy += oldmol.atomY(oidx[n]) - frag.atomY(nidx[n]);\n\t\t\t}\n\t\t\tlet invsz = 1.0 / oidx.length;\n\t\t\tdx *= invsz;\n\t\t\tdy *= invsz;\n\t\t\tCoordUtil.translateMolecule(frag, dx, dy);\n\n\t\t\tlet pmol = oldmol.clone();\n\t\t\tlet osz = pmol.numAtoms;\n\t\t\tpmol.append(frag);\n\t\t\tlet srcidx = this.sourceIndex(pmol, oldmol);\n\n\t\t\tfor (let n = 0; n < nidx.length; n++)\n\t\t\t{\n\t\t\t\tlet x = pmol.atomX(oidx[n]), y = pmol.atomY(oidx[n]);\n\t\t\t\tpmol.setAtomPos(osz + nidx[n], x, y);\n\t\t\t}\n\t\t\tSketchUtil.mergeFragmentsMask(pmol, this.asMask(srcidx));\n\t\t\tif (pmol.numAtoms == osz) continue;\n\n\t\t\tlet p = new FusionPermutation();\n\t\t\tp.mol = pmol;\n\t\t\tp.display = frag.clone();\n\t\t\tp.srcidx = srcidx;\n\t\t\tp.molidx = oidx.slice(0);\n\t\t\tp.temidx = nidx.slice(0);\n\t\t\tp.attdist = Math.min(bfs[n1 - 1], bfs[n2 - 1]);\n\t\t\tp.guided = false;\n\t\t\tthis.removeExtraGuides(p, oldmol);\n\t\t\tlist.push(p);\n\t\t}\n\t}\n\tprivate composeBridge(list:FusionPermutation[], oldmol:Molecule, newmol:Molecule, o1:number, n1:number):void\n\t{\n\t\tlet busy1 = oldmol.atomRingBlock(o1) != 0 || oldmol.atomAdjCount(o1) >= 3;\n\t\tlet busy2 = newmol.atomRingBlock(n1) != 0 || newmol.atomAdjCount(n1) >= 3;\n\t\tif (!busy1 || !busy2) return;\n\n\t\tlet otheta = SketchUtil.primeDirections(oldmol, o1);\n\t\tlet ntheta = SketchUtil.primeDirections(newmol, n1);\n\n\t\tlet bfs = Graph.fromMolecule(newmol).calculateBFS(0);\n\n\t\tfor (let i = 0; i < otheta.length; i++) for (let j = 0; j < ntheta.length; j++)\n\t\t{\n\t\t\tlet ox = oldmol.atomX(o1), oy = oldmol.atomY(o1), nx = newmol.atomX(n1), ny = newmol.atomY(n1);\n\t\t\tlet dx = Molecule.IDEALBOND * Math.cos(otheta[i]), dy = Molecule.IDEALBOND * Math.sin(otheta[i]);\n\t\t\tlet dth = angleDiff(otheta[i], Math.PI + ntheta[j]);\n\t\t\tlet frag = newmol.clone();\n\n\t\t\tCoordUtil.translateMolecule(frag, ox - nx + dx, oy - ny + dy);\n\t\t\tCoordUtil.rotateMolecule(frag, dth, ox + dx, oy + dy);\n\t\t\tlet pmol = oldmol.clone();\n\n\t\t\tlet att = pmol.numAtoms + n1, osz = pmol.numAtoms;\n\t\t\tpmol.append(frag);\n\t\t\tlet srcidx = this.sourceIndex(pmol, oldmol);\n\t\t\tpmol.addBond(o1, att, 1);\n\n\t\t\tatt = frag.addAtom('C', ox, oy);\n\t\t\tfrag.addBond(n1, att, 1);\n\n\t\t\tSketchUtil.mergeFragmentsMask(pmol, this.asMask(srcidx));\n\t\t\tif (pmol.numAtoms == osz) continue;\n\n\t\t\tlet p = new FusionPermutation();\n\t\t\tp.mol = pmol;\n\t\t\tp.display = frag;\n\t\t\tp.srcidx = srcidx;\n\t\t\tp.molidx = [o1];\n\t\t\tp.temidx = [att];\n\t\t\tp.attdist = bfs[n1 - 1];\n\t\t\tp.bridged = true;\n\t\t\tp.guided = false;\n\t\t\tthis.removeExtraGuides(p, oldmol);\n\t\t\tlist.push(p);\n\t\t}\n\t}\n\tprivate composeGuidedOne(list:FusionPermutation[], oldmol:Molecule, newmol:Molecule, oidx:number, gidx:number):void\n\t{\n\t\tif (newmol.atomAdjCount(gidx) == 0) return;\n\n\t\tlet otheta = SketchUtil.primeDirections(oldmol, oidx);\n\n\t\t// special deal: if the attachment is multidentate, make sure there is an out-jutting angle that is the simple average of the other\n\t\t// constituents' opposites, since regular bond angles are less definitively useful\n\t\tif (newmol.atomAdjCount(gidx) > 1 && oldmol.atomAdjCount(oidx) > 0)\n\t\t{\n\t\t\tlet ox = 0, oy = 0;\n\t\t\tlet adj = oldmol.atomAdjList(oidx);\n\t\t\tfor (let n = 0; n < adj.length; n++)\n\t\t\t{\n\t\t\t\tox += oldmol.atomX(adj[n]) - oldmol.atomX(oidx);\n\t\t\t\toy += oldmol.atomY(adj[n]) - oldmol.atomY(oidx);\n\t\t\t}\n\t\t\tlet ang = Math.atan2(oy, ox);\n\t\t\tlet unique = true;\n\t\t\tfor (let n = 0; n < otheta.length; n++) if (Math.abs(angleDiff(ang, otheta[n])) < 3 * RADDEG)\n\t\t\t{\n\t\t\t\tunique = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (unique) otheta.push(ang);\n\t\t}\n\n\t\tlet gx = newmol.atomX(gidx), gy = newmol.atomY(gidx);\n\t\tlet dx = 0, dy = 0;\n\t\tlet adj = newmol.atomAdjList(gidx);\n\t\tfor (let n = 0; n < adj.length; n++)\n\t\t{\n\t\t\tdx += newmol.atomX(adj[n]) - gx;\n\t\t\tdy += newmol.atomY(adj[n]) - gy;\n\t\t}\n\t\tdx /= adj.length;\n\t\tdy /= adj.length;\n\t\tlet ntheta = Math.atan2(dy, dx);\n\n\t\tlet homoPenalty = 0;\n\t\tif (adj.length == 1)\n\t\t{\n\t\t\tlet oel = oldmol.atomElement(oidx), nel = newmol.atomElement(adj[0]);\n\t\t\tif (oel != 'C' && oel == nel) homoPenalty = 1; // penalty points for het-het joining\n\t\t}\n\n\t\tfor (let n = 0; n < otheta.length; n++)\n\t\t{\n\t\t\tlet frag = newmol.clone();\n\n\t\t\t// special deal: if two guide indexes, would like to post-select the second one\n\t\t\tif (this.guideidx.length == 2)\n\t\t\t{\n\t\t\t\tfor (let i = 1; i <= frag.numAtoms; i++) if (i != gidx && frag.atomElement(i) == 'X')\n\t\t\t\t{\n\t\t\t\t\tfrag.setAtomElement(i, TemplateFusion.RESERVED_GUIDESYMBOL);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tCoordUtil.rotateMolecule(frag, otheta[n] - ntheta, gx, gy);\n\t\t\tCoordUtil.translateMolecule(frag, oldmol.atomX(oidx) - gx, oldmol.atomY(oidx) - gy);\n\n\t\t\tlet pmol = oldmol.clone();\n\t\t\tlet osz = pmol.numAtoms;\n\t\t\tpmol.append(frag);\n\n\t\t\tlet srcidx = this.sourceIndex(pmol, oldmol);\n\t\t\tSketchUtil.mergeFragmentsMask(pmol, this.asMask(srcidx));\n\t\t\tif (pmol.numAtoms == osz) continue;\n\n\t\t\t// look for a next-current option\n\t\t\tlet sel = 0;\n\t\t\tfor (let i = 1; i <= pmol.numAtoms; i++) if (pmol.atomElement(i) == TemplateFusion.RESERVED_GUIDESYMBOL)\n\t\t\t{\n\t\t\t\tlet padj = pmol.atomAdjList(i);\n\t\t\t\tif (padj.length == 1)\n\t\t\t\t{\n\t\t\t\t\tsel = padj[0];\n\t\t\t\t\tif (sel > i) sel--;\n\t\t\t\t}\n\t\t\t\tpmol.deleteAtomAndBonds(i);\n\t\t\t\tsrcidx.splice(i - 1, 1);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tlet p = new FusionPermutation();\n\t\t\tp.mol = pmol;\n\t\t\tp.display = frag;\n\t\t\tp.srcidx = srcidx;\n\t\t\tp.molidx = [oidx];\n\t\t\tp.temidx = [gidx];\n\t\t\tp.attdist = 0;\n\t\t\tp.guided = true;\n\t\t\tp.scoreModifier = homoPenalty;\n\t\t\tp.chainSelect = sel;\n\t\t\tthis.removeExtraGuides(p, oldmol);\n\t\t\tlist.push(p);\n\t\t}\n\t}\n\tprivate composeGuidedTwo(list:FusionPermutation[], oldmol:Molecule, newmol:Molecule,\n\t\t\t\t\t\t\to1:number, o2:number, gidx:number, nidx:number, snapToGuide:boolean):void\n\t{\n\t\tlet ox = oldmol.atomX(o1), oy = oldmol.atomY(o1);\n\t\tlet gx = newmol.atomX(gidx), gy = newmol.atomY(gidx);\n\t\tlet nx = newmol.atomX(nidx), ny = newmol.atomY(nidx);\n\t\tlet otheta = Math.atan2(oldmol.atomY(o2) - oy, oldmol.atomX(o2) - ox);\n\t\tlet gtheta = Math.atan2(ny - gy, nx - gx);\n\n\t\tlet isGuideOnTerminal = oldmol.atomAdjCount(o1) == 1; // prefer to stick the guide atom on a non-terminal atom\n\n\t\tlet pmol = oldmol.clone(), frag = newmol.clone();\n\t\tCoordUtil.rotateMolecule(frag, otheta - gtheta, gx, gy);\n\n\t\tif (snapToGuide)\n\t\t{\n\t\t\tCoordUtil.translateMolecule(frag, ox - gx, oy - gy);\n\t\t\tpmol.setAtomPos(o2, frag.atomX(nidx), frag.atomY(nidx));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tCoordUtil.translateMolecule(frag, oldmol.atomX(o2) - frag.atomX(nidx), oldmol.atomY(o2) - frag.atomY(nidx));\n\t\t\tfrag.setAtomPos(gidx, ox, oy);\n\t\t}\n\n\t\tlet osz = pmol.numAtoms;\n\t\tpmol.append(frag);\n\t\tlet srcidx = this.sourceIndex(pmol, oldmol);\n\t\tSketchUtil.mergeFragmentsMask(pmol, this.asMask(srcidx));\n\t\tif (pmol.numAtoms == osz) return;\n\n\t\tlet p = new FusionPermutation();\n\t\tp.mol = pmol;\n\t\tp.display = frag;\n\t\tp.srcidx = srcidx;\n\t\tp.molidx = [o1, o2];\n\t\tp.temidx = [gidx, nidx];\n\t\tp.attdist = isGuideOnTerminal ? 1 : 0;\n\t\tp.guided = true;\n\t\tthis.removeExtraGuides(p, oldmol);\n\t\tlist.push(p);\n\t}\n\tprivate composeGuidedMulti(list:FusionPermutation[], oldmol:Molecule, newmol:Molecule, oidx:number[], gidx:number[], nudgenew:boolean):void\n\t{\n\t\tlet cx1 = 0, cy1 = 0, cx2 = 0, cy2 = 0;\n\t\tfor (let n = 0; n < oidx.length; n++)\n\t\t{\n\t\t\tcx1 += oldmol.atomX(oidx[n]);\n\t\t\tcy1 += oldmol.atomY(oidx[n]);\n\t\t}\n\t\tfor (let n = 0; n < gidx.length; n++)\n\t\t{\n\t\t\tcx2 += newmol.atomX(gidx[n]);\n\t\t\tcy2 += newmol.atomY(gidx[n]);\n\t\t}\n\t\tcx1 /= oidx.length;\n\t\tcy1 /= oidx.length;\n\t\tcx2 /= gidx.length;\n\t\tcy2 /= gidx.length;\n\n\t\tlet osz = oldmol.numAtoms;\n\n\t\tfor (let i = 0; i < oidx.length; i++) for (let j = 0; j < gidx.length; j++)\n\t\t{\n\t\t\tlet pmol = oldmol.clone(), frag = newmol.clone();\n\t\t\tlet th1 = Math.atan2(pmol.atomY(oidx[i]) - cy1, pmol.atomX(oidx[i]) - cx1);\n\t\t\tlet th2 = Math.atan2(frag.atomY(gidx[j]) - cy2, frag.atomX(gidx[j]) - cx2);\n\t\t\tCoordUtil.rotateMolecule(frag, th1 - th2, cx2, cy2);\n\t\t\tCoordUtil.translateMolecule(frag, cx1 - cx2, cy1 - cy2);\n\t\t\tpmol.append(frag);\n\n\t\t\tlet srcidx = this.sourceIndex(pmol, oldmol);\n\t\t\tlet midx = Vec.numberArray(0, gidx.length), tidx = gidx.slice(0);\n\t\t\tVec.sort(tidx);\n\t\t\tlet mask = Vec.booleanArray(false, osz);\n\n\t\t\tfor (let g = tidx.length - 1; g >= 0; g--)\n\t\t\t{\n\t\t\t\tlet gatom = tidx[g] + osz;\n\t\t\t\tlet closest = 0, closeDSQ = 0;\n\t\t\t\tfor (let n = 0; n < oidx.length; n++) if (!mask[oidx[n] - 1])\n\t\t\t\t{\n\t\t\t\t\tlet dx = pmol.atomX(oidx[n]) - pmol.atomX(gatom), dy = pmol.atomY(oidx[n]) - pmol.atomY(gatom);\n\t\t\t\t\tlet dsq = norm_xy(dx, dy);\n\t\t\t\t\tif (closest == 0 || dsq < closeDSQ)\n\t\t\t\t\t{\n\t\t\t\t\t\tclosest = oidx[n];\n\t\t\t\t\t\tcloseDSQ = dsq;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!nudgenew)\n\t\t\t\t{\n\t\t\t\t\tlet dsq = norm_xy(pmol.atomX(gatom) - pmol.atomX(closest), pmol.atomY(gatom) - pmol.atomY(closest));\n\t\t\t\t\tif (dsq > 0.1 * 0.1)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet num = frag.addAtom('C', pmol.atomX(closest), pmol.atomY(closest));\n\t\t\t\t\t\tfrag.addBond(num, tidx[g], 0);\n\t\t\t\t\t}\n\n\t\t\t\t\tpmol.setAtomPos(closest, pmol.atomX(gatom), pmol.atomY(gatom));\n\t\t\t\t}\n\n\t\t\t\tmidx[g] = closest;\n\t\t\t\tmask[closest - 1] = true;\n\t\t\t\tlet adj = pmol.atomAdjList(gatom);\n\t\t\t\tfor (let n = 0; n < adj.length; n++)\n\t\t\t\t{\n\t\t\t\t\tlet b = pmol.findBond(gatom, adj[n]);\n\t\t\t\t\tpmol.addBond(closest, adj[n], pmol.bondOrder(b), pmol.bondType(b));\n\t\t\t\t}\n\t\t\t\tpmol.deleteAtomAndBonds(gatom);\n\t\t\t\tsrcidx.splice(gatom - 1, 1);\n\n\t\t\t\tfrag.setAtomPos(tidx[g], pmol.atomX(closest), pmol.atomY(closest));\n\t\t\t}\n\n\t\t\tfor (let n = pmol.numAtoms; n > osz; n--) if (pmol.atomElement(n) == 'X')\n\t\t\t{\n\t\t\t\tpmol.deleteAtomAndBonds(n);\n\t\t\t\tsrcidx.splice(n - 1, 1);\n\t\t\t\tfor (let k = 0; k < tidx.length; k++) if (n < tidx[k]) tidx[k]--;\n\t\t\t}\n\t\t\tfor (let n = frag.numAtoms; n >= 1; n--) if (frag.atomElement(n) == 'X')\n\t\t\t{\n\t\t\t\t//[frag deleteAtomAndBonds:n];\n\t\t\t\tfrag.setAtomElement(n, 'C');\n\t\t\t}\n\n\t\t\tlet p = new FusionPermutation();\n\t\t\tp.mol = pmol;\n\t\t\tp.display = frag;\n\t\t\tp.srcidx = srcidx;\n\t\t\tp.molidx = midx;\n\t\t\tp.temidx = tidx;\n\t\t\tp.attdist = 0;\n\t\t\tp.guided = true;\n\t\t\tthis.removeExtraGuides(p, oldmol);\n\t\t\tlist.push(p);\n\t\t}\n\t}\n\n\t// add specified permutations to the main list, after filtering and sorting\n\tprivate affixRawPermutations(list:FusionPermutation[]):void\n\t{\n\t\tlet npsz = list.length;\n\t\tif (npsz == 0) return;\n\n\t\tlet umask = Vec.booleanArray(true, npsz);\n\t\tfor (let i = 0; i < npsz - 1; i++) if (umask[i])\n\t\t{\n\t\t\tlet p1 = list[i];\n\t\t\tfor (let j = i + 1; j < npsz; j++) if (umask[j])\n\t\t\t{\n\t\t\t\tlet p2 = list[j];\n\t\t\t\tif (CoordUtil.sketchEquivalent(p1.mol, p2.mol))\n\t\t\t\t{\n\t\t\t\t\tif (p1.scoreModifier + p1.attdist > p2.scoreModifier + p2.attdist)\n\t\t\t\t\t{\n\t\t\t\t\t\tlist[i] = p2;\n\t\t\t\t\t\tlist[j] = p1;\n\t\t\t\t\t}\n\t\t\t\t\tumask[j] = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet score = Vec.numberArray(0, npsz);\n\t\tlet numKeep = 0;\n\t\tfor (let n = 0; n < npsz; n++)\n\t\t{\n\t\t\tif (umask[n])\n\t\t\t{\n\t\t\t\tscore[n] = this.scorePermutation(list[n]);\n\t\t\t\tif (score[n] < 1000) numKeep++;\n\t\t\t}\n\t\t\telse score[n] = 0;\n\t\t}\n\n\t\tif (numKeep > 0) for (let n = 0; n < npsz; n++) if (umask[n] && score[n] >= 1000) umask[n] = false;\n\n\t\tlet uscore:number[] = [], uidx:number[] = [];\n\t\tfor (let n = 0; n < npsz; n++) if (umask[n])\n\t\t{\n\t\t\tuscore.push(score[n]);\n\t\t\tuidx.push(n);\n\t\t}\n\t\tlet sidx = Vec.idxSort(uscore);\n\n\t\tfor (let n = 0; n < sidx.length; n++)\n\t\t{\n\t\t\tlet p = list[uidx[sidx[n]]];\n\t\t\tif (p.guided)\n\t\t\t{\n\t\t\t\tthis.perms.push(p);\n\t\t\t\t//if (DEBUG) Util.writeln(\"PERM#\" + perms.size() + \" score=\" + score[uidx.get(sidx[n])] + \" scoremod=\" + p.scoreModifier + \" attdist:\" + p.attdist);\n\t\t\t}\n\t\t}\n\t\tfor (let n = 0; n < sidx.length; n++)\n\t\t{\n\t\t\tlet p = list[uidx[sidx[n]]];\n\t\t\tif (!p.guided)\n\t\t\t{\n\t\t\t\tthis.perms.push(p);\n\t\t\t\t//if (DEBUG) Util.writeln(\"PERM#\" + perms.size() + \" score=\" + score[uidx.get(sidx[n])] + \" scoremod=\" + p.scoreModifier + \" attdist:\" + p.attdist);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate removeExtraGuides(perm:FusionPermutation, oldmol:Molecule):void\n\t{\n\t\tMolUtil.removeDuplicateBonds(perm.mol);\n\t\tfor (let n = perm.temidx.length - 1; n >= 0; n--)\n\t\t{\n\t\t\tlet el = perm.display.atomElement(perm.temidx[n]);\n\t\t\tif (el != 'X' && el != TemplateFusion.RESERVED_GUIDESYMBOL) continue;\n\t\t\tperm.molidx.splice(n, 1);\n\t\t\tperm.temidx.splice(n, 1);\n\t\t}\n\n\t\t// residual guide atoms either get axed or turned into carbons, so they just display as projected lines\n\t\tfor (let n = perm.display.numAtoms; n >= 1; n--)\n\t\t{\n\t\t\tlet el = perm.display.atomElement(n);\n\t\t\tif (el != 'X' && el != TemplateFusion.RESERVED_GUIDESYMBOL) continue;\n\n\t\t\tlet a = CoordUtil.atomAtPoint(oldmol, perm.display.atomX(n), perm.display.atomY(n));\n\t\t\tif (a > 0) perm.display.setAtomElement(n, 'C');\n\t\t\telse\n\t\t\t{\n\t\t\t\tperm.display.deleteAtomAndBonds(n);\n\t\t\t\tfor (let i = 0; i < perm.temidx.length; i++) if (perm.temidx[i] > n) perm.temidx[i]--;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate scorePermutation(perm:FusionPermutation):number\n\t{\n\t\t// note: lower is better\n\n\t\tlet mol = this.mol, tmol = perm.display, tunion = perm.mol; // (clarity)\n\n\t\tlet score = 0.2 * perm.attdist + perm.scoreModifier;\n\n\t\tscore += CoordUtil.congestionMolecule(tunion, 1e-3);\n\t\tscore -= tunion.numAtoms;\n\n\t\tlet sz1 = mol.numAtoms, sz2 = tmol.numAtoms;\n\t\tlet mx1:number[] = [], my1:number[] = [], mx2:number[] = [], my2:number[] = [];\n\t\tfor (let n = 0; n < sz1; n++)\n\t\t{\n\t\t\tmx1.push(mol.atomX(n + 1));\n\t\t\tmy1.push(mol.atomY(n + 1));\n\t\t}\n\t\tfor (let n = 0; n < sz2; n++)\n\t\t{\n\t\t\tmx2.push(tmol.atomX(n + 1));\n\t\t\tmy2.push(tmol.atomY(n + 1));\n\t\t}\n\n\t\tfor (let i = 0; i < sz1; i++) for (let j = 0; j < sz2; j++)\n\t\t{\n\t\t\tif (norm_xy(mx1[i] - mx2[j], my1[i] - my2[j]) > CoordUtil.OVERLAP_THRESHOLD_SQ) continue;\n\t\t\tlet contained = false;\n\t\t\tfor (let k = 0; k < perm.molidx.length; k++) if (perm.molidx[k] == i + 1 && perm.temidx[k] == j + 1)\n\t\t\t{\n\t\t\t\tcontained = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (contained) continue;\n\n\t\t\tscore += 100;\n\t\t}\n\n\t\t// look for new geometries which would be a bit too funky; do not apply to guided atom fusions\n\t\tif (!perm.guided) for (let n = 0; n < perm.molidx.length; n++)\n\t\t{\n\t\t\tlet el = mol.atomElement(perm.molidx[n]);\n\t\t\tif (el == 'C' || el == 'O' || el == 'S' || el == 'N' || el == 'P') continue;\n\n\t\t\tlet adj1 = mol.atomAdjList(perm.molidx[n]), adj2 = tmol.atomAdjList(perm.temidx[n]);\n\t\t\tif (adj1.length + adj2.length >= 4) continue;\n\n\t\t\tfor (let i = 0; i < adj1.length; i++) for (let j = 0; j < adj2.length; j++)\n\t\t\t{\n\t\t\t\tlet ai = adj1[i], aj = adj2[j];\n\t\t\t\tlet bo1 = mol.bondOrder(mol.findBond(perm.molidx[n], ai));\n\t\t\t\tlet bo2 = tmol.bondOrder(tmol.findBond(perm.temidx[n], aj));\n\n\t\t\t\tlet wantTheta = 0;\n\t\t\t\tif ((bo1 == 1 && bo2 == 1) || (bo1 == 1 && bo2 == 2) || (bo1 == 2 && bo2 == 1)) wantTheta = 120;\n\t\t\t\telse if ((bo1 == 2 && bo2 == 2) || (bo1 == 1 && bo2 == 3) || (bo1 == 3 && bo2 == 1)) wantTheta = 180;\n\t\t\t\telse continue;\n\n\t\t\t\tlet dx1 = mx1[ai - 1] - mx1[perm.molidx[n] - 1];\n\t\t\t\tlet dy1 = my1[ai - 1] - my1[perm.molidx[n] - 1];\n\t\t\t\tlet dx2 = mx2[aj - 1] - mx2[perm.temidx[n] - 1];\n\t\t\t\tlet dy2 = my2[aj - 1] - my2[perm.temidx[n] - 1];\n\t\t\t\tlet theta = Math.abs(angleDiff(Math.atan2(dy1, dx1), Math.atan2(dy2, dx2))) * RADDEG;\n\t\t\t\tif (Math.abs(theta - wantTheta) > 5) score += 50; // penalty\n\t\t\t}\n\t\t}\n\n\t\t// look for creation of hypervalent lighter atoms, which is considered a big faux pas\n\t\tfor (let n = 1; n <= tunion.numAtoms; n++) if (tunion.atomElement(n) == 'C' || tunion.atomElement(n) == 'N')\n\t\t{\n\t\t\tlet adjb = tunion.atomAdjBonds(n);\n\t\t\tlet totalBO = 0;\n\t\t\tfor (let i = 0; i < adjb.length; i++)\n\t\t\t{\n\t\t\t\tlet bo = tunion.bondOrder(adjb[i]);\n\t\t\t\ttotalBO += bo;\n\t\t\t\tif (bo == 0)\n\t\t\t\t{\n\t\t\t\t\ttotalBO = 0;\n\t\t\t\t\tbreak;\n\t\t\t\t} // any of these, nothing matters anymore\n\t\t\t}\n\t\t\tif (totalBO > 4) score += 1000;\n\t\t}\n\n\t\t// match bond orders, whenever possible\n\t\tif (perm.molidx.length >= 2)\n\t\t{\n\t\t\tlet mmask = Vec.booleanArray(false, sz1);\n\t\t\tfor (let n = 0; n < perm.molidx.length; n++) mmask[perm.molidx[n] - 1] = true;\n\t\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t\t{\n\t\t\t\tlet bfr = mol.bondFrom(n), bto = mol.bondTo(n);\n\t\t\t\tif (!mmask[bfr - 1] || !mmask[bto - 1]) continue;\n\t\t\t\tlet tfr = perm.molidx.indexOf(bfr), tto = perm.molidx.indexOf(bto);\n\t\t\t\tlet tn = tmol.findBond(perm.temidx[tfr], perm.temidx[tto]);\n\t\t\t\tif (tn == 0) continue;\n\t\t\t\tif (mol.bondOrder(n) != tmol.bondOrder(tn)) score += 1;\n\t\t\t}\n\t\t}\n\n\t\treturn score;\n\t}\n\n\tprivate sourceIndex(xmol:Molecule, wmol:Molecule):number[]\n\t{\n\t\tlet idx = Vec.numberArray(0, xmol.numAtoms);\n\t\tfor (let n = wmol.numAtoms; n >= 1; n--) idx[n - 1] = n;\n\t\treturn idx;\n\t}\n\tprivate asMask(imask:number[]):boolean[]\n\t{\n\t\tlet ret = Vec.booleanArray(false, imask.length);\n\t\tfor (let n = 0; n < imask.length; n++) ret[n] = imask[n] != 0;\n\t\treturn ret;\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\n///<reference path='../ui/ButtonBank.ts'/>\n\nimport {Molecule} from '../data/Molecule';\nimport {Geometry} from '../data/SketchUtil';\nimport {ButtonBank, ButtonBankItem} from '../ui/ButtonBank';\nimport {KeyCode} from '../util/util';\nimport {ActivityType, MoleculeActivity} from './MoleculeActivity';\n\n/* eslint-disable no-multi-spaces, comma-spacing */\n\n/*\n\tCommandBank: the various bank styles that correspond to actions (select-then-do, as opposed to toolbank style which\n\tis pick-then-interact).\n*/\n\nconst ELEMENTS_NOBLE:string[] =\n[\n\t'He', 'Ar', 'Kr', 'Xe', 'Rn'\n];\n\nconst ELEMENTS_S_BLOCK:string[] =\n[\n\t'Li', 'Na', 'K',  'Rb', 'Cs', 'Fr', 'Sc',\n\t'Be', 'Mg', 'Ca', 'Sr', 'Ba', 'Ra', 'Y'\n];\n\nconst ELEMENTS_P_BLOCK:string[] =\n[\n\t'B',  'Al', 'Si', 'Ga', 'Ge', 'As', 'Se',\n\t'In', 'Sn', 'Sb', 'Te', 'Tl', 'Pb', 'Bi', 'Po', 'At'\n];\n\nconst ELEMENTS_D_BLOCK:string[] =\n[\n\t'Ti', 'V' , 'Cr', 'Mn', 'Fe', 'Co', 'Ni', 'Cu', 'Zn',\n\t'Zr', 'Nb', 'Mo', 'Tc', 'Ru', 'Rh', 'Pd', 'Ag', 'Cd',\n\t'Hf', 'Ta', 'W',  'Re', 'Os', 'Ir', 'Pt', 'Au', 'Hg'\n];\n\nconst ELEMENTS_F_BLOCK:string[] =\n[\n\t'La', 'Ce', 'Pr', 'Nd', 'Sm', 'Eu', 'Gd', 'Tb', 'Dy',\n\t'Ho', 'Er', 'Tm', 'Yb', 'Lu', 'Ac', 'Th', 'Pa', 'U'\n];\n\nconst ELEMENTS_ABBREV:string[] =\n[\n\t'*', 'A', 'X', 'Y', 'Z', 'Q', 'M', 'T', 'E', 'L', 'R',\n\t'R0', 'R1', 'R2', 'R3', 'R4', 'R5', 'R6', 'R7', 'R8'\n];\n\nenum CommandType\n{\n\tMain = 0,\n\tAtom,\n\tBond,\n\tSelect,\n\tMove,\n\tAbbrev,\n\tSBlock,\n\tPBlock,\n\tDBlock,\n\tFBlock,\n\tNoble\n}\n\nconst COMMANDS_MAIN:ButtonBankItem[] =\n[\n\t{id: 'undo', imageFN: 'MainUndo', helpText: 'Undo last change.', mnemonic: 'CmdOrCtrl+Z'},\n\t{id: 'redo', imageFN: 'MainRedo', helpText: 'Cancel last undo.', mnemonic: 'CmdOrCtrl+Shift+Z'},\n\t{id: 'zoomin', imageFN: 'MainZoomIn', helpText: 'Zoom in.', mnemonic: '='},\n\t{id: 'zoomout', imageFN: 'MainZoomOut', helpText: 'Zoom out.', mnemonic: '-'},\n\t{id: 'zoomfit', imageFN: 'MainZoomFit', helpText: 'Show whole diagram onscreen.', mnemonic: ''},\n\t{id: 'selside', imageFN: 'MainSelSide', helpText: 'Select alternate side of current atom or bond.', mnemonic: 'E'},\n\t{id: 'selall', imageFN: 'MainSelAll', helpText: 'Select all atoms.', mnemonic: 'Shift+A'},\n\t{id: 'selnone', imageFN: 'MainSelNone', helpText: 'Clear selection.', mnemonic: 'Shift+Q'},\n\t{id: 'delete', imageFN: 'MainDelete', helpText: 'Delete selected atoms and bonds.', mnemonic: 'D'},\n\t{id: 'cut', imageFN: 'MainCut', helpText: 'Copy selection to clipboard, and remove.', mnemonic: 'CmdOrCtrl+X'},\n\t{id: 'copy', imageFN: 'MainCopy', helpText: 'Copy selection to clipboard.', mnemonic: 'CmdOrCtrl+C'},\n\t{id: 'paste', imageFN: 'MainPaste', helpText: 'Paste clipboard contents.'/*, mnemonic: 'Ctrl+V'*/}, // TODO: web-specific behaviour\n\t{id: 'atom', imageFN: 'MainAtom', helpText: 'Open the Atom submenu.', isSubMenu: true, mnemonic: 'A'},\n\t{id: 'bond', imageFN: 'MainBond', helpText: 'Open the Bond submenu.', isSubMenu: true, mnemonic: 'B'},\n\t{id: 'select', imageFN: 'MainSelect', helpText: 'Open the Selection submenu.', isSubMenu: true, mnemonic: 'S'},\n\t{id: 'move', imageFN: 'MainMove', helpText: 'Open the Move submenu.', isSubMenu: true, mnemonic: 'M'},\n];\nconst COMMANDS_ATOM:ButtonBankItem[] =\n[\n\t{id: 'element:C', text: 'C', helpText: 'Change elements to Carbon.', mnemonic: 'Shift+C'},\n\t{id: 'element:N', text: 'N', helpText: 'Change elements to Nitrogen.', mnemonic: 'Shift+N'},\n\t{id: 'element:O', text: 'O', helpText: 'Change elements to Oxygen.', mnemonic: 'Shift+O'},\n\t{id: 'element:S', text: 'S', helpText: 'Change elements to Sulfur.', mnemonic: 'Shift+S'},\n\t{id: 'element:P', text: 'P', helpText: 'Change elements to Phosphorus.', mnemonic: 'Shift+P'},\n\t{id: 'element:H', text: 'H', helpText: 'Change elements to Hydrogen.', mnemonic: 'Shift+H'},\n\t{id: 'element:F', text: 'F', helpText: 'Change elements to Fluorine.', mnemonic: 'Shift+F'},\n\t{id: 'element:Cl', text: 'Cl', helpText: 'Change elements to Chlorine.', mnemonic: 'Shift+L'},\n\t{id: 'element:Br', text: 'Br', helpText: 'Change elements to Bromine.', mnemonic: 'Shift+B'},\n\t{id: 'element:I', text: 'I', helpText: 'Change elements to Iodine.', mnemonic: 'Shift+I'},\n\t{id: 'plus', imageFN: 'AtomPlus', helpText: 'Increase the atom charge.', mnemonic: 'Shift+=', key: '+'},\n\t{id: 'minus', imageFN: 'AtomMinus', helpText: 'Decrease the atom charge.', mnemonic: 'Shift+-', key: '_'},\n\t{id: 'abbrev', imageFN: 'AtomAbbrev', helpText: 'Open list of common labels.', isSubMenu: true, mnemonic: ''},\n\t{id: 'sblock', imageFN: 'AtomSBlock', helpText: 'Open list of s-block elements.', isSubMenu: true, mnemonic: ''},\n\t{id: 'pblock', imageFN: 'AtomPBlock', helpText: 'Open list of p-block elements.', isSubMenu: true, mnemonic: ''},\n\t{id: 'dblock', imageFN: 'AtomDBlock', helpText: 'Open list of d-block elements.', isSubMenu: true, mnemonic: ''},\n\t{id: 'fblock', imageFN: 'AtomFBlock', helpText: 'Open list of f-block elements.', isSubMenu: true, mnemonic: ''},\n\t{id: 'noble', imageFN: 'AtomNoble', helpText: 'Open list of noble elements.', isSubMenu: true, mnemonic: ''},\n];\nconst COMMANDS_BOND:ButtonBankItem[] =\n[\n\t{id: 'one', imageFN: 'BondOne', helpText: 'Create or set bonds to single.', mnemonic: '1'},\n\t{id: 'two', imageFN: 'BondTwo', helpText: 'Create or set bonds to double.', mnemonic: '2'},\n\t{id: 'three', imageFN: 'BondThree', helpText: 'Create or set bonds to triple.', mnemonic: '3'},\n\t{id: 'four', imageFN: 'BondFour', helpText: 'Create or set bonds to quadruple.', mnemonic: ''},\n\t{id: 'zero', imageFN: 'BondZero', helpText: 'Create or set bonds to zero-order.', mnemonic: '0'},\n\t{id: 'inclined', imageFN: 'BondUp', helpText: 'Create or set bonds to inclined.', mnemonic: '5'},\n\t{id: 'declined', imageFN: 'BondDown', helpText: 'Create or set bonds to declined.', mnemonic: '6'},\n\t{id: 'squig', imageFN: 'BondSquig', helpText: 'Create or set bonds to unknown stereochemistry.', mnemonic: '4'},\n\t{id: 'bondQAny', imageFN: 'BondQAny', helpText: 'Query bond that matches anything.'},\n\t{id: 'addtwo', imageFN: 'BondAddTwo', helpText: 'Add two new bonds to the subject atom.', mnemonic: 'Shift+D'},\n\t{id: 'insert', imageFN: 'BondInsert', helpText: 'Insert a methylene into the subject bond.', mnemonic: ''},\n\t{id: 'switch', imageFN: 'BondSwitch', helpText: 'Cycle through likely bond geometries.', mnemonic: '\\''},\n\t{id: 'rotate', imageFN: 'BondRotate', helpText: 'Rotate bond to invert substituent orientation.', mnemonic: ''},\n\t{id: 'linear', imageFN: 'BondLinear', helpText: 'Apply linear geometry.', mnemonic: 'Shift+V'},\n\t{id: 'trigonal', imageFN: 'BondTrigonal', helpText: 'Apply trigonal geometry.', mnemonic: 'Shift+W'},\n\t{id: 'tetra1', imageFN: 'BondTetra1', helpText: 'Apply tetrahedral geometry #1.', mnemonic: 'Shift+E'},\n\t{id: 'tetra2', imageFN: 'BondTetra2', helpText: 'Apply tetrahedral geometry #2.', mnemonic: 'Shift+R'},\n\t{id: 'sqplan', imageFN: 'BondSqPlan', helpText: 'Apply square planar geometry.', mnemonic: 'Shift+T'},\n\t{id: 'octa1', imageFN: 'BondOcta1', helpText: 'Apply octahedral geometry #1.', mnemonic: 'Shift+Y'},\n\t{id: 'octa2', imageFN: 'BondOcta2', helpText: 'Apply octahedral geometry #2.', mnemonic: 'Shift+U'},\n\t//{id: 'connect', imageFN: 'BondConnect', helpText: 'Connect selected atoms, by proximity.', mnemonic: ''},\n\t//{id: 'disconnect', imageFN: 'BondDisconnect', helpText: 'Disconnect selected atoms.', mnemonic: ''},\n\t{id: 'metalligate', imageFN: 'BondMetalLigate', helpText: 'Arrange ligands around metal centre.', mnemonic: ''},\n\t{id: 'artifactpath', imageFN: 'BondArtifactPath', helpText: 'Add a path bond artifact.', mnemonic: ''},\n\t{id: 'artifactring', imageFN: 'BondArtifactRing', helpText: 'Add a ring bond artifact.', mnemonic: ''},\n\t{id: 'artifactarene', imageFN: 'BondArtifactArene', helpText: 'Add an arene bond artifact.', mnemonic: ''},\n\t{id: 'artifactclear', imageFN: 'BondArtifactClear', helpText: 'Remove a bond artifact.', mnemonic: ''},\n\t{id: 'polymer', imageFN: 'BondPolymer', helpText: 'Create a polymer block.', mnemonic: ''},\n];\nconst COMMANDS_SELECT:ButtonBankItem[] =\n[\n\t{id: 'selgrow', imageFN: 'SelectionGrow', helpText: 'Add adjacent atoms to selection.', mnemonic: ''},\n\t{id: 'selshrink', imageFN: 'SelectionShrink', helpText: 'Unselect exterior atoms.', mnemonic: ''},\n\t{id: 'selchain', imageFN: 'SelectionChain', helpText: 'Extend selection to non-ring atoms.', mnemonic: ''},\n\t{id: 'smallring', imageFN: 'SelectionSmRing', helpText: 'Extend selection to small rings.', mnemonic: ''},\n\t{id: 'ringblock', imageFN: 'SelectionRingBlk', helpText: 'Extend selection to ring blocks.', mnemonic: ''},\n\t{id: 'curelement', imageFN: 'SelectionCurElement', helpText: 'Select all atoms of current element type.', mnemonic: ''},\n\t{id: 'selprev', imageFN: 'MainSelPrev', helpText: 'Select previous connected component.', mnemonic: '['},\n\t{id: 'selnext', imageFN: 'MainSelNext', helpText: 'Select next connected component.', mnemonic: ']'},\n\t{id: 'toggle', imageFN: 'SelectionToggle', helpText: 'Toggle selection of current.', mnemonic: ','},\n\t{id: 'uncurrent', imageFN: 'SelectionUncurrent', helpText: 'Undefine current object.', mnemonic: '.'},\n\t{id: 'join', imageFN: 'MoveJoin', helpText: 'Overlapping atoms will be joined as one.', mnemonic: ''},\n\t{id: 'new', imageFN: 'MainNew', helpText: 'Clear the molecular structure.', mnemonic: ''},\n\t{id: 'inline', imageFN: 'AtomInline', helpText: 'Make selected atoms into an inline abbreviation.', mnemonic: '/'},\n\t{id: 'formula', imageFN: 'AtomFormula', helpText: 'Make selected atoms into their molecule formula.', mnemonic: '\\\\'},\n\t{id: 'expandabbrev', imageFN: 'AtomExpandAbbrev', helpText: 'Expand out the inline abbreviation.', mnemonic: 'Shift+/', key: '?'},\n\t{id: 'clearabbrev', imageFN: 'AtomClearAbbrev', helpText: 'Remove inline abbreviation.', mnemonic: 'Shift+\\\\', key: '|'},\n];\nconst COMMANDS_MOVE:ButtonBankItem[] =\n[\n\t{id: 'up', imageFN: 'MoveUp', helpText: 'Move subject atoms up slightly.', mnemonic: 'Shift+Up', key: KeyCode.Up},\n\t{id: 'down', imageFN: 'MoveDown', helpText: 'Move subject atoms down slightly.', mnemonic: 'Shift+Down', key: KeyCode.Down},\n\t{id: 'left', imageFN: 'MoveLeft', helpText: 'Move subject atoms slightly to the left.', mnemonic: 'Shift+Left', key: KeyCode.Left},\n\t{id: 'right', imageFN: 'MoveRight', helpText: 'Move subject atoms slightly to the right.', mnemonic: 'Shift+Right', key: KeyCode.Right},\n\t{id: 'uplots', imageFN: 'MoveUpLots', helpText: 'Move subject atoms up somewhat.', mnemonic: ''},\n\t{id: 'downlots', imageFN: 'MoveDownLots', helpText: 'Move subject atoms down somewhat.', mnemonic: ''},\n\t{id: 'leftlots', imageFN: 'MoveLeftLots', helpText: 'Move subject atoms somewhat to the left.', mnemonic: ''},\n\t{id: 'rightlots', imageFN: 'MoveRightLots', helpText: 'Move subject atoms somewhat to the right.', mnemonic: ''},\n\t{id: 'upfar', imageFN: 'MoveUpFar', helpText: 'Move subject atoms far up.', mnemonic: ''},\n\t{id: 'downfar', imageFN: 'MoveDownFar', helpText: 'Move subject atoms far down.', mnemonic: ''},\n\t{id: 'leftfar', imageFN: 'MoveLeftFar', helpText: 'Move subject atoms far to the left.', mnemonic: ''},\n\t{id: 'rightfar', imageFN: 'MoveRightFar', helpText: 'Move subject atoms far to the right.', mnemonic: ''},\n\t{id: 'rotp01', imageFN: 'MoveRotP01', helpText: 'Rotate 1\\u00B0 counter-clockwise.', mnemonic: ''},\n\t{id: 'rotm01', imageFN: 'MoveRotM01', helpText: 'Rotate 1\\u00B0 clockwise.', mnemonic: ''},\n\t{id: 'rotp05', imageFN: 'MoveRotP05', helpText: 'Rotate 5\\u00B0 counter-clockwise.', mnemonic: ''},\n\t{id: 'rotm05', imageFN: 'MoveRotM05', helpText: 'Rotate 5\\u00B0 clockwise.', mnemonic: ''},\n\t{id: 'rotp15', imageFN: 'MoveRotP15', helpText: 'Rotate 15\\u00B0 counter-clockwise.', mnemonic: ''},\n\t{id: 'rotm15', imageFN: 'MoveRotM15', helpText: 'Rotate 15\\u00B0 clockwise.', mnemonic: ''},\n\t{id: 'rotp30', imageFN: 'MoveRotP30', helpText: 'Rotate 30\\u00B0 counter-clockwise.', mnemonic: 'Shift+[', key: '{'},\n\t{id: 'rotm30', imageFN: 'MoveRotM30', helpText: 'Rotate 30\\u00B0 clockwise.', mnemonic: 'Shift+]', key: '}'},\n\t{id: 'hflip', imageFN: 'MoveHFlip', helpText: 'Flip subject atoms horizontally.', mnemonic: 'Shift+,', key: '<'},\n\t{id: 'vflip', imageFN: 'MoveVFlip', helpText: 'Flip subject atoms vertically.', mnemonic: 'Shift+.', key: '>'},\n\t{id: 'shrink', imageFN: 'MoveShrink', helpText: 'Decrease subject bond distances.', mnemonic: 'Shift+Z'},\n\t{id: 'grow', imageFN: 'MoveGrow', helpText: 'Increase subject bond distances.', mnemonic: 'Shift+X'},\n];\n\nexport class CommandBank extends ButtonBank\n{\n\tconstructor(protected owner:any, protected cmdType = CommandType.Main)\n\t{\n\t\tsuper();\n\t}\n\n\t// populate the buttons\n\tpublic update():void\n\t{\n\t\tif (this.cmdType == CommandType.Main) for (let btn of COMMANDS_MAIN) this.buttons.push(btn);\n\t\telse if (this.cmdType == CommandType.Atom) for (let btn of COMMANDS_ATOM) this.buttons.push(btn);\n\t\telse if (this.cmdType == CommandType.Bond) for (let btn of COMMANDS_BOND) this.buttons.push(btn);\n\t\telse if (this.cmdType == CommandType.Select) for (let btn of COMMANDS_SELECT) this.buttons.push(btn);\n\t\telse if (this.cmdType == CommandType.Move) for (let btn of COMMANDS_MOVE) this.buttons.push(btn);\n\t\telse if (this.cmdType == CommandType.Abbrev) this.populateElements(ELEMENTS_ABBREV);\n\t\telse if (this.cmdType == CommandType.SBlock) this.populateElements(ELEMENTS_S_BLOCK);\n\t\telse if (this.cmdType == CommandType.PBlock) this.populateElements(ELEMENTS_P_BLOCK);\n\t\telse if (this.cmdType == CommandType.DBlock) this.populateElements(ELEMENTS_D_BLOCK);\n\t\telse if (this.cmdType == CommandType.FBlock) this.populateElements(ELEMENTS_F_BLOCK);\n\t\telse if (this.cmdType == CommandType.Noble) this.populateElements(ELEMENTS_NOBLE);\n\t}\n\n\tprivate populateElements(elements:string[]):void\n\t{\n\t\tfor (let el of elements)\n\t\t{\n\t\t\tthis.buttons.push({id: `element:${el}`, text: el, helpText: `Change elements to ${el}.`});\n\t\t}\n\t}\n\n\t// react to a button click\n\tpublic hitButton(id:string):void\n\t{\n\t\tlet actv = 0, param:any = null;\n\n\t\tif (id.startsWith('element:'))\n\t\t{\n\t\t\tlet el = id.substring(8);\n\t\t\tactv = ActivityType.Element;\n\t\t\tparam = {element: el};\n\t\t}\n\t\telse if (id == 'delete') actv = ActivityType.Delete;\n\t\telse if (id == 'undo')\n\t\t{\n\t\t\tif (this.owner.canUndo()) this.owner.performUndo();\n\t\t\telse this.owner.showMessage('Nothing to undo.');\n\t\t}\n\t\telse if (id == 'redo')\n\t\t{\n\t\t\tif (this.owner.canRedo()) this.owner.performRedo();\n\t\t\telse this.owner.showMessage('Nothing to redo.');\n\t\t}\n\t\telse if (id == 'cut') actv = ActivityType.Cut;\n\t\telse if (id == 'copy') actv = ActivityType.Copy;\n\t\telse if (id == 'paste') this.owner.performPaste();\n\t\telse if (id == 'new') actv = ActivityType.Clear;\n\t\telse if (id == 'zoomfit') this.owner.autoScale();\n\t\telse if (id == 'zoomout') this.owner.zoom(0.8);\n\t\telse if (id == 'zoomin') this.owner.zoom(1.25);\n\t\telse if (id == 'selall') actv = ActivityType.SelectAll;\n\t\telse if (id == 'selnone') actv = ActivityType.SelectNone;\n\t\telse if (id == 'selprev') actv = ActivityType.SelectPrevComp;\n\t\telse if (id == 'selnext') actv = ActivityType.SelectNextComp;\n\t\telse if (id == 'selside') actv = ActivityType.SelectSide;\n\t\telse if (id == 'plus') {actv = ActivityType.Charge; param = {delta: 1};}\n\t\telse if (id == 'minus') {actv = ActivityType.Charge; param = {delta: -1};}\n\t\telse if (id == 'one') {actv = ActivityType.BondOrder; param = {order: 1};}\n\t\telse if (id == 'two') {actv = ActivityType.BondOrder; param = {order: 2};}\n\t\telse if (id == 'three') {actv = ActivityType.BondOrder; param = {order: 3};}\n\t\telse if (id == 'four') {actv = ActivityType.BondOrder; param = {order: 4};}\n\t\telse if (id == 'zero') {actv = ActivityType.BondOrder; param = {order: 0};}\n\t\telse if (id == 'inclined') {actv = ActivityType.BondType; param = {type: Molecule.BONDTYPE_INCLINED};}\n\t\telse if (id == 'declined') {actv = ActivityType.BondType; param = {type: Molecule.BONDTYPE_DECLINED};}\n\t\telse if (id == 'squig') {actv = ActivityType.BondType; param = {type: Molecule.BONDTYPE_UNKNOWN};}\n\t\telse if (id == 'linear') {actv = ActivityType.BondGeom; param = {geom: Geometry.Linear};}\n\t\telse if (id == 'trigonal') {actv = ActivityType.BondGeom; param = {geom: Geometry.Trigonal};}\n\t\telse if (id == 'tetra1') {actv = ActivityType.BondGeom; param = {geom: Geometry.Tetra1};}\n\t\telse if (id == 'tetra2') {actv = ActivityType.BondGeom; param = {geom: Geometry.Tetra2};}\n\t\telse if (id == 'sqplan') {actv = ActivityType.BondGeom; param = {geom: Geometry.SqPlan};}\n\t\telse if (id == 'octa1') {actv = ActivityType.BondGeom; param = {geom: Geometry.Octa1};}\n\t\telse if (id == 'octa2') {actv = ActivityType.BondGeom; param = {geom: Geometry.Octa2};}\n\t\telse if (id == 'switch') actv = ActivityType.BondSwitch;\n\t\telse if (id == 'rotate') actv = ActivityType.BondRotate;\n\t\telse if (id == 'connect') actv = ActivityType.Connect;\n\t\telse if (id == 'disconnect') actv = ActivityType.Disconnect;\n\t\telse if (id == 'metalligate') actv = ActivityType.MetalLigate;\n\t\telse if (id == 'artifactpath') actv = ActivityType.BondArtifactPath;\n\t\telse if (id == 'artifactring') actv = ActivityType.BondArtifactRing;\n\t\telse if (id == 'artifactarene') actv = ActivityType.BondArtifactArene;\n\t\telse if (id == 'artifactclear') actv = ActivityType.BondArtifactClear;\n\t\telse if (id == 'polymer') actv = ActivityType.PolymerBlock;\n\t\telse if (id == 'addtwo') actv = ActivityType.BondAddTwo;\n\t\telse if (id == 'insert') actv = ActivityType.BondInsert;\n\t\telse if (id == 'curelement') actv = ActivityType.SelectCurElement;\n\t\telse if (id == 'selgrow') actv = ActivityType.SelectGrow;\n\t\telse if (id == 'selshrink') actv = ActivityType.SelectShrink;\n\t\telse if (id == 'selprev') actv = ActivityType.SelectPrevComp;\n\t\telse if (id == 'selnext') actv = ActivityType.SelectNextComp;\n\t\telse if (id == 'selchain') actv = ActivityType.SelectChain;\n\t\telse if (id == 'smallring') actv = ActivityType.SelectSmRing;\n\t\telse if (id == 'ringblock') actv = ActivityType.SelectRingBlk;\n\t\telse if (id == 'toggle') actv = ActivityType.SelectToggle;\n\t\telse if (id == 'uncurrent') actv = ActivityType.SelectUnCurrent;\n\t\telse if (id == 'join') actv = ActivityType.Join;\n\t\telse if (id == 'inline') actv = ActivityType.AbbrevGroup;\n\t\telse if (id == 'formula') actv = ActivityType.AbbrevFormula;\n\t\telse if (id == 'clearabbrev') actv = ActivityType.AbbrevClear;\n\t\telse if (id == 'expandabbrev') actv = ActivityType.AbbrevExpand;\n\t\telse if (id == 'up') {actv = ActivityType.Nudge; param = {dir: 'up'};}\n\t\telse if (id == 'down') {actv = ActivityType.Nudge; param = {dir: 'down'};}\n\t\telse if (id == 'left') {actv = ActivityType.Nudge; param = {dir: 'left'};}\n\t\telse if (id == 'right') {actv = ActivityType.Nudge; param = {dir: 'right'};}\n\t\telse if (id == 'uplots') {actv = ActivityType.NudgeLots; param = {dir: 'up'};}\n\t\telse if (id == 'downlots') {actv = ActivityType.NudgeLots; param = {dir: 'down'};}\n\t\telse if (id == 'leftlots') {actv = ActivityType.NudgeLots; param = {dir: 'left'};}\n\t\telse if (id == 'rightlots') {actv = ActivityType.NudgeLots; param = {dir: 'right'};}\n\t\telse if (id == 'upfar') {actv = ActivityType.NudgeFar; param = {dir: 'up'};}\n\t\telse if (id == 'downfar') {actv = ActivityType.NudgeFar; param = {dir: 'down'};}\n\t\telse if (id == 'leftfar') {actv = ActivityType.NudgeFar; param = {dir: 'left'};}\n\t\telse if (id == 'rightfar') {actv = ActivityType.NudgeFar; param = {dir: 'right'};}\n\t\telse if (id == 'rotp01') {actv = ActivityType.Rotate; param = {theta: 1};}\n\t\telse if (id == 'rotm01') {actv = ActivityType.Rotate; param = {theta: -1};}\n\t\telse if (id == 'rotp05') {actv = ActivityType.Rotate; param = {theta: 5};}\n\t\telse if (id == 'rotm05') {actv = ActivityType.Rotate; param = {theta: -5};}\n\t\telse if (id == 'rotp15') {actv = ActivityType.Rotate; param = {theta: 15};}\n\t\telse if (id == 'rotm15') {actv = ActivityType.Rotate; param = {theta: -15};}\n\t\telse if (id == 'rotp30') {actv = ActivityType.Rotate; param = {theta: 30};}\n\t\telse if (id == 'rotm30') {actv = ActivityType.Rotate; param = {theta: -30};}\n\t\telse if (id == 'hflip') {actv = ActivityType.Flip; param = {axis: 'hor'};}\n\t\telse if (id == 'vflip') {actv = ActivityType.Flip; param = {axis: 'ver'};}\n\t\telse if (id == 'shrink') {actv = ActivityType.Scale; param = {mag: 1 / 1.1};}\n\t\telse if (id == 'grow') {actv = ActivityType.Scale; param = {mag: 1.1};}\n\t\telse if (id == 'bondQAny') actv = ActivityType.QueryBondAny;\n\t\telse if (id == 'atom') this.buttonView.pushBank(new CommandBank(this.owner, CommandType.Atom));\n\t\telse if (id == 'bond') this.buttonView.pushBank(new CommandBank(this.owner, CommandType.Bond));\n\t\telse if (id == 'select') this.buttonView.pushBank(new CommandBank(this.owner, CommandType.Select));\n\t\telse if (id == 'move') this.buttonView.pushBank(new CommandBank(this.owner, CommandType.Move));\n\t\telse if (id == 'abbrev') this.buttonView.pushBank(new CommandBank(this.owner, CommandType.Abbrev));\n\t\telse if (id == 'sblock') this.buttonView.pushBank(new CommandBank(this.owner, CommandType.SBlock));\n\t\telse if (id == 'pblock') this.buttonView.pushBank(new CommandBank(this.owner, CommandType.PBlock));\n\t\telse if (id == 'dblock') this.buttonView.pushBank(new CommandBank(this.owner, CommandType.DBlock));\n\t\telse if (id == 'fblock') this.buttonView.pushBank(new CommandBank(this.owner, CommandType.FBlock));\n\t\telse if (id == 'noble') this.buttonView.pushBank(new CommandBank(this.owner, CommandType.Noble));\n\t\telse alert('Unhandled command: \"' + id + '\"');\n\n\t\tif (actv > 0)\n\t\t{\n\t\t\tnew MoleculeActivity(this.owner.getState(), actv, param, this.owner).execute();\n\t\t}\n\t}\n\n\tpublic claimKey(event:KeyboardEvent):boolean\n\t{\n\t\t//let ch = String.fromCharCode(event.keyCode || event.charCode);\n\t\t//console.log('Claim/Command['+ch+'] key='+event.keyCode+' chcode='+event.charCode);\n\t\n\t\t// special deal: in case it's a mac, convert Cmd-Z/Cmd-Shift-Z into the Winux convention of using Ctrl\n\t\t/*if (event.metaKey && event.key == 'z')\n\t\t{\n\t\t\tevent.metaKey = false;\n\t\t\tevent.ctrlKey = true;\n\t\t}*/\n\n\t\tfor (let listItems of [COMMANDS_MAIN, COMMANDS_ATOM, COMMANDS_BOND, COMMANDS_SELECT, COMMANDS_MOVE]) for (let item of listItems)\n\t\t{\n\t\t\tif (ButtonBank.matchKey(event, item.mnemonic, item.key))\n\t\t\t{\n\t\t\t\tthis.hitButton(item.id);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*\n    WebMolKit\n\n    (c) 2010-2020 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Molecule} from '../data/Molecule';\nimport {PolymerBlock} from '../data/PolymerBlock';\nimport {ClipboardProxy} from '../ui/ClipboardProxy';\nimport {MenuProxyContext} from '../ui/MenuProxy';\nimport {Vec} from '../util/Vec';\nimport {ActivityType, MoleculeActivity, SketchState} from './MoleculeActivity';\nimport {Sketcher} from './Sketcher';\n\n/*\n\tPopulation of a context menu for the sketcher, which depends on current state.\n*/\n\nexport class ContextSketch\n{\n\tconstructor(private state:SketchState, private sketcher:Sketcher, private proxyClip:ClipboardProxy)\n\t{\n\t}\n\n\tpublic populate():MenuProxyContext[]\n\t{\n\t\tconst {state, sketcher} = this;\n\n\t\tlet menu:MenuProxyContext[] = [];\n\n\t\tif (sketcher.canUndo() || sketcher.canRedo())\n\t\t{\n\t\t\tif (sketcher.canUndo()) menu.push({label: 'Undo', accelerator: 'CmdOrCtrl+Z', click: () => sketcher.performUndo()});\n\t\t\tif (sketcher.canRedo()) menu.push({label: 'Redo', accelerator: 'CmdOrCtrl+Shift+Z', click: () => sketcher.performRedo()});\n\t\t\tmenu.push(null);\n\t\t}\n\n\t\tif (state.currentAtom > 0 || state.currentBond > 0) menu.push({label: 'Edit', 'accelerator': 'Enter', click: () => sketcher.editCurrent()});\n\n\t\tthis.maybeAppend(menu, 'Delete', 'D', ActivityType.Delete);\n\n\t\tthis.maybeAppend(menu, 'Cut', 'CmdOrCtrl+X', ActivityType.Cut);\n\t\tthis.maybeAppend(menu, 'Copy', 'CmdOrCtrl+C', ActivityType.Copy);\n\t\tif (this.proxyClip.canAlwaysGet()) menu.push({label: 'Paste', 'accelerator': 'CmdOrCtrl+V', click: () => sketcher.performPaste()});\n\t\t//this.maybeAppend(state, ActivityType.Paste, title:\"Paste\");\n\n\t\tthis.maybeAppend(menu, 'Charge +', 'Shift+=', ActivityType.Charge, {delta: 1});\n\t\tthis.maybeAppend(menu, 'Charge -', 'Shift+-', ActivityType.Charge, {delta: -1});\n\n\t\tthis.maybeAppend(menu, 'Bond Order 0', '0', ActivityType.BondOrder, {order: 0});\n\t\tthis.maybeAppend(menu, 'Bond Order 1', '1', ActivityType.BondOrder, {order: 1});\n\t\tthis.maybeAppend(menu, 'Bond Order 2', '2', ActivityType.BondOrder, {order: 2});\n\t\tthis.maybeAppend(menu, 'Bond Order 3', '3', ActivityType.BondOrder, {order: 3});\n\t\tthis.maybeAppend(menu, 'Bond Order 4', null, ActivityType.BondOrder, {order: 4});\n\n\t\tthis.maybeAppend(menu, 'Unknown Stereochemistry', '4', ActivityType.BondType, {type: Molecule.BONDTYPE_UNKNOWN});\n\t\tthis.maybeAppend(menu, 'Bond Wedge Up', '5', ActivityType.BondType, {type: Molecule.BONDTYPE_INCLINED});\n\t\tthis.maybeAppend(menu, 'Bond Wedge Down', '6', ActivityType.BondType, {type: Molecule.BONDTYPE_DECLINED});\n\n\t\tthis.maybeAppend(menu, 'Switch Geometry', null, ActivityType.BondSwitch);\n\t\tthis.maybeAppend(menu, 'Add Two Bonds', 'Shift+D', ActivityType.BondAddTwo);\n\t\tthis.maybeAppend(menu, 'Insert Atom', null, ActivityType.BondInsert);\n\t\tthis.maybeAppend(menu, 'Join Atoms', null, ActivityType.Join);\n\t\t// !! this.maybeAppend(menu, ActivityType.BondFix, 'Fix Geometry');\n\n\t\tthis.maybeAppend(menu, 'Abbreviate Group', '/', ActivityType.AbbrevGroup);\n\t\tthis.maybeAppend(menu, 'Abbreviate Formula', '\\\\', ActivityType.AbbrevFormula);\n\t\tthis.maybeAppend(menu, 'Clear Abbreviation', 'Shift+\\\\', ActivityType.AbbrevClear);\n\t\tthis.maybeAppend(menu, 'Expand Abbreviation', 'Shift+/', ActivityType.AbbrevExpand);\n\t\t//if state.currentAtom > 0 || state.currentBond > 0 {append(cmdID:Command.Query, title:\"Query Properties\")};\n\n\t\tlet rotateSub = this.rotateSubMenu();\n\t\tif (Vec.notBlank(rotateSub)) menu.push({label: 'Rotate', subMenu: rotateSub});\n\n\t\tlet querySub = this.querySubMenu();\n\t\tif (Vec.notBlank(querySub)) menu.push({label: 'Query', subMenu: querySub});\n\n\t\tlet poly = new PolymerBlock(state.mol);\n\t\tfor (let units of poly.getUnits())\n\t\t{\n\t\t\tlet a1 = state.currentAtom, a2 = 0;\n\t\t\tif (state.currentBond > 0) [a1, a2] = state.mol.bondFromTo(state.currentBond);\n\t\t\tif (units.atoms.includes(a1) || units.atoms.includes(a2))\n\t\t\t{\n\t\t\t\tlet label = 'Polymer Block (' + units.atoms.length + ' atom' + (units.atoms.length == 1 ? '' : 's') + ')';\n\t\t\t\tmenu.push({label: label, click: () => sketcher.performPolymerBlock(units.atoms)});\n\t\t\t}\n\t\t}\n\n\t\tif (menu.length > 0) menu.push(null);\n\n\t\tmenu.push({label: 'Scale to Fit', click: () => sketcher.autoScale()});\n\t\tmenu.push({label: 'Zoom In', 'accelerator': '=', click: () => sketcher.zoom(1.25)});\n\t\tmenu.push({label: 'Zoom Out', 'accelerator': '-', click: () => sketcher.zoom(0.8)});\n\n\t\treturn menu;\n\t}\n\n\t// ------------ private methods ------------\n\n\tprivate maybeAppend(menu:MenuProxyContext[], title:string, accelerator:string, activ:ActivityType, param:Record<string, any> = null):void\n\t{\n\t\tlet molact = new MoleculeActivity(this.state, activ, param);\n\t\tmolact.execute();\n\t\tif (!molact.output.mol && !molact.toClipboard) return;\n\n\t\tmenu.push({label: title, 'accelerator': accelerator, click: () =>\n\t\t{\n\t\t\tthis.sketcher.setState(molact.output, true);\n\t\t\tif (molact.toClipboard) this.proxyClip.setString(molact.toClipboard);\n\t\t}});\n\t}\n\n\tprivate rotateSubMenu():MenuProxyContext[]\n\t{\n\t\tlet menu:MenuProxyContext[] = [];\n\n\t\tthis.maybeAppend(menu, 'Bond', null, ActivityType.BondRotate);\n\t\tthis.maybeAppend(menu, '+1 \\u{00B0}', null, ActivityType.Rotate, {theta: 1});\n\t\tthis.maybeAppend(menu, '-1 \\u{00B0}', null, ActivityType.Rotate, {theta: -1});\n\t\tthis.maybeAppend(menu, '+5 \\u{00B0}', null, ActivityType.Rotate, {theta: 5});\n\t\tthis.maybeAppend(menu, '-5 \\u{00B0}', null, ActivityType.Rotate, {theta: -5});\n\t\tthis.maybeAppend(menu, '+15 \\u{00B0}', null, ActivityType.Rotate, {theta: 15});\n\t\tthis.maybeAppend(menu, '-15 \\u{00B0}', null, ActivityType.Rotate, {theta: -15});\n\t\tthis.maybeAppend(menu, '+30 \\u{00B0}', 'Shift+[', ActivityType.Rotate, {theta: 30});\n\t\tthis.maybeAppend(menu, '-30 \\u{00B0}', 'Shift+]', ActivityType.Rotate, {theta: -30});\n\t\tthis.maybeAppend(menu, 'H-Flip', 'Shift+,', ActivityType.Flip, {axis: 'hor'});\n\t\tthis.maybeAppend(menu, 'V-Flip', 'Shift+.', ActivityType.Flip, {axis: 'ver'});\n\t\tthis.maybeAppend(menu, 'Align', null, ActivityType.AlignRegular);\n\n\t\treturn menu;\n\t}\n\n\tprivate querySubMenu():MenuProxyContext[]\n\t{\n\t\tlet menu:MenuProxyContext[] = [];\n\n\t\tthis.maybeAppend(menu, 'Clear', null, ActivityType.QueryClear);\n\t\tthis.maybeAppend(menu, 'Copy', null, ActivityType.QueryCopy);\n\n\t\t// TODO: add common use cases; implement in MoleculeActivity\n\n\t\treturn menu;\n\t}\n}\n\n","/*\n\tWebMolKit\n\n\t(c) 2010-2019 Molecular Materials Informatics, Inc.\n\n\tAll rights reserved\n\n\thttp://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\n///<reference path='../ui/Widget.ts'/>\n\nimport {Chemistry} from '../data/Chemistry';\nimport {CoordUtil} from '../data/CoordUtil';\nimport {MetaMolecule} from '../data/MetaMolecule';\nimport {Molecule} from '../data/Molecule';\nimport {MolUtil} from '../data/MolUtil';\nimport {PolymerBlock, POLYMERBLOCK_SPECIAL_UNCAPPED, PolymerBlockConnectivity, PolymerBlockUnit} from '../data/PolymerBlock';\nimport {QueryTypeBond, QueryUtil} from '../data/QueryUtil';\nimport {GuidelineSprout, SketchUtil} from '../data/SketchUtil';\nimport {Stereochemistry} from '../data/Stereochemistry';\nimport {ArrangeMeasurement} from '../gfx/ArrangeMeasurement';\nimport {APoint, ArrangeMolecule} from '../gfx/ArrangeMolecule';\nimport {DrawMolecule} from '../gfx/DrawMolecule';\nimport {FontData} from '../gfx/FontData';\nimport {MetaVector} from '../gfx/MetaVector';\nimport {RenderEffects, RenderPolicy} from '../gfx/Rendering';\nimport {Widget} from '../ui/Widget';\nimport {dom, DOM} from '../util/dom';\nimport {GeomUtil} from '../util/Geom';\nimport {Theme} from '../util/Theme';\nimport {colourCanvas, drawLine, fontSansSerif, invZ, norm2_xy, norm_xy, pixelDensity, setBoundaryPixels, sqr, TWOPI} from '../util/util';\nimport {Vec} from '../util/Vec';\nimport {SketchState, TemplatePermutation} from './MoleculeActivity';\nimport {FusionBank} from './TemplateBank';\n\n/*\n\tDrawCanvas: base class for the sketcher, which handles all of the rendering functionality for the live object.\n*/\n\nexport enum DraggingTool\n{\n\tNone = 0,\n\tPress,\n\tLasso,\n\tPan,\n\tZoom,\n\tRotate,\n\tMove,\n\tErasor,\n\tAtom,\n\tBond,\n\tCharge,\n\tRing\n}\n\nexport enum DrawCanvasDecoration\n{\n\tNone = 0,\n\tStereochemistry,\n\tMappingNumber,\n\tAtomIndex,\n}\n\ninterface DrawCanvasViewOpt\n{\n\tdecoration:DrawCanvasDecoration;\n\tshowOxState:boolean;\n\tshowQuery:boolean;\n\tshowArtifacts:boolean;\n}\n\nexport class DrawCanvas extends Widget implements ArrangeMeasurement\n{\n\tprotected mol:Molecule = null;\n\tprotected policy:RenderPolicy = null;\n\tprotected abbrevPolicy:RenderPolicy;\n\n\tprotected offsetX = 0;\n\tprotected offsetY = 0;\n\tprotected pointScale = 1;\n\n\tprotected viewOpt:DrawCanvasViewOpt =\n\t{\n\t\tdecoration: DrawCanvasDecoration.Stereochemistry,\n\t\tshowOxState: true,\n\t\tshowQuery: true,\n\t\tshowArtifacts: true,\n\t};\n\n\tprotected width = 0;\n\tprotected height = 0;\n\tprotected border = 0x808080;\n\tprotected borderRadius = 4;\n\tprotected background = 0xF8F8F8;\n\n\tprotected container:DOM;\n\tprotected divInfo:DOM;\n\tprotected canvasUnder:DOM = null;\n\tprotected canvasMolecule:DOM = null;\n\tprotected canvasOver:DOM = null;\n\tprotected divMessage:DOM = null;\n\n\tprotected layout:ArrangeMolecule = null;\n\tprotected metavec:MetaVector = null; // instantiated version of above\n\tprotected stereo:Stereochemistry = null;\n\tprotected guidelines:GuidelineSprout[] = null;\n\n\tprotected filthy = false;\n\tprotected dragType = DraggingTool.None;\n\tprotected currentAtom = 0;\n\tprotected currentBond = 0;\n\tprotected hoverAtom = 0;\n\tprotected hoverBond = 0;\n\tprotected selectedMask:boolean[] = null;\n\tprotected opAtom = 0;\n\tprotected opBond = 0;\n\tprotected opBudged = false; // flips to true when the user starts dragging\n\tprotected opShift = false;\n\tprotected opCtrl = false;\n\tprotected opAlt = false;\n\tprotected lassoX:number[] = null;\n\tprotected lassoY:number[] = null;\n\tprotected lassoMask:boolean[] = null;\n\tprotected clickX = 0; // position of initial mouse click\n\tprotected clickY = 0;\n\tprotected mouseX = 0; // last known position of mouse\n\tprotected mouseY = 0;\n\tprotected dragGuides:GuidelineSprout[] = null; // guidelines pertinent to the current dragging operation\n\tprotected templatePerms:TemplatePermutation[] = null; // if fusing templates, these are the options in play\n\tprotected currentPerm = 0; // currently viewed permutation (if applicable)\n\tprotected fusionBank:FusionBank = null;\n\tprotected cursorWatermark = 0;\n\tprotected cursorDX = 0;\n\tprotected cursorDY = 0;\n\tprotected toolAtomSymbol = '';\n\tprotected toolBondOrder = 0;\n\tprotected toolBondType = 0;\n\tprotected toolChargeDelta = 0;\n\tprotected toolRingArom = false;\n\tprotected toolRingFreeform = false;\n\tprotected toolRotateIncr = 0;\n\n\tprotected redrawCacheKey = '';\n\n\t// ------------ public methods ------------\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.abbrevPolicy = RenderPolicy.defaultBlackOnWhite();\n\t\tthis.abbrevPolicy.data.foreground = 0xD0D0D0;\n\t\tthis.abbrevPolicy.data.atomCols = Vec.numberArray(0xD0D0D0, this.abbrevPolicy.data.atomCols.length);\n\t}\n\n\tpublic render(parent:any):void\n\t{\n\t\tif (!this.width || !this.height) throw 'Sketcher.render called without width and height';\n\n\t\tsuper.render(parent);\n\n\t\tthis.container = dom('<div/>').appendTo(this.contentDOM);\n\t\tthis.container.css({'position': 'relative', 'width': this.width + 'px', 'height': this.height + 'px'});\n\t\tthis.container.css({'background-color': colourCanvas(this.background)});\n\t\tif (this.border != MetaVector.NOCOLOUR)\n\t\t{\n\t\t\tthis.container.css({'border': '1px solid ' + colourCanvas(this.border)});\n\t\t\tthis.container.css({'border-radius': this.borderRadius + 'px'});\n\t\t}\n\t\tthis.container.css({'outline': 'none'});\n\n\t\tthis.container.attr({'tabindex': '0'});\n\n\t\tlet canvasStyle = {'position': 'absolute', 'left': '0', 'top': '0', 'width': `${this.width}px`, 'height': `${this.height}`, 'pointer-events': 'none'};\n\n\t\tthis.divInfo = dom('<div/>').appendTo(this.container).css({'position': 'absolute', 'left': '0', 'top': '0', 'pointer-events': 'none'});\n\t\tthis.canvasUnder = dom('<canvas/>').appendTo(this.container).css(canvasStyle);\n\t\tthis.canvasMolecule = dom('<canvas/>').appendTo(this.container).css(canvasStyle);\n\t\tthis.canvasOver = dom('<canvas/>').appendTo(this.container).css(canvasStyle);\n\n\t\tthis.divMessage = dom('<div/>').appendTo(this.container).css(canvasStyle);\n\t\tthis.divMessage.css({'text-align': 'center', 'vertical-align': 'middle', 'font-weight': 'bold', 'font-size': '120%'});\n\t}\n\n\t// gets the current state, as an associative array\n\tpublic getState():SketchState\n\t{\n\t\tlet state:SketchState =\n\t\t{\n\t\t\tmol: this.mol.clone(),\n\t\t\tcurrentAtom: this.currentAtom,\n\t\t\tcurrentBond: this.currentBond,\n\t\t\tselectedMask: this.selectedMask == null ? null : this.selectedMask.slice(0)\n\t\t};\n\t\treturn state;\n\t}\n\n\t// returns true if atom is selected (1-based)\n\tpublic getSelected(atom:number):boolean\n\t{\n\t\tif (this.selectedMask == null || atom > this.selectedMask.length) return false;\n\t\treturn this.selectedMask[atom - 1];\n\t}\n\n\t// returns true if atom is grabbed by the lasso, if any (1-based)\n\tpublic getLassoed(atom:number):boolean\n\t{\n\t\tif (this.lassoMask == null || atom > this.lassoMask.length) return false;\n\t\treturn this.lassoMask[atom - 1];\n\t}\n\n\t// functions for converting between coordinates within the widget (pixels) & molecular position (Angstroms)\n\tpublic scale() {return this.pointScale;}\n\tpublic angToX(ax:number):number\n\t{\n\t\treturn ax * this.pointScale + this.offsetX;\n\t}\n\tpublic angToY(ay:number):number\n\t{\n\t\treturn ay * -this.pointScale + this.offsetY;\n\t}\n\tpublic xToAng(px:number):number\n\t{\n\t\treturn (px - this.offsetX) / this.pointScale;\n\t}\n\tpublic yToAng(py:number):number\n\t{\n\t\treturn (py - this.offsetY) / -this.pointScale;\n\t}\n\tpublic scaleToAng(scale:number):number {return scale / this.pointScale;}\n\tpublic angToScale(ang:number):number {return ang * this.pointScale;}\n\tpublic yIsUp():boolean {return false;}\n\tpublic measureText(str:string, fontSize:number):number[] {return FontData.main.measureText(str, fontSize);}\n\n\t// ------------ protected methods ------------\n\n\t// redraw the structure: this will update the main canvas, using the current metavector representation of the structure;\n\t// the need-to-redraw flag is set, which means that this can be called multiple times without forcing the underlying canvas\n\t// to be redrawn too many times\n\tprotected delayedRedraw():void\n\t{\n\t\tif (this.canvasMolecule == null) return;\n\t\tthis.filthy = true;\n\t\twindow.setTimeout(() => {if (this.filthy) this.redraw();}, 10);\n\t}\n\n\t// regenerates the layout, which is slightly performance sensitive\n\tprotected layoutMolecule():void\n\t{\n\t\tlet mol = this.mol;\n\t\tif (this.hoverAtom > 0 && MolUtil.hasAbbrev(mol, this.hoverAtom))\n\t\t{\n\t\t\tmol = mol.clone();\n\t\t\tmol.setAtomElement(this.hoverAtom, '');\n\t\t\tmol.setAtomCharge(this.hoverAtom, 0);\n\t\t\tmol.setAtomUnpaired(this.hoverAtom, 0);\n\t\t\tMolUtil.clearAbbrev(mol, this.hoverAtom);\n\t\t}\n\n\t\tlet effects = this.sketchEffects(mol);\n\t\tthis.layout = new ArrangeMolecule(mol, this, this.policy, effects);\n\t\tthis.layout.setWantArtifacts(this.viewOpt.showArtifacts);\n\t\tthis.layout.arrange();\n\t}\n\n\t// rebuilds the metavector for the molecule, possibly with some retromods\n\tprotected redrawMetaVector():void\n\t{\n\t\tthis.metavec = new MetaVector();\n\t\tnew DrawMolecule(this.layout, this.metavec).draw();\n\n\t\tif (this.hoverAtom > 0 && MolUtil.hasAbbrev(this.mol, this.hoverAtom))\n\t\t{\n\t\t\tlet abbrevMol = MolUtil.getAbbrev(this.mol, this.hoverAtom);\n\t\t\tthis.orientAbbreviation(this.hoverAtom, abbrevMol);\n\t\t\tthis.abbrevPolicy.data.pointScale = this.policy.data.pointScale;\n\t\t\tlet layout = new ArrangeMolecule(abbrevMol, this, this.abbrevPolicy, new RenderEffects());\n\t\t\tlayout.arrange();\n\t\t\tnew DrawMolecule(layout, this.metavec).draw();\n\t\t}\n\t}\n\n\t// rebuilds the canvas content\n\tprotected redraw():void\n\t{\n\t\tthis.filthy = false;\n\t\tthis.redrawInfo();\n\t\tthis.redrawUnder();\n\t\tthis.redrawMolecule();\n\t\tthis.redrawOver();\n\t}\n\n\tprotected redrawInfo():void\n\t{\n\t\tlet cacheKey = JSON.stringify([this.width, this.height, this.mol.toString()]);\n\t\tif (cacheKey == this.redrawCacheKey) return;\n\t\tthis.redrawCacheKey = cacheKey;\n\n\t\tthis.divInfo.empty();\n\t\tthis.divInfo.css({'visibility': 'hidden', 'left': '0', 'top': '0'});\n\t\tif (this.mol.numAtoms == 0) return;\n\n\t\tlet divText = dom('<div/>').appendTo(this.divInfo);\n\t\tdivText.css({'display': 'inline-block', 'text-align': 'right', 'font-family': 'sans-serif', 'font-size': '80%', 'color': '#C0C0C0'});\n\t\tlet html = MolUtil.molecularFormula(this.mol, ['<sub>', '</sub>', '<sup>', '</sup>']);\n\t\t\n\t\tlet chg = 0;\n\t\tfor (let n = 1; n <= this.mol.numAtoms; n++) chg += this.mol.atomCharge(n);\n\t\tif (chg == -1) html += '<sup>-</sup>';\n\t\telse if (chg < -1) html += `<sup>${chg}</sup>`;\n\t\telse if (chg == 1) html += '<sup>+</sup>';\n\t\telse if (chg > 1) html += `<sup>+${chg}</sup>`;\n\n\t\thtml += '<br>' + MolUtil.molecularWeight(this.mol).toFixed(2);\n\n\t\tdivText.setHTML(html);\n\n\t\tsetTimeout(() =>\n\t\t{\n\t\t\tlet w = divText.width(), h = divText.height();\n\t\t\tsetBoundaryPixels(this.divInfo, this.width - w - 1, 1, w, h);\n\t\t\tthis.divInfo.css({'visibility': 'visible'});\n\t\t}, 1);\n\t}\n\n\tprotected redrawUnder():void\n\t{\n\t\tlet HOVER_COL = 0xE0E0E0;\n\t\tlet CURRENT_COL = 0xA0A0A0, CURRENT_BORD = 0x808080;\n\t\tlet SELECT_COL = 0xC0C0C0;\n\t\tlet LASSO_COL = 0xD0D0D0;\n\n\t\tlet density = pixelDensity();\n\t\tthis.canvasUnder.elCanvas.width = this.width * density;\n\t\tthis.canvasUnder.elCanvas.height = this.height * density;\n\t\tthis.canvasUnder.css({'width': `${this.width}px`, 'height': `${this.height}px`});\n\n\t\tlet ctx = this.canvasUnder.elCanvas.getContext('2d');\n\t\tctx.save();\n\t\tctx.scale(density, density);\n\t\tctx.clearRect(0, 0, this.width, this.height);\n\n\t\t// draw hover effects\n\t\tif (this.hoverAtom > 0)\n\t\t{\n\t\t\tlet units = new PolymerBlock(this.mol).getUnits();\n\t\t\tfor (let unit of units) if (unit.atoms.includes(this.hoverAtom)) this.drawPolymerUnit(ctx, unit, units);\n\n\t\t\tlet sz = 0;\n\t\t\tif (this.hoverAtom == this.currentAtom) sz += 0.1;\n\t\t\tif (this.getSelected(this.hoverAtom)) sz += 0.1;\n\t\t\tif (this.currentBond > 0 && (this.mol.bondFrom(this.currentBond) == this.hoverAtom || this.mol.bondTo(this.currentBond) == this.hoverAtom)) sz += 0.1;\n\t\t\tthis.drawAtomShade(ctx, this.hoverAtom, HOVER_COL, -1, sz);\n\t\t}\n\t\tif (this.hoverBond > 0)\n\t\t{\n\t\t\tlet bfr = this.mol.bondFrom(this.hoverBond), bto = this.mol.bondTo(this.hoverBond);\n\t\t\tlet units = new PolymerBlock(this.mol).getUnits();\n\t\t\tfor (let unit of units) if (unit.atoms.includes(bfr) && unit.atoms.includes(bto)) this.drawPolymerUnit(ctx, unit, units);\n\n\t\t\tlet sz = 0;\n\t\t\tif (this.hoverBond == this.currentBond) sz += 0.1;\n\t\t\tif (this.getSelected(bfr) && this.getSelected(bto)) sz += 0.1;\n\t\t\tthis.drawBondShade(ctx, this.hoverBond, HOVER_COL, -1, sz);\n\t\t}\n\n\t\t// draw selection and lasso preselection\n\t\tfor (let n = 1; n <= this.mol.numBonds; n++)\n\t\t{\n\t\t\tlet sz = n == this.currentBond ? 0.1 : 0;\n\t\t\tlet bfr = this.mol.bondFrom(n), bto = this.mol.bondTo(n);\n\t\t\tlet sfr = this.getSelected(bfr), sto = this.getSelected(bto), lfr = this.getLassoed(bfr), lto = this.getLassoed(bto);\n\t\t\tif (sfr && sto) this.drawBondShade(ctx, n, SELECT_COL, -1, sz);\n\t\t\telse if ((sfr || lfr) && (sto || lto)) this.drawBondShade(ctx, n, LASSO_COL, -1, sz);\n\t\t}\n\t\tfor (let n = 1; n <= this.mol.numAtoms; n++)\n\t\t{\n\t\t\tlet sz = this.currentAtom == n ? 0.1 : 0;\n\t\t\tif (this.getSelected(n)) this.drawAtomShade(ctx, n, SELECT_COL, -1, sz);\n\t\t\telse if (this.getLassoed(n)) this.drawAtomShade(ctx, n, LASSO_COL, -1, sz);\n\t\t}\n\n\t\t// draw current atom/bond\n\t\tif (this.currentAtom > 0)\n\t\t{\n\t\t\tthis.drawAtomShade(ctx, this.currentAtom, CURRENT_COL, CURRENT_BORD, 0);\n\t\t}\n\t\tif (this.currentBond > 0)\n\t\t{\n\t\t\tthis.drawBondShade(ctx, this.currentBond, CURRENT_COL, CURRENT_BORD, 0);\n\t\t}\n\n\t\t// if moving or dragging a new atom/bond, draw the guides\n\t\tif (this.dragType == DraggingTool.Move || (this.dragType == DraggingTool.Atom && this.opAtom > 0) || this.dragType == DraggingTool.Bond)\n\t\t{\n\t\t\tif (this.dragGuides != null && this.dragGuides.length > 0)\n\t\t\t{\n\t\t\t\tfor (let g of this.dragGuides) for (let n = 0; n < g.x.length; n++)\n\t\t\t\t{\n\t\t\t\t\tlet lw = this.policy.data.lineSize * this.pointScale;\n\t\t\t\t\tctx.strokeStyle = '#C0C0C0';\n\t\t\t\t\tctx.lineWidth = lw;\n\t\t\t\t\tdrawLine(ctx, g.sourceX, g.sourceY, g.destX[n], g.destY[n]);\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\tctx.ellipse(g.destX[n], g.destY[n], 2 * lw, 2 * lw, 0, 0, TWOPI, false);\n\t\t\t\t\tctx.fillStyle = '#C0C0C0';\n\t\t\t\t\tctx.fill();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// if creating a new ring, draw it\n\t\tif (this.dragType == DraggingTool.Ring)\n\t\t{\n\t\t\tlet [ringX, ringY] = this.determineFauxRing();\n\t\t\tlet rsz = ringX == null ? 0 : ringX.length;\n\t\t\tif (rsz > 0)\n\t\t\t{\n\t\t\t\tlet scale = this.pointScale;\n\t\t\t\tlet lw = this.policy.data.lineSize * scale;\n\t\t\t\tctx.strokeStyle = '#C0C0C0';\n\t\t\t\tctx.lineWidth = lw;\n\n\t\t\t\tfor (let n = 0; n < rsz; n++)\n\t\t\t\t{\n\t\t\t\t\tlet nn = n < rsz - 1 ? n + 1 : 0;\n\t\t\t\t\tlet x1 = this.angToX(ringX[n]), y1 = this.angToY(ringY[n]);\n\t\t\t\t\tlet x2 = this.angToX(ringX[nn]), y2 = this.angToY(ringY[nn]);\n\t\t\t\t\tdrawLine(ctx, x1, y1, x2, y2);\n\t\t\t\t}\n\n\t\t\t\tif (this.toolRingArom)\n\t\t\t\t{\n\t\t\t\t\tlet cx = 0, cy = 0;\n\t\t\t\t\tfor (let n = 0; n < rsz; n++) {cx += ringX[n]; cy += ringY[n];}\n\t\t\t\t\tcx /= rsz; cy /= rsz;\n\t\t\t\t\tlet rad = 0;\n\t\t\t\t\tfor (let n = 0; n < rsz; n++) rad += norm_xy(ringX[n] - cx, ringY[n] - cy);\n\t\t\t\t\trad = this.angToScale(rad * 0.5 / rsz);\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\tctx.ellipse(this.angToX(cx), this.angToY(cy), rad, rad, 0, 0, TWOPI, false);\n\t\t\t\t\tctx.stroke();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tctx.restore();\n\t}\n\tprotected redrawMolecule():void\n\t{\n\t\tlet density = pixelDensity();\n\t\tthis.canvasMolecule.elCanvas.width = this.width * density;\n\t\tthis.canvasMolecule.elCanvas.height = this.height * density;\n\t\tthis.canvasMolecule.css({'width': `${this.width}px`, 'height': `${this.height}px`});\n\n\t\tlet ctx = this.canvasMolecule.elCanvas.getContext('2d');\n\t\tctx.save();\n\t\tctx.scale(density, density);\n\t\tctx.clearRect(0, 0, this.width, this.height);\n\n\t\tif (this.metavec != null) this.metavec.renderContext(ctx);\n\n\t\t// debugging only\n\t\t/*for (let n = 1; n <= this.mol.numBonds; n++)\n\t\t{\n\t\t\tlet bfr = this.mol.bondFrom(n), bto = this.mol.bondTo(n);\n\t\t\tlet x1 = this.angToX(this.mol.atomX(bfr)), y1 = this.angToY(this.mol.atomY(bfr));\n\t\t\tlet x2 = this.angToX(this.mol.atomX(bto)), y2 = this.angToY(this.mol.atomY(bto));\n\t\t\tctx.strokeStyle = 'red';\n\t\t\tctx.lineWidth = 1;\n\t\t\tctx.moveTo(x1, y1);\n\t\t\tctx.lineTo(x2, y2);\n\t\t\tctx.stroke();\n\t\t}*/\n\n\t\tif (this.templatePerms != null)\n\t\t{\n\t\t\tlet perm = this.templatePerms[this.currentPerm];\n\t\t\tif (perm.metavec != null) perm.metavec.renderContext(ctx);\n\t\t}\n\n\t\tctx.restore();\n\t}\n\tprotected redrawOver():void\n\t{\n\t\tlet density = pixelDensity();\n\t\tthis.canvasOver.elCanvas.width = this.width * density;\n\t\tthis.canvasOver.elCanvas.height = this.height * density;\n\t\tthis.canvasOver.css({'width': `${this.width}px`, 'height': `${this.height}px`});\n\n\t\tlet ctx = this.canvasOver.elCanvas.getContext('2d');\n\t\tctx.save();\n\t\tctx.scale(density, density);\n\t\tctx.clearRect(0, 0, this.width, this.height);\n\n\t\t// draw the lasso\n\t\tif ((this.dragType == DraggingTool.Lasso || this.dragType == DraggingTool.Erasor) && this.lassoX.length > 1)\n\t\t{\n\t\t\tlet erasing = this.dragType == DraggingTool.Erasor;\n\n\t\t\tlet path = new Path2D();\n\t\t\tpath.moveTo(this.lassoX[0], this.lassoY[0]);\n\t\t\tfor (let n = 1; n < this.lassoX.length; n++) path.lineTo(this.lassoX[n], this.lassoY[n]);\n\t\t\tpath.closePath();\n\n\t\t\tctx.fillStyle = colourCanvas(erasing ? 0xD0FF0000 : 0xF0000000);\n\t\t\tctx.fill(path);\n\n\t\t\tctx.strokeStyle = erasing ? '#804040' : '#808080';\n\t\t\tctx.lineWidth = 0.5;\n\t\t\tctx.stroke(path);\n\t\t}\n\n\t\t// draw the rotation theta\n\t\tif (this.dragType == DraggingTool.Rotate)\n\t\t{\n\t\t\tlet [x0, y0, theta, magnitude] = this.determineDragTheta();\n\t\t\tlet scale = this.pointScale;\n\t\t\tlet lw = this.policy.data.lineSize * scale;\n\t\t\tctx.strokeStyle = '#E0E0E0';\n\t\t\tctx.lineWidth = 0.5 * lw;\n\t\t\tdrawLine(ctx, x0, y0, x0 + magnitude, y0);\n\t\t\tctx.strokeStyle = '#808080';\n\t\t\tctx.lineWidth = lw;\n\t\t\tdrawLine(ctx, x0, y0, x0 + magnitude * Math.cos(theta), y0 + magnitude * Math.sin(theta));\n\t\t\tctx.beginPath();\n\t\t\tctx.ellipse(x0, y0, 2 * lw, 2 * lw, 0, 0, TWOPI, false);\n\t\t\tctx.fillStyle = '#808080';\n\t\t\tctx.fill();\n\t\t\t// !! draw 0 degrees and a nice arc...\n\n\t\t\tfor (let atom of this.subjectAtoms(true, false))\n\t\t\t{\n\t\t\t\tlet ax = this.angToX(this.mol.atomX(atom)), ay = this.angToY(this.mol.atomY(atom));\n\t\t\t\t//let ax = this.arrmol.points[atom - 1].cx, ay = this.arrmol.points[atom - 1].cy;\n\t\t\t\tlet ang = Math.atan2(ay - y0, ax - x0), dist = norm_xy(ax - x0, ay - y0);\n\t\t\t\tlet nx = x0 + dist * Math.cos(ang + theta), ny = y0 + dist * Math.sin(ang + theta);\n\t\t\t\tctx.beginPath();\n\t\t\t\tctx.ellipse(nx, ny, 2 * lw, 2 * lw, 0, 0, TWOPI, false);\n\t\t\t\tctx.strokeStyle = 'black';\n\t\t\t\tctx.lineWidth = 0.5;\n\t\t\t\tctx.stroke();\n\t\t\t}\n\t\t}\n\n\t\t// draw the displacement of subject atoms\n\t\tif (this.dragType == DraggingTool.Move)\n\t\t{\n\t\t\tlet [dx, dy] = this.determineMoveDelta();\n\t\t\tlet scale = this.pointScale;\n\t\t\tlet lw = this.policy.data.lineSize * scale;\n\t\t\tfor (let atom of this.subjectAtoms(false, true))\n\t\t\t{\n\t\t\t\tlet ax = this.angToX(this.mol.atomX(atom)), ay = this.angToY(this.mol.atomY(atom));\n\t\t\t\tctx.beginPath();\n\t\t\t\tctx.ellipse(ax + dx, ay + dy, 2 * lw, 2 * lw, 0, 0, TWOPI, false);\n\t\t\t\tctx.strokeStyle = 'black';\n\t\t\t\tctx.lineWidth = 0.5;\n\t\t\t\tctx.stroke();\n\t\t\t}\n\t\t}\n\n\t\t// draw the dragging of a bond-and-atom to a new position\n\t\tif ((this.dragType == DraggingTool.Atom && this.opAtom > 0) || this.dragType == DraggingTool.Bond)\n\t\t{\n\t\t\tlet element = this.dragType == DraggingTool.Atom ? this.toolAtomSymbol : 'C';\n\t\t\tlet order = this.dragType == DraggingTool.Bond ? this.toolBondOrder : 1;\n\t\t\tlet type = this.dragType == DraggingTool.Bond ? this.toolBondType : Molecule.BONDTYPE_NORMAL;\n\t\t\tthis.drawOriginatingBond(ctx, element, order, type);\n\t\t}\n\n\t\tif (this.viewOpt.showQuery) this.drawQueryFeatures(ctx);\n\n\t\tctx.restore();\n\t}\n\n\t// returns an array of atom indices that make up the selection/current, or empty if nothing; if the \"allIfNone\" flag\n\t// is set, all of the atoms will be returned if otherwise would have been none; if \"useOpAtom\" is true, an empty\n\t// selection will be beefed up by the current mouseunder atom\n\tprotected subjectAtoms(allIfNone = false, useOpAtom = false):number[]\n\t{\n\t\tlet atoms:number[] = [];\n\t\tif (this.selectedMask != null)\n\t\t{\n\t\t\tfor (let n = 0; n < this.selectedMask.length; n++) if (this.selectedMask[n]) atoms.push(n + 1);\n\t\t\tif (atoms.length > 0) return atoms;\n\t\t}\n\t\tif (this.currentAtom > 0) atoms.push(this.currentAtom);\n\t\telse if (this.currentBond > 0)\n\t\t{\n\t\t\tatoms.push(this.mol.bondFrom(this.currentBond));\n\t\t\tatoms.push(this.mol.bondTo(this.currentBond));\n\t\t}\n\t\tif (useOpAtom && atoms.length == 0 && this.opAtom > 0) atoms.push(this.opAtom);\n\t\tif (allIfNone && atoms.length == 0)\n\t\t{\n\t\t\tfor (let n = 1; n <= this.mol.numAtoms; n++) atoms.push(n);\n\t\t}\n\t\treturn atoms;\n\t}\n\n\t// response to some mouse event: lasso may need to be extended, or cancelled\n\tprotected updateLasso(x:number, y:number):void\n\t{\n\t\tif (this.dragType != DraggingTool.Lasso && this.dragType != DraggingTool.Erasor) return;\n\n\t\tif (x < 0 || y < 0 || x > this.width || y > this.height)\n\t\t{\n\t\t\tthis.dragType = DraggingTool.None;\n\t\t\tthis.lassoX = null;\n\t\t\tthis.lassoY = null;\n\t\t\tthis.lassoMask = null;\n\t\t\tthis.delayedRedraw();\n\t\t}\n\n\t\tlet len = Vec.len(this.lassoX);\n\t\tif (len > 0 && this.lassoX[len - 1] == x && this.lassoY[len - 1] == y) return; // identical\n\n\t\tthis.lassoX.push(x);\n\t\tthis.lassoY.push(y);\n\t\tthis.calculateLassoMask();\n\t\tthis.delayedRedraw();\n\t}\n\n\t// sets up the lasso mask to include any atom that is within the lasso polygon\n\tprotected calculateLassoMask():void\n\t{\n\t\tthis.lassoMask = new Array(this.mol.numAtoms);\n\t\tfor (let n = 0; n < this.mol.numAtoms; n++) this.lassoMask[n] = false;\n\n\t\tfor (let n = 0; n < this.layout.numPoints(); n++)\n\t\t{\n\t\t\tlet p = this.layout.getPoint(n);\n\t\t\tif (p.anum == 0) continue;\n\t\t\tthis.lassoMask[p.anum - 1] = GeomUtil.pointInPolygon(p.oval.cx, p.oval.cy, this.lassoX, this.lassoY);\n\t\t}\n\t}\n\n\t// ------------ private methods -----------\n\n\t// draws an ellipse around an atom/bond, for highlighting purposes\n\tprivate drawAtomShade(ctx:CanvasRenderingContext2D, atom:number, fillCol:number, borderCol:number, anghalo:number):void\n\t{\n\t\tif (this.layout == null) return;\n\n\t\tlet p:APoint = null;\n\t\tfor (let n = 0; n < this.layout.numPoints(); n++) if (this.layout.getPoint(n).anum == atom)\n\t\t{\n\t\t\tp = this.layout.getPoint(n);\n\t\t\tbreak;\n\t\t}\n\t\tif (p == null) return;\n\n\t\tlet minRad = 0.2 * this.pointScale, minRadSq = sqr(minRad);\n\t\tlet cx = p.oval.cx, cy = p.oval.cy;\n\t\tlet rad = Math.max(minRad, Math.max(p.oval.rw, p.oval.rh)) + (0.1 + anghalo) * this.pointScale;\n\n\t\tif (fillCol != -1)\n\t\t{\n\t\t\tctx.beginPath();\n\t\t\tctx.ellipse(cx, cy, rad, rad, 0, 0, TWOPI, true);\n\t\t\tctx.fillStyle = colourCanvas(fillCol);\n\t\t\tctx.fill();\n\t\t}\n\t\tif (borderCol != -1)\n\t\t{\n\t\t\tctx.beginPath();\n\t\t\tctx.ellipse(cx, cy, rad, rad, 0, 0, TWOPI, true);\n\t\t\tctx.strokeStyle = colourCanvas(borderCol);\n\t\t\tctx.lineWidth = 1;\n\t\t\tctx.stroke();\n\t\t}\n\t}\n\tprivate drawBondShade(ctx:CanvasRenderingContext2D, bond:number, fillCol:number, borderCol:number, anghalo:number):void\n\t{\n\t\tif (this.layout == null) return;\n\n\t\tlet x1 = 0, y1 = 0, x2 = 0, y2 = 0, nb = 0, sz = 0;\n\t\tfor (let n = 0; n < this.layout.numLines(); n++)\n\t\t{\n\t\t\tlet l = this.layout.getLine(n);\n\t\t\tif (l.bnum != bond) continue;\n\t\t\tx1 += l.line.x1; y1 += l.line.y1; x2 += l.line.x2; y2 += l.line.y2;\n\t\t\tnb++;\n\t\t\tsz += l.size + (0.2 + anghalo) * this.pointScale;\n\t\t}\n\t\tif (nb == 0) return;\n\n\t\tlet invNB = 1 / nb;\n\t\tsz *= invNB;\n\t\tx1 *= invNB;\n\t\ty1 *= invNB;\n\t\tx2 *= invNB;\n\t\ty2 *= invNB;\n\n\t\tlet dx = x2 - x1, dy = y2 - y1, invDist = 1 / norm_xy(dx, dy);\n\t\tdx *= invDist;\n\t\tdy *= invDist;\n\t\tlet ox = dy, oy = -dx;\n\n\t\tlet path = new Path2D(), mx:number, my:number, CIRC = 0.8;\n\t\tpath.moveTo(x1 + ox * sz, y1 + oy * sz);\n\n\t\tmx = x1 + (ox * sz - dx * sz) * CIRC;\n\t\tmy = y1 + (oy * sz - dy * sz) * CIRC;\n\t\tpath.quadraticCurveTo(mx, my, x1 - dx * sz, y1 - dy * sz);\n\n\t\tmx = x1 + (-ox * sz - dx * sz) * CIRC;\n\t\tmy = y1 + (-oy * sz - dy * sz) * CIRC;\n\t\tpath.quadraticCurveTo(mx, my, x1 - ox * sz, y1 - oy * sz);\n\t\tpath.lineTo(x2 - ox * sz, y2 - oy * sz);\n\n\t\tmx = x2 + (-ox * sz + dx * sz) * CIRC;\n\t\tmy = y2 + (-oy * sz + dy * sz) * CIRC;\n\t\tpath.quadraticCurveTo(mx, my, x2 + dx * sz, y2 + dy * sz);\n\n\t\tmx = x2 + (ox * sz + dx * sz) * CIRC;\n\t\tmy = y2 + (oy * sz + dy * sz) * CIRC;\n\t\tpath.quadraticCurveTo(mx, my, x2 + ox * sz, y2 + oy * sz);\n\n\t\tpath.closePath();\n\n\t\tif (fillCol != -1)\n\t\t{\n\t\t\tctx.beginPath();\n\t\t\tctx.fillStyle = colourCanvas(fillCol);\n\t\t\tctx.fill(path);\n\t\t}\n\t\tif (borderCol != -1)\n\t\t{\n\t\t\tctx.beginPath();\n\t\t\tctx.strokeStyle = colourCanvas(borderCol);\n\t\t\tctx.lineWidth = 1;\n\t\t\tctx.stroke(path);\n\t\t}\n\t}\n\n\t// draws an in-progress bond, originating either from the clicked-upon atom, or a point in space\n\tprivate drawOriginatingBond(ctx:CanvasRenderingContext2D, element:string, order:number, type:number)\n\t{\n\t\tlet x1 = this.clickX, y1 = this.clickY;\n\t\tif (this.opAtom > 0)\n\t\t{\n\t\t\tx1 = this.angToX(this.mol.atomX(this.opAtom));\n\t\t\ty1 = this.angToY(this.mol.atomY(this.opAtom));\n\t\t}\n\t\telse if (this.opBond > 0)\n\t\t{\n\t\t\tlet [bfr, bto] = this.mol.bondFromTo(this.opBond);\n\t\t\tx1 = this.angToX(0.5 * (this.mol.atomX(bfr) + this.mol.atomX(bto)));\n\t\t\ty1 = this.angToY(0.5 * (this.mol.atomY(bfr) + this.mol.atomY(bto)));\n\t\t}\n\t\tlet x2 = this.mouseX, y2 = this.mouseY;\n\n\t\tlet snapTo = this.snapToGuide(x2, y2), snapAtom = false;\n\t\tif (snapTo) [x2, y2, snapAtom] = snapTo;\n\n\t\tlet scale = this.pointScale;\n\n\t\tctx.strokeStyle = snapAtom ? '#4040FF' : '#808080';\n\t\tctx.lineWidth = this.policy.data.lineSize * scale * (snapAtom ? 1.5 : 1);\n\t\tdrawLine(ctx, x1, y1, x2, y2);\n\n\t\t// !! TODO: draw multiple bonds\n\n\t\tif (element != 'C')\n\t\t{\n\t\t\tlet fh = this.policy.data.fontSize * scale;\n\t\t\tctx.font = fontSansSerif(fh);\n\t\t\tlet metrics = ctx.measureText(element);\n\t\t\tctx.fillStyle = '#808080';\n\t\t\tctx.fillText(element, x2 - 0.5 * metrics.width, y2 + 0.5 * fh);\n\t\t}\n\t}\n\n\t// render query metadata for any atoms/bonds\n\tprivate drawQueryFeatures(ctx:CanvasRenderingContext2D):void\n\t{\n\t\tconst {layout, mol} = this;\n\n\t\tinterface Annotation\n\t\t{\n\t\t\ttxt:string;\n\t\t\tx:number;\n\t\t\ty:number;\n\t\t}\n\t\tlet annots:Annotation[] = [];\n\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (QueryUtil.hasAnyQueryAtom(mol, n))\n\t\t{\n\t\t\tlet bits:string[] = [];\n\t\t\tfor (let xtra of mol.atomExtra(n)) if (xtra.startsWith('q')) bits.push(xtra);\n\t\t\tlet ap = layout.getPoint(n - 1);\n\n\t\t\tannots.push({txt: bits.join(','), x: ap.oval.cx + ap.oval.rw, y: ap.oval.cy});\n\t\t}\n\n\t\tfor (let n = 1; n <= mol.numBonds; n++) if (QueryUtil.hasAnyQueryBond(mol, n))\n\t\t{\n\t\t\tlet bits:string[] = [];\n\t\t\tfor (let xtra of mol.bondExtra(n)) if (xtra.startsWith('q') && !xtra.startsWith(QueryTypeBond.Orders)) bits.push(xtra);\n\n\t\t\tlet num = 0, cx = 0, cy = 0;\n\t\t\tfor (let bl of layout.getLines()) if (bl.bnum == n)\n\t\t\t{\n\t\t\t\tnum += 2;\n\t\t\t\tcx += bl.line.x1 + bl.line.x2;\n\t\t\t\tcy += bl.line.y1 + bl.line.y2;\n\t\t\t}\n\n\t\t\tannots.push({txt: bits.join(','), x: cx / num, y: cy / num});\n\t\t}\n\n\t\t// NOTE: displaying the encoded syntax directly; this should ideally be replaced by a nicer rendering mnemonic\n\t\tlet fh = 0.7 * this.policy.data.fontSize * this.pointScale;\n\t\tfor (let annot of annots)\n\t\t{\n\t\t\tctx.font = fontSansSerif(fh);\n\t\t\t//let metrics = ctx.measureText(annot.txt);\n\t\t\tctx.fillStyle = '#FF40C0';\n\t\t\tctx.fillText(annot.txt, annot.x, annot.y);\n\t\t}\n\t}\n\n\t// renders a polymer block unit by drawing the outline and some key connectivity information\n\tprivate drawPolymerUnit(ctx:CanvasRenderingContext2D, unit:PolymerBlockUnit, allUnits:PolymerBlockUnit[]):void\n\t{\n\t\tconst {mol, layout} = this;\n\n\t\t// part 1: draw outline around the polymer segment\n\n\t\tlet x:number[] = [], y:number[] = [];\n\t\tlet scale = this.pointScale;\n\n\t\tfor (let a of unit.atoms)\n\t\t{\n\t\t\tlet pt = layout.getPoint(a - 1);\n\t\t\tlet rad = Math.max(0.5 * scale, Math.max(pt.oval.rw, pt.oval.rh));\n\t\t\tconst NPT = 36, THPT = TWOPI / NPT;\n\t\t\tfor (let n = 0; n < NPT; n++)\n\t\t\t{\n\t\t\t\tlet th = n * THPT;\n\t\t\t\tx.push(pt.oval.cx + rad * Math.cos(th));\n\t\t\t\ty.push(pt.oval.cy + rad * Math.sin(th));\n\t\t\t}\n\t\t}\n\n\t\tlet extBonds:number[] = [], inAtoms:number[] = [], outAtoms:number[] = [];\n\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t{\n\t\t\tlet bfr = mol.bondFrom(n), bto = mol.bondTo(n);\n\t\t\tlet flag1 = unit.atoms.includes(bfr), flag2 = unit.atoms.includes(bto);\n\t\t\tif (!flag1 && !flag2) continue;\n\t\t\tif (!flag2)\n\t\t\t{\n\t\t\t\textBonds.push(n);\n\t\t\t\tinAtoms.push(bfr);\n\t\t\t\toutAtoms.push(bto);\n\t\t\t}\n\t\t\telse if (!flag1)\n\t\t\t{\n\t\t\t\textBonds.push(n);\n\t\t\t\tinAtoms.push(bto);\n\t\t\t\toutAtoms.push(bfr);\n\t\t\t}\n\n\t\t\tlet pt1 = layout.getPoint(bfr - 1), pt2 = layout.getPoint(bto - 1);\n\t\t\tlet x1 = pt1.oval.cx, y1 = pt1.oval.cy, x2 = pt2.oval.cx, y2 = pt2.oval.cy;\n\t\t\tif (!flag1) [x1, y1] = [0.5 * (x1 + x2), 0.5 * (y1 + y2)];\n\t\t\telse if (!flag2) [x2, y2] = [0.5 * (x1 + x2), 0.5 * (y1 + y2)];\n\t\t\tlet dx = x2 - x1, dy = y2 - y1, d = norm_xy(dx, dy), invD = invZ(d);\n\t\t\tlet ox = dy * invD * 0.3 * scale, oy = -dx * invD * 0.3 * scale;\n\t\t\tlet npWidth = Math.ceil(2 * d / scale) + 1, npHeight = Math.ceil(2 * norm_xy(ox, oy) / scale) + 1;\n\t\t\tfor (let n = 0; n <= npWidth; n++)\n\t\t\t{\n\t\t\t\tx.push(x1 - ox + dx * n / npWidth);\n\t\t\t\ty.push(y1 - oy + dy * n / npWidth);\n\t\t\t\tx.push(x1 + ox + dx * n / npWidth);\n\t\t\t\ty.push(y1 + oy + dy * n / npWidth);\n\t\t\t}\n\t\t\tfor (let n = 1; n < npHeight; n++)\n\t\t\t{\n\t\t\t\tx.push(x1 - ox + 2 * ox * n / npHeight);\n\t\t\t\ty.push(y1 - oy + 2 * oy * n / npHeight);\n\t\t\t\tx.push(x2 - ox + 2 * ox * n / npHeight);\n\t\t\t\ty.push(y2 - oy + 2 * oy * n / npHeight);\n\t\t\t}\n\t\t}\n\n\t\tlet [px, py] = GeomUtil.outlinePolygon(x, y, 0.5 * scale);\n\n\t\tlet path = new Path2D();\n\t\tpath.moveTo(px[0], py[0]);\n\t\tfor (let n = 1; n < px.length; n++) path.lineTo(px[n], py[n]);\n\t\tpath.closePath();\n\n\t\tctx.save();\n\t\tctx.fillStyle = '#F9EFFF';\n\t\tctx.fill(path);\n\t\tctx.strokeStyle = '#C0C0C0';\n\t\tctx.lineWidth = 1;\n\t\t//ctx.setLineDash([1, 1]);\n\t\tctx.stroke(path);\n\t\tctx.restore();\n\n\t\t// part 2: draw atom-to-atom connectivity options\n\n\t\tlet selfLinks:number[] = [];\n\t\tlet innerLinks:[number, number][] = [];\n\t\tlet outerLinks:[number, number][] = [];\n\n\t\tif (Vec.len(unit.bondConn) == 4)\n\t\t{\n\t\t\tinnerLinks.push([inAtoms[extBonds.indexOf(unit.bondConn[0])], inAtoms[extBonds.indexOf(unit.bondConn[2])]]);\n\t\t\tinnerLinks.push([inAtoms[extBonds.indexOf(unit.bondConn[1])], inAtoms[extBonds.indexOf(unit.bondConn[3])]]);\n\t\t}\n\t\telse if (Vec.len(extBonds) == 2 && unit.connect != null)\n\t\t{\n\t\t\tif (unit.connect == PolymerBlockConnectivity.HeadToTail || unit.connect == PolymerBlockConnectivity.Random)\n\t\t\t{\n\t\t\t\tinnerLinks.push([inAtoms[0], inAtoms[1]]);\n\t\t\t}\n\t\t\tif (unit.connect == PolymerBlockConnectivity.HeadToHead || unit.connect == PolymerBlockConnectivity.Random)\n\t\t\t{\n\t\t\t\tselfLinks.push(inAtoms[0]);\n\t\t\t\tselfLinks.push(inAtoms[1]);\n\t\t\t}\n\t\t}\n\t\telse // anything goes\n\t\t{\n\t\t\tfor (let b of extBonds)\n\t\t\t{\n\t\t\t\tlet a1 = mol.bondFrom(b), a2 = mol.bondTo(b);\n\t\t\t\tif (unit.atoms.includes(a2)) [a1, a2] = [a2, a1];\n\t\t\t\tlet incl = unit.bondIncl.get(b), excl = unit.bondExcl.get(b);\n\n\t\t\t\tlet isCapped = mol.atomElement(a2) != POLYMERBLOCK_SPECIAL_UNCAPPED;\n\n\t\t\t\tfor (let look of (isCapped ? [unit] : allUnits)) for (let a of look.atoms)\n\t\t\t\t{\n\t\t\t\t\tlet isExt = false;\n\t\t\t\t\tfor (let adj of mol.atomAdjList(a)) if (!look.atoms.includes(adj)) {isExt = true; break;}\n\t\t\t\t\tif (!isExt) continue;\n\n\t\t\t\t\tif (Vec.notBlank(incl))\n\t\t\t\t\t{\n\t\t\t\t\t\tlet anames = look.atomName.get(a), any = false;\n\t\t\t\t\t\tif (anames) for (let an of anames) any = any || incl.includes(an);\n\t\t\t\t\t\tif (!any) continue;\n\t\t\t\t\t}\n\t\t\t\t\tif (Vec.notBlank(excl))\n\t\t\t\t\t{\n\t\t\t\t\t\tlet anames = look.atomName.get(a), any = false;\n\t\t\t\t\t\tif (anames) for (let an of anames) any = any || excl.includes(an);\n\t\t\t\t\t\tif (any) continue;\n\t\t\t\t\t}\n\t\t\t\t\tif (a == a1) selfLinks.push(a1);\n\t\t\t\t\telse if (unit === look) innerLinks.push([a1, a]);\n\t\t\t\t\telse outerLinks.push([a1, a]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tselfLinks = Vec.uniqueStable(selfLinks);\n\t\tinnerLinks = Vec.maskGet(innerLinks, Vec.maskUnique(innerLinks.map((pair) => Vec.min(pair) * mol.numAtoms + Vec.max(pair))));\n\t\touterLinks = Vec.maskGet(outerLinks, Vec.maskUnique(outerLinks.map((pair) => Vec.min(pair) * mol.numAtoms + Vec.max(pair))));\n\n\t\tctx.save();\n\t\tctx.strokeStyle = '#6329C1';\n\t\tctx.lineWidth = 2;\n\t\tctx.setLineDash([1, 1]);\n\t\tctx.beginPath();\n\n\t\tfor (let a of selfLinks)\n\t\t{\n\t\t\tlet p1 = layout.getPoint(a - 1), x1 = p1.oval.cx, y1 = p1.oval.cy;\n\t\t\tlet x2 = 0, y2 = 0, num = 0;\n\t\t\tfor (let n = 0; n < extBonds.length; n++) if (inAtoms[n] == a)\n\t\t\t{\n\t\t\t\tlet p2 = layout.getPoint(outAtoms[n] - 1);\n\t\t\t\tx2 += p2.oval.cx;\n\t\t\t\ty2 += p2.oval.cy;\n\t\t\t\tnum++;\n\t\t\t}\n\t\t\tif (num > 1) {x2 /= num; y2 /= num;}\n\t\t\tx2 = x1 + 0.5 * (x2 - x1);\n\t\t\ty2 = y1 + 0.5 * (y2 - y1);\n\n\t\t\tlet dx = x2 - x1, dy = y2 - y1, invD = invZ(norm_xy(dx, dy)), ox = dy * invD, oy = -dx * invD;\n\t\t\tlet cx = 0.5 * (x1 + x2), cy = 0.5 * (y1 + y2);\n\t\t\tconst EXT = 2 * scale;\n\t\t\tctx.moveTo(x1, y1);\n\t\t\tctx.quadraticCurveTo(cx + ox * EXT, cy + oy * EXT, x2, y2);\n\t\t\tctx.quadraticCurveTo(cx - ox * EXT, cy - oy * EXT, x1, y1);\n\t\t}\n\t\tfor (let [a1, a2] of innerLinks)\n\t\t{\n\t\t\tlet x1 = mol.atomX(a1), y1 = mol.atomY(a1), x2 = mol.atomX(a2), y2 = mol.atomY(a2);\n\t\t\tlet dx = x2 - x1, dy = y2 - y1, invD = invZ(norm_xy(dx, dy)), ox = dy * invD, oy = -dx * invD;\n\t\t\tlet cx = 0.5 * (x1 + x2), cy = 0.5 * (y1 + y2);\n\t\t\tconst EXT = 5;\n\t\t\tlet px1 = cx + ox * EXT, py1 = cy + oy * EXT, px2 = cx - ox * EXT, py2 = cy - oy * EXT;\n\t\t\tlet [px, py] = CoordUtil.congestionPoint(mol, px1, py1) < CoordUtil.congestionPoint(mol, px2, py2) ? [px1, py1] : [px2, py2];\n\t\t\tctx.moveTo(this.angToX(x1), this.angToY(y1));\n\t\t\tctx.quadraticCurveTo(this.angToX(px), this.angToY(py), this.angToX(x2), this.angToY(y2));\n\t\t}\n\t\tfor (let [a1, a2] of outerLinks)\n\t\t{\n\t\t\tlet p1 = layout.getPoint(a1 - 1), p2 = layout.getPoint(a2 - 1);\n\t\t\tctx.moveTo(p1.oval.cx, p1.oval.cy);\n\t\t\tctx.lineTo(p2.oval.cx, p2.oval.cy);\n\t\t}\n\n\t\tctx.stroke();\n\t\tctx.restore();\n\t}\n\n\t// based on drag state, calculates a ring that's fused & locked to the origination\n\tprotected determineFauxRing():[number[], number[]]\n\t{\n\t\tlet atom = this.opAtom, bond = this.opBond, mol = this.mol;\n\t\tlet x1 = atom > 0 ? mol.atomX(atom) : bond > 0 ? 0.5 * (mol.atomX(mol.bondFrom(bond)) + mol.atomX(mol.bondTo(bond))) : this.xToAng(this.clickX);\n\t\tlet y1 = atom > 0 ? mol.atomY(atom) : bond > 0 ? 0.5 * (mol.atomY(mol.bondFrom(bond)) + mol.atomY(mol.bondTo(bond))) : this.yToAng(this.clickY);\n\t\tlet x2 = this.xToAng(this.mouseX), y2 = this.yToAng(this.mouseY), dx = x2 - x1, dy = y2 - y1;\n\t\tlet rsz = Math.min(9, Math.round(norm_xy(dx, dy) * 2 / Molecule.IDEALBOND) + 2);\n\n\t\tif (rsz < 3) {}\n\t\telse if (bond > 0) return SketchUtil.proposeBondRing(mol, rsz, bond, dx, dy);\n\t\telse if (atom > 0 && mol.atomAdjCount(atom) > 0 && !this.toolRingFreeform) return SketchUtil.proposeAtomRing(mol, rsz, atom, dx, dy);\n\t\telse return SketchUtil.proposeNewRing(mol, rsz, x1, y1, dx, dy, !this.toolRingFreeform);\n\n\t\treturn [null, null];\n\t}\n\n\t// based on the mouse position, determine the implied rotation for the interactive operation\n\tprotected determineDragTheta():[number, number, number, number]\n\t{\n\t\tlet x0 = this.clickX, y0 = this.clickY;\n\t\tlet snap = this.snapToGuide(x0, y0);\n\t\tif (snap != null) {x0 = snap[0]; y0 = snap[1];}\n\t\tlet theta = Math.atan2(this.mouseY - y0, this.mouseX - x0), magnitude = norm_xy(this.mouseX - x0, this.mouseY - y0);\n\t\tif (this.toolRotateIncr > 0) theta = Math.round(theta / this.toolRotateIncr) * this.toolRotateIncr;\n\t\treturn [x0, y0, theta, magnitude];\n\t}\n\n\t// determine the delta, in pixels, for a drag-move operation: the source and destination may be snapped\n\tprotected determineMoveDelta():[number, number]\n\t{\n\t\tlet x1 = this.clickX, y1 = this.clickY, x2 = this.mouseX, y2 = this.mouseY;\n\t\tif (this.opAtom > 0)\n\t\t{\n\t\t\tx1 = this.angToX(this.mol.atomX(this.opAtom));\n\t\t\ty1 = this.angToY(this.mol.atomY(this.opAtom));\n\t\t\tlet snap = this.snapToGuide(x2, y2);\n\t\t\tif (snap != null) {x2 = snap[0]; y2 = snap[1];}\n\t\t}\n\t\treturn [x2 - x1, y2 - y1];\n\t}\n\n\t// if the mouse position is close to one of the snap-to points, or an existing atom, return that position\n\tprotected snapToGuide(x:number, y:number):[number, number, boolean]\n\t{\n\t\t// if coming from a bond, only snap to other bonds\n\t\tif (this.opBond > 0)\n\t\t{\n\t\t\tlet obj = this.pickObject(x, y);\n\t\t\tif (obj < 0)\n\t\t\t{\n\t\t\t\tlet [bfr, bto] = this.mol.bondFromTo(-obj);\n\t\t\t\tlet px = this.angToX(0.5 * (this.mol.atomX(bfr) + this.mol.atomX(bto)));\n\t\t\t\tlet py = this.angToY(0.5 * (this.mol.atomY(bfr) + this.mol.atomY(bto)));\n\t\t\t\treturn [px, py, false];\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\n\t\t// try guides & atoms for snapping\n\t\tlet bestDSQ = Number.POSITIVE_INFINITY, bestX = 0, bestY = 0, bestAtom = false;\n\t\tconst APPROACH = sqr(0.5 * this.pointScale);\n\t\tif (this.dragGuides != null) for (let i = 0; i < this.dragGuides.length; i++) for (let j = 0; j < this.dragGuides[i].x.length; j++)\n\t\t{\n\t\t\tlet px = this.dragGuides[i].destX[j], py = this.dragGuides[i].destY[j];\n\t\t\tlet dsq = norm2_xy(px - x, py - y);\n\t\t\tif (dsq < APPROACH && dsq < bestDSQ) [bestDSQ, bestX, bestY, bestAtom] = [dsq, px, py, false];\n\t\t}\n\t\tfor (let n = 1; n <= this.mol.numAtoms; n++)\n\t\t{\n\t\t\tlet px = this.angToX(this.mol.atomX(n)), py = this.angToY(this.mol.atomY(n));\n\t\t\tlet dsq = norm2_xy(px - x, py - y);\n\t\t\tif (dsq < APPROACH && dsq < bestDSQ) [bestDSQ, bestX, bestY, bestAtom] = [dsq, px, py, true];\n\t\t}\n\t\tif (isFinite(bestDSQ)) return [bestX, bestY, bestAtom];\n\n\t\treturn null;\n\t}\n\n\t// locates a molecular object at the given position: returns N for atom, -N for bond, 0 for nothing, or null for not-on-canvas (e.g. button banks)\n\tprotected pickObjectCanvas(x:number, y:number, opt:{noAtoms?:boolean; noBonds?:boolean} = {}):number\n\t{\n\t\t// proceed with atoms & bonds\n\n\t\tlet limitDist = 0.5 * this.pointScale;\n\t\tlet bestItem = 0, bestScore = Number.POSITIVE_INFINITY;\n\n\t\t// look for close atoms\n\t\tif (!opt.noAtoms) for (let n = 0; n < this.layout.numPoints(); n++)\n\t\t{\n\t\t\tlet p = this.layout.getPoint(n);\n\t\t\tif (p.anum == 0) continue;\n\n\t\t\tlet dx = Math.abs(x - p.oval.cx), dy = Math.abs(y - p.oval.cy);\n\t\t\tlet dsq = norm2_xy(dx, dy);\n\t\t\tlet limitDSQ = sqr(Math.max(limitDist, Math.max(p.oval.rw, p.oval.rh)));\n\t\t\tif (dsq > limitDSQ) continue;\n\t\t\tif (dsq < bestScore)\n\t\t\t{\n\t\t\t\tbestItem = p.anum;\n\t\t\t\tbestScore = dsq;\n\t\t\t}\n\t\t}\n\t\tif (bestItem != 0) return bestItem;\n\n\t\t// look for close bonds\n\t\tif (!opt.noBonds) for (let n = 0; n < this.layout.numLines(); n++)\n\t\t{\n\t\t\tlet l = this.layout.getLine(n);\n\t\t\tif (l.bnum == 0) continue;\n\n\t\t\tlet x1 = l.line.x1, y1 = l.line.y1;\n\t\t\tlet x2 = l.line.x2, y2 = l.line.y2;\n\n\t\t\tif (x < Math.min(x1, x2) - limitDist || y < Math.min(y1, y2) - limitDist ||\n\t\t\t\tx > Math.max(x1, x2) + limitDist || y > Math.max(y1, y2) + limitDist) continue;\n\n\t\t\tlet dist = GeomUtil.pointLineSegDistance(x, y, x1, y1, x2, y2);\n\t\t\tif (dist > limitDist) continue;\n\t\t\tif (dist < bestScore)\n\t\t\t{\n\t\t\t\tbestItem = -l.bnum;\n\t\t\t\tbestScore = dist;\n\t\t\t}\n\t\t}\n\n\t\treturn bestItem;\n\t}\n\tprotected pickObject(x:number, y:number, opt:{noAtoms?:boolean; noBonds?:boolean} = {}):number\n\t{\n\t\treturn this.pickObjectCanvas(x, y, opt) || 0;\n\t}\n\n\t// puts together an effects parameter for the main sketch\n\tprivate sketchEffects(mol:Molecule):RenderEffects\n\t{\n\t\tlet effects = new RenderEffects();\n\n\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (MolUtil.hasAbbrev(mol, n) && n != this.hoverAtom) effects.dottedRectOutline[n] = 0x808080;\n\n\t\teffects.overlapAtoms = CoordUtil.overlappingAtomList(mol, 0.2);\n\n\t\teffects.atomDecoText = Vec.stringArray('', mol.numAtoms);\n\t\teffects.atomDecoCol = Vec.numberArray(Theme.foreground, mol.numAtoms);\n\t\teffects.atomDecoSize = Vec.numberArray(0.3, mol.numAtoms);\n\t\teffects.bondDecoText = Vec.stringArray('', mol.numBonds);\n\t\teffects.bondDecoCol = Vec.numberArray(Theme.foreground, mol.numBonds);\n\t\teffects.bondDecoSize = Vec.numberArray(0.3, mol.numBonds);\n\n\t\tif (this.viewOpt.showOxState)\n\t\t{\n\t\t\tfor (let n = 1; n <= mol.numAtoms; n++)\n\t\t\t{\n\t\t\t\tlet ox = MolUtil.atomOxidationState(mol, n);\n\t\t\t\tif (ox != null)\n\t\t\t\t{\n\t\t\t\t\teffects.atomDecoText[n - 1] = MolUtil.oxidationStateText(ox);\n\t\t\t\t\teffects.atomDecoCol[n - 1] = 0xFF8080;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.viewOpt.decoration == DrawCanvasDecoration.Stereochemistry)\n\t\t{\n\t\t\tif (!this.stereo) this.stereo = Stereochemistry.create(MetaMolecule.createStrict(mol));\n\t\t\tskip: for (let n = 1; n <= mol.numAtoms; n++)\n\t\t\t{\n\t\t\t\tlet chi = this.stereo.atomTetraChirality(n);\n\t\t\t\tif (chi == Stereochemistry.STEREO_NONE) continue;\n\t\t\t\tfor (let adjb of mol.atomAdjBonds(n)) if (mol.bondOrder(adjb) != 1) continue skip;\n\t\t\t\tif (chi == Stereochemistry.STEREO_UNKNOWN)\n\t\t\t\t{\n\t\t\t\t\tfor (let adj of mol.atomAdjList(n)) if (Chemistry.ELEMENT_BLOCKS[mol.atomicNumber(adj)] >= 3) continue skip;\n\t\t\t\t}\n\t\t\t\teffects.atomDecoText[n - 1] = chi == Stereochemistry.STEREO_POS ? 'R' :\n\t\t\t\t\t\t\t\t\t\t\t  chi == Stereochemistry.STEREO_NEG ? 'S' :\n\t\t\t\t\t\t\t\t\t\t\t  chi == Stereochemistry.STEREO_UNKNOWN ? 'R/S' : /*STEREO_BROKEN*/ '?';\n\t\t\t\teffects.atomDecoCol[n - 1] = 0x00A000;\n\t\t\t}\n\t\t\tfor (let n = 1; n <= mol.numBonds; n++)\n\t\t\t{\n\t\t\t\tlet side = this.stereo.bondSideStereo(n);\n\t\t\t\tif (side == Stereochemistry.STEREO_NONE) continue;\n\t\t\t\teffects.bondDecoText[n - 1] = side == Stereochemistry.STEREO_POS ? 'Z' :\n\t\t\t\t\t\t\t\t\t\t\t  side == Stereochemistry.STEREO_NEG ? 'E' :\n\t\t\t\t\t\t\t\t\t\t\t  side == Stereochemistry.STEREO_UNKNOWN ? 'Z/E' : /*STEREO_BROKEN*/ '?';\n\t\t\t\teffects.bondDecoCol[n - 1] = 0x00A000;\n\t\t\t}\n\t\t}\n\t\telse if (this.viewOpt.decoration == DrawCanvasDecoration.MappingNumber)\n\t\t{\n\t\t\teffects.atomDecoText = Vec.stringArray('', mol.numAtoms);\n\t\t\teffects.atomDecoCol = Vec.numberArray(0x8000FF, mol.numAtoms);\n\t\t\teffects.atomDecoSize = Vec.numberArray(0.3, mol.numAtoms);\n\t\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (mol.atomMapNum(n) > 0) effects.atomDecoText[n - 1] = mol.atomMapNum(n).toString();\n\t\t}\n\t\telse if (this.viewOpt.decoration == DrawCanvasDecoration.AtomIndex)\n\t\t{\n\t\t\teffects.atomDecoText = Vec.stringArray('', mol.numAtoms);\n\t\t\teffects.atomDecoCol = Vec.numberArray(0x8000FF, mol.numAtoms);\n\t\t\teffects.atomDecoSize = Vec.numberArray(0.3, mol.numAtoms);\n\t\t\tfor (let n = 1; n <= mol.numAtoms; n++) effects.atomDecoText[n - 1] = n.toString();\n\t\t}\n\n\t\treturn effects;\n\t}\n\n\t// align an abbreviation for display purposes\n\tprivate orientAbbreviation(abbrevAtom:number, abbrevMol:Molecule):void\n\t{\n\t\tconst {mol} = this;\n\n\t\tif (MolUtil.isBlank(abbrevMol)) return;\n\t\tif (this.mol.atomAdjCount(abbrevAtom) != 1) return;\n\n\t\t// find the vectors, so they can be lined up\n\t\tlet nbr = mol.atomAdjList(abbrevAtom)[0];\n\t\tlet vx1 = mol.atomX(abbrevAtom) - mol.atomX(nbr), vy1 = mol.atomY(abbrevAtom) - mol.atomY(nbr);\n\t\tlet adj = abbrevMol!.atomAdjList(1);\n\t\tlet vx2 = 0, vy2 = 0, inv = invZ(adj.length);\n\t\tfor (let a of adj)\n\t\t{\n\t\t\tvx2 += abbrevMol.atomX(a) - abbrevMol.atomX(1);\n\t\t\tvy2 += abbrevMol.atomY(a) - abbrevMol.atomY(1);\n\t\t}\n\t\tvx2 *= inv;\n\t\tvy2 *= inv;\n\n\t\t// align the coordinates\n\t\tlet th1 = Math.atan2(vy1, vx1), th2 = Math.atan2(vy2, vx2);\n\t\tCoordUtil.rotateMolecule(abbrevMol, th1 - th2);\n\t\tif (adj.length == 1)\n\t\t{\n\t\t\tCoordUtil.translateMolecule(abbrevMol, mol.atomX(abbrevAtom) - abbrevMol.atomX(adj[0]), mol.atomY(abbrevAtom) - abbrevMol.atomY(adj[0]));\n\t\t\tabbrevMol.setAtomPos(1, mol.atomX(nbr), mol.atomY(nbr));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tCoordUtil.translateMolecule(abbrevMol, mol.atomX(nbr) - abbrevMol.atomX(1), mol.atomY(nbr) - abbrevMol.atomY(1));\n\t\t}\n\n\t\tfor (let b of abbrevMol.atomAdjBonds(1))\n\t\t{\n\t\t\tlet a = abbrevMol.bondOther(b, 1);\n\t\t\tif (abbrevMol.atomHExplicit(a) != Molecule.HEXPLICIT_UNKNOWN) continue;\n\t\t\tabbrevMol.setAtomHExplicit(a, Math.max(0, abbrevMol.atomHydrogens(a)));\n\t\t}\n\t\tabbrevMol.deleteAtomAndBonds(1);\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2020 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Molecule} from '../data/Molecule';\nimport {MetaVector} from '../gfx/MetaVector';\nimport {Widget} from '../ui/Widget';\nimport {dom, DOM} from '../util/dom';\nimport {GeomUtil} from '../util/Geom';\nimport {Theme} from '../util/Theme';\nimport {angleDiff, DEGRAD, eventCoords, norm_xy, TWOPI} from '../util/util';\nimport {Vec} from '../util/Vec';\n\n/*\n\tGeometry editing widget to support atom/bond editing dialogs.\n*/\n\nexport enum GeomWidgetType\n{\n\tAtom,\n\tBond,\n}\n\nexport enum GeomWidgetSelType\n{\n\tPosition,\n\tLink,\n\tTorsion,\n}\n\nexport interface GeomWidgetSelection\n{\n\ttype:GeomWidgetSelType;\n\tidx:number;\n}\n\nexport class GeomWidget extends Widget\n{\n\tpublic callbackSelect:(sel:GeomWidgetSelection) => void;\n\tpublic selected:GeomWidgetSelection;\n\n\tprivate atomSubset:number[];\n\tprivate scale:number;\n\tprivate posX:number[] = [];\n\tprivate posY:number[] = [];\n\tprivate posRad:number;\n\tprivate linkA:number[] = [];\n\tprivate linkB:number[] = [];\n\tprivate torsA:number[] = [];\n\tprivate torsB:number[] = [];\n\tprivate hovered:GeomWidgetSelection = null;\n\n\tprivate divDiagram:DOM;\n\n\tconstructor(private type:GeomWidgetType, private mol:Molecule, private idx:number)\n\t{\n\t\tsuper();\n\n\t\tif (type == GeomWidgetType.Atom)\n\t\t{\n\t\t\tconst atom = idx;\n\t\t\tlet adj = mol.atomAdjList(atom);\n\t\t\tthis.atomSubset = [atom, ...adj];\n\t\t\tfor (let b of mol.atomAdjBonds(atom))\n\t\t\t{\n\t\t\t\tthis.linkA.push(0);\n\t\t\t\tthis.linkB.push(this.atomSubset.indexOf(mol.bondOther(b, atom)));\n\t\t\t}\n\t\t\tlet theta:number[] = [];\n\t\t\tfor (let a of adj) theta.push(Math.atan2(-(mol.atomY(a) - mol.atomY(atom)), mol.atomX(a) - mol.atomX(atom)));\n\t\t\tlet order = Vec.idxSort(theta);\n\t\t\tfor (let n = 0; n < order.length; n++)\n\t\t\t{\n\t\t\t\tthis.torsA.push(order[n] + 1);\n\t\t\t\tthis.torsB.push(order[n < order.length - 1 ? n + 1 : 0] + 1);\n\t\t\t}\n\t\t\tthis.selected = {type: GeomWidgetSelType.Position, idx: 0};\n\t\t}\n\t\telse // Bond\n\t\t{\n\t\t\tconst bond = idx;\n\t\t\tlet a1 = mol.bondFrom(bond), a2 = mol.bondTo(bond);\n\t\t\tthis.atomSubset = [...mol.atomAdjList(a1), ...mol.atomAdjList(a2)];\n\t\t\tlet link = (a1:number, a2:number) =>\n\t\t\t{\n\t\t\t\tthis.linkA.push(this.atomSubset.indexOf(a1));\n\t\t\t\tthis.linkB.push(this.atomSubset.indexOf(a2));\n\t\t\t};\n\t\t\tlink(a1, a2);\n\t\t\tfor (let a of mol.atomAdjList(a1)) if (a != a2) link(a1, a);\n\t\t\tfor (let a of mol.atomAdjList(a2)) if (a != a1) link(a2, a);\n\t\t\tthis.selected = {type: GeomWidgetSelType.Link, idx: 0};\n\t\t}\n\t}\n\n\t// create the underlying structure; the parent parameter must be jQuery-compatible\n\tpublic render(parent:any)\n\t{\n\t\tsuper.render(parent);\n\n\t\tlet divOuter = dom('<div/>').appendTo(this.contentDOM).css({'text-align': 'center'});\n\t\tthis.divDiagram = dom('<div/>').appendTo(divOuter).css({'display': 'inline-block'});\n\t\tthis.contentDOM.onClick((event) => this.mouseClick(eventCoords(event, this.divDiagram)));\n\t\tthis.contentDOM.onMouseMove((event) => this.mouseMove(eventCoords(event, this.divDiagram)));\n\n\t\tthis.redraw();\n\t}\n\n\t// return the atom(s) that correspond to certain types\n\tpublic selectionAtoms(sel:GeomWidgetSelection):number[]\n\t{\n\t\tconst atoms = this.atomSubset;\n\t\tif (sel.type == GeomWidgetSelType.Position) return [atoms[sel.idx]];\n\t\tif (sel.type == GeomWidgetSelType.Link) return [atoms[this.linkA[sel.idx]], atoms[this.linkB[sel.idx]]];\n\t\tif (sel.type == GeomWidgetSelType.Torsion) return [atoms[0], atoms[this.torsA[sel.idx]], atoms[this.torsB[sel.idx]]];\n\t\treturn null;\n\t}\n\n\t// ------------ private methods ------------\n\n\tprivate redraw():void\n\t{\n\t\tthis.divDiagram.empty();\n\n\t\tlet w = 250, h = 250; // customise?\n\t\tthis.posX = [];\n\t\tthis.posY = [];\n\t\tconst ANG_RAD = 0.25;\n\t\tfor (let a of this.atomSubset)\n\t\t{\n\t\t\tthis.posX.push(this.mol.atomX(a));\n\t\t\tthis.posY.push(this.mol.atomY(a));\n\t\t}\n\t\tlet loX = Vec.min(this.posX) - ANG_RAD, hiX = Vec.max(this.posX) + ANG_RAD;\n\t\tlet loY = Vec.min(this.posY) - ANG_RAD, hiY = Vec.max(this.posY) + ANG_RAD;\n\t\tthis.scale = Math.min(40, Math.min((w - 4) / (hiX - loX), (h - 4) / (hiY - loY)));\n\t\tlet dx = 0.5 * (w - (hiX - loX) * this.scale), dy = 0.5 * (h - (hiY - loY) * this.scale);\n\t\tfor (let n = 0; n < this.atomSubset.length; n++)\n\t\t{\n\t\t\tthis.posX[n] = dx + (this.posX[n] - loX) * this.scale;\n\t\t\tthis.posY[n] = h - (dy + (this.posY[n] - loY) * this.scale);\n\t\t}\n\t\tthis.posRad = ANG_RAD * this.scale;\n\n\t\tlet gfx = new MetaVector();\n\t\tgfx.setSize(w, h);\n\n\t\tlet fg = Theme.foreground, bg = Theme.background, outerSel = 0x008FD1, innerSel = 0x47D5D2;\n\t\tfor (let n = 0; n < this.atomSubset.length; n++)\n\t\t{\n\t\t\tif (this.hovered && this.hovered.type == GeomWidgetSelType.Position && this.hovered.idx == n)\n\t\t\t\tgfx.drawOval(this.posX[n], this.posY[n], this.posRad, this.posRad, fg, 1, bg);\n\t\t\telse if (this.selected && this.selected.type == GeomWidgetSelType.Position && this.selected.idx == n)\n\t\t\t\tgfx.drawOval(this.posX[n], this.posY[n], this.posRad, this.posRad, outerSel, 1, innerSel);\n\t\t\telse\n\t\t\t\tgfx.drawOval(this.posX[n], this.posY[n], this.posRad, this.posRad, MetaVector.NOCOLOUR, 0, fg);\n\t\t}\n\n\t\tfor (let showsel of [1, 2, 3]) for (let n = 0; n < this.linkA.length; n++)\n\t\t{\n\t\t\tlet x1 = this.posX[this.linkA[n]], y1 = this.posY[this.linkA[n]];\n\t\t\tlet x2 = this.posX[this.linkB[n]], y2 = this.posY[this.linkB[n]];\n\t\t\tif (this.hovered && this.hovered.type == GeomWidgetSelType.Link && this.hovered.idx == n)\n\t\t\t{\n\t\t\t\tif (showsel == 3)\n\t\t\t\t{\n\t\t\t\t\tgfx.drawLine(x1, y1, x2, y2, fg, this.scale * 0.1 + 2);\n\t\t\t\t\tgfx.drawLine(x1, y1, x2, y2, bg, this.scale * 0.1);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.selected && this.selected.type == GeomWidgetSelType.Link && this.selected.idx == n)\n\t\t\t{\n\t\t\t\tif (showsel == 2)\n\t\t\t\t{\n\t\t\t\t\tgfx.drawLine(x1, y1, x2, y2, outerSel, this.scale * 0.1 + 2);\n\t\t\t\t\tgfx.drawLine(x1, y1, x2, y2, innerSel, this.scale * 0.1);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (showsel == 1) gfx.drawLine(x1, y1, x2, y2, fg, this.scale * 0.1);\n\t\t\t}\n\t\t}\n\n\t\tfor (let n = 0; n < this.torsA.length; n++)\n\t\t{\n\t\t\tlet cx = this.posX[0], cy = this.posY[0];\n\t\t\tlet dx1 = 0.5 * (this.posX[this.torsA[n]] - cx), dy1 = 0.5 * (this.posY[this.torsA[n]] - cy);\n\t\t\tlet dx2 = 0.5 * (this.posX[this.torsB[n]] - cx), dy2 = 0.5 * (this.posY[this.torsB[n]] - cy);\n\n\t\t\tlet rad = 0.5 * (norm_xy(dx1, dy1) + norm_xy(dx2, dy2));\n\t\t\tlet theta1 = Math.atan2(dy1, dx1) + 10 * DEGRAD, theta2 = Math.atan2(dy2, dx2) - 10 * DEGRAD, dtheta = angleDiff(theta2, theta1);\n\t\t\tlet ox1 = rad * Math.cos(theta1), oy1 = rad * Math.sin(theta1), ox2 = rad * Math.cos(theta2), oy2 = rad * Math.sin(theta2);\n\n\t\t\tlet px:number[], py:number[], pf:boolean[];\n\t\t\tif (dtheta > 0) // short angle\n\t\t\t{\n\t\t\t\tlet [ax1, ay1, ax2, ay2] = GeomUtil.arcControlPoints(rad, ox1, oy1, ox2, oy2);\n\t\t\t\tpx = Vec.add([ox1, ax1, ax2, ox2], cx);\n\t\t\t\tpy = Vec.add([oy1, ay1, ay2, oy2], cy);\n\t\t\t\tpf = [false, true, true, false];\n\t\t\t}\n\t\t\telse // long angle, need to do in two parts\n\t\t\t{\n\t\t\t\tlet thetaM = theta1 + 0.5 * (dtheta + TWOPI);\n\t\t\t\tlet oxM = rad * Math.cos(thetaM), oyM = rad * Math.sin(thetaM);\n\n\t\t\t\tlet [ax1, ay1, ax2, ay2] = GeomUtil.arcControlPoints(rad, ox1, oy1, oxM, oyM);\n\t\t\t\tlet [ax3, ay3, ax4, ay4] = GeomUtil.arcControlPoints(rad, oxM, oyM, ox2, oy2);\n\t\t\t\tpx = Vec.add([ox1, ax1, ax2, oxM, ax3, ax4, ox2], cx);\n\t\t\t\tpy = Vec.add([oy1, ay1, ay2, oyM, ay3, ay4, oy2], cy);\n\t\t\t\tpf = [false, true, true, false, true, true, false];\n\t\t\t}\n\n\t\t\tif (this.hovered && this.hovered.type == GeomWidgetSelType.Torsion && this.hovered.idx == n)\n\t\t\t{\n\t\t\t\tgfx.drawPath(px, py, pf, false, fg, this.scale * 0.1 + 2, MetaVector.NOCOLOUR, false);\n\t\t\t\tgfx.drawPath(px, py, pf, false, bg, this.scale * 0.1, MetaVector.NOCOLOUR, false);\n\t\t\t}\n\t\t\telse if (this.selected && this.selected.type == GeomWidgetSelType.Torsion && this.selected.idx == n)\n\t\t\t{\n\t\t\t\tgfx.drawPath(px, py, pf, false, outerSel, this.scale * 0.1 + 2, MetaVector.NOCOLOUR, false);\n\t\t\t\tgfx.drawPath(px, py, pf, false, innerSel, this.scale * 0.1, MetaVector.NOCOLOUR, false);\n\t\t\t}\n\t\t\telse gfx.drawPath(px, py, pf, false, fg, this.scale * 0.1, MetaVector.NOCOLOUR, false);\n\t\t}\n\n\t\tthis.divDiagram.empty();\n\t\tlet svg = dom(gfx.createSVG()).appendTo(this.divDiagram).css({'pointer-events': 'none'});\n\t}\n\n\tprivate mouseClick(xy:number[]):void\n\t{\n\t\tevent.stopPropagation();\n\t\tif (this.type == GeomWidgetType.Bond) return; // no selection for bonds (for now)\n\n\t\tlet which = this.whichSelection(xy[0], xy[1]);\n\t\tif (!which) return; // don't want clearing of selection (for now)\n\t\tif (!this.sameSelection(this.selected, which))\n\t\t{\n\t\t\tthis.selected = which;\n\t\t\tthis.hovered = null;\n\t\t\tthis.redraw();\n\t\t\tthis.callbackSelect(which);\n\t\t}\n\t}\n\tprivate mouseMove(xy:number[]):void\n\t{\n\t\tif (this.type == GeomWidgetType.Bond) return; // no selection for bonds (for now)\n\n\t\tlet which = this.whichSelection(xy[0], xy[1]);\n\t\tif (which && this.sameSelection(which, this.selected)) which = null;\n\t\tif (!this.sameSelection(this.hovered, which))\n\t\t{\n\t\t\tthis.hovered = which;\n\t\t\tthis.redraw();\n\t\t}\n\t}\n\n\tprivate whichSelection(x:number, y:number):GeomWidgetSelection\n\t{\n\t\tlet cx = this.posX[0], cy = this.posY[0];\n\t\tif (norm_xy(x - cx, y - cy) <= this.posRad) return {type: GeomWidgetSelType.Position, idx: 0};\n\t\tlet maxRad = 0;\n\t\tfor (let n = 1; n < this.atomSubset.length; n++) maxRad = Math.max(maxRad, norm_xy(this.posX[n] - cx, this.posY[n] - cy) + this.posRad);\n\t\tif (norm_xy(x - cx, y - cy) > maxRad) return null;\n\n\t\tlet theta = Math.atan2(y - cy, x - cx);\n\t\tlet closeSel:GeomWidgetSelection = null, closeDelta = Number.POSITIVE_INFINITY;\n\n\t\tfor (let n = 0; n < this.linkB.length; n++)\n\t\t{\n\t\t\tlet delta = Math.abs(angleDiff(Math.atan2(this.posY[this.linkB[n]] - cy, this.posX[this.linkB[n]] - cx), theta));\n\t\t\tif (delta < 10 * DEGRAD && delta < closeDelta)\n\t\t\t{\n\t\t\t\tcloseSel = {type: GeomWidgetSelType.Link, idx: n};\n\t\t\t\tcloseDelta = delta;\n\t\t\t}\n\t\t}\n\n\t\tfor (let n = 0; n < this.torsA.length; n++)\n\t\t{\n\t\t\tlet theta1 = Math.atan2(this.posY[this.torsA[n]] - cy, this.posX[this.torsA[n]] - cx);\n\t\t\tlet theta2 = Math.atan2(this.posY[this.torsB[n]] - cy, this.posX[this.torsB[n]] - cx);\n\t\t\tlet midtheta = theta1 + 0.5 * (angleDiff(theta2, theta1));\n\t\t\tlet delta = Math.abs(angleDiff(midtheta, theta));\n\t\t\tif (delta < closeDelta)\n\t\t\t{\n\t\t\t\tcloseSel = {type: GeomWidgetSelType.Torsion, idx: n};\n\t\t\t\tcloseDelta = delta;\n\t\t\t}\n\t\t}\n\n\t\treturn closeSel;\n\t}\n\n\t// returns true if selections are the same\n\tprivate sameSelection(sel1:GeomWidgetSelection, sel2:GeomWidgetSelection):boolean\n\t{\n\t\tif (sel1 == null && sel2 == null) return true;\n\t\tif (sel1 == null || sel2 == null) return false;\n\t\treturn sel1.type == sel2.type && sel1.idx == sel2.idx;\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Vec} from '../util/Vec';\n\n/*\n\tClipboardProxy: abstract base class for two different methods for clipboard access. One is the usual web page method,\n\twhich has serious limitations due to security concerns (i.e. a web page can't just grab the clipboard any time it wants).\n\tThe other is the NodeJS/Electron implementation which has full access any time it wants.\n\n*/\n\n// default clipboard behaviour: override these methods to intercept incoming copy/cut/paste requests; this default implementation\n// hands over the reins to the system, which is normal behaviour\nexport class ClipboardProxyHandler\n{\n\t// note: return values = true if the event got consumed by privately implemented functionality; false = fall back to the default\n\tpublic copyEvent(andCut:boolean, proxy:ClipboardProxy):boolean {return false;}\n\tpublic pasteEvent(proxy:ClipboardProxy):boolean {return false;}\n}\n\nexport class ClipboardProxy\n{\n\tprotected handlers = [new ClipboardProxyHandler()]; // baseline fallback is the default pass-through implementation\n\n\t// ------------ public methods ------------\n\n\t// use these two functions whenever a new focus-stealing object pops up on top of everything else, e.g. dialogs or dialog-like specialised\n\t// editing tools with complex clipboard behaviour\n\tpublic pushHandler(handler:ClipboardProxyHandler)\n\t{\n\t\tthis.handlers.push(handler);\n\t}\n\tpublic popHandler()\n\t{\n\t\tthis.handlers.pop();\n\t}\n\tpublic currentHandler():ClipboardProxyHandler\n\t{\n\t\treturn Vec.last(this.handlers);\n\t}\n\n\t// call these methods when an external event (e.g. menu/button) triggers a cut/copy/paste event\n\tpublic triggerCopy(andCut:boolean):void\n\t{\n\t\tif (this.currentHandler().copyEvent(andCut, this)) return;\n\t\tdocument.execCommand(andCut ? 'cut' : 'copy');\n\t}\n\tpublic triggerPaste():void\n\t{\n\t\tif (this.currentHandler().pasteEvent(this)) return;\n\t\tdocument.execCommand('paste');\n\t}\n\n\t// fetches the content currently on the clipboard; note that for the web implementation, this is disallowed for\n\t// security reasons, but in desktop mode it is allowed (see canAlwaysGet below)\n\tpublic getString():string {return null;}\n\n\t// places the clipboard content with the indicated string; this is allowed at any time\n\tpublic setString(str:string):void {}\n\tpublic setImage(blob:Blob):void {}\n\n\t// places HTML content onto the clipboard, if available\n\tpublic canSetHTML():boolean {return false;}\n\tpublic setHTML(html:string):void {}\n\n\t// returns true if it is possible to fetch from the clipboard anytime (false when running in a web browser)\n\tpublic canAlwaysGet():boolean {return false;}\n\n\t// instantiate the downloading of a string, with a given default filename\n\tpublic downloadString(str:string, fn:string):void {}\n}\n\n/*\n\tClipboard handler that should be used when the browser is the runtime target, which presents a much more restricted clipboard\n\tuse pattern (for security reasons). The action-trapping actions are installed once for the whole documented, and from that point\n\tthey can either be trapped or allowed to fall back to the default action.\n*/\n\nexport class ClipboardProxyWeb extends ClipboardProxy\n{\n\tprivate lastContent:string = null;\n\tprivate fakeTextArea:HTMLTextAreaElement = null; // for temporarily bogarting the clipboard\n\tprivate busy = false; // need to block trapping during the copy workaround\n\n\t// ------------ public methods ------------\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tdocument.addEventListener('copy', (event:ClipboardEvent) =>\n\t\t{\n\t\t\tif (this.busy) return null;\n\t\t\tif (this.currentHandler()?.copyEvent(false, this))\n\t\t\t{\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t\tdocument.addEventListener('cut', (event:ClipboardEvent) =>\n\t\t{\n\t\t\tif (this.busy) return null;\n\t\t\tif (this.currentHandler()?.copyEvent(true, this))\n\t\t\t{\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t\tdocument.addEventListener('paste', (event:ClipboardEvent) =>\n\t\t{\n\t\t\t// this is the only time when the clipboard is allowed to be interrogated, so stash the content so the handler can access it\n\t\t\tlet wnd = window as any;\n\t\t\tthis.lastContent = null;\n\t\t\tif (wnd.clipboardData && wnd.clipboardData.getData) this.lastContent = wnd.clipboardData.getData('Text');\n\t\t\telse if (event.clipboardData && event.clipboardData.getData) this.lastContent = event.clipboardData.getData('text/plain');\n\n\t\t\tlet consumed = this.currentHandler()?.pasteEvent(this);\n\n\t\t\tthis.lastContent = null;\n\n\t\t\tif (consumed)\n\t\t\t{\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\t}\n\n\tpublic getString():string\n\t{\n\t\treturn this.lastContent;\n\t}\n\tpublic setString(str:string):void\n\t{\n\t\t// the default method for putting text on the clipboard involves making a fake hidden control, which is real\n\t\t// nasty: if the cleaner approach works, defer to that in preference\n\t\tlet fallbackWorkaround = () =>\n\t\t{\n\t\t\tif (this.fakeTextArea == null)\n\t\t\t{\n\t\t\t\tthis.fakeTextArea = document.createElement('textarea');\n\t\t\t\tthis.fakeTextArea.style.fontSize = '12pt';\n\t\t\t\tthis.fakeTextArea.style.border = '0';\n\t\t\t\tthis.fakeTextArea.style.padding = '0';\n\t\t\t\tthis.fakeTextArea.style.margin = '0';\n\t\t\t\tthis.fakeTextArea.style.position = 'fixed';\n\t\t\t\tthis.fakeTextArea.style['left'] = '-9999px';\n\t\t\t\tthis.fakeTextArea.style.top = (window.pageYOffset || document.documentElement.scrollTop) + 'px';\n\t\t\t\tthis.fakeTextArea.setAttribute('readonly', '');\n\t\t\t\tdocument.body.appendChild(this.fakeTextArea);\n\t\t\t}\n\t\t\tthis.fakeTextArea.value = str;\n\t\t\tthis.fakeTextArea.select();\n\n\t\t\t// disable event trapping, then issue the standard copy\n\t\t\tthis.busy = true;\n\t\t\tdocument.execCommand('copy');\n\t\t\tthis.busy = false;\n\t\t};\n\n\t\t// favour the explicit clipboard API, if allowed\n\t\tif (navigator.clipboard)\n\t\t{\n\t\t\tnavigator.clipboard.writeText(str).then(() => {}, fallbackWorkaround);\n\t\t}\n\t\telse fallbackWorkaround();\n\t}\n\tpublic setImage(blob:Blob):void\n\t{\n\t\tlet item = new ClipboardItem({'image/png': blob});\n\t\tthis.busy = true;\n\t\t(async () =>\n\t\t{\n\t\t\tawait navigator.clipboard.write([item]);\n\t\t\tthis.busy = false;\n\t\t})();\n\t}\n\n\t// ------------ private methods ------------\n\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {dom, DOM} from '../util/dom';\nimport {hasInlineCSS, installInlineCSS, Theme} from '../util/Theme';\nimport {colourCode} from '../util/util';\nimport {Widget} from './Widget';\n\n/*\n\tOptionList: a replacement for the ghetto native HTML radio buttons. Can be used in either horizontal or vertical mode. Rendering\n\tstyle looks like several custom buttons that are joined together, and the current one is highlighted and unclickable. For\n\tvertical mode, slots are reserved so that text can be added to the right each option.\n\n\tNote that there is always one index selected. It is\n\n\tContent:\n\t\t.options: array of strings for use as labels\n\t\t.isVertical: boolean (default: false)\n\t\t.selidx: selected option (0 .. options.length-1)\n\t\t.buttonDiv1, .buttonDiv2: arrays of DOM elements, one for each option\n\t\t.auxCell: vertical only; a list of <td> DOM elements for optional associated content\n*/\n\nexport class OptionList extends Widget\n{\n\tpublic padding = 6; // pixels\n\tpublic htmlLabels = false; // switch this on if the labels are HTML rather than text\n\tpublic numCols = 0; // optional: if 0, everything is on one line\n\n\tprivate selidx = 0;\n\tprivate buttonDiv:DOM[] = [];\n\tprivate auxCell:DOM[] = [];\n\n\tpublic callbackSelect:(idx:number, source?:OptionList) => void = null;\n\n\tconstructor(public options:string[], private isVertical:boolean = false)\n\t{\n\t\tsuper();\n\t\tif (options.length == 0) throw 'molsync.ui.OptionList: must provide a list of option labels.';\n\n\t\tif (!hasInlineCSS('option')) installInlineCSS('option', this.composeCSS());\n\t}\n\n\t// control over selected index\n\tpublic getSelectedIndex():number\n\t{\n\t\treturn this.selidx;\n\t}\n\tpublic getSelectedValue():string\n\t{\n\t\treturn this.options[this.selidx];\n\t}\n\n\t// requests an \"auxiliary cell\" for a vertical control, into which additional information may be placed\n\tpublic getAuxiliaryCell(idx:number):Element\n\t{\n\t\treturn this.auxCell[idx].el;\n\t}\n\n\t// provide the change of state handler\n\tpublic onSelect(callback:(idx:number, source?:OptionList) => void):void\n\t{\n\t\tthis.callbackSelect = callback;\n\t}\n\n\t// create the underlying structure; the parent parameter must be jQuery-compatible\n\tpublic render(parent:any):void\n\t{\n\t\tsuper.render(parent);\n\n\t\tthis.contentDOM.css({'display': 'block', 'baseline-shift': '1.5em'});\n\n\t\tthis.buttonDiv = [];\n\t\tthis.auxCell = [];\n\n\t\tlet table = dom('<table class=\"wmk-option-table\"/>').appendTo(this.contentDOM);\n\t\tlet tr = this.isVertical ? null : dom('<tr/>').appendTo(table);\n\n\t\tfor (let n = 0; n < this.options.length; n++)\n\t\t{\n\t\t\tif (this.isVertical || (this.numCols > 0 && n > 0 && n % this.numCols == 0)) tr = dom('<tr/>').appendTo(table);\n\t\t\tlet td = dom('<td class=\"wmk-option-cell\"/>').appendTo(tr);\n\t\t\tlet div = dom('<div class=\"wmk-option\"/>').appendTo(td);\n\t\t\tdiv.css({'padding': `${this.padding}px`});\n\t\t\tdiv.onClick(() => this.clickButton(n));\n\n\t\t\tthis.buttonDiv.push(div);\n\n\t\t\tif (this.isVertical)\n\t\t\t{\n\t\t\t\ttd = dom('<td style=\"vertical-align: middle;\"/>').appendTo(tr);\n\t\t\t\tthis.auxCell.push(td);\n\t\t\t}\n\t\t}\n\n\t\tthis.updateButtons();\n\t}\n\n\t// perform some checks before rendering\n\tpublic clickButton(idx:number):void\n\t{\n\t\tif (idx == this.selidx) return;\n\n\t\tthis.setSelectedIndex(idx);\n\n\t\tif (this.callbackSelect) this.callbackSelect(idx, this);\n\t}\n\n\t// change selected index, update widgets\n\tpublic setSelectedIndex(idx:number):void\n\t{\n\t\tif (this.selidx == idx) return;\n\t\tthis.selidx = idx;\n\t\tthis.updateButtons();\n\t}\n\tpublic setSelectedValue(val:string):void\n\t{\n\t\tlet idx = this.options.indexOf(val);\n\t\tif (idx >= 0) this.setSelectedIndex(idx);\n\t}\n\n\t// ------------ private methods ------------\n\n\t// updates selection state of buttons, either first time or after change\n\tprivate updateButtons():void\n\t{\n\t\tfor (let n = 0; n < this.options.length && n < this.buttonDiv.length; n++)\n\t\t{\n\t\t\tlet div = this.buttonDiv[n];\n\n\t\t\tlet txt = this.options[n];\n\t\t\tif (txt.length == 0 && n == this.selidx) div.setText('\\u00A0\\u2716\\u00A0');\n\t\t\telse if (txt.length == 0) div.setText('\\u00A0\\u00A0\\u00A0');\n\t\t\telse if (this.htmlLabels) div.setHTML(txt);\n\t\t\telse div.setText(txt);\n\n\t\t\tdiv.removeClass('wmk-option-unselected wmk-option-selected');\n\n\t\t\tif (n != this.selidx)\n\t\t\t\tdiv.addClass('wmk-option-unselected');\n\t\t\telse\n\t\t\t\tdiv.addClass('wmk-option-selected');\n\t\t}\n\t}\n\n\t// one-time instantiation of necessary styles\n\tprivate composeCSS():string\n\t{\n\t\tlet lowlight = colourCode(Theme.lowlight), lowlightEdge1 = colourCode(Theme.lowlightEdge1), lowlightEdge2 = colourCode(Theme.lowlightEdge2);\n\t\tlet highlight = colourCode(Theme.highlight), highlightEdge1 = colourCode(Theme.highlightEdge1), highlightEdge2 = colourCode(Theme.highlightEdge2);\n\n\t\treturn `\n\t\t\t.wmk-option\n\t\t\t{\n\t\t\t\tmargin-bottom: 0;\n\t\t\t\tfont-family: 'Open Sans', sans-serif;\n\t\t\t\tfont-size: 14px;\n\t\t\t\tfont-weight: normal;\n\t\t\t\ttext-align: center;\n\t\t\t\twhite-space: nowrap;\n\t\t\t\tline-height: 1.2em;\n\t\t\t\tcursor: pointer;\n\t\t\t}\n\t\t\t.wmk-option-selected\n\t\t\t{\n\t\t\t\tcolor: white;\n\t\t\t\tbackground-color: #008FD2;\n\t\t\t\tbackground-image: linear-gradient(to right bottom, ${lowlightEdge1}, ${lowlightEdge2});\n\t\t\t}\n\t\t\t.wmk-option-unselected\n\t\t\t{\n\t\t\t\tcolor: #333;\n\t\t\t\tbackground-color: white;\n\t\t\t\tbackground-image: linear-gradient(to right bottom, #FFFFFF, #E0E0E0);\n\t\t\t}\n\t\t\t.wmk-option-unselected:hover\n\t\t\t{\n\t\t\t\tbackground-color: #808080;\n\t\t\t\tbackground-image: linear-gradient(to right bottom, #F0F0F0, #D0D0D0);\n\t\t\t}\n\t\t\t.wmk-option-unselected:active\n\t\t\t{\n\t\t\t\tcolor: white;\n\t\t\t\tbackground-color: #00C000;\n\t\t\t\tbackground-image: linear-gradient(to right bottom, ${highlightEdge1}, ${highlightEdge2});\n\t\t\t}\n\t\t\t.wmk-option-table\n\t\t\t{\n\t\t\t\tmargin: 1px;\n\t\t\t\tpadding: 0;\n\t\t\t\tborder-width: 0;\n\t\t\t\tborder-collapse: collapse;\n\t\t\t}\n\t\t\t.wmk-option-cell\n\t\t\t{\n\t\t\t\tmargin: 0;\n\t\t\t\tpadding: 0;\n\t\t\t\tborder-width: 0;\n\t\t\t\tborder-width: 1px;\n\t\t\t\tborder-style: solid;\n\t\t\t\tborder-color: #808080;\n\t\t\t}\n\t\t`;\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2020 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {dom, DOM} from '../util/dom';\nimport {hasInlineCSS, installInlineCSS, Theme} from '../util/Theme';\nimport {colourCode} from '../util/util';\nimport {Widget} from './Widget';\n\n/*\n\tTabBar: a series of option buttons with a common area underneath it, of which just one can be selected & visible.\n*/\n\nexport class TabBar extends Widget\n{\n\tpublic unionHeight = false; // if true, height of tab bar will be set to the maximum of all components\n\n\tprivate selidx = 0;\n\tprivate buttonDiv:DOM[] = [];\n\tprivate panelDiv:DOM[] = [];\n\tprivate padding = 6; // pixels\n\n\tpublic callbackSelect:(idx:number, source?:TabBar) => void = null;\n\n\t// ------------ public methods ------------\n\n\tconstructor(public options:string[])\n\t{\n\t\tsuper();\n\n\t\tif (!hasInlineCSS('tabbar')) installInlineCSS('tabbar', this.composeCSS());\n\t}\n\n\tpublic onSelect(callback:(idx:number, source?:TabBar) => void):void\n\t{\n\t\tthis.callbackSelect = callback;\n\t}\n\n\t// control over selected index\n\tpublic getSelectedIndex():number\n\t{\n\t\treturn this.selidx;\n\t}\n\tpublic getSelectedValue():string\n\t{\n\t\treturn this.options[this.selidx];\n\t}\n\n\t// return the panel: each of these needs to be individually filled\n\tpublic getPanelDOM(idxOrName:number | string):DOM\n\t{\n\t\tlet idx = typeof idxOrName == 'number' ? idxOrName as number : this.options.indexOf(idxOrName);\n\t\tif (idx < 0) return null;\n\t\treturn this.panelDiv[idx];\n\t}\n\n\t// create the underlying structure; the parent parameter must be jQuery-compatible\n\tpublic render(parent:any):void\n\t{\n\t\tsuper.render(parent);\n\n\t\tlet grid = dom('<div/>').appendTo(this.contentDOM).css({'display': 'grid'});\n\t\tgrid.css({'align-items': 'center', 'justify-content': 'start', 'grid-row-gap': '0.5em'});\n\t\tlet columns = '[start] 1fr ';\n\t\tfor (let n = 0; n < this.options.length; n++) columns += '[btn' + n + '] auto ';\n\t\tcolumns += '[btnX] 1fr [end]';\n\t\tgrid.css({'grid-template-columns': columns});\n\n\t\tlet underline = dom('<div/>').appendTo(grid);\n\t\tunderline.css({'grid-column': 'start / end', 'grid-row': '1', 'height': '100%'});\n\t\tunderline.css({'border-bottom': '1px solid #C0C0C0'});\n\n\t\tfor (let n = 0; n < this.options.length; n++)\n\t\t{\n\t\t\tlet outline = dom('<div class=\"wmk-tabbar-cell\"/>').appendTo(grid);\n\t\t\toutline.css({'grid-column': 'btn' + n, 'grid-row': '1'});\n\t\t\tlet btn = dom('<div class=\"wmk-tabbar\"/>').appendTo(outline);\n\t\t\tbtn.css({'padding': `${this.padding}px`});\n\t\t\tbtn.onClick(() => this.clickButton(n));\n\t\t\tthis.buttonDiv.push(btn);\n\n\t\t\tlet panel = dom('<div/>').appendTo(grid);\n\t\t\tpanel.css({'grid-column': 'start / end', 'grid-row': '2'});\n\t\t\tpanel.css({'align-self': 'start', 'justify-self': 'center', 'width': '100%'});\n\t\t\tthis.panelDiv.push(panel);\n\t\t}\n\n\t\tthis.updateButtons();\n\t}\n\n\t// tab-button clicked, so change content\n\tpublic clickButton(idx:number):void\n\t{\n\t\tif (idx == this.selidx) return;\n\n\t\tthis.setSelectedIndex(idx);\n\n\t\tif (this.callbackSelect) this.callbackSelect(idx, this);\n\t}\n\n\t// change selected index, update widgets\n\tpublic setSelectedIndex(idx:number):void\n\t{\n\t\tif (this.selidx == idx) return;\n\t\tthis.selidx = idx;\n\n\t\tlet dom = this.contentDOM;\n\t\tdom.setCSS('min-width', `${dom.width()}px`);\n\t\t\n\t\tthis.updateButtons();\n\t}\n\tpublic setSelectedValue(val:string):void\n\t{\n\t\tlet idx = this.options.indexOf(val);\n\t\tif (idx >= 0) this.setSelectedIndex(idx);\n\t}\n\tpublic rotateSelected(dir:number):void\n\t{\n\t\tthis.setSelectedIndex((this.selidx + dir + this.options.length) % this.options.length);\n\t}\n\n\t// ------------ private methods ------------\n\n\t// updates selection state of buttons, either first time or after change\n\tprivate updateButtons():void\n\t{\n\t\tfor (let n = 0; n < this.options.length && n < this.buttonDiv.length; n++)\n\t\t{\n\t\t\tlet div = this.buttonDiv[n];\n\n\t\t\tlet txt = this.options[n];\n\t\t\tif (txt.length == 0 && n == this.selidx) div.setText('\\u00A0\\u2716\\u00A0');\n\t\t\telse if (txt.length == 0) div.setText('\\u00A0\\u00A0\\u00A0');\n\t\t\telse div.setText(txt);\n\n\t\t\tdiv.removeClass('wmk-tabbar-unselected wmk-tabbar-selected');\n\n\t\t\tif (n != this.selidx)\n\t\t\t\tdiv.addClass('wmk-tabbar-unselected');\n\t\t\telse\n\t\t\t\tdiv.addClass('wmk-tabbar-selected');\n\n\t\t\tif (this.unionHeight)\n\t\t\t\tthis.panelDiv[n].setCSS('visibility', n == this.selidx ? 'visible' : 'hidden');\n\t\t\telse\n\t\t\t\tthis.panelDiv[n].setCSS('display', n == this.selidx ? 'block' : 'none');\n\t\t}\n\t}\n\n\t// one-time instantiation of necessary styles\n\tprivate composeCSS():string\n\t{\n\t\tlet lowlight = colourCode(Theme.lowlight), lowlightEdge1 = colourCode(Theme.lowlightEdge1), lowlightEdge2 = colourCode(Theme.lowlightEdge2);\n\t\tlet highlight = colourCode(Theme.highlight), highlightEdge1 = colourCode(Theme.highlightEdge1), highlightEdge2 = colourCode(Theme.highlightEdge2);\n\n\t\treturn `\n\t\t\t.wmk-tabbar\n\t\t\t{\n\t\t\t\tmargin-bottom: 0;\n\t\t\t\tfont-family: 'Open Sans', sans-serif;\n\t\t\t\tfont-size: 14px;\n\t\t\t\tfont-weight: normal;\n\t\t\t\ttext-align: center;\n\t\t\t\twhite-space: nowrap;\n\t\t\t\tvertical-align: middle;\n\t\t\t\tcursor: pointer;\n\t\t\t}\n\t\t\t.wmk-tabbar-selected\n\t\t\t{\n\t\t\t\tcolor: white;\n\t\t\t\tbackground-color: #008FD2;\n\t\t\t\tbackground-image: linear-gradient(to right bottom, ${lowlightEdge1}, ${lowlightEdge2});\n\t\t\t}\n\t\t\t.wmk-tabbar-unselected\n\t\t\t{\n\t\t\t\tcolor: #333;\n\t\t\t\tbackground-color: white;\n\t\t\t\tbackground-image: linear-gradient(to right bottom, #FFFFFF, #E0E0E0);\n\t\t\t}\n\t\t\t.wmk-tabbar-unselected:hover\n\t\t\t{\n\t\t\t\tbackground-color: #808080;\n\t\t\t\tbackground-image: linear-gradient(to right bottom, #F0F0F0, #D0D0D0);\n\t\t\t}\n\t\t\t.wmk-tabbar-unselected:active\n\t\t\t{\n\t\t\t\tcolor: white;\n\t\t\t\tbackground-color: #00C000;\n\t\t\t\tbackground-image: linear-gradient(to right bottom, ${highlightEdge1}, ${highlightEdge2});\n\t\t\t}\n\t\t\t.wmk-tabbar-table\n\t\t\t{\n\t\t\t\tmargin: 1px;\n\t\t\t\tpadding: 0;\n\t\t\t\tborder-width: 0;\n\t\t\t\tborder-collapse: collapse;\n\t\t\t}\n\t\t\t.wmk-tabbar-cell\n\t\t\t{\n\t\t\t\tmargin: 0 -1px -1px 0;\n\t\t\t\tpadding: 0;\n\t\t\t\tborder-width: 0;\n\t\t\t\tborder-width: 1px;\n\t\t\t\tborder-style: solid;\n\t\t\t\tborder-color: #808080;\n\t\t\t}\n\t\t`;\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2020 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Molecule} from '../data/Molecule';\nimport {Widget} from '../ui/Widget';\nimport {dom, DOM} from '../util/dom';\n\n/*\n\tSupporting widget for editing extra/transient fields, from either atoms or bonds.\n*/\n\nexport class ExtraFieldsWidget extends Widget\n{\n\tprivate divFields:DOM;\n\n\tconstructor(private fields:string[])\n\t{\n\t\tsuper();\n\t}\n\n\t// create the underlying structure; the parent parameter must be jQuery-compatible\n\tpublic render(parent:any)\n\t{\n\t\tsuper.render(parent);\n\n\t\tthis.divFields = dom('<div/>').appendTo(this.contentDOM);\n\t\tthis.fillTable();\n\n\t\tlet divButtons = dom('<div/>').appendTo(this.contentDOM).css({'text-align': 'center'});\n\t\tlet btnExtra = dom('<button class=\"wmk-button wmk-button-default\">Extra</button>').appendTo(divButtons);\n\t\tbtnExtra.onClick(() =>\n\t\t{\n\t\t\tthis.fields.push(Molecule.PREFIX_EXTRA);\n\t\t\tthis.fillTable();\n\t\t});\n\t\t//divButtons.append(' ');\n\t\tlet btnTransient = dom('<button class=\"wmk-button wmk-button-default\">Transient</button>').appendTo(divButtons).css({'margin-left': '0.5em'});\n\t\tbtnTransient.onClick(() =>\n\t\t{\n\t\t\tthis.fields.push(Molecule.PREFIX_TRANSIENT);\n\t\t\tthis.fillTable();\n\t\t});\n\t}\n\n\tpublic getExtraFields():string[]\n\t{\n\t\tlet extra:string[] = [];\n\t\tfor (let field of this.fields) if (!field.startsWith(Molecule.PREFIX_TRANSIENT) && field.length > 1) extra.push(field);\n\t\treturn extra;\n\t}\n\n\tpublic getTransientFields():string[]\n\t{\n\t\tlet transient:string[] = [];\n\t\tfor (let field of this.fields) if (field.startsWith(Molecule.PREFIX_TRANSIENT) && field.length > 1) transient.push(field);\n\t\treturn transient;\n\t}\n\n\t// ------------ private methods ------------\n\n\tprivate fillTable():void\n\t{\n\t\tthis.divFields.empty();\n\t\tif (this.fields.length == 0) return;\n\n\t\tlet table = dom('<table/>').appendTo(this.divFields).css({'width': '100%'});\n\t\tlet tr = dom('<tr/>').appendTo(table);\n\t\tdom('<td/>').appendTo(tr).css({'text-align': 'right', 'font-weight': 'bold', 'text-decoration': 'underline'}).setText('Type');\n\t\tdom('<td/>').appendTo(tr).css({'font-weight': 'bold', 'text-decoration': 'underline'}).setText('Value');\n\n\t\tfor (let n = 0; n < this.fields.length; n++)\n\t\t{\n\t\t\tlet strType = '?', strValue = '';\n\t\t\tif (this.fields[n].length > 0)\n\t\t\t{\n\t\t\t\tstrType = this.fields[n].charAt(0);\n\t\t\t\tstrValue = this.fields[n].substring(1);\n\t\t\t}\n\n\t\t\ttr = dom('<tr/>').appendTo(table);\n\t\t\tlet tdType = dom('<td/>').appendTo(tr).css({'text-align': 'right'}), tdValue = dom('<td/>').appendTo(tr), tdButton = dom('<td/>').appendTo(tr);\n\n\t\t\tdom('<span/>').appendTo(tdType).css({'padding': '0.2em', 'border': '1px solid black', 'background-color': '#C0C0C0'}).setText(strType);\n\n\t\t\tlet input = dom('<input size=\"20\"/>').appendTo(tdValue).css({'width': '100%', 'font': 'inherit'});\n\t\t\tinput.setValue(strValue);\n\t\t\tinput.onInput(() => {this.fields[n] = strType + input.getValue();});\n\n\t\t\tlet btnDelete = dom('<button class=\"wmk-button wmk-button-small wmk-button-default\">\\u{2716}</button>').appendTo(tdButton).css({'margin-left': '0.5em'});\n\t\t\tbtnDelete.onClick(() =>\n\t\t\t{\n\t\t\t\tthis.fields.splice(n, 1);\n\t\t\t\tthis.fillTable();\n\t\t\t});\n\t\t}\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2020 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Chemistry} from '../data/Chemistry';\nimport {Widget} from '../ui/Widget';\nimport {dom, DOM} from '../util/dom';\nimport {installInlineCSS} from '../util/Theme';\n\n/*\n\tInteractive periodic table for picking elements.\n*/\n\n/* eslint-disable no-multi-spaces, comma-spacing */\nconst POSITION_TABLE_Y =\n[\n\t1,                                1,\n\t2,2,                    2,2,2,2,2,2,\n\t3,3,                    3,3,3,3,3,3,\n\t4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,\n\t5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,\n\t6,6,\n\t\t\t\t\t\t\t\t8.5,8.5,8.5,8.5,8.5,8.5,8.5,8.5,8.5,8.5,8.5,8.5,8.5,8.5,\n\t\t6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,\n\t7,7,\n\t\t\t\t\t\t\t\t9.5,9.5,9.5,9.5,9.5,9.5,9.5,9.5,9.5,9.5,9.5,9.5,9.5,9.5,\n\t\t7,7,7,7,7,7,7,7,7,7\n];\nconst POSITION_TABLE_X =\n[\n\t1,                                        18,\n\t1,2,                       13,14,15,16,17,18,\n\t1,2,                       13,14,15,16,17,18,\n\t1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,\n\t1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,\n\t1,2,\n\t\t\t\t\t\t\t\t3.5,4.5,5.5,6.5,7.5,8.5,9.5,10.5,11.5,12.5,13.5,14.5,15.5,16.5,\n\t\t3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,\n\t1,2,\n\t\t\t\t\t\t\t\t3.5,4.5,5.5,6.5,7.5,8.5,9.5,10.5,11.5,12.5,13.5,14.5,15.5,16.5,\n\t\t3,4,5,6,7,8,9,10,11,12\n];\n\nconst CSS_PERIODICTABLE = `\n\t*.wmk-periodictable-element\n\t{\n\t\tborder: 1px solid black;\n\t\tborder-radius: 2px;\n\t\tmargin: 0;\n\t\tmin-width: 2em;\n\t\tpadding: 0.4em 0 0.3em 0;\n\t\ttext-align: center;\n\t\tcolor: #FFFFFF;\n\t\tcursor: pointer;\n\t}\n\t*.wmk-periodictable-block1\n\t{\n\t\tbackground-color: #313062;\n\t}\n\t*.wmk-periodictable-block1:hover\n\t{\n\t\tbackground-color: #414072;\n\t}\n\t*.wmk-periodictable-block2\n\t{\n\t\tbackground-color: #205224;\n\t}\n\t*.wmk-periodictable-block2:hover\n\t{\n\t\tbackground-color: #306234;\n\t}\n\t*.wmk-periodictable-block3\n\t{\n\t\tbackground-color: #522818;\n\t}\n\t*.wmk-periodictable-block3:hover\n\t{\n\t\tbackground-color: #623828;\n\t}\n\t*.wmk-periodictable-block4\n\t{\n\t\tbackground-color: #575212;\n\t}\n\t*.wmk-periodictable-block4:block\n\t{\n\t\tbackground-color: #676222;\n\t}\n\t*.wmk-periodictable-selected\n\t{\n\t\tbackground-color: #FFFFFF !important;\n\t\tcolor: #000000 !important;\n\t\tcursor: default;\n\t}\n`;\n\nexport class PeriodicTableWidget extends Widget\n{\n\tprivate callbackSelect:(element:string) => void;\n\tprivate callbackDoubleClick:() => void;\n\n\tprivate divList:DOM[] = [];\n\tprivate selectedAtno:number[] = [];\n\n\t// ------------ public methods ------------\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tinstallInlineCSS('periodictable', CSS_PERIODICTABLE);\n\t}\n\n\t// create the underlying structure; the parent parameter must be jQuery-compatible\n\tpublic render(parent:any)\n\t{\n\t\tsuper.render(parent);\n\n\t\tlet grid = dom('<div/>').appendTo(this.contentDOM).css({'display': 'grid'});\n\t\tgrid.css({'align-items': 'center', 'justify-content': 'start', 'gap': '1px'});\n\t\t//grid.css({'grid-row-gap': '0.5em', 'grid-column-gap': '0.5em'});\n\t\t//grid.css({'grid-template-columns': '[title] auto [value] auto [end]'});\n\n\t\tlet row = POSITION_TABLE_Y.map((y) => Math.round(2 * y) + 1);\n\t\tlet col = POSITION_TABLE_X.map((x) => Math.round(2 * x) + 1);\n\t\tlet num = row.length;\n\n\t\tfor (let n = 0; n < num; n++)\n\t\t{\n\t\t\tlet div = dom('<div/>').appendTo(grid);\n\t\t\tdiv.css({'grid-row': `${row[n]} / span 2`, 'grid-column': `${col[n]} / span 2`});\n\t\t\tdiv.addClass('wmk-periodictable-element');\n\n\t\t\tlet blk = Chemistry.ELEMENT_BLOCKS[n + 1];\n\t\t\tif (blk == 1) div.addClass('wmk-periodictable-block1');\n\t\t\telse if (blk == 2) div.addClass('wmk-periodictable-block2');\n\t\t\telse if (blk == 3) div.addClass('wmk-periodictable-block3');\n\t\t\telse if (blk == 4) div.addClass('wmk-periodictable-block4');\n\n\t\t\tlet el = Chemistry.ELEMENTS[n + 1];\n\t\t\tdiv.setText(el);\n\t\t\tthis.divList.push(div);\n\n\t\t\tdiv.onClick(() =>\n\t\t\t{\n\t\t\t\tthis.changeElement(el);\n\t\t\t\tthis.callbackSelect(el);\n\t\t\t});\n\t\t\tdiv.onDblClick((event) =>\n\t\t\t{\n\t\t\t\tthis.callbackDoubleClick();\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic onSelect(callback:(element:string) => void):void\n\t{\n\t\tthis.callbackSelect = callback;\n\t}\n\tpublic onDoubleClick(callback:() => void):void\n\t{\n\t\tthis.callbackDoubleClick = callback;\n\t}\n\n\t// set visible selection to the given element, or nothing if it's not in the list\n\tpublic changeElement(element:string):void\n\t{\n\t\tlet atno = Chemistry.ELEMENTS.indexOf(element);\n\t\tthis.selectedAtno = [atno];\n\t\tthis.updateSelected();\n\t\t/*if (atno == this.selectedAtno) return;\n\t\tif (this.selectedAtno > 0) this.divList[this.selectedAtno - 1].removeClass('wmk-periodictable-selected');\n\t\tthis.selectedAtno = atno;\n\t\tif (this.selectedAtno > 0) this.divList[this.selectedAtno - 1].addClass('wmk-periodictable-selected');*/\n\t}\n\n\tpublic setSelectedElements(elementList:string[]):void\n\t{\n\t\tthis.selectedAtno = elementList.map((el) => Chemistry.ELEMENTS.indexOf(el)).filter((atno) => atno > 0);\n\t\tthis.updateSelected();\n\t}\n\n\t// ------------ private methods ------------\n\n\tprivate updateSelected():void\n\t{\n\t\tfor (let n = 1; n <= this.divList.length; n++)\n\t\t{\n\t\t\tif (this.selectedAtno.includes(n))\n\t\t\t\tthis.divList[n - 1].addClass('wmk-periodictable-selected');\n\t\t\telse\n\t\t\t\tthis.divList[n - 1].removeClass('wmk-periodictable-selected');\n\t\t}\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2020 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Molecule} from '../data/Molecule';\nimport {QueryUtil} from '../data/QueryUtil';\nimport {OptionList} from '../ui/OptionList';\nimport {Widget} from '../ui/Widget';\nimport {dom, DOM} from '../util/dom';\nimport {Vec} from '../util/Vec';\n\n/*\n\tSupporting widget for editing query fields, for an atom or a bond.\n*/\n\nexport class QueryFieldsWidget extends Widget\n{\n\tprivate inputCharges:DOM;\n\tprivate optAromatic:OptionList;\n\tprivate optUnsaturated:OptionList;\n\tprivate chkNotElements:DOM;\n\tprivate inputElements:DOM;\n\tprivate chkNotRingSizes:DOM;\n\tprivate inputRingSizes:DOM;\n\tprivate optRingBlock:OptionList;\n\tprivate inputNumRings:DOM;\n\tprivate inputRingBonds:DOM;\n\tprivate inputAdjacency:DOM;\n\tprivate inputBondSums:DOM;\n\tprivate inputValences:DOM;\n\tprivate inputHydrogens:DOM;\n\tprivate inputIsotopes:DOM;\n\t//private chkSubFrags:DOM; !! ... include & exclude mutually compatible? because they can be queries...\n\t//private divQSubFrags:!!\n\tprivate inputOrders:DOM;\n\n\tconstructor(private mol:Molecule, private atom:number, private bond:number)\n\t{\n\t\tsuper();\n\t}\n\n\t// create the underlying structure; the parent parameter must be jQuery-compatible\n\tpublic render(parent:any)\n\t{\n\t\tsuper.render(parent);\n\n\t\tlet grid = dom('<div/>').appendTo(this.contentDOM);\n\t\tgrid.css({'display': 'grid', 'align-items': 'center', 'justify-content': 'start'});\n\t\tgrid.css({'grid-row-gap': '0.5em', 'grid-column-gap': '0.5em'});\n\t\tgrid.css({'grid-template-columns': '[title] auto [value] auto [end]'});\n\n\t\tlet row = 0;\n\n\t\tlet makeInput = ():DOM =>\n\t\t{\n\t\t\tlet input = dom('<input size=\"20\"/>').appendTo(grid).css({'grid-area': `${row} / value`});\n\t\t\treturn input;\n\t\t};\n\t\tlet makeToggleInput = ():[DOM, DOM] =>\n\t\t{\n\t\t\tlet div = dom('<div/>').appendTo(grid).css({'grid-area': `${row} / value`, 'dispkay': 'flex'});\n\t\t\tlet lbl = dom('<label/>').appendTo(div).css({'margin-right': '0.5em'});\n\t\t\tlet chk = dom('<input type=\"checkbox\"/>').appendTo(lbl);\n\t\t\tlbl.appendText('Not');\n\t\t\tlet input = dom('<input size=\"20\"/>').appendTo(div).css({'flex-grow': '1'});\n\t\t\treturn [chk, input];\n\t\t};\n\n\t\tif (this.atom > 0)\n\t\t{\n\t\t\tdom('<div>Charges</div>').appendTo(grid).css({'grid-area': `${++row} / title`});\n\t\t\tthis.inputCharges = makeInput();\n\n\t\t\tdom('<div>Aromatic</div>').appendTo(grid).css({'grid-area': `${++row} / title`});\n\t\t\tthis.optAromatic = new OptionList(['Maybe', 'Yes', 'No']);\n\t\t\tthis.optAromatic.render(dom('<div/>').appendTo(grid).css({'grid-area': `${row} / value`}));\n\n\t\t\tdom('<div>Unsaturated</div>').appendTo(grid).css({'grid-area': `${++row} / title`});\n\t\t\tthis.optUnsaturated = new OptionList(['Maybe', 'Yes', 'No']);\n\t\t\tthis.optUnsaturated.render(dom('<div/>').appendTo(grid).css({'grid-area': `${row} / value`}));\n\n\t\t\tdom('<div>Elements</div>').appendTo(grid).css({'grid-area': `${++row} / title`});\n\t\t\t[this.chkNotElements, this.inputElements] = makeToggleInput();\n\n\t\t\tdom('<div>Ring Sizes</div>').appendTo(grid).css({'grid-area': `${++row} / title`});\n\t\t\t[this.chkNotRingSizes, this.inputRingSizes] = makeToggleInput();\n\n\t\t\tdom('<div>Ring Block</div>').appendTo(grid).css({'grid-area': `${++row} / title`});\n\t\t\tthis.optRingBlock = new OptionList(['Maybe', 'Yes', 'No']);\n\t\t\tthis.optRingBlock.render(dom('<div/>').appendTo(grid).css({'grid-area': `${row} / value`}));\n\n\t\t\tdom('<div># Small Rings</div>').appendTo(grid).css({'grid-area': `${++row} / title`});\n\t\t\tthis.inputNumRings = makeInput();\n\n\t\t\tdom('<div># Ring Bonds</div>').appendTo(grid).css({'grid-area': `${++row} / title`});\n\t\t\tthis.inputRingBonds = makeInput();\n\n\t\t\tdom('<div>Adjacency</div>').appendTo(grid).css({'grid-area': `${++row} / title`});\n\t\t\tthis.inputAdjacency = makeInput();\n\n\t\t\tdom('<div>Bond Sums</div>').appendTo(grid).css({'grid-area': `${++row} / title`});\n\t\t\tthis.inputBondSums = makeInput();\n\n\t\t\tdom('<div>Valences</div>').appendTo(grid).css({'grid-area': `${++row} / title`});\n\t\t\tthis.inputValences = makeInput();\n\n\t\t\tdom('<div>Hydrogens</div>').appendTo(grid).css({'grid-area': `${++row} / title`});\n\t\t\tthis.inputHydrogens = makeInput();\n\n\t\t\tdom('<div>Isotopes</div>').appendTo(grid).css({'grid-area': `${++row} / title`});\n\t\t\tthis.inputIsotopes = makeInput();\n\n\t\t\t// !!! FRAGMENTS...\n\n\t\t\tthis.setupAtom();\n\t\t}\n\t\telse // this.bond > 0\n\t\t{\n\t\t\tdom('<div>Ring Sizes</div>').appendTo(grid).css({'grid-area': `${++row} / title`});\n\t\t\t[this.chkNotRingSizes, this.inputRingSizes] = makeToggleInput();\n\n\t\t\tdom('<div>Ring Block</div>').appendTo(grid).css({'grid-area': `${++row} / title`});\n\t\t\tthis.optRingBlock = new OptionList(['Maybe', 'Yes', 'No']);\n\t\t\tthis.optRingBlock.render(dom('<div/>').appendTo(grid).css({'grid-area': `${row} / value`}));\n\n\t\t\tdom('<div># Small Rings</div>').appendTo(grid).css({'grid-area': `${++row} / title`});\n\t\t\tthis.inputNumRings = makeInput();\n\n\t\t\tdom('<div>Num Rings</div>').appendTo(grid).css({'grid-area': `${++row} / title`});\n\t\t\tthis.inputNumRings = makeInput();\n\n\t\t\tdom('<div>Bond Orders</div>').appendTo(grid).css({'grid-area': `${++row} / title`});\n\t\t\tthis.inputOrders = makeInput();\n\n\t\t\tthis.setupBond();\n\t\t}\n\t}\n\n\tpublic updateAtom():void\n\t{\n\t\tconst {mol, atom} = this;\n\n\t\tQueryUtil.deleteQueryAtomAll(mol, atom);\n\n\t\tlet chg = this.splitNumbers(this.inputCharges.getValue());\n\t\tif (chg) QueryUtil.setQueryAtomCharges(mol, atom, chg);\n\n\t\tlet arom = this.optAromatic.getSelectedIndex();\n\t\tif (arom > 0) QueryUtil.setQueryAtomAromatic(mol, atom, arom == 1);\n\n\t\tlet unsat = this.optUnsaturated.getSelectedIndex();\n\t\tif (unsat > 0) QueryUtil.setQueryAtomUnsaturated(mol, atom, unsat == 1);\n\n\t\tlet elem = this.splitStrings(this.inputElements.getValue());\n\t\tif (elem)\n\t\t{\n\t\t\tif (!this.chkNotElements.elInput.checked)\n\t\t\t\tQueryUtil.setQueryAtomElements(mol, atom, elem);\n\t\t\telse\n\t\t\t\tQueryUtil.setQueryAtomElementsNot(mol, atom, elem);\n\t\t}\n\n\t\tlet ringsz = this.splitNumbers(this.inputRingSizes.getValue());\n\t\tif (ringsz)\n\t\t{\n\t\t\tif (!this.chkNotRingSizes.elInput.checked)\n\t\t\t\tQueryUtil.setQueryAtomRingSizes(mol, atom, ringsz);\n\t\t\telse\n\t\t\t\tQueryUtil.setQueryAtomRingSizesNot(mol, atom, ringsz);\n\t\t}\n\n\t\tlet ringblk = this.optRingBlock.getSelectedIndex();\n\t\tif (ringblk > 0) QueryUtil.setQueryAtomRingBlock(mol, atom, ringblk == 1);\n\n\t\tlet nring = this.splitNumbers(this.inputNumRings.getValue());\n\t\tif (nring) QueryUtil.setQueryAtomNumRings(mol, atom, nring);\n\n\t\tlet rbc = this.splitNumbers(this.inputRingBonds.getValue());\n\t\tif (rbc) QueryUtil.setQueryAtomRingBonds(mol, atom, rbc);\n\n\t\tlet adj = this.splitNumbers(this.inputAdjacency.getValue());\n\t\tif (adj) QueryUtil.setQueryAtomAdjacency(mol, atom, adj);\n\n\t\tlet bond = this.splitNumbers(this.inputBondSums.getValue());\n\t\tif (bond) QueryUtil.setQueryAtomBondSums(mol, atom, bond);\n\n\t\tlet val = this.splitNumbers(this.inputValences.getValue());\n\t\tif (val) QueryUtil.setQueryAtomValences(mol, atom, val);\n\n\t\tlet hyd = this.splitNumbers(this.inputHydrogens.getValue());\n\t\tif (hyd) QueryUtil.setQueryAtomHydrogens(mol, atom, hyd);\n\n\t\tlet iso = this.splitNumbers(this.inputIsotopes.getValue());\n\t\tif (iso) QueryUtil.setQueryAtomIsotope(mol, atom, iso);\n\n\t\t// !! FRAGMENTS\n\t}\n\n\tpublic updateBond():void\n\t{\n\t\tconst {mol, bond} = this;\n\n\t\tQueryUtil.deleteQueryBondAll(mol, bond);\n\n\t\tlet ringsz = this.splitNumbers(this.inputRingSizes.getValue());\n\t\tif (ringsz)\n\t\t{\n\t\t\tif (!this.chkNotRingSizes.elInput.checked)\n\t\t\t\tQueryUtil.setQueryBondRingSizes(mol, bond, ringsz);\n\t\t\telse\n\t\t\t\tQueryUtil.setQueryBondRingSizesNot(mol, bond, ringsz);\n\t\t}\n\n\t\tlet ringblk = this.optRingBlock.getSelectedIndex();\n\t\tif (ringblk > 0) QueryUtil.setQueryBondRingBlock(mol, bond, ringblk == 1);\n\n\t\tlet nring = this.splitNumbers(this.inputNumRings.getValue());\n\t\tif (nring) QueryUtil.setQueryBondNumRings(mol, bond, nring);\n\n\t\tlet order = this.splitNumbers(this.inputOrders.getValue());\n\t\tif (order) QueryUtil.setQueryBondOrders(mol, bond, order);\n\t}\n\n\t// ------------ private methods ------------\n\n\tprivate setupAtom():void\n\t{\n\t\tconst {mol, atom} = this;\n\n\t\tlet chg = QueryUtil.queryAtomCharges(mol, atom);\n\t\tlet arom = QueryUtil.queryAtomAromatic(mol, atom);\n\t\tlet unsat = QueryUtil.queryAtomUnsaturated(mol, atom);\n\t\tlet elem = QueryUtil.queryAtomElements(mol, atom);\n\t\tlet elemNot = QueryUtil.queryAtomElementsNot(mol, atom);\n\t\tlet ringsz = QueryUtil.queryAtomRingSizes(mol, atom);\n\t\tlet ringszNot = QueryUtil.queryAtomRingSizesNot(mol, atom);\n\t\tlet ringblk = QueryUtil.queryAtomRingBlock(mol, atom);\n\t\tlet nring = QueryUtil.queryAtomNumRings(mol, atom);\n\t\tlet rbc = QueryUtil.queryAtomRingBonds(mol, atom);\n\t\tlet adj = QueryUtil.queryAtomAdjacency(mol, atom);\n\t\tlet bond = QueryUtil.queryAtomBondSums(mol, atom);\n\t\tlet val = QueryUtil.queryAtomValences(mol, atom);\n\t\tlet hyd = QueryUtil.queryAtomHydrogens(mol, atom);\n\t\tlet iso = QueryUtil.queryAtomIsotope(mol, atom);\n\t\tlet frag = QueryUtil.queryAtomSubFrags(mol, atom);\n\t\tlet fragNot = QueryUtil.queryAtomSubFragsNot(mol, atom);\n\n\t\tthis.inputCharges.setValue(Vec.notBlank(chg) ? chg.join(',') : '');\n\t\tthis.optAromatic.setSelectedIndex(arom == null ? 0 : arom ? 1 : 2);\n\t\tthis.optUnsaturated.setSelectedIndex(unsat == null ? 0 : unsat ? 1 : 2);\n\t\tthis.chkNotElements.elInput.checked = Vec.isBlank(elem) && Vec.notBlank(elemNot);\n\t\tthis.inputElements.setValue(Vec.notBlank(elem) ? elem.join(',') : Vec.notBlank(elemNot) ? elemNot.join(',') : '');\n\t\tthis.chkNotRingSizes.elInput.checked = Vec.isBlank(ringsz) && Vec.notBlank(ringszNot);\n\t\tthis.inputRingSizes.setValue(Vec.notBlank(ringsz) ? ringsz.join(',') : Vec.notBlank(ringszNot) ? ringszNot.join(',') : '');\n\t\tthis.optRingBlock.setSelectedIndex(ringblk == null ? 0 : ringblk ? 1 : 2);\n\t\tthis.inputNumRings.setValue(Vec.notBlank(nring) ? nring.join(',') : '');\n\t\tthis.inputRingBonds.setValue(Vec.notBlank(rbc) ? rbc.join(',') : '');\n\t\tthis.inputAdjacency.setValue(Vec.notBlank(adj) ? adj.join(',') : '');\n\t\tthis.inputBondSums.setValue(Vec.notBlank(bond) ? bond.join(',') : '');\n\t\tthis.inputValences.setValue(Vec.notBlank(val) ? val.join(',') : '');\n\t\tthis.inputHydrogens.setValue(Vec.notBlank(hyd) ? hyd.join(',') : '');\n\t\tthis.inputIsotopes.setValue(Vec.notBlank(iso) ? iso.join(',') : '');\n\n\t\t// TODO: frag/fragNot\n\t}\n\n\tprivate setupBond():void\n\t{\n\t\tconst {mol, bond} = this;\n\n\t\tlet ringsz = QueryUtil.queryBondRingSizes(mol, bond);\n\t\tlet ringszNot = QueryUtil.queryBondRingSizesNot(mol, bond);\n\t\tlet ringblk = QueryUtil.queryBondRingBlock(mol, bond);\n\t\tlet nring = QueryUtil.queryBondNumRings(mol, bond);\n\t\tlet order = QueryUtil.queryBondOrders(mol, bond);\n\n\t\tthis.chkNotRingSizes.elInput.checked = Vec.isBlank(ringsz) && Vec.notBlank(ringszNot);\n\t\tthis.inputRingSizes.setValue(Vec.notBlank(ringsz) ? ringsz.join(',') : Vec.notBlank(ringszNot) ? ringszNot.join(',') : '');\n\t\tthis.optRingBlock.setSelectedIndex(ringblk == null ? 0 : ringblk ? 1 : 2);\n\t\tthis.inputNumRings.setValue(Vec.notBlank(nring) ? nring.join(',') : '');\n\t\tthis.inputOrders.setValue(Vec.notBlank(order) ? order.join(',') : '');\n\t}\n\n\tprivate splitStrings(str:string):string[]\n\t{\n\t\tlet list:string[] = [];\n\t\tif (str) for (let bit of str.split(/[\\s\\,\\;]+/)) if (bit) list.push(bit);\n\t\treturn list.length ? list : null;\n\t}\n\tprivate splitNumbers(str:string):number[]\n\t{\n\t\tlet list:number[] = [];\n\t\tif (str) for (let bit of str.split(/[\\s\\,\\;]+/))\n\t\t{\n\t\t\tif (bit.startsWith('+')) bit = bit.substring(1);\n\t\t\tlet num = parseInt(bit);\n\t\t\tif (!isNaN(num)) list.push(num);\n\t\t}\n\t\treturn list.length ? list : null;\n\t}\n}\n\n","/*\n\tWebMolKit\n\n\t(c) 2010-2020 Molecular Materials Informatics, Inc.\n\n\tAll rights reserved\n\n\thttp://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {AbbrevContainer, AbbrevContainerFrag} from '../data/AbbrevContainer';\nimport {Molecule} from '../data/Molecule';\nimport {MolUtil} from '../data/MolUtil';\nimport {Dialog} from '../dialog/Dialog';\nimport {OutlineMeasurement} from '../gfx/ArrangeMeasurement';\nimport {ArrangeMolecule} from '../gfx/ArrangeMolecule';\nimport {DrawMolecule} from '../gfx/DrawMolecule';\nimport {MetaVector} from '../gfx/MetaVector';\nimport {RenderEffects, RenderPolicy} from '../gfx/Rendering';\nimport {ClipboardProxy, ClipboardProxyHandler} from '../ui/ClipboardProxy';\nimport {OptionList} from '../ui/OptionList';\nimport {TabBar} from '../ui/TabBar';\nimport {dom, DOM} from '../util/dom';\nimport {Theme} from '../util/Theme';\nimport {angleDiffPos, colourCode, DEGRAD, KeyCode, norm_xy, RADDEG} from '../util/util';\nimport {Vec} from '../util/Vec';\nimport {ExtraFieldsWidget} from './ExtraFieldsWidget';\nimport {GeomWidget, GeomWidgetSelection, GeomWidgetSelType, GeomWidgetType} from './GeomWidget';\nimport {ActivityType, MoleculeActivity, SketchState} from './MoleculeActivity';\nimport {PeriodicTableWidget} from './PeriodicTableWidget';\nimport {QueryFieldsWidget} from './QueryFieldsWidget';\n\n/*\n\tOptions for editing a single atom within a molecule.\n*/\n\ninterface EditAtomAbbrev\n{\n\ttr:DOM;\n\tidx:number;\n\tbgcol:string;\n}\n\nexport class EditAtom extends Dialog\n{\n\tpublic mol:Molecule; // copy of original: may or may not be different\n\tpublic newX = 0;\n\tpublic newY = 0;\n\n\tprivate initMol:Molecule;\n\tprivate btnApply:DOM;\n\tprivate tabs:TabBar = null;\n\n\tprivate inputSymbol:DOM;\n\tprivate inputCharge:DOM;\n\tprivate inputUnpaired:DOM;\n\tprivate optionHydrogen:OptionList;\n\tprivate inputHydrogen:DOM;\n\tprivate optionIsotope:OptionList;\n\tprivate inputIsotope:DOM;\n\tprivate inputMapping:DOM;\n\tprivate inputIndex:DOM;\n\tprivate periodicWidget:PeriodicTableWidget;\n\n\tprivate abbrevList:AbbrevContainerFrag[] = null;\n\tprivate inputAbbrevSearch:DOM;\n\tprivate tableAbbrev:DOM;\n\tprivate svgAbbrev:string[] = null;\n\tprivate abbrevEntries:EditAtomAbbrev[];\n\tprivate abbrevIndices:number[] = [];\n\tprivate currentAbbrev = -1;\n\n\tprivate inputGeom1:DOM;\n\tprivate inputGeom2:DOM;\n\tprivate geomWidget:GeomWidget;\n\tprivate refGeom1:string;\n\tprivate refGeom2:string;\n\n\tprivate queryWidget:QueryFieldsWidget;\n\tprivate fieldsWidget:ExtraFieldsWidget;\n\n\tconstructor(mol:Molecule, public atom:number, private proxyClip:ClipboardProxy, private callbackApply:(source?:EditAtom) => void)\n\t{\n\t\tsuper();\n\n\t\tthis.initMol = mol;\n\t\tthis.mol = mol.clone();\n\n\t\tthis.title = 'Edit Atom';\n\t\tthis.minPortionWidth = 20;\n\t\tthis.maxPortionWidth = 95;\n\t}\n\n\t// builds the dialog content\n\tprotected populate():void\n\t{\n\t\tthis.proxyClip.pushHandler(new ClipboardProxyHandler());\n\n\t\tlet buttons = this.buttonsDOM(), body = this.bodyDOM();\n\n\t\tthis.btnApply = dom('<button class=\"wmk-button wmk-button-primary\">Apply</button>').appendTo(buttons).css({'margin-left': '0.5em'});\n\t\tthis.btnApply.onClick(() => this.applyChanges());\n\n\t\tif (this.atom > 0)\n\t\t{\n\t\t\tthis.tabs = new TabBar(['Atom', 'Abbreviation', 'Geometry', 'Query', 'Extra']);\n\t\t\tthis.tabs.render(body);\n\t\t\tthis.tabs.onSelect((idx) => this.selectedTab(idx));\n\n\t\t\tthis.populateAtom(this.tabs.getPanelDOM('Atom'));\n\t\t\tthis.populateAbbreviation(this.tabs.getPanelDOM('Abbreviation'));\n\t\t\tif (this.atom > 0) this.populateGeometry(this.tabs.getPanelDOM('Geometry'));\n\t\t\tthis.populateQuery(this.tabs.getPanelDOM('Query'));\n\t\t\tthis.populateExtra(this.tabs.getPanelDOM('Extra'));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.populateAtom(body);\n\t\t}\n\n\t\tlet focusable = body.findAll('input,textarea');\n\t\tif (focusable.length > 0) focusable[0].grabFocus(true);\n\t\tfor (let dom of focusable)\n\t\t{\n\t\t\tdom.css({'font': 'inherit'});\n\t\t\tdom.onKeyDown((event:KeyboardEvent) =>\n\t\t\t{\n\t\t\t\tif (event.key == KeyCode.Enter) this.applyChanges();\n\t\t\t\telse if (event.key == KeyCode.Escape) this.close();\n\t\t\t\telse if (event.key == KeyCode.PageUp)\n\t\t\t\t{\n\t\t\t\t\tthis.tabs.rotateSelected(-1);\n\t\t\t\t\tthis.selectedTab(this.tabs.getSelectedIndex());\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t}\n\t\t\t\telse if (event.key == KeyCode.PageDown)\n\t\t\t\t{\n\t\t\t\t\tthis.tabs.rotateSelected(1);\n\t\t\t\t\tthis.selectedTab(this.tabs.getSelectedIndex());\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t}\n\t\t\t\tevent.stopPropagation();\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic close():void\n\t{\n\t\tthis.proxyClip.popHandler();\n\t\tsuper.close();\n\t}\n\n\t// ------------ private methods ------------\n\n\t// trigger the apply/save sequence\n\tprivate applyChanges():void\n\t{\n\t\tthis.mol.keepTransient = true;\n\n\t\tthis.updateMolecule();\n\t\tlet selTab = this.tabs ? this.tabs.getSelectedValue() : null;\n\t\tif (selTab == 'Abbreviation') this.updateAbbrev();\n\t\tif (selTab == 'Geometry') this.updateGeometry();\n\t\tif (selTab == 'Query') this.updateQuery();\n\t\tif (selTab == 'Extra') this.updateExtra();\n\n\t\tthis.mol.keepTransient = false;\n\n\t\tif (this.callbackApply) this.callbackApply(this);\n\t}\n\n\tprivate populateAtom(panel:DOM):void\n\t{\n\t\tlet grid = dom('<div/>').appendTo(panel);\n\t\tgrid.css({'display': 'grid', 'align-items': 'center', 'justify-content': 'start'});\n\t\tgrid.css({'grid-row-gap': '0.5em', 'grid-column-gap': '0.5em'});\n\t\tgrid.css({'grid-template-columns': '[start col0] auto [col1] auto [col2] auto [col3] auto [col4 end]'});\n\n\t\tgrid.appendHTML('<div style=\"grid-area: 1 / col0;\">Symbol</div>');\n\t\tthis.inputSymbol = dom('<input size=\"20\"/>').appendTo(grid);\n\t\tthis.inputSymbol.css({'grid-area': '1 / col1 / auto / col4}'});\n\t\tthis.inputSymbol.onInput(() => this.periodicWidget.changeElement(this.inputSymbol.getValue()));\n\n\t\tgrid.appendHTML('<div style=\"grid-area: 2 / col0;\">Charge</div>');\n\t\tthis.inputCharge = dom('<input type=\"number\" size=\"6\"/>').appendTo(grid);\n\t\tthis.inputCharge.css({'grid-area': '2 / col1'});\n\n\t\tgrid.appendHTML('<div style=\"grid-area: 2 / col2;\">Unpaired</div>');\n\t\tthis.inputUnpaired = dom('<input type=\"number\" size=\"6\"/>').appendTo(grid);\n\t\tthis.inputUnpaired.css({'grid-area': '2 / col3'});\n\n\t\tgrid.appendHTML('<div style=\"grid-area: 3 / col0;\">Hydrogens</div>');\n\t\tthis.optionHydrogen = new OptionList(['Auto', 'None', '1', '2', '3', '4', 'Other']);\n\t\tthis.optionHydrogen.render(dom('<div style=\"grid-area: 3 / col1 / auto / col3\"/>').appendTo(grid));\n\t\tthis.optionHydrogen.onSelect((idx) => this.inputHydrogen.elInput.disabled = idx != 6);\n\t\tthis.inputHydrogen = dom('<input type=\"number\" size=\"4\"/>').appendTo(grid);\n\t\tthis.inputHydrogen.css({'grid-area': '3 / col3'});\n\t\tthis.inputHydrogen.elInput.disabled = true;\n\n\t\tgrid.appendHTML('<div style=\"grid-area: 4 / col0;\">Isotope</div>');\n\t\tthis.optionIsotope = new OptionList(['Natural', 'Enriched']);\n\t\tthis.optionIsotope.render(dom('<div style=\"grid-area: 4 / col1 / auto / col3\"/>').appendTo(grid));\n\t\tthis.optionIsotope.onSelect((idx) => this.inputIsotope.elInput.disabled = idx == 0);\n\t\tthis.inputIsotope = dom('<input type=\"number\" size=\"6\"/>').appendTo(grid);\n\t\tthis.inputIsotope.css({'grid-area': '4 / col3'});\n\t\tthis.inputIsotope.elInput.disabled = true;\n\n\t\tgrid.appendHTML('<div style=\"grid-area: 5 / col0;\">Mapping</div>');\n\t\tthis.inputMapping = dom('<input type=\"number\" size=\"6\"/>').appendTo(grid);\n\t\tthis.inputMapping.css({'grid-area': '5 / col1'});\n\n\t\tgrid.appendHTML('<div style=\"grid-area: 5 / col2;\">Index</div>');\n\t\tthis.inputIndex = dom('<input type=\"number\" size=\"6\" readonly=\"readonly\"/>').appendTo(grid);\n\t\tthis.inputIndex.css({'grid-area': '5 / col3'});\n\n\t\tlet divPeriodic = dom('<div/>').appendTo(grid).css({'grid-area': '6 / start / 6 / end'});\n\t\tthis.periodicWidget = new PeriodicTableWidget();\n\t\tthis.periodicWidget.onSelect((element) => this.inputSymbol.setValue(element));\n\t\tthis.periodicWidget.onDoubleClick(() => this.applyChanges());\n\t\tthis.periodicWidget.render(divPeriodic);\n\n\t\tconst mol = this.mol, atom = this.atom;\n\t\tif (atom > 0)\n\t\t{\n\t\t\tthis.inputSymbol.setValue(mol.atomElement(atom));\n\t\t\tthis.inputCharge.setValue(mol.atomCharge(atom).toString());\n\t\t\tthis.inputUnpaired.setValue(mol.atomUnpaired(atom).toString());\n\n\t\t\tlet hc = mol.atomHExplicit(atom);\n\t\t\tif (hc == Molecule.HEXPLICIT_UNKNOWN)\n\t\t\t{\n\t\t\t\tthis.optionHydrogen.setSelectedIndex(0);\n\t\t\t\tthis.inputHydrogen.setValue(mol.atomHydrogens(atom).toString());\n\t\t\t\tthis.inputHydrogen.elInput.disabled = true;\n\t\t\t}\n\t\t\telse if (hc <= 4)\n\t\t\t{\n\t\t\t\tthis.optionHydrogen.setSelectedIndex(hc + 1);\n\t\t\t\tthis.inputHydrogen.setValue(hc.toString());\n\t\t\t\tthis.inputHydrogen.elInput.disabled = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.optionHydrogen.setSelectedIndex(6);\n\t\t\t\tthis.inputHydrogen.setValue(hc.toString());\n\t\t\t\tthis.inputHydrogen.elInput.disabled = false;\n\t\t\t}\n\t\t\t//this.optionHydrogen.setSelectedIndex(mol.atomHExplicit(atom) == Molecule.HEXPLICIT_UNKNOWN ? 0 : 1);\n\t\t\t//if (mol.atomHExplicit(atom) != Molecule.HEXPLICIT_UNKNOWN) this.inputHydrogen.val(mol.atomHExplicit(atom).toString());\n\n\t\t\tthis.optionIsotope.setSelectedIndex(mol.atomIsotope(atom) == Molecule.ISOTOPE_NATURAL ? 0 : 1);\n\t\t\tif (mol.atomIsotope(atom) != Molecule.ISOTOPE_NATURAL) this.inputIsotope.setValue(mol.atomIsotope(atom).toString());\n\t\t\tthis.inputIsotope.elInput.disabled = mol.atomIsotope(atom) == Molecule.ISOTOPE_NATURAL;\n\n\t\t\tthis.inputMapping.setValue(mol.atomMapNum(atom).toString());\n\t\t\tthis.inputIndex.setValue(atom.toString());\n\n\t\t\tthis.periodicWidget.changeElement(mol.atomElement(atom));\n\t\t}\n\t}\n\n\tprivate populateAbbreviation(panel:DOM):void\n\t{\n\t\tlet divFlex = dom('<div/>').appendTo(panel).css({'display': 'flex', 'align-items': 'flex-start'});\n\t\tdivFlex.css({'max-width': '60vw', 'max-height': '50vh', 'overflow-y': 'scroll'});\n\n\t\tlet spanSearch = dom('<div/>').appendTo(divFlex).css({'margin-right': '0.5em', 'flex': '0 0'});\n\t\tlet spanList = dom('<div/>').appendTo(divFlex).css({'flex': '1 1 100%'});\n\n\t\tthis.inputAbbrevSearch = dom('<input size=\"10\"/>').appendTo(spanSearch);\n\t\tthis.inputAbbrevSearch.setAttr('placeholder', 'Search');\n\t\tlet lastSearch = '';\n\t\tthis.inputAbbrevSearch.onKeyDown((event) =>\n\t\t{\n\t\t\tif (event.key == KeyCode.Up) this.cycleAbbreviation(-1);\n\t\t\telse if (event.key == KeyCode.Down) this.cycleAbbreviation(1);\n\t\t});\n\t\tthis.inputAbbrevSearch.onInput(() =>\n\t\t{\n\t\t\tlet search = this.inputAbbrevSearch.getValue();\n\t\t\tif (search == lastSearch) return;\n\t\t\tlastSearch = search;\n\t\t\tthis.fillAbbreviations();\n\t\t});\n\n\t\tlet divButtons = dom('<div/>').appendTo(spanSearch).css({'margin-top': '0.5em'});\n\t\tlet btnClear = dom('<button class=\"wmk-button wmk-button-default\">Clear</button>').appendTo(divButtons);\n\t\tbtnClear.onClick(() =>\n\t\t{\n\t\t\tthis.selectAbbreviation(-1);\n\t\t\tif (this.atom > 0 && MolUtil.hasAbbrev(this.mol, this.atom)) this.applyChanges();\n\t\t});\n\n\t\tthis.tableAbbrev = dom('<table/>').appendTo(spanList).css({'border-collapse': 'collapse', 'width': '100%'});\n\t\tthis.fillAbbreviations();\n\t}\n\n\tprivate populateGeometry(panel:DOM):void\n\t{\n\t\tconst {mol, atom} = this;\n\n\t\tlet divContainer1 = dom('<div/>').appendTo(panel).css({'text-align': 'center'});\n\t\tlet divContainer2 = dom('<div/>').appendTo(divContainer1).css({'display': 'inline-block'});\n\t\tlet grid = dom('<div/>').appendTo(divContainer2);\n\t\tgrid.css({'display': 'grid', 'align-items': 'center', 'justify-content': 'start'});\n\t\tgrid.css({'grid-row-gap': '0.5em', 'grid-column-gap': '0.5em'});\n\t\tgrid.css({'grid-template-columns': '[start col0] auto [col1] auto [col2] auto [col3] auto [col4 end]'});\n\n\t\tthis.geomWidget = new GeomWidget(GeomWidgetType.Atom, mol, atom);\n\t\tthis.geomWidget.render(dom('<div/>').appendTo(grid).css({'grid-area': '1 / col0 / auto / col4', 'text-align': 'center'}));\n\n\t\tlet label1 = dom('<div/>').appendTo(grid).css({'grid-area': '2 / col0'});\n\t\tthis.inputGeom1 = dom('<input type=\"number\" size=\"8\"/>').appendTo(grid).css({'grid-area': '2 / col1'});\n\t\tlet label2 = dom('<div/>').appendTo(grid).css({'grid-area': '2 / col2'});\n\t\tthis.inputGeom2 = dom('<input type=\"number\" size=\"8\"/>').appendTo(grid).css({'grid-area': '2 / col3'});\n\n\t\tthis.geomWidget.callbackSelect = (sel:GeomWidgetSelection) =>\n\t\t{\n\t\t\tlet atoms = this.geomWidget.selectionAtoms(sel);\n\t\t\tif (sel.type == GeomWidgetSelType.Position)\n\t\t\t{\n\t\t\t\tlabel1.setText('Position X');\n\t\t\t\tlabel2.setText('Y');\n\t\t\t\tthis.inputGeom1.setValue(this.refGeom1 = mol.atomX(atoms[0]).toFixed(3));\n\t\t\t\tthis.inputGeom2.setValue(this.refGeom2 = mol.atomY(atoms[0]).toFixed(3));\n\t\t\t}\n\t\t\telse if (sel.type == GeomWidgetSelType.Link)\n\t\t\t{\n\t\t\t\tlet dx = mol.atomX(atoms[1]) - mol.atomX(atoms[0]), dy = mol.atomY(atoms[1]) - mol.atomY(atoms[0]);\n\t\t\t\tlabel1.setText('Distance');\n\t\t\t\tlabel2.setText('Angle');\n\t\t\t\tthis.inputGeom1.setValue(this.refGeom1 = norm_xy(dx, dy).toFixed(3));\n\t\t\t\tthis.inputGeom2.setValue(this.refGeom2 = (Math.atan2(dy, dx) * RADDEG).toFixed(1));\n\t\t\t}\n\t\t\telse if (sel.type == GeomWidgetSelType.Torsion)\n\t\t\t{\n\t\t\t\tlet cx = mol.atomX(atoms[0]), cy = mol.atomY(atoms[0]);\n\t\t\t\tlet th2 = Math.atan2(mol.atomY(atoms[1]) - cy, mol.atomX(atoms[1]) - cx);\n\t\t\t\tlet th1 = Math.atan2(mol.atomY(atoms[2]) - cy, mol.atomX(atoms[2]) - cx);\n\t\t\t\tlabel1.setText('Angle');\n\t\t\t\tlabel2.setText('');\n\t\t\t\tthis.inputGeom1.setValue(this.refGeom1 = (angleDiffPos(th2, th1) * RADDEG).toFixed(1));\n\t\t\t\tthis.inputGeom2.setValue(this.refGeom2 = '');\n\t\t\t}\n\t\t\tlabel2.setCSS('display', sel.type == GeomWidgetSelType.Torsion ? 'none' : 'block');\n\t\t\tthis.inputGeom2.setCSS('display', sel.type == GeomWidgetSelType.Torsion ? 'none' : 'block');\n\t\t};\n\t\tthis.geomWidget.callbackSelect(this.geomWidget.selected); // trigger initial definition\n\t}\n\n\tprivate populateQuery(panel:DOM):void\n\t{\n\t\tthis.queryWidget = new QueryFieldsWidget(this.mol, this.atom, 0);\n\t\tthis.queryWidget.render(panel);\n\t}\n\n\tprivate populateExtra(panel:DOM):void\n\t{\n\t\tlet fields = [...this.mol.atomExtra(this.atom), ...this.mol.atomTransient(this.atom)];\n\t\tthis.fieldsWidget = new ExtraFieldsWidget(fields);\n\t\tthis.fieldsWidget.render(panel);\n\t}\n\n\t// read everything back in from the dialog objects\n\tprivate updateMolecule():void\n\t{\n\t\tlet {mol, atom} = this;\n\n\t\tif (atom == 0) atom = this.atom = mol.addAtom('C', this.newX, this.newY);\n\n\t\tlet sym = this.inputSymbol.getValue();\n\t\tif (sym != '') mol.setAtomElement(atom, sym);\n\n\t\tlet chg = parseInt(this.inputCharge.getValue());\n\t\tif (chg > -20 && chg < 20) mol.setAtomCharge(atom, chg);\n\n\t\tlet unp = parseInt(this.inputUnpaired.getValue());\n\t\tif (unp >= 0 && unp < 20) mol.setAtomUnpaired(atom, unp);\n\n\t\tlet hcidx = this.optionHydrogen.getSelectedIndex();\n\t\tif (hcidx == 0) mol.setAtomHExplicit(atom, Molecule.HEXPLICIT_UNKNOWN);\n\t\telse if (hcidx <= 5) mol.setAtomHExplicit(atom, hcidx - 1);\n\t\telse\n\t\t{\n\t\t\tlet hyd = parseInt(this.inputHydrogen.getValue());\n\t\t\tif (hyd >= 0 && hyd < 20) mol.setAtomHExplicit(atom, hyd);\n\t\t}\n\n\t\tif (this.optionIsotope.getSelectedIndex() == 1)\n\t\t{\n\t\t\tlet iso = parseInt(this.inputIsotope.getValue());\n\t\t\tif (iso >= 0 && iso < 300) mol.setAtomIsotope(atom, iso);\n\t\t}\n\t\telse mol.setAtomIsotope(atom, Molecule.ISOTOPE_NATURAL);\n\n\t\tlet map = parseInt(this.inputMapping.getValue());\n\t\tif (!isNaN(map)) mol.setAtomMapNum(atom, map);\n\t}\n\n\tprivate updateAbbrev():void\n\t{\n\t\tconst {mol, atom} = this;\n\n\t\tif (this.currentAbbrev < 0)\n\t\t{\n\t\t\tlet el = mol.atomElement(atom);\n\t\t\tMolUtil.clearAbbrev(mol, atom); // (resets the element)\n\t\t\tmol.setAtomElement(atom, el);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet abbrev = this.abbrevList[this.currentAbbrev];\n\t\t\tmol.setAtomElement(atom, abbrev.name);\n\t\t\tMolUtil.setAbbrev(mol, atom, abbrev.frag);\n\t\t}\n\t}\n\n\tprivate updateGeometry():void\n\t{\n\t\tlet strval1 = this.inputGeom1.getValue(), strval2 = this.inputGeom2.getValue();\n\t\tif (this.refGeom1 == strval1 && this.refGeom2 == strval2) return;\n\n\t\tconst {mol} = this;\n\t\tlet sel = this.geomWidget.selected, atoms = this.geomWidget.selectionAtoms(sel);\n\n\t\tif (sel.type == GeomWidgetSelType.Position)\n\t\t{\n\t\t\tlet x = parseFloat(strval1), y = parseFloat(strval2);\n\t\t\tif (isNaN(x) || isNaN(y) || Math.abs(x) > 1E6 || Math.abs(y) > 1E6) return; // non-sane\n\t\t\tmol.setAtomPos(atoms[0], x, y);\n\t\t}\n\t\telse if (sel.type == GeomWidgetSelType.Link)\n\t\t{\n\t\t\tif (this.refGeom1 != strval1)\n\t\t\t{\n\t\t\t\tlet dist = parseFloat(strval1);\n\t\t\t\tif (isNaN(dist) || Math.abs(dist) > 100) return; // non-sane\n\t\t\t\tlet mask = Vec.booleanArray(false, mol.numAtoms);\n\t\t\t\tmask[atoms[1] - 1] = true;\n\t\t\t\tlet instate:SketchState = {mol, currentAtom: 0, currentBond: mol.findBond(atoms[0], atoms[1]), 'selectedMask': mask};\n\t\t\t\tlet molact = new MoleculeActivity(instate, ActivityType.BondDist, {dist});\n\t\t\t\tmolact.execute();\n\t\t\t\tif (molact.output.mol) this.mol = molact.output.mol;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telse if (this.refGeom2 != strval2)\n\t\t\t{\n\t\t\t\tlet angle = parseFloat(strval2);\n\t\t\t\tif (isNaN(angle)) return; // non-sane\n\t\t\t\tlet mask = Vec.booleanArray(false, mol.numAtoms);\n\t\t\t\tmask[atoms[1] - 1] = true;\n\t\t\t\tlet instate:SketchState = {mol, currentAtom: 0, currentBond: mol.findBond(atoms[0], atoms[1]), selectedMask: mask};\n\t\t\t\tlet molact = new MoleculeActivity(instate, ActivityType.AlignAngle, {angle: angle * DEGRAD});\n\t\t\t\tmolact.execute();\n\t\t\t\tif (molact.output.mol) this.mol = molact.output.mol;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\telse if (sel.type == GeomWidgetSelType.Torsion)\n\t\t{\n\t\t\tlet angle = parseFloat(strval1);\n\t\t\tif (isNaN(angle)) return; // non-sane\n\t\t\tlet mask = Vec.booleanArray(false, mol.numAtoms);\n\t\t\tfor (let a of atoms) mask[a - 1] = true;\n\t\t\tlet instate:SketchState = {mol, currentAtom: atoms[2], currentBond: 0, selectedMask: mask};\n\t\t\tlet molact = new MoleculeActivity(instate, ActivityType.AdjustTorsion, {angle: angle * DEGRAD});\n\t\t\tmolact.execute();\n\t\t\tif (molact.output.mol) this.mol = molact.output.mol;\n\t\t\treturn;\n\t\t}\n\t}\n\n\tprivate updateQuery():void\n\t{\n\t\tthis.queryWidget.updateAtom();\n\t}\n\n\tprivate updateExtra():void\n\t{\n\t\tthis.mol.setAtomExtra(this.atom, this.fieldsWidget.getExtraFields());\n\t\tthis.mol.setAtomTransient(this.atom, this.fieldsWidget.getTransientFields());\n\t}\n\n\t// enumerate all abbreviations compatible with the search; it will go into self-callback mode if the abbreviations need to be loaded\n\tprivate fillAbbreviations():void\n\t{\n\t\tif (AbbrevContainer.needsSetup())\n\t\t{\n\t\t\tsetTimeout(() => AbbrevContainer.setupData().then(() => this.fillAbbreviations()), 1);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.tableAbbrev.empty();\n\n\t\tAbbrevContainer.main.submitMolecule(this.mol, true);\n\t\tthis.abbrevList = AbbrevContainer.main.getAbbrevs();\n\t\tif (!this.svgAbbrev)\n\t\t{\n\t\t\tthis.svgAbbrev = [];\n\t\t\tlet policy = RenderPolicy.defaultColourOnWhite(10);\n\t\t\tlet measure = new OutlineMeasurement(0, 0, policy.data.pointScale);\n\n\t\t\tfor (let abbrev of this.abbrevList)\n\t\t\t{\n\t\t\t\tlet effects = new RenderEffects();\n\t\t\t\tlet mol = abbrev.frag.clone();\n\t\t\t\teffects.atomCircleSz = Vec.numberArray(0, mol.numAtoms);\n\t\t\t\teffects.atomCircleCol = Vec.numberArray(0, mol.numAtoms);\n\t\t\t\tfor (let n = 1; n <= mol.numAtoms; n++) if (mol.atomElement(n) == MolUtil.ABBREV_ATTACHMENT)\n\t\t\t\t{\n\t\t\t\t\tmol.setAtomElement(n, 'C');\n\t\t\t\t\teffects.atomCircleSz[n - 1] = 0.2;\n\t\t\t\t\teffects.atomCircleCol[n - 1] = 0x00C000;\n\t\t\t\t}\n\t\t\t\tlet layout = new ArrangeMolecule(mol, measure, policy, effects);\n\t\t\t\tlayout.arrange();\n\t\t\t\t// !! max size\n\t\t\t\tlet gfx = new MetaVector();\n\t\t\t\tnew DrawMolecule(layout, gfx).draw();\n\t\t\t\tgfx.normalise();\n\t\t\t\tthis.svgAbbrev.push(gfx.createSVG());\n\t\t\t}\n\n\t\t\t// see if the current abbreviation matches anything\n\t\t\tconst {mol, atom} = this;\n\t\t\tif (atom > 0 && MolUtil.hasAbbrev(mol, atom))\n\t\t\t{\n\t\t\t\tlet name = mol.atomElement(atom), mf = MolUtil.molecularFormula(MolUtil.getAbbrev(mol, atom));\n\t\t\t\tfor (let n = 0; n < this.abbrevList.length; n++) if (name == this.abbrevList[n].name)\n\t\t\t\t{\n\t\t\t\t\t// NOTE: just going by name & basic molecule formula; using sketchMappable fails because layout can vary\n\t\t\t\t\t//if (CoordUtil.sketchMappable(abbrevs[n].frag, MolUtil.getAbbrev(mol, atom))) this.currentAbbrev = n;\n\t\t\t\t\tif (mf == MolUtil.molecularFormula(this.abbrevList[n].frag)) this.currentAbbrev = n;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet tr = dom('<tr/>').appendTo(this.tableAbbrev);\n\t\ttr.appendHTML('<td><u>Label</u></td>');\n\t\ttr.appendHTML('<td><u>Structure</u></td>');\n\n\t\tthis.abbrevEntries = [];\n\t\tthis.abbrevIndices = [];\n\t\tlet search = this.inputAbbrevSearch.getValue().toLowerCase();\n\n\t\tfor (let n = 0; n < this.abbrevList.length; n++)\n\t\t{\n\t\t\tif (this.currentAbbrev != n && !this.abbrevList[n].nameSearch.includes(search)) continue;\n\n\t\t\tlet entry:EditAtomAbbrev =\n\t\t\t{\n\t\t\t\ttr: dom('<tr/>').appendTo(this.tableAbbrev),\n\t\t\t\tidx: n,\n\t\t\t\tbgcol: this.abbrevEntries.length % 2 == 0 ? '#FFFFFF' : '#F8F8F8'\n\t\t\t};\n\t\t\tentry.tr.setCSS('background-color', this.currentAbbrev == entry.idx ? colourCode(Theme.lowlight) : entry.bgcol);\n\t\t\tlet tdLabel = dom('<td/>').appendTo(entry.tr), tdStruct = dom('<td/>').appendTo(entry.tr);\n\t\t\ttdLabel.setHTML(this.abbrevList[n].nameHTML);\n\n\t\t\tdom(this.svgAbbrev[n]).appendTo(tdStruct).css({'display': 'block', 'pointer-events': 'none'});\n\n\t\t\tentry.tr.css({'cursor': 'pointer'});\n\t\t\tentry.tr.onClick(() => this.selectAbbreviation(n));\n\t\t\tentry.tr.onDblClick((event) => this.applyChanges());\n\n\t\t\tthis.abbrevEntries.push(entry);\n\t\t\tthis.abbrevIndices.push(n);\n\t\t}\n\t}\n\n\t// change currently selected abbreviation\n\tprivate selectAbbreviation(idx:number):void\n\t{\n\t\tif (this.currentAbbrev == idx) return;\n\t\tthis.currentAbbrev = idx;\n\n\t\tfor (let entry of this.abbrevEntries)\n\t\t{\n\t\t\tentry.tr.setCSS('background-color', this.currentAbbrev == entry.idx ? colourCode(Theme.lowlight) : entry.bgcol);\n\t\t\tif (this.currentAbbrev == entry.idx) entry.tr.el.scrollIntoView({'block': 'nearest'});\n\t\t}\n\t}\n\n\t// move abbreviation selection up or down\n\tprivate cycleAbbreviation(dir:number):void\n\t{\n\t\tlet sz = this.abbrevIndices.length;\n\t\tif (sz == 0) return;\n\n\t\tlet idx = this.abbrevIndices.indexOf(this.currentAbbrev);\n\t\tif (idx < 0)\n\t\t{\n\t\t\tif (dir < 0) idx = sz - 1; else idx = 0;\n\t\t}\n\t\telse idx = (idx + sz + dir) % sz;\n\n\t\tthis.selectAbbreviation(this.abbrevIndices[idx]);\n\t}\n\n\tprivate selectedTab(idx:number):void\n\t{\n\t\tif (idx == 0) this.inputSymbol.grabFocus();\n\t\telse if (idx == 1) this.inputAbbrevSearch.grabFocus();\n\t\telse if (idx == 2) this.inputGeom1.grabFocus();\n\t}\n}\n\n","/*\n\tWebMolKit\n\n\t(c) 2010-2020 Molecular Materials Informatics, Inc.\n\n\tAll rights reserved\n\n\thttp://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Molecule} from '../data/Molecule';\nimport {Dialog} from '../dialog/Dialog';\nimport {ClipboardProxy, ClipboardProxyHandler} from '../ui/ClipboardProxy';\nimport {OptionList} from '../ui/OptionList';\nimport {TabBar} from '../ui/TabBar';\nimport {dom, DOM} from '../util/dom';\nimport {KeyCode, norm_xy} from '../util/util';\nimport {ExtraFieldsWidget} from './ExtraFieldsWidget';\nimport {GeomWidget, GeomWidgetSelection, GeomWidgetSelType, GeomWidgetType} from './GeomWidget';\nimport {ActivityType, MoleculeActivity, SketchState} from './MoleculeActivity';\nimport {QueryFieldsWidget} from './QueryFieldsWidget';\n\n/*\n\tOptions for editing a single bond within a molecule.\n*/\n\nexport class EditBond extends Dialog\n{\n\tpublic mol:Molecule; // copy of original: may or may not be different\n\n\tprivate initMol:Molecule;\n\tprivate btnApply:DOM;\n\tprivate tabs:TabBar;\n\n\tprivate optionOrder:OptionList;\n\tprivate optionStereo:OptionList;\n\tprivate inputFrom:DOM;\n\tprivate inputTo:DOM;\n\tprivate inputIndex:DOM;\n\n\tprivate inputGeom1:DOM;\n\tprivate geomWidget:GeomWidget;\n\tprivate refGeom1:string;\n\n\tprivate queryWidget:QueryFieldsWidget;\n\tprivate fieldsWidget:ExtraFieldsWidget;\n\n\tconstructor(mol:Molecule, public bond:number, private proxyClip:ClipboardProxy, private callbackApply:(source?:EditBond) => void)\n\t{\n\t\tsuper();\n\n\t\tthis.initMol = mol;\n\t\tthis.mol = mol.clone();\n\n\t\tthis.title = 'Edit Bond';\n\t\tthis.minPortionWidth = 20;\n\t\tthis.maxPortionWidth = 95;\n\t}\n\n\t// builds the dialog content\n\tprotected populate():void\n\t{\n\t\tthis.proxyClip.pushHandler(new ClipboardProxyHandler());\n\n\t\tlet buttons = this.buttonsDOM(), body = this.bodyDOM();\n\n\t\tthis.btnApply = dom('<button class=\"wmk-button wmk-button-primary\">Apply</button>').appendTo(buttons).css({'margin-left': '0.5em'});\n\t\tthis.btnApply.onClick(() => this.applyChanges());\n\n\t\tthis.tabs = new TabBar(['Bond', 'Geometry', 'Query', 'Extra']);\n\t\tthis.tabs.render(body);\n\t\tthis.tabs.onSelect((idx) => this.selectedTab(idx));\n\n\t\tthis.populateBond(this.tabs.getPanelDOM('Bond'));\n\t\tthis.populateGeometry(this.tabs.getPanelDOM('Geometry'));\n\t\tthis.populateQuery(this.tabs.getPanelDOM('Query'));\n\t\tthis.populateExtra(this.tabs.getPanelDOM('Extra'));\n\n\t\tlet focusable = body.findAll('input,textarea');\n\t\tif (focusable.length > 0) focusable[0].grabFocus(true);\n\t\tfor (let dom of focusable)\n\t\t{\n\t\t\tdom.css({'font': 'inherit'});\n\t\t\tdom.onKeyDown((event:KeyboardEvent) =>\n\t\t\t{\n\t\t\t\tif (event.key == KeyCode.Enter) this.applyChanges();\n\t\t\t\telse if (event.key == KeyCode.Escape) this.close();\n\t\t\t\telse if (event.key == KeyCode.PageUp)\n\t\t\t\t{\n\t\t\t\t\tthis.tabs.rotateSelected(-1);\n\t\t\t\t\tthis.selectedTab(this.tabs.getSelectedIndex());\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t}\n\t\t\t\telse if (event.key == KeyCode.PageDown)\n\t\t\t\t{\n\t\t\t\t\tthis.tabs.rotateSelected(1);\n\t\t\t\t\tthis.selectedTab(this.tabs.getSelectedIndex());\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t}\n\t\t\t\tevent.stopPropagation();\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic close():void\n\t{\n\t\tthis.proxyClip.popHandler();\n\t\tsuper.close();\n\t}\n\n\t// ------------ private methods ------------\n\n\t// trigger the apply/save sequence\n\tprivate applyChanges():void\n\t{\n\t\tthis.mol.keepTransient = true;\n\n\t\tthis.updateMolecule();\n\t\tif (this.tabs.getSelectedValue() == 'Geometry') this.updateGeometry();\n\t\tif (this.tabs.getSelectedValue() == 'Query') this.updateQuery();\n\t\tif (this.tabs.getSelectedValue() == 'Extra') this.updateExtra();\n\n\t\tthis.mol.keepTransient = false;\n\n\t\tif (this.callbackApply) this.callbackApply(this);\n\t}\n\n\tprivate populateBond(panel:DOM):void\n\t{\n\t\tconst {mol, bond} = this;\n\n\t\tlet grid = dom('<div/>').appendTo(panel);\n\t\tgrid.css({'display': 'grid', 'align-items': 'center', 'justify-content': 'start'});\n\t\tgrid.css({'grid-row-gap': '0.5em', 'grid-column-gap': '0.5em'});\n\t\tgrid.css({'grid-template-columns': '[start col0] auto [col1] auto [col2] auto [col3] auto [col4 end]'});\n\n\t\tdom('<div/>').appendTo(grid).css({'grid-area': '1 / col0'}).setText('Order');\n\t\tlet ordersHTML:string[] = [];\n\t\tfor (let o = 0; o <= 4; o++) ordersHTML.push(`&nbsp;&nbsp;${o}&nbsp;&nbsp;`);\n\t\tthis.optionOrder = new OptionList(ordersHTML);\n\t\tthis.optionOrder.htmlLabels = true;\n\t\tthis.optionOrder.setSelectedIndex(mol.bondOrder(bond));\n\t\tthis.optionOrder.render(dom('<div/>').appendTo(grid).css({'grid-column': 'col1 / col4', 'grid-row': '1'}));\n\n\t\tdom('<div/>').appendTo(grid).css({'grid-area': '2 / col0'}).setText('Stereo');\n\t\tthis.optionStereo = new OptionList(['None', 'Up', 'Down', 'Unknown']);\n\t\tthis.optionStereo.setSelectedIndex(mol.bondType(bond));\n\t\tthis.optionStereo.render(dom('<div/>').appendTo(grid).css({'grid-column': 'col1 / col4', 'grid-row': '2'}));\n\n\t\tdom('<div/>').appendTo(grid).css({'grid-area': '3 / col0'}).setText('From');\n\t\tthis.inputFrom = dom('<input size=\"6\"/>').appendTo(grid).css({'grid-area': '3 / col1', 'font': 'inherit'});\n\t\tthis.inputFrom.elInput.readOnly = true;\n\t\tthis.inputFrom.setValue(mol.bondFrom(bond).toString());\n\n\t\tdom('<div/>').appendTo(grid).css({'grid-area': '3 / col2'}).setText('To');\n\t\tthis.inputTo = dom('<input size=\"6\"/>').appendTo(grid).css({'grid-area': '3 / col3', 'font': 'inherit'});\n\t\tthis.inputTo.elInput.readOnly = true;\n\t\tthis.inputTo.setValue(mol.bondTo(bond).toString());\n\n\t\tdom('<div/>').appendTo(grid).css({'grid-area': '4 / col2'}).setText('Index');\n\t\tthis.inputIndex = dom('<input size=\"6\"/>').appendTo(grid).css({'grid-area': '4 / col3', 'font': 'inherit'});\n\t\tthis.inputIndex.elInput.readOnly = true;\n\t\tthis.inputIndex.setValue(bond.toString());\n\t}\n\n\tprivate populateGeometry(panel:DOM):void\n\t{\n\t\tconst {mol, bond} = this;\n\n\t\tlet divContainer1 = dom('<div/>').appendTo(panel).css({'text-align': 'center'});\n\t\tlet divContainer2 = dom('<div/>').appendTo(divContainer1).css({'display': 'inline-block'});\n\t\tlet grid = dom('<div/>').appendTo(divContainer2);\n\t\tgrid.css({'display': 'grid', 'align-items': 'center', 'justify-content': 'start'});\n\t\tgrid.css({'grid-row-gap': '0.5em', 'grid-column-gap': '0.5em'});\n\t\tgrid.css({'grid-template-columns': '[start col0] auto [col1] auto [col2]'});\n\n\t\tthis.geomWidget = new GeomWidget(GeomWidgetType.Bond, mol, bond);\n\t\tthis.geomWidget.render(dom('<div/>').appendTo(grid).css({'grid-area': '1 / col0 / auto / col2', 'text-align': 'center'}));\n\n\t\tlet label1 = dom('<div/>').appendTo(grid).css({'grid-area': '2 / col0'});\n\t\tthis.inputGeom1 = dom('<input type=\"number\" size=\"8\"/>').appendTo(grid).css({'grid-area': '2 / col1'});\n\n\t\tthis.geomWidget.callbackSelect = (sel:GeomWidgetSelection) =>\n\t\t{\n\t\t\tif (sel.type == GeomWidgetSelType.Link)\n\t\t\t{\n\t\t\t\tlet a1 = mol.bondFrom(bond), a2 = mol.bondTo(bond);\n\t\t\t\tlet dx = mol.atomX(a2) - mol.atomX(a1), dy = mol.atomY(a2) - mol.atomY(a1);\n\t\t\t\tlabel1.setText('Distance');\n\t\t\t\tthis.inputGeom1.setValue(this.refGeom1 = norm_xy(dx, dy).toFixed(3));\n\t\t\t}\n\t\t};\n\t\tthis.geomWidget.callbackSelect(this.geomWidget.selected); // trigger initial definition\n\t}\n\n\tprivate populateQuery(panel:DOM):void\n\t{\n\t\tthis.queryWidget = new QueryFieldsWidget(this.mol, 0, this.bond);\n\t\tthis.queryWidget.render(panel);\n\t}\n\n\tprivate populateExtra(panel:DOM):void\n\t{\n\t\tlet fields = [...this.mol.bondExtra(this.bond), ...this.mol.bondTransient(this.bond)];\n\t\tthis.fieldsWidget = new ExtraFieldsWidget(fields);\n\t\tthis.fieldsWidget.render(panel);\n\t}\n\n\t// read everything back in from the dialog objects\n\tprivate updateMolecule():void\n\t{\n\t\tlet {mol, bond} = this;\n\n\t\tmol.setBondOrder(bond, this.optionOrder.getSelectedIndex());\n\t\tmol.setBondType(bond, this.optionStereo.getSelectedIndex());\n\t}\n\n\tprivate updateGeometry():void\n\t{\n\t\tlet strval1 = this.inputGeom1.getValue();\n\t\tif (this.refGeom1 == strval1) return;\n\n\t\tconst {mol} = this;\n\t\tlet sel = this.geomWidget.selected, atoms = this.geomWidget.selectionAtoms(sel);\n\n\t\tif (sel.type == GeomWidgetSelType.Link)\n\t\t{\n\t\t\tif (this.refGeom1 != strval1)\n\t\t\t{\n\t\t\t\tlet dist = parseFloat(strval1);\n\t\t\t\tif (isNaN(dist) || Math.abs(dist) > 100) return; // non-sane\n\t\t\t\tlet instate:SketchState = {mol, currentAtom: 0, currentBond: mol.findBond(atoms[0], atoms[1]), selectedMask: null};\n\t\t\t\tlet molact = new MoleculeActivity(instate, ActivityType.BondDist, {dist});\n\t\t\t\tmolact.execute();\n\t\t\t\tthis.mol = molact.output.mol;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate updateQuery():void\n\t{\n\t\tthis.queryWidget.updateBond();\n\t}\n\n\tprivate updateExtra():void\n\t{\n\t\tthis.mol.setBondExtra(this.bond, this.fieldsWidget.getExtraFields());\n\t\tthis.mol.setBondTransient(this.bond, this.fieldsWidget.getTransientFields());\n\t}\n\n\tprivate selectedTab(idx:number):void\n\t{\n\t\tif (idx == 0) this.inputFrom.grabFocus();\n\t\telse if (idx == 1) this.inputGeom1.grabFocus();\n\t}\n}\n\n","/*\n\tWebMolKit\n\n\t(c) 2010-2020 Molecular Materials Informatics, Inc.\n\n\tAll rights reserved\n\n\thttp://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Molecule} from '../data/Molecule';\nimport {MolUtil} from '../data/MolUtil';\nimport {PolymerBlock, PolymerBlockConnectivity, PolymerBlockUnit} from '../data/PolymerBlock';\nimport {Dialog} from '../dialog/Dialog';\nimport {OutlineMeasurement} from '../gfx/ArrangeMeasurement';\nimport {ArrangeMolecule} from '../gfx/ArrangeMolecule';\nimport {DrawMolecule} from '../gfx/DrawMolecule';\nimport {MetaVector} from '../gfx/MetaVector';\nimport {RenderEffects, RenderPolicy} from '../gfx/Rendering';\nimport {ClipboardProxy, ClipboardProxyHandler} from '../ui/ClipboardProxy';\nimport {OptionList} from '../ui/OptionList';\nimport {dom, DOM} from '../util/dom';\nimport {Vec} from '../util/Vec';\n\n/*\n\tEditing a new or existing polymer block.\n*/\n\nconst CHAR_LOW_A = 'a'.charCodeAt(0), CHAR_UP_A = 'A'.charCodeAt(0);\nfunction indexToAtomLabel(idx:number):string {return String.fromCharCode(CHAR_UP_A + Math.min(26, Math.max(0, idx)) - 1);}\nfunction indexToBondLabel(idx:number):string {return String.fromCharCode(CHAR_LOW_A + Math.min(26, Math.max(0, idx)) - 1);}\n\nexport class EditPolymer extends Dialog\n{\n\tpublic mol:Molecule; // copy of original: may or may not be different\n\n\tprivate initMol:Molecule;\n\tprivate btnApply:DOM;\n\tprivate btnRemove:DOM;\n\tprivate optionConnect:OptionList = null;\n\tprivate optionBondConn:OptionList = null;\n\tprivate divPreview:DOM;\n\n\tprivate polymer:PolymerBlock;\n\tprivate currentID = 0;\n\tprivate unit:PolymerBlockUnit = null;\n\n\tprivate borderAtoms:number[] = []; // subset of atoms that have a bond going to the outside\n\tprivate outBonds:number[] = []; // list of bonds going to the outside\n\tprivate outAtoms:number[] = []; // sorted in same order as bonds\n\n\tprivate umap:number[];\n\tprivate umol:Molecule;\n\n\tconstructor(mol:Molecule, public atoms:number[], private proxyClip:ClipboardProxy, private callbackApply:(source?:EditPolymer) => void)\n\t{\n\t\tsuper();\n\n\t\tthis.initMol = mol;\n\t\tthis.mol = mol.clone();\n\n\t\tthis.title = 'Polymer Block';\n\t\tthis.minPortionWidth = 20;\n\t\tthis.maxPortionWidth = 95;\n\n\t\tthis.polymer = new PolymerBlock(this.mol);\n\t\tatoms = Vec.sorted(atoms);\n\n\t\tfor (let id of this.polymer.getIDList())\n\t\t{\n\t\t\tlet look = this.polymer.getUnit(id);\n\t\t\tif (Vec.equals(atoms, look.atoms))\n\t\t\t{\n\t\t\t\tthis.currentID = id;\n\t\t\t\tthis.unit = look;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (!this.unit) this.unit = new PolymerBlockUnit(atoms);\n\n\t\tlet umol = this.umol = this.mol.clone();\n\t\tlet mask = Vec.booleanArray(false, this.umol.numAtoms);\n\t\tfor (let n = 1; n <= this.mol.numBonds; n++)\n\t\t{\n\t\t\tlet bfr = this.mol.bondFrom(n), bto = this.mol.bondTo(n);\n\t\t\tlet in1 = this.atoms.includes(bfr), in2 = this.atoms.includes(bto);\n\t\t\tif (in1 || in2) mask[bfr - 1] = mask[bto - 1] = true;\n\t\t\tif (in1 && !in2)\n\t\t\t{\n\t\t\t\tthis.borderAtoms.push(bfr);\n\t\t\t\tthis.outBonds.push(n);\n\t\t\t\tthis.outAtoms.push(bto);\n\t\t\t}\n\t\t\tif (in2 && !in1)\n\t\t\t{\n\t\t\t\tthis.borderAtoms.push(bto);\n\t\t\t\tthis.outBonds.push(n);\n\t\t\t\tthis.outAtoms.push(bfr);\n\t\t\t}\n\t\t}\n\t\tthis.borderAtoms = Vec.sortedUnique(this.borderAtoms);\n\n\t\tthis.umap = Vec.maskMap(mask);\n\t\tthis.umol = MolUtil.subgraphMask(this.umol, mask);\n\t\tnew PolymerBlock(this.umol).removeAll();\n\t}\n\n\t// builds the dialog content\n\tprotected populate():void\n\t{\n\t\tthis.proxyClip.pushHandler(new ClipboardProxyHandler());\n\n\t\tlet buttons = this.buttonsDOM(), body = this.bodyDOM();\n\n\t\tthis.btnApply = dom('<button class=\"wmk-button wmk-button-primary\">Apply</button>').appendTo(buttons).css({'margin-left': '0.5em'});\n\t\tif (this.currentID == 0) this.btnApply.setText('Create');\n\t\tthis.btnApply.onClick(() => this.applyChanges());\n\n\t\tif (this.currentID > 0)\n\t\t{\n\t\t\tthis.btnRemove = dom('<button class=\"wmk-button wmk-button-default\">Remove</button>').appendTo(buttons).css({'margin-left': '0.5em'});\n\t\t\tthis.btnRemove.onClick(() => this.applyRemove());\n\t\t}\n\n\t\tlet grid = dom('<div/>').appendTo(body);\n\t\tgrid.css({'display': 'grid', 'align-items': 'center', 'justify-content': 'start'});\n\t\tgrid.css({'grid-row-gap': '0.5em', 'grid-column-gap': '0.5em'});\n\t\tgrid.css({'grid-template-columns': '[start col0] auto [col1] auto [col2] auto [col3] auto [col4] auto [end]'});\n\n\t\tdom('<div/>').appendTo(grid).css({'grid-area': '1 / col0'}).setText('# Atoms');\n\t\tlet inputNAtoms = dom('<input size=\"5\"/>').appendTo(dom('<div/>').appendTo(grid).css({'grid-area': '1 / col1'}));\n\t\tinputNAtoms.elInput.readOnly = true;\n\t\tinputNAtoms.setValue(this.unit.atoms.length.toString());\n\n\t\tdom('<div/>').appendTo(grid).css({'grid-area': '1 / col2'}).setText('Out-bonds');\n\t\tlet inputNBond = dom('<input size=\"5\"/>').appendTo(dom('<div/>').appendTo(grid).css({'grid-area': '1 / col3'}));\n\t\tinputNBond.elInput.readOnly = true;\n\t\tinputNBond.setValue(this.outBonds.length.toString());\n\n\t\tlet row = 1;\n\t\tif (this.outBonds.length == 2)\n\t\t{\n\t\t\trow++;\n\t\t\tdom('<div/>').appendTo(grid).css({'grid-area': `${row} / col0`}).setText('Connectivity');\n\t\t\tthis.optionConnect = new OptionList(['Unknown', 'Head-to-Tail', 'Head-to-Head', 'Random']);\n\t\t\tthis.optionConnect.render(dom('<div/>').appendTo(grid).css({'grid-area': `${row} / col1 / auto / col4`}));\n\t\t\tif (this.unit.connect == PolymerBlockConnectivity.HeadToTail) this.optionConnect.setSelectedIndex(1);\n\t\t\telse if (this.unit.connect == PolymerBlockConnectivity.HeadToHead) this.optionConnect.setSelectedIndex(2);\n\t\t\telse if (this.unit.connect == PolymerBlockConnectivity.Random) this.optionConnect.setSelectedIndex(3);\n\t\t}\n\t\tif (this.outBonds.length == 4 && Vec.uniqueUnstable(this.outAtoms).length == 4)\n\t\t{\n\t\t\trow++;\n\t\t\tdom('<div/>').appendTo(grid).css({'grid-area': `${row} / col0`}).setText('2x2 Connectivity');\n\t\t\tthis.populate2x2Conn(dom('<div/>').appendTo(grid).css({'grid-area': `${row} / col1 / auto / end`}));\n\t\t}\n\n\t\tlet getList = (str:string):number[] =>\n\t\t{\n\t\t\tif (!str) return null;\n\t\t\tlet list:number[] = [];\n\t\t\tfor (let bit of str.split(','))\n\t\t\t{\n\t\t\t\tlet v = parseInt(bit);\n\t\t\t\tif (v > 0) list.push(v); else return undefined;\n\t\t\t}\n\t\t\treturn list;\n\t\t};\n\n\t\tfor (let n = 0; n < this.borderAtoms.length; n++)\n\t\t{\n\t\t\trow++;\n\t\t\tlet domLabel = dom('<div/>').appendTo(grid).css({'grid-area': `${row} / col0`, 'text-align': 'right', 'padding-right': '0.5em'});\n\t\t\tif (n == 0) domLabel.setText('Name ');\n\t\t\tdom('<span/>').appendTo(domLabel).css({'color': '#008000'}).setText(indexToAtomLabel(n + 1));\n\t\t\tlet input = dom('<input size=\"20\"/>').appendTo(dom('<div/>').appendTo(grid).css({'grid-area': `${row} / col1 / auto / end`, 'width': '100%'}));\n\n\t\t\tlet atom = this.borderAtoms[n];\n\t\t\tlet nvals = this.unit.atomName.get(atom);\n\t\t\tif (nvals) input.setValue(nvals.join(','));\n\t\t\tinput.onInput(() =>\n\t\t\t{\n\t\t\t\tlet list = getList(input.getValue());\n\t\t\t\tif (list !== undefined) this.unit.atomName.set(atom, list);\n\t\t\t});\n\t\t}\n\t\tfor (let n = 0; n < this.outAtoms.length; n++)\n\t\t{\n\t\t\trow++;\n\t\t\tlet domLabel = dom('<div/>').appendTo(grid).css({'grid-area': `${row} / col0`, 'text-align': 'right', 'padding-right': '0.5em'});\n\t\t\tif (n == 0) domLabel.setText('Link ');\n\t\t\tdom('<span/>').appendTo(domLabel).css({'color': '#800080'}).setText(indexToBondLabel(n + 1));\n\t\t\tdom('<div/>').appendTo(grid).css({'grid-area': `${row} / col1`}).setText('Include');\n\t\t\tlet inputIncl = dom('<input size=\"10\"/>').appendTo(dom('<div/>').appendTo(grid).css({'grid-area': `${row} / col2`, 'width': '100%'}));\n\t\t\tdom('<div/>').appendTo(grid).css({'grid-area': `${row} / col3`}).setText('Exclude');\n\t\t\tlet inputExcl = dom('<input size=\"10\"/>').appendTo(dom('<div/>').appendTo(grid).css({'grid-area': `${row} / col4`, 'width': '100%'}));\n\n\t\t\tlet bond = this.outBonds[n];\n\t\t\tlet ivals = this.unit.bondIncl.get(bond), evals = this.unit.bondExcl.get(bond);\n\t\t\tif (ivals) inputIncl.setValue(ivals.join(','));\n\t\t\tif (evals) inputExcl.setValue(evals.join(','));\n\t\t\tinputIncl.onInput(() =>\n\t\t\t{\n\t\t\t\tlet list = getList(inputIncl.getValue());\n\t\t\t\tif (list !== undefined) this.unit.bondIncl.set(bond, list);\n\t\t\t});\n\t\t\tinputExcl.onInput(() =>\n\t\t\t{\n\t\t\t\tlet list = getList(inputExcl.getValue());\n\t\t\t\tif (list !== undefined) this.unit.bondExcl.set(bond, list);\n\t\t\t});\n\t\t}\n\n\t\trow++;\n\t\tthis.populateUncap(dom('<div/>').appendTo(grid).css({'grid-area': `${row} / col0 / auto / col4`, 'text-align': 'center'}));\n\n\t\trow++;\n\t\tthis.divPreview = dom('<div/>').appendTo(grid).css({'grid-area': `${row} / col0 / auto / col4`, 'text-align': 'center'});\n\t\tthis.renderUnit();\n\n\t\tlet focusable = body.findAll('input,textarea');\n\t\tif (focusable.length > 0) focusable[0].grabFocus(true);\n\t\tfor (let dom of focusable)\n\t\t{\n\t\t\tdom.css({'font': 'inherit'});\n\t\t\tdom.onKeyDown((event:KeyboardEvent) =>\n\t\t\t{\n\t\t\t\tlet keyCode = event.keyCode || event.which;\n\t\t\t\tif (keyCode == 13) this.applyChanges();\n\t\t\t\tif (keyCode == 27) this.close();\n\t\t\t});\n\t\t}\n\n\t\t//setTimeout(() => inputNAtoms.focus(), 1);\n\t}\n\n\tpublic close():void\n\t{\n\t\tthis.proxyClip.popHandler();\n\t\tsuper.close();\n\t}\n\n\t// ------------ private methods ------------\n\n\tprivate populate2x2Conn(div:DOM):void\n\t{\n\t\tconst perms = [[0, 1, 2, 3], [0, 1, 3, 2], [0, 2, 1, 3], [0, 2, 3, 1], [0, 3, 1, 2], [0, 3, 2, 1]];\n\n\t\tlet bondConnOptions:number[][] = [null];\n\t\tlet optionList = ['None'];\n\t\tlet selidx = 0;\n\t\tfor (let perm of perms)\n\t\t{\n\t\t\tlet bonds = Vec.idxGet(this.outBonds, perm);\n\t\t\tif (Vec.equals(bonds, this.unit.bondConn)) selidx = optionList.length;\n\t\t\tbondConnOptions.push(bonds);\n\t\t\t//optionList.push(`${this.outAtoms[perm[0]]},${this.outAtoms[perm[1]]}:${this.outAtoms[perm[2]]},${this.outAtoms[perm[3]]}`);\n\t\t\toptionList.push(`${perm[0] + 1},${perm[1] + 1}:${perm[2] + 1},${perm[3] + 1}`);\n\t\t}\n\n\t\tthis.optionBondConn = new OptionList(optionList);\n\t\tthis.optionBondConn.setSelectedIndex(selidx);\n\t\tthis.optionBondConn.render(div);\n\t\tthis.optionBondConn.onSelect((idx) =>\n\t\t{\n\t\t\tthis.unit.bondConn = bondConnOptions[idx];\n\t\t\tthis.renderUnit();\n\t\t});\n\t}\n\n\t// list out each outgoing atom that's terminal and could be converted into '*': if any, make a button for that\n\tprivate populateUncap(div:DOM):void\n\t{\n\t\tlet uncapAtoms:number[] = [];\n\t\tskip: for (let a of this.outAtoms) if (this.mol.atomAdjCount(a) == 1 && this.mol.atomElement(a) != '*')\n\t\t{\n\t\t\tfor (let unit of this.polymer.getUnits()) if (unit.atoms.includes(a)) continue skip;\n\t\t\tuncapAtoms.push(a);\n\t\t}\n\t\tif (uncapAtoms.length == 0) return;\n\n\t\tlet btnUncap = dom('<button class=\"wmk-button wmk-button-default\">Uncap Exterior</button>').appendTo(div);\n\t\tbtnUncap.onClick(() =>\n\t\t{\n\t\t\tbtnUncap.elInput.disabled = true;\n\t\t\tfor (let a of uncapAtoms) this.mol.setAtomElement(a, '*');\n\t\t});\n\t}\n\n\t// trigger the apply/save sequence\n\tprivate applyChanges():void\n\t{\n\t\tif (this.optionConnect)\n\t\t{\n\t\t\tlet sel = this.optionConnect.getSelectedIndex();\n\t\t\tif (sel == 0) this.unit.connect = null;\n\t\t\telse if (sel == 1) this.unit.connect = PolymerBlockConnectivity.HeadToTail;\n\t\t\telse if (sel == 2) this.unit.connect = PolymerBlockConnectivity.HeadToHead;\n\t\t\telse if (sel == 3) this.unit.connect = PolymerBlockConnectivity.Random;\n\t\t}\n\n\t\tif (this.currentID) this.polymer.removeUnit(this.currentID);\n\n\t\tthis.currentID = this.polymer.createUnit(this.unit.clone());\n\n\t\tthis.polymer.rewriteMolecule(); // housekeeping\n\t\tthis.callbackApply(this);\n\t}\n\n\tprivate applyRemove():void\n\t{\n\t\tif (this.currentID) this.polymer.removeUnit(this.currentID);\n\t\tthis.callbackApply(this);\n\t}\n\n\tprivate renderUnit():void\n\t{\n\t\tlet umol = this.umol.clone();\n\n\t\tlet policy = RenderPolicy.defaultColourOnWhite(20);\n\t\tlet measure = new OutlineMeasurement(0, 0, policy.data.pointScale);\n\n\t\tlet effects = new RenderEffects();\n\t\teffects.atomCircleSz = Vec.numberArray(0, umol.numAtoms);\n\t\teffects.atomCircleCol = Vec.numberArray(0, umol.numAtoms);\n\t\teffects.atomDecoText = Vec.stringArray(null, umol.numAtoms);\n\t\teffects.atomDecoCol = Vec.numberArray(null, umol.numAtoms);\n\t\teffects.atomDecoSize = Vec.numberArray(null, umol.numAtoms);\n\n\t\tlet borderAtoms = this.borderAtoms.map((atom) => this.umap[atom - 1] + 1);\n\t\tlet outAtoms = this.outAtoms.map((atom) => this.umap[atom - 1] + 1);\n\n\t\tfor (let n = 1; n <= umol.numAtoms; n++)\n\t\t{\n\t\t\tlet bidx = borderAtoms.indexOf(n), oidx = outAtoms.indexOf(n);\n\t\t\tif (bidx >= 0)\n\t\t\t{\n\t\t\t\teffects.atomDecoText[n - 1] = indexToAtomLabel(bidx + 1); //(bidx + 1).toString();\n\t\t\t\teffects.atomDecoCol[n - 1] = 0x008000;\n\t\t\t\teffects.atomDecoSize[n - 1] = 0.5;\n\t\t\t}\n\t\t\tif (oidx >= 0)\n\t\t\t{\n\t\t\t\tumol.setAtomCharge(n, 0);\n\t\t\t\tumol.setAtomUnpaired(n, 0);\n\t\t\t\tumol.setAtomIsotope(n, 0);\n\t\t\t\teffects.atomCircleSz[n - 1] = 0.1;\n\t\t\t\teffects.atomCircleCol[n - 1] = 0xFF00FF;\n\t\t\t\teffects.atomDecoText[n - 1] = indexToBondLabel(oidx + 1); //(oidx + 1).toString();\n\t\t\t\teffects.atomDecoCol[n - 1] = 0x800080;\n\t\t\t\teffects.atomDecoSize[n - 1] = 0.5;\n\t\t\t\tumol.setAtomElement(n, 'C');\n\t\t\t}\n\t\t}\n\t\tlet layout = new ArrangeMolecule(umol, measure, policy, effects);\n\t\tlayout.arrange();\n\t\tlayout.squeezeInto(0, 0, 300, 300);\n\t\tlet gfx = new MetaVector();\n\n\t\tif (this.unit.bondConn)\n\t\t{\n\t\t\tconst LINES:[number, number, number, number, boolean][] =\n\t\t\t[\n\t\t\t\t[0, 1, 0xC86D08, 2, false], [2, 3, 0xC86D08, 2, false],\n\t\t\t\t[0, 2, 0xC0C86D08, 1, true], [1, 3, 0xC0C86D08, 1, true]\n\t\t\t];\n\t\t\tfor (let [i1, i2, col, sz, circle] of LINES)\n\t\t\t{\n\t\t\t\tlet a1 = this.outAtoms[this.outBonds.indexOf(this.unit.bondConn[i1])];\n\t\t\t\tlet a2 = this.outAtoms[this.outBonds.indexOf(this.unit.bondConn[i2])];\n\t\t\t\tlet p1 = layout.getPoint(a1 - 1), p2 = layout.getPoint(a2 - 1);\n\t\t\t\tgfx.drawLine(p1.oval.cx, p1.oval.cy, p2.oval.cx, p2.oval.cy, col, sz);\n\t\t\t\tif (circle)\n\t\t\t\t{\n\t\t\t\t\tfor (let f of [0.2, 0.4, 0.6, 0.8])\n\t\t\t\t\t{\n\t\t\t\t\t\tlet mx = p1.oval.cx + f * (p2.oval.cx - p1.oval.cx), my = p1.oval.cy + f * (p2.oval.cy - p1.oval.cy);\n\t\t\t\t\t\tgfx.drawOval(mx, my, 2, 2, col, sz, null);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tnew DrawMolecule(layout, gfx).draw();\n\n\t\tgfx.normalise();\n\n\t\tthis.divPreview.empty();\n\t\tdom(gfx.createSVG()).appendTo(this.divPreview).css({'pointer-events': 'none'});\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {ButtonBank, ButtonBankItem} from '../ui/ButtonBank';\n\n/*\n\tToolBank: buttons for the Sketcher main command bank.\n*/\n\nexport enum ToolBankItem\n{\n\tArrow = 'arrow',\n\tRotate = 'rotate',\n\tPan = 'pan',\n\tDrag = 'drag',\n\tErasor = 'erasor',\n\tBondOrder0 = 'bond:Order0',\n\tBondOrder1 = 'bond:Order1',\n\tBondOrder2 = 'bond:Order2',\n\tBondOrder3 = 'bond:Order3',\n\tBondUnknown = 'bond:Unknown',\n\tBondInclined = 'bond:Inclined',\n\tBondDeclined = 'bond:Declined',\n\tRingAliph = 'ringAliph',\n\tRingArom = 'ringArom',\n\tAtomPlus = 'atomPlus',\n\tAtomMinus = 'atomMinus',\n\n\tBondPfx = 'bond:',\n\tElementPfx = 'element:',\n}\n\nconst TOOLS_MAIN:ButtonBankItem[] =\n[\n\t{id: ToolBankItem.Arrow, imageFN: 'ToolSelect', helpText: 'Selection tool.', mnemonic: 'Escape'},\n\t{id: ToolBankItem.Rotate, imageFN: 'ToolRotate', helpText: 'Rotate subject atoms.', mnemonic: ''},\n\t{id: ToolBankItem.Pan, imageFN: 'ToolPan', helpText: 'Pan the viewport around the screen.', mnemonic: ''},\n\t{id: ToolBankItem.Drag, imageFN: 'ToolDrag', helpText: 'Drag selected atoms to new positions.', mnemonic: ''},\n\t{id: ToolBankItem.Erasor, imageFN: 'ToolErasor', helpText: 'Delete atoms or bonds by selecting.', mnemonic: 'Delete'},\n\t{id: ToolBankItem.BondOrder0, imageFN: 'BondZero', helpText: 'Create or change a bond to zero order.', mnemonic: 'Shift+0', 'key': ')'},\n\t{id: ToolBankItem.BondOrder1, imageFN: 'BondOne', helpText: 'Create or change a bond to single.', mnemonic: 'Shift+1', 'key': '!'},\n\t{id: ToolBankItem.BondOrder2, imageFN: 'BondTwo', helpText: 'Create or change a bond to double.', mnemonic: 'Shift+2', 'key': '@'},\n\t{id: ToolBankItem.BondOrder3, imageFN: 'BondThree', helpText: 'Create or change a bond to triple.', mnemonic: 'Shift+3', 'key': '#'},\n\t{id: ToolBankItem.BondUnknown, imageFN: 'BondSquig', helpText: 'Create or change a bond to unknown stereochemistry.', mnemonic: 'Shift+4', 'key': '$'},\n\t{id: ToolBankItem.BondInclined, imageFN: 'BondUp', helpText: 'Create or change a bond to up-wedge.', mnemonic: 'Shift+5', 'key': '%'},\n\t{id: ToolBankItem.BondDeclined, imageFN: 'BondDown', helpText: 'Create or change a bond to down-wedge.', mnemonic: 'Shift+6', 'key': '^'},\n\t{id: ToolBankItem.RingAliph, imageFN: 'ToolRing', helpText: 'Create plain ring.', mnemonic: 'Shift+7', 'key': '&'},\n\t{id: ToolBankItem.RingArom, imageFN: 'ToolArom', helpText: 'Create aromatic ring.', mnemonic: 'Shift+8', 'key': '*'},\n\t{id: ToolBankItem.AtomPlus, imageFN: 'AtomPlus', helpText: 'Increase charge on atom.', mnemonic: ''},\n\t{id: ToolBankItem.AtomMinus, imageFN: 'AtomMinus', helpText: 'Decrease charge on atom.', mnemonic: ''},\n\t{id: ToolBankItem.ElementPfx + 'C', 'text': 'C', helpText: 'Change elements to Carbon.', mnemonic: ''},\n\t{id: ToolBankItem.ElementPfx + 'N', 'text': 'N', helpText: 'Change elements to Nitrogen.', mnemonic: ''},\n\t{id: ToolBankItem.ElementPfx + 'O', 'text': 'O', helpText: 'Change elements to Oxygen.', mnemonic: ''},\n\t{id: ToolBankItem.ElementPfx + 'S', 'text': 'S', helpText: 'Change elements to Sulfur.', mnemonic: ''},\n\t{id: ToolBankItem.ElementPfx + 'P', 'text': 'P', helpText: 'Change elements to Phosphorus.', mnemonic: ''},\n\t{id: ToolBankItem.ElementPfx + 'H', 'text': 'H', helpText: 'Change elements to Hydrogen.', mnemonic: ''},\n\t{id: ToolBankItem.ElementPfx + 'F', 'text': 'F', helpText: 'Change elements to Fluorine.', mnemonic: ''},\n\t{id: ToolBankItem.ElementPfx + 'Cl', 'text': 'Cl', helpText: 'Change elements to Chlorine.', mnemonic: ''},\n\t{id: ToolBankItem.ElementPfx + 'Br', 'text': 'Br', helpText: 'Change elements to Bromine.', mnemonic: ''},\n\t{id: ToolBankItem.ElementPfx + 'A', 'text': 'A', helpText: 'Pick other element.', mnemonic: ''}\n];\n\nexport class ToolBank extends ButtonBank\n{\n\tconstructor(protected owner:any)\n\t{\n\t\tsuper();\n\t}\n\n\t// populate the buttons\n\tpublic update():void\n\t{\n\t\tfor (let btn of TOOLS_MAIN) this.buttons.push(btn);\n\n\t\tthis.buttonView.setSelectedButton('arrow');\n\t}\n\n\t// react to a button click\n\tpublic hitButton(id:string):void\n\t{\n\t\tthis.buttonView.setSelectedButton(id);\n\t}\n\n\tpublic claimKey(event:KeyboardEvent):boolean\n\t{\n\t\t//let ch = String.fromCharCode(event.keyCode || event.charCode);\n\t\t//console.log('Claim/Command['+ch+'] key='+event.keyCode+' chcode='+event.charCode);\n\n\t\tfor (let item of TOOLS_MAIN)\n\t\t{\n\t\t\tif (ButtonBank.matchKey(event, item.mnemonic, item.key))\n\t\t\t{\n\t\t\t\tthis.hitButton(item.id);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {TEMPLATE_FILES} from '../data/AbbrevContainer';\nimport {DataSheet, DataSheetColumn} from '../data/DataSheet';\nimport {DataSheetStream} from '../data/DataSheetStream';\nimport {MolUtil} from '../data/MolUtil';\nimport {OutlineMeasurement} from '../gfx/ArrangeMeasurement';\nimport {ArrangeMolecule} from '../gfx/ArrangeMolecule';\nimport {DrawMolecule} from '../gfx/DrawMolecule';\nimport {MetaVector} from '../gfx/MetaVector';\nimport {RenderEffects, RenderPolicy} from '../gfx/Rendering';\nimport {ButtonBank} from '../ui/ButtonBank';\nimport {Theme} from '../util/Theme';\nimport {readTextURL} from '../util/util';\nimport {ActivityType, MoleculeActivity} from './MoleculeActivity';\n\n/*\n\tTemplateBank: template list... either the top-level list of template groups, or a single folder full of templates.\n*/\n\ninterface GroupTemplates\n{\n\tgroups:string[];\n\ttitles:string[];\n\tpreview:any[];\n}\n\ninterface TemplateStructs\n{\n\tmolecules:string[];\n\tnames:string[];\n\tabbrev:string[];\n\tmnemonic:string[];\n\tpreview:MetaVector[];\n}\n\nexport class TemplateBank extends ButtonBank\n{\n\tprivate static resourceList:string[] = [];\n\tprivate static resourceData:DataSheet[] = []; // templates are derived from these\n\tprivate subgroups:GroupTemplates = null;\n\tprivate templates:TemplateStructs = null;\n\n\tconstructor(protected owner:any, protected group?:string)\n\t{\n\t\tsuper();\n\t}\n\n\tpublic init()\n\t{\n\t\tlet policy = RenderPolicy.defaultBlackOnWhite();\n\t\tpolicy.data.pointScale = 10;\n\t\tpolicy.data.lineSize *= 1.5;\n\t\tpolicy.data.bondSep *= 1.5;\n\n\t\t(async () =>\n\t\t{\n\t\t\tif (TemplateBank.resourceData.length == 0) await this.loadResourceData();\n\n\t\t\tif (this.group == null)\n\t\t\t\tthis.prepareSubGroups();\n\t\t\telse\n\t\t\t\tthis.prepareTemplates();\n\t\t})();\n\t}\n\n\t// populate the buttons\n\tpublic update():void\n\t{\n\t\tif (this.subgroups == null && this.templates == null) return;\n\n\t\tthis.buttons = [];\n\n\t\tif (this.group == null)\n\t\t\tthis.populateGroups();\n\t\telse\n\t\t\tthis.populateTemplates();\n\t}\n\n\t// build a list of template groups, based on the webservice results\n\tprivate populateGroups():void\n\t{\n\t\tlet groups = this.subgroups.groups, titles = this.subgroups.titles, preview = this.subgroups.preview;\n\n\t\tfor (let n = 0; n < groups.length; n++)\n\t\t{\n\t\t\tthis.buttons.push({id: groups[n], metavec: preview[n], helpText: titles[n]});\n\t\t}\n\t}\n\n\t// build a list of template structures, based on the webservice results\n\tprivate populateTemplates():void\n\t{\n\t\tlet names = this.templates.names, abbrev = this.templates.abbrev, mnemonic = this.templates.mnemonic, preview = this.templates.preview;\n\n\t\tfor (let n = 0 ; n < names.length; n++)\n\t\t{\n\t\t\tthis.buttons.push({id: n.toString(), metavec: preview[n], helpText: names[n]});\n\t\t\t// !! do something with abbrev & mnemonic\n\t\t}\n\t}\n\n\t// react to a button click\n\tpublic hitButton(id:string)\n\t{\n\t\tif (this.group == null)\n\t\t{\n\t\t\tthis.buttonView.pushBank(new TemplateBank(this.owner, id));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet idx = parseInt(id);\n\t\t\tlet param = {fragNative: this.templates.molecules[idx]};\n\t\t\tnew MoleculeActivity(this.owner.getState(), ActivityType.TemplateFusion, param, this.owner).execute();\n\t\t}\n\t}\n\n\t// loads up the resource datasheets one at a time, and stashes them in the static container\n\tprivate async loadResourceData():Promise<void>\n\t{\n\t\tfor (let fn of TEMPLATE_FILES)\n\t\t{\n\t\t\tlet url = Theme.RESOURCE_URL + '/data/templates/' + fn + '.ds';\n\t\t\tlet dsstr = await readTextURL(url);\n\t\t\tTemplateBank.resourceList.push(fn);\n\t\t\tTemplateBank.resourceData.push(DataSheetStream.readXML(dsstr));\n\t\t}\n\t}\n\n\t// use the resource data to prepare button icons for the template groups\n\tprivate prepareSubGroups():void\n\t{\n\t\tthis.subgroups = {groups: TemplateBank.resourceList, titles: [], preview: []};\n\t\tlet sz = this.buttonView.idealSize, msz = 0.5 * (sz - 2);\n\n\t\tlet policy = RenderPolicy.defaultBlackOnWhite();\n\t\tpolicy.data.pointScale = 10;\n\t\tlet effects = new RenderEffects();\n\t\tlet measure = new OutlineMeasurement(0, 0, policy.data.pointScale);\n\n\t\tfor (let ds of TemplateBank.resourceData)\n\t\t{\n\t\t\tthis.subgroups.titles.push(ds.title);\n\n\t\t\tlet colMol = ds.firstColOfType(DataSheetColumn.Molecule);\n\t\t\tlet metavec = new MetaVector();\n\n\t\t\tfor (let n = 0, idx = 0; idx < 4 && n < ds.numRows; n++)\n\t\t\t{\n\t\t\t\tlet mol = ds.getMolecule(n, colMol);\n\t\t\t\tif (MolUtil.isBlank(mol)) continue;\n\n\t\t\t\tlet layout = new ArrangeMolecule(mol, measure, policy, effects);\n\t\t\t\tlayout.arrange();\n\t\t\t\tlet col = (idx % 2), row = Math.floor(idx / 2);\n\t\t\t\tlayout.squeezeInto(1 + col * msz, 1 + row * msz, msz, msz, 1);\n\t\t\t\tnew DrawMolecule(layout, metavec).draw();\n\n\t\t\t\tidx++;\n\t\t\t}\n\t\t\tmetavec.width = sz;\n\t\t\tmetavec.height = sz;\n\n\t\t\tthis.subgroups.preview.push(metavec);\n\t\t}\n\t\tthis.buttonView.refreshBank();\n\t}\n\n\t// use the resource data to prepare pictures for each of the templates\n\tprivate prepareTemplates():void\n\t{\n\t\tlet idx = TemplateBank.resourceList.indexOf(this.group);\n\t\tlet ds = TemplateBank.resourceData[idx];\n\n\t\tthis.templates = {molecules: [], names: [], abbrev: [], mnemonic: [], preview: []};\n\n\t\tlet sz = this.buttonView.idealSize;\n\n\t\tlet policy = RenderPolicy.defaultBlackOnWhite();\n\t\tpolicy.data.pointScale = 12;\n\t\tlet effects = new RenderEffects();\n\t\tlet measure = new OutlineMeasurement(0, 0, policy.data.pointScale);\n\n\t\tlet colMol = ds.findColByName('Molecule');\n\t\tlet colName = ds.findColByName('Name');\n\t\tlet colAbbrev = ds.findColByName('Abbrev');\n\t\tlet colMnemonic = ds.findColByName('Mnemonic');\n\n\t\tfor (let n = 0; n < ds.numRows; n++)\n\t\t{\n\t\t\tlet mol = ds.getMolecule(n, colMol);\n\t\t\tthis.templates.molecules.push(mol.toString());\n\t\t\tthis.templates.names.push(ds.getString(n, colName));\n\t\t\tthis.templates.abbrev.push(ds.getString(n, colAbbrev));\n\t\t\tthis.templates.mnemonic.push(ds.getString(n, colMnemonic));\n\n\t\t\tlet layout = new ArrangeMolecule(mol, measure, policy, effects);\n\t\t\tlayout.arrange();\n\t\t\tlayout.squeezeInto(0, 0, sz, sz, 2);\n\t\t\tlet metavec = new MetaVector();\n\t\t\tnew DrawMolecule(layout, metavec).draw();\n\t\t\tmetavec.width = sz;\n\t\t\tmetavec.height = sz;\n\t\t\tthis.templates.preview.push(metavec);\n\t\t}\n\n\t\tthis.buttonView.refreshBank();\n\t}\n}\n\nexport class FusionBank extends ButtonBank\n{\n\tconstructor(protected owner:any)\n\t{\n\t\tsuper();\n\t}\n\n\tpublic update():void\n\t{\n\t\tthis.buttons = [];\n\n\t\tthis.buttons.push({id: 'accept', imageFN: 'GenericAccept', helpText: 'Apply this template.'});\n\t\tthis.buttons.push({id: 'prev', imageFN: 'TemplatePrev', helpText: 'Show previous fusion option.'});\n\t\tthis.buttons.push({id: 'next', imageFN: 'TemplateNext', helpText: 'Show next fusion option.'});\n\t\t// (inline?)\n\t}\n\n\t// react to a button click\n\tpublic hitButton(id:string)\n\t{\n\t\tif (id == 'accept') this.owner.templateAccept();\n\t\telse if (id == 'prev') this.owner.templateRotate(-1);\n\t\telse if (id == 'next') this.owner.templateRotate(1);\n\t}\n\n\tpublic bankClosed()\n\t{\n\t\tthis.owner.clearPermutations();\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Experiment, ExperimentEntry} from '../aspect/Experiment';\nimport {DataSheetStream} from '../data/DataSheetStream';\nimport {MolUtil} from '../data/MolUtil';\nimport {QuantityCalc, QuantityCalcComp, QuantityCalcStat} from '../data/QuantityCalc';\nimport {ArrangeExperiment} from '../gfx/ArrangeExperiment';\nimport {OutlineMeasurement} from '../gfx/ArrangeMeasurement';\nimport {ArrangeMolecule} from '../gfx/ArrangeMolecule';\nimport {DrawExperiment} from '../gfx/DrawExperiment';\nimport {DrawMolecule} from '../gfx/DrawMolecule';\nimport {MetaVector, TextAlign} from '../gfx/MetaVector';\nimport {RenderEffects, RenderPolicy} from '../gfx/Rendering';\nimport {DOM, dom} from '../util/dom';\nimport {escapeHTML, formatDouble, fromUTF8, htmlToRGB} from '../util/util';\nimport {EmbedChemistry} from './EmbedChemistry';\n\n/*\n\tEmbedded reaction: renders a single reaction Experiment entry (can be multistep). Various formats are acceptable, but only one\n\treaction is applicable; a datasheet with many reactions will only show the first one.\n\n\tThe rendering parameters are quite raw, and presumed to be passed from an un-typed source, directly from the user:\n\n\t\tformat: MIME, or shortcuts for \"datasheet\" (... and others?)\n\t\tencoding: raw by default, but can be set to \"base64\"\n\t\tfacet: one of 'header', 'scheme', 'quantity' or 'metrics' (default is 'scheme')\n        scheme: molecule colouring schema (wob/cob/bow/cow)\n        scale: points per angstrom\n        padding: number of pixels to space around the content\n\t\tborder: border colour, HTML-style colour code or 'transparent' for none\n\t\tradius: zero for square, higher for rounder corners\n        background: 'transparent' for none; HTML-style for solid; for a gradient, specify as 'col1,col2'\n\t\ttight: if true, reduces the padding underneath\n\t\tstoichiometry: if false, doesn't display non-unit stoichiometry\n\t\tannotations: if true, adds annotations for component types\n\t\tmaximumwidth: optionally constrain the width in pixels (guideline only)\n\t\trow: row of first step (default 0)\n\n    ... these ones TBD\n\t\t(option to limitW/H?)\n\n        (parameters to control interactivity?)\n*/\n\nexport enum EmbedReactionFacet\n{\n\tHEADER = 'header',\n\tSCHEME = 'scheme',\n\tQUANTITY = 'quantity',\n\tMETRICS = 'metrics'\n}\n\nexport class EmbedReaction extends EmbedChemistry\n{\n\tprivate row = 0;\n\tprivate entry:ExperimentEntry = null;\n\tprivate failmsg = '';\n\tprivate tight = false;\n\tprivate facet = 'scheme';\n\tprivate limitTotalW = 800;\n\tprivate includeStoich = true;\n\tprivate includeAnnot = false;\n\n\t// ------------ public methods ------------\n\n\tconstructor(private datastr:string, options?:any)\n\t{\n\t\tsuper();\n\n\t\tif (!options) options = {};\n\n\t\tif (options.encoding == 'base64') datastr = fromUTF8(atob(datastr.trim()));\n\n\t\tlet xs:Experiment = null;\n\t\tif (options.format == 'datasheet' || options.format == 'chemical/x-datasheet')\n\t\t{\n\t\t\tlet ds = DataSheetStream.readXML(datastr);\n\t\t\tif (ds == null) {this.failmsg = 'Unable to parse raw XML datasheet.'; return;}\n\t\t\tif (Experiment.isExperiment(ds)) xs = new Experiment(ds);\n\t\t}\n\t\t// (... else MDL formats ...)\n\t\telse // free for all\n\t\t{\n\t\t\t// (same as explicit DS for now: but later add MDL formats)\n\t\t\tlet ds = DataSheetStream.readXML(datastr);\n\t\t\tif (ds == null) {this.failmsg = 'Unable to parse raw XML datasheet.'; return;}\n\t\t\tif (Experiment.isExperiment(ds)) xs = new Experiment(ds);\n\t\t}\n\n\t\tif (xs == null) {this.failmsg = 'Unable to instantiate Experiment aspect.'; return;}\n\t\tif (xs.ds.numRows == 0) {this.failmsg = 'Experiment datasheet has no rows.'; return;}\n\n\t\tif (options.row) this.row = options.row;\n\t\tif (this.row < 0 || this.row >= xs.ds.numRows) {this.failmsg = 'Requested row ' + this.row + ' out of bounds.'; return;}\n\t\tthis.entry = xs.getEntry(this.row);\n\n\t\tif (options.facet) this.facet = options.facet;\n\n\t\tif (options.padding) this.padding = options.padding;\n\n\t\tif (options.background == 'transparent') this.clearBackground();\n\t\telse if (options.background)\n\t\t{\n\t\t\tlet bg:string = options.background, comma = bg.indexOf(',');\n\t\t\tif (comma < 0)\n\t\t\t\tthis.setBackground(htmlToRGB(bg));\n\t\t\telse\n\t\t\t\tthis.setBackgroundGradient(htmlToRGB(bg.substring(0, comma)), htmlToRGB(bg.substring(comma + 1)));\n\t\t}\n\n\t\tif (options.border == 'transparent') this.borderCol = MetaVector.NOCOLOUR;\n\t\telse if (options.border) this.borderCol = htmlToRGB(options.border);\n\n\t\tif (options.radius != null) this.borderRadius = parseInt(options.radius);\n\n\t\tif (options.scheme == 'wob') this.policy = RenderPolicy.defaultWhiteOnBlack();\n\t\telse if (options.scheme == 'cob') this.policy = RenderPolicy.defaultColourOnBlack();\n\t\telse if (options.scheme == 'bow') this.policy = RenderPolicy.defaultBlackOnWhite();\n\t\telse if (options.scheme == 'cow') this.policy = RenderPolicy.defaultColourOnWhite();\n\n\t\tif (options.scale) this.policy.data.pointScale = options.scale;\n\n\t\tif (options.tight == true || options.tight == 'true') this.tight = true;\n\t\tif (options.maximumwidth > 0) this.limitTotalW = options.maximumwidth;\n\t\tif (options.stoichiometry == false || options.stoichiometry == 'false') this.includeStoich = true;\n\t\tif (options.annotations == true || options.annotations == 'true') this.includeAnnot = true;\n\t}\n\n\t// create the objects necessary to render the widget; this function should be called after basic pre-initialisation settings, e.g.\n\t// specifying the starting molecule, initial size, etc.\n\tpublic render(parent:any):void\n\t{\n\t\tthis.tagType = 'span';\n\t\tsuper.render(parent);\n\n\t\tlet span = this.contentDOM;\n\t\tspan.css({'display': 'inline-block', 'line-height': '0'});\n\t\tif (!this.tight) span.setCSS('margin-bottom', '1.5em');\n\n\t\tif (this.entry != null)\n\t\t{\n\t\t\tif (this.facet == EmbedReactionFacet.HEADER) this.renderHeader(span);\n\t\t\telse if (this.facet == EmbedReactionFacet.SCHEME) this.renderScheme(span);\n\t\t\telse if (this.facet == EmbedReactionFacet.QUANTITY) this.renderQuantity(span);\n\t\t\telse if (this.facet == EmbedReactionFacet.METRICS) this.renderMetrics(span);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tspan.css({'color': 'red'});\n\t\t\tspan.setText('Failure to acquire data: ' + this.failmsg);\n\t\t\tlet pre = dom('<pre/>').appendTo(span).css({'line-height': '1.1'});\n\t\t\tpre.setText(this.datastr);\n\t\t\tconsole.log('Unparseable datasheet source string:\\n[' + this.datastr + ']');\n\t\t}\n\t}\n\n\t// ------------ private methods ------------\n\n\t// display summary information from the header\n\tprivate renderHeader(span:DOM):void\n\t{\n\t\tlet table = dom('<table/>').appendTo(span);\n\t\ttable.css({'font-family': '\"HelveticaNeue-Light\", \"Helvetica Neue Light\", \"Helvetica Neue\", Helvetica, Arial, \"Lucida Grande\", sans-serif'});\n\t\ttable.css({'border-collapse': 'collapse', 'line-height': '1', 'margin': '2px', 'border': '0'});\n\n\t\tlet titles = ['Title', 'Created', 'Modified', 'DOI'];\n\t\tfor (let n = 0; n < 4; n++)\n\t\t{\n\t\t\tif (n == 3 && !this.entry.doi) continue;\n\n\t\t\tlet tr = dom('<tr/>').appendTo(table).css({'line-height': '1'});\n\n\t\t\tlet th = dom('<th/>').appendTo(tr);\n\t\t\tth.css({'white-space': 'nowrap', 'font-weight': '600', 'color': 'black', 'text-align': 'left', 'vertical-align': 'middle'});\n\t\t\tth.css({'padding': '0.2em 0.5em 0.2em 0.5em', 'border': '1px solid #D0D0D0'});\n\t\t\tth.setText(titles[n]);\n\n\t\t\tlet td = dom('<td/>').appendTo(tr);\n\t\t\ttd.css({'border': '1px solid #D0D0D0', 'padding': '0.2em', 'vertical-align': 'middle'});\n\n\t\t\tif (n == 0)\n\t\t\t{\n\t\t\t\tif (!this.entry.title) td.setCSS('font-style', 'italic');\n\t\t\t\ttd.setText(this.entry.title ? this.entry.title : '(none)');\n\t\t\t}\n\t\t\telse if (n == 1 || n == 2)\n\t\t\t{\n\t\t\t\tlet date = n == 1 ? this.entry.createDate : this.entry.modifyDate;\n\t\t\t\tif (date == null) td.setCSS('font-style', 'italic');\n\t\t\t\ttd.setText(date == null ? '(none)' : date.toLocaleString());\n\t\t\t}\n\t\t\telse if (n == 3)\n\t\t\t{\n\t\t\t\tlet url = this.doiToLink(this.entry.doi);\n\n\t\t\t\tif (url != null && (url.startsWith('http://') || url.startsWith('https://')))\n\t\t\t\t{\n\t\t\t\t\tlet ahref = dom('<a target=\"_blank\"/>').appendTo(td);\n\t\t\t\t\tahref.setAttr('href', url);\n\t\t\t\t\tahref.setText(this.entry.doi);\n\t\t\t\t}\n\t\t\t\telse td.setText(this.entry.doi);\n\t\t\t}\n\t\t}\n\t}\n\n\t// render the schema, using preferred chemist-style diagram\n\tprivate renderScheme(span:DOM):void\n\t{\n\t\tlet measure = new OutlineMeasurement(0, 0, this.policy.data.pointScale);\n\t\tlet layout = new ArrangeExperiment(this.entry, measure, this.policy);\n\t\tlayout.limitTotalW = this.limitTotalW;\n\t\tlayout.includeStoich = this.includeStoich;\n\t\tlayout.includeAnnot = this.includeAnnot;\n\n\t\tlayout.arrange();\n\n\t\tlet metavec = new MetaVector();\n\t\tnew DrawExperiment(layout, metavec).draw();\n\t\tmetavec.normalise();\n\t\tlet svg = dom(metavec.createSVG()).appendTo(span);\n\t}\n\n\t// render all the quantities by listing out each component in a table\n\tprivate renderQuantity(span:DOM):void\n\t{\n\t\tlet quant = new QuantityCalc(this.entry);\n\t\tquant.calculate();\n\n\t\tlet table = dom('<table/>').appendTo(span);\n\t\ttable.css({'font-family': '\"HelveticaNeue-Light\", \"Helvetica Neue Light\", \"Helvetica Neue\", Helvetica, Arial, \"Lucida Grande\", sans-serif'});\n\t\ttable.css({'border-collapse': 'collapse', 'line-height': '1', 'margin': '2px', 'border': '0'});\n\n\t\tlet effects = new RenderEffects();\n\t\tlet measure = new OutlineMeasurement(0, 0, this.policy.data.pointScale);\n\n\t\tfor (let n = 0; n < quant.numQuantities; n++)\n\t\t{\n\t\t\tlet qc = quant.getQuantity(n);\n\n\t\t\tlet tr = dom('<tr/>').appendTo(table).css({'line-height': '1'});\n\n\t\t\tlet td = dom('<td/>').appendTo(tr);\n\t\t\ttd.css({'border': '1px solid #D0D0D0', 'padding': '0.2em', 'text-align': 'center', 'vertical-align': 'middle'});\n\t\t\tif (MolUtil.notBlank(qc.comp.mol))\n\t\t\t{\n\t\t\t\tlet layout = new ArrangeMolecule(qc.comp.mol, measure, this.policy, effects);\n\t\t\t\tlayout.arrange();\n\n\t\t\t\tlet metavec = new MetaVector();\n\t\t\t\tnew DrawMolecule(layout, metavec).draw();\n\t\t\t\tmetavec.normalise();\n\t\t\t\tlet svg = dom(metavec.createSVG()).appendTo(td);\n\t\t\t}\n\n\t\t\ttd = dom('<td/>').appendTo(tr);\n\t\t\ttd.css({'border': '1px solid #D0D0D0', 'padding': '0.2em', 'text-align': 'left', 'vertical-align': 'top'});\n\n\t\t\tthis.renderComponentText(td, qc);\n\t\t}\n\t}\n\n\t// renders lines representing the component's text-like properties\n\tprivate renderComponentText(parent:DOM, qc:QuantityCalcComp)\n\t{\n\t\tlet title:string[] = [], content:string[] = [];\n\n\t\tif (qc.comp.name)\n\t\t{\n\t\t\ttitle.push('Name');\n\t\t\tcontent.push('<i>' + escapeHTML(qc.comp.name) + '</i>');\n\t\t}\n\t\tif (MolUtil.notBlank(qc.comp.mol))\n\t\t{\n\t\t\tlet mw = MolUtil.molecularWeight(qc.comp.mol);\n\t\t\ttitle.push('Weight');\n\t\t\tcontent.push(mw.toFixed(4));\n\n\t\t\tlet mf = MolUtil.molecularFormula(qc.comp.mol, ['<sub>', '</sub>', '<sup>', '</sup>']);\n\t\t\ttitle.push('Formula');\n\t\t\tcontent.push(mf);\n\t\t}\n\t\tif (qc.valueEquiv > 0)\n\t\t{\n\t\t\tlet text = qc.valueEquiv.toString(), stat = qc.statEquiv;\n\t\t\tif (stat == QuantityCalcStat.Virtual) text = '<i>(' + text + ')</i>';\n\t\t\telse if (stat == QuantityCalcStat.Conflict) text += ' (conflicting)';\n\t\t\ttitle.push('Stoichiometry');\n\t\t\tcontent.push(text);\n\t\t}\n\t\tif (qc.valueMass > 0)\n\t\t{\n\t\t\tlet text = QuantityCalc.formatMass(qc.valueMass), stat = qc.statMass;\n\t\t\tif (stat == QuantityCalcStat.Virtual) text = '<i>(' + text + ')</i>';\n\t\t\telse if (stat == QuantityCalcStat.Conflict) text += ' (conflicting)';\n\t\t\ttitle.push('Mass');\n\t\t\tcontent.push(text);\n\t\t}\n\t\tif (qc.valueVolume > 0)\n\t\t{\n\t\t\tlet text = QuantityCalc.formatVolume(qc.valueVolume), stat = qc.statVolume;\n\t\t\tif (stat == QuantityCalcStat.Virtual) text = '<i>(' + text + ')</i>';\n\t\t\telse if (stat == QuantityCalcStat.Conflict) text += ' (conflicting)';\n\t\t\ttitle.push('Volume');\n\t\t\tcontent.push(text);\n\t\t}\n\t\tif (qc.valueMoles > 0)\n\t\t{\n\t\t\tlet text = QuantityCalc.formatMoles(qc.valueMoles), stat = qc.statMoles;\n\t\t\tif (stat == QuantityCalcStat.Virtual) text = '<i>(' + text + ')</i>';\n\t\t\telse if (stat == QuantityCalcStat.Conflict) text += ' (conflicting)';\n\t\t\ttitle.push('Moles');\n\t\t\tcontent.push(text);\n\t\t}\n\t\tif (qc.valueDensity > 0)\n\t\t{\n\t\t\tlet text = QuantityCalc.formatDensity(qc.valueDensity), stat = qc.statDensity;\n\t\t\tif (stat == QuantityCalcStat.Virtual) text = '<i>(' + text + ')</i>';\n\t\t\telse if (stat == QuantityCalcStat.Conflict) text += ' (conflicting)';\n\t\t\ttitle.push('Density');\n\t\t\tcontent.push(text);\n\t\t}\n\t\tif (qc.valueConc > 0)\n\t\t{\n\t\t\tlet text = QuantityCalc.formatConc(qc.valueConc), stat = qc.statConc;\n\t\t\tif (stat == QuantityCalcStat.Virtual) text = '<i>(' + text + ')</i>';\n\t\t\telse if (stat == QuantityCalcStat.Conflict) text += ' (conflicting)';\n\t\t\ttitle.push('Concentration');\n\t\t\tcontent.push(text);\n\t\t}\n\t\tif (qc.valueYield > 0 && !qc.comp.waste)\n\t\t{\n\t\t\tlet text = QuantityCalc.formatPercent(qc.valueYield), stat = qc.statYield;\n\t\t\tif (stat == QuantityCalcStat.Virtual) text = '<i>(' + text + ')</i>';\n\t\t\telse if (stat == QuantityCalcStat.Conflict) text += ' (conflicting)';\n\t\t\ttitle.push('Yield');\n\t\t\tcontent.push(text);\n\t\t}\n\n\t\tfor (let n = 0; n < title.length; n++)\n\t\t{\n\t\t\tlet p = dom('<p/>').appendTo(parent);\n\t\t\tp.setCSS('margin', '0.1em');\n\t\t\tp.append(dom('<b>' + title[n] + '</b>'));\n\t\t\tp.appendText(': ');\n\t\t\tp.appendHTML(content[n]);\n\t\t}\n\t}\n\n\t// display calculated green chemistry metrics\n\tprivate renderMetrics(span:DOM):void\n\t{\n\t\tlet quant = new QuantityCalc(this.entry);\n\t\tquant.calculate();\n\n\t\tlet table = dom('<table/>').appendTo(span);\n\t\ttable.css({'font-family': '\"HelveticaNeue-Light\", \"Helvetica Neue Light\", \"Helvetica Neue\", Helvetica, Arial, \"Lucida Grande\", sans-serif'});\n\t\ttable.css({'border-collapse': 'collapse', 'line-height': '1', 'margin': '2px', 'border': '0'});\n\n\t\tlet effects = new RenderEffects();\n\t\tlet measure = new OutlineMeasurement(0, 0, this.policy.data.pointScale);\n\n\t\t// display overall summary totals\n\t\tif (quant.numGreenMetrics > 0) for (let n = 0; n < 3; n++)\n\t\t{\n\t\t\tlet tr = dom('<tr/>').appendTo(table).css({'line-height': '1'});\n\n\t\t\tlet th = dom('<th/>').appendTo(tr);\n\t\t\tth.css({'border': '1px solid #D0D0D0', 'padding': '0.5em', 'font-weight': 'bold'});\n\t\t\tth.css({'text-align': 'right', 'vertical-align': 'middle', 'white-space': 'nowrap'});\n\t\t\tth.setText(n == 0 ? 'All Reactants' : n == 1 ? 'All Products' : /* n == 2 */ 'All Waste');\n\n\t\t\tlet td = dom('<td/>').appendTo(tr);\n\t\t\ttd.css({'border': '1px solid #D0D0D0', 'padding': '0.5em', 'white-space': 'nowrap'});\n\t\t\ttd.css({'text-align': 'left', 'vertical-align': 'middle'});\n\t\t\tif (n == 0)\n\t\t\t{\n\t\t\t\ttd.setText(this.combineQuant(quant.getAllMassReact(), 'g') + ' = ' + this.sumQuant(quant.getAllMassReact(), 'g', true));\n\t\t\t}\n\t\t\telse if (n == 1)\n\t\t\t{\n\t\t\t\ttd.setText(this.combineQuant(quant.getAllMassProd(), 'g') + ' = ' + this.sumQuant(quant.getAllMassProd(), 'g', true));\n\t\t\t}\n\t\t\telse if (n == 2)\n\t\t\t{\n\t\t\t\tif (quant.getAllMassWaste().length > 0)\n\t\t\t\t\ttd.setText(this.combineQuant(quant.getAllMassWaste(), 'g') + ' = ' + this.sumQuant(quant.getAllMassWaste(), 'g', false));\n\t\t\t\telse\n\t\t\t\t\ttd.setText('none');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet tr = dom('<tr/>').appendTo(table);\n\t\t\tlet td = dom('<td/>').appendTo(tr);\n\t\t\ttd.setText('No metrics to show.');\n\t\t}\n\n\t\t// show each relevant entity (i.e. products)\n\t\tfor (let n = 0; n < quant.numGreenMetrics; n++)\n\t\t{\n\t\t\tlet gm = quant.getGreenMetrics(n);\n\t\t\tlet qc = quant.getQuantity(gm.idx);\n\n\t\t\tlet tr = dom('<tr/>').appendTo(table).css({'line-height': '1'});\n\n\t\t\tlet td = dom('<td/>').appendTo(tr);\n\t\t\ttd.css({'border': '1px solid #D0D0D0', 'padding': '0.2em', 'text-align': 'center', 'vertical-align': 'middle'});\n\t\t\tif (MolUtil.notBlank(qc.comp.mol))\n\t\t\t{\n\t\t\t\tlet layout = new ArrangeMolecule(qc.comp.mol, measure, this.policy, effects);\n\t\t\t\tlayout.arrange();\n\n\t\t\t\tlet metavec = new MetaVector();\n\t\t\t\tnew DrawMolecule(layout, metavec).draw();\n\t\t\t\tmetavec.normalise();\n\t\t\t\tdom(metavec.createSVG()).appendTo(td);\n\t\t\t}\n\n\t\t\ttd = dom('<td/>').appendTo(tr);\n\t\t\ttd.css({'border': '1px solid #D0D0D0', 'padding': '0.5em', 'text-align': 'left', 'vertical-align': 'top'});\n\n\t\t\tlet pmi1 = this.combineQuant(gm.massReact, 'g'), pmi2 = this.combineQuant(gm.massProd, 'g');\n\t\t\tlet pmi3 = this.sumQuantExt(gm.massReact, gm.massProd, 1, Number.NaN, null);\n\t\t\tlet vg = this.drawTotals('PMI', pmi1, pmi2, pmi3);\n\t\t\tvg.normalise();\n\t\t\tlet para = dom('<p/>').appendTo(td);\n\t\t\tdom(vg.createSVG()).appendTo(para);\n\n\t\t\tlet ef1 = this.combineQuant(gm.massWaste, 'g'), ef2 = this.combineQuant(gm.massProd, 'g');\n\t\t\tlet ef3 = this.sumQuantExt(gm.massWaste, gm.massProd, 1, Number.NaN, null);\n\t\t\tvg = this.drawTotals('E-factor', ef1, ef2, ef3);\n\t\t\tvg.normalise();\n\t\t\tpara = dom('<p/>').appendTo(td);\n\t\t\tdom(vg.createSVG()).appendTo(para);\n\n\t\t\tlet ae1 = this.combineQuant(gm.molwProd, null), ae2 = this.combineQuant(gm.molwReact, null);\n\t\t\tlet ae3 = this.sumQuantExt(gm.molwProd, gm.molwReact, 100, 100, '%');\n\t\t\tvg = this.drawTotals('Atom-E', ae1, ae2, ae3);\n\t\t\tvg.normalise();\n\t\t\tpara = dom('<p/>').appendTo(td);\n\t\t\tdom(vg.createSVG()).appendTo(para);\n\t\t}\n\t}\n\n\t// strings together a bunch of values with a separator & units\n\tprivate combineQuant(values:number[], units:string):string\n\t{\n\t\tif (values.length == 0) return '?';\n\n\t\tlet str = '';\n\t\tfor (let n = 0; n < values.length; n++)\n\t\t{\n\t\t\tif (n > 0) str += ' + ';\n\t\t\tif (values[n] == QuantityCalc.UNSPECIFIED)\n\t\t\t{\n\t\t\t\tstr += '?';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tstr += formatDouble(values[n], 4);\n\t\t\t\tif (units) str += ' ' + units;\n\t\t\t}\n\t\t}\n\t\treturn str;\n\t}\n\n\t// sums a bunch of values, with optional units\n\tprivate sumQuant(values:number[], units:string, requireSomething:boolean):string\n\t{\n\t\tif (values.length == 0) return requireSomething ? '?' : '0';\n\n\t\tlet sum = 0;\n\t\tfor (let n = 0; n < values.length; n++)\n\t\t{\n\t\t\tif (values[n] == QuantityCalc.UNSPECIFIED) return '?';\n\t\t\tsum += values[n];\n\t\t}\n\t\tlet ret = formatDouble(sum, 4);\n\t\tif (units) ret += ' ' + units;\n\t\treturn ret;\n\t}\n\tprivate sumQuantExt(numer:number[], denom:number[], mul:number, max:number, units:string):string\n\t{\n\t\tif (numer.length == 0 || denom.length == 0) return '?';\n\t\tlet sum1 = 0, sum2 = 0;\n\t\tfor (let n = 0; n < numer.length; n++)\n\t\t{\n\t\t\tif (numer[n] == QuantityCalc.UNSPECIFIED) return '?';\n\t\t\tsum1 += numer[n];\n\t\t}\n\t\tfor (let n = 0; n < denom.length; n++)\n\t\t{\n\t\t\tif (denom[n] == QuantityCalc.UNSPECIFIED) return '?';\n\t\t\tsum2 += denom[n];\n\t\t}\n\t\tif (sum2 <= 0) return '?';\n\t\tlet val = mul * sum1 / sum2;\n\t\tif (!Number.isNaN(max)) val = Math.min(val, max);\n\n\t\tlet ret = formatDouble(val, 4);\n\t\tif (units) ret += ' ' + units;\n\t\treturn ret;\n\t}\n\n\t// renders green metrics as a formula\n\tprivate drawTotals(heading:string, over:string, under:string, answer:string):MetaVector\n\t{\n\t\tlet vg = new MetaVector();\n\t\tlet measure = new OutlineMeasurement(0, 0, this.policy.data.pointScale);\n\n\t\tlet sep = ' = ';\n\t\tlet fsz = this.policy.data.pointScale * 0.8;\n\t\tlet wadHeading = measure.measureText(heading, fsz);\n\t\tlet wadOver = measure.measureText(over, fsz), wadUnder = measure.measureText(under, fsz);\n\t\tlet wadAnswer = measure.measureText(answer, fsz);\n\t\tlet wadSep = measure.measureText(sep, fsz);\n\n\t\tlet x = 0;\n\t\tvg.drawText(x, 0, heading, fsz, 0x000000, TextAlign.Left | TextAlign.Middle);\n\t\tx += wadHeading[0];\n\t\tvg.drawText(x, 0, sep, fsz, 0x000000, TextAlign.Left | TextAlign.Middle);\n\t\tx += wadSep[0];\n\n\t\tvg.drawText(x, 0, answer, fsz, 0x000000, TextAlign.Left | TextAlign.Middle);\n\t\tx += wadAnswer[0];\n\t\tvg.drawText(x, 0, sep, fsz, 0x000000, TextAlign.Left | TextAlign.Middle);\n\t\tx += wadSep[0];\n\n\t\tlet lw = Math.max(wadOver[0], wadUnder[0]);\n\t\tvg.drawLine(x, 0, x + lw, 0, 0x000000, 1);\n\t\tvg.drawText(x + 0.5 * lw, -2, over, fsz, 0x000000, TextAlign.Centre | TextAlign.Bottom);\n\t\tvg.drawText(x + 0.5 * lw, 2, under, fsz, 0x000000, TextAlign.Centre | TextAlign.Top);\n\t\t//x += lw;\n\n\t\treturn vg;\n\t}\n\n\t// turns a DOI (or whatever got stuffed into the placeholder) into a clickable link, if possible\n\tprivate static PTN_DOI1 = /^doi:(\\d+\\.\\d+\\/.*)$/;\n\tprivate static PTN_DOI2 = /^(\\d+\\.\\d+\\/.*)$/;\n\tprivate static PTN_ISBN = /^(\\d+-\\d+-\\d+-\\d+-\\d+)$/;\n\tprivate doiToLink(doi:string):string\n\t{\n\t\tif (doi.startsWith('http://') || doi.startsWith('https://')) return doi;\n\n\t\tlet m = EmbedReaction.PTN_DOI1.exec(doi);\n\t\tif (m) return 'http://dx.doi.org/' + m[1];\n\t\tm = EmbedReaction.PTN_DOI2.exec(doi);\n\t\tif (m) return 'http://dx.doi.org/' + m[1];\n\n\t\t// note: there doesn't seem to be a way to turn an ISBN into a URL, which is rather unfortunate\n\t\tm = EmbedReaction.PTN_ISBN.exec(doi);\n\t\tif (m) return 'ISBN: ' + m[1];\n\n\t\treturn null; // fail\n\t}\n}\n\n","/*\n\tWebMolKit\n\n\t(c) 2010-2019 Molecular Materials Informatics, Inc.\n\n\tAll rights reserved\n\n\thttp://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {CoordUtil} from '../data/CoordUtil';\nimport {DataSheetColumn} from '../data/DataSheet';\nimport {DataSheetStream} from '../data/DataSheetStream';\nimport {Molecule} from '../data/Molecule';\nimport {MoleculeStream} from '../data/MoleculeStream';\nimport {MolUtil} from '../data/MolUtil';\nimport {PolymerBlock, PolymerBlockUnit} from '../data/PolymerBlock';\nimport {GuidelineSprout, SketchUtil} from '../data/SketchUtil';\nimport {ArrangeMolecule} from '../gfx/ArrangeMolecule';\nimport {DrawMolecule} from '../gfx/DrawMolecule';\nimport {MetaVector} from '../gfx/MetaVector';\nimport {RenderEffects, RenderPolicy} from '../gfx/Rendering';\nimport {ButtonView, ButtonViewPosition} from '../ui/ButtonView';\nimport {ClipboardProxy} from '../ui/ClipboardProxy';\nimport {MenuProxy} from '../ui/MenuProxy';\nimport {angleDiff, clone, DEGRAD, eventCoords, KeyCode, norm2_xy, norm_xy, RADDEG, TWOPI} from '../util/util';\nimport {Vec} from '../util/Vec';\nimport {CommandBank} from './CommandBank';\nimport {ContextSketch} from './ContextSketch';\nimport {DraggingTool, DrawCanvas, DrawCanvasDecoration} from './DrawCanvas';\nimport {EditAtom} from './EditAtom';\nimport {EditBond} from './EditBond';\nimport {EditPolymer} from './EditPolymer';\nimport {ActivityType, MoleculeActivity, SketchState, TemplatePermutation} from './MoleculeActivity';\nimport {FusionBank, TemplateBank} from './TemplateBank';\nimport {ToolBank, ToolBankItem} from './ToolBank';\n\n/*\n\tSketcher: a very heavyweight widget that provides 2D structure editing for a molecule.\n*/\n\nexport class Sketcher extends DrawCanvas\n{\n\t// callbacks\n\tpublic callbackChangeMolecule:(mol:Molecule) => void;\n\tpublic callbackSpecialPaste:(str:string) => Promise<Molecule> = null; // define this to add special layer for clipboard interpretation\n\n\tpublic inDialog = false; // set to true while a modal dialog is open\n\tpublic initialFocus = true; // normally want to bogart the focus upon creation, but not always\n\n\t// tweakable properties\n\tpublic useToolBank = true;\n\tpublic lowerToolBank = false;\n\tpublic useCommandBank = true;\n\tpublic lowerCommandBank = false;\n\tpublic useTemplateBank = true;\n\tpublic lowerTemplateBank = false;\n\tpublic debugOutput:any = undefined;\n\n\tprivate beenSetup = false;\n\tprivate undoStack:SketchState[] = [];\n\tprivate redoStack:SketchState[] = [];\n\tprivate fadeWatermark = 0;\n\tprivate toolView:ButtonView = null;\n\tprivate commandView:ButtonView = null;\n\tprivate templateView:ButtonView = null;\n\n\tprivate proxyClip:ClipboardProxy = null;\n\tprivate proxyMenu:MenuProxy = null;\n\tprivate static UNDO_SIZE = 20;\n\n\t// ------------ public methods ------------\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\t// the sketcher needs to know what size to be, prior to rendering\n\tpublic setSize(width:number, height:number):void\n\t{\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t}\n\n\t// takes an instance of molsync.data.Molecule as the content; note that it is not cloned - the caller must do this if\n\t// it could be modified elsewhere; note that the 'withStashUndo' parameter is a flag, which defaults to _false_, because\n\t// this function is usually used for things like initial state; during-edit modifications are more typically done via\n\t// the setState(..) function\n\tpublic defineMolecule(mol:Molecule, withAutoScale = true, withStashUndo = false, keepSelect = false):void\n\t{\n\t\tif (mol.compareTo(this.mol) == 0) return;\n\n\t\tif (withStashUndo) this.stashUndo();\n\t\tthis.stopTemplateFusion();\n\n\t\tthis.mol = mol.clone();\n\t\tif (this.callbackChangeMolecule) this.callbackChangeMolecule(this.mol);\n\n\t\t// note: inefficient; make it compute on demand\n\t\tthis.guidelines = [];\n\t\tfor (let n = 1; n <= this.mol.numAtoms; n++)\n\t\t{\n\t\t\tfor (let sprout of SketchUtil.guidelineSprouts(this.mol, n)) this.guidelines.push(sprout);\n\t\t}\n\n\t\tif (!this.beenSetup) return;\n\n\t\tif (!keepSelect)\n\t\t{\n\t\t\tthis.currentAtom = this.currentBond = 0;\n\t\t\tthis.selectedMask = null;\n\t\t}\n\t\tthis.stereo = null;\n\t\tthis.hoverAtom = 0;\n\t\tthis.hoverBond = 0;\n\n\t\tif (!withAutoScale)\n\t\t\tthis.renderMolecule();\n\t\telse\n\t\t\tthis.autoScale();\n\t}\n\n\t// provides the mechanism for interacting with the clipboard (which is quite different for web vs. app mode)\n\tpublic defineClipboard(proxy:ClipboardProxy):void\n\t{\n\t\tthis.proxyClip = proxy;\n\t}\n\tpublic defineContext(proxy:MenuProxy):void\n\t{\n\t\tthis.proxyMenu = proxy;\n\t}\n\n\t// define the molecule as a SketchEl-formatted string\n\tpublic defineMoleculeString(molsk:string, withAutoScale:boolean, withStashUndo:boolean):void\n\t{\n\t\tthis.defineMolecule(Molecule.fromString(molsk), withAutoScale, withStashUndo);\n\t}\n\n\t// provides a rendering policy; the parameter should be a RenderPolicy object; note that it is not cloned\n\tpublic defineRenderPolicy(policy:RenderPolicy):void\n\t{\n\t\tthis.policy = policy;\n\t\tthis.pointScale = policy.data.pointScale;\n\t}\n\n\t// defines the colours used for border & background; note that a border of MetaVector.NOCOLOUR is an instruction to not have one\n\tpublic defineBackground(borderCol?:number, borderRad?:number, bgCol?:number):void\n\t{\n\t\tif (borderCol != null) this.border = borderCol;\n\t\tif (borderRad != null) this.borderRadius = borderRad;\n\t\tif (bgCol != null) this.background = bgCol;\n\t}\n\n\t// zappy zap\n\tpublic clearMolecule():void {this.defineMolecule(new Molecule(), true, true);}\n\n\t// retrieves a copy of the molecule\n\tpublic getMolecule():Molecule {return this.mol.clone();}\n\n\t// instantiates the widget: any of the immutable setup properties are now cast in stone\n\tpublic setup(callback:() => void):void\n\t{\n\t\tthis.beenSetup = true;\n\t\tif (this.mol == null) this.mol = new Molecule();\n\t\tif (this.policy == null)\n\t\t{\n\t\t\tthis.policy = RenderPolicy.defaultColourOnWhite();\n\t\t\tthis.pointScale = this.policy.data.pointScale;\n\t\t}\n\n\t\tthis.layoutMolecule();\n\t\tthis.centreAndShrink();\n\t\tthis.redrawMetaVector();\n\n\t\tif (callback) callback();\n\t}\n\tpublic async setupAsync():Promise<void>\n\t{\n\t\treturn new Promise<void>((resolve) => this.setup(() => resolve()));\n\t}\n\n\t// create the objects necessary to render the widget; this function should be called after basic pre-initialisation settings, e.g.\n\t// specifying the starting molecule, initial size, etc.\n\tpublic render(parent:any):void\n\t{\n\t\tsuper.render(parent);\n\n\t\tthis.centreAndShrink();\n\t\tthis.redraw();\n\n\t\t// create the buttonviews\n\t\tlet reserveHeight = 0;\n\t\tif (this.useCommandBank)\n\t\t{\n\t\t\tthis.commandView = new ButtonView(ButtonViewPosition.Bottom, 0, 0, this.width, this.height);\n\t\t\tif (this.lowerCommandBank) this.commandView.lowerBank();\n\t\t\t// (put this back) this.commandView.lowerBank();\n\t\t\tthis.commandView.setHasBigButtons(false);\n\t\t\tthis.commandView.pushBank(new CommandBank(this));\n\t\t\tthis.commandView.render(this.container);\n\t\t\treserveHeight = this.commandView.height;\n\t\t}\n\t\tif (this.useToolBank)\n\t\t{\n\t\t\tthis.toolView = new ButtonView(ButtonViewPosition.Left, 0, 0, this.width, this.height - reserveHeight);\n\t\t\tif (this.lowerToolBank) this.toolView.lowerBank();\n\t\t\tthis.toolView.setHasBigButtons(false);\n\t\t\tthis.toolView.pushBank(new ToolBank(this));\n\t\t\tthis.toolView.render(this.container);\n\t\t}\n\t\tif (this.useTemplateBank)\n\t\t{\n\t\t\tthis.templateView = new ButtonView(ButtonViewPosition.Right, 0, 0, this.width, this.height - reserveHeight);\n\t\t\tif (this.lowerTemplateBank) this.templateView.lowerBank();\n\t\t\tthis.templateView.setHasBigButtons(true); // big buttons for templates is a good thing\n\t\t\tthis.templateView.pushBank(new TemplateBank(this, null));\n\t\t\tthis.templateView.render(this.container);\n\t\t}\n\n\t\t// setup all the interactive events\n\t\tthis.container.onClick((event) => this.mouseClick(event));\n\t\tthis.container.onDblClick((event) => this.mouseDoubleClick(event));\n\t\tthis.container.onMouseDown((event) => this.mouseDown(event));\n\t\tthis.container.onMouseUp((event) => this.mouseUp(event));\n\t\tthis.container.onMouseOver((event) => this.mouseOver(event));\n\t\tthis.container.onMouseLeave((event) => this.mouseOut(event));\n\t\tthis.container.onMouseMove((event) => this.mouseMove(event));\n\t\tthis.container.onKeyPress((event) => this.keyPressed(event));\n\t\tthis.container.onKeyDown((event) => this.keyDown(event));\n\t\tthis.container.onKeyUp((event) => this.keyUp(event));\n\t\tthis.container.onTouchStart((event) => this.touchStart(event));\n\t\tthis.container.onTouchMove((event) => this.touchMove(event));\n\t\tthis.container.onTouchCancel((event) => this.touchCancel(event));\n\t\tthis.container.onTouchEnd((event) => this.touchEnd(event));\n\t\tthis.contentDOM.onContextMenu((event:MouseEvent) => this.contextMenu(event));\n\n\t\t// setup the wheel handler\n\t\t/* ...\n\t\tlet mwh = new goog.events.MouseWheelHandler(this.container);\n\t\tgoog.events.listen(mwh, goog.events.MouseWheelHandler.EventType.MOUSEWHEEL, this.mouseWheel, false, this);\n\t\t*/\n\n\t\t// setup drop events\n\t\tthis.container.el.addEventListener('dragover', (event:DragEvent) =>\n\t\t{\n\t\t\tevent.stopPropagation();\n\t\t\tevent.preventDefault();\n\t\t\tevent.dataTransfer.dropEffect = 'copy';\n\t\t});\n\t\tthis.container.el.addEventListener('drop', (event:DragEvent) =>\n\t\t{\n\t\t\tevent.stopPropagation();\n\t\t\tevent.preventDefault();\n\t\t\tthis.dropInto(event.dataTransfer);\n\t\t});\n\n\t\tif (this.initialFocus) this.grabFocus();\n\t}\n\n\t// viewing options: changing any of them triggers a redraw\n\tpublic get decoration():DrawCanvasDecoration {return this.viewOpt.decoration;}\n\tpublic set decoration(decoration:DrawCanvasDecoration) {if (this.viewOpt.decoration != decoration) {this.viewOpt.decoration = decoration; this.renderMolecule();}}\n\tpublic get showOxState():boolean {return this.viewOpt.showOxState;}\n\tpublic set showOxState(showOxState:boolean) {if (this.viewOpt.showOxState != showOxState) {this.viewOpt.showOxState = showOxState; this.renderMolecule();}}\n\tpublic get showQuery():boolean {return this.viewOpt.showQuery;}\n\tpublic set showQuery(showQuery:boolean) {if (this.viewOpt.showQuery != showQuery) {this.viewOpt.showQuery = showQuery; this.renderMolecule();}}\n\tpublic get showArtifacts():boolean {return this.viewOpt.showArtifacts;}\n\tpublic set showArtifacts(showArtifacts:boolean) {if (this.viewOpt.showArtifacts != showArtifacts) {this.viewOpt.showArtifacts = showArtifacts; this.renderMolecule();}}\n\n\t// change the size of the sketcher after instantiation\n\tpublic changeSize(width:number, height:number):void\n\t{\n\t\tif (width == this.width && height == this.height) return;\n\t\tthis.width = width;\n\t\tthis.height = height;\n\n\t\tfor (let widget of [this.container, this.canvasUnder, this.canvasMolecule, this.canvasOver])\n\t\t{\n\t\t\twidget.css({'width': `${width}px`, 'height': `${height}px`});\n\t\t}\n\n\t\tfor (let btnv of [this.commandView, this.toolView, this.templateView]) if (btnv)\n\t\t{\n\t\t\tbtnv.setParentSize(width, height);\n\t\t\tbtnv.refreshBank();\n\t\t}\n\n\t\tthis.autoScale();\n\t}\n\n\t// displays a message, which may be an error or just something helpful\n\tpublic showMessage(msg:string, isError:boolean = false):void\n\t{\n\t\tlet watermark = ++this.fadeWatermark;\n\n\t\tthis.divMessage.css({'color': isError ? '#FF0000' : '#008000'});\n\t\tthis.divMessage.setText(msg);\n\t\tlet szLeft = (this.toolView == null ? 0 : this.toolView.width) + 2;\n\t\tlet szRight = (this.templateView == null ? 0 : this.templateView.width) + 2;\n\t\tlet szBottom = (this.commandView == null ? 0 : this.commandView.height) + 2;\n\t\tthis.divMessage.css({'left': szLeft + 'px'});\n\t\tthis.divMessage.css({'width': (this.width - szLeft - szRight) + 'px'});\n\t\tthis.divMessage.css({'height': (this.height - szBottom) + 'px'});\n\n\t\twindow.setTimeout(() =>\n\t\t{\n\t\t\tif (watermark == this.fadeWatermark) this.divMessage.setText('');\n\t\t}, 5000);\n\t}\n\n\t// boots the message immediately\n\tpublic clearMessage()\n\t{\n\t\tif (this.divMessage.getText() == '') return;\n\t\tthis.fadeWatermark++;\n\t\tthis.divMessage.setText('');\n\t}\n\n\t// rescales and aligns to the middle of the screen\n\tpublic autoScale()\n\t{\n\t\t// note: this is inefficient; can just scale the primitives...\n\n\t\tthis.pointScale = this.policy.data.pointScale;\n\n\t\tthis.layoutMolecule();\n\t\tthis.centreAndShrink();\n\t\tthis.redrawMetaVector();\n\t\tthis.layoutTemplatePerm();\n\t\tthis.delayedRedraw();\n\t}\n\n\t// returns true if there are any selected atoms\n\tpublic anySelected():boolean\n\t{\n\t\tif (this.selectedMask == null) return false;\n\t\tfor (let n = 0; n < this.selectedMask.length; n++) if (this.selectedMask[n]) return true;\n\t\treturn false;\n\t}\n\n\t// changes selection state for atom\n\tpublic setSelected(atom:number, sel:boolean):void\n\t{\n\t\tif (this.selectedMask == null)\n\t\t{\n\t\t\tthis.selectedMask = new Array(this.mol.numAtoms);\n\t\t\tfor (let n = this.selectedMask.length - 1; n >= 0; n--) this.selectedMask[n] = false;\n\t\t}\n\t\twhile (this.selectedMask.length < this.mol.numAtoms) {this.selectedMask.push(false);}\n\t\tthis.selectedMask[atom - 1] = sel;\n\t\tthis.delayedRedraw();\n\t}\n\n\t// convenience: sets current and redraws\n\tprivate changeCurrentAtom(atom:number):void\n\t{\n\t\tif (this.currentAtom == atom) return;\n\t\tthis.currentAtom = atom;\n\t\tthis.currentBond = 0;\n\t\tthis.delayedRedraw();\n\t}\n\tprivate changeCurrentBond(bond:number):void\n\t{\n\t\tif (this.currentBond == bond) return;\n\t\tthis.currentBond = bond;\n\t\tthis.currentAtom = 0;\n\t\tthis.delayedRedraw();\n\t}\n\n\t// select & current are zapped\n\tpublic clearSubject():void\n\t{\n\t\tif (this.currentAtom == 0 && this.currentBond == 0 && Vec.allFalse(this.selectedMask)) return;\n\t\tthis.currentAtom = 0;\n\t\tthis.currentBond = 0;\n\t\tthis.selectedMask = Vec.booleanArray(false, this.mol.numAtoms);\n\t\tthis.delayedRedraw();\n\t}\n\n\t// sets the current state; see getState() function above for the format of the object; the 'withStashUndo' parameter is a\n\t// flag, which defaults to true: determines whether the current state will be pushed onto the undo-stack before making the change\n\tpublic setState(state:SketchState, withStashUndo:boolean = true):void\n\t{\n\t\tthis.stopTemplateFusion();\n\n\t\tif (state.mol != null) this.defineMolecule(state.mol.clone(), false, withStashUndo, true);\n\t\tif (state.currentAtom >= 0) this.currentAtom = state.currentAtom;\n\t\tif (state.currentBond >= 0) this.currentBond = state.currentBond;\n\t\tif (state.selectedMask != null) this.selectedMask = state.selectedMask == null ? null : state.selectedMask.slice(0);\n\n\t\tthis.delayedRedraw();\n\t}\n\n\t// appends the current state to the undo-stack\n\tpublic stashUndo():void\n\t{\n\t\t//if (this.undoStack.length == 0 && this.mol.numAtoms == 0) return; // don't put empty stuff at the beginning\n\t\tlet state = this.getState();\n\n\t\tthis.undoStack.push(state);\n\t\twhile (this.undoStack.length > Sketcher.UNDO_SIZE)\n\t\t{\n\t\t\tthis.undoStack.splice(0, 1);\n\t\t}\n\t\tthis.redoStack = [];\n\t}\n\n\t// a bunch of template fusion permutations has arrived: display the first one, and allow them to be traversed\n\tpublic setPermutations(perms:TemplatePermutation[]):void\n\t{\n\t\tthis.templatePerms = perms;\n\t\tthis.pickTemplatePermutation(0);\n\t\tthis.fusionBank = new FusionBank(this);\n\t\tthis.templateView.pushBank(this.fusionBank);\n\n\t\tif (this.mol.numAtoms == 0) this.centreAndShrink();\n\t}\n\n\t// stop fusing templates, and clear out the fusion bank as well\n\tpublic stopTemplateFusion():void\n\t{\n\t\tif (this.fusionBank != null) this.templateView.popBank();\n\t}\n\n\t// get rid of the template overlay\n\tpublic clearPermutations()\n\t{\n\t\tif (this.templatePerms == null) return;\n\t\tthis.templatePerms = null;\n\t\tthis.delayedRedraw();\n\t\tthis.fusionBank = null;\n\t}\n\n\t// accept the current template permutation: make it the new molecule\n\tpublic templateAccept():void\n\t{\n\t\tlet mol = Molecule.fromString(this.templatePerms[this.currentPerm].mol);\n\t\tthis.templateView.popBank();\n\t\tthis.defineMolecule(mol, false, true, false);\n\t}\n\n\t// rotate the template display up or down\n\tpublic templateRotate(dir:number)\n\t{\n\t\tlet idx = (this.currentPerm + dir) % this.templatePerms.length;\n\t\tif (idx < 0) idx += this.templatePerms.length;\n\t\tthis.pickTemplatePermutation(idx);\n\t}\n\n\t// reports on the state of the undo/redo buffers\n\tpublic canUndo():boolean {return this.undoStack.length > 0;}\n\tpublic canRedo():boolean {return this.redoStack.length > 0;}\n\n\t// actually does the undo/redo operation\n\tpublic performUndo():void\n\t{\n\t\tif (this.undoStack.length == 0) return;\n\t\tlet state = this.getState();\n\t\tthis.redoStack.push(state);\n\t\tthis.setState(this.undoStack.pop(), false);\n\t}\n\tpublic performRedo():void\n\t{\n\t\tif (this.redoStack.length == 0) return;\n\t\tlet state = this.getState();\n\t\tthis.undoStack.push(state);\n\t\tthis.setState(this.redoStack.pop(), false);\n\t}\n\n\t// copying to clipboard: sticks the content in several different places, for subsequent recall\n\tpublic performCopy(mol?:Molecule):void\n\t{\n\t\tif (!mol) mol = this.getMolecule();\n\n\t\tif (this.proxyClip) this.proxyClip.setString(mol.toString());\n\t}\n\n\t// perform a more surgical copy/cut operation\n\tpublic performCopySelection(andCut:boolean):void\n\t{\n\t\tnew MoleculeActivity(this.getState(), andCut ? ActivityType.Cut : ActivityType.Copy, {}, this).execute();\n\t}\n\n\t// pasting from clipboard, initiated by the user via non-system commands: this can't necessarily grab the system\n\t// clipboard, so have to get a bit more creative\n\tpublic performPaste():void\n\t{\n\t\t// see if we have access to the system clipboard\n\t\tif (this.proxyClip && this.proxyClip.canAlwaysGet())\n\t\t{\n\t\t\tlet txt = this.proxyClip.getString();\n\t\t\tthis.pasteText(txt);\n\t\t}\n\t}\n\n\t// executes an arbitrary activity on the current molecule/selection state\n\tpublic performActivity(activity:ActivityType, param:Record<string, any> = {}):void\n\t{\n\t\tnew MoleculeActivity(this.getState(), activity, param, this).execute();\n\t}\n\n\t// zooms in or out, depending on the magnifier\n\tpublic zoom(mag:number)\n\t{\n\t\tlet cx = 0.5 * this.width, cy = 0.5 * this.height;\n\t\tlet newScale = Math.min(10 * this.policy.data.pointScale, Math.max(0.1 * this.policy.data.pointScale, this.pointScale * mag));\n\t\tif (newScale == this.pointScale) return;\n\n\t\tthis.offsetX = cx - (newScale / this.pointScale) * (cx - this.offsetX);\n\t\tthis.offsetY = cy - (newScale / this.pointScale) * (cy - this.offsetY);\n\t\tthis.pointScale = newScale;\n\n\t\t// --- begin inefficient: rewrite this to just transform the constituents...\n\t\tthis.layoutMolecule();\n\t\tthis.redrawMetaVector();\n\t\tthis.layoutTemplatePerm();\n\t\t// --- end inefficient\n\n\t\tthis.delayedRedraw();\n\t}\n\n\t// bring up the interactive editing mode for current object, if any\n\tpublic editCurrent():void\n\t{\n\t\tif (this.currentBond > 0)\n\t\t\tthis.editBond(this.currentBond);\n\t\telse\n\t\t\tthis.editAtom(this.currentAtom);\n\t}\n\n\t// pasted text from clipboard (can be activated from outside the widget, so is public)\n\tpublic pasteText(str:string):void\n\t{\n\t\tconst pasteLocal = () =>\n\t\t{\n\t\t\tlet mol = MoleculeStream.readUnknown(str);\n\t\t\tif (!mol)\n\t\t\t{\n\t\t\t\tlet ds = DataSheetStream.readXML(str);\n\t\t\t\tif (ds)\n\t\t\t\t{\n\t\t\t\t\touter: for (let r = 0; r < ds.numRows; r++) for (let c = 0; c < ds.numCols; c++) if (ds.colType(c) == DataSheetColumn.Molecule && ds.notNull(r, c))\n\t\t\t\t\t{\n\t\t\t\t\t\tmol = ds.getMolecule(r, c);\n\t\t\t\t\t\tbreak outer;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (mol != null) this.pasteMolecule(mol);\n\t\t\telse alert('Text from clipboard is not a valid molecule.');\n\t\t};\n\n\t\tif (this.callbackSpecialPaste)\n\t\t{\n\t\t\t(async () =>\n\t\t\t{\n\t\t\t\tlet mol = await this.callbackSpecialPaste(str);\n\t\t\t\tif (mol)\n\t\t\t\t\tthis.pasteMolecule(mol);\n\t\t\t\telse\n\t\t\t\t\tpasteLocal();\n\t\t\t})();\n\t\t}\n\t\telse pasteLocal();\n\t}\n\tpublic pasteMolecule(mol:Molecule):void\n\t{\n\t\tif (this.mol.numAtoms == 0)\n\t\t{\n\t\t\tthis.defineMolecule(mol, true, true, true);\n\t\t\treturn;\n\t\t}\n\n\t\t// special deal for pasting query-only features\n\t\tlet molact = new MoleculeActivity(this.getState(), ActivityType.QueryPaste, {qmol: mol});\n\t\tmolact.execute();\n\t\tif (molact.output.mol)\n\t\t{\n\t\t\tthis.defineMolecule(molact.output.mol, false, true, true);\n\t\t\treturn;\n\t\t}\n\n\t\tlet param = {fragNative: mol.toString()};\n\t\tnew MoleculeActivity(this.getState(), ActivityType.TemplateFusion, param, this).execute();\n\t}\n\n\t// changes the template permutation: if necessary requests the layout, and redraws the screen\n\tpublic pickTemplatePermutation(idx:number)\n\t{\n\t\tlet perm = this.templatePerms[idx];\n\t\tthis.currentPerm = idx;\n\n\t\tthis.layoutTemplatePerm();\n\t\tthis.delayedRedraw();\n\t}\n\n\t// bring up the dialog for converting the subject atoms into a polymer block repeating unit\n\tpublic performPolymerBlock(atoms:number[]):void\n\t{\n\t\tlet dlg = new EditPolymer(this.mol, atoms, this.proxyClip, () =>\n\t\t{\n\t\t\tif (this.mol.compareTo(dlg.mol) != 0) this.defineMolecule(dlg.mol, false, true, true);\n\t\t\tdlg.close();\n\t\t});\n\t\tdlg.callbackClose = () =>\n\t\t{\n\t\t\tthis.inDialog = false;\n\t\t\tthis.grabFocus();\n\t\t};\n\t\tthis.inDialog = true;\n\t\tdlg.open();\n\t}\n\n\t// ensure that focus is happening\n\tpublic grabFocus():void\n\t{\n\t\tthis.container.grabFocus();\n\t}\n\n\t// returns true if the sketcher is focused; the display of focus is not visible, but it is still recorded\n\tpublic hasFocus():boolean\n\t{\n\t\treturn this.container.hasFocus();\n\t}\n\n\t// ------------ private methods ------------\n\n\t// redetermines the offset and scale so that the molecular structure fits cleanly\n\tprivate centreAndShrink():void\n\t{\n\t\tif (this.mol.numAtoms == 0 || this.layout == null)\n\t\t{\n\t\t\tthis.offsetX = 0.5 * this.width;\n\t\t\tthis.offsetY = 0.5 * this.height;\n\t\t\tthis.pointScale = this.policy.data.pointScale;\n\t\t\treturn;\n\t\t}\n\n\t\tlet bounds = this.layout.determineBoundary(0);\n\n\t\tlet limW = this.width - 6, limH = this.height - 6;\n\t\tlet natW = bounds[2] - bounds[0], natH = bounds[3] - bounds[1];\n\n\t\tlet scale = 1;\n\t\tif (natW > limW)\n\t\t{\n\t\t\tlet down = limW / natW;\n\t\t\tscale *= down;\n\t\t\tnatW *= down;\n\t\t\tnatH *= down;\n\t\t}\n\t\tif (natH > limH)\n\t\t{\n\t\t\tlet down = limH / natH;\n\t\t\tscale *= down;\n\t\t\tnatW *= down;\n\t\t\tnatH *= down;\n\t\t}\n\n\t\tif (scale < 1)\n\t\t{\n\t\t\tthis.pointScale *= scale;\n\t\t\tthis.layout.offsetEverything(this.offsetX * scale, this.offsetY * scale);\n\t\t\tthis.layout.scaleEverything(scale);\n\t\t\tbounds = this.layout.determineBoundary(0);\n\t\t}\n\n\t\tlet dx = 0.5 * (limW - natW) - bounds[0], dy = 0.5 * (limH - natH) - bounds[1];\n\t\tthis.offsetX += dx;\n\t\tthis.offsetY += dy;\n\t\tthis.layout.offsetEverything(dx, dy);\n\t}\n\n\t// creates the template permutation rendering object using the same transform as the main molecule\n\tprivate layoutTemplatePerm():void\n\t{\n\t\tif (this.currentPerm < 0 || this.templatePerms == null) return;\n\t\tlet perm = this.templatePerms[this.currentPerm];\n\n\t\tlet tpolicy = new RenderPolicy(this.policy.data);\n\t\ttpolicy.data.foreground = 0x808080;\n\t\ttpolicy.data.atomCols = tpolicy.data.atomCols.slice(0);\n\t\tfor (let n in tpolicy.data.atomCols) tpolicy.data.atomCols[n] = 0x808080;\n\n\t\tlet effects = new RenderEffects();\n\t\tlet layout = new ArrangeMolecule(Molecule.fromString(perm.display), this, tpolicy, effects);\n\t\tlayout.arrange();\n\t\tperm.metavec = new MetaVector();\n\t\tnew DrawMolecule(layout, perm.metavec).draw();\n\t}\n\n\t// re-render the molecule into its graphical state buffers, then trigger a delayed re-splat onto the canvas; this is useful when the molecule\n\t// is to be displayed differently even though the molecule itself has not actually changed\n\tprivate renderMolecule():void\n\t{\n\t\tthis.layoutMolecule();\n\t\tthis.redrawMetaVector();\n\t\tthis.delayedRedraw();\n\t}\n\n\t// locates a molecular object at the given position: returns N for atom, -N for bond, 0 for nothing, or null for not-on-canvas (e.g. button banks)\n\tprotected pickObjectCanvas(x:number, y:number):number\n\t{\n\t\tif (this.layout == null) return 0;\n\n\t\t// if the position is over a buttonview, return zero (yes, this does happen)\n\t\tif (this.toolView != null)\n\t\t{\n\t\t\tlet pos1 = this.container.offset(), pos2 = this.toolView.contentDOM.offset();\n\t\t\tif (this.toolView.withinOutline(x + pos1.x - pos2.x, y + pos1.y - pos2.y)) return null;\n\t\t}\n\t\tif (this.commandView != null)\n\t\t{\n\t\t\tlet pos1 = this.container.offset(), pos2 = this.commandView.contentDOM.offset();\n\t\t\tif (this.commandView.withinOutline(x + pos1.x - pos2.x, y + pos1.y - pos2.y)) return null;\n\t\t}\n\t\tif (this.templateView != null)\n\t\t{\n\t\t\tlet pos1 = this.container.offset(), pos2 = this.templateView.contentDOM.offset();\n\t\t\tif (this.templateView.withinOutline(x + pos1.x - pos2.x, y + pos1.y - pos2.y)) return null;\n\t\t}\n\n\t\treturn super.pickObjectCanvas(x, y);\n\t}\n\n\t// response to some mouse event: hovering cursor restated\n\tprivate updateHoverCursor(x:number, y:number):void\n\t{\n\t\tlet tool = this.toolView ? this.toolView.selectedButton : '';\n\t\tlet toolApplies = tool && tool != ToolBankItem.Pan && tool != ToolBankItem.Rotate;\n\n\t\tlet mouseObj = 0;\n\n\t\tif (this.dragType == DraggingTool.None && toolApplies)\n\t\t{\n\t\t\tmouseObj = this.pickObject(x, y);\n\t\t}\n\t\tlet mouseAtom = mouseObj > 0 ? mouseObj : 0, mouseBond = mouseObj < 0 ? -mouseObj : 0;\n\n\t\tlet abbrevThen = this.hoverAtom > 0 && MolUtil.hasAbbrev(this.mol, this.hoverAtom) ? this.hoverAtom : 0;\n\t\tlet abbrevNow = mouseAtom > 0 && MolUtil.hasAbbrev(this.mol, mouseAtom) ? mouseAtom : 0;\n\n\t\tif (mouseAtom != this.hoverAtom || mouseBond != this.hoverBond)\n\t\t{\n\t\t\tthis.hoverAtom = mouseAtom;\n\t\t\tthis.hoverBond = mouseBond;\n\t\t\tif (abbrevThen != abbrevNow)\n\t\t\t{\n\t\t\t\tthis.layoutMolecule();\n\t\t\t\tthis.redrawMetaVector();\n\t\t\t}\n\t\t\tthis.delayedRedraw();\n\t\t}\n\t}\n\n\t// looks through the current list of available guidelines, and picks out the sprouting(s) that relate to the clicked atom, if any\n\tprivate determineDragGuide(order:number):GuidelineSprout[]\n\t{\n\t\t// special deal: if no atom clicked, create a fake one with 30 degree angles from the click position\n\t\tif (this.opAtom == 0 || this.mol.atomAdjCount(this.opAtom) == 0)\n\t\t{\n\t\t\tlet g:GuidelineSprout =\n\t\t\t{\n\t\t\t\tatom: this.opAtom,\n\t\t\t\torders: [order],\n\t\t\t\tx: [],\n\t\t\t\ty: [],\n\t\t\t\tsourceX: this.opAtom == 0 ? this.clickX : this.angToX(this.mol.atomX(this.opAtom)),\n\t\t\t\tsourceY: this.opAtom == 0 ? this.clickY : this.angToY(this.mol.atomY(this.opAtom)),\n\t\t\t\tdestX: [],\n\t\t\t\tdestY: []\n\t\t\t};\n\n\t\t\tlet mx = this.opAtom == 0 ? this.xToAng(this.clickX) : this.mol.atomX(this.opAtom);\n\t\t\tlet my = this.opAtom == 0 ? this.yToAng(this.clickY) : this.mol.atomY(this.opAtom);\n\t\t\tfor (let n = 0; n < 12; n++)\n\t\t\t{\n\t\t\t\tlet theta = TWOPI * n / 12;\n\t\t\t\tlet dx = Molecule.IDEALBOND * Math.cos(theta), dy = Molecule.IDEALBOND * Math.sin(theta);\n\t\t\t\tg.x.push(mx + dx);\n\t\t\t\tg.y.push(my + dy);\n\t\t\t\tg.destX.push(g.sourceX + dx * this.pointScale);\n\t\t\t\tg.destY.push(g.sourceY - dy * this.pointScale);\n\t\t\t}\n\n\t\t\treturn [g];\n\t\t}\n\n\t\tif (this.guidelines == null) return null;\n\n\t\tlet best:GuidelineSprout = null, single:GuidelineSprout = null;\n\t\tfor (let n = 0; n < this.guidelines.length; n++)\n\t\t{\n\t\t\tlet g = this.guidelines[n];\n\t\t\tif (g.atom != this.opAtom) continue;\n\t\t\tif (g.orders.indexOf(order) >= 0) {best = g; break;}\n\t\t\tif (g.orders.indexOf(1) >= 0) single = g;\n\t\t}\n\t\tif (best == null) best = single;\n\t\tif (best == null) return [];\n\n\t\tlet g = clone(best) as GuidelineSprout;\n\t\tg.sourceX = this.angToX(this.mol.atomX(g.atom));\n\t\tg.sourceY = this.angToY(this.mol.atomY(g.atom));\n\t\tg.destX = [];\n\t\tg.destY = [];\n\t\tfor (let n = 0; n < g.x.length; n++)\n\t\t{\n\t\t\tg.destX.push(this.angToX(g.x[n]));\n\t\t\tg.destY.push(this.angToY(g.y[n]));\n\t\t}\n\t\treturn [g];\n\t}\n\n\t// activates drag guidelines for moving atoms - this is anything besides the atoms that are being moved\n\tprivate determineMoveGuide():GuidelineSprout[]\n\t{\n\t\tlet subj = this.subjectAtoms(false, true);\n\t\tif (subj.length == 0 || subj.length == this.mol.numAtoms) return null;\n\n\t\tlet guides:GuidelineSprout[] = [];\n\t\tfor (let n = 0; n < this.guidelines.length; n++)\n\t\t{\n\t\t\tlet g = this.guidelines[n];\n\t\t\tif (g.orders.indexOf(1) < 0 || subj.indexOf(g.atom) >= 0) continue;\n\n\t\t\tg = clone(g) as GuidelineSprout;\n\t\t\tg.sourceX = this.angToX(this.mol.atomX(g.atom));\n\t\t\tg.sourceY = this.angToY(this.mol.atomY(g.atom));\n\t\t\tg.destX = [];\n\t\t\tg.destY = [];\n\t\t\tfor (let i = 0; i < g.x.length; i++)\n\t\t\t{\n\t\t\t\tg.destX.push(this.angToX(g.x[i]));\n\t\t\t\tg.destY.push(this.angToY(g.y[i]));\n\t\t\t}\n\t\t\tguides.push(g);\n\t\t}\n\t\treturn guides;\n\t}\n\n\t// interactively edit the given atom/bond\n\tprivate editAtom(atom:number):void\n\t{\n\t\tlet dlg = new EditAtom(this.mol, atom, this.proxyClip, () =>\n\t\t{\n\t\t\tif (this.mol.compareTo(dlg.mol) != 0) this.defineMolecule(dlg.mol, false, true, true);\n\t\t\tdlg.close();\n\t\t});\n\t\tdlg.callbackClose = () =>\n\t\t{\n\t\t\tthis.inDialog = false;\n\t\t\tthis.grabFocus();\n\t\t};\n\t\tif (atom == 0 && this.mol.numAtoms > 0)\n\t\t{\n\t\t\tlet box = this.mol.boundary();\n\t\t\tdlg.newX = box.maxX() + Molecule.IDEALBOND;\n\t\t\tdlg.newY = box.midY();\n\t\t}\n\t\tthis.inDialog = true;\n\t\tdlg.open();\n\t}\n\tprivate editBond(bond:number):void\n\t{\n\t\tif (bond == 0) return;\n\n\t\tlet dlg = new EditBond(this.mol, bond, this.proxyClip, () =>\n\t\t{\n\t\t\tif (this.mol.compareTo(dlg.mol) != 0) this.defineMolecule(dlg.mol, false, true, true);\n\t\t\tdlg.close();\n\t\t});\n\t\tdlg.callbackClose = () =>\n\t\t{\n\t\t\tthis.inDialog = false;\n\t\t\tthis.grabFocus();\n\t\t};\n\t\tthis.inDialog = true;\n\t\tdlg.open();\n\t}\n\n\t// move the current selection in one of the cardinal directions\n\tprivate hitArrowKey(dx:number, dy:number):void\n\t{\n\t\tlet watermark = ++this.cursorWatermark;\n\t\tthis.cursorDX += dx;\n\t\tthis.cursorDY += dy;\n\t\tsetTimeout(() =>\n\t\t{\n\t\t\tif (watermark == this.cursorWatermark) this.cursorJumpDirection();\n\t\t}, 100);\n\t}\n\n\t// given the direction of the cursor offset, try to move the current position in that direction\n\tprivate cursorJumpDirection():void\n\t{\n\t\tlet theta = Math.atan2(this.cursorDY, this.cursorDX);\n\t\tif (this.currentAtom > 0) this.jumpFromCurrentAtom(theta);\n\t\telse if (this.currentBond > 0) this.jumpFromCurrentBond(theta);\n\t\telse this.jumpFromNowhere(theta);\n\n\t\tthis.cursorDX = 0;\n\t\tthis.cursorDY = 0;\n\t\tthis.cursorWatermark = 0;\n\t}\n\tprivate jumpFromCurrentAtom(theta:number):void\n\t{\n\t\t// see if we can follow a bond\n\t\tlet adj = this.mol.atomAdjList(this.currentAtom);\n\t\tlet closest = 0, closestDelta = Number.MAX_VALUE;\n\t\tfor (let a of adj)\n\t\t{\n\t\t\tlet dx = this.mol.atomX(a) - this.mol.atomX(this.currentAtom), dy = this.mol.atomY(a) - this.mol.atomY(this.currentAtom);\n\t\t\tlet adjTheta = Math.atan2(dy, dx), delta = Math.abs(angleDiff(adjTheta, theta));\n\t\t\tif (delta < 35.0 * DEGRAD && delta < closestDelta) [closest, closestDelta] = [a, delta];\n\t\t}\n\t\tif (closest > 0)\n\t\t{\n\t\t\tthis.changeCurrentBond(this.mol.findBond(this.currentAtom, closest));\n\t\t\treturn;\n\t\t}\n\n\t\t// no bond to hop onto, so try jumping across a chasm\n\t\tlet best = 0, bestScore = Number.MIN_VALUE;\n\t\tfor (let n = 1; n <= this.mol.numAtoms; n++) if (n != this.currentAtom && adj.indexOf(n) < 0)\n\t\t{\n\t\t\tlet dx = this.mol.atomX(n) - this.mol.atomX(this.currentAtom), dy = this.mol.atomY(n) - this.mol.atomY(this.currentAtom);\n\t\t\tlet adjTheta = Math.atan2(dy, dx), delta = Math.abs(angleDiff(adjTheta, theta));\n\t\t\tif (delta > 45.0 * DEGRAD) continue; // must be in the cone\n\t\t\tlet cosdelta = Math.cos(delta);\n\t\t\tlet score = Math.pow(cosdelta, 2) / (norm2_xy(dx, dy) + 0.001);\n\t\t\tif (score > bestScore) [best, bestScore] = [n, score];\n\t\t}\n\t\tif (best > 0) this.changeCurrentAtom(best);\n\t}\n\tprivate jumpFromCurrentBond(theta:number):void\n\t{\n\t\tlet [bfr, bto] = this.mol.bondFromTo(this.currentBond);\n\t\tlet bondTheta = Math.atan2(this.mol.atomY(bto) - this.mol.atomY(bfr), this.mol.atomX(bto) - this.mol.atomX(bfr));\n\t\tif (Math.abs(angleDiff(theta, bondTheta)) < 50.0 * DEGRAD) this.changeCurrentAtom(bto);\n\t\tif (Math.abs(angleDiff(theta, bondTheta + Math.PI)) < 50.0 * DEGRAD) this.changeCurrentAtom(bfr);\n\t\t//  (otherwise do nothing)\n\t}\n\tprivate jumpFromNowhere(theta:number):void\n\t{\n\t\tif (this.mol.numAtoms == 0) return;\n\t\tif (this.mol.numAtoms == 1) {this.changeCurrentAtom(1); return;}\n\n\t\tlet cx = 0, cy = 0;\n\t\tfor (let n = 1; n <= this.mol.numAtoms; n++) {cx += this.mol.atomX(n); cy += this.mol.atomY(n);}\n\t\tlet inv = 1.0 / this.mol.numAtoms;\n\t\tcx *= inv; cy *= inv;\n\n\t\tlet best = 0, bestScore = Number.MIN_VALUE;\n\t\tfor (let n = 1; n <= this.mol.numAtoms; n++)\n\t\t{\n\t\t\tlet dx = this.mol.atomX(n) - cx, dy = this.mol.atomY(n) - cy, atheta = Math.atan2(dy, dx);\n\t\t\tlet cosdelta = Math.cos(Math.abs(angleDiff(theta + Math.PI, atheta)));\n\t\t\tlet score = cosdelta * norm_xy(dx, dy);\n\t\t\tif (score > bestScore) [best, bestScore] = [n, score];\n\t\t}\n\t\tif (best > 0) this.changeCurrentAtom(best);\n\t}\n\n\t// manufactures a ring of given size based on context\n\tprivate createRing(rsz:number, aromatic:boolean):void\n\t{\n\t\tconst {mol} = this;\n\t\tlet rx:number[] = null, ry:number[] = null;\n\t\tif (this.currentAtom > 0)\n\t\t{\n\t\t\tlet dx = 0, dy = 0, adj = mol.atomAdjList(this.currentAtom);\n\t\t\tlet x0 = mol.atomX(this.currentAtom), y0 = mol.atomY(this.currentAtom);\n\t\t\tfor (let a of adj)\n\t\t\t{\n\t\t\t\tdx -= mol.atomX(a) - x0;\n\t\t\t\tdy -= mol.atomY(a) - y0;\n\t\t\t}\n\t\t\tif (Math.abs(dx) < 0.001 && Math.abs(dy) < 0.001)\n\t\t\t{\n\t\t\t\tif (adj.length >= 2)\n\t\t\t\t{\n\t\t\t\t\tlet theta = adj.map((a) => Math.atan2(mol.atomY(a) - x0, mol.atomX(a) - y0));\n\t\t\t\t\tVec.sort(theta);\n\t\t\t\t\tlet best = Number.POSITIVE_INFINITY;\n\t\t\t\t\tfor (let n = 0; n < theta.length; n++)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet th = angleDiff(theta[(n + 1) % theta.length], theta[n]);\n\t\t\t\t\t\tlet lx = Math.cos(th), ly = Math.sin(th), score = CoordUtil.congestionPoint(mol, x0 + lx, y0 + ly);\n\t\t\t\t\t\tif (score < best) [best, dx, dy] = [score, lx, ly];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse [dx, dy] = [1, 0];\n\t\t\t}\n\t\t\t[rx, ry] = SketchUtil.proposeAtomRing(this.mol, rsz, this.currentAtom, dx, dy);\n\t\t}\n\t\telse if (this.currentBond > 0)\n\t\t{\n\t\t\tlet a1 = mol.bondFrom(this.currentBond), a2 = mol.bondTo(this.currentBond);\n\t\t\tlet x1 = mol.atomX(a1), y1 = mol.atomY(a1), x2 = mol.atomX(a2), y2 = mol.atomY(a2);\n\t\t\tlet cx = 0.5 * (x1 + x2), cy = 0.5 * (y1 + y2), ox = y1 - y2, oy = x2 - x1;\n\t\t\tlet [dx, dy] = CoordUtil.congestionPoint(mol, cx - ox, cy - oy) < CoordUtil.congestionPoint(mol, cx + ox, cy + oy) ? [-ox, -oy] : [ox, oy];\n\t\t\t[rx, ry] = SketchUtil.proposeBondRing(this.mol, rsz, this.currentBond, dx, dy);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet x = 0, y = 0;\n\t\t\tif (mol.numAtoms > 0)\n\t\t\t{\n\t\t\t\tlet bound = mol.boundary();\n\t\t\t\t[x, y] = [bound.maxX() + Molecule.IDEALBOND, bound.midY()];\n\t\t\t}\n\t\t\t[rx, ry] = SketchUtil.proposeNewRing(this.mol, rsz, x, y, 0, -1, false);\n\t\t}\n\n\t\tif (!rx) return;\n\n\t\tlet param:any =\n\t\t{\n\t\t\tringX: rx,\n\t\t\tringY: ry,\n\t\t\taromatic: aromatic\n\t\t};\n\t\tlet molact = new MoleculeActivity(this.getState(), ActivityType.Ring, param, this);\n\t\tmolact.execute();\n\t}\n\n\t// get sprout direction ready\n\tprivate ctrlArrowKey(dx:number, dy:number):void\n\t{\n\t\tlet watermark = ++this.cursorWatermark;\n\t\tthis.cursorDX += dx;\n\t\tthis.cursorDY += dy;\n\t\tsetTimeout(() =>\n\t\t{\n\t\t\tif (watermark == this.cursorWatermark)\n\t\t\t{\n\t\t\t\tthis.sproutDirection(this.cursorDX, this.cursorDY);\n\t\t\t\tthis.cursorDX = this.cursorDY = 0;\n\t\t\t}\n\t\t}, 100);\n\t}\n\n\t// starting with the current atom, creates a new bond jumping outward\n\tprivate sproutDirection(deltaX:number, deltaY:number):void\n\t{\n\t\tnew MoleculeActivity(this.getState(), ActivityType.SproutDirection, {deltaX, deltaY}, this).execute();\n\t}\n\n\t// --------------------------------------- toolkit events ---------------------------------------\n\n\t// event responses\n\tprivate mouseClick(event:MouseEvent):boolean\n\t{\n\t\tevent.stopPropagation();\n\t\tthis.grabFocus(); // just in case it wasn't already\n\t\treturn false;\n\t}\n\tprivate mouseDoubleClick(event:MouseEvent):boolean\n\t{\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\n\t\tif (this.toolView.selectedButton != ToolBankItem.Arrow) return;\n\n\t\tlet xy = eventCoords(event, this.container);\n\t\tlet clickObj = this.pickObject(xy[0], xy[1]);\n\t\tif (clickObj > 0)\n\t\t{\n\t\t\tlet atom = clickObj;\n\t\t\tthis.editAtom(atom);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet bond = -clickObj;\n\t\t\tthis.editBond(bond);\n\t\t}\n\t\treturn false;\n\t}\n\tprivate mouseDown(event:MouseEvent):boolean\n\t{\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\n\t\tthis.clearMessage();\n\n\t\tif (event.ctrlKey && !event.shiftKey && !event.altKey)\n\t\t{\n\t\t\tthis.contextMenu(event);\n\t\t\treturn;\n\t\t}\n\n\t\tlet [x, y] = eventCoords(event, this.container);\n\t\tthis.interactStart(x, y, event.shiftKey, event.ctrlKey, event.altKey);\n\n\t\treturn false;\n\t}\n\tprivate mouseUp(event:MouseEvent):boolean\n\t{\n\t\tevent.stopPropagation();\n\n\t\tlet [x, y] = eventCoords(event, this.container);\n\t\tthis.interactEnd(x, y);\n\n\t\treturn false;\n\t}\n\tprivate mouseOver(event:MouseEvent):boolean\n\t{\n\t\tevent.stopPropagation();\n\t\tlet [x, y] = eventCoords(event, this.container);\n\t\tthis.updateHoverCursor(x, y);\n\t\tthis.updateLasso(x, y);\n\t\treturn false;\n\t}\n\tprivate mouseOut(event:MouseEvent):boolean\n\t{\n\t\tevent.stopPropagation();\n\t\tlet [x, y] = eventCoords(event, this.container);\n\t\tthis.updateHoverCursor(x, y);\n\t\tthis.updateLasso(x, y);\n\t\treturn false;\n\t}\n\tprivate mouseMove(event:MouseEvent):boolean\n\t{\n\t\tevent.stopPropagation();\n\t\tlet [x, y] = eventCoords(event, this.container);\n\t\tthis.updateHoverCursor(x, y);\n\n\t\tif (this.dragType == DraggingTool.None) return; // mouse button isn't pressed\n\n\t\tthis.interactDrag(x, y);\n\n\t\treturn false;\n\t}\n\n\tprivate keyPressed(event:KeyboardEvent):void\n\t{\n\t\t//let ch = String.fromCharCode(event.keyCode || event.charCode);\n\t\t//console.log('PRESSED['+ch+'] key='+event.keyCode+' chcode='+event.charCode);\n\n\t\t// !! TODO: special cases, like arrow keys/escape...\n\n\t\t/*if (this.toolView != null && this.toolView.topBank.claimKey(event)) {event.preventDefault(); return;}\n\t\tif (this.commandView != null && this.commandView.topBank.claimKey(event)) {event.preventDefault(); return;}\n\t\tif (this.templateView != null && this.templateView.topBank.claimKey(event)) {event.preventDefault(); return;}*/\n\t}\n\tprivate keyDown(event:KeyboardEvent):void\n\t{\n\t\tlet key = event.key;\n\n\t\t// special deal for the escape key: if any bank needs to be popped, consume it\n\t\tif (key == KeyCode.Escape)\n\t\t{\n\t\t\tfor (let view of [this.templateView, this.commandView, this.toolView]) if (view != null && view.stackSize > 1)\n\t\t\t{\n\t\t\t\tview.popBank();\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tlet mod = (event.shiftKey ? 'S' : '') + (event.ctrlKey || event.metaKey ? 'C' : '') + (event.altKey ? 'A' : ''); // (meta==cmd on mac; alt=opt on mac)\n\t\tlet nomod = !event.shiftKey && !event.ctrlKey && !event.altKey && !event.metaKey;\n\n\t\t// console.log(`Sketcher/Key:${key} Mod:${mod} Date:${new Date()}`);\n\n\t\tif (key == KeyCode.Enter) this.editCurrent();\n\t\telse if (key == KeyCode.Left && nomod) this.hitArrowKey(-1, 0);\n\t\telse if (key == KeyCode.Right && nomod) this.hitArrowKey(1, 0);\n\t\telse if (key == KeyCode.Up && nomod) this.hitArrowKey(0, 1);\n\t\telse if (key == KeyCode.Down && nomod) this.hitArrowKey(0, -1);\n\t\telse if (key == 'z' && mod == 'C') this.performUndo();\n\t\telse if (key == 'Z' && mod == 'SC') this.performRedo();\n\t\telse if (key == 'z' && nomod) this.toolView.cycleSelected(-1);\n\t\telse if (key == 'x' && nomod) this.toolView.cycleSelected(1);\n\t\telse if (this.toolView != null && this.toolView.topBank.claimKey(event)) {}\n\t\telse if (this.commandView != null && this.commandView.topBank.claimKey(event)) {}\n\t\telse if (this.templateView != null && this.templateView.topBank.claimKey(event)) {}\n\t\telse if (key == '#' && mod == 'SC') this.createRing(3, false);\n\t\telse if (key == '$' && mod == 'SC') this.createRing(4, false);\n\t\telse if (key == '%' && mod == 'SC') this.createRing(5, false);\n\t\telse if (key == '^' && mod == 'SC') this.createRing(6, false);\n\t\telse if (key == '&' && mod == 'SC') this.createRing(7, false);\n\t\telse if (key == '3' && mod == 'CA') this.createRing(3, true);\n\t\telse if (key == '4' && mod == 'CA') this.createRing(4, true);\n\t\telse if (key == '5' && mod == 'CA') this.createRing(5, true);\n\t\telse if (key == '6' && mod == 'CA') this.createRing(6, true);\n\t\telse if (key == '7' && mod == 'CA') this.createRing(7, true);\n\t\telse if (key == 'c' && mod == 'C' && this.proxyClip) this.proxyClip.triggerCopy(false);\n\t\telse if (key == 'x' && mod == 'C' && this.proxyClip) this.proxyClip.triggerCopy(true);\n\t\telse if (key == 'v' && mod == 'C' && this.proxyClip && this.proxyClip.canAlwaysGet()) this.proxyClip.triggerPaste();\n\t\telse if (key == KeyCode.Left && mod == 'C') this.ctrlArrowKey(-1, 0);\n\t\telse if (key == KeyCode.Right && mod == 'C') this.ctrlArrowKey(1, 0);\n\t\telse if (key == KeyCode.Up && mod == 'C') this.ctrlArrowKey(0, 1);\n\t\telse if (key == KeyCode.Down && mod == 'C') this.ctrlArrowKey(0, -1);\n\t\telse if (key == '1' && mod == 'C') this.sproutDirection(-1, -1);\n\t\telse if (key == '2' && mod == 'C') this.sproutDirection(0, -1);\n\t\telse if (key == '3' && mod == 'C') this.sproutDirection(1, -1);\n\t\telse if (key == '4' && mod == 'C') this.sproutDirection(-1, 0);\n\t\telse if (key == '6' && mod == 'C') this.sproutDirection(1, 0);\n\t\telse if (key == '7' && mod == 'C') this.sproutDirection(-1, 1);\n\t\telse if (key == '8' && mod == 'C') this.sproutDirection(0, 1);\n\t\telse if (key == '9' && mod == 'C') this.sproutDirection(1, 1);\n\t\telse return; // allow the key to percolate upward\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t}\n\tprivate keyUp(event:KeyboardEvent):void\n\t{\n\t\t// ..\n\t}\n\tprivate touchStart(event:TouchEvent):void\n\t{\n\t\tlet [x, y] = eventCoords(event.touches[0], this.container);\n\t\tif (this.pickObjectCanvas(x, y) == null) return; // defer to an overlaying widget\n\n\t\tthis.interactStart(x, y, event.shiftKey, event.ctrlKey, event.altKey);\n\t\tevent.preventDefault();\n\t}\n\tprivate touchMove(event:TouchEvent):void\n\t{\n\t\tif (this.dragType != DraggingTool.None)\n\t\t{\n\t\t\tlet [x, y] = eventCoords(event.touches[0], this.container);\n\t\t\tthis.interactDrag(x, y);\n\t\t}\n\n\t\tevent.preventDefault(); // prevents panning around the place\n\t}\n\tprivate touchCancel(event:TouchEvent):void\n\t{\n\t\t//event.preventDefault();\n\t}\n\tprivate touchEnd(event:TouchEvent):void\n\t{\n\t\tif (this.dragType != DraggingTool.None)\n\t\t{\n\t\t\tlet [x, y] = [this.mouseX, this.mouseY]; // end events have 0 touches, so use last known\n\t\t\tthis.interactEnd(x, y);\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\tprivate mouseWheel(event:MouseEvent):void\n\t{\n\t\t/* maybe reinstate? not sure...\n\t\tlet xy = eventCoords(event, this.container);\n\t\tlet newScale = this.scale * (1 - event.deltaY * 0.1);\n\t\tnewScale = Math.min(10, Math.max(0.1, newScale));\n\t\tlet newOX = xy[0] - (newScale / this.scale) * (xy[0] - this.offsetX);\n\t\tlet newOY = xy[1] - (newScale / this.scale) * (xy[1] - this.offsetY);\n\n\t\tthis.scale = newScale;\n\t\tthis.offsetX = newOX;\n\t\tthis.offsetY = newOY;\n\n\t\tthis.delayedRedraw();\n\n\t\tevent.stopPropagation = true;\n\t\t*/\n\t}\n\tprivate contextMenu(event:MouseEvent):void\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tthis.dragType = DraggingTool.None;\n\n\t\tif (!this.proxyMenu) return;\n\n\t\tlet [x, y] = eventCoords(event, this.container);\n\t\tlet clickObj = this.pickObject(x, y);\n\t\tif (clickObj > 0) this.changeCurrentAtom(clickObj);\n\t\telse if (clickObj < 0) this.changeCurrentBond(-clickObj);\n\t\tlet state = this.getState();\n\n\t\tlet ctx = new ContextSketch(state, this, this.proxyClip);\n\t\tlet menu = ctx.populate();\n\t\tthis.proxyMenu.openContextMenu(menu, event);\n\t}\n\n\t// the mouse/touch sequence began\n\tprivate interactStart(x:number, y:number, shiftKey:boolean, ctrlKey:boolean, altKey:boolean):void\n\t{\n\t\tthis.dragType = DraggingTool.Press;\n\t\tthis.opBudged = false;\n\t\tthis.dragGuides = null;\n\n\t\tthis.mouseX = x;\n\t\tthis.mouseY = y;\n\t\tthis.clickX = x;\n\t\tthis.clickY = y;\n\n\t\tlet clickObj = this.pickObject(x, y);\n\t\tthis.opAtom = clickObj > 0 ? clickObj : 0;\n\t\tthis.opBond = clickObj < 0 ? -clickObj : 0;\n\t\tthis.opShift = shiftKey;\n\t\tthis.opCtrl = ctrlKey;\n\t\tthis.opAlt = altKey;\n\n\t\tlet tool = '';\n\t\tif (this.toolView != null) tool = this.toolView.selectedButton;\n\n\t\tif (tool == ToolBankItem.Arrow)\n\t\t{\n\t\t\t// special key modifiers for the arrow tool:\n\t\t\t//\t\tCTRL: open context menu\n\t\t\t//\t\tSHIFT: toggle selection of object [see mouseClick]\n\t\t\t//\t\tALT: enter pan-mode\n\t\t\t//\t\tALT+CTRL: enter zoom mode\n\t\t\tif (!this.opShift && !this.opCtrl && !this.opAlt)\n\t\t\t{\n\t\t\t\tthis.dragType = DraggingTool.Press;\n\t\t\t}\n\t\t\t//else if (!this.opShift && this.opCtrl && !this.opAlt) (done already)\n\t\t\telse if (!this.opShift && !this.opCtrl && this.opAlt)\n\t\t\t{\n\t\t\t\tthis.dragType = DraggingTool.Pan;\n\t\t\t}\n\t\t\telse if (!this.opShift && this.opCtrl && this.opAlt)\n\t\t\t{\n\t\t\t\tthis.dragType = DraggingTool.Zoom;\n\t\t\t}\n\t\t}\n\t\telse if (tool == ToolBankItem.Rotate)\n\t\t{\n\t\t\tthis.dragType = DraggingTool.Rotate;\n\t\t\tthis.toolRotateIncr = this.opShift ? 0 : 15 * DEGRAD;\n\t\t}\n\t\telse if (tool == ToolBankItem.Pan)\n\t\t{\n\t\t\tthis.dragType = DraggingTool.Pan;\n\t\t}\n\t\telse if (tool == ToolBankItem.Drag)\n\t\t{\n\t\t\tthis.dragType = DraggingTool.Move;\n\t\t\tif (this.opAtom > 0) this.dragGuides = this.determineMoveGuide();\n\t\t\tthis.delayedRedraw();\n\t\t}\n\t\telse if (tool == ToolBankItem.Erasor)\n\t\t{\n\t\t\tthis.dragType = DraggingTool.Erasor;\n\t\t\tthis.lassoX = [x];\n\t\t\tthis.lassoY = [y];\n\t\t\tthis.lassoMask = [];\n\t\t}\n\t\telse if (tool == ToolBankItem.RingAliph)\n\t\t{\n\t\t\tthis.dragType = DraggingTool.Ring;\n\t\t\tthis.toolRingArom = false;\n\t\t\tthis.toolRingFreeform = this.opShift;\n\t\t}\n\t\telse if (tool == ToolBankItem.RingArom)\n\t\t{\n\t\t\tthis.dragType = DraggingTool.Ring;\n\t\t\tthis.toolRingArom = true;\n\t\t\tthis.toolRingFreeform = this.opShift;\n\t\t}\n\t\telse if (tool == ToolBankItem.AtomPlus)\n\t\t{\n\t\t\tthis.dragType = DraggingTool.Charge;\n\t\t\tthis.toolChargeDelta = 1;\n\t\t}\n\t\telse if (tool == ToolBankItem.AtomMinus)\n\t\t{\n\t\t\tthis.dragType = DraggingTool.Charge;\n\t\t\tthis.toolChargeDelta = -1;\n\t\t}\n\t\telse if (tool.startsWith(ToolBankItem.BondPfx))\n\t\t{\n\t\t\tthis.dragType = DraggingTool.Bond;\n\t\t\tthis.toolBondOrder = 1;\n\t\t\tthis.toolBondType = Molecule.BONDTYPE_NORMAL;\n\n\t\t\tif (tool == ToolBankItem.BondOrder0) this.toolBondOrder = 0;\n\t\t\telse if (tool == ToolBankItem.BondOrder2) this.toolBondOrder = 2;\n\t\t\telse if (tool == ToolBankItem.BondOrder3) this.toolBondOrder = 3;\n\t\t\telse if (tool == ToolBankItem.BondUnknown) this.toolBondType = Molecule.BONDTYPE_UNKNOWN;\n\t\t\telse if (tool == ToolBankItem.BondInclined) this.toolBondType = Molecule.BONDTYPE_INCLINED;\n\t\t\telse if (tool == ToolBankItem.BondDeclined) this.toolBondType = Molecule.BONDTYPE_DECLINED;\n\n\t\t\t// drag-from-bond is only a thing when polymers are involved\n\t\t\tif (this.opBond > 0)\n\t\t\t{\n\t\t\t\tlet [bfr, bto] = this.mol.bondFromTo(this.opBond), inPoly = false;\n\t\t\t\tfor (let poly of new PolymerBlock(this.mol).getUnits())\n\t\t\t\t{\n\t\t\t\t\tlet in1 = poly.atoms.includes(bfr), in2 = poly.atoms.includes(bto);\n\t\t\t\t\tif ((in1 && !in2) || (in2 && !in1)) {inPoly = true; break;}\n\t\t\t\t}\n\t\t\t\tif (inPoly)\n\t\t\t\t{\n\t\t\t\t\tthis.toolBondOrder = 0;\n\t\t\t\t\tthis.toolBondType = Molecule.BONDTYPE_NORMAL;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.opBond == 0) this.dragGuides = this.determineDragGuide(this.toolBondOrder);\n\t\t}\n\t\telse if (tool.startsWith(ToolBankItem.ElementPfx))\n\t\t{\n\t\t\tthis.dragType = DraggingTool.Atom;\n\t\t\tthis.toolAtomSymbol = tool.substring(ToolBankItem.ElementPfx.length);\n\t\t\tthis.dragGuides = this.determineDragGuide(1);\n\t\t}\n\t}\n\n\t// the mouse/touch was moved to a new position, respond accordingly\n\tprotected interactDrag(x:number, y:number)\n\t{\n\t\t// once the mouse has moved more than a few pixels, it fips into \"drag mode\" rather than \"click mode\"\n\t\tif (!this.opBudged)\n\t\t{\n\t\t\tlet dx = x - this.clickX, dy = y - this.clickY;\n\t\t\tif (dx * dx + dy * dy > 2 * 2) this.opBudged = true;\n\t\t}\n\n\t\t// switch lasso mode on if it becomes an open drag\n\t\tif (this.dragType == DraggingTool.Press && this.opAtom == 0 && this.opBond == 0 && this.opBudged)\n\t\t{\n\t\t\tthis.dragType = DraggingTool.Lasso;\n\t\t\tthis.lassoX = [x];\n\t\t\tthis.lassoY = [y];\n\t\t\tthis.lassoMask = [];\n\t\t}\n\n\t\t// update the various dragging-already tools\n\t\tif (this.dragType == DraggingTool.Lasso || this.dragType == DraggingTool.Erasor)\n\t\t{\n\t\t\tthis.updateLasso(x, y);\n\t\t}\n\t\telse if (this.dragType == DraggingTool.Pan)\n\t\t{\n\t\t\tlet dx = x - this.mouseX, dy = y - this.mouseY;\n\n\t\t\tif (dx != 0 || dy != 0)\n\t\t\t{\n\t\t\t\tthis.offsetX += dx;\n\t\t\t\tthis.offsetY += dy;\n\t\t\t\tthis.layout.offsetEverything(dx, dy);\n\t\t\t\tthis.metavec.transformPrimitives(dx, dy, 1, 1);\n\n\t\t\t\tif (this.currentPerm >= 0 && this.templatePerms != null)\n\t\t\t\t{\n\t\t\t\t\tlet perm = this.templatePerms[this.currentPerm];\n\t\t\t\t\t//perm.layout.offsetEverything(dx, dy);\n\t\t\t\t\tperm.metavec.transformPrimitives(dx, dy, 1, 1);\n\t\t\t\t}\n\n\t\t\t\tthis.delayedRedraw();\n\t\t\t}\n\n\t\t\tthis.mouseX = x;\n\t\t\tthis.mouseY = y;\n\t\t}\n\t\telse if (this.dragType == DraggingTool.Zoom)\n\t\t{\n\t\t\tlet dy = y - this.mouseY;\n\n\t\t\tif (dy != 0)\n\t\t\t{\n\t\t\t\tdy = Math.min(50, Math.max(-50, dy));\n\t\t\t\tlet newScale = this.pointScale * (1 - dy * 0.01);\n\t\t\t\tnewScale = Math.min(10, Math.max(0.1, newScale));\n\t\t\t\tlet newOX = this.clickX - (newScale / this.pointScale) * (this.clickX - this.offsetX);\n\t\t\t\tlet newOY = this.clickY - (newScale / this.pointScale) * (this.clickY - this.offsetY);\n\n\t\t\t\tthis.pointScale = newScale;\n\t\t\t\tthis.offsetX = newOX;\n\t\t\t\tthis.offsetY = newOY;\n\n\t\t\t\tthis.delayedRedraw();\n\t\t\t}\n\n\t\t\tthis.mouseX = x;\n\t\t\tthis.mouseY = y;\n\t\t}\n\t\telse if (this.dragType == DraggingTool.Rotate ||\n\t\t\t\tthis.dragType == DraggingTool.Move ||\n\t\t\t\tthis.dragType == DraggingTool.Atom ||\n\t\t\t\tthis.dragType == DraggingTool.Bond ||\n\t\t\t\tthis.dragType == DraggingTool.Ring)\n\t\t{\n\t\t\tthis.mouseX = x;\n\t\t\tthis.mouseY = y;\n\t\t\tthis.delayedRedraw();\n\t\t}\n\t}\n\n\t// the mouse/touch interaction completed, respond accordingly\n\tprivate interactEnd(x:number, y:number):void\n\t{\n\t\tif (this.opBudged)\n\t\t\tthis.interactEndDrag(x, y);\n\t\telse\n\t\t\tthis.interactEndClick(x, y);\n\n\t\tthis.dragType = DraggingTool.None;\n\t\tthis.lassoX = null;\n\t\tthis.lassoY = null;\n\t\tthis.lassoMask = null;\n\t\tthis.dragGuides = null;\n\t\tthis.delayedRedraw();\n\t}\n\tprivate interactEndClick(x:number, y:number):void\n\t{\n\t\tlet clickObj = this.pickObject(x, y);\n\t\tlet clickAtom = clickObj > 0 ? clickObj : 0, clickBond = clickObj < 0 ? -clickObj : 0;\n\n\t\tif (this.dragType == DraggingTool.Press)\n\t\t{\n\t\t\t// special key modifiers for the arrow tool:\n\t\t\t//\t\tCTRL: open context menu [see mouseDown]\n\t\t\t//\t\tSHIFT: toggle selection of object\n\t\t\t//\t\tALT: enter pan-mode [see mouseDown]\n\t\t\t//\t\tALT+CTRL: enter zoom mode [see mouseDown]\n\n\t\t\tif (!this.opShift && !this.opCtrl && !this.opAlt)\n\t\t\t{\n\t\t\t\tif (clickAtom == 0 && clickBond == 0)\n\t\t\t\t{\n\t\t\t\t\tif (Vec.anyTrue(this.selectedMask)) this.selectedMask = null;\n\t\t\t\t\telse if (this.currentAtom > 0) this.currentAtom = 0;\n\t\t\t\t\telse if (this.currentBond > 0) this.currentBond = 0;\n\t\t\t\t}\n\t\t\t\telse if (clickAtom != this.currentAtom || clickBond != this.currentBond)\n\t\t\t\t{\n\t\t\t\t\tthis.currentAtom = clickAtom;\n\t\t\t\t\tthis.currentBond = clickBond;\n\t\t\t\t}\n\t\t\t\telse if (clickAtom == 0 && clickBond == 0 && this.anySelected())\n\t\t\t\t{\n\t\t\t\t\tthis.selectedMask = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.opShift && !this.opCtrl && !this.opAlt)\n\t\t\t{\n\t\t\t\tif (clickAtom > 0) this.setSelected(clickAtom, !this.getSelected(clickAtom));\n\t\t\t}\n\t\t}\n\t\telse if (this.dragType == DraggingTool.Move)\n\t\t{\n\t\t\tif (clickObj == 0)\n\t\t\t{\n\t\t\t\tif (Vec.anyTrue(this.selectedMask)) this.selectedMask = null;\n\t\t\t\telse if (this.currentAtom > 0) this.currentAtom = 0;\n\t\t\t\telse if (this.currentBond > 0) this.currentBond = 0;\n\t\t\t}\n\t\t}\n\t\telse if (this.dragType == DraggingTool.Erasor)\n\t\t{\n\t\t\tif (this.opAtom > 0 || this.opBond > 0)\n\t\t\t{\n\t\t\t\tlet state =\n\t\t\t\t{\n\t\t\t\t\t...this.getState(),\n\t\t\t\t\t'currentAtom': this.opAtom,\n\t\t\t\t\t'currentBond': this.opBond,\n\t\t\t\t\t'selectedMask': [] as boolean[]\n\t\t\t\t};\n\t\t\t\tlet molact = new MoleculeActivity(state, ActivityType.Delete, {}, this);\n\t\t\t\tmolact.execute();\n\t\t\t}\n\t\t}\n\t\telse if (this.dragType == DraggingTool.Atom)\n\t\t{\n\t\t\tlet element = this.toolAtomSymbol;\n\t\t\tif (element == 'A')\n\t\t\t{\n\t\t\t\tlet dlg = new EditAtom(this.mol, this.opAtom, this.proxyClip, () =>\n\t\t\t\t{\n\t\t\t\t\tlet autoscale = this.mol.numAtoms == 0;\n\t\t\t\t\tif (this.mol.compareTo(dlg.mol) != 0) this.defineMolecule(dlg.mol, autoscale, true);\n\t\t\t\t\tdlg.close();\n\t\t\t\t});\n\t\t\t\tif (this.opAtom == 0)\n\t\t\t\t{\n\t\t\t\t\tdlg.newX = this.xToAng(this.clickX);\n\t\t\t\t\tdlg.newY = this.yToAng(this.clickY);\n\t\t\t\t}\n\t\t\t\tdlg.callbackClose = () =>\n\t\t\t\t{\n\t\t\t\t\tthis.inDialog = false;\n\t\t\t\t\tthis.grabFocus();\n\t\t\t\t};\n\t\t\t\tthis.inDialog = true;\n\t\t\t\tdlg.open();\n\t\t\t}\n\t\t\telse if (element)\n\t\t\t{\n\t\t\t\tlet param:any = {element, keepAbbrev: true};\n\t\t\t\tif (this.opAtom == 0)\n\t\t\t\t{\n\t\t\t\t\tlet x = this.xToAng(this.clickX), y = this.yToAng(this.clickY);\n\t\t\t\t\tif (this.mol.numAtoms == 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.offsetX = this.clickX;\n\t\t\t\t\t\tthis.offsetY = this.clickY;\n\t\t\t\t\t\tx = 0;\n\t\t\t\t\t\ty = 0;\n\t\t\t\t\t}\n\t\t\t\t\tparam.positionX = x;\n\t\t\t\t\tparam.positionY = y;\n\t\t\t\t}\n\t\t\t\tlet state =\n\t\t\t\t{\n\t\t\t\t\t...this.getState(),\n\t\t\t\t\tcurrentAtom: this.opAtom,\n\t\t\t\t\tcurrentBond: 0,\n\t\t\t\t\tselectedMask: null as boolean[]\n\t\t\t\t};\n\t\t\t\tlet molact = new MoleculeActivity(state, ActivityType.Element, param, this);\n\t\t\t\tmolact.execute();\n\t\t\t}\n\t\t}\n\t\telse if (this.dragType == DraggingTool.Charge)\n\t\t{\n\t\t\tif (this.opAtom > 0 || this.opBond > 0)\n\t\t\t{\n\t\t\t\tlet state =\n\t\t\t\t{\n\t\t\t\t\t...this.getState(),\n\t\t\t\t\tcurrentAtom: this.opAtom,\n\t\t\t\t\tcurrentBond: this.opBond,\n\t\t\t\t\tselectedMask: null as boolean[]\n\t\t\t\t};\n\t\t\t\tlet molact = new MoleculeActivity(state, ActivityType.Charge, {delta: this.toolChargeDelta}, this);\n\t\t\t\tmolact.execute();\n\t\t\t}\n\t\t}\n\t\telse if (this.dragType == DraggingTool.Bond)\n\t\t{\n\t\t\tlet state =\n\t\t\t{\n\t\t\t\t...this.getState(),\n\t\t\t\tcurrentAtom: this.opAtom,\n\t\t\t\tcurrentBond: this.opBond,\n\t\t\t\tselectedMask: null as boolean[]\n\t\t\t};\n\t\t\tlet molact:MoleculeActivity;\n\t\t\tif (this.toolBondType == Molecule.BONDTYPE_NORMAL)\n\t\t\t\tmolact = new MoleculeActivity(state, ActivityType.BondOrder, {order: this.toolBondOrder}, this);\n\t\t\telse\n\t\t\t\tmolact = new MoleculeActivity(state, ActivityType.BondType, {type: this.toolBondType}, this);\n\t\t\tmolact.execute();\n\t\t}\n\t}\n\tprivate interactEndDrag(x:number, y:number):void\n\t{\n\t\tif (this.dragType == DraggingTool.Lasso)\n\t\t{\n\t\t\tif (this.lassoX.length >= 2)\n\t\t\t{\n\t\t\t\tthis.calculateLassoMask();\n\t\t\t\tfor (let n = 1; n <= this.mol.numAtoms; n++) if (this.getLassoed(n) && !this.getSelected(n)) this.setSelected(n, true);\n\t\t\t}\n\n\t\t\tthis.lassoX = null;\n\t\t\tthis.lassoY = null;\n\t\t\tthis.lassoMask = null;\n\t\t\tthis.delayedRedraw();\n\t\t}\n\t\telse if (this.dragType == DraggingTool.Erasor)\n\t\t{\n\t\t\tlet any = false;\n\t\t\tfor (let n = 0; n < this.lassoMask.length; n++) if (this.lassoMask[n]) {any = true; break;}\n\t\t\tif (any)\n\t\t\t{\n\t\t\t\tlet state =\n\t\t\t\t{\n\t\t\t\t\t...this.getState(),\n\t\t\t\t\tcurrentAtom: 0,\n\t\t\t\t\tcurrentBond: 0,\n\t\t\t\t\tselectedMask: this.lassoMask\n\t\t\t\t};\n\t\t\t\tlet molact = new MoleculeActivity(state, ActivityType.Delete, {}, this);\n\t\t\t\tmolact.execute();\n\t\t\t}\n\t\t}\n\t\telse if (this.dragType == DraggingTool.Rotate)\n\t\t{\n\t\t\tlet [x0, y0, theta, magnitude] = this.determineDragTheta();\n\t\t\tlet degrees = -theta * RADDEG;\n\t\t\tlet mx = this.xToAng(x0), my = this.yToAng(y0);\n\t\t\tlet molact = new MoleculeActivity(this.getState(), ActivityType.Rotate, {theta: degrees, centreX: mx, centreY: my}, this);\n\t\t\tmolact.execute();\n\t\t}\n\t\telse if (this.dragType == DraggingTool.Move)\n\t\t{\n\t\t\tlet [dx, dy] = this.determineMoveDelta();\n\t\t\tlet scale = this.pointScale;\n\t\t\t// note: in a future iteration, make the 'Move' action do rotate-snap-rebond, and call it during the mousemove, to give dynamic feedback\n\t\t\tlet molact = new MoleculeActivity(this.getState(), ActivityType.Move, {refAtom: this.opAtom, deltaX: dx / scale, deltaY: -dy / scale}, this);\n\t\t\tmolact.execute();\n\t\t}\n\t\telse if (this.dragType == DraggingTool.Ring)\n\t\t{\n\t\t\tlet [ringX, ringY] = this.determineFauxRing();\n\t\t\tif (ringX != null)\n\t\t\t{\n\t\t\t\tlet param:any =\n\t\t\t\t{\n\t\t\t\t\tringX: ringX,\n\t\t\t\t\tringY: ringY,\n\t\t\t\t\taromatic: this.toolRingArom\n\t\t\t\t};\n\t\t\t\tlet molact = new MoleculeActivity(this.getState(), ActivityType.Ring, param, this);\n\t\t\t\tmolact.execute();\n\t\t\t}\n\t\t}\n\t\telse if (this.dragType == DraggingTool.Atom && this.opAtom > 0)\n\t\t{\n\t\t\tlet x2 = this.mouseX, y2 = this.mouseY;\n\t\t\tlet snapTo = this.snapToGuide(x2, y2);\n\t\t\tif (snapTo != null) [x2, y2] = snapTo;\n\n\t\t\tlet param:any =\n\t\t\t{\n\t\t\t\torder: 1,\n\t\t\t\ttype: Molecule.BONDTYPE_NORMAL,\n\t\t\t\telement: this.toolAtomSymbol,\n\t\t\t\tx1: this.mol.atomX(this.opAtom),\n\t\t\t\ty1: this.mol.atomY(this.opAtom),\n\t\t\t\tx2: this.xToAng(x2),\n\t\t\t\ty2: this.yToAng(y2)\n\t\t\t};\n\n\t\t\tif (this.toolAtomSymbol == 'A') param.element = window.prompt('Enter element symbol:', '');\n\t\t\tif (param.element != '')\n\t\t\t{\n\t\t\t\tlet molact = new MoleculeActivity(this.getState(), ActivityType.BondAtom, param, this);\n\t\t\t\tmolact.execute();\n\t\t\t}\n\t\t}\n\t\telse if (this.dragType == DraggingTool.Bond)\n\t\t{\n\t\t\tlet x2 = this.mouseX, y2 = this.mouseY;\n\t\t\tlet snapTo = this.snapToGuide(x2, y2);\n\t\t\tif (snapTo != null)\n\t\t\t{\n\t\t\t\t[x2, y2] = snapTo;\n\t\t\t\tif (this.opBond > 0)\n\t\t\t\t{\n\t\t\t\t\tlet toObj = this.pickObject(x2, y2, {noAtoms: true});\n\t\t\t\t\tif (toObj < 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.connectPolymerBlock(this.opBond, -toObj);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet param:any =\n\t\t\t{\n\t\t\t\torder: this.toolBondOrder,\n\t\t\t\ttype: this.toolBondType,\n\t\t\t\telement: 'C',\n\t\t\t\tx1: this.opAtom == 0 ? this.xToAng(this.clickX) : this.mol.atomX(this.opAtom),\n\t\t\t\ty1: this.opAtom == 0 ? this.yToAng(this.clickY) : this.mol.atomY(this.opAtom),\n\t\t\t\tx2: this.xToAng(x2),\n\t\t\t\ty2: this.yToAng(y2)\n\t\t\t};\n\t\t\tlet molact = new MoleculeActivity(this.getState(), ActivityType.BondAtom, param, this);\n\t\t\tmolact.execute();\n\t\t}\n\t}\n\n\t// something was dragged into the sketcher area\n\tprivate dropInto(transfer:DataTransfer):void\n\t{\n\t\tlet items = transfer.items, files = transfer.files;\n\n\t\tconst SUFFIXES = ['.el', '.mol'];\n\t\tconst MIMES = ['text/plain', 'chemical/x-sketchel', 'x-mdl-molfile'];\n\n\t\t//console.log('DROP-INTO: items=' +  items.length + ', files=' + files.length);\n\n\t\tfor (let n = 0; n < items.length; n++)\n\t\t{\n\t\t\tif (items[n].kind == 'string' && MIMES.indexOf(items[n].type) >= 0)\n\t\t\t{\n\t\t\t\titems[n].getAsString((str:string) =>\n\t\t\t\t{\n\t\t\t\t\tlet mol = Molecule.fromString(str);\n\t\t\t\t\tif (mol != null)\n\t\t\t\t\t{\n\t\t\t\t\t\t// (maybe do an intelligent append/paste, using the coordinates, rather than blowing it away?)\n\t\t\t\t\t\tthis.defineMolecule(mol, true, true, true);\n\t\t\t\t\t}\n\t\t\t\t\telse console.log('Dragged data is not a SketchEl molecule: ' + str);\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t//console.log('ITEMS['+n+']: ' + items[n].kind+',type='+items[n].type);\n\t\t}\n\t\tfor (let n = 0; n < files.length; n++)\n\t\t{\n\t\t\tfor (let sfx of SUFFIXES) if (files[n].name.endsWith(sfx))\n\t\t\t{\n\t\t\t\tlet reader = new FileReader();\n\t\t\t\treader.onload = (event) =>\n\t\t\t\t{\n\t\t\t\t\tlet str = reader.result;\n\t\t\t\t\tlet mol = MoleculeStream.readUnknown(str.toString());\n\t\t\t\t\tif (mol != null)\n\t\t\t\t\t{\n\t\t\t\t\t\t// (maybe do an intelligent append/paste, using the coordinates, rather than blowing it away?)\n\t\t\t\t\t\tthis.defineMolecule(mol, true, true);\n\t\t\t\t\t}\n\t\t\t\t\telse console.log('Dragged file is not a recognised molecule: ' + str);\n\t\t\t\t};\n\t\t\t\treader.readAsText(files[n]);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t//console.log('DRAGFILE['+n+']: ' + files[n].name+',sz='+files[n].size+',type='+files[n].type);\n\t\t}\n\t}\n\n\t// special case when dragging a 0-order bond between two atoms in a polymer block: add to the opt-in naming list rather than making a bond\n\tprivate connectPolymerBlock(bond1:number, bond2:number):boolean\n\t{\n\t\tlet [atomIn1, atomOut1] = this.mol.bondFromTo(bond1), [atomIn2, atomOut2] = this.mol.bondFromTo(bond2);\n\n\t\tlet state = this.getState();\n\t\tlet polymer = new PolymerBlock(state.mol);\n\n\t\tlet poly1:PolymerBlockUnit = null, poly2:PolymerBlockUnit = null;\n\t\tlet highName = 0;\n\t\tfor (let poly of polymer.getUnits())\n\t\t{\n\t\t\tif (!poly1 || poly.atoms.length < poly1.atoms.length)\n\t\t\t{\n\t\t\t\tlet ina = poly.atoms.includes(atomIn1), inb = poly.atoms.includes(atomOut1);\n\t\t\t\tif (ina && !inb) poly1 = poly;\n\t\t\t\telse if (inb && !ina) [poly1, atomIn1, atomOut1] = [poly, atomOut1, atomIn1];\n\t\t\t}\n\t\t\tif (!poly2 || poly.atoms.length < poly2.atoms.length)\n\t\t\t{\n\t\t\t\tlet ina = poly.atoms.includes(atomIn2), inb = poly.atoms.includes(atomOut2);\n\t\t\t\tif (ina && !inb) poly2 = poly;\n\t\t\t\telse if (inb && !ina) [poly2, atomIn2, atomOut2] = [poly, atomOut2, atomIn2];\n\t\t\t}\n\n\t\t\tfor (let nameList of poly.atomName.values()) highName = Math.max(highName, Vec.max(nameList));\n\t\t}\n\t\tif (!poly1 || !poly2) return false;\n\n\t\t//console.log('BONDS:'+[bond1,bond2]+' ATOMS:'+[atomIn1,atomOut1]+' '+[atomIn2,atomOut2]);\n\n\t\tlet name1 = Vec.first(poly1.atomName.get(atomIn1));\n\t\tif (!name1)\n\t\t{\n\t\t\tname1 = ++highName;\n\t\t\tpoly1.atomName.set(atomIn1, [name1]);\n\t\t}\n\t\tlet name2 = Vec.first(poly2.atomName.get(atomIn2));\n\t\tif (!name2)\n\t\t{\n\t\t\tname2 = ++highName;\n\t\t\tpoly2.atomName.set(atomIn2, [name2]);\n\t\t}\n\n\t\tpoly1.bondIncl.set(bond1, Vec.append(poly1.bondIncl.get(bond1), name2));\n\t\tpoly2.bondIncl.set(bond2, Vec.append(poly2.bondIncl.get(bond2), name1));\n\n\t\tpolymer.rewriteMolecule();\n\t\tthis.setState(state);\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Molecule} from '../data/Molecule';\nimport {Sketcher} from '../sketcher/Sketcher';\nimport {ClipboardProxy, ClipboardProxyHandler} from '../ui/ClipboardProxy';\nimport {MenuProxy} from '../ui/MenuProxy';\nimport {dom, DOM} from '../util/dom';\nimport {Dialog} from './Dialog';\n\n/*\n\tProvides a wrapper dialog for the editing of a molecule. The main feature is an instance of molsync.ui.EditMolecule, but it also adds\n\tvarious other widgets.\n*/\n\nexport class EditCompound extends Dialog\n{\n\tprotected btnClear:DOM;\n\tprotected btnCopy:DOM;\n\tprotected btnSave:DOM;\n\tprotected sketcher = new Sketcher();\n\n\tprivate proxyClip:ClipboardProxy = null;\n\tprivate proxyMenu:MenuProxy = null;\n\n\tprivate callbackSave:(source?:EditCompound) => void = null;\n\n\t// ------------ public methods ------------\n\n\tconstructor(private mol:Molecule, parent:any= null)\n\t{\n\t\tsuper(parent);\n\n\t\tthis.title = 'Edit Compound';\n\t\tthis.minPortionWidth = 20;\n\t\tthis.maxPortionWidth = 95;\n\t}\n\n\tpublic onSave(callback:(source?:EditCompound) => void)\n\t{\n\t\tthis.callbackSave = callback;\n\t}\n\n\tpublic getMolecule():Molecule {return this.sketcher.getMolecule();}\n\tpublic getSketcher():Sketcher {return this.sketcher;}\n\n\tpublic defineClipboard(proxy:ClipboardProxy):void\n\t{\n\t\tthis.proxyClip = proxy;\n\n\t\tlet handler = new ClipboardProxyHandler();\n\t\thandler.copyEvent = (andCut:boolean, proxy:ClipboardProxy):boolean =>\n\t\t{\n\t\t\tthis.sketcher.performCopySelection(andCut);\n\t\t\treturn true;\n\t\t};\n\t\thandler.pasteEvent = (proxy:ClipboardProxy):boolean =>\n\t\t{\n\t\t\tthis.sketcher.pasteText(proxy.getString());\n\t\t\treturn true;\n\t\t};\n\t\tproxy.pushHandler(handler);\n\t\tthis.sketcher.defineClipboard(proxy);\n\t}\n\n\tpublic defineContext(proxy:MenuProxy):void\n\t{\n\t\tthis.proxyMenu = proxy;\n\t\tthis.sketcher.defineContext(this.proxyMenu);\n\t}\n\n\tpublic close():void\n\t{\n\t\tif (this.proxyClip) this.proxyClip.popHandler();\n\n\t\tsuper.close();\n\t}\n\n\t// builds the dialog content\n\tprotected populate():void\n\t{\n\t\tlet buttons = this.buttonsDOM(), body = this.bodyDOM();\n\n\t\tthis.btnClear = dom('<button class=\"wmk-button wmk-button-default\">Clear</button>').appendTo(buttons).css({'margin-left': '0.5em'});\n\t\tthis.btnClear.onClick(() => this.sketcher.clearMolecule());\n\n\t\tthis.btnCopy = dom('<button class=\"wmk-button wmk-button-default\">Copy</button>').appendTo(buttons).css({'margin-left': '0.5em'});\n\t\tthis.btnCopy.onClick(() => this.actionCopy());\n\n\t\tbuttons.append(this.domClose); // easy way to reorder\n\t\tthis.domClose.css({'margin-left': '0.5em'});\n\n\t\tthis.btnSave = dom('<button class=\"wmk-button wmk-button-primary\">Save</button>').appendTo(buttons).css({'margin-left': '0.5em'});\n\t\tthis.btnSave.onClick(() => {if (this.callbackSave) this.callbackSave(this);});\n\n\t\tlet skw = 800, skh = 650;\n\t\tlet skdiv = dom('<div/>').appendTo(body).css({'width': `${skw}px`, 'height': `${skh}px`});\n\n\t\tthis.sketcher.setSize(skw, skh);\n\t\tthis.sketcher.defineMolecule(this.mol);\n\t\tthis.sketcher.setup(() => this.sketcher.render(skdiv));\n\t}\n\n\tpublic actionCopy():void\n\t{\n\t\tthis.sketcher.performCopySelection(false);\n\t}\n\tpublic actionCut():void\n\t{\n\t\tthis.sketcher.performCopySelection(true);\n\t}\n\tpublic actionPaste():void\n\t{\n\t\tthis.sketcher.performPaste();\n\t}\n\tpublic actionUndo():void\n\t{\n\t\tthis.sketcher.performUndo();\n\t}\n\tpublic actionRedo():void\n\t{\n\t\tthis.sketcher.performRedo();\n\t}\n\n\t// ------------ private methods ------------\n\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {fltEqual} from '../util/util';\n\n/*\n\tDetermines a series of numeric labels to describe an axis, and makes sure all these labels fit within the given width.\n\tThe min & max is described in the units of spacing along the axis, i.e. if this is a log scale, the numbers should be\n\tpost-log. The caller provides a function to transform the axis units back to the original units (e.g. log to pre-log).\n\tThe caller also provides a width measurement for the text. The full capabilities are appropriate for labelling an X-axis;\n\tfor a Y-axis, typically set the textWidth function to the height of the standard font.\n*/\n\nexport interface AxisLabellerNotch\n{\n\tlabel:string; // what precisely to display (null = just a notch, no label)\n\tvalue:number; // value in the original space\n\tpos:number; // axis position of notch, and the centre of the text label\n}\n\nexport class AxisLabeller\n{\n\tpublic notches:AxisLabellerNotch[] = [];\n\n\tconstructor(private width:number, private minVal:number, private maxVal:number,\n\t\t\t\tpublic textWidth?:(str:string) => number, public inverse?:(val:number) => number)\n\t{\n\t}\n\n\t// performs the calculation: after completion, the notches property should be interrogated for the results\n\tpublic calculate():void\n\t{\n\t\tif (this.minVal == this.maxVal)\n\t\t{\n\t\t\tthis.notches.push(\n\t\t\t{\n\t\t\t\tlabel: this.minVal.toString(),\n\t\t\t\tvalue: this.minVal,\n\t\t\t\tpos: 0.5 * this.width\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tconst width = this.width, minVal = this.minVal, maxVal = this.maxVal;\n\t\tconst range = maxVal - minVal, invRange = 1.0 / range;\n\n\t\tlet position = (val:number):number => width * (val - minVal) * invRange;\n\n\t\t// find boundaries by rounding the minimum & maximum values, such that they can be squeezed into the edge zones of the axis\n\t\tlet loT:number = null, hiT:number = null;\n\t\tconst bumpLess = 1 - 1E-5, bumpMore = 1 + 1E-5;\n\t\tgot: for (let outer = 1E-10; outer <= 1E11; outer *= 10) for (let inner of [0.2, 0.5, 1])\n\t\t{\n\t\t\tlet mag = outer * inner, inv = 1.0 / mag;\n\n\t\t\tlet t1 = Math.floor(minVal * mag * bumpLess) * inv, t2 = Math.round(minVal * mag) * inv, t3 = Math.ceil(minVal * mag * bumpMore) * inv;\n\t\t\tlet t4 = Math.floor(maxVal * mag * bumpLess) * inv, t5 = Math.round(maxVal * mag) * inv, t6 = Math.ceil(maxVal * mag * bumpMore) * inv;\n\t\t\tlet p1 = position(t1), p2 = position(t2), p3 = position(t3);\n\t\t\tlet p4 = position(t4), p5 = position(t5), p6 = position(t6);\n\n\t\t\tif ((fltEqual(p1, 0) || p1 >= 0) && p1 <= 0.1 * width) loT = t1;\n\t\t\telse if ((fltEqual(p2, 0) || p2 >= 0) && p2 <= 0.1 * width) loT = t2;\n\t\t\telse if ((fltEqual(p3, 0) || p3 >= 0) && p3 <= 0.1 * width) loT = t3;\n\t\t\telse continue;\n\n\t\t\tif (p6 >= 0.9 * width && (fltEqual(p6, width) || p6 <= width)) hiT = t6;\n\t\t\telse if (p5 >= 0.9 * width && (fltEqual(p5, width) || p5 <= width)) hiT = t5;\n\t\t\telse if (p4 >= 0.9 * width && (fltEqual(p4, width) || p4 <= width)) hiT = t4;\n\t\t\telse continue;\n\n\t\t\t// (record the mag, for subsequent spacing purposes?)\n\t\t\tbreak got;\n\t\t}\n\n\t\tif (loT == null || hiT == null) return; // should be very rare\n\n\t\t// NOTE: this is incomplete; but putting in two anchor points is better than nothing\n\n\t\tlet loVal = this.inverse(loT), hiVal = this.inverse(hiT);\n\t\tthis.notches.push(\n\t\t{\n\t\t\tlabel: this.formatNumber(loVal),\n\t\t\tvalue: loVal,\n\t\t\tpos: position(loT)\n\t\t});\n\t\tthis.notches.push(\n\t\t{\n\t\t\tlabel: this.formatNumber(hiVal),\n\t\t\tvalue: hiVal,\n\t\t\tpos: position(hiT)\n\t\t});\n\t}\n\n\t// ------------ private methods ------------\n\n\t// round to a reasonable number of significant figures, then eliminate the cruft\n\tprivate formatNumber(num:number):string\n\t{\n\t\tlet str = num.toPrecision(4);\n\t\tstr = str.replace(/^(-?\\d+)\\.0+$/, '$1');\n\t\tstr = str.replace(/^(-?\\d+\\.0*[1-9]+)0+$/, '$1');\n\t\tstr = str.replace(/^(-?\\d+)\\.0+(e[\\+\\-]\\d+)$/, '$1$2');\n\t\tstr = str.replace(/^(-?\\d+\\.0*[1-9]+)0+(e[\\+\\-]\\d+)$/, '$1$2');\n\t\treturn str;\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {RenderPolicy} from '../gfx/Rendering';\nimport {colourCanvas} from '../util/util';\nimport {Widget} from './Widget';\n\n/*\n\tBase class for various kinds of \"embedded\" chemistry display objects, such as molecules/reactions/collections. These are intended to be largely\n\tstatic displays that are dynamically manufactured from embedded content, e.g. upgrading a WordPress \"shortcode\" with a molecular structure to\n\ta picture of the molecule.\n*/\n\nexport class EmbedChemistry extends Widget\n{\n\tpublic padding = 4;\n\tpublic borderCol = 0xD0D0D0;\n\tpublic borderRadius = 8; // for rounded rects\n\tpublic backgroundCol1 = 0xFFFFFF;\n\tpublic backgroundCol2 = 0xF0F0F0;\n\tpublic policy:RenderPolicy = RenderPolicy.defaultColourOnWhite();\n\n\t// ------------ public methods ------------\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\t// convenience for setting up backdrop\n\tpublic clearBackground() {this.backgroundCol1 = null; this.backgroundCol2 = null;}\n\tpublic setBackground(bg:number) {this.backgroundCol1 = bg; this.backgroundCol2 = null;}\n\tpublic setBackgroundGradient(bg1:number, bg2:number) {this.backgroundCol1 = bg1; this.backgroundCol2 = bg2;}\n\n\t// create the objects necessary to render the widget; this function should be called after basic pre-initialisation settings, e.g.\n\t// specifying the starting molecule, initial size, etc.\n\tpublic render(parent:any):void\n\t{\n\t\tsuper.render(parent);\n\n\t\tlet content = this.contentDOM;\n\n\t\tif (this.borderCol != null) content.setCSS('border', '1px solid ' + colourCanvas(this.borderCol));\n\t\tif (this.borderRadius > 0) content.setCSS('border-radius', this.borderRadius + 'px');\n\n\t\tlet bg1 = this.backgroundCol1, bg2 = this.backgroundCol2;\n\t\tif (bg1 != null && bg2 != null)\n\t\t{\n\t\t\tlet cols = colourCanvas(bg1) + ',' + colourCanvas(bg2);\n\t\t\tcontent.setCSS('background-image', 'linear-gradient(to bottom right, ' + cols + ')');\n\t\t}\n\t\telse if (bg1 != null)\n\t\t{\n\t\t\tcontent.setCSS('background-color', colourCanvas(bg1));\n\t\t}\n\n\t\tcontent.css({'padding': this.padding + 'px', 'margin': '0'});\n\t}\n\n\t// ------------ private methods ------------\n\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Aspect} from '../aspect/Aspect';\nimport {AspectList} from '../aspect/AspectList';\nimport {DataSheet, DataSheetColumn} from '../data/DataSheet';\nimport {DataSheetStream} from '../data/DataSheetStream';\nimport {MDLSDFReader} from '../data/MDLReader';\nimport {OutlineMeasurement} from '../gfx/ArrangeMeasurement';\nimport {ArrangeMolecule} from '../gfx/ArrangeMolecule';\nimport {DrawMolecule} from '../gfx/DrawMolecule';\nimport {MetaVector} from '../gfx/MetaVector';\nimport {RenderEffects, RenderPolicy} from '../gfx/Rendering';\nimport {DOM, dom} from '../util/dom';\nimport {fromUTF8, htmlToRGB} from '../util/util';\nimport {Vec} from '../util/Vec';\nimport {EmbedChemistry} from './EmbedChemistry';\n\n/*\n\tEmbedded collection: obtains a datasheet representation and displays it as a group of molecules, primitive datatypes, and/or higher\n\torder datastructures controlled by aspects.\n\n\tThe rendering parameters are quite raw, and presumed to be passed from an un-typed source, directly from the user:\n\n        format: MIME, or shortcuts for \"datasheet\" or \"sdfile\"\n\t\tencoding: raw by default, but can be set to \"base64\"\n        scheme: molecule colouring schema (wob/cob/bow/cow)\n        scale: points per angstrom\n        padding: number of pixels to space around the content\n\t\tborder: border colour, HTML-style colour code or 'transparent' for none\n\t\tradius: zero for square, higher for rounder corners\n        background: 'transparent' for none; HTML-style for solid; for a gradient, specify as 'col1,col2'\n\t\ttight: if true, reduces the padding underneath\n\n    ... these ones TBD\n        source: URL of some kind - grab the data from there (wherever user directory is)\n\n        (parameters to control interactivity?)\n*/\n\ninterface EmbedCollectionColumn\n{\n\tname:string;\n\taspect:Aspect; // null for primitive\n\ttype:string; // if aspect, either 'text' or 'graphic'\n\tidx:number; // primitive: column#; aspect: text/graphic rendering #\n}\n\nexport class EmbedCollection extends EmbedChemistry\n{\n\tprivate ds:DataSheet = null;\n\tprivate failmsg = '';\n\tprivate tight = false;\n\n\t// ------------ public methods ------------\n\n\tconstructor(private datastr:string, options?:any)\n\t{\n\t\tsuper();\n\n\t\tif (!options) options = {};\n\n\t\tif (options.encoding == 'base64') datastr = fromUTF8(atob(datastr.trim()));\n\n\t\tlet ds:DataSheet = null, name:string = options.name;\n\t\tif (options.format == 'datasheet' || options.format == 'chemical/x-datasheet')\n\t\t{\n\t\t\tds = DataSheetStream.readXML(datastr);\n\t\t}\n\t\telse if (options.format == 'sdfile' || options.format == 'chemical/x-mdl-sdfile')\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tlet mdl = new MDLSDFReader(datastr);\n\t\t\t\tds = mdl.parse();\n\t\t\t}\n\t\t\tcatch (ex) {this.failmsg = ex;}\n\t\t}\n\t\telse // free for all\n\t\t{\n\t\t\ttry {ds = DataSheetStream.readXML(datastr);}\n\t\t\tcatch (ex) {}\n\t\t\tif (ds == null)\n\t\t\t{\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tlet mdl = new MDLSDFReader(datastr);\n\t\t\t\t\tds = mdl.parse();\n\t\t\t\t}\n\t\t\t\tcatch (ex) {} // (silent when not forcing a type)\n\t\t\t}\n\t\t}\n\n\t\tif (ds == null) return;\n\n\t\tif (options.padding) this.padding = options.padding;\n\n\t\tif (options.background == 'transparent') this.clearBackground();\n\t\telse if (options.background)\n\t\t{\n\t\t\tlet bg:string = options.background, comma = bg.indexOf(',');\n\t\t\tif (comma < 0)\n\t\t\t\tthis.setBackground(htmlToRGB(bg));\n\t\t\telse\n\t\t\t\tthis.setBackgroundGradient(htmlToRGB(bg.substring(0, comma)), htmlToRGB(bg.substring(comma + 1)));\n\t\t}\n\n\t\tif (options.border == 'transparent') this.borderCol = MetaVector.NOCOLOUR;\n\t\telse if (options.border) this.borderCol = htmlToRGB(options.border);\n\n\t\tif (options.radius != null) this.borderRadius = parseInt(options.radius);\n\n\t\tif (options.scheme == 'wob') this.policy = RenderPolicy.defaultWhiteOnBlack();\n\t\telse if (options.scheme == 'cob') this.policy = RenderPolicy.defaultColourOnBlack();\n\t\telse if (options.scheme == 'bow') this.policy = RenderPolicy.defaultBlackOnWhite();\n\t\telse if (options.scheme == 'cow') this.policy = RenderPolicy.defaultColourOnWhite();\n\n\t\tif (options.scale) this.policy.data.pointScale = options.scale;\n\n\t\tif (options.tight == true || options.tight == 'true') this.tight = true;\n\n\t\tthis.ds = ds;\n\t}\n\n\t// create the objects necessary to render the widget; this function should be called after basic pre-initialisation settings, e.g.\n\t// specifying the starting molecule, initial size, etc.\n\tpublic render(parent:any):void\n\t{\n\t\tthis.tagType = 'span';\n\t\tsuper.render(parent);\n\n\t\tlet span = this.contentDOM, ds = this.ds, policy = this.policy;\n\t\t\n\t\tspan.css({'display': 'inline-block', 'line-height': '0'});\n\t\tif (!this.tight) span.setCSS('margin-bottom', '1.5em');\n\n\t\tif (ds != null)\n\t\t{\n\t\t\tlet aspects = new AspectList(ds).enumerate();\n\t\t\tlet columns:EmbedCollectionColumn[] = this.determineColumns(aspects);\n\n\t\t\tlet table = dom('<table/>').appendTo(span);\n\t\t\ttable.css({'font-family': '\"HelveticaNeue-Light\", \"Helvetica Neue Light\", \"Helvetica Neue\", Helvetica, Arial, \"Lucida Grande\", sans-serif'});\n\t\t\ttable.css({'border-collapse': 'collapse', 'line-height': '1', 'margin': '2px', 'border': '0'});\n\n\t\t\tlet tr = dom('<tr/>').appendTo(table).css({'line-height': '1'});\n\t\t\tfor (let n = 0; n < columns.length; n++)\n\t\t\t{\n\t\t\t\tlet th = dom('<th/>').appendTo(tr);\n\t\t\t\tth.css({'white-space': 'nowrap', 'font-weight': '600', 'text-decoration': 'underline', 'text-align': 'center'});\n\t\t\t\tth.css({'padding': '0.2em 0.5em 0.2em 0.5em', 'color': 'black', 'border': '0'});\n\t\t\t\tth.setText(columns[n].name);\n\t\t\t}\n\n\t\t\tfor (let row = 0; row < ds.numRows;)\n\t\t\t{\n\t\t\t\tlet blksz = 1;\n\t\t\t\tfor (let aspect of aspects) blksz = Math.max(blksz, aspect.rowBlockCount(row));\n\n\t\t\t\ttr = dom('<tr/>').appendTo(table).css({'line-height': '1'});\n\t\t\t\tfor (let col = 0; col < columns.length; col++)\n\t\t\t\t{\n\t\t\t\t\tlet td = dom('<td/>').appendTo(tr);\n\t\t\t\t\ttd.css({'border': '1px solid #D0D0D0', 'padding': '0.2em', 'vertical-align': 'middle'});\n\t\t\t\t\tlet spec = columns[col];\n\t\t\t\t\tif (spec.aspect == null)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (ds.isNull(row, spec.idx)) td.setText(' ');\n\t\t\t\t\t\telse if (ds.colType(spec.idx) == DataSheetColumn.Molecule) this.renderMolecule(td, row, spec.idx);\n\t\t\t\t\t\telse this.renderPrimitive(td, row, spec.idx);\n\t\t\t\t\t}\n\t\t\t\t\telse if (spec.type == 'text') this.renderTextAspect(td, row, spec.aspect, spec.idx);\n\t\t\t\t\telse if (spec.type == 'graphic') this.renderGraphicAspect(td, row, spec.aspect, spec.idx);\n\t\t\t\t}\n\n\t\t\t\trow += blksz;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tspan.css({'color': 'red'});\n\t\t\tspan.setText('Unable to parse datasheet: ' + this.failmsg);\n\t\t\tlet pre = dom('<pre/>').appendTo(span);\n\t\t\tpre.css({'line-height': '1.1'});\n\t\t\tpre.setText(this.datastr);\n\t\t\tconsole.log('Unparseable datasheet source string:\\n[' + this.datastr + ']');\n\t\t}\n\t}\n\n\t// ------------ private methods ------------\n\n\t// assemble list of columns to use for the actual table: for a plain datasheet this is basically the sheet's own structure;\n\t// when aspects are involved, these can be switched out for dynamically produced text & graphics\n\tprivate determineColumns(aspects:Aspect[]):EmbedCollectionColumn[]\n\t{\n\t\tlet ds = this.ds;\n\t\tlet columns:EmbedCollectionColumn[] = [];\n\n\t\tlet reserved = Vec.booleanArray(false, ds.numCols);\n\t\tlet names:string[] = [];\n\t\tfor (let n = 0; n < ds.numCols; n++) names.push(ds.colName(n));\n\n\t\tfor (let aspect of aspects)\n\t\t{\n\t\t\t// NOTE: fetching of titles is very inefficient; redesign aspect, or cache row 0 for later use\n\t\t\tif (ds.numRows > 0) for (let n = 0, num = aspect.numTextRenderings(0); n < num; n++)\n\t\t\t{\n\t\t\t\tlet title = aspect.produceTextRendering(0, n).name;\n\t\t\t\tcolumns.push({'name': title, 'aspect': aspect, 'type': 'text', 'idx': n});\n\t\t\t}\n\t\t\tif (ds.numRows > 0) for (let n = 0, num = aspect.numGraphicRenderings(0); n < num; n++)\n\t\t\t{\n\t\t\t\tlet title = aspect.produceGraphicRendering(0, n, this.policy).name;\n\t\t\t\tcolumns.push({'name': title, 'aspect': aspect, 'type': 'graphic', 'idx': n});\n\t\t\t}\n\n\t\t\tlet claimed = aspect.areColumnsReserved(names);\n\t\t\tfor (let n = 0; n < names.length; n++) reserved[n] = reserved[n] || claimed[n];\n\t\t}\n\n\t\tfor (let n = 0; n < ds.numCols; n++) if (!reserved[n] && ds.colType(n) != DataSheetColumn.Extend)\n\t\t{\n\t\t\tcolumns.push({'name': ds.colName(n), 'aspect': null, 'type': null, 'idx': n});\n\t\t}\n\n\t\t// TODO: reordering based on occurrence in natural order? right now aspects all go first; collect up a parallel\n\t\t// 'pri' array which is col# for primitives, and first occurrence in column name list for aspects; use to sort\n\n\t\treturn columns;\n\t}\n\n\t// rendering specifics for individual cells\n\tprivate renderPrimitive(td:DOM, row:number, col:number):void\n\t{\n\t\tlet txt = '', ct = this.ds.colType(col), align = 'center';\n\t\tif (ct == DataSheetColumn.String) {txt = this.ds.getString(row, col); align = 'left';}\n\t\telse if (ct == DataSheetColumn.Integer) txt = this.ds.getInteger(row, col).toString();\n\t\telse if (ct == DataSheetColumn.Real) txt = this.ds.getReal(row, col).toString();\n\t\telse if (ct == DataSheetColumn.Boolean) txt = this.ds.getBoolean(row, col) ? 'true' : 'false';\n\t\ttd.setText(txt);\n\t\ttd.css({'text-align': align});\n\t}\n\tprivate renderMolecule(td:DOM, row:number, col:number):void\n\t{\n\t\ttd.css({'text-align': 'center'});\n\n\t\tlet effects = new RenderEffects();\n\t\tlet measure = new OutlineMeasurement(0, 0, this.policy.data.pointScale);\n\t\tlet layout = new ArrangeMolecule(this.ds.getMolecule(row, col), measure, this.policy, effects);\n\t\tlayout.arrange();\n\n\t\tlet metavec = new MetaVector();\n\t\tnew DrawMolecule(layout, metavec).draw();\n\t\tmetavec.normalise();\n\t\tdom(metavec.createSVG()).appendTo(td);\n\t}\n\tprivate renderTextAspect(td:DOM, row:number, aspect:Aspect, idx:number):void\n\t{\n\t\tlet rend = aspect.produceTextRendering(row, idx);\n\t\tif (!rend.text) td.setText(' ');\n\t\telse if (rend.type == Aspect.TEXT_PLAIN) td.setText(rend.text);\n\t\telse if (rend.type == Aspect.TEXT_LINK)\n\t\t{\n\t\t\tlet ahref = dom('<a target=\"_blank\"/>').appendTo(td);\n\t\t\tahref.setAttr('href', rend.text);\n\t\t\tahref.setText(rend.text);\n\t\t}\n\t\telse if (rend.type == Aspect.TEXT_HTML) td.setHTML(rend.text);\n\t}\n\tprivate renderGraphicAspect(td:DOM, row:number, aspect:Aspect, idx:number):void\n\t{\n\t\tlet metavec = aspect.produceGraphicRendering(row, idx, this.policy).metavec;\n\t\tif (metavec == null) {td.setText(' '); return;}\n\n\t\ttd.css({'text-align': 'center'});\n\t\tmetavec.normalise();\n\t\tdom(metavec.createSVG()).appendTo(td);\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {CoordUtil} from '../data/CoordUtil';\nimport {MDLMOLReader} from '../data/MDLReader';\nimport {Molecule} from '../data/Molecule';\nimport {OutlineMeasurement} from '../gfx/ArrangeMeasurement';\nimport {ArrangeMolecule} from '../gfx/ArrangeMolecule';\nimport {DrawMolecule} from '../gfx/DrawMolecule';\nimport {MetaVector} from '../gfx/MetaVector';\nimport {RenderEffects, RenderPolicy} from '../gfx/Rendering';\nimport {dom} from '../util/dom';\nimport {Size} from '../util/Geom';\nimport {DEGRAD, htmlToRGB} from '../util/util';\nimport {EmbedChemistry} from './EmbedChemistry';\n\n/*\n\tEmbedded molecule: displays a single molecular structure, with a variety of available rendering options. The structure display is static\n\tand read-only, but it can be extracted in data format. It is rendered as SVG, so that it looks good when rendered for print quality.\n\n\tThe rendering parameters are quite raw, and presumed to be passed from an un-typed source, directly from the user:\n\n        format: MIME, or shortcuts for \"molfile\" or \"sketchel\"\n        name: null/default = if molfile pull it out and display; blank = show nothing; text = show that\n        invert: boolean; inverts the coordinates (applied before rotation)\n        rotate: degrees to rotate molecule\n        padding: number of pixels to space around the molecule\n\t\tborder: border colour, HTML-style colour code or 'transparent' for none\n\t\tradius: zero for square, higher for rounder corners\n        background: 'transparent' for none; HTML-style for solid; for a gradient, specify as 'col1,col2'\n        width, height: optional, either one (used as a maximum)\n        box: specific size to stick with (comma-separated)\n        scheme: molecule colouring schema (wob/cob/bow/cow)\n        scale: points per angstrom\n\t\ttight: if true, reduces the padding underneath\n\n    ... these ones TBD\n        source: URL of some kind - grab the data from there (wherever user directory is)\n\n        (parameters to control interactivity?)\n*/\n\nexport class EmbedMolecule extends EmbedChemistry\n{\n\tprivate mol:Molecule = null;\n\tprivate name = '';\n\tprivate failmsg = '';\n\tprivate maxWidth = 0;\n\tprivate maxHeight = 0;\n\tprivate boxSize:Size = null;\n\tprivate tight = false;\n\n\t// ------------ public methods ------------\n\n\tconstructor(private molstr:string, options?:any)\n\t{\n\t\tsuper();\n\n\t\tif (!options) options = {};\n\n\t\tlet mol:Molecule = null, name:string = options.name;\n\t\tif (options.format == 'sketchel' || options.format == 'chemical/x-sketchel')\n\t\t{\n\t\t\tmol = Molecule.fromString(molstr);\n\t\t}\n\t\telse if (options.format == 'molfile' || options.format == 'chemical/x-mdl-molfile')\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tlet mdl = new MDLMOLReader(molstr);\n\t\t\t\tmol = mdl.parse();\n\t\t\t\tif (mol != null && name == null) name = mdl.molName;\n\t\t\t}\n\t\t\tcatch (ex) {this.failmsg = ex;}\n\t\t}\n\t\telse // free for all\n\t\t{\n\t\t\tmol = Molecule.fromString(molstr);\n\t\t\tif (mol == null)\n\t\t\t{\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tlet mdl = new MDLMOLReader(molstr);\n\t\t\t\t\tmol = mdl.parse();\n\t\t\t\t\tif (mol != null && name == null) name = mdl.molName;\n\t\t\t\t}\n\t\t\t\tcatch (ex) {} // (silent when not forcing a type)\n\t\t\t}\n\t\t}\n\n\t\tif (mol == null) return;\n\n\t\tif (options.invert) mol = CoordUtil.mirrorImage(mol);\n\t\tif (options.rotate) CoordUtil.rotateMolecule(mol, options.rotate * DEGRAD);\n\t\tif (options.padding) this.padding = options.padding;\n\n\t\tif (options.background == 'transparent') this.clearBackground();\n\t\telse if (options.background)\n\t\t{\n\t\t\tlet bg:string = options.background, comma = bg.indexOf(',');\n\t\t\tif (comma < 0)\n\t\t\t\tthis.setBackground(htmlToRGB(bg));\n\t\t\telse\n\t\t\t\tthis.setBackgroundGradient(htmlToRGB(bg.substring(0, comma)), htmlToRGB(bg.substring(comma + 1)));\n\t\t}\n\n\t\tif (options.border == 'transparent') this.borderCol = MetaVector.NOCOLOUR;\n\t\telse if (options.border) this.borderCol = htmlToRGB(options.border);\n\n\t\tif (options.radius != null) this.borderRadius = parseInt(options.radius);\n\n\t\tif (options.width) this.maxWidth = options.width;\n\t\tif (options.height) this.maxHeight = options.height;\n\t\tif (options.box)\n\t\t{\n\t\t\tlet box:string = options.box, comma = box.indexOf(',');\n\t\t\tthis.boxSize = new Size(parseInt(box.substring(0, comma)), parseInt(box.substring(comma + 1)));\n\t\t}\n\n\t\tif (options.scheme == 'wob') this.policy = RenderPolicy.defaultWhiteOnBlack();\n\t\telse if (options.scheme == 'cob') this.policy = RenderPolicy.defaultColourOnBlack();\n\t\telse if (options.scheme == 'bow') this.policy = RenderPolicy.defaultBlackOnWhite();\n\t\telse if (options.scheme == 'cow') this.policy = RenderPolicy.defaultColourOnWhite();\n\n\t\tif (options.scale) this.policy.data.pointScale = options.scale;\n\n\t\tif (options.tight == true || options.tight == 'true') this.tight = true;\n\n\t\tthis.mol = mol;\n\t\tthis.name = name;\n\t}\n\n\t// create the objects necessary to render the widget; this function should be called after basic pre-initialisation settings, e.g.\n\t// specifying the starting molecule, initial size, etc.\n\tpublic render(parent:any):void\n\t{\n\t\tthis.tagType = 'span';\n\t\tsuper.render(parent);\n\n\t\tlet span = this.contentDOM, mol = this.mol, policy = this.policy;\n\n\t\tspan.css({'display': 'inline-block', 'line-height': '0'});\n\t\tif (!this.tight) span.setCSS('margin-bottom', '1.5em');\n\n\t\tif (mol != null && mol.numAtoms > 0)\n\t\t{\n\t\t\tspan.setCSS('text-align', 'center');\n\n\t\t\tlet effects = new RenderEffects();\n\t\t\tlet measure = new OutlineMeasurement(0, 0, policy.data.pointScale);\n\t\t\tlet layout = new ArrangeMolecule(mol, measure, policy, effects);\n\t\t\tlayout.arrange();\n\n\t\t\tif (this.boxSize) layout.squeezeInto(0, 0, this.boxSize.w, this.boxSize.h);\n\t\t\telse if (this.maxWidth > 0 || this.maxHeight > 0)\n\t\t\t{\n\t\t\t\tlet bounds = layout.determineBoundary();\n\t\t\t\tlet w = bounds[2] - bounds[0], h = bounds[3] - bounds[1];\n\t\t\t\tlet limW = this.maxWidth == 0 ? w : Math.min(w, this.maxWidth);\n\t\t\t\tlet limH = this.maxHeight == 0 ? h : Math.min(h, this.maxHeight);\n\t\t\t\tif (limW != w || limH != h) layout.squeezeInto(0, 0, limW, limH);\n\t\t\t}\n\n\t\t\tlet metavec = new MetaVector();\n\t\t\tnew DrawMolecule(layout, metavec).draw();\n\t\t\tif (this.boxSize == null)\n\t\t\t\tmetavec.normalise();\n\t\t\telse\n\t\t\t\tmetavec.setSize(this.boxSize.w, this.boxSize.h);\n\n\t\t\tlet svg = dom(metavec.createSVG()).appendTo(span);\n\n\t\t\tif (this.name)\n\t\t\t{\n\t\t\t\tlet p = dom('<p/>').appendTo(span);\n\t\t\t\tp.css({'padding': '0.2em 0 0 0', 'margin': '0', 'width': '100%', 'color': '#606060', 'line-height': '1'});\n\t\t\t\tp.css({'font-family': '\"HelveticaNeue-Light\", \"Helvetica Neue Light\", \"Helvetica Neue\", Helvetica, Arial, \"Lucida Grande\", sans-serif'});\n\t\t\t\tp.setText(this.name);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tspan.css({'color': 'red'});\n\t\t\tspan.setText('Unable to parse molecule: ' + this.failmsg);\n\t\t\tlet pre = dom('<pre/>').appendTo(span);\n\t\t\tpre.css({'line-height': '1.1'});\n\t\t\tpre.setText(this.molstr);\n\t\t\tconsole.log('Unparseable molecule source string:\\n[' + this.molstr + ']');\n\t\t}\n\t}\n\n\t// ------------ private methods ------------\n\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {dom, DOM, domLegacy} from '../util/dom';\nimport {installInlineCSS} from '../util/Theme';\nimport {empiricalScrollerSize, setBoundaryPixels} from '../util/util';\nimport {clearTooltip} from './Tooltip';\n\n/*\n\tPopup: a semi-transient widget that appears onscreen above all of the rest of the content. Clicking outside of the popup's\n\tarea dismisses it, but moving the mouse around does not. Functionally it's like a cross between a dialog and a tooltip.\n\n\tTo provide content, either subclass and override the populate() method, or provide a callback.\n*/\n\nconst CSS_POPUP = `\n\t*.wmk-popup\n\t{\n\t\tfont-family: 'Open Sans', sans-serif;\n\t}\n`;\n\nexport class Popup\n{\n\tprivate parent:DOM;\n\n\t// content information that can be accessed after opening\n\tprotected domObscureBackground:DOM; // grey covering banner\t\n\tprotected domObscureForeground:DOM;\n\tprotected domPanelBoundary:DOM; // the dialog outline itself\n\tprotected domBody:DOM; // the main area, for content\n\n\tpublic popupBackground = 'white';\n\tpublic obscureOpacity = 0.2;\n\tpublic zindex:number = null; // optionally the use of zindex, to ensure it goes on top (usually not necessary)\n\tpublic callbackClose:(source?:Popup) => void = null;\n\tpublic callbackPopulate:(source?:Popup) => void = null;\n\n\tconstructor(parent:any)\n\t{\n\t\tthis.parent = domLegacy(parent);\n\n\t\tinstallInlineCSS('popup', CSS_POPUP);\n\t}\n\n\tpublic onClose(callback:(source?:Popup) => void)\n\t{\n\t\tthis.callbackClose = callback;\n\t}\n\n\t// creates all the DOM objects and shows the dialog; details such as title should be setup before calling this\n\tpublic open():void\n\t{\n\t\tclearTooltip();\n\n\t\tlet body = dom(document.body);\n\n\t\t//let zindex = 21000;\n\n\t\tlet bg = this.domObscureBackground = dom('<div/>').appendTo(body);\n\t\tbg.css({'position': 'fixed'/*, 'z-index': zindex*/});\n\t\tbg.css({'left': '0', 'right': '0', 'top': '0', 'bottom': '0'});\n\t\tbg.css({'background-color': 'black', 'opacity': this.obscureOpacity});\n\n\t\tlet fg = this.domObscureForeground = dom('<div/>').appendTo(body);\n\t\tfg.css({'position': 'fixed'/*, 'z-index': zindex + 1*/});\n\t\tfg.css({'left': '0', 'right': '0', 'top': '0', 'bottom': '0'});\n\t\tfg.onClick(() => this.close());\n\n\t\tif (this.zindex > 0)\n\t\t{\n\t\t\tbg.setCSS('z-index', this.zindex);\n\t\t\tfg.setCSS('z-index', this.zindex + 1);\n\t\t}\n\n\t\tlet pb = this.domPanelBoundary = dom('<div class=\"wmk-popup\"/>').appendTo(fg).css({'visibility': 'hidden'});\n\t\tpb.onClick((event:MouseEvent) => event.stopPropagation()); // don't let the click percolate upward to the close event\n\t\tpb.css({'background-color': this.popupBackground, 'border': '1px solid black'});\n\t\tpb.css({'position': 'absolute', 'overflow': 'auto'});\n\n\t\tthis.domBody = dom('<div/>').appendTo(pb).css({'padding': '5px'});\n\n\t\t//bg.show();\n\n\t\tthis.populate();\n\t\tthis.positionAndShow();\n\t}\n\n\t// closes and hides the dialog\n\tpublic close():void\n\t{\n\t\tclearTooltip();\n\n\t\tthis.domPanelBoundary.remove();\n\t\tthis.domObscureBackground.remove();\n\t\tthis.domObscureForeground.remove();\n\n\t\tif (this.callbackClose) this.callbackClose(this);\n\n\t\tclearTooltip();\n\t}\n\n\t// sizes may have changed, so adjust if necessary\n\tpublic bump():void\n\t{\n\t\tthis.positionAndShow();\n\t}\n\n\t// use this to obtain the parts of the dialog box intended for modification\n\tpublic bodyDOM():DOM {return this.domBody;}\n\n\t// either subclass and override this, or provide the callback\n\tprotected populate():void\n\t{\n\t\tif (this.callbackPopulate)\n\t\t\tthis.callbackPopulate(this);\n\t\telse\n\t\t\tthis.bodyDOM().setText('Empty popup.');\n\t}\n\n\t// have this called when the size may have changed, and need to update position\n\tprivate positionAndShow():void\n\t{\n\t\tclearTooltip();\n\n\t\tlet winW = window.innerWidth, winH = window.innerHeight;\n\t\tconst GAP = 2;\n\t\tlet client = this.parent.el.getBoundingClientRect();\n\t\tlet wx1 = client.left, wy1 = client.top, wx2 = client.right, wy2 = client.bottom;\n\n\t\tlet pb = this.domPanelBoundary;\n\n\t\tlet maxW = Math.max(wx1, winW - wx2) - 4;\n\t\tpb.css({'max-width': maxW + 'px'});\n\n\t\tlet scrollSize = empiricalScrollerSize();\n\n\t\tlet setPosition = ():void =>\n\t\t{\n\t\t\t//let popW = pb.width(), popH = pb.height();\n\t\t\tlet popW = this.domBody.width(), popH = this.domBody.height();\n\t\t\tlet posX = 0, posY = 0;\n\n\t\t\tif (wy2 + GAP + popH < winH) posY = wy2 + GAP;\n\t\t\telse if (wy1 - GAP - popH > 0) posY = wy1 - GAP - popH;\n\t\t\telse if (winH - wy2 > wy1)\n\t\t\t{\n\t\t\t\tposY = wy2 + GAP;\n\t\t\t\tpopH = winH - posY - GAP;\n\t\t\t}\n\t\t\telse // wy1 >= winH - wy2\n\t\t\t{\n\t\t\t\tposY = GAP;\n\t\t\t\tpopH = wy1 - posY - GAP;\n\t\t\t}\n\n\t\t\tif (pb.height() > popH) popW += scrollSize.w + 10;\n\n\t\t\tif (wx1 + popW < winW) posX = wx1;\n\t\t\telse if (popW < wx2) posX = wx2 - popW;\n\n\t\t\tsetBoundaryPixels(pb, posX, posY, popW, popH);\n\t\t\tpb.css({'visibility': 'visible'});\n\t\t};\n\n\t\tsetTimeout(() => setPosition());\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2018 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {dom} from '../util/dom';\nimport {eventCoords, setBoundaryPixels} from '../util/util';\nimport {Popup} from './Popup';\n\n/*\n\tProxy functionality for menus, particularly the context menu.\n*/\n\nexport interface MenuProxyContext\n{\n\tlabel:string;\n\tclick?:() => void;\n\tsubMenu?:MenuProxyContext[];\n\taccelerator?:string;\n}\n\nexport interface MenuProxyOptions\n{\n\tcallbackClose?:() => void;\n\toverrideObscureOpacity?:number;\n}\n\nexport class MenuProxy\n{\n\t// override this with true when the context menu is available\n\tpublic hasContextMenu():boolean {return false;}\n\tpublic openContextMenu(menuItems:MenuProxyContext[], event:MouseEvent, opt?:MenuProxyOptions):void {}\n}\n\n/*\n\tContext menu handler that is compatible with a vanilla web page. It is similar but not identical to the system context\n\tmenu, which is the preferred option for Electron-based apps.\n*/\n\nexport class MenuProxyWeb extends MenuProxy\n{\n\tpublic hasContextMenu():boolean {return true;}\n\tpublic openContextMenu(menuItems:MenuProxyContext[], event:MouseEvent, opt?:MenuProxyOptions):void\n\t{\n\t\tlet [x, y] = eventCoords(event, document.body);\n\t\t//let x = event.screenX, y = event.screenY;\n\t\tlet divCursor = dom('<div/>').appendTo(document.body).css({'position': 'absolute', 'user-select': 'none'});\n\t\tsetBoundaryPixels(divCursor, x - 5, y - 5, 10, 10);\n\t\tlet currentFocus = dom(document.activeElement);\n\t\tlet popup = new Popup(divCursor);\n\t\tif (opt?.overrideObscureOpacity != null) popup.obscureOpacity = opt?.overrideObscureOpacity;\n \t\tpopup.callbackPopulate = () =>\n\t\t{\n\t\t\tpopup.bodyDOM().css({'user-select': 'none', 'font-size': '16px'});\n\t\t\tfor (let menuItem of menuItems)\n\t\t\t{\n\t\t\t\tlet div = dom('<div/>').appendTo(popup.bodyDOM());\n\t\t\t\tif (menuItem == null)\n\t\t\t\t{\n\t\t\t\t\tdiv.appendHTML('<hr/>');\n\t\t\t\t}\n\t\t\t\telse if (menuItem.subMenu)\n\t\t\t\t{\n\t\t\t\t\tdiv.setText(menuItem.label + ' \\u{25B8}');\n\t\t\t\t\tdiv.css({'cursor': 'pointer'});\n\t\t\t\t\tlet fcn = (event:MouseEvent) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\tthis.openContextMenu(menuItem.subMenu, event);\n\t\t\t\t\t};\n\t\t\t\t\tdiv.onClick(fcn);\n\t\t\t\t\tdiv.onContextMenu(fcn);\n\t\t\t\t}\n\t\t\t\telse if (menuItem.click)\n\t\t\t\t{\n\t\t\t\t\tdiv.setText(menuItem.label);\n\t\t\t\t\tdiv.onMouseEnter(() => {div.css({'background-color': '#D0D0D0'});});\n\t\t\t\t\tdiv.onMouseLeave(() => {div.css({'background-color': 'transparent'});});\n\t\t\t\t\tdiv.css({'cursor': 'pointer'});\n\t\t\t\t\tdiv.onClick(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\tmenuItem.click();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tdiv.css({'color': '#808080'});\n\t\t\t\t\tdiv.setText(menuItem.label);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tpopup.callbackClose = () =>\n\t\t{\n\t\t\tdivCursor.remove();\n\t\t\tcurrentFocus.grabFocus();\n\t\t\tif (opt?.callbackClose) opt?.callbackClose();\n\t\t};\n\t\tpopup.open();\n\t}\n}\n\n","/*\n    WebMolKit\n\n    (c) 2010-2021 Molecular Materials Informatics, Inc.\n\n    All rights reserved\n\n    http://molmatinf.com\n\n\t[PKG=webmolkit]\n*/\n\nimport {Vec} from './Vec';\n\n/*\n\tPseudorandom number generator. Uses an implementation of linear congruential generator.\n*/\n\nexport class Random\n{\n\tprivate m = 0x8000000;\n\tprivate invMN = 1.0 / (this.m - 1);\n\tprivate a = 1103515245;\n\tprivate c = 5425153011;\n\tprivate state:number;\n\n\tconstructor(private seed:number = null)\n\t{\n\t\tif (seed == null)\n\t\t\tthis.state = Math.floor(Math.random() * (this.m - 1));\n\t\telse\n\t\t\tthis.state = seed;\n  \t}\n\n\t// returns a positive 31-bit integer\n\tpublic next():number\n\t{\n\t\tthis.state = (this.a * this.state + this.c) % this.m;\n\t\treturn this.state;\n\t}\n\n\t// returns an integer between 0 and max-1\n\tpublic int(max:number):number\n\t{\n\t\treturn max <= 0 ? 0 : this.next() % max;\n\t}\n\n\t// returns a floating point integer between 0 and 1\n\tpublic float():number\n\t{\n\t\treturn this.next() * this.invMN;\n\t}\n\n\t// returns a number between 0 and length-1 of the given array\n\tpublic index(arr:any[]):number\n\t{\n\t\tif (Vec.isBlank(arr)) return null;\n\t\treturn this.int(arr.length);\n\t}\n\n\t// returns a randomly selected element from an array\n\tpublic peek<T>(arr:T[]):T\n\t{\n\t\tif (Vec.isBlank(arr)) return null;\n\t\treturn arr[this.int(arr.length)];\n\t}\n\n\t// returns a randomly selected element from an array, and also removes it\n\tpublic pull<T>(arr:T[]):T\n\t{\n\t\tif (Vec.isBlank(arr)) return null;\n\t\tlet idx = this.int(arr.length), val = arr[idx];\n\t\tarr.splice(idx, 1);\n\t\treturn val;\n\t}\n}\n\n"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","Vec","isBlank","arr","length","notBlank","safeArray","len","arrayLength","anyTrue","v","allTrue","anyFalse","allFalse","iterAnyTrue","callback","iterAllTrue","iterAnyFalse","iterAllFalse","swap","idx1","idx2","duplicate","slice","append","item","push","prepend","unshift","concat","arr1","arr2","remove","idx","splice","flatten","mtx","ret","vec","transpose","sz1","sz2","anyArray","j","i","equals","n","equivalent","len1","compareTo","sz","Math","max","booleanArray","val","Array","fill","numberArray","stringArray","genericArray","genericBlankArrays","funcArray","func","first","last","min","Number","MAX_VALUE","MIN_VALUE","idxMin","idxMax","range","lo","hi","reverse","identity0","identity1","identityN","start","notMask","mask","idxGet","maskCount","c","maskIdx","idxMask","maskMap","pos","maskGet","maskEqual","constructor","sum","t","add","sub","mul","neg","setTo","addTo","mulBy","addToArray","subFromArray","mulByArray","divByArray","idxSort","sort","a","b","v1","v2","sorted","this","sortedUnique","unique","uniqueUnstable","from","Set","uniqueStable","set","has","delete","maskUnique","idxUnique","exclude","excl","count","indexOf","Permutation","parityPerms","p","parityIdentity","parityOrder","src","smallPermutation","PERM1","PERM2","PERM3","PERM4","allPermutations","SMALL_PERMS","PERM_CACHE","MAX_CACHE","nperms","perms","nonunique","Matrix","m","s","A","fromArray","clone","numRows","numCols","X","C","norm1","f","abs","normInf","uminus","plus","B","plusEquals","minus","minusEquals","arrayTimes","arrayTimesEquals","arrayRightDivide","arrayRightDivideEquals","arrayLeftDivide","arrayLeftDivideEquals","scalarTimes","scalarTimesEquals","times","Bcolj","k","Arowi","rank","SingularValueDecomposition","cond","trace","identity","toString","lines","row","JSON","stringify","join","nu","U","V","e","work","nct","nrt","hypot","pp","iter","eps","pow","tiny","kase","ks","cs","sn","scale","sp","spm1","epm1","sk","ek","shift","sqrt","g","getU","getV","getSingularValues","getS","S","norm2","tol","r","EPSILON","Triangulation2D","px","py","numTriangles","edgeStack","hull","maxTriangles","triangles","halfedges","hashSize","ceil","hullPrev","hullNext","hullTri","hullHash","ids","dists","update","trimConcave","threshold","threshSq","sqr","tri","edge","uniqueEdges","edgeCount","ntri","c1","c2","c3","i1","i2","i3","norm2_xy","repTri","repEdge","traceOutline","Map","e1","e2","e3","edgePairs","entry","entries","floor","isz","idxMap","g1","g2","sequence","minX","minY","maxX","maxY","centreX","centreY","i0","minDist","POSITIVE_INFINITY","d","norm_xy","i0x","i0y","i1x","i1y","minRadius","circumRadius","i2x","i2y","isFinite","quicksort","d0","NEGATIVE_INFINITY","id","orient","x","y","pickCircumCentre","hullStart","hullSize","hashKey","addTriangle","xp","yp","q","legalise","pseudoAngle","ar","a0","b0","al","bl","p0","pr","pl","p1","inCircle","hbl","link","br","dx","dy","orientIfSure","rx","ry","qx","qy","l","ax","ay","bx","by","cx","cy","ex","ey","fx","fy","bp","cp","cl","left","right","temp","tempDist","median","GeomUtil","pointInPolygon","minArray","maxArray","phase","x1","y1","x2","y2","areLinesParallel","x3","y3","x4","y4","dxa","dya","dxb","dyb","xmajorA","EPS","lineIntersect","u","isPointOnLineSeg","realEqual","pointLineDistance","pointLineSegDistance","doLineSegsIntersect","x4_x3","y4_y3","x2_x1","y2_y1","x1_x3","y1_y3","nx","ny","dn","rectsIntersect","w1","h1","w2","h2","sortAngles","theta","angleNorm","angleDiffPos","PI","angleDiff","idxSortAngles","pop","uniqueAngles","ang","thetaObtuse","th1","th2","dth","emergentAngle","bottom","behind","delta","TWOPI","dotProduct","crossProduct","affineTranslate","affineMirror","xaxis","yaxis","affineScale","sx","sy","affineRotate","cos","sin","affineCompose","tfm","Acol","Brow","applyAffine","applyAffineArray","isAffineMirror","h","magnitude2","magnitude","dist2","dz","dist","normalise","dsq","inv","normalised","acuteAngle","mag1","mag2","cosTheta","acos","arcControlPoints","rad","t1x","t1y","t2x","t2y","tx","ty","D","createBezierEllipse","rw","rh","nseg","sinTheta","incrAlpha","alpha","cosAlpha","sinAlpha","npt","n1","n2","n3","n4","ctrl","fitCircle","fitEllipse","bestW","bestH","bestScore","shrinkToFit","whs","dmin","invW2","invH2","whsX","whsY","anything","superimpose","thetaA","atan2","rot00","rot01","rot10","rot11","acx","acy","invsz","bcx","bcy","mtxA","mtxB","cov","svd","rotate","convexHull","flatness","algo","QuickHull","hullX","hullY","outlinePolygon","diameter","del","concave","hsz","al1","al2","quickHull","furthestPoint","distance","ux","uy","maxDist","maxPos","RollingBall","latest","direction","visited","roll","bestIdx","bestDelta","bestTheta","next","sequencePos","posList","Pos","sequenceXY","zero","other","scaleBy","mag","offsetBy","withScaleBy","withOffsetBy","Size","w","isZero","fitInto","maxW","maxH","Box","fromBounds","fromSize","fromOval","oval","getPos","setPos","getSize","setSize","midX","midY","area","grow","withGrow","intersects","intersection","x5","y5","x6","y6","contains","union","isEmpty","notEmpty","Oval","fromBox","box","setCentre","setRadius","Line","fromPos","pos1","pos2","setPos1","setPos2","XML","parseXML","strXML","xmlDoc","customParser","parseFromString","DOMParser","doc","customSerial","serializeToString","documentElement","XMLSerializer","toPrettyString","xslt","xsltDoc","xsltProc","XSLTProcessor","importStylesheet","resultDoc","transformToDocument","nodeText","el","text","child","childNodes","nodeType","nodeValue","childText","parent","tagName","findElement","appendElement","name","ownerDocument","createElement","appendChild","appendElementAfter","presib","postsib","nextSibling","parentNode","insertBefore","appendText","isCDATA","createCDATASection","createTextNode","createTextChild","textContent","setText","firstChild","removeChild","node","nodeName","findChildElements","list","childElements","dom","DOM","parse","domLegacy","jquery","elHTML","elInput","elCanvas","xhtml","xml","html","outerHTML","template","document","innerHTML","content","find","selector","querySelector","findAll","nodeList","querySelectorAll","domList","parentElement","ancestor","closest","children","tag","firstElementChild","nextElementSibling","toLocaleLowerCase","exists","isVisible","offsetWidth","offsetHeight","getClientRects","appendTo","prependTo","ref","insertAfter","before","empty","getHTML","setHTML","appendHTML","insertAdjacentHTML","getText","getValue","setValue","str","getCSS","style","getPropertyValue","setCSS","setProperty","css","dict","getAttr","hasAttribute","getAttribute","setAttr","setAttribute","attr","addClass","clsnames","cls","split","classList","removeClass","hasClass","clsname","setClass","flag","toggleClass","width","height","offset","rect","getBoundingClientRect","win","defaultView","pageXOffset","top","pageYOffset","size","setBoundaryPixels","setSizePixels","hasFocus","activeElement","grabFocus","delay","setTimeout","focus","removeEvent","removeEventListener","onKeyDown","addEventListener","onKeyUp","onKeyPress","onScroll","onWheel","onClick","onContextMenu","onDblClick","onMouseDown","onMouseUp","onMouseEnter","onMouseLeave","onMouseMove","onMouseOver","onChange","onInput","onTouchStart","onTouchMove","onTouchCancel","onTouchEnd","safeInt","def","startsWith","parseInt","substring","isNaN","safeFloat","parseFloat","newElement","domNew","addText","plural","formatDouble","sigfig","toPrecision","endsWith","htmlToRGB","col","charAt","colourCode","hex","colourAlpha","transp","ONE_OVER_255","colourCanvas","blendRGB","fract","rgb1","rgb2","rgb3","R","G","r1","b1","r2","b2","f1","f2","round","r3","g3","b3","formatDate","date","day","getDate","mon","getMonth","year","getFullYear","isDef","notDef","eventCoords","event","container","pageX","pageY","getBoundaryPixelsDOM","getOffsetPixelsDOM","offsetLeft","offsetTop","norm_xyz","norm2_xyz","signum","invZ","fltEqual","randomInt","random","INV_TWOPI","DEGRAD","RADDEG","th","findNode","findNodes","pathRoundedRect","path","Path2D","moveTo","quadraticCurveTo","lineTo","closePath","coordsRoundedRect","drawLine","ctx","beginPath","stroke","ASCENT_FUDGE","fontSansSerif","ascent","pixelDensity","window","devicePixelRatio","data","isArray","result","deepClone","escapeHTML","map","replace","orBlank","dictValues","zip","toUTF8","stripe","charcode","charCodeAt","String","fromCharCode","fromUTF8","charCode","jsonPrettyPrint","json","trim","ch","indent","orig","repeat","KeyCode","readTextURL","url","Promise","resolve","reject","request","XMLHttpRequest","open","responseType","onload","response","onerror","send","postJSONURL","params","txt","snippet","yieldDOM","pause","seconds","staticScrollerSize","empiricalScrollerSize","outer","body","inner","stringSimilarityPermutations","str1","str2","ch1","ch2","len2","levenshteinDistance","cost","lev1","lev2","lev3","Chemistry","ELEMENTS","ELEMENT_GROUPS","ELEMENT_ROWS","ELEMENT_BLOCKS","ELEMENT_VALENCE","ELEMENT_BONDING","ELEMENT_SHELL","NATURAL_ATOMIC_WEIGHTS","ELEMENT_H","ELEMENT_He","ELEMENT_Li","ELEMENT_Be","ELEMENT_B","ELEMENT_C","ELEMENT_N","ELEMENT_O","ELEMENT_F","ELEMENT_Ne","ELEMENT_Na","ELEMENT_Mg","ELEMENT_Al","ELEMENT_Si","ELEMENT_P","ELEMENT_S","ELEMENT_Cl","ELEMENT_Ar","ELEMENT_K","ELEMENT_Ca","ELEMENT_Sc","ELEMENT_Ti","ELEMENT_V","ELEMENT_Cr","ELEMENT_Mn","ELEMENT_Fe","ELEMENT_Co","ELEMENT_Ni","ELEMENT_Cu","ELEMENT_Zn","ELEMENT_Ga","ELEMENT_Ge","ELEMENT_As","ELEMENT_Se","ELEMENT_Br","ELEMENT_Kr","ELEMENT_Rb","ELEMENT_Sr","ELEMENT_Y","ELEMENT_Zr","ELEMENT_Nb","ELEMENT_Mo","ELEMENT_Tc","ELEMENT_Ru","ELEMENT_Rh","ELEMENT_Pd","ELEMENT_Ag","ELEMENT_Cd","ELEMENT_In","ELEMENT_Sn","ELEMENT_Sb","ELEMENT_Te","ELEMENT_I","ELEMENT_Xe","ELEMENT_Cs","ELEMENT_Ba","ELEMENT_La","ELEMENT_Ce","ELEMENT_Pr","ELEMENT_Nd","ELEMENT_Pm","ELEMENT_Sm","ELEMENT_Eu","ELEMENT_Gd","ELEMENT_Tb","ELEMENT_Dy","ELEMENT_Ho","ELEMENT_Er","ELEMENT_Tm","ELEMENT_Yb","ELEMENT_Lu","ELEMENT_Hf","ELEMENT_Ta","ELEMENT_W","ELEMENT_Re","ELEMENT_Os","ELEMENT_Ir","ELEMENT_Pt","ELEMENT_Au","ELEMENT_Hg","ELEMENT_Tl","ELEMENT_Pb","ELEMENT_Bi","ELEMENT_Po","ELEMENT_At","ELEMENT_Rn","ELEMENT_Fr","ELEMENT_Ra","ELEMENT_Ac","ELEMENT_Th","ELEMENT_Pa","ELEMENT_U","ELEMENT_Np","ELEMENT_Pu","ELEMENT_Am","ELEMENT_Cm","ELEMENT_Bk","ELEMENT_Cf","ELEMENT_Es","ELEMENT_Fm","ELEMENT_Md","ELEMENT_No","ELEMENT_Lr","ELEMENT_Rf","ELEMENT_Db","ELEMENT_Sg","ELEMENT_Bh","ELEMENT_Hs","ELEMENT_Mt","ELEMENT_Ds","ELEMENT_Rg","ELEMENT_Cn","Graph","edge1","edge2","nbrs","indices","labels","props","nbr","fromMolecule","mol","numAtoms","numBonds","bfr","bondFrom","bto","bondTo","fromNeighbours","buff","numNodes","numEdges","getEdge","getEdges","getIndex","setIndex","getLabel","setLabel","lbl","getProperty","prp","addNode","hasEdge","node1","node2","addEdge","removeEdge","isolateNode","keepNodesMask","oldsz","newsz","newmap","newnbrs","keepNodesIndex","removeNodesMask","removeNodesIndex","subgraphIndex","nsz","subgraphMask","calculateComponents","cc","high","calculateComponentGroups","grp","calculateRingBlocks","rblk","plen","numVisited","current","back","nextID","calculateRingBlockGroups","cap","findRingsOfSize","num","rings","newRings","findRingsOfSizeMask","recursiveRingFind","calculateBFS","curnum","lsz","watermark","calculateGravity","wght","wmod","psize","capacity","adj","fnd","newPath","fp","flip","look","same","ResonanceRemover","resBonds","atomHyd","maxIter","bondOrders","tolerant","bondOrder","perform","atomHExplicit","correctInputMask","processComponent","na","nb","atno","atomicNumber","atomCharge","atomAdjCount","nodes","findBond","optionalH","Molecule","HEXPLICIT_UNKNOWN","atomElement","gravity","bsz","bgrav","bidx","seq","paths","resultCount","definiteMatch","p2","validPath","count1","count2","a1","a2","BONDARTIFACT_EXTRA_RESPATH","BONDARTIFACT_EXTRA_RESRING","BONDARTIFACT_EXTRA_ARENE","BondArtifact","resPaths","resRings","arenes","atomExtra","appendResPath","appendResRing","appendArene","blk","res","atoms","pack","pathify","centre","getPathBlocks","keys","getRingBlocks","getAreneBlocks","getResPaths","getResRings","getArenes","rewriteMolecule","extra","modified","setAtomExtra","ring","arene","atom","harmoniseNumbering","blocks","stashPaths","clear","nextIdentifier","stashRings","stashArenes","createPath","alreadyExists","atomsAsPath","createRing","atomsAsRing","createArene","atomsAsArene","removeArtifact","type","pick","overlap","removeAll","bits","requireRing","values","areneAtoms","best","bsum","inkeys","POLYMERBLOCK_EXTRA_POLYMER","POLYMERBLOCK_SPECIAL_UNCAPPED","PolymerBlockConnectivity","Geometry","ForeignMoleculeTransient","QueryTypeAtom","QueryTypeBond","PolymerBlockUnit","connect","bondConn","atomName","bondIncl","bondExcl","dup","PolymerBlock","units","blockAtoms","appendBlock","getIDList","getUnit","getUnits","purgeExtraFields","writeUnit","allKeys","includes","unit","removeUnit","pfx","bondExtra","setBondExtra","createUnit","hasPolymerExtensions","getPolymerExtensions","polext","removePolymerExtensions","nattach","HeadToTail","HeadToHead","Random","hasOuter","atomAdjList","subBits","in1","in2","bonds","order","formatBlockAtom","nbonds","names","formatBlockBond","bond","idxConn","incl","codeAtom","codeBond","SketchUtil","placeNewAtom","boundary","IDEALBOND","addAtom","placeNewFragment","frag","dirX","dirY","score","mbox","fbox","vx","vy","fragPosScore","iscore","setAtomPos","atomX","atomY","ox","oy","rangeX","rangeY","mergeOverlappingAtoms","mergeFragmentsDiv","div","omask","CoordUtil","overlappingAtomMask","chopmask","mx","MolUtil","arrayAtomX","my","arrayAtomY","remap","div1","div2","OVERLAP_THRESHOLD_SQ","oldN","newN","exotic","atomUnpaired","atomIsotope","ISOTOPE_NATURAL","hasAbbrev","setBondFrom","setBondTo","deleteAtomAndBonds","removeDuplicateBonds","mergeFragmentsMask","setAtomHExplicit","setAtomUnpaired","setAtomCharge","matchAngleGeometry","geom","match","GEOM_ANGLES","mtheta","hit","gotall","got","primeDirections","angles","calculateNewBondAngles","exits","exitVectors","atomBondAngles","nn","guessAtomGeometry","mapAngleSubstituent","atblk","elrow","adjBO","adjAN","pri","allSingle","Linear","Octa1","Octa2","Trigonal","SqPlan","Tetra1","Tetra2","gtheta","asz","gsz","vac","gang","mcount","refitAtomGeometry","inRing","allInRing","bondInRing","bestAng","ww","calculateWalkWeight","newAng","bdiff","diff","ringClash","rotateBond","switchAtomGeometry","dst","geoms","bestAtom","bestX","bestY","curth","atomAtPoint","pickAtomsToConnect","aidx","AUTO_DSQ","bestDSQ","bestA1","bestA2","conn","pickNewAtomDirection","congestionPoint","overlapsAtom","joinOverlappingAtoms","groups","groupX","groupY","adjb","atomAdjBonds","keepmask","moveToEdge","gotS","gotN","sx1","sy1","sx2","sy2","nx1","ny1","nx2","ny2","SEPTEST","placeAdditionalHydrogens","numH","base","x0","y0","th3","th4","addBond","allViableDirections","bndang","proposeNewRing","rsz","snap","chunk","positionSimpleRing","proposeAtomRing","thsnap","angs","proposeBondRing","sign","brad","guidelineSprouts","sprouts","ords","sprout","orders","hasAnyAbbrev","getAbbrev","fromString","setAbbrev","attidx","ABBREV_ATTACHMENT","swapAtoms","setBondOrder","validateAbbrevs","clearAbbrev","setAtomIsotope","convertToAbbrev","srcmask","abbrevName","molidx","convertToAbbrevIndex","junction","polymerExtra","fragidx","maskmol","maskfrag","bondType","BONDTYPE_NORMAL","nadj","setAtomElement","setAtomMapNum","setAtomTransient","newmol","newatom","expandAbbrevs","alignCoords","expandOneAbbrev","expandedAbbrevs","atomMapNum","expandOneAbbrevFrag","connBond","connType","BONDTYPE_INCLINED","BONDTYPE_DECLINED","vx1","vy1","vx2","vy2","rotateMolecule","translateMolecule","setBondType","setBondFromTo","deleteBond","invidx","keepTransient","atomTransient","setBondTransient","bondTransient","subgraphWithAttachments","xmask","xmol","boxm","boxf","deleteAtoms","componentList","getAtomSides","oldmap","ccmax","grps","getBondSides","bf","bt","arrayAtomMapNum","mapnum","molecularFormula","punctuation","puncEnter","puncExit","puncEnterSuper","puncExitSuper","countC","countH","elements","atomHydrogens","formula","molecularWeight","mw","iso","an","elementAtomicNumber","bpri","el1","el2","limit1","limit2","boB1A1","boB1A2","boB2A1","boB2A2","bad1","bad2","exotic1","exotic2","ccsz","wn","totalHydrogens","hc","stripHydrogens","force","boringHydrogen","HYVALENCE_EL","createHydrogens","position","atomVec3","is3D","atomZ","atomOxidationState","nonMetal","oxstate","bo","bondOther","chalco","oxidationStateText","absox","TEMPLATE_ATTACHMENT","tolerance","OVERLAP_THRESHOLD","tolsq","sketchEquivalent","mol1","mol2","DEFAULT_EQUIV_TOLERANCE","box1","box2","mx1","my1","mx2","my2","bestdsq","j1","j2","sketchMappable","thresh","threshSQ","d1","overlappingAtomList","approach","congestionMolecule","rotateAtoms","angleNeighbours","mergeAtoms","normaliseBondDistances","centreMolecule","meanX","meanY","deltaX","deltaY","mirrorImage","setAtomX","alignOrientFlip","deltaA","deltaB","dthA","dthB","scoreA","scoreB","setAtomY","atomIsWeirdLinear","ForeignMolecule","noteAromaticAtoms","AtomAromatic","noteAromaticBonds","BondAromatic","noteZeroDativeBonds","BondZeroDative","noteZeroHydrogenBonds","BondZeroHydrogen","markExplicitValence","valence","trans","filter","tr","AtomExplicitValence","noteExplicitValence","markSgroupMultiAttach","keyval","idxHigh","AtomSgroupMultiAttach","payload","hasAnySgroupMultiAttach","some","noteAllSgroupMultiAttach","eq","sgm","markSgroupMultiRepeat","mult","AtomSgroupMultiRepeat","comma","hasAnySgroupMultiRepeat","noteAllSgroupMultiRepeat","mr","markSgroupData","query","AtomSgroupData","hasAnySgroupData","noteAllSgroupData","sd","QueryUtil","hasAnyQueryAtom","hasAnyQueryBond","hasQueryAtom","hasQueryBond","deleteQueryAtom","deleteQueryBond","deleteQueryAtomAll","xtra","deleteQueryBondAll","queryAtomString","queryAtomStringList","queryBondString","setQueryAtom","setQueryAtomList","setQueryBond","queryAtomCharges","parseIntegers","Charges","queryAtomAromatic","parseBoolean","Aromatic","queryAtomUnsaturated","Unsaturated","queryAtomElements","parseStrings","Elements","queryAtomElementsNot","ElementsNot","queryAtomRingSizes","RingSizes","queryAtomRingSizesNot","RingSizesNot","queryAtomRingBlock","RingBlock","queryAtomNumRings","NumRings","queryAtomRingBonds","RingBonds","queryAtomAdjacency","Adjacency","queryAtomBondSums","BondSums","queryAtomValences","Valences","queryAtomHydrogens","Hydrogens","queryAtomIsotope","Isotopes","queryAtomSubFrags","parseMolecules","SubFrags","queryAtomSubFragsNot","SubFragsNot","queryBondRingSizes","queryBondRingSizesNot","queryBondRingBlock","queryBondNumRings","queryBondOrders","Orders","setQueryAtomCharges","formatIntegers","setQueryAtomAromatic","formatBoolean","setQueryAtomUnsaturated","setQueryAtomElements","formatStrings","setQueryAtomElementsNot","setQueryAtomRingSizes","setQueryAtomRingSizesNot","setQueryAtomRingBlock","setQueryAtomNumRings","setQueryAtomRingBonds","setQueryAtomAdjacency","setQueryAtomBondSums","setQueryAtomValences","setQueryAtomHydrogens","setQueryAtomIsotope","setQueryAtomSubFrags","formatMolecules","setQueryAtomSubFragsNot","setQueryBondRingSizes","setQueryBondRingSizesNot","setQueryBondRingBlock","setQueryBondNumRings","setQueryBondOrders","strlist","intlist","mols","molstr","STEREOGROUP_EXTRA_RACEMIC","STEREOGROUP_EXTRA_RELATIVE","StereoGroup","hasStereoGroups","chiRac","chiRel","atomHasWedge","getRacemicGroups","getRelativeGroups","getRacemicAtoms","getRelativeAtoms","getRacemicGroupAtoms","getRelativeGroupAtoms","stash","createRacemic","createRelative","removeRacemic","removeRelative","hasWedge","BONDTYPE_UNKNOWN","MDLMOL_VALENCE","MDLMOLReader","strData","parseHeader","parseExtended","allowV3000","considerRescale","keepAromatic","keepParity","keepQuery","molName","overallStereoAbsolute","groupAttachAny","groupAttachAll","groupStereoAbsolute","groupStereoRacemic","groupStereoRelative","groupLinkNodes","groupMixtures","scsrTemplates","parseCTAB","nextLine","line","version","parseV3000","z","chg","stereo","hyd","setAtomZ","setIs3D","AtomChiralMDLOdd","AtomChiralMDLEven","AtomChiralMDLRacemic","appendBondTransient","superatoms","mixtures","anum","stype","index","bracketType","mix","sup","connectType","minRep","maxRep","nbr1","nbr2","logic","countRingBonds","countSubstitutions","postFix","artifacts","applyPolymerBlock","applySuperAtom","AtomSCSRClass","undefined","options","hcount","usedValence","unp","derez","Section","inCTAB","inTemplate","section","lineCounts","lineAtom","lineBond","lineColl","lineSgroup","asdrawnRBC","asdrawnSUB","templateBlocks","ERRPFX","fullLine","Atom","Bond","Coll","SGroup","splitWithQuotes","counts","atomBits","bondBits","parseQueryAtomList","spin","appendAtomTransient","AtomSCSRSeqID","attch","unpackStrings","AtomSCSRAttchOrd","rbc","endpts","attach","dir","unpackList","stereoGroup","withoutQuotes","templateClass","natReplace","pts","attachPoints","parseV3000Template","label","not","residual","mod","abvAtom","subsumed","poly","b4","header","mdl","segments","seg","depth","quote","bit","MDLSDFReader","ds","DataSheet","upcastColumns","parseStream","upcastStringColumns","appendColumn","colName","rn","appendRow","setMolecule","setString","str3","changeColumnName","colDescr","title","cn","findColByName","setToNull","colType","allnull","allreal","allint","allbool","isNull","getString","lc","toLowerCase","int","changeColumnType","VPFX","MDLMOLWriter","includeHeader","includeCounts","includeEnd","enhancedFields","chargeSeparate","abbrevSgroups","polymerBlocks","sgroups","write","writeCTAB","writeV3000","writeCTAB3000","writeEither","triggered","getResult","partialAbbrevExpansion","prepareSgroups","atomList1","atomList2","intrpad","pad","chgidx","chgval","radidx","radval","isoidx","isoval","rgpidx","rgpval","hydidx","hydval","zboidx","zboval","rbcidx","rbcval","subidx","subval","unsidx","unsval","rpad","toFixed","qhyd","mdlValence","qrbc","qsub","quns","maskArom","qbond","writeMBlockPair","writeMBlockFlat","inSgroup","sg","sidx","encodePolymerBlocks","token","writeMBlockFlatIdxFirst","zeroVal","marked","chgmod","bondSum","nativeVal","ma","dat","bestSize","MAX_SAFE_INTEGER","skip","polymers","fl1","fl2","bcrs","sgroupText","populateV3000Sgroups","qel","isotope","packV3000Strings","maskHBond","collections","racidx","relidx","packV3000List","populateSCSRTemplates","sid","defn","tmdl","molfile","trimEnd","MDLSDFWriter","colMol","firstColOfType","getMolecule","wtr","notNull","ct","getInteger","getReal","getBoolean","MoleculeStream","readUnknown","jsonStr","readNative","readMDLMOL","hdr","skUnescape","frto","writeNative","charge","unpaired","hy","skEscape","skEncodeExtra","writeMDLMOL","code","toUpperCase","hasZCoord","hasTransient","graph","graphBond","ringID","compID","ring3","ring4","ring5","ring6","ring7","trashTransient","getAtom","Error","element","hExplicit","mapNum","transient","getBond","to","bondFromTo","trashGraph","transi","HYVALENCE_VAL","adjBonds","atomExplicit","atomRingBlock","buildGraph","buildRingID","atomConnComp","buildConnComp","tx1","tx2","appendAtomExtra","appendBondExtra","comp","DataSheetColumn","PREFIX_EXTRA","PREFIX_TRANSIENT","description","colData","rowData","numExtens","extData","withRows","inRow","outRow","cloneMask","colMask","rowMask","inclExtn","outCols","outRows","getData","numExtensions","getExtName","getExtType","getExtData","setExtName","setExtType","setExtData","appendExtension","insertExtension","deleteExtension","descr","getExtend","getObject","datum","getMoleculeClone","getMoleculeBlank","setObject","setInteger","setReal","setBoolean","setExtend","isEqualMolecule","isEqualString","isEqualInteger","isEqualReal","isEqualBoolean","insertColumn","deleteColumn","newType","oldType","incompatible","ensureColumn","reorderColumns","appendRowFrom","srcDS","insertRow","deleteRow","deleteAllRows","moveRowUp","moveRowDown","swapRows","row1","row2","exciseSingleRow","newData","colIsPrimitive","copyCell","toRow","toCol","fromDS","fromRow","fromCol","convertType","fromType","toType","ft","tt","toInt","toReal","Aspect","allowModify","isColumnReserved","areColumnsReserved","colNames","resMask","rowFirstBlock","rowBlockCount","aspectUnion","initiateNewRow","columnEffectivelyBlank","numTextRenderings","produceTextRendering","numGraphicRenderings","produceGraphicRendering","policy","numHeaderRenderings","produceHeaderRendering","TEXT_PLAIN","TEXT_LINK","TEXT_HTML","supportedAspects","registerAspect","classdef","CODE","NAME","AspectList","present","absent","codes","instantiate","supp","enumerate","aspects","aspectName","AssayProvenanceHeader","prefixes","targetName","targetURI","organismName","organismURI","targetTypeName","targetTypeURI","cellName","cellURI","assayTypeName","assayTypeURI","assayDescription","sourceName","sourceURI","sourceVersion","documentName","documentURI","measureTypeName","measureTypeURI","unitNames","unitURIs","AssayProvenance","isAssayProvenance","super","setup","getHeader","parseMetaData","setHeader","formatMetaData","COLNAME_MOLECULE","getName","COLNAME_NAME","COLNAME_VALUE","NaN","getError","COLNAME_ERROR","err","COLNAME_UNITS","getRelation","COLNAME_RELATION","getSourceURI","COLNAME_SOURCEURI","setName","setError","setUnits","setRelation","setSourceURI","parseAndCorrect","plainHeading","error","rel","URI_UNIT_M","URI_UNIT_mM","URI_UNIT_uM","URI_UNIT_nM","URI_UNIT_pM","URI_UNIT_logM","URI_UNIT_perM","URI_UNIT_gL","URI_UNIT_mgL","URI_UNIT_ugL","URI_UNIT_binary","BayesianSourceModel","colNameMolecule","colNameValue","thresholdValue","thresholdRelation","folding","noteField","noteTitle","noteOrigin","noteComment","BayesianSource","isBayesianSource","getModels","models","setModels","BayesianPredictionModel","BayesianPredictionOutcome","BayesianPrediction","isBayesianPrediction","colMolecule","colRaw","colScaled","colArcTan","colDomain","colAtoms","isOffTarget","getOutcome","model","outcome","raw","scaled","arctan","domain","strAtoms","setOutcome","MeasurementData","isMeasurementData","fields","effectHeader","ensureFields","rename","fldidx","newName","oldName","sfx","SUFFIX_VALUE","SUFFIX_ERROR","SUFFIX_UNITS","SUFFIX_MOD","reservedColumns","fieldName","getValueField","field","colValue","colError","colUnits","colMod","clearValue","getDescr","setDescr","colidx","uri","defnURI","resv","colField","BinaryDataField","BinaryData","isBinaryData","getFields","setFields","getDestValue","getSourceValue","colNameSource","colNameDest","ExperimentMetaType","ExperimentMetaApplic","ExperimentMetaValue","ExperimentMetaRoleType","QuantityCalcRole","QuantityCalcStat","RenderMnemonicType","BLineType","ArrangeComponentType","ArrangeComponentAnnot","TextAlign","PrimClass","ExperimentComponentType","MixtureAttributeType","DotPathBond","DotPathCharge","ExperimentMeta","unpackMeta","vtype","VALUES","Optional","l1","l2","localeCompare","packMeta","withMetaKey","metastr","describeMeta","formatFloat","maxSigFig","digits","log10","Role","Pressure","TurnoverNumber","EnantiomericExcess","Time","mins","Heat","Light","APPLICABILITY","Reagent","Reactant","Product","Step","NAMES","UNITS","QuantityCalcComp","step","role","molw","valueEquiv","statEquiv","valueMass","QuantityCalc","UNSPECIFIED","statMass","valueVolume","statVolume","valueMoles","statMoles","valueDensity","statDensity","valueConc","statConc","valueYield","statYield","GreenMetrics","massReact","massProd","massWaste","massProdWaste","molwReact","molwProd","impliedWaste","isStoichZero","stoich","isStoichUnity","numer","denom","extractStoichFraction","extractStoichValue","stoichAsRatio","stoichFractAsRatio","MAX_DENOM","RATIO_FRACT","whole","resid","bestDiff","bestOver","bestUnder","impliedReagentStoich","reagent","products","pstoich","rmol","highest","total","pmol","pcount","rcount","componentRatio","reactants","steps","den","reagents","bigDenom","ratioReactants","ratioReagents","ratioProducts","quantities","primaryMoles","idxPrimary","idxYield","allMassReact","allMassProd","allMassWaste","greenMetrics","calculate","classifyTypes","calculateSomething","qc","waste","calculateGreenMetrics","numQuantities","getQuantity","getAllQuantities","numGreenMetrics","getGreenMetrics","getAllGreenMetrics","getAllMassReact","getAllMassProd","getAllMassWaste","findComponent","formatMolWeight","formatMass","formatVolume","formatMoles","formatDensity","formatConc","formatPercent","formatEquiv","equiv","primary","mass","volume","moles","density","conc","yield","calcMoles","closeEnough","isSoln","calcVolume","hasRef","numSteps","primaryCounts","primaryEquivs","refMoles","prodMolar","yld","calcYield","gm","value1","value2","ratio","FitRotatedEllipse","margin","stop","lookupCache","setupParameters","currentScore","calculateScore","coarseDiscovery","fineImprovement","saveCache","getSpline","cacheMap","cacheVal","psz","invpsz","ptheta","pdist","buffX","buffY","rotatedScore","rtheta","scx","scy","devx","devy","deltaD","deltaR","DELTA_OPTIONS","dw","dh","sanity","bestCX","bestCY","bestRW","bestRH","newCX","newCY","newRW","newRH","newScore","REDUCTION","reduc","dCX","dCY","dRW","dRH","closestDSQ","eth","ii","proxSum","FontData","UNITS_PER_EM","INV_UNITS_PER_EM","PANOSE_1","ASCENT","DESCENT","MISSING_HORZ","MISSING_DATA","UNICODE","HORIZ_ADV_X","GLYPH_DATA","OUTLINE_X","OUTLINE_Y","KERN_C1","KERN_C2","KERN_K","pathCache","pathMissing","ctxReference","getKerning","measureText","main","font","measureWidths","xpos","getRawGlyph","getGlyphPath","getMissingPath","getOutlineX","getOutlineY","initNativeFont","canvas","OffscreenCanvas","getContext","measureTextNative","family","opt","save","bold","italic","metrics","restore","FUDGE","RenderPolicy","pointScale","resolutionDPI","fontSize","lineSize","bondSep","defaultPadding","foreground","background","atomCols","defaultBlackOnWhite","pixPerAng","defaultWhiteOnBlack","defaultColourOnWhite","defaultColourOnBlack","defaultPrintedPublication","RenderEffects","colAtom","colBond","dottedRectOutline","dottedBondCross","hideAtoms","hideBonds","atomFrameDotSz","atomFrameCol","atomCircleSz","atomCircleCol","atomDecoText","atomDecoCol","atomDecoSize","bondDecoText","bondDecoCol","bondDecoSize","overlapAtoms","RenderMnemonics","encoded","items","details","coords","serialise","coord","packWithCoords","packWithoutCoords","ArrangeMolecule","guestimateSize","FONT_CORRECT","numsym","plusH","aw","ah","measure","effects","points","space","wantArtifacts","artifactCharge","artifactUnpaired","artifactFract","getMeasure","getPolicy","getEffects","getScale","setWantArtifacts","want","getArtifacts","setArtifacts","arrange","bondSepPix","lineSizePix","fontSizePix","ymul","yIsUp","artmask","setupBondOrders","fsz","angToX","angToY","overCol","wad","PADDING","computeSpacePoint","processLabel","bdbl","xy1","shrinkBond","backOffAtom","xy2","ensureMinimumBondLength","head","qbonds","qtxt","oxy","orthogonalDelta","lx1","ly1","lx2","ly2","bnum","Dotted","computeSpaceLine","rotation","ltype","Normal","Inclined","Declined","Unknown","DotDir","IncDouble","IncTriple","IncQuadruple","invD","ext1","ext2","orderedRingList","processDoubleBond","priorityDoubleSubstit","placeHydrogen","isostr","placeAdjunct","annotateAtom","annotateBond","spc","createCurvedPath","delocalisedAnnotation","createCircularRing","isRing","alkeneLike","createBondCentroid","processPolymerUnit","numPoints","getPoint","getPoints","numLines","getLine","getLines","numRings","getRing","getRings","numPaths","getPath","getPaths","numSpace","getSpace","getSpaces","offsetEverything","offsetOrigin","bounds","determineBoundary","scaleEverything","padding","determineBoundaryBox","squeezeInto","bw","bh","downScale","limitBounds","monochromate","spatialCongestion","congest","delocalise","fractional","angdir","zeroBonds","zpt","ext","bestDX","bestDY","angThresh","shorted","DELTA","dang","viol","countPolyViolations","shortCircuit","ibar","ibrace","side","chunks","refchunk","bpos","isPrimary","chunkw","tw","bump","xbump","ybump","active","xy","backOffAtomDelta","d12","d2","invD12","SIZE_ORDER","nring","ringsz","ringbusy","ringscore","ringorder","resbcount","maxbcount","sc","priority","nfr","nto","btheta","countFLeft","countFRight","countTLeft","countTRight","idxFLeft","idxFRight","idxTLeft","idxTRight","noshift","ispri","ax1","ay1","ax2","ay2","bx1","by1","bx2","by2","bumpAtomPosition","delta1","delta2","delta3","delta4","adjustBondPosition","lt","fussy","SSFRACT","GLYPH_H","emscale","outlineX","outlineY","firstEMW","emw","chp","extraX","extraY","qh","emdx","emdy","srcWAD","RIGHTLEFT","LEFTRIGHT","UPDOWN","DOWNUP","quad","LEFTIES","allLeft","allRight","allUp","allDown","magPX","magPY","bestExt","anyNoClash","subFsz","nglyphs","norm","spaceSubset","subset","hits","nspc","sr","ssz","alt","nf","nt","sumFrom","sumTo","ta","otherTheta","minExt","stepsz","angsz","limX","limY","subSpace","oth","bth","boxOverlaps","pointmask","linemask","wx1","wy1","wx2","wy2","resolveLineCrossings","bondHigher","bondLower","pt","isRegular","regDist","FRACT","pb","mdist","fit","extAtom","symbol","EXT","capA","ncross1","ncross2","fr1","fr2","capB","score1","score2","splineInterpolate","qx1","qy1","qx2","qy2","allUnits","processPolymerUnitPair","brackets","bracket","shared","nestings","u1","u2","nestOrder","nestCount","tagidx","isLinear","isOuter","theta1","theta2","ym","bsz1","bsz2","BASE_LINE","BASE_TEXT","invDist","px2","py2","px3","py3","px1","py1","px4","py4","line1","line2","line3","xx","yy","pt1","pt2","ypos","dsq1","drawText","xmin","ymin","idxN","idxD2","idxD1","ArrangeComponent","annot","None","monochromeColour","metaInfo","srcIdx","leftNumer","leftDenom","fszText","fszLeft","ArrangeExperiment","components","limitTotalW","limitTotalH","limitStructW","limitStructH","includeReagents","includeNames","includeStoich","includeAnnot","includeBlank","includeDetails","includeAtomMap","colourAtomMap","allowVertical","fauxComponents","extraText","includeExtraText","createComponents","xc","Plus","Arrow","lw","lh","COMP_GAP_LEFT","COMP_ANNOT_SIZE","bend","vert","trial","arrangeComponents","scoreArrangement","numComponents","getComponent","getComponents","scaleComponents","modScale","toExpType","compType","createSegregator","createReactant","createBlank","any","createReagent","createStepMeta","createProduct","fc","createFauxComponent","wordWrapName","supplementText","slash","Primary","Implied","Waste","meta","StepNote","colour","comps","bendStep","vertComp","blkMain","blkArrow","szMain","szArrow","midMain","midArrow","gatherBlock","arrangeMainBlock","findMidBlock","bent","arrangeVerticalArrowBlock","arrangeHorizontalArrowBlock","midH","arrowX","originateBlock","lowX","block","arrow","mid","arrowPlaced","minLimW","limW","wrap","nclean","wsz","trimLeft","tryLines","tryClean","OutlineMeasurement","offsetX","offsetY","invScale","xToAng","yToAng","SpoolSVG","prettyPrint","spool","exec","inc","dec","MetaVector","types","prims","charMissing","lowY","highX","highY","charMask","primClass","Text","thickness","typeidx","findOrCreateType","updateBounds","drawRect","edgeCol","fillCol","NOCOLOUR","Rect","drawOval","drawPath","xpoints","ypoints","ctrlFlags","isClosed","hardEdge","Path","closed","drawPoly","align","Left","Baseline","Right","Middle","Top","Bottom","mscale","rx1","ry1","rx2","ry2","drawTextNative","fontFamily","TextNative","boundLowX","boundLowY","boundHighX","boundHighY","getBounds","transformPrimitives","transformIntoBox","nw","nh","scaleExtent","maxWidth","maxHeight","sw","sh","swsh","renderInto","renderCanvas","clearFirst","clearRect","renderContext","typeObj","setupTypeLine","setupTypeRect","setupTypeOval","setupTypePath","setupTypeText","setupTypeTextNative","renderLine","renderRect","renderOval","renderPath","renderText","renderTextNative","createSVG","withXlink","svg","renderSVG","svgLine1","svgLineN","svgRect1","svgRectN","svgOval1","svgOvalN","svgPath","svgText","svgTextNative","into","strokeStyle","lineWidth","lineCap","fillStyle","fillRect","strokeRect","ellipse","layer","bezierCurveTo","lineJoin","translate","fillText","defineSVGStroke","defineSVGFill","rects","ovals","shape","typeDef","every","DrawMolecule","layout","vg","mnemonics","getMetaVector","getLayout","draw","drawUnderEffects","drawFusedWedge","Artifact","drawBondInclined","drawBondDeclined","drawBondUnknown","drawBondDotted","drawBondIncMulti","fg","bez","Centre","drawOverEffects","wdots","hdots","wspc","hspc","Effect","xdots","ydots","invX","invY","bcount","ixy1","ixy2","dx1","dy1","inv1","dx2","dy2","other1","other2","dth1","diff1","dth2","diff2","diff3","terminalPoints","ty1","ty2","outerX","outerY","innerX","innerY","nsteps","invSteps","holdout","ix","iy","radius","nudge","DrawExperiment","preDrawComponent","preDrawMolecule","postDrawMolecule","molDrawn","drawSymbolArrow","drawSymbolPlus","drawComponent","totalH","stoichPos","wad1","wad2","lx","useW","drawAnnotation","baseY","usePolicy","arrmol","calculateMoleculeBaseline","drawArrow","inset","quart","headsz","linesz","hx","ExperimentComponent","ExperimentStep","ExperimentEntry","createDate","modifyDate","doi","getTime","Experiment","isExperiment","COLUMN_DESCRIPTIONS","COLNAME_EXPERIMENT_TITLE","COLNAME_EXPERIMENT_CREATEDATE","COLNAME_EXPERIMENT_MODIFYDATE","COLNAME_EXPERIMENT_DOI","COLNAME_EXPERIMENT_META","COLNAME_STEP_META","COLNAME_REACTANT_MOL","COLNAME_REACTANT_NAME","COLNAME_REACTANT_STOICH","COLNAME_REACTANT_MASS","COLNAME_REACTANT_VOLUME","COLNAME_REACTANT_MOLES","COLNAME_REACTANT_DENSITY","COLNAME_REACTANT_CONC","COLNAME_REACTANT_PRIMARY","COLNAME_REACTANT_META","COLNAME_REAGENT_MOL","COLNAME_REAGENT_NAME","COLNAME_REAGENT_EQUIV","COLNAME_REAGENT_MASS","COLNAME_REAGENT_VOLUME","COLNAME_REAGENT_MOLES","COLNAME_REAGENT_DENSITY","COLNAME_REAGENT_CONC","COLNAME_REAGENT_META","COLNAME_PRODUCT_MOL","COLNAME_PRODUCT_NAME","COLNAME_PRODUCT_STOICH","COLNAME_PRODUCT_MASS","COLNAME_PRODUCT_VOLUME","COLNAME_PRODUCT_MOLES","COLNAME_PRODUCT_DENSITY","COLNAME_PRODUCT_CONC","COLNAME_PRODUCT_YIELD","COLNAME_PRODUCT_WASTE","COLNAME_PRODUCT_META","isFirstStep","numberOfSteps","getEntry","Date","nreactants","nproducts","nreagents","countComponents","fetchReactant","fetchProduct","fetchReagent","setEntry","putEntry","addEntry","insertEntry","deleteEntry","idxRxn","idxYld","idxExp","extRxn","extYld","extExp","CODE_RXN","CODE_YLD","parseReactionMetaData","NAME_RXN","NAME_YLD","forceColumn","forceReactantColumns","forceReagentColumns","forceProductColumns","suffix","useName","preactants","pproducts","preagents","oldSteps","newSteps","curTime","ALL_COLUMN_LITERALS","ALL_COLUMN_PREFIXES","metavec","Mixture","isMixture","attributes","column","info","SARTable","isSARTable","construct","locked","scaffold","substNames","substituents","subst","colConstruct","colLocked","colScaffold","colSubst","createSubstituents","tobeAdded","DESCR_SUBSTITUENT","isAttachment","metadata","DESCR_CONSTRUCT","DESCR_LOCKED","DESCR_SCAFFOLD","used","reserved","RENDER_CONSTRUCT","m1","m2","RENDER_SCAFFOLD","isDefined","RENDER_SUBSTITUENT","sname","scaff","DotPath","maskBlock","getBondOrders","getBondClasses","classes","bcls","getChargeClasses","ccls","getAggregateCharges","nonsingle","pibonded","metalbonded","bondsum","blk1","blk2","impliedPi","adjpi","maskMaybe","COULD_BLOCK","ACIDS","BASES","hasMetal","amask","totalHave","totalWant","others","electrons","Stereochemistry","chiralTetra","STEREO_NONE","cistransBond","squarePlanar","isH","buildPriority","buildTetraChirality","buildBondCisTrans","buildPlanarCisTrans","buildOctaChirality","atomPriority","atomTetraChirality","bondSideStereo","atomPlanarStereo","getPriorities","getAtomTetraChiral","getBondSideStereo","create","rubricTetrahedral","numShort","numWedges","th0","one","two","zz","rubricSquarePlanar","ninc","ndec","v0","v3","v4","d3","d4","MIN_ANGLE","MAX_ANGLE","th12","th23","th34","th41","rubricBipyrimidal","atom2","atom3","atom4","atom5","ANGLE_OPPOSITE","v5","atom1","v45","cross","rubricOctahedral","slots","bestOpposite","axial","bestOrthogonal","bestOrient","rubric","rubricBondSides","adj1","adj2","t1","t2","vfr","vto","vbond","vf1","vt1","THRESHSQ","xf1","xt1","xf1N","keepF1T1","keepF2T1","keepF1T2","keepF2T2","vf2","vt2","xf2","xt2","xf2N","haswedge","skip_atom","STEREO_UNKNOWN","parity","STEREO_NEG","STEREO_POS","ringMask","skip_bond","isBondAromatic","pf1","pf2","cipgr","anyActualH","prigr","cip","sortAndGroup","nextpri","repartitioned","cmp","uset","STEREO_BROKEN","RUBRIC_EQUIV_TETRA","RUBRIC_EQUIV_SIDES","RUBRIC_EQUIV_SQUARE","RUBRIC_EQUIV_BIPY","RUBRIC_EQUIV_OCTA","MetaMolecule","atomArom","bondArom","rubricTetra","rubricSquare","rubricBipy","rubricOcta","rubricSides","hash","heavyHash","uniqueElements","dots","piAtom","calculateStrictAromaticity","nr","ensurePiAtoms","anyChange","phase1","phase2","calculateRelaxedAromaticity","exocyclic","rblk1","rblk2","rng","valid","arom","calculateStereoRubric","adjc","adjc1","hc1","adjc2","hc2","removeHydrogens","atomMask","bondMask","atomMap","calculateSkeletonHash","skeletonHash","calculateHeavyHash","anyH","getSkeletonHash","hvy","isAtomAromatic","bondOrderArom","getAtomAromaticity","getBondAromaticity","getHeavyHash","getDotPath","getUniqueElements","equivalentTo","timeout","isomorphMatch","uniq1","uniq2","createRubric","createStrict","createStrictRubric","createRelaxed","createRelaxedRubric","crc_table","BOOT_CRC","start_crc","feed_crc","crc","byte","end_crc","CircularFingerprints","kind","hookApplyNewFP","hookConsiderNewFP","resolvedChiral","atomGroup","fplist","atomAdj","bondAdj","make_crc_table","initialIdentityECFP","applyNewFP","hashCode","iteration","centralAtom","niter","newident","circularIterate","growAtoms","considerNewFP","circ","numFP","getFP","getFingerprints","getUniqueHashes","hashes","getFoldedHashes","maxBits","andBits","tanimoto","hash1","hash2","nheavy","nhydr","degree","inring","ru","par","newFP","lookFP","CLASS_ECFP0","CLASS_ECFP2","CLASS_ECFP4","CLASS_ECFP6","BayesianModel","classType","numActive","inHash","training","activity","contribs","lowThresh","highThresh","invRange","estimates","rocX","rocY","rocType","rocAUC","trainingSize","trainingActives","atomicSlopeA","atomicInterceptB","truthTP","truthFP","truthTN","truthFN","precision","recall","specificity","statF1","statKappa","statMCC","noteComments","addMolecule","build","invSz","P_AT","hashStr","AT","Pcorr","P","log","predictMolecule","predictFP","scalePredictor","pred","scaleArcTan","INVPI","atan","calculateOverlap","calculateOverlapFP","calculateAtomPredictors","atomic","predHashes","cover","determineCoverage","invN","stdDev","validateLeaveOneOut","singleLeaveOneOut","calculateROC","calculateTruth","validateFiveFold","validateNfold","validateThreeFold","clearTraining","fpname","comment","deserialise","lnum","readLine","PTN_HASHLINE","RegExp","exclActive","exclSet","invSzN","nsegs","segContribs","buildPartial","estimatePartial","ih","segContrib","thresholds","rocT","posTrue","posFalse","ipos","invPos","invNeg","calibrateThresholds","gx","gy","DIST","actual","predicted","TP","FP","TN","FN","invSize","P0","Pe","mccOver","mccUnder","midThresh","idxX","idxY","approvedHashes","collectFP","BuildSMILES","generate","walkSequence","findLinks","assemble","invseq","inPlay","prev","cur","smiles","NON_ESCAPED","Theme","initWebMolKit","resourcePath","RESOURCE_URL","installInlineCSS","lowlight","lowlightEdge1","lowlightEdge2","highlight","highlightEdge1","highlightEdge2","composeMainCSS","BASE_URL","cssTagsInstalled","hasInlineCSS","DataSheetStream","readXML","root","summary","extRoot","extList","colList","rowidx","readJSON","writeXML","extension","cell","txtNode","writeJSON","nrow","ncol","doConvert","TEMPLATE_FILES","AbbrevContainer","abbrevs","needsSetup","setupData","tfn","dsstr","colAbbrev","attcount","firstConn","submitAbbreviation","getAbbrevs","infrag","promote","submitFragment","submitMolecule","inmol","substituteAbbrevName","fragExp","fragMF","fragFP","abbrev","afragExp","afragFP","search","formatAbbrevLabel","abv","nameHTML","nameSearch","pre","post","FormatList","FMT_NATIVE","FMT_XMLDS","FMT_MDLMOL","FMT_MDLSDF","FMT_MDLRDF","FMT_MDLRXN","GFX_PNG","GFX_PNGZIP","GFX_SVG","GFX_SVGZIP","GFX_PDF","GFX_PDFZIP","GFX_EPS","GFX_HTML","GFX_OPENDOC_ODG","GFX_OPENDOC_ODT","GFX_OPENDOC_ODS","GFX_OOXML_DOCX","GFX_OOXML_XLSX","FORMAT_DESCR","FORMAT_EXTN","FORMAT_MIMETYPE","globalInstance","ONTOLOGY_FILES","OntologyTree","roots","mapTerms","alreadyLoaded","init","fn","loadFromURL","getRoots","hasTerm","getBranch","getBranchList","accumulate","branch","loadContent","termList","term","debugString","emit","CSS_TOOLTIP","globalTooltip","globalPopWatermark","addTooltip","bodyHTML","titleHTML","widget","tooltip","Tooltip","addTooltipPromise","bodyCallback","raiseToolTip","avoid","clearTooltip","raise","domTooltip","class","zindex","zIndex","hasTitle","hasBody","winW","innerWidth","winH","innerHeight","boundDiv","popW","popH","posX","posY","setPosition","checkParent","Dialog","minPortionWidth","maxPortionWidth","maximumWidth","maximumHeight","minPortionHeight","maxPortionHeight","topMargin","allowScroller","callbackClose","callbackShown","onClose","onShown","bg","domObscureBackground","close","domObscureForeground","domPanelBoundary","divOuter","tdiv","domTitle","bdiv","domBody","ttlTable","tdTitle","tdButtons","domTitleButtons","domClose","populate","repositionSize","bodyDOM","buttonsDOM","docW","dlgW","Widget","contentDOM","domContent","tagType","render","ButtonViewPosition","ActivityType","ButtonView","parentX","parentY","parentWidth","parentHeight","idealSize","selectedButton","highlightButton","maxButtonColumns","maxButtonRows","border","buttonColNorm1","buttonColNorm2","buttonColActv1","buttonColActv2","buttonColSel1","buttonColSel2","stack","display","hasBigButtons","prefabImgSize","gripHeight","gripWidth","isRaised","outPadding","inPadding","isMacLike","navigator","platform","setParentSize","applyOffset","redraw","topBank","stackSize","layoutButtons","canvasStyle","mouseClick","mouseDoubleClick","preventDefault","mouseDown","mouseUp","mouseOver","mouseOut","mouseMove","pushBank","bank","buttonView","isSubLevel","replaceCanvas","popBank","bankClosed","refreshBank","getSelectedButton","setSelectedButton","cycleSelected","raiseBank","lowerBank","getHasBigButtons","setHasBigButtons","withinOutline","gw","hg","gh","gripSize","sizeForButtons","nbtn","removeDisplayButtons","addGripButton","buttons","popWidth","popHeight","bestLayout","maxSlotHeight","minSlotHeight","slotWidth","layoutMaxHeight","scoreLayout","maxSlotWidth","minSlotWidth","layoutMaxWidth","ncols","nrows","imgDOM","helpSpan","buttonFromID","col1","col2","grad","createLinearGradient","addColorStop","helpText","mnemonic","keyText","imageFN","isSubMenu","path1","path2","delayedRedraw","displayFromID","uw","uh","slot","slotHeight","pickButtonIndex","pickButtonID","triggerButton","hitButton","stopImmediatePropagation","stopPropagation","ButtonBank","claimKey","matchKey","mshift","mctrl","malt","mmeta","mkey","shiftKey","ctrlKey","altKey","metaKey","MetalLigate","metalAtom","ligandAttach","ligands","lig","anyAttached","makeLigandBond","otherLigands","avgTheta","orientLigand","arrangeLigandsFree","arrangeLigandsRange","otherOrder","extent","batch","resolveClashes","ligAtom","mchg","lchg","idxAttach","ly","molExtent","weight","bestLX","bestLY","attTheta","attDist","attDX","attDY","orderAttach","srcX","srcY","dstX","dstY","dtheta","refTheta","refSpan","bounded","thetaMin","thetaSpan","ligandSpan","determineThetaBounds","rotTheta","bestMin","bestMax","ablk","bblk","bumpDX","bumpDY","CLOSE_SQ","tainted","FusionPermutation","attdist","guided","bridged","scoreModifier","chainSelect","TemplateFusion","templ","numAttach","withGuideOnly","guidetempl","guideidx","guideadj","timeLimit","artif1","artif2","poly1","poly2","huntForGuides","permuteNone","oldmol","oldbox","newbox","ROTN","rotmol","srcidx","sourceIndex","permuteAtom","timeStart","newperms","fliptempl","composeGuidedOne","flipmol","composeDirectOne","composeBridge","affixRawPermutations","permuteBond","composeGuidedTwo","composeDirectTwo","permuteMulti","composeGuidedMulti","composeDirectMulti","o1","otheta","ntheta","ocurrent","ncurrent","scoreMod","bfs","osz","asMask","temidx","removeExtraGuides","o2","nth","oidx","orad","nidx","nrad","lowbfs","busy1","busy2","att","gidx","homoPenalty","oel","nel","RESERVED_GUIDESYMBOL","sel","padj","snapToGuide","isGuideOnTerminal","nudgenew","cx1","cy1","cx2","cy2","midx","tidx","gatom","closeDSQ","npsz","umask","numKeep","scorePermutation","uscore","uidx","perm","tmol","tunion","contained","ai","aj","bo1","bo2","wantTheta","totalBO","mmask","tfr","tto","tn","wmol","imask","MoleculeActivity","input","param","owner","toClipboard","output","currentAtom","currentBond","selectedMask","subjectMask","subjectLength","subjectIndex","hasSelected","setOwner","evaluate","execute","Delete","execDelete","Clear","execClear","Copy","execCopy","Cut","SelectAll","execSelectAll","SelectNone","SelectPrevComp","execSelectComp","SelectNextComp","SelectSide","execSelectSide","SelectGrow","execSelectGrow","SelectShrink","execSelectShrink","SelectChain","execSelectChain","SelectSmRing","execSelectSmRing","SelectRingBlk","execSelectRingBlk","SelectCurElement","execSelectCurElement","SelectToggle","execSelectToggle","SelectUnCurrent","execSelectUnCurrent","Element","execElement","positionX","positionY","keepAbbrev","Charge","execCharge","Connect","execConnect","Disconnect","execDisconnect","execMetalLigate","BondOrder","execBond","BondType","BondGeom","execBondGeom","BondAtom","execBondAtom","BondSwitch","execBondSwitch","BondRotate","execBondRotate","BondAddTwo","execBondAddTwo","BondInsert","execBondInsert","Join","execJoin","Nudge","execNudge","NudgeLots","NudgeFar","execNudgeFar","Flip","execFlip","axis","Scale","execScale","Rotate","execRotate","BondDist","execBondDist","AlignAngle","execAlignAngle","angle","AlignRegular","execAlignRegular","AdjustTorsion","execAdjustTorsion","Move","execMove","refAtom","Ring","execRing","ringX","ringY","aromatic","execTemplateFusion","fragNative","setPermutations","permutations","AbbrevTempl","execAbbrevTempl","AbbrevGroup","execAbbrevGroup","AbbrevFormula","execAbbrevFormula","AbbrevClear","execAbbrevClear","AbbrevExpand","execAbbrevExpand","BondArtifactPath","BondArtifactRing","BondArtifactArene","BondArtifactClear","execBondArtifact","execPolymerBlock","AddHydrogens","execAddHydrogens","RemoveHydrogens","execRemoveHydrogens","QueryClear","execQueryClear","QueryCopy","execQueryCopy","QueryPaste","execQueryPaste","QuerySetAtom","execQuerySetAtom","QuerySetBond","execQuerySetBond","QueryBondAny","execQueryBondAny","SproutDirection","execSproutDirection","finish","setState","errmsg","showMessage","requireSubject","zapSubject","withCut","performCopy","all","cclist","pickSelectedGroup","requireCurrent","sides","requireSelected","maxRB","gotRB","rb","applyQuery","NON_METALS","TRANSITION_METALS","MAIN_GROUPS","zap","killmask","ligAtoms","performBondNew","ccmol","oneComp","performBondChange","performBondGeomAtom","performBondGeomBond","altmol","ac1","ac2","mobileSide","baseAng","ang1","ang2","alink","_","fragmask","fusion","isVertical","connAtoms","curDist","sel1","isSelected","sel2","a3","group1","group3","subj","outmol","pi","checkAbbreviationReady","fixed","requireAtoms","artif","subject","curAtom","removePolymerBlock","performPolymerBlock","selmask","qmol","qterms","aterms","bterms","angleOptions","newAtom","bscore","switchType","stereoType","newang","subjmask","disqualTerminal","side1","side2","weight1","weight2","polymer","ELEMENTS_NOBLE","ELEMENTS_S_BLOCK","ELEMENTS_P_BLOCK","ELEMENTS_D_BLOCK","ELEMENTS_F_BLOCK","ELEMENTS_ABBREV","CommandType","COMMANDS_MAIN","COMMANDS_ATOM","COMMANDS_BOND","COMMANDS_SELECT","COMMANDS_MOVE","CommandBank","cmdType","Main","btn","Select","Abbrev","populateElements","SBlock","PBlock","DBlock","FBlock","Noble","actv","canUndo","performUndo","canRedo","performRedo","performPaste","autoScale","zoom","alert","getState","listItems","ContextSketch","state","sketcher","proxyClip","menu","accelerator","click","editCurrent","maybeAppend","canAlwaysGet","rotateSub","rotateSubMenu","subMenu","querySub","querySubMenu","activ","molact","DraggingTool","DrawCanvasDecoration","DrawCanvas","viewOpt","decoration","showOxState","showQuery","showArtifacts","borderRadius","canvasUnder","canvasMolecule","canvasOver","divMessage","guidelines","filthy","dragType","hoverAtom","hoverBond","opAtom","opBond","opBudged","opShift","opCtrl","opAlt","lassoX","lassoY","lassoMask","clickX","clickY","mouseX","mouseY","dragGuides","templatePerms","currentPerm","fusionBank","cursorWatermark","cursorDX","cursorDY","toolAtomSymbol","toolBondOrder","toolBondType","toolChargeDelta","toolRingArom","toolRingFreeform","toolRotateIncr","redrawCacheKey","abbrevPolicy","divInfo","getSelected","getLassoed","scaleToAng","angToScale","layoutMolecule","sketchEffects","redrawMetaVector","abbrevMol","orientAbbreviation","redrawInfo","redrawUnder","redrawMolecule","redrawOver","cacheKey","divText","HOVER_COL","CURRENT_COL","CURRENT_BORD","SELECT_COL","LASSO_COL","drawPolymerUnit","drawAtomShade","drawBondShade","sfr","sto","lfr","lto","sourceX","sourceY","destX","destY","determineFauxRing","Lasso","Erasor","erasing","determineDragTheta","subjectAtoms","determineMoveDelta","drawOriginatingBond","drawQueryFeatures","allIfNone","useOpAtom","updateLasso","calculateLassoMask","borderCol","anghalo","minRad","invNB","CIRC","snapTo","snapAtom","fh","annots","ap","NPT","THPT","extBonds","inAtoms","outAtoms","flag1","flag2","npWidth","npHeight","selfLinks","innerLinks","outerLinks","isCapped","isExt","anames","pair","setLineDash","pickObject","APPROACH","pickObjectCanvas","limitDist","bestItem","noAtoms","noBonds","chi","MappingNumber","AtomIndex","abbrevAtom","GeomWidgetType","GeomWidgetSelType","ClipboardProxyHandler","copyEvent","andCut","proxy","pasteEvent","ClipboardProxy","handlers","pushHandler","handler","popHandler","currentHandler","triggerCopy","execCommand","triggerPaste","setImage","blob","canSetHTML","downloadString","ClipboardProxyWeb","lastContent","fakeTextArea","busy","wnd","clipboardData","consumed","fallbackWorkaround","scrollTop","select","clipboard","writeText","then","ClipboardItem","OptionList","htmlLabels","selidx","buttonDiv","auxCell","callbackSelect","composeCSS","getSelectedIndex","getSelectedValue","getAuxiliaryCell","onSelect","table","td","clickButton","updateButtons","setSelectedIndex","setSelectedValue","TabBar","unionHeight","panelDiv","getPanelDOM","idxOrName","grid","columns","underline","outline","panel","rotateSelected","ExtraFieldsWidget","divFields","fillTable","divButtons","getExtraFields","getTransientFields","strType","strValue","tdType","tdValue","tdButton","GeomWidget","linkA","linkB","torsA","torsB","hovered","atomSubset","selected","Position","Link","divDiagram","selectionAtoms","Torsion","ANG_RAD","loX","hiX","loY","hiY","posRad","gfx","outerSel","innerSel","showsel","pf","ox1","oy1","ox2","oy2","thetaM","oxM","oyM","ax3","ay3","ax4","ay4","which","whichSelection","sameSelection","maxRad","closeSel","closeDelta","midtheta","POSITION_TABLE_Y","POSITION_TABLE_X","PeriodicTableWidget","divList","selectedAtno","changeElement","callbackDoubleClick","onDoubleClick","updateSelected","setSelectedElements","elementList","QueryFieldsWidget","makeInput","makeToggleInput","chk","inputCharges","optAromatic","optUnsaturated","chkNotElements","inputElements","chkNotRingSizes","inputRingSizes","optRingBlock","inputNumRings","inputRingBonds","inputAdjacency","inputBondSums","inputValences","inputHydrogens","inputIsotopes","setupAtom","inputOrders","setupBond","updateAtom","splitNumbers","unsat","elem","splitStrings","checked","ringblk","updateBond","elemNot","ringszNot","EditAtom","callbackApply","newX","newY","tabs","abbrevList","svgAbbrev","abbrevIndices","currentAbbrev","initMol","btnApply","applyChanges","selectedTab","populateAtom","populateAbbreviation","populateGeometry","populateQuery","populateExtra","focusable","updateMolecule","selTab","updateAbbrev","updateGeometry","updateQuery","updateExtra","inputSymbol","periodicWidget","inputCharge","inputUnpaired","optionHydrogen","inputHydrogen","disabled","optionIsotope","inputIsotope","inputMapping","inputIndex","divPeriodic","divFlex","spanSearch","spanList","inputAbbrevSearch","lastSearch","cycleAbbreviation","fillAbbreviations","selectAbbreviation","tableAbbrev","divContainer1","divContainer2","geomWidget","label1","inputGeom1","label2","inputGeom2","refGeom1","refGeom2","queryWidget","fieldsWidget","sym","hcidx","strval1","strval2","instate","mf","abbrevEntries","bgcol","tdLabel","tdStruct","scrollIntoView","EditBond","populateBond","ordersHTML","optionOrder","optionStereo","inputFrom","readOnly","inputTo","CHAR_LOW_A","CHAR_UP_A","indexToAtomLabel","indexToBondLabel","EditPolymer","optionConnect","optionBondConn","currentID","borderAtoms","outBonds","umol","umap","btnRemove","applyRemove","inputNAtoms","inputNBond","populate2x2Conn","getList","domLabel","nvals","inputIncl","inputExcl","ivals","evals","populateUncap","divPreview","renderUnit","keyCode","bondConnOptions","optionList","uncapAtoms","btnUncap","LINES","circle","ToolBankItem","TemplateBank","group","subgroups","templates","resourceData","loadResourceData","prepareSubGroups","prepareTemplates","populateGroups","populateTemplates","titles","preview","molecules","resourceList","msz","colMnemonic","FusionBank","templateAccept","templateRotate","clearPermutations","TOOLS_MAIN","Pan","Drag","BondOrder0","BondOrder1","BondOrder2","BondOrder3","BondUnknown","BondInclined","BondDeclined","RingAliph","RingArom","AtomPlus","AtomMinus","ElementPfx","ToolBank","EmbedReactionFacet","Sketcher","callbackSpecialPaste","inDialog","initialFocus","useToolBank","lowerToolBank","useCommandBank","lowerCommandBank","useTemplateBank","lowerTemplateBank","debugOutput","beenSetup","undoStack","redoStack","fadeWatermark","toolView","commandView","templateView","proxyMenu","defineMolecule","withAutoScale","withStashUndo","keepSelect","stashUndo","stopTemplateFusion","callbackChangeMolecule","renderMolecule","defineClipboard","defineContext","defineMoleculeString","molsk","defineRenderPolicy","defineBackground","borderRad","bgCol","clearMolecule","centreAndShrink","setupAsync","reserveHeight","keyPressed","keyDown","keyUp","touchStart","touchMove","touchCancel","touchEnd","contextMenu","dataTransfer","dropEffect","dropInto","changeSize","btnv","msg","isError","szLeft","szRight","szBottom","clearMessage","layoutTemplatePerm","anySelected","setSelected","changeCurrentAtom","changeCurrentBond","clearSubject","UNDO_SIZE","pickTemplatePermutation","performCopySelection","pasteText","performActivity","newScale","editBond","editAtom","pasteLocal","pasteMolecule","dlg","limH","natW","natH","down","tpolicy","updateHoverCursor","tool","toolApplies","mouseObj","mouseAtom","mouseBond","abbrevThen","abbrevNow","determineDragGuide","single","determineMoveGuide","guides","hitArrowKey","cursorJumpDirection","jumpFromCurrentAtom","jumpFromCurrentBond","jumpFromNowhere","closestDelta","adjTheta","cosdelta","bondTheta","atheta","bound","ctrlArrowKey","sproutDirection","clickObj","interactStart","interactEnd","interactDrag","view","nomod","touches","mouseWheel","openContextMenu","Press","Zoom","BondPfx","inPoly","newOX","newOY","interactEndDrag","interactEndClick","clickAtom","clickBond","autoscale","degrees","prompt","toObj","connectPolymerBlock","transfer","files","SUFFIXES","MIMES","getAsString","console","reader","FileReader","readAsText","bond1","bond2","atomIn1","atomOut1","atomIn2","atomOut2","highName","ina","inb","nameList","name1","name2","EditCompound","callbackSave","onSave","getSketcher","btnClear","btnCopy","actionCopy","btnSave","skdiv","actionCut","actionPaste","actionUndo","actionRedo","AxisLabeller","minVal","maxVal","textWidth","inverse","notches","loT","hiT","bumpLess","bumpMore","t3","t4","t5","t6","p3","p4","p5","p6","loVal","hiVal","formatNumber","EmbedChemistry","backgroundCol1","backgroundCol2","clearBackground","setBackground","setBackgroundGradient","bg1","bg2","cols","EmbedCollection","datastr","failmsg","tight","encoding","atob","format","scheme","span","determineColumns","blksz","aspect","spec","renderPrimitive","renderTextAspect","renderGraphicAspect","claimed","rend","ahref","EmbedMolecule","boxSize","invert","EmbedReaction","facet","xs","maximumwidth","stoichiometry","annotations","HEADER","renderHeader","SCHEME","renderScheme","QUANTITY","renderQuantity","METRICS","renderMetrics","toLocaleString","doiToLink","quant","renderComponentText","stat","combineQuant","sumQuant","pmi1","pmi2","pmi3","sumQuantExt","drawTotals","para","ef1","ef2","ef3","ae1","ae2","ae3","requireSomething","sum1","sum2","heading","over","under","answer","sep","wadHeading","wadOver","wadUnder","wadAnswer","wadSep","PTN_DOI1","PTN_DOI2","PTN_ISBN","Popup","popupBackground","obscureOpacity","callbackPopulate","positionAndShow","client","scrollSize","MenuProxy","hasContextMenu","menuItems","MenuProxyWeb","divCursor","currentFocus","popup","overrideObscureOpacity","menuItem","fcn","seed","invMN","float","peek","pull"],"sourceRoot":""}